function gv(R,B){for(var Y=0;Y<B.length;Y++){const F=B[Y];if(typeof F!="string"&&!Array.isArray(F)){for(const U in F)if(U!=="default"&&!(U in R)){const ee=Object.getOwnPropertyDescriptor(F,U);ee&&Object.defineProperty(R,U,ee.get?ee:{enumerable:!0,get:()=>F[U]})}}}return Object.freeze(Object.defineProperty(R,Symbol.toStringTag,{value:"Module"}))}(function(){const B=document.createElement("link").relList;if(B&&B.supports&&B.supports("modulepreload"))return;for(const U of document.querySelectorAll('link[rel="modulepreload"]'))F(U);new MutationObserver(U=>{for(const ee of U)if(ee.type==="childList")for(const L of ee.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&F(L)}).observe(document,{childList:!0,subtree:!0});function Y(U){const ee={};return U.integrity&&(ee.integrity=U.integrity),U.referrerPolicy&&(ee.referrerPolicy=U.referrerPolicy),U.crossOrigin==="use-credentials"?ee.credentials="include":U.crossOrigin==="anonymous"?ee.credentials="omit":ee.credentials="same-origin",ee}function F(U){if(U.ep)return;U.ep=!0;const ee=Y(U);fetch(U.href,ee)}})();function Dy(R){return R&&R.__esModule&&Object.prototype.hasOwnProperty.call(R,"default")?R.default:R}var c_={exports:{}},dm={};var F_;function _v(){if(F_)return dm;F_=1;var R=Symbol.for("react.transitional.element"),B=Symbol.for("react.fragment");function Y(F,U,ee){var L=null;if(ee!==void 0&&(L=""+ee),U.key!==void 0&&(L=""+U.key),"key"in U){ee={};for(var f in U)f!=="key"&&(ee[f]=U[f])}else ee=U;return U=ee.ref,{$$typeof:R,type:F,key:L,ref:U!==void 0?U:null,props:ee}}return dm.Fragment=B,dm.jsx=Y,dm.jsxs=Y,dm}var V_;function yv(){return V_||(V_=1,c_.exports=_v()),c_.exports}var Nt=yv(),h_={exports:{}},Bn={};var U_;function vv(){if(U_)return Bn;U_=1;var R=Symbol.for("react.transitional.element"),B=Symbol.for("react.portal"),Y=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),ee=Symbol.for("react.consumer"),L=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),ge=Symbol.for("react.memo"),Te=Symbol.for("react.lazy"),ce=Symbol.for("react.activity"),Pe=Symbol.iterator;function Oe(Re){return Re===null||typeof Re!="object"?null:(Re=Pe&&Re[Pe]||Re["@@iterator"],typeof Re=="function"?Re:null)}var Fe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},at=Object.assign,Ie={};function Et(Re,lt,zt){this.props=Re,this.context=lt,this.refs=Ie,this.updater=zt||Fe}Et.prototype.isReactComponent={},Et.prototype.setState=function(Re,lt){if(typeof Re!="object"&&typeof Re!="function"&&Re!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Re,lt,"setState")},Et.prototype.forceUpdate=function(Re){this.updater.enqueueForceUpdate(this,Re,"forceUpdate")};function vt(){}vt.prototype=Et.prototype;function rt(Re,lt,zt){this.props=Re,this.context=lt,this.refs=Ie,this.updater=zt||Fe}var At=rt.prototype=new vt;At.constructor=rt,at(At,Et.prototype),At.isPureReactComponent=!0;var Mt=Array.isArray;function Lt(){}var _t={H:null,A:null,T:null,S:null},Gt=Object.prototype.hasOwnProperty;function Ft(Re,lt,zt){var Ct=zt.ref;return{$$typeof:R,type:Re,key:lt,ref:Ct!==void 0?Ct:null,props:zt}}function xn(Re,lt){return Ft(Re.type,lt,Re.props)}function dn(Re){return typeof Re=="object"&&Re!==null&&Re.$$typeof===R}function sn(Re){var lt={"=":"=0",":":"=2"};return"$"+Re.replace(/[=:]/g,function(zt){return lt[zt]})}var En=/\/+/g;function Rt(Re,lt){return typeof Re=="object"&&Re!==null&&Re.key!=null?sn(""+Re.key):lt.toString(36)}function fn(Re){switch(Re.status){case"fulfilled":return Re.value;case"rejected":throw Re.reason;default:switch(typeof Re.status=="string"?Re.then(Lt,Lt):(Re.status="pending",Re.then(function(lt){Re.status==="pending"&&(Re.status="fulfilled",Re.value=lt)},function(lt){Re.status==="pending"&&(Re.status="rejected",Re.reason=lt)})),Re.status){case"fulfilled":return Re.value;case"rejected":throw Re.reason}}throw Re}function Je(Re,lt,zt,Ct,en){var Mn=typeof Re;(Mn==="undefined"||Mn==="boolean")&&(Re=null);var Rn=!1;if(Re===null)Rn=!0;else switch(Mn){case"bigint":case"string":case"number":Rn=!0;break;case"object":switch(Re.$$typeof){case R:case B:Rn=!0;break;case Te:return Rn=Re._init,Je(Rn(Re._payload),lt,zt,Ct,en)}}if(Rn)return en=en(Re),Rn=Ct===""?"."+Rt(Re,0):Ct,Mt(en)?(zt="",Rn!=null&&(zt=Rn.replace(En,"$&/")+"/"),Je(en,lt,zt,"",function(Ln){return Ln})):en!=null&&(dn(en)&&(en=xn(en,zt+(en.key==null||Re&&Re.key===en.key?"":(""+en.key).replace(En,"$&/")+"/")+Rn)),lt.push(en)),1;Rn=0;var Ue=Ct===""?".":Ct+":";if(Mt(Re))for(var yi=0;yi<Re.length;yi++)Ct=Re[yi],Mn=Ue+Rt(Ct,yi),Rn+=Je(Ct,lt,zt,Mn,en);else if(yi=Oe(Re),typeof yi=="function")for(Re=yi.call(Re),yi=0;!(Ct=Re.next()).done;)Ct=Ct.value,Mn=Ue+Rt(Ct,yi++),Rn+=Je(Ct,lt,zt,Mn,en);else if(Mn==="object"){if(typeof Re.then=="function")return Je(fn(Re),lt,zt,Ct,en);throw lt=String(Re),Error("Objects are not valid as a React child (found: "+(lt==="[object Object]"?"object with keys {"+Object.keys(Re).join(", ")+"}":lt)+"). If you meant to render a collection of children, use an array instead.")}return Rn}function Tt(Re,lt,zt){if(Re==null)return Re;var Ct=[],en=0;return Je(Re,Ct,"","",function(Mn){return lt.call(zt,Mn,en++)}),Ct}function $t(Re){if(Re._status===-1){var lt=Re._result;lt=lt(),lt.then(function(zt){(Re._status===0||Re._status===-1)&&(Re._status=1,Re._result=zt)},function(zt){(Re._status===0||Re._status===-1)&&(Re._status=2,Re._result=zt)}),Re._status===-1&&(Re._status=0,Re._result=lt)}if(Re._status===1)return Re._result.default;throw Re._result}var Ht=typeof reportError=="function"?reportError:function(Re){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var lt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Re=="object"&&Re!==null&&typeof Re.message=="string"?String(Re.message):String(Re),error:Re});if(!window.dispatchEvent(lt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Re);return}console.error(Re)},Pt={map:Tt,forEach:function(Re,lt,zt){Tt(Re,function(){lt.apply(this,arguments)},zt)},count:function(Re){var lt=0;return Tt(Re,function(){lt++}),lt},toArray:function(Re){return Tt(Re,function(lt){return lt})||[]},only:function(Re){if(!dn(Re))throw Error("React.Children.only expected to receive a single React element child.");return Re}};return Bn.Activity=ce,Bn.Children=Pt,Bn.Component=Et,Bn.Fragment=Y,Bn.Profiler=U,Bn.PureComponent=rt,Bn.StrictMode=F,Bn.Suspense=ue,Bn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=_t,Bn.__COMPILER_RUNTIME={__proto__:null,c:function(Re){return _t.H.useMemoCache(Re)}},Bn.cache=function(Re){return function(){return Re.apply(null,arguments)}},Bn.cacheSignal=function(){return null},Bn.cloneElement=function(Re,lt,zt){if(Re==null)throw Error("The argument must be a React element, but you passed "+Re+".");var Ct=at({},Re.props),en=Re.key;if(lt!=null)for(Mn in lt.key!==void 0&&(en=""+lt.key),lt)!Gt.call(lt,Mn)||Mn==="key"||Mn==="__self"||Mn==="__source"||Mn==="ref"&&lt.ref===void 0||(Ct[Mn]=lt[Mn]);var Mn=arguments.length-2;if(Mn===1)Ct.children=zt;else if(1<Mn){for(var Rn=Array(Mn),Ue=0;Ue<Mn;Ue++)Rn[Ue]=arguments[Ue+2];Ct.children=Rn}return Ft(Re.type,en,Ct)},Bn.createContext=function(Re){return Re={$$typeof:L,_currentValue:Re,_currentValue2:Re,_threadCount:0,Provider:null,Consumer:null},Re.Provider=Re,Re.Consumer={$$typeof:ee,_context:Re},Re},Bn.createElement=function(Re,lt,zt){var Ct,en={},Mn=null;if(lt!=null)for(Ct in lt.key!==void 0&&(Mn=""+lt.key),lt)Gt.call(lt,Ct)&&Ct!=="key"&&Ct!=="__self"&&Ct!=="__source"&&(en[Ct]=lt[Ct]);var Rn=arguments.length-2;if(Rn===1)en.children=zt;else if(1<Rn){for(var Ue=Array(Rn),yi=0;yi<Rn;yi++)Ue[yi]=arguments[yi+2];en.children=Ue}if(Re&&Re.defaultProps)for(Ct in Rn=Re.defaultProps,Rn)en[Ct]===void 0&&(en[Ct]=Rn[Ct]);return Ft(Re,Mn,en)},Bn.createRef=function(){return{current:null}},Bn.forwardRef=function(Re){return{$$typeof:f,render:Re}},Bn.isValidElement=dn,Bn.lazy=function(Re){return{$$typeof:Te,_payload:{_status:-1,_result:Re},_init:$t}},Bn.memo=function(Re,lt){return{$$typeof:ge,type:Re,compare:lt===void 0?null:lt}},Bn.startTransition=function(Re){var lt=_t.T,zt={};_t.T=zt;try{var Ct=Re(),en=_t.S;en!==null&&en(zt,Ct),typeof Ct=="object"&&Ct!==null&&typeof Ct.then=="function"&&Ct.then(Lt,Ht)}catch(Mn){Ht(Mn)}finally{lt!==null&&zt.types!==null&&(lt.types=zt.types),_t.T=lt}},Bn.unstable_useCacheRefresh=function(){return _t.H.useCacheRefresh()},Bn.use=function(Re){return _t.H.use(Re)},Bn.useActionState=function(Re,lt,zt){return _t.H.useActionState(Re,lt,zt)},Bn.useCallback=function(Re,lt){return _t.H.useCallback(Re,lt)},Bn.useContext=function(Re){return _t.H.useContext(Re)},Bn.useDebugValue=function(){},Bn.useDeferredValue=function(Re,lt){return _t.H.useDeferredValue(Re,lt)},Bn.useEffect=function(Re,lt){return _t.H.useEffect(Re,lt)},Bn.useEffectEvent=function(Re){return _t.H.useEffectEvent(Re)},Bn.useId=function(){return _t.H.useId()},Bn.useImperativeHandle=function(Re,lt,zt){return _t.H.useImperativeHandle(Re,lt,zt)},Bn.useInsertionEffect=function(Re,lt){return _t.H.useInsertionEffect(Re,lt)},Bn.useLayoutEffect=function(Re,lt){return _t.H.useLayoutEffect(Re,lt)},Bn.useMemo=function(Re,lt){return _t.H.useMemo(Re,lt)},Bn.useOptimistic=function(Re,lt){return _t.H.useOptimistic(Re,lt)},Bn.useReducer=function(Re,lt,zt){return _t.H.useReducer(Re,lt,zt)},Bn.useRef=function(Re){return _t.H.useRef(Re)},Bn.useState=function(Re){return _t.H.useState(Re)},Bn.useSyncExternalStore=function(Re,lt,zt){return _t.H.useSyncExternalStore(Re,lt,zt)},Bn.useTransition=function(){return _t.H.useTransition()},Bn.version="19.2.3",Bn}var j_;function C_(){return j_||(j_=1,h_.exports=vv()),h_.exports}var nn=C_(),f_={exports:{}},pm={},d_={exports:{}},p_={};var G_;function xv(){return G_||(G_=1,(function(R){function B(Je,Tt){var $t=Je.length;Je.push(Tt);e:for(;0<$t;){var Ht=$t-1>>>1,Pt=Je[Ht];if(0<U(Pt,Tt))Je[Ht]=Tt,Je[$t]=Pt,$t=Ht;else break e}}function Y(Je){return Je.length===0?null:Je[0]}function F(Je){if(Je.length===0)return null;var Tt=Je[0],$t=Je.pop();if($t!==Tt){Je[0]=$t;e:for(var Ht=0,Pt=Je.length,Re=Pt>>>1;Ht<Re;){var lt=2*(Ht+1)-1,zt=Je[lt],Ct=lt+1,en=Je[Ct];if(0>U(zt,$t))Ct<Pt&&0>U(en,zt)?(Je[Ht]=en,Je[Ct]=$t,Ht=Ct):(Je[Ht]=zt,Je[lt]=$t,Ht=lt);else if(Ct<Pt&&0>U(en,$t))Je[Ht]=en,Je[Ct]=$t,Ht=Ct;else break e}}return Tt}function U(Je,Tt){var $t=Je.sortIndex-Tt.sortIndex;return $t!==0?$t:Je.id-Tt.id}if(R.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var ee=performance;R.unstable_now=function(){return ee.now()}}else{var L=Date,f=L.now();R.unstable_now=function(){return L.now()-f}}var ue=[],ge=[],Te=1,ce=null,Pe=3,Oe=!1,Fe=!1,at=!1,Ie=!1,Et=typeof setTimeout=="function"?setTimeout:null,vt=typeof clearTimeout=="function"?clearTimeout:null,rt=typeof setImmediate<"u"?setImmediate:null;function At(Je){for(var Tt=Y(ge);Tt!==null;){if(Tt.callback===null)F(ge);else if(Tt.startTime<=Je)F(ge),Tt.sortIndex=Tt.expirationTime,B(ue,Tt);else break;Tt=Y(ge)}}function Mt(Je){if(at=!1,At(Je),!Fe)if(Y(ue)!==null)Fe=!0,Lt||(Lt=!0,sn());else{var Tt=Y(ge);Tt!==null&&fn(Mt,Tt.startTime-Je)}}var Lt=!1,_t=-1,Gt=5,Ft=-1;function xn(){return Ie?!0:!(R.unstable_now()-Ft<Gt)}function dn(){if(Ie=!1,Lt){var Je=R.unstable_now();Ft=Je;var Tt=!0;try{e:{Fe=!1,at&&(at=!1,vt(_t),_t=-1),Oe=!0;var $t=Pe;try{t:{for(At(Je),ce=Y(ue);ce!==null&&!(ce.expirationTime>Je&&xn());){var Ht=ce.callback;if(typeof Ht=="function"){ce.callback=null,Pe=ce.priorityLevel;var Pt=Ht(ce.expirationTime<=Je);if(Je=R.unstable_now(),typeof Pt=="function"){ce.callback=Pt,At(Je),Tt=!0;break t}ce===Y(ue)&&F(ue),At(Je)}else F(ue);ce=Y(ue)}if(ce!==null)Tt=!0;else{var Re=Y(ge);Re!==null&&fn(Mt,Re.startTime-Je),Tt=!1}}break e}finally{ce=null,Pe=$t,Oe=!1}Tt=void 0}}finally{Tt?sn():Lt=!1}}}var sn;if(typeof rt=="function")sn=function(){rt(dn)};else if(typeof MessageChannel<"u"){var En=new MessageChannel,Rt=En.port2;En.port1.onmessage=dn,sn=function(){Rt.postMessage(null)}}else sn=function(){Et(dn,0)};function fn(Je,Tt){_t=Et(function(){Je(R.unstable_now())},Tt)}R.unstable_IdlePriority=5,R.unstable_ImmediatePriority=1,R.unstable_LowPriority=4,R.unstable_NormalPriority=3,R.unstable_Profiling=null,R.unstable_UserBlockingPriority=2,R.unstable_cancelCallback=function(Je){Je.callback=null},R.unstable_forceFrameRate=function(Je){0>Je||125<Je?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Gt=0<Je?Math.floor(1e3/Je):5},R.unstable_getCurrentPriorityLevel=function(){return Pe},R.unstable_next=function(Je){switch(Pe){case 1:case 2:case 3:var Tt=3;break;default:Tt=Pe}var $t=Pe;Pe=Tt;try{return Je()}finally{Pe=$t}},R.unstable_requestPaint=function(){Ie=!0},R.unstable_runWithPriority=function(Je,Tt){switch(Je){case 1:case 2:case 3:case 4:case 5:break;default:Je=3}var $t=Pe;Pe=Je;try{return Tt()}finally{Pe=$t}},R.unstable_scheduleCallback=function(Je,Tt,$t){var Ht=R.unstable_now();switch(typeof $t=="object"&&$t!==null?($t=$t.delay,$t=typeof $t=="number"&&0<$t?Ht+$t:Ht):$t=Ht,Je){case 1:var Pt=-1;break;case 2:Pt=250;break;case 5:Pt=1073741823;break;case 4:Pt=1e4;break;default:Pt=5e3}return Pt=$t+Pt,Je={id:Te++,callback:Tt,priorityLevel:Je,startTime:$t,expirationTime:Pt,sortIndex:-1},$t>Ht?(Je.sortIndex=$t,B(ge,Je),Y(ue)===null&&Je===Y(ge)&&(at?(vt(_t),_t=-1):at=!0,fn(Mt,$t-Ht))):(Je.sortIndex=Pt,B(ue,Je),Fe||Oe||(Fe=!0,Lt||(Lt=!0,sn()))),Je},R.unstable_shouldYield=xn,R.unstable_wrapCallback=function(Je){var Tt=Pe;return function(){var $t=Pe;Pe=Tt;try{return Je.apply(this,arguments)}finally{Pe=$t}}}})(p_)),p_}var q_;function bv(){return q_||(q_=1,d_.exports=xv()),d_.exports}var m_={exports:{}},Ns={};var Z_;function wv(){if(Z_)return Ns;Z_=1;var R=C_();function B(ue){var ge="https://react.dev/errors/"+ue;if(1<arguments.length){ge+="?args[]="+encodeURIComponent(arguments[1]);for(var Te=2;Te<arguments.length;Te++)ge+="&args[]="+encodeURIComponent(arguments[Te])}return"Minified React error #"+ue+"; visit "+ge+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Y(){}var F={d:{f:Y,r:function(){throw Error(B(522))},D:Y,C:Y,L:Y,m:Y,X:Y,S:Y,M:Y},p:0,findDOMNode:null},U=Symbol.for("react.portal");function ee(ue,ge,Te){var ce=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:U,key:ce==null?null:""+ce,children:ue,containerInfo:ge,implementation:Te}}var L=R.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(ue,ge){if(ue==="font")return"";if(typeof ge=="string")return ge==="use-credentials"?ge:""}return Ns.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=F,Ns.createPortal=function(ue,ge){var Te=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ge||ge.nodeType!==1&&ge.nodeType!==9&&ge.nodeType!==11)throw Error(B(299));return ee(ue,ge,null,Te)},Ns.flushSync=function(ue){var ge=L.T,Te=F.p;try{if(L.T=null,F.p=2,ue)return ue()}finally{L.T=ge,F.p=Te,F.d.f()}},Ns.preconnect=function(ue,ge){typeof ue=="string"&&(ge?(ge=ge.crossOrigin,ge=typeof ge=="string"?ge==="use-credentials"?ge:"":void 0):ge=null,F.d.C(ue,ge))},Ns.prefetchDNS=function(ue){typeof ue=="string"&&F.d.D(ue)},Ns.preinit=function(ue,ge){if(typeof ue=="string"&&ge&&typeof ge.as=="string"){var Te=ge.as,ce=f(Te,ge.crossOrigin),Pe=typeof ge.integrity=="string"?ge.integrity:void 0,Oe=typeof ge.fetchPriority=="string"?ge.fetchPriority:void 0;Te==="style"?F.d.S(ue,typeof ge.precedence=="string"?ge.precedence:void 0,{crossOrigin:ce,integrity:Pe,fetchPriority:Oe}):Te==="script"&&F.d.X(ue,{crossOrigin:ce,integrity:Pe,fetchPriority:Oe,nonce:typeof ge.nonce=="string"?ge.nonce:void 0})}},Ns.preinitModule=function(ue,ge){if(typeof ue=="string")if(typeof ge=="object"&&ge!==null){if(ge.as==null||ge.as==="script"){var Te=f(ge.as,ge.crossOrigin);F.d.M(ue,{crossOrigin:Te,integrity:typeof ge.integrity=="string"?ge.integrity:void 0,nonce:typeof ge.nonce=="string"?ge.nonce:void 0})}}else ge==null&&F.d.M(ue)},Ns.preload=function(ue,ge){if(typeof ue=="string"&&typeof ge=="object"&&ge!==null&&typeof ge.as=="string"){var Te=ge.as,ce=f(Te,ge.crossOrigin);F.d.L(ue,Te,{crossOrigin:ce,integrity:typeof ge.integrity=="string"?ge.integrity:void 0,nonce:typeof ge.nonce=="string"?ge.nonce:void 0,type:typeof ge.type=="string"?ge.type:void 0,fetchPriority:typeof ge.fetchPriority=="string"?ge.fetchPriority:void 0,referrerPolicy:typeof ge.referrerPolicy=="string"?ge.referrerPolicy:void 0,imageSrcSet:typeof ge.imageSrcSet=="string"?ge.imageSrcSet:void 0,imageSizes:typeof ge.imageSizes=="string"?ge.imageSizes:void 0,media:typeof ge.media=="string"?ge.media:void 0})}},Ns.preloadModule=function(ue,ge){if(typeof ue=="string")if(ge){var Te=f(ge.as,ge.crossOrigin);F.d.m(ue,{as:typeof ge.as=="string"&&ge.as!=="script"?ge.as:void 0,crossOrigin:Te,integrity:typeof ge.integrity=="string"?ge.integrity:void 0})}else F.d.m(ue)},Ns.requestFormReset=function(ue){F.d.r(ue)},Ns.unstable_batchedUpdates=function(ue,ge){return ue(ge)},Ns.useFormState=function(ue,ge,Te){return L.H.useFormState(ue,ge,Te)},Ns.useFormStatus=function(){return L.H.useHostTransitionStatus()},Ns.version="19.2.3",Ns}var Y_;function Py(){if(Y_)return m_.exports;Y_=1;function R(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(R)}catch(B){console.error(B)}}return R(),m_.exports=wv(),m_.exports}var H_;function Tv(){if(H_)return pm;H_=1;var R=bv(),B=C_(),Y=Py();function F(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function U(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function ee(r){var s=r,d=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(d=s.return),r=s.return;while(r)}return s.tag===3?d:null}function L(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function f(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function ue(r){if(ee(r)!==r)throw Error(F(188))}function ge(r){var s=r.alternate;if(!s){if(s=ee(r),s===null)throw Error(F(188));return s!==r?null:r}for(var d=r,x=s;;){var M=d.return;if(M===null)break;var k=M.alternate;if(k===null){if(x=M.return,x!==null){d=x;continue}break}if(M.child===k.child){for(k=M.child;k;){if(k===d)return ue(M),r;if(k===x)return ue(M),s;k=k.sibling}throw Error(F(188))}if(d.return!==x.return)d=M,x=k;else{for(var X=!1,se=M.child;se;){if(se===d){X=!0,d=M,x=k;break}if(se===x){X=!0,x=M,d=k;break}se=se.sibling}if(!X){for(se=k.child;se;){if(se===d){X=!0,d=k,x=M;break}if(se===x){X=!0,x=k,d=M;break}se=se.sibling}if(!X)throw Error(F(189))}}if(d.alternate!==x)throw Error(F(190))}if(d.tag!==3)throw Error(F(188));return d.stateNode.current===d?r:s}function Te(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=Te(r),s!==null)return s;r=r.sibling}return null}var ce=Object.assign,Pe=Symbol.for("react.element"),Oe=Symbol.for("react.transitional.element"),Fe=Symbol.for("react.portal"),at=Symbol.for("react.fragment"),Ie=Symbol.for("react.strict_mode"),Et=Symbol.for("react.profiler"),vt=Symbol.for("react.consumer"),rt=Symbol.for("react.context"),At=Symbol.for("react.forward_ref"),Mt=Symbol.for("react.suspense"),Lt=Symbol.for("react.suspense_list"),_t=Symbol.for("react.memo"),Gt=Symbol.for("react.lazy"),Ft=Symbol.for("react.activity"),xn=Symbol.for("react.memo_cache_sentinel"),dn=Symbol.iterator;function sn(r){return r===null||typeof r!="object"?null:(r=dn&&r[dn]||r["@@iterator"],typeof r=="function"?r:null)}var En=Symbol.for("react.client.reference");function Rt(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===En?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case at:return"Fragment";case Et:return"Profiler";case Ie:return"StrictMode";case Mt:return"Suspense";case Lt:return"SuspenseList";case Ft:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Fe:return"Portal";case rt:return r.displayName||"Context";case vt:return(r._context.displayName||"Context")+".Consumer";case At:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case _t:return s=r.displayName||null,s!==null?s:Rt(r.type)||"Memo";case Gt:s=r._payload,r=r._init;try{return Rt(r(s))}catch{}}return null}var fn=Array.isArray,Je=B.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Tt=Y.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,$t={pending:!1,data:null,method:null,action:null},Ht=[],Pt=-1;function Re(r){return{current:r}}function lt(r){0>Pt||(r.current=Ht[Pt],Ht[Pt]=null,Pt--)}function zt(r,s){Pt++,Ht[Pt]=r.current,r.current=s}var Ct=Re(null),en=Re(null),Mn=Re(null),Rn=Re(null);function Ue(r,s){switch(zt(Mn,s),zt(en,r),zt(Ct,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?qf(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=qf(s),r=Ld(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}lt(Ct),zt(Ct,r)}function yi(){lt(Ct),lt(en),lt(Mn)}function Ln(r){r.memoizedState!==null&&zt(Rn,r);var s=Ct.current,d=Ld(s,r.type);s!==d&&(zt(en,r),zt(Ct,d))}function rn(r){en.current===r&&(lt(Ct),lt(en)),Rn.current===r&&(lt(Rn),$f._currentValue=$t)}var Se,oa;function vi(r){if(Se===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);Se=s&&s[1]||"",oa=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Se+r+oa}var er=!1;function Ma(r,s){if(!r||er)return"";er=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(s){var wt=function(){throw Error()};if(Object.defineProperty(wt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(wt,[])}catch(st){var nt=st}Reflect.construct(r,[],wt)}else{try{wt.call()}catch(st){nt=st}r.call(wt.prototype)}}else{try{throw Error()}catch(st){nt=st}(wt=r())&&typeof wt.catch=="function"&&wt.catch(function(){})}}catch(st){if(st&&nt&&typeof st.stack=="string")return[st.stack,nt.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var M=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");M&&M.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var k=x.DetermineComponentFrameRoot(),X=k[0],se=k[1];if(X&&se){var ke=X.split(`
`),tt=se.split(`
`);for(M=x=0;x<ke.length&&!ke[x].includes("DetermineComponentFrameRoot");)x++;for(;M<tt.length&&!tt[M].includes("DetermineComponentFrameRoot");)M++;if(x===ke.length||M===tt.length)for(x=ke.length-1,M=tt.length-1;1<=x&&0<=M&&ke[x]!==tt[M];)M--;for(;1<=x&&0<=M;x--,M--)if(ke[x]!==tt[M]){if(x!==1||M!==1)do if(x--,M--,0>M||ke[x]!==tt[M]){var ft=`
`+ke[x].replace(" at new "," at ");return r.displayName&&ft.includes("<anonymous>")&&(ft=ft.replace("<anonymous>",r.displayName)),ft}while(1<=x&&0<=M);break}}}finally{er=!1,Error.prepareStackTrace=d}return(d=r?r.displayName||r.name:"")?vi(d):""}function Ai(r,s){switch(r.tag){case 26:case 27:case 5:return vi(r.type);case 16:return vi("Lazy");case 13:return r.child!==s&&s!==null?vi("Suspense Fallback"):vi("Suspense");case 19:return vi("SuspenseList");case 0:case 15:return Ma(r.type,!1);case 11:return Ma(r.type.render,!1);case 1:return Ma(r.type,!0);case 31:return vi("Activity");default:return""}}function Vs(r){try{var s="",d=null;do s+=Ai(r,d),d=r,r=r.return;while(r);return s}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}var Dt=Object.prototype.hasOwnProperty,Us=R.unstable_scheduleCallback,rs=R.unstable_cancelCallback,zr=R.unstable_shouldYield,pl=R.unstable_requestPaint,ln=R.unstable_now,wr=R.unstable_getCurrentPriorityLevel,je=R.unstable_ImmediatePriority,te=R.unstable_UserBlockingPriority,J=R.unstable_NormalPriority,oe=R.unstable_LowPriority,ve=R.unstable_IdlePriority,xe=R.log,He=R.unstable_setDisableYieldValue,Ve=null,De=null;function Le(r){if(typeof xe=="function"&&He(r),De&&typeof De.setStrictMode=="function")try{De.setStrictMode(Ve,r)}catch{}}var ut=Math.clz32?Math.clz32:qt,ht=Math.log,Ut=Math.LN2;function qt(r){return r>>>=0,r===0?32:31-(ht(r)/Ut|0)|0}var pn=256,Dn=262144,Fn=4194304;function Ge(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Jn(r,s,d){var x=r.pendingLanes;if(x===0)return 0;var M=0,k=r.suspendedLanes,X=r.pingedLanes;r=r.warmLanes;var se=x&134217727;return se!==0?(x=se&~k,x!==0?M=Ge(x):(X&=se,X!==0?M=Ge(X):d||(d=se&~r,d!==0&&(M=Ge(d))))):(se=x&~k,se!==0?M=Ge(se):X!==0?M=Ge(X):d||(d=x&~r,d!==0&&(M=Ge(d)))),M===0?0:s!==0&&s!==M&&(s&k)===0&&(k=M&-M,d=s&-s,k>=d||k===32&&(d&4194048)!==0)?s:M}function qi(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function gn(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xt(){var r=Fn;return Fn<<=1,(Fn&62914560)===0&&(Fn=4194304),r}function Zi(r){for(var s=[],d=0;31>d;d++)s.push(r);return s}function Xn(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Ci(r,s,d,x,M,k){var X=r.pendingLanes;r.pendingLanes=d,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=d,r.entangledLanes&=d,r.errorRecoveryDisabledLanes&=d,r.shellSuspendCounter=0;var se=r.entanglements,ke=r.expirationTimes,tt=r.hiddenUpdates;for(d=X&~d;0<d;){var ft=31-ut(d),wt=1<<ft;se[ft]=0,ke[ft]=-1;var nt=tt[ft];if(nt!==null)for(tt[ft]=null,ft=0;ft<nt.length;ft++){var st=nt[ft];st!==null&&(st.lane&=-536870913)}d&=~wt}x!==0&&ni(r,x,0),k!==0&&M===0&&r.tag!==0&&(r.suspendedLanes|=k&~(X&~s))}function ni(r,s,d){r.pendingLanes|=s,r.suspendedLanes&=~s;var x=31-ut(s);r.entangledLanes|=s,r.entanglements[x]=r.entanglements[x]|1073741824|d&261930}function Ni(r,s){var d=r.entangledLanes|=s;for(r=r.entanglements;d;){var x=31-ut(d),M=1<<x;M&s|r[x]&s&&(r[x]|=s),d&=~M}}function Bo(r,s){var d=s&-s;return d=(d&42)!==0?1:Ca(d),(d&(r.suspendedLanes|s))!==0?0:d}function Ca(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function It(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function mr(){var r=Tt.p;return r!==0?r:(r=window.event,r===void 0?32:cg(r.type))}function Zr(r,s){var d=Tt.p;try{return Tt.p=r,s()}finally{Tt.p=d}}var Va=Math.random().toString(36).slice(2),li="__reactFiber$"+Va,St="__reactProps$"+Va,bn="__reactContainer$"+Va,Tn="__reactEvents$"+Va,gr="__reactListeners$"+Va,ws="__reactHandles$"+Va,Ua="__reactResources$"+Va,yn="__reactMarker$"+Va;function as(r){delete r[li],delete r[St],delete r[Tn],delete r[gr],delete r[ws]}function ui(r){var s=r[li];if(s)return s;for(var d=r.parentNode;d;){if(s=d[bn]||d[li]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(r=$c(r);r!==null;){if(d=r[li])return d;r=$c(r)}return s}r=d,d=r.parentNode}return null}function js(r){if(r=r[li]||r[bn]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function Ts(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(F(33))}function Ia(r){var s=r[Ua];return s||(s=r[Ua]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function xi(r){r[yn]=!0}var lo=new Set,Tr={};function Vn(r,s){Gs(r,s),Gs(r+"Capture",s)}function Gs(r,s){for(Tr[r]=s,r=0;r<s.length;r++)lo.add(s[r])}var Yr=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ss={},Ss={};function Hr(r){return Dt.call(Ss,r)?!0:Dt.call(ss,r)?!1:Yr.test(r)?Ss[r]=!0:(ss[r]=!0,!1)}function Fo(r,s,d){if(Hr(s))if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var x=s.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+d)}}function Es(r,s,d){if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+d)}}function ja(r,s,d,x){if(x===null)r.removeAttribute(d);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(d);return}r.setAttributeNS(s,d,""+x)}}function Yn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Du(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function mc(r,s,d){var x=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var M=x.get,k=x.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return M.call(this)},set:function(X){d=""+X,k.call(this,X)}}),Object.defineProperty(r,s,{enumerable:x.enumerable}),{getValue:function(){return d},setValue:function(X){d=""+X},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function Ms(r){if(!r._valueTracker){var s=Du(r)?"checked":"value";r._valueTracker=mc(r,s,""+r[s])}}function os(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var d=s.getValue(),x="";return r&&(x=Du(r)?r.checked?"true":"false":r.value),r=x,r!==d?(s.setValue(r),!0):!1}function Ga(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var gc=/[\n"\\]/g;function lr(r){return r.replace(gc,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function ql(r,s,d,x,M,k,X,se){r.name="",X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"?r.type=X:r.removeAttribute("type"),s!=null?X==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+Yn(s)):r.value!==""+Yn(s)&&(r.value=""+Yn(s)):X!=="submit"&&X!=="reset"||r.removeAttribute("value"),s!=null?Zl(r,X,Yn(s)):d!=null?Zl(r,X,Yn(d)):x!=null&&r.removeAttribute("value"),M==null&&k!=null&&(r.defaultChecked=!!k),M!=null&&(r.checked=M&&typeof M!="function"&&typeof M!="symbol"),se!=null&&typeof se!="function"&&typeof se!="symbol"&&typeof se!="boolean"?r.name=""+Yn(se):r.removeAttribute("name")}function Pu(r,s,d,x,M,k,X,se){if(k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(r.type=k),s!=null||d!=null){if(!(k!=="submit"&&k!=="reset"||s!=null)){Ms(r);return}d=d!=null?""+Yn(d):"",s=s!=null?""+Yn(s):d,se||s===r.value||(r.value=s),r.defaultValue=s}x=x??M,x=typeof x!="function"&&typeof x!="symbol"&&!!x,r.checked=se?r.checked:!!x,r.defaultChecked=!!x,X!=null&&typeof X!="function"&&typeof X!="symbol"&&typeof X!="boolean"&&(r.name=X),Ms(r)}function Zl(r,s,d){s==="number"&&Ga(r.ownerDocument)===r||r.defaultValue===""+d||(r.defaultValue=""+d)}function uo(r,s,d,x){if(r=r.options,s){s={};for(var M=0;M<d.length;M++)s["$"+d[M]]=!0;for(d=0;d<r.length;d++)M=s.hasOwnProperty("$"+r[d].value),r[d].selected!==M&&(r[d].selected=M),M&&x&&(r[d].defaultSelected=!0)}else{for(d=""+Yn(d),s=null,M=0;M<r.length;M++){if(r[M].value===d){r[M].selected=!0,x&&(r[M].defaultSelected=!0);return}s!==null||r[M].disabled||(s=r[M])}s!==null&&(s.selected=!0)}}function _c(r,s,d){if(s!=null&&(s=""+Yn(s),s!==r.value&&(r.value=s),d==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=d!=null?""+Yn(d):""}function Cs(r,s,d,x){if(s==null){if(x!=null){if(d!=null)throw Error(F(92));if(fn(x)){if(1<x.length)throw Error(F(93));x=x[0]}d=x}d==null&&(d=""),s=d}d=Yn(s),r.defaultValue=d,x=r.textContent,x===d&&x!==""&&x!==null&&(r.value=x),Ms(r)}function Is(r,s){if(s){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=s;return}}r.textContent=s}var ih=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function co(r,s,d){var x=s.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?x?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":x?r.setProperty(s,d):typeof d!="number"||d===0||ih.has(s)?s==="float"?r.cssFloat=d:r[s]=(""+d).trim():r[s]=d+"px"}function Ru(r,s,d){if(s!=null&&typeof s!="object")throw Error(F(62));if(r=r.style,d!=null){for(var x in d)!d.hasOwnProperty(x)||s!=null&&s.hasOwnProperty(x)||(x.indexOf("--")===0?r.setProperty(x,""):x==="float"?r.cssFloat="":r[x]="");for(var M in s)x=s[M],s.hasOwnProperty(M)&&d[M]!==x&&co(r,M,x)}else for(var k in s)s.hasOwnProperty(k)&&co(r,k,s[k])}function qs(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ei=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),qa=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function In(r){return qa.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Aa(){}var ga=null;function Xr(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var Yi=null,tr=null;function ki(r){var s=js(r);if(s&&(r=s.stateNode)){var d=r[St]||null;e:switch(r=s.stateNode,s.type){case"input":if(ql(r,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),s=d.name,d.type==="radio"&&s!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+lr(""+s)+'"][type="radio"]'),s=0;s<d.length;s++){var x=d[s];if(x!==r&&x.form===r.form){var M=x[St]||null;if(!M)throw Error(F(90));ql(x,M.value,M.defaultValue,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name)}}for(s=0;s<d.length;s++)x=d[s],x.form===r.form&&os(x)}break e;case"textarea":_c(r,d.value,d.defaultValue);break e;case"select":s=d.value,s!=null&&uo(r,!!d.multiple,s,!1)}}}var mn=!1;function Qn(r,s,d){if(mn)return r(s,d);mn=!0;try{var x=r(s);return x}finally{if(mn=!1,(Yi!==null||tr!==null)&&(Rf(),Yi&&(s=Yi,r=tr,tr=Yi=null,ki(s),r)))for(s=0;s<r.length;s++)ki(r[s])}}function Za(r,s){var d=r.stateNode;if(d===null)return null;var x=d[St]||null;if(x===null)return null;d=x[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(r=r.type,x=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!x;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(F(231,s,typeof d));return d}var Li=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),An=!1;if(Li)try{var ci={};Object.defineProperty(ci,"passive",{get:function(){An=!0}}),window.addEventListener("test",ci,ci),window.removeEventListener("test",ci,ci)}catch{An=!1}var la=null,ls=null,si=null;function Zs(){if(si)return si;var r,s=ls,d=s.length,x,M="value"in la?la.value:la.textContent,k=M.length;for(r=0;r<d&&s[r]===M[r];r++);var X=d-r;for(x=1;x<=X&&s[d-x]===M[k-x];x++);return si=M.slice(r,1<x?1-x:void 0)}function bi(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function ho(){return!0}function Or(){return!1}function nr(r){function s(d,x,M,k,X){this._reactName=d,this._targetInst=M,this.type=x,this.nativeEvent=k,this.target=X,this.currentTarget=null;for(var se in r)r.hasOwnProperty(se)&&(d=r[se],this[se]=d?d(k):k[se]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?ho:Or,this.isPropagationStopped=Or,this}return ce(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=ho)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=ho)},persist:function(){},isPersistent:ho}),s}var $r={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yl=nr($r),fo=ce({},$r,{view:0,detail:0}),ua=nr(fo),$n,po,vn,_n=ce({},fo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fr,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==vn&&(vn&&r.type==="mousemove"?($n=r.screenX-vn.screenX,po=r.screenY-vn.screenY):po=$n=0,vn=r),$n)},movementY:function(r){return"movementY"in r?r.movementY:po}}),Vo=nr(_n),Pn=ce({},_n,{dataTransfer:0}),ml=nr(Pn),Nr=ce({},fo,{relatedTarget:0}),mo=nr(Nr),Br=ce({},$r,{animationName:0,elapsedTime:0,pseudoElement:0}),yc=nr(Br),Hl=ce({},$r,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),vc=nr(Hl),af=ce({},$r,{data:0}),xc=nr(af),ca={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},As={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Di={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ka(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=Di[r])?!!s[r]:!1}function Fr(){return ka}var Xl=ce({},fo,{key:function(r){if(r.key){var s=ca[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=bi(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?As[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fr,charCode:function(r){return r.type==="keypress"?bi(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?bi(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),zi=nr(Xl),rh=ce({},_n,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),gl=nr(rh),bc=ce({},fo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fr}),wc=nr(bc),Uo=ce({},$r,{propertyName:0,elapsedTime:0,pseudoElement:0}),_a=nr(Uo),jo=ce({},_n,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),ha=nr(jo),Ys=ce({},$r,{newState:0,oldState:0}),_l=nr(Ys),Go=[9,13,27,32],Bi=Li&&"CompositionEvent"in window,qo=null;Li&&"documentMode"in document&&(qo=document.documentMode);var go=Li&&"TextEvent"in window&&!qo,yl=Li&&(!Bi||qo&&8<qo&&11>=qo),_o=" ",ah=!1;function $l(r,s){switch(r){case"keyup":return Go.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sh(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var us=!1;function Lu(r,s){switch(r){case"compositionend":return sh(s);case"keypress":return s.which!==32?null:(ah=!0,_o);case"textInput":return r=s.data,r===_o&&ah?null:r;default:return null}}function oh(r,s){if(us)return r==="compositionend"||!Bi&&$l(r,s)?(r=Zs(),si=ls=la=null,us=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return yl&&s.locale!=="ko"?null:s.data;default:return null}}var Tc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function zu(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Tc[r.type]:s==="textarea"}function Wl(r,s,d,x){Yi?tr?tr.push(x):tr=[x]:Yi=x,s=Vf(s,"onChange"),0<s.length&&(d=new Yl("onChange","change",null,d,x),r.push({event:d,listeners:s}))}var Zo=null,vl=null;function lh(r){Ym(r,0)}function Ql(r){var s=Ts(r);if(os(s))return r}function yo(r,s){if(r==="change")return s}var Sc=!1;if(Li){var Kl;if(Li){var Hs="oninput"in document;if(!Hs){var Ou=document.createElement("div");Ou.setAttribute("oninput","return;"),Hs=typeof Ou.oninput=="function"}Kl=Hs}else Kl=!1;Sc=Kl&&(!document.documentMode||9<document.documentMode)}function xl(){Zo&&(Zo.detachEvent("onpropertychange",uh),vl=Zo=null)}function uh(r){if(r.propertyName==="value"&&Ql(vl)){var s=[];Wl(s,vl,r,Xr(r)),Qn(lh,s)}}function ch(r,s,d){r==="focusin"?(xl(),Zo=s,vl=d,Zo.attachEvent("onpropertychange",uh)):r==="focusout"&&xl()}function Nu(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Ql(vl)}function Jl(r,s){if(r==="click")return Ql(s)}function Ec(r,s){if(r==="input"||r==="change")return Ql(s)}function Bu(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var ya=typeof Object.is=="function"?Object.is:Bu;function vo(r,s){if(ya(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var d=Object.keys(r),x=Object.keys(s);if(d.length!==x.length)return!1;for(x=0;x<d.length;x++){var M=d[x];if(!Dt.call(s,M)||!ya(r[M],s[M]))return!1}return!0}function Vr(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function eu(r,s){var d=Vr(r);r=0;for(var x;d;){if(d.nodeType===3){if(x=r+d.textContent.length,r<=s&&x>=s)return{node:d,offset:s-r};r=x}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Vr(d)}}function tu(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?tu(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function fa(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Ga(r.document);s instanceof r.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)r=s.contentWindow;else break;s=Ga(r.document)}return s}function va(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var _=Li&&"documentMode"in document&&11>=document.documentMode,o=null,u=null,g=null,E=!1;function P(r,s,d){var x=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;E||o==null||o!==Ga(x)||(x=o,"selectionStart"in x&&va(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),g&&vo(g,x)||(g=x,x=Vf(u,"onSelect"),0<x.length&&(s=new Yl("onSelect","select",null,s,d),r.push({event:s,listeners:x}),s.target=o)))}function V(r,s){var d={};return d[r.toLowerCase()]=s.toLowerCase(),d["Webkit"+r]="webkit"+s,d["Moz"+r]="moz"+s,d}var $={animationend:V("Animation","AnimationEnd"),animationiteration:V("Animation","AnimationIteration"),animationstart:V("Animation","AnimationStart"),transitionrun:V("Transition","TransitionRun"),transitionstart:V("Transition","TransitionStart"),transitioncancel:V("Transition","TransitionCancel"),transitionend:V("Transition","TransitionEnd")},re={},fe={};Li&&(fe=document.createElement("div").style,"AnimationEvent"in window||(delete $.animationend.animation,delete $.animationiteration.animation,delete $.animationstart.animation),"TransitionEvent"in window||delete $.transitionend.transition);function Be(r){if(re[r])return re[r];if(!$[r])return r;var s=$[r],d;for(d in s)if(s.hasOwnProperty(d)&&d in fe)return re[r]=s[d];return r}var Xe=Be("animationend"),bt=Be("animationiteration"),Zt=Be("animationstart"),Qt=Be("transitionrun"),un=Be("transitionstart"),zn=Be("transitioncancel"),Cn=Be("transitionend"),oi=new Map,ur="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ur.push("scrollEnd");function hi(r,s){oi.set(r,s),Vn(s,[r])}var Wr=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},_r=[],ks=0,xo=0;function bo(){for(var r=ks,s=xo=ks=0;s<r;){var d=_r[s];_r[s++]=null;var x=_r[s];_r[s++]=null;var M=_r[s];_r[s++]=null;var k=_r[s];if(_r[s++]=null,x!==null&&M!==null){var X=x.pending;X===null?M.next=M:(M.next=X.next,X.next=M),x.pending=M}k!==0&&nu(d,M,k)}}function bl(r,s,d,x){_r[ks++]=r,_r[ks++]=s,_r[ks++]=d,_r[ks++]=x,xo|=x,r.lanes|=x,r=r.alternate,r!==null&&(r.lanes|=x)}function Xs(r,s,d,x){return bl(r,s,d,x),wo(r)}function Da(r,s){return bl(r,null,null,s),wo(r)}function nu(r,s,d){r.lanes|=d;var x=r.alternate;x!==null&&(x.lanes|=d);for(var M=!1,k=r.return;k!==null;)k.childLanes|=d,x=k.alternate,x!==null&&(x.childLanes|=d),k.tag===22&&(r=k.stateNode,r===null||r._visibility&1||(M=!0)),r=k,k=k.return;return r.tag===3?(k=r.stateNode,M&&s!==null&&(M=31-ut(d),r=k.hiddenUpdates,x=r[M],x===null?r[M]=[s]:x.push(s),s.lane=d|536870912),k):null}function wo(r){if(50<Pf)throw Pf=0,Lp=null,Error(F(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var kn={};function hh(r,s,d,x){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cs(r,s,d,x){return new hh(r,s,d,x)}function fh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function hs(r,s){var d=r.alternate;return d===null?(d=cs(r.tag,s,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=s,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&65011712,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,s=r.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d.refCleanup=r.refCleanup,d}function sd(r,s){r.flags&=65011714;var d=r.alternate;return d===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=d.childLanes,r.lanes=d.lanes,r.child=d.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=d.memoizedProps,r.memoizedState=d.memoizedState,r.updateQueue=d.updateQueue,r.type=d.type,s=d.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function dh(r,s,d,x,M,k){var X=0;if(x=r,typeof r=="function")fh(r)&&(X=1);else if(typeof r=="string")X=Jp(r,d,Ct.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case Ft:return r=cs(31,d,s,M),r.elementType=Ft,r.lanes=k,r;case at:return wl(d.children,M,k,s);case Ie:X=8,M|=24;break;case Et:return r=cs(12,d,s,M|2),r.elementType=Et,r.lanes=k,r;case Mt:return r=cs(13,d,s,M),r.elementType=Mt,r.lanes=k,r;case Lt:return r=cs(19,d,s,M),r.elementType=Lt,r.lanes=k,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case rt:X=10;break e;case vt:X=9;break e;case At:X=11;break e;case _t:X=14;break e;case Gt:X=16,x=null;break e}X=29,d=Error(F(130,r===null?"null":typeof r,"")),x=null}return s=cs(X,d,s,M),s.elementType=r,s.type=x,s.lanes=k,s}function wl(r,s,d,x){return r=cs(7,r,x,s),r.lanes=d,r}function sf(r,s,d){return r=cs(6,r,null,s),r.lanes=d,r}function ph(r){var s=cs(18,null,null,0);return s.stateNode=r,s}function Tl(r,s,d){return s=cs(4,r.children!==null?r.children:[],r.key,s),s.lanes=d,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var Mc=new WeakMap;function Pa(r,s){if(typeof r=="object"&&r!==null){var d=Mc.get(r);return d!==void 0?d:(s={value:r,source:s,stack:Vs(s)},Mc.set(r,s),s)}return{value:r,source:s,stack:Vs(s)}}var Sl=[],El=0,iu=null,Ml=0,Qr=[],Kr=0,To=null,So=1,Ya="";function Yo(r,s){Sl[El++]=Ml,Sl[El++]=iu,iu=r,Ml=s}function of(r,s,d){Qr[Kr++]=So,Qr[Kr++]=Ya,Qr[Kr++]=To,To=r;var x=So;r=Ya;var M=32-ut(x)-1;x&=~(1<<M),d+=1;var k=32-ut(s)+M;if(30<k){var X=M-M%5;k=(x&(1<<X)-1).toString(32),x>>=X,M-=X,So=1<<32-ut(s)+M|d<<M|x,Ya=k+r}else So=1<<k|d<<M|x,Ya=r}function ru(r){r.return!==null&&(Yo(r,1),of(r,1,0))}function Fu(r){for(;r===iu;)iu=Sl[--El],Sl[El]=null,Ml=Sl[--El],Sl[El]=null;for(;r===To;)To=Qr[--Kr],Qr[Kr]=null,Ya=Qr[--Kr],Qr[Kr]=null,So=Qr[--Kr],Qr[Kr]=null}function lf(r,s){Qr[Kr++]=So,Qr[Kr++]=Ya,Qr[Kr++]=To,So=s.id,Ya=s.overflow,To=r}var Jr=null,wi=null,jn=!1,Ho=null,fs=!1,Hi=Error(F(519));function Ha(r){var s=Error(F(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Xo(Pa(s,r)),Hi}function ds(r){var s=r.stateNode,d=r.type,x=r.memoizedProps;switch(s[li]=r,s[St]=x,d){case"dialog":Wn("cancel",s),Wn("close",s);break;case"iframe":case"object":case"embed":Wn("load",s);break;case"video":case"audio":for(d=0;d<Bf.length;d++)Wn(Bf[d],s);break;case"source":Wn("error",s);break;case"img":case"image":case"link":Wn("error",s),Wn("load",s);break;case"details":Wn("toggle",s);break;case"input":Wn("invalid",s),Pu(s,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0);break;case"select":Wn("invalid",s);break;case"textarea":Wn("invalid",s),Cs(s,x.value,x.defaultValue,x.children)}d=x.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||s.textContent===""+d||x.suppressHydrationWarning===!0||Dd(s.textContent,d)?(x.popover!=null&&(Wn("beforetoggle",s),Wn("toggle",s)),x.onScroll!=null&&Wn("scroll",s),x.onScrollEnd!=null&&Wn("scrollend",s),x.onClick!=null&&(s.onclick=Aa),s=!0):s=!1,s||Ha(r,!0)}function Cc(r){for(Jr=r.return;Jr;)switch(Jr.tag){case 5:case 31:case 13:fs=!1;return;case 27:case 3:fs=!0;return;default:Jr=Jr.return}}function Eo(r){if(r!==Jr)return!1;if(!jn)return Cc(r),jn=!0,!1;var s=r.tag,d;if((d=s!==3&&s!==27)&&((d=s===5)&&(d=r.type,d=!(d!=="form"&&d!=="button")||Zf(r.type,r.memoizedProps)),d=!d),d&&wi&&Ha(r),Cc(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(F(317));wi=sc(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(F(317));wi=sc(r)}else s===27?(s=wi,ar(r.type)?(r=Bd,Bd=null,wi=r):wi=s):wi=Jr?Oo(r.stateNode.nextSibling):null;return!0}function Mo(){wi=Jr=null,jn=!1}function Co(){var r=Ho;return r!==null&&(zs===null?zs=r:zs.push.apply(zs,r),Ho=null),r}function Xo(r){Ho===null?Ho=[r]:Ho.push(r)}var $o=Re(null),Ds=null,Io=null;function Wo(r,s,d){zt($o,s._currentValue),s._currentValue=d}function Ao(r){r._currentValue=$o.current,lt($o)}function mh(r,s,d){for(;r!==null;){var x=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,x!==null&&(x.childLanes|=s)):x!==null&&(x.childLanes&s)!==s&&(x.childLanes|=s),r===d)break;r=r.return}}function gh(r,s,d,x){var M=r.child;for(M!==null&&(M.return=r);M!==null;){var k=M.dependencies;if(k!==null){var X=M.child;k=k.firstContext;e:for(;k!==null;){var se=k;k=M;for(var ke=0;ke<s.length;ke++)if(se.context===s[ke]){k.lanes|=d,se=k.alternate,se!==null&&(se.lanes|=d),mh(k.return,d,r),x||(X=null);break e}k=se.next}}else if(M.tag===18){if(X=M.return,X===null)throw Error(F(341));X.lanes|=d,k=X.alternate,k!==null&&(k.lanes|=d),mh(X,d,r),X=null}else X=M.child;if(X!==null)X.return=M;else for(X=M;X!==null;){if(X===r){X=null;break}if(M=X.sibling,M!==null){M.return=X.return,X=M;break}X=X.return}M=X}}function Ps(r,s,d,x){r=null;for(var M=s,k=!1;M!==null;){if(!k){if((M.flags&524288)!==0)k=!0;else if((M.flags&262144)!==0)break}if(M.tag===10){var X=M.alternate;if(X===null)throw Error(F(387));if(X=X.memoizedProps,X!==null){var se=M.type;ya(M.pendingProps.value,X.value)||(r!==null?r.push(se):r=[se])}}else if(M===Rn.current){if(X=M.alternate,X===null)throw Error(F(387));X.memoizedState.memoizedState!==M.memoizedState.memoizedState&&(r!==null?r.push($f):r=[$f])}M=M.return}r!==null&&gh(s,r,d,x),s.flags|=262144}function Vu(r){for(r=r.firstContext;r!==null;){if(!ya(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Qo(r){Ds=r,Io=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function yr(r){return _h(Ds,r)}function Ic(r,s){return Ds===null&&Qo(r),_h(r,s)}function _h(r,s){var d=s._currentValue;if(s={context:s,memoizedValue:d,next:null},Io===null){if(r===null)throw Error(F(308));Io=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Io=Io.next=s;return d}var uf=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(d,x){r.push(x)}};this.abort=function(){s.aborted=!0,r.forEach(function(d){return d()})}},od=R.unstable_scheduleCallback,cf=R.unstable_NormalPriority,Xi={$$typeof:rt,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Cl(){return{controller:new uf,data:new Map,refCount:0}}function xa(r){r.refCount--,r.refCount===0&&od(cf,function(){r.controller.abort()})}var Ra=null,yh=0,ba=0,Uu=null;function ju(r,s){if(Ra===null){var d=Ra=[];yh=0,ba=rc(),Uu={status:"pending",value:void 0,then:function(x){d.push(x)}}}return yh++,s.then(Gu,Gu),s}function Gu(){if(--yh===0&&Ra!==null){Uu!==null&&(Uu.status="fulfilled");var r=Ra;Ra=null,ba=0,Uu=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function Ac(r,s){var d=[],x={status:"pending",value:null,reason:null,then:function(M){d.push(M)}};return r.then(function(){x.status="fulfilled",x.value=s;for(var M=0;M<d.length;M++)(0,d[M])(s)},function(M){for(x.status="rejected",x.reason=M,M=0;M<d.length;M++)(0,d[M])(void 0)}),x}var Xa=Je.S;Je.S=function(r,s){kp=ln(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&ju(r,s),Xa!==null&&Xa(r,s)};var $s=Re(null);function kc(){var r=$s.current;return r!==null?r:ji.pooledCache}function Il(r,s){s===null?zt($s,$s.current):zt($s,s.pool)}function ko(){var r=kc();return r===null?null:{parent:Xi._currentValue,pool:r}}var Bt=Error(F(460)),Dc=Error(F(474)),Al=Error(F(542)),Pc={then:function(){}};function kl(r){return r=r.status,r==="fulfilled"||r==="rejected"}function qu(r,s,d){switch(d=r[d],d===void 0?r.push(s):d!==s&&(s.then(Aa,Aa),s=d),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,hf(r),r;default:if(typeof s.status=="string")s.then(Aa,Aa);else{if(r=ji,r!==null&&100<r.shellSuspendCounter)throw Error(F(482));r=s,r.status="pending",r.then(function(x){if(s.status==="pending"){var M=s;M.status="fulfilled",M.value=x}},function(x){if(s.status==="pending"){var M=s;M.status="rejected",M.reason=x}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,hf(r),r}throw au=s,Bt}}function ps(r){try{var s=r._init;return s(r._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(au=d,Bt):d}}var au=null;function vh(){if(au===null)throw Error(F(459));var r=au;return au=null,r}function hf(r){if(r===Bt||r===Al)throw Error(F(483))}var Rs=null,Rc=0;function Lc(r){var s=Rc;return Rc+=1,Rs===null&&(Rs=[]),qu(Rs,r,s)}function Dl(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function xh(r,s){throw s.$$typeof===Pe?Error(F(525)):(r=Object.prototype.toString.call(s),Error(F(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function zc(r){function s(qe,Ne){if(r){var et=qe.deletions;et===null?(qe.deletions=[Ne],qe.flags|=16):et.push(Ne)}}function d(qe,Ne){if(!r)return null;for(;Ne!==null;)s(qe,Ne),Ne=Ne.sibling;return null}function x(qe){for(var Ne=new Map;qe!==null;)qe.key!==null?Ne.set(qe.key,qe):Ne.set(qe.index,qe),qe=qe.sibling;return Ne}function M(qe,Ne){return qe=hs(qe,Ne),qe.index=0,qe.sibling=null,qe}function k(qe,Ne,et){return qe.index=et,r?(et=qe.alternate,et!==null?(et=et.index,et<Ne?(qe.flags|=67108866,Ne):et):(qe.flags|=67108866,Ne)):(qe.flags|=1048576,Ne)}function X(qe){return r&&qe.alternate===null&&(qe.flags|=67108866),qe}function se(qe,Ne,et,pt){return Ne===null||Ne.tag!==6?(Ne=sf(et,qe.mode,pt),Ne.return=qe,Ne):(Ne=M(Ne,et),Ne.return=qe,Ne)}function ke(qe,Ne,et,pt){var Jt=et.type;return Jt===at?ft(qe,Ne,et.props.children,pt,et.key):Ne!==null&&(Ne.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===Gt&&ps(Jt)===Ne.type)?(Ne=M(Ne,et.props),Dl(Ne,et),Ne.return=qe,Ne):(Ne=dh(et.type,et.key,et.props,null,qe.mode,pt),Dl(Ne,et),Ne.return=qe,Ne)}function tt(qe,Ne,et,pt){return Ne===null||Ne.tag!==4||Ne.stateNode.containerInfo!==et.containerInfo||Ne.stateNode.implementation!==et.implementation?(Ne=Tl(et,qe.mode,pt),Ne.return=qe,Ne):(Ne=M(Ne,et.children||[]),Ne.return=qe,Ne)}function ft(qe,Ne,et,pt,Jt){return Ne===null||Ne.tag!==7?(Ne=wl(et,qe.mode,pt,Jt),Ne.return=qe,Ne):(Ne=M(Ne,et),Ne.return=qe,Ne)}function wt(qe,Ne,et){if(typeof Ne=="string"&&Ne!==""||typeof Ne=="number"||typeof Ne=="bigint")return Ne=sf(""+Ne,qe.mode,et),Ne.return=qe,Ne;if(typeof Ne=="object"&&Ne!==null){switch(Ne.$$typeof){case Oe:return et=dh(Ne.type,Ne.key,Ne.props,null,qe.mode,et),Dl(et,Ne),et.return=qe,et;case Fe:return Ne=Tl(Ne,qe.mode,et),Ne.return=qe,Ne;case Gt:return Ne=ps(Ne),wt(qe,Ne,et)}if(fn(Ne)||sn(Ne))return Ne=wl(Ne,qe.mode,et,null),Ne.return=qe,Ne;if(typeof Ne.then=="function")return wt(qe,Lc(Ne),et);if(Ne.$$typeof===rt)return wt(qe,Ic(qe,Ne),et);xh(qe,Ne)}return null}function nt(qe,Ne,et,pt){var Jt=Ne!==null?Ne.key:null;if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return Jt!==null?null:se(qe,Ne,""+et,pt);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case Oe:return et.key===Jt?ke(qe,Ne,et,pt):null;case Fe:return et.key===Jt?tt(qe,Ne,et,pt):null;case Gt:return et=ps(et),nt(qe,Ne,et,pt)}if(fn(et)||sn(et))return Jt!==null?null:ft(qe,Ne,et,pt,null);if(typeof et.then=="function")return nt(qe,Ne,Lc(et),pt);if(et.$$typeof===rt)return nt(qe,Ne,Ic(qe,et),pt);xh(qe,et)}return null}function st(qe,Ne,et,pt,Jt){if(typeof pt=="string"&&pt!==""||typeof pt=="number"||typeof pt=="bigint")return qe=qe.get(et)||null,se(Ne,qe,""+pt,Jt);if(typeof pt=="object"&&pt!==null){switch(pt.$$typeof){case Oe:return qe=qe.get(pt.key===null?et:pt.key)||null,ke(Ne,qe,pt,Jt);case Fe:return qe=qe.get(pt.key===null?et:pt.key)||null,tt(Ne,qe,pt,Jt);case Gt:return pt=ps(pt),st(qe,Ne,et,pt,Jt)}if(fn(pt)||sn(pt))return qe=qe.get(et)||null,ft(Ne,qe,pt,Jt,null);if(typeof pt.then=="function")return st(qe,Ne,et,Lc(pt),Jt);if(pt.$$typeof===rt)return st(qe,Ne,et,Ic(Ne,pt),Jt);xh(Ne,pt)}return null}function tn(qe,Ne,et,pt){for(var Jt=null,ai=null,hn=Ne,Nn=Ne=0,Hn=null;hn!==null&&Nn<et.length;Nn++){hn.index>Nn?(Hn=hn,hn=null):Hn=hn.sibling;var gi=nt(qe,hn,et[Nn],pt);if(gi===null){hn===null&&(hn=Hn);break}r&&hn&&gi.alternate===null&&s(qe,hn),Ne=k(gi,Ne,Nn),ai===null?Jt=gi:ai.sibling=gi,ai=gi,hn=Hn}if(Nn===et.length)return d(qe,hn),jn&&Yo(qe,Nn),Jt;if(hn===null){for(;Nn<et.length;Nn++)hn=wt(qe,et[Nn],pt),hn!==null&&(Ne=k(hn,Ne,Nn),ai===null?Jt=hn:ai.sibling=hn,ai=hn);return jn&&Yo(qe,Nn),Jt}for(hn=x(hn);Nn<et.length;Nn++)Hn=st(hn,qe,Nn,et[Nn],pt),Hn!==null&&(r&&Hn.alternate!==null&&hn.delete(Hn.key===null?Nn:Hn.key),Ne=k(Hn,Ne,Nn),ai===null?Jt=Hn:ai.sibling=Hn,ai=Hn);return r&&hn.forEach(function(Mu){return s(qe,Mu)}),jn&&Yo(qe,Nn),Jt}function wn(qe,Ne,et,pt){if(et==null)throw Error(F(151));for(var Jt=null,ai=null,hn=Ne,Nn=Ne=0,Hn=null,gi=et.next();hn!==null&&!gi.done;Nn++,gi=et.next()){hn.index>Nn?(Hn=hn,hn=null):Hn=hn.sibling;var Mu=nt(qe,hn,gi.value,pt);if(Mu===null){hn===null&&(hn=Hn);break}r&&hn&&Mu.alternate===null&&s(qe,hn),Ne=k(Mu,Ne,Nn),ai===null?Jt=Mu:ai.sibling=Mu,ai=Mu,hn=Hn}if(gi.done)return d(qe,hn),jn&&Yo(qe,Nn),Jt;if(hn===null){for(;!gi.done;Nn++,gi=et.next())gi=wt(qe,gi.value,pt),gi!==null&&(Ne=k(gi,Ne,Nn),ai===null?Jt=gi:ai.sibling=gi,ai=gi);return jn&&Yo(qe,Nn),Jt}for(hn=x(hn);!gi.done;Nn++,gi=et.next())gi=st(hn,qe,Nn,gi.value,pt),gi!==null&&(r&&gi.alternate!==null&&hn.delete(gi.key===null?Nn:gi.key),Ne=k(gi,Ne,Nn),ai===null?Jt=gi:ai.sibling=gi,ai=gi);return r&&hn.forEach(function(pg){return s(qe,pg)}),jn&&Yo(qe,Nn),Jt}function Mi(qe,Ne,et,pt){if(typeof et=="object"&&et!==null&&et.type===at&&et.key===null&&(et=et.props.children),typeof et=="object"&&et!==null){switch(et.$$typeof){case Oe:e:{for(var Jt=et.key;Ne!==null;){if(Ne.key===Jt){if(Jt=et.type,Jt===at){if(Ne.tag===7){d(qe,Ne.sibling),pt=M(Ne,et.props.children),pt.return=qe,qe=pt;break e}}else if(Ne.elementType===Jt||typeof Jt=="object"&&Jt!==null&&Jt.$$typeof===Gt&&ps(Jt)===Ne.type){d(qe,Ne.sibling),pt=M(Ne,et.props),Dl(pt,et),pt.return=qe,qe=pt;break e}d(qe,Ne);break}else s(qe,Ne);Ne=Ne.sibling}et.type===at?(pt=wl(et.props.children,qe.mode,pt,et.key),pt.return=qe,qe=pt):(pt=dh(et.type,et.key,et.props,null,qe.mode,pt),Dl(pt,et),pt.return=qe,qe=pt)}return X(qe);case Fe:e:{for(Jt=et.key;Ne!==null;){if(Ne.key===Jt)if(Ne.tag===4&&Ne.stateNode.containerInfo===et.containerInfo&&Ne.stateNode.implementation===et.implementation){d(qe,Ne.sibling),pt=M(Ne,et.children||[]),pt.return=qe,qe=pt;break e}else{d(qe,Ne);break}else s(qe,Ne);Ne=Ne.sibling}pt=Tl(et,qe.mode,pt),pt.return=qe,qe=pt}return X(qe);case Gt:return et=ps(et),Mi(qe,Ne,et,pt)}if(fn(et))return tn(qe,Ne,et,pt);if(sn(et)){if(Jt=sn(et),typeof Jt!="function")throw Error(F(150));return et=Jt.call(et),wn(qe,Ne,et,pt)}if(typeof et.then=="function")return Mi(qe,Ne,Lc(et),pt);if(et.$$typeof===rt)return Mi(qe,Ne,Ic(qe,et),pt);xh(qe,et)}return typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint"?(et=""+et,Ne!==null&&Ne.tag===6?(d(qe,Ne.sibling),pt=M(Ne,et),pt.return=qe,qe=pt):(d(qe,Ne),pt=sf(et,qe.mode,pt),pt.return=qe,qe=pt),X(qe)):d(qe,Ne)}return function(qe,Ne,et,pt){try{Rc=0;var Jt=Mi(qe,Ne,et,pt);return Rs=null,Jt}catch(hn){if(hn===Bt||hn===Al)throw hn;var ai=cs(29,hn,null,qe.mode);return ai.lanes=pt,ai.return=qe,ai}finally{}}}var Do=zc(!0),bh=zc(!1),Ko=!1;function wh(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ws(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function qn(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function Jo(r,s,d){var x=r.updateQueue;if(x===null)return null;if(x=x.shared,(di&2)!==0){var M=x.pending;return M===null?s.next=s:(s.next=M.next,M.next=s),x.pending=s,s=wo(r),nu(r,null,d),s}return bl(r,x,s,d),wo(r)}function Pl(r,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194048)!==0)){var x=s.lanes;x&=r.pendingLanes,d|=x,s.lanes=d,Ni(r,d)}}function su(r,s){var d=r.updateQueue,x=r.alternate;if(x!==null&&(x=x.updateQueue,d===x)){var M=null,k=null;if(d=d.firstBaseUpdate,d!==null){do{var X={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};k===null?M=k=X:k=k.next=X,d=d.next}while(d!==null);k===null?M=k=s:k=k.next=s}else M=k=s;d={baseState:x.baseState,firstBaseUpdate:M,lastBaseUpdate:k,shared:x.shared,callbacks:x.callbacks},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=s:r.next=s,d.lastBaseUpdate=s}var Oc=!1;function ou(){if(Oc){var r=Uu;if(r!==null)throw r}}function Zu(r,s,d,x){Oc=!1;var M=r.updateQueue;Ko=!1;var k=M.firstBaseUpdate,X=M.lastBaseUpdate,se=M.shared.pending;if(se!==null){M.shared.pending=null;var ke=se,tt=ke.next;ke.next=null,X===null?k=tt:X.next=tt,X=ke;var ft=r.alternate;ft!==null&&(ft=ft.updateQueue,se=ft.lastBaseUpdate,se!==X&&(se===null?ft.firstBaseUpdate=tt:se.next=tt,ft.lastBaseUpdate=ke))}if(k!==null){var wt=M.baseState;X=0,ft=tt=ke=null,se=k;do{var nt=se.lane&-536870913,st=nt!==se.lane;if(st?(Gn&nt)===nt:(x&nt)===nt){nt!==0&&nt===ba&&(Oc=!0),ft!==null&&(ft=ft.next={lane:0,tag:se.tag,payload:se.payload,callback:null,next:null});e:{var tn=r,wn=se;nt=s;var Mi=d;switch(wn.tag){case 1:if(tn=wn.payload,typeof tn=="function"){wt=tn.call(Mi,wt,nt);break e}wt=tn;break e;case 3:tn.flags=tn.flags&-65537|128;case 0:if(tn=wn.payload,nt=typeof tn=="function"?tn.call(Mi,wt,nt):tn,nt==null)break e;wt=ce({},wt,nt);break e;case 2:Ko=!0}}nt=se.callback,nt!==null&&(r.flags|=64,st&&(r.flags|=8192),st=M.callbacks,st===null?M.callbacks=[nt]:st.push(nt))}else st={lane:nt,tag:se.tag,payload:se.payload,callback:se.callback,next:null},ft===null?(tt=ft=st,ke=wt):ft=ft.next=st,X|=nt;if(se=se.next,se===null){if(se=M.shared.pending,se===null)break;st=se,se=st.next,st.next=null,M.lastBaseUpdate=st,M.shared.pending=null}}while(!0);ft===null&&(ke=wt),M.baseState=ke,M.firstBaseUpdate=tt,M.lastBaseUpdate=ft,k===null&&(M.shared.lanes=0),Lo|=X,r.lanes=X,r.memoizedState=wt}}function Th(r,s){if(typeof r!="function")throw Error(F(191,r));r.call(s)}function ff(r,s){var d=r.callbacks;if(d!==null)for(r.callbacks=null,r=0;r<d.length;r++)Th(d[r],s)}var La=Re(null),lu=Re(0);function Kt(r,s){r=_u,zt(lu,r),zt(La,s),_u=r|s.baseLanes}function cn(){zt(lu,_u),zt(La,La.current)}function Rl(){_u=lu.current,lt(La),lt(lu)}var za=Re(null),ea=null;function cr(r){var s=r.alternate;zt(hr,hr.current&1),zt(za,r),ea===null&&(s===null||La.current!==null||s.memoizedState!==null)&&(ea=r)}function Oa(r){zt(hr,hr.current),zt(za,r),ea===null&&(ea=r)}function df(r){r.tag===22?(zt(hr,hr.current),zt(za,r),ea===null&&(ea=r)):Ll()}function Ll(){zt(hr,hr.current),zt(za,za.current)}function $a(r){lt(za),ea===r&&(ea=null),lt(hr)}var hr=Re(0);function el(r){for(var s=r;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||xs(d)||jr(d)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var ii=0,on=null,Ti=null,$i=null,uu=!1,ms=!1,tl=!1,Yu=0,nl=0,il=null,pf=0;function Wi(){throw Error(F(321))}function Qs(r,s){if(s===null)return!1;for(var d=0;d<s.length&&d<r.length;d++)if(!ya(r[d],s[d]))return!1;return!0}function Hu(r,s,d,x,M,k){return ii=k,on=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Je.H=r===null||r.memoizedState===null?Cr:Na,tl=!1,k=d(x,M),tl=!1,ms&&(k=Nc(s,d,x,M)),Xu(r),k}function Xu(r){Je.H=Ki;var s=Ti!==null&&Ti.next!==null;if(ii=0,$i=Ti=on=null,uu=!1,nl=0,il=null,s)throw Error(F(300));r===null||Ir||(r=r.dependencies,r!==null&&Vu(r)&&(Ir=!0))}function Nc(r,s,d,x){on=r;var M=0;do{if(ms&&(il=null),nl=0,ms=!1,25<=M)throw Error(F(301));if(M+=1,$i=Ti=null,r.updateQueue!=null){var k=r.updateQueue;k.lastEffect=null,k.events=null,k.stores=null,k.memoCache!=null&&(k.memoCache.index=0)}Je.H=Vi,k=s(d,x)}while(ms);return k}function Bc(){var r=Je.H,s=r.useState()[0];return s=typeof s.then=="function"?cu(s):s,r=r.useState()[0],(Ti!==null?Ti.memoizedState:null)!==r&&(on.flags|=1024),s}function Fc(){var r=Yu!==0;return Yu=0,r}function rl(r,s,d){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~d}function al(r){if(uu){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}uu=!1}ii=0,$i=Ti=on=null,ms=!1,nl=Yu=0,il=null}function da(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return $i===null?on.memoizedState=$i=r:$i=$i.next=r,$i}function Fi(){if(Ti===null){var r=on.alternate;r=r!==null?r.memoizedState:null}else r=Ti.next;var s=$i===null?on.memoizedState:$i.next;if(s!==null)$i=s,Ti=r;else{if(r===null)throw on.alternate===null?Error(F(467)):Error(F(310));Ti=r,r={memoizedState:Ti.memoizedState,baseState:Ti.baseState,baseQueue:Ti.baseQueue,queue:Ti.queue,next:null},$i===null?on.memoizedState=$i=r:$i=$i.next=r}return $i}function Po(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function cu(r){var s=nl;return nl+=1,il===null&&(il=[]),r=qu(il,r,s),s=on,($i===null?s.memoizedState:$i.next)===null&&(s=s.alternate,Je.H=s===null||s.memoizedState===null?Cr:Na),r}function $u(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return cu(r);if(r.$$typeof===rt)return yr(r)}throw Error(F(438,String(r)))}function Wu(r){var s=null,d=on.updateQueue;if(d!==null&&(s=d.memoCache),s==null){var x=on.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(s={data:x.data.map(function(M){return M.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),d===null&&(d=Po(),on.updateQueue=d),d.memoCache=s,d=s.data[s.index],d===void 0)for(d=s.data[s.index]=Array(r),x=0;x<r;x++)d[x]=xn;return s.index++,d}function Ks(r,s){return typeof s=="function"?s(r):s}function v(r){var s=Fi();return t(s,Ti,r)}function t(r,s,d){var x=r.queue;if(x===null)throw Error(F(311));x.lastRenderedReducer=d;var M=r.baseQueue,k=x.pending;if(k!==null){if(M!==null){var X=M.next;M.next=k.next,k.next=X}s.baseQueue=M=k,x.pending=null}if(k=r.baseState,M===null)r.memoizedState=k;else{s=M.next;var se=X=null,ke=null,tt=s,ft=!1;do{var wt=tt.lane&-536870913;if(wt!==tt.lane?(Gn&wt)===wt:(ii&wt)===wt){var nt=tt.revertLane;if(nt===0)ke!==null&&(ke=ke.next={lane:0,revertLane:0,gesture:null,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null}),wt===ba&&(ft=!0);else if((ii&nt)===nt){tt=tt.next,nt===ba&&(ft=!0);continue}else wt={lane:0,revertLane:tt.revertLane,gesture:null,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null},ke===null?(se=ke=wt,X=k):ke=ke.next=wt,on.lanes|=nt,Lo|=nt;wt=tt.action,tl&&d(k,wt),k=tt.hasEagerState?tt.eagerState:d(k,wt)}else nt={lane:wt,revertLane:tt.revertLane,gesture:tt.gesture,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null},ke===null?(se=ke=nt,X=k):ke=ke.next=nt,on.lanes|=wt,Lo|=wt;tt=tt.next}while(tt!==null&&tt!==s);if(ke===null?X=k:ke.next=se,!ya(k,r.memoizedState)&&(Ir=!0,ft&&(d=Uu,d!==null)))throw d;r.memoizedState=k,r.baseState=X,r.baseQueue=ke,x.lastRenderedState=k}return M===null&&(x.lanes=0),[r.memoizedState,x.dispatch]}function a(r){var s=Fi(),d=s.queue;if(d===null)throw Error(F(311));d.lastRenderedReducer=r;var x=d.dispatch,M=d.pending,k=s.memoizedState;if(M!==null){d.pending=null;var X=M=M.next;do k=r(k,X.action),X=X.next;while(X!==M);ya(k,s.memoizedState)||(Ir=!0),s.memoizedState=k,s.baseQueue===null&&(s.baseState=k),d.lastRenderedState=k}return[k,x]}function c(r,s,d){var x=on,M=Fi(),k=jn;if(k){if(d===void 0)throw Error(F(407));d=d()}else d=s();var X=!ya((Ti||M).memoizedState,d);if(X&&(M.memoizedState=d,Ir=!0),M=M.queue,Qe(T.bind(null,x,M,r),[r]),M.getSnapshot!==s||X||$i!==null&&$i.memoizedState.tag&1){if(x.flags|=2048,be(9,{destroy:void 0},b.bind(null,x,M,d,s),null),ji===null)throw Error(F(349));k||(ii&127)!==0||p(x,s,d)}return d}function p(r,s,d){r.flags|=16384,r={getSnapshot:s,value:d},s=on.updateQueue,s===null?(s=Po(),on.updateQueue=s,s.stores=[r]):(d=s.stores,d===null?s.stores=[r]:d.push(r))}function b(r,s,d,x){s.value=d,s.getSnapshot=x,C(s)&&A(r)}function T(r,s,d){return d(function(){C(s)&&A(r)})}function C(r){var s=r.getSnapshot;r=r.value;try{var d=s();return!ya(r,d)}catch{return!0}}function A(r){var s=Da(r,2);s!==null&&Os(s,r,2)}function z(r){var s=da();if(typeof r=="function"){var d=r;if(r=d(),tl){Le(!0);try{d()}finally{Le(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:r},s}function N(r,s,d,x){return r.baseState=d,t(r,Ti,typeof x=="function"?x:Ks)}function Z(r,s,d,x,M){if(Ur(r))throw Error(F(485));if(r=s.action,r!==null){var k={payload:M,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(X){k.listeners.push(X)}};Je.T!==null?d(!0):k.isTransition=!1,x(k),d=s.pending,d===null?(k.next=s.pending=k,q(s,k)):(k.next=d.next,s.pending=d.next=k)}}function q(r,s){var d=s.action,x=s.payload,M=r.state;if(s.isTransition){var k=Je.T,X={};Je.T=X;try{var se=d(M,x),ke=Je.S;ke!==null&&ke(X,se),Q(r,s,se)}catch(tt){he(r,s,tt)}finally{k!==null&&X.types!==null&&(k.types=X.types),Je.T=k}}else try{k=d(M,x),Q(r,s,k)}catch(tt){he(r,s,tt)}}function Q(r,s,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(x){ne(r,s,x)},function(x){return he(r,s,x)}):ne(r,s,d)}function ne(r,s,d){s.status="fulfilled",s.value=d,pe(s),r.state=d,s=r.pending,s!==null&&(d=s.next,d===s?r.pending=null:(d=d.next,s.next=d,q(r,d)))}function he(r,s,d){var x=r.pending;if(r.pending=null,x!==null){x=x.next;do s.status="rejected",s.reason=d,pe(s),s=s.next;while(s!==x)}r.action=null}function pe(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function de(r,s){return s}function me(r,s){if(jn){var d=ji.formState;if(d!==null){e:{var x=on;if(jn){if(wi){t:{for(var M=wi,k=fs;M.nodeType!==8;){if(!k){M=null;break t}if(M=Oo(M.nextSibling),M===null){M=null;break t}}k=M.data,M=k==="F!"||k==="F"?M:null}if(M){wi=Oo(M.nextSibling),x=M.data==="F!";break e}}Ha(x)}x=!1}x&&(s=d[0])}}return d=da(),d.memoizedState=d.baseState=s,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:de,lastRenderedState:s},d.queue=x,d=fu.bind(null,on,x),x.dispatch=d,x=z(!1),k=Mr.bind(null,on,!1,x.queue),x=da(),M={state:s,dispatch:null,action:r,pending:null},x.queue=M,d=Z.bind(null,on,M,k,d),M.dispatch=d,x.memoizedState=r,[s,d,!1]}function Ee(r){var s=Fi();return _e(s,Ti,r)}function _e(r,s,d){if(s=t(r,s,de)[0],r=v(Ks)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var x=cu(s)}catch(X){throw X===Bt?Al:X}else x=s;s=Fi();var M=s.queue,k=M.dispatch;return d!==s.memoizedState&&(on.flags|=2048,be(9,{destroy:void 0},Ce.bind(null,M,d),null)),[x,k,r]}function Ce(r,s){r.action=s}function Ae(r){var s=Fi(),d=Ti;if(d!==null)return _e(s,d,r);Fi(),s=s.memoizedState,d=Fi();var x=d.queue.dispatch;return d.memoizedState=r,[s,x,!1]}function be(r,s,d,x){return r={tag:r,create:d,deps:x,inst:s,next:null},s=on.updateQueue,s===null&&(s=Po(),on.updateQueue=s),d=s.lastEffect,d===null?s.lastEffect=r.next=r:(x=d.next,d.next=r,r.next=x,s.lastEffect=r),r}function ze(){return Fi().memoizedState}function $e(r,s,d,x){var M=da();on.flags|=r,M.memoizedState=be(1|s,{destroy:void 0},d,x===void 0?null:x)}function Ze(r,s,d,x){var M=Fi();x=x===void 0?null:x;var k=M.memoizedState.inst;Ti!==null&&x!==null&&Qs(x,Ti.memoizedState.deps)?M.memoizedState=be(s,k,d,x):(on.flags|=r,M.memoizedState=be(1|s,k,d,x))}function We(r,s){$e(8390656,8,r,s)}function Qe(r,s){Ze(2048,8,r,s)}function mt(r){on.flags|=4;var s=on.updateQueue;if(s===null)s=Po(),on.updateQueue=s,s.events=[r];else{var d=s.events;d===null?s.events=[r]:d.push(r)}}function kt(r){var s=Fi().memoizedState;return mt({ref:s,nextImpl:r}),function(){if((di&2)!==0)throw Error(F(440));return s.impl.apply(void 0,arguments)}}function dt(r,s){return Ze(4,2,r,s)}function Wt(r,s){return Ze(4,4,r,s)}function Sn(r,s){if(typeof s=="function"){r=r();var d=s(r);return function(){typeof d=="function"?d():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function ti(r,s,d){d=d!=null?d.concat([r]):null,Ze(4,4,Sn.bind(null,s,r),d)}function Si(){}function ri(r,s){var d=Fi();s=s===void 0?null:s;var x=d.memoizedState;return s!==null&&Qs(s,x[1])?x[0]:(d.memoizedState=[r,s],r)}function Oi(r,s){var d=Fi();s=s===void 0?null:s;var x=d.memoizedState;if(s!==null&&Qs(s,x[1]))return x[0];if(x=r(),tl){Le(!0);try{r()}finally{Le(!1)}}return d.memoizedState=[x,s],x}function fi(r,s,d){return d===void 0||(ii&1073741824)!==0&&(Gn&261930)===0?r.memoizedState=s:(r.memoizedState=d,r=Bh(),on.lanes|=r,Lo|=r,d)}function Sr(r,s,d,x){return ya(d,s)?d:La.current!==null?(r=fi(r,d,x),ya(r,s)||(Ir=!0),r):(ii&42)===0||(ii&1073741824)!==0&&(Gn&261930)===0?(Ir=!0,r.memoizedState=d):(r=Bh(),on.lanes|=r,Lo|=r,s)}function Pi(r,s,d,x,M){var k=Tt.p;Tt.p=k!==0&&8>k?k:8;var X=Je.T,se={};Je.T=se,Mr(r,!1,s,d);try{var ke=M(),tt=Je.S;if(tt!==null&&tt(se,ke),ke!==null&&typeof ke=="object"&&typeof ke.then=="function"){var ft=Ac(ke,x);Wa(r,s,ft,pi(r))}else Wa(r,s,x,pi(r))}catch(wt){Wa(r,s,{then:function(){},status:"rejected",reason:wt},pi())}finally{Tt.p=k,X!==null&&se.types!==null&&(X.types=se.types),Je.T=X}}function Er(){}function Qi(r,s,d,x){if(r.tag!==5)throw Error(F(476));var M=ir(r).queue;Pi(r,M,s,$t,d===null?Er:function(){return ta(r),d(x)})}function ir(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:$t,baseState:$t,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:$t},next:null};var d={};return s.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:d},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function ta(r){var s=ir(r);s.next===null&&(s=r.alternate.memoizedState),Wa(r,s.next.queue,{},pi())}function pa(){return yr($f)}function Js(){return Fi().memoizedState}function sl(){return Fi().memoizedState}function hu(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var d=pi();r=qn(d);var x=Jo(s,r,d);x!==null&&(Os(x,s,d),Pl(x,s,d)),s={cache:Cl()},r.payload=s;return}s=s.return}}function Sh(r,s,d){var x=pi();d={lane:x,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Ur(r)?na(s,d):(d=Xs(r,s,d,x),d!==null&&(Os(d,r,x),gs(d,s,x)))}function fu(r,s,d){var x=pi();Wa(r,s,d,x)}function Wa(r,s,d,x){var M={lane:x,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(Ur(r))na(s,M);else{var k=r.alternate;if(r.lanes===0&&(k===null||k.lanes===0)&&(k=s.lastRenderedReducer,k!==null))try{var X=s.lastRenderedState,se=k(X,d);if(M.hasEagerState=!0,M.eagerState=se,ya(se,X))return bl(r,s,M,0),ji===null&&bo(),!1}catch{}finally{}if(d=Xs(r,s,M,x),d!==null)return Os(d,r,x),gs(d,s,x),!0}return!1}function Mr(r,s,d,x){if(x={lane:2,revertLane:rc(),gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},Ur(r)){if(s)throw Error(F(479))}else s=Xs(r,d,x,2),s!==null&&Os(s,r,2)}function Ur(r){var s=r.alternate;return r===on||s!==null&&s===on}function na(r,s){ms=uu=!0;var d=r.pending;d===null?s.next=s:(s.next=d.next,d.next=s),r.pending=s}function gs(r,s,d){if((d&4194048)!==0){var x=s.lanes;x&=r.pendingLanes,d|=x,s.lanes=d,Ni(r,d)}}var Ki={readContext:yr,use:$u,useCallback:Wi,useContext:Wi,useEffect:Wi,useImperativeHandle:Wi,useLayoutEffect:Wi,useInsertionEffect:Wi,useMemo:Wi,useReducer:Wi,useRef:Wi,useState:Wi,useDebugValue:Wi,useDeferredValue:Wi,useTransition:Wi,useSyncExternalStore:Wi,useId:Wi,useHostTransitionStatus:Wi,useFormState:Wi,useActionState:Wi,useOptimistic:Wi,useMemoCache:Wi,useCacheRefresh:Wi};Ki.useEffectEvent=Wi;var Cr={readContext:yr,use:$u,useCallback:function(r,s){return da().memoizedState=[r,s===void 0?null:s],r},useContext:yr,useEffect:We,useImperativeHandle:function(r,s,d){d=d!=null?d.concat([r]):null,$e(4194308,4,Sn.bind(null,s,r),d)},useLayoutEffect:function(r,s){return $e(4194308,4,r,s)},useInsertionEffect:function(r,s){$e(4,2,r,s)},useMemo:function(r,s){var d=da();s=s===void 0?null:s;var x=r();if(tl){Le(!0);try{r()}finally{Le(!1)}}return d.memoizedState=[x,s],x},useReducer:function(r,s,d){var x=da();if(d!==void 0){var M=d(s);if(tl){Le(!0);try{d(s)}finally{Le(!1)}}}else M=s;return x.memoizedState=x.baseState=M,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:M},x.queue=r,r=r.dispatch=Sh.bind(null,on,r),[x.memoizedState,r]},useRef:function(r){var s=da();return r={current:r},s.memoizedState=r},useState:function(r){r=z(r);var s=r.queue,d=fu.bind(null,on,s);return s.dispatch=d,[r.memoizedState,d]},useDebugValue:Si,useDeferredValue:function(r,s){var d=da();return fi(d,r,s)},useTransition:function(){var r=z(!1);return r=Pi.bind(null,on,r.queue,!0,!1),da().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,d){var x=on,M=da();if(jn){if(d===void 0)throw Error(F(407));d=d()}else{if(d=s(),ji===null)throw Error(F(349));(Gn&127)!==0||p(x,s,d)}M.memoizedState=d;var k={value:d,getSnapshot:s};return M.queue=k,We(T.bind(null,x,k,r),[r]),x.flags|=2048,be(9,{destroy:void 0},b.bind(null,x,k,d,s),null),d},useId:function(){var r=da(),s=ji.identifierPrefix;if(jn){var d=Ya,x=So;d=(x&~(1<<32-ut(x)-1)).toString(32)+d,s="_"+s+"R_"+d,d=Yu++,0<d&&(s+="H"+d.toString(32)),s+="_"}else d=pf++,s="_"+s+"r_"+d.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:pa,useFormState:me,useActionState:me,useOptimistic:function(r){var s=da();s.memoizedState=s.baseState=r;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=d,s=Mr.bind(null,on,!0,d),d.dispatch=s,[r,s]},useMemoCache:Wu,useCacheRefresh:function(){return da().memoizedState=hu.bind(null,on)},useEffectEvent:function(r){var s=da(),d={impl:r};return s.memoizedState=d,function(){if((di&2)!==0)throw Error(F(440));return d.impl.apply(void 0,arguments)}}},Na={readContext:yr,use:$u,useCallback:ri,useContext:yr,useEffect:Qe,useImperativeHandle:ti,useInsertionEffect:dt,useLayoutEffect:Wt,useMemo:Oi,useReducer:v,useRef:ze,useState:function(){return v(Ks)},useDebugValue:Si,useDeferredValue:function(r,s){var d=Fi();return Sr(d,Ti.memoizedState,r,s)},useTransition:function(){var r=v(Ks)[0],s=Fi().memoizedState;return[typeof r=="boolean"?r:cu(r),s]},useSyncExternalStore:c,useId:Js,useHostTransitionStatus:pa,useFormState:Ee,useActionState:Ee,useOptimistic:function(r,s){var d=Fi();return N(d,Ti,r,s)},useMemoCache:Wu,useCacheRefresh:sl};Na.useEffectEvent=kt;var Vi={readContext:yr,use:$u,useCallback:ri,useContext:yr,useEffect:Qe,useImperativeHandle:ti,useInsertionEffect:dt,useLayoutEffect:Wt,useMemo:Oi,useReducer:a,useRef:ze,useState:function(){return a(Ks)},useDebugValue:Si,useDeferredValue:function(r,s){var d=Fi();return Ti===null?fi(d,r,s):Sr(d,Ti.memoizedState,r,s)},useTransition:function(){var r=a(Ks)[0],s=Fi().memoizedState;return[typeof r=="boolean"?r:cu(r),s]},useSyncExternalStore:c,useId:Js,useHostTransitionStatus:pa,useFormState:Ae,useActionState:Ae,useOptimistic:function(r,s){var d=Fi();return Ti!==null?N(d,Ti,r,s):(d.baseState=r,[r,d.queue.dispatch])},useMemoCache:Wu,useCacheRefresh:sl};Vi.useEffectEvent=kt;function mf(r,s,d,x){s=r.memoizedState,d=d(x,s),d=d==null?s:ce({},s,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var Eh={enqueueSetState:function(r,s,d){r=r._reactInternals;var x=pi(),M=qn(x);M.payload=s,d!=null&&(M.callback=d),s=Jo(r,M,x),s!==null&&(Os(s,r,x),Pl(s,r,x))},enqueueReplaceState:function(r,s,d){r=r._reactInternals;var x=pi(),M=qn(x);M.tag=1,M.payload=s,d!=null&&(M.callback=d),s=Jo(r,M,x),s!==null&&(Os(s,r,x),Pl(s,r,x))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var d=pi(),x=qn(d);x.tag=2,s!=null&&(x.callback=s),s=Jo(r,x,d),s!==null&&(Os(s,r,d),Pl(s,r,d))}};function Mh(r,s,d,x,M,k,X){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(x,k,X):s.prototype&&s.prototype.isPureReactComponent?!vo(d,x)||!vo(M,k):!0}function gf(r,s,d,x){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,x),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,x),s.state!==r&&Eh.enqueueReplaceState(s,s.state,null)}function _s(r,s){var d=s;if("ref"in s){d={};for(var x in s)x!=="ref"&&(d[x]=s[x])}if(r=r.defaultProps){d===s&&(d=ce({},d));for(var M in r)d[M]===void 0&&(d[M]=r[M])}return d}function zl(r){Wr(r)}function ol(r){console.error(r)}function _f(r){Wr(r)}function du(r,s){try{var d=r.onUncaughtError;d(s.value,{componentStack:s.stack})}catch(x){setTimeout(function(){throw x})}}function Ch(r,s,d){try{var x=r.onCaughtError;x(d.value,{componentStack:d.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(M){setTimeout(function(){throw M})}}function Ol(r,s,d){return d=qn(d),d.tag=3,d.payload={element:null},d.callback=function(){du(r,s)},d}function Ih(r){return r=qn(r),r.tag=3,r}function Ah(r,s,d,x){var M=d.type.getDerivedStateFromError;if(typeof M=="function"){var k=x.value;r.payload=function(){return M(k)},r.callback=function(){Ch(s,d,x)}}var X=d.stateNode;X!==null&&typeof X.componentDidCatch=="function"&&(r.callback=function(){Ch(s,d,x),typeof M!="function"&&(tc===null?tc=new Set([this]):tc.add(this));var se=x.stack;this.componentDidCatch(x.value,{componentStack:se!==null?se:""})})}function up(r,s,d,x,M){if(d.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(s=d.alternate,s!==null&&Ps(s,d,M,!0),d=za.current,d!==null){switch(d.tag){case 31:case 13:return ea===null?vu():d.alternate===null&&Dr===0&&(Dr=3),d.flags&=-257,d.flags|=65536,d.lanes=M,x===Pc?d.flags|=16384:(s=d.updateQueue,s===null?d.updateQueue=new Set([x]):s.add(x),zf(r,x,M)),!1;case 22:return d.flags|=65536,x===Pc?d.flags|=16384:(s=d.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([x])},d.updateQueue=s):(d=s.retryQueue,d===null?s.retryQueue=new Set([x]):d.add(x)),zf(r,x,M)),!1}throw Error(F(435,d.tag))}return zf(r,x,M),vu(),!1}if(jn)return s=za.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=M,x!==Hi&&(r=Error(F(422),{cause:x}),Xo(Pa(r,d)))):(x!==Hi&&(s=Error(F(423),{cause:x}),Xo(Pa(s,d))),r=r.current.alternate,r.flags|=65536,M&=-M,r.lanes|=M,x=Pa(x,d),M=Ol(r.stateNode,x,M),su(r,M),Dr!==4&&(Dr=2)),!1;var k=Error(F(520),{cause:x});if(k=Pa(k,d),Af===null?Af=[k]:Af.push(k),Dr!==4&&(Dr=2),s===null)return!0;x=Pa(x,d),d=s;do{switch(d.tag){case 3:return d.flags|=65536,r=M&-M,d.lanes|=r,r=Ol(d.stateNode,x,r),su(d,r),!1;case 1:if(s=d.type,k=d.stateNode,(d.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(tc===null||!tc.has(k))))return d.flags|=65536,M&=-M,d.lanes|=M,M=Ih(M),Ah(M,r,d,x),su(d,M),!1}d=d.return}while(d!==null);return!1}var cp=Error(F(461)),Ir=!1;function wa(r,s,d,x){s.child=r===null?bh(s,null,d,x):Do(s,r.child,d,x)}function hp(r,s,d,x,M){d=d.render;var k=s.ref;if("ref"in x){var X={};for(var se in x)se!=="ref"&&(X[se]=x[se])}else X=x;return Qo(s),x=Hu(r,s,d,X,k,M),se=Fc(),r!==null&&!Ir?(rl(r,s,M),vr(r,s,M)):(jn&&se&&ru(s),s.flags|=1,wa(r,s,x,M),s.child)}function Vc(r,s,d,x,M){if(r===null){var k=d.type;return typeof k=="function"&&!fh(k)&&k.defaultProps===void 0&&d.compare===null?(s.tag=15,s.type=k,bm(r,s,k,x,M)):(r=dh(d.type,null,x,s,s.mode,M),r.ref=s.ref,r.return=s,s.child=r)}if(k=r.child,!pd(r,M)){var X=k.memoizedProps;if(d=d.compare,d=d!==null?d:vo,d(X,x)&&r.ref===s.ref)return vr(r,s,M)}return s.flags|=1,r=hs(k,x),r.ref=s.ref,r.return=s,s.child=r}function bm(r,s,d,x,M){if(r!==null){var k=r.memoizedProps;if(vo(k,x)&&r.ref===s.ref)if(Ir=!1,s.pendingProps=x=k,pd(r,M))(r.flags&131072)!==0&&(Ir=!0);else return s.lanes=r.lanes,vr(r,s,M)}return fp(r,s,d,x,M)}function Uc(r,s,d,x){var M=x.children,k=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),x.mode==="hidden"){if((s.flags&128)!==0){if(k=k!==null?k.baseLanes|d:d,r!==null){for(x=s.child=r.child,M=0;x!==null;)M=M|x.lanes|x.childLanes,x=x.sibling;x=M&~k}else x=0,s.child=null;return yf(r,s,k,d,x)}if((d&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&Il(s,k!==null?k.cachePool:null),k!==null?Kt(s,k):cn(),df(s);else return x=s.lanes=536870912,yf(r,s,k!==null?k.baseLanes|d:d,d,x)}else k!==null?(Il(s,k.cachePool),Kt(s,k),Ll(),s.memoizedState=null):(r!==null&&Il(s,null),cn(),Ll());return wa(r,s,M,d),s.child}function Qu(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function yf(r,s,d,x,M){var k=kc();return k=k===null?null:{parent:Xi._currentValue,pool:k},s.memoizedState={baseLanes:d,cachePool:k},r!==null&&Il(s,null),cn(),df(s),r!==null&&Ps(r,s,x,!0),s.childLanes=M,null}function ld(r,s){return s=dd({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function wm(r,s,d){return Do(s,r.child,null,d),r=ld(s,s.pendingProps),r.flags|=2,$a(s),s.memoizedState=null,r}function Og(r,s,d){var x=s.pendingProps,M=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(jn){if(x.mode==="hidden")return r=ld(s,x),s.lanes=536870912,Qu(null,r);if(Oa(s),(r=wi)?(r=Xp(r,fs),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:To!==null?{id:So,overflow:Ya}:null,retryLane:536870912,hydrationErrors:null},d=ph(r),d.return=s,s.child=d,Jr=s,wi=null)):r=null,r===null)throw Ha(s);return s.lanes=536870912,null}return ld(s,x)}var k=r.memoizedState;if(k!==null){var X=k.dehydrated;if(Oa(s),M)if(s.flags&256)s.flags&=-257,s=wm(r,s,d);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(F(558));else if(Ir||Ps(r,s,d,!1),M=(d&r.childLanes)!==0,Ir||M){if(x=ji,x!==null&&(X=Bo(x,d),X!==0&&X!==k.retryLane))throw k.retryLane=X,Da(r,X),Os(x,r,X),cp;vu(),s=wm(r,s,d)}else r=k.treeContext,wi=Oo(X.nextSibling),Jr=s,jn=!0,Ho=null,fs=!1,r!==null&&lf(s,r),s=ld(s,x),s.flags|=4096;return s}return r=hs(r.child,{mode:x.mode,children:x.children}),r.ref=s.ref,s.child=r,r.return=s,r}function ud(r,s){var d=s.ref;if(d===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(F(284));(r===null||r.ref!==d)&&(s.flags|=4194816)}}function fp(r,s,d,x,M){return Qo(s),d=Hu(r,s,d,x,void 0,M),x=Fc(),r!==null&&!Ir?(rl(r,s,M),vr(r,s,M)):(jn&&x&&ru(s),s.flags|=1,wa(r,s,d,M),s.child)}function dp(r,s,d,x,M,k){return Qo(s),s.updateQueue=null,d=Nc(s,x,d,M),Xu(r),x=Fc(),r!==null&&!Ir?(rl(r,s,k),vr(r,s,k)):(jn&&x&&ru(s),s.flags|=1,wa(r,s,d,k),s.child)}function cd(r,s,d,x,M){if(Qo(s),s.stateNode===null){var k=kn,X=d.contextType;typeof X=="object"&&X!==null&&(k=yr(X)),k=new d(x,k),s.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,k.updater=Eh,s.stateNode=k,k._reactInternals=s,k=s.stateNode,k.props=x,k.state=s.memoizedState,k.refs={},wh(s),X=d.contextType,k.context=typeof X=="object"&&X!==null?yr(X):kn,k.state=s.memoizedState,X=d.getDerivedStateFromProps,typeof X=="function"&&(mf(s,d,X,x),k.state=s.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(X=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),X!==k.state&&Eh.enqueueReplaceState(k,k.state,null),Zu(s,x,k,M),ou(),k.state=s.memoizedState),typeof k.componentDidMount=="function"&&(s.flags|=4194308),x=!0}else if(r===null){k=s.stateNode;var se=s.memoizedProps,ke=_s(d,se);k.props=ke;var tt=k.context,ft=d.contextType;X=kn,typeof ft=="object"&&ft!==null&&(X=yr(ft));var wt=d.getDerivedStateFromProps;ft=typeof wt=="function"||typeof k.getSnapshotBeforeUpdate=="function",se=s.pendingProps!==se,ft||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(se||tt!==X)&&gf(s,k,x,X),Ko=!1;var nt=s.memoizedState;k.state=nt,Zu(s,x,k,M),ou(),tt=s.memoizedState,se||nt!==tt||Ko?(typeof wt=="function"&&(mf(s,d,wt,x),tt=s.memoizedState),(ke=Ko||Mh(s,d,ke,x,nt,tt,X))?(ft||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount()),typeof k.componentDidMount=="function"&&(s.flags|=4194308)):(typeof k.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=x,s.memoizedState=tt),k.props=x,k.state=tt,k.context=X,x=ke):(typeof k.componentDidMount=="function"&&(s.flags|=4194308),x=!1)}else{k=s.stateNode,Ws(r,s),X=s.memoizedProps,ft=_s(d,X),k.props=ft,wt=s.pendingProps,nt=k.context,tt=d.contextType,ke=kn,typeof tt=="object"&&tt!==null&&(ke=yr(tt)),se=d.getDerivedStateFromProps,(tt=typeof se=="function"||typeof k.getSnapshotBeforeUpdate=="function")||typeof k.UNSAFE_componentWillReceiveProps!="function"&&typeof k.componentWillReceiveProps!="function"||(X!==wt||nt!==ke)&&gf(s,k,x,ke),Ko=!1,nt=s.memoizedState,k.state=nt,Zu(s,x,k,M),ou();var st=s.memoizedState;X!==wt||nt!==st||Ko||r!==null&&r.dependencies!==null&&Vu(r.dependencies)?(typeof se=="function"&&(mf(s,d,se,x),st=s.memoizedState),(ft=Ko||Mh(s,d,ft,x,nt,st,ke)||r!==null&&r.dependencies!==null&&Vu(r.dependencies))?(tt||typeof k.UNSAFE_componentWillUpdate!="function"&&typeof k.componentWillUpdate!="function"||(typeof k.componentWillUpdate=="function"&&k.componentWillUpdate(x,st,ke),typeof k.UNSAFE_componentWillUpdate=="function"&&k.UNSAFE_componentWillUpdate(x,st,ke)),typeof k.componentDidUpdate=="function"&&(s.flags|=4),typeof k.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof k.componentDidUpdate!="function"||X===r.memoizedProps&&nt===r.memoizedState||(s.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||X===r.memoizedProps&&nt===r.memoizedState||(s.flags|=1024),s.memoizedProps=x,s.memoizedState=st),k.props=x,k.state=st,k.context=ke,x=ft):(typeof k.componentDidUpdate!="function"||X===r.memoizedProps&&nt===r.memoizedState||(s.flags|=4),typeof k.getSnapshotBeforeUpdate!="function"||X===r.memoizedProps&&nt===r.memoizedState||(s.flags|=1024),x=!1)}return k=x,ud(r,s),x=(s.flags&128)!==0,k||x?(k=s.stateNode,d=x&&typeof d.getDerivedStateFromError!="function"?null:k.render(),s.flags|=1,r!==null&&x?(s.child=Do(s,r.child,null,M),s.child=Do(s,null,d,M)):wa(r,s,d,M),s.memoizedState=k.state,r=s.child):r=vr(r,s,M),r}function pp(r,s,d,x){return Mo(),s.flags|=256,wa(r,s,d,x),s.child}var hd={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function mp(r){return{baseLanes:r,cachePool:ko()}}function gp(r,s,d){return r=r!==null?r.childLanes&~d:0,s&&(r|=io),r}function _p(r,s,d){var x=s.pendingProps,M=!1,k=(s.flags&128)!==0,X;if((X=k)||(X=r!==null&&r.memoizedState===null?!1:(hr.current&2)!==0),X&&(M=!0,s.flags&=-129),X=(s.flags&32)!==0,s.flags&=-33,r===null){if(jn){if(M?cr(s):Ll(),(r=wi)?(r=Xp(r,fs),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:To!==null?{id:So,overflow:Ya}:null,retryLane:536870912,hydrationErrors:null},d=ph(r),d.return=s,s.child=d,Jr=s,wi=null)):r=null,r===null)throw Ha(s);return jr(r)?s.lanes=32:s.lanes=536870912,null}var se=x.children;return x=x.fallback,M?(Ll(),M=s.mode,se=dd({mode:"hidden",children:se},M),x=wl(x,M,d,null),se.return=s,x.return=s,se.sibling=x,s.child=se,x=s.child,x.memoizedState=mp(d),x.childLanes=gp(r,X,d),s.memoizedState=hd,Qu(null,x)):(cr(s),fd(s,se))}var ke=r.memoizedState;if(ke!==null&&(se=ke.dehydrated,se!==null)){if(k)s.flags&256?(cr(s),s.flags&=-257,s=vf(r,s,d)):s.memoizedState!==null?(Ll(),s.child=r.child,s.flags|=128,s=null):(Ll(),se=x.fallback,M=s.mode,x=dd({mode:"visible",children:x.children},M),se=wl(se,M,d,null),se.flags|=2,x.return=s,se.return=s,x.sibling=se,s.child=x,Do(s,r.child,null,d),x=s.child,x.memoizedState=mp(d),x.childLanes=gp(r,X,d),s.memoizedState=hd,s=Qu(null,x));else if(cr(s),jr(se)){if(X=se.nextSibling&&se.nextSibling.dataset,X)var tt=X.dgst;X=tt,x=Error(F(419)),x.stack="",x.digest=X,Xo({value:x,source:null,stack:null}),s=vf(r,s,d)}else if(Ir||Ps(r,s,d,!1),X=(d&r.childLanes)!==0,Ir||X){if(X=ji,X!==null&&(x=Bo(X,d),x!==0&&x!==ke.retryLane))throw ke.retryLane=x,Da(r,x),Os(X,r,x),cp;xs(se)||vu(),s=vf(r,s,d)}else xs(se)?(s.flags|=192,s.child=r.child,s=null):(r=ke.treeContext,wi=Oo(se.nextSibling),Jr=s,jn=!0,Ho=null,fs=!1,r!==null&&lf(s,r),s=fd(s,x.children),s.flags|=4096);return s}return M?(Ll(),se=x.fallback,M=s.mode,ke=r.child,tt=ke.sibling,x=hs(ke,{mode:"hidden",children:x.children}),x.subtreeFlags=ke.subtreeFlags&65011712,tt!==null?se=hs(tt,se):(se=wl(se,M,d,null),se.flags|=2),se.return=s,x.return=s,x.sibling=se,s.child=x,Qu(null,x),x=s.child,se=r.child.memoizedState,se===null?se=mp(d):(M=se.cachePool,M!==null?(ke=Xi._currentValue,M=M.parent!==ke?{parent:ke,pool:ke}:M):M=ko(),se={baseLanes:se.baseLanes|d,cachePool:M}),x.memoizedState=se,x.childLanes=gp(r,X,d),s.memoizedState=hd,Qu(r.child,x)):(cr(s),d=r.child,r=d.sibling,d=hs(d,{mode:"visible",children:x.children}),d.return=s,d.sibling=null,r!==null&&(X=s.deletions,X===null?(s.deletions=[r],s.flags|=16):X.push(r)),s.child=d,s.memoizedState=null,d)}function fd(r,s){return s=dd({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function dd(r,s){return r=cs(22,r,null,s),r.lanes=0,r}function vf(r,s,d){return Do(s,r.child,null,d),r=fd(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function yp(r,s,d){r.lanes|=s;var x=r.alternate;x!==null&&(x.lanes|=s),mh(r.return,s,d)}function xf(r,s,d,x,M,k){var X=r.memoizedState;X===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:x,tail:d,tailMode:M,treeForkCount:k}:(X.isBackwards=s,X.rendering=null,X.renderingStartTime=0,X.last=x,X.tail=d,X.tailMode=M,X.treeForkCount=k)}function kh(r,s,d){var x=s.pendingProps,M=x.revealOrder,k=x.tail;x=x.children;var X=hr.current,se=(X&2)!==0;if(se?(X=X&1|2,s.flags|=128):X&=1,zt(hr,X),wa(r,s,x,d),x=jn?Ml:0,!se&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&yp(r,d,s);else if(r.tag===19)yp(r,d,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(M){case"forwards":for(d=s.child,M=null;d!==null;)r=d.alternate,r!==null&&el(r)===null&&(M=d),d=d.sibling;d=M,d===null?(M=s.child,s.child=null):(M=d.sibling,d.sibling=null),xf(s,!1,M,d,k,x);break;case"backwards":case"unstable_legacy-backwards":for(d=null,M=s.child,s.child=null;M!==null;){if(r=M.alternate,r!==null&&el(r)===null){s.child=M;break}r=M.sibling,M.sibling=d,d=M,M=r}xf(s,!0,d,null,k,x);break;case"together":xf(s,!1,null,null,void 0,x);break;default:s.memoizedState=null}return s.child}function vr(r,s,d){if(r!==null&&(s.dependencies=r.dependencies),Lo|=s.lanes,(d&s.childLanes)===0)if(r!==null){if(Ps(r,s,d,!1),(d&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(F(153));if(s.child!==null){for(r=s.child,d=hs(r,r.pendingProps),s.child=d,d.return=s;r.sibling!==null;)r=r.sibling,d=d.sibling=hs(r,r.pendingProps),d.return=s;d.sibling=null}return s.child}function pd(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&Vu(r)))}function vp(r,s,d){switch(s.tag){case 3:Ue(s,s.stateNode.containerInfo),Wo(s,Xi,r.memoizedState.cache),Mo();break;case 27:case 5:Ln(s);break;case 4:Ue(s,s.stateNode.containerInfo);break;case 10:Wo(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Oa(s),null;break;case 13:var x=s.memoizedState;if(x!==null)return x.dehydrated!==null?(cr(s),s.flags|=128,null):(d&s.child.childLanes)!==0?_p(r,s,d):(cr(s),r=vr(r,s,d),r!==null?r.sibling:null);cr(s);break;case 19:var M=(r.flags&128)!==0;if(x=(d&s.childLanes)!==0,x||(Ps(r,s,d,!1),x=(d&s.childLanes)!==0),M){if(x)return kh(r,s,d);s.flags|=128}if(M=s.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),zt(hr,hr.current),x)break;return null;case 22:return s.lanes=0,Uc(r,s,d,s.pendingProps);case 24:Wo(s,Xi,r.memoizedState.cache)}return vr(r,s,d)}function Tm(r,s,d){if(r!==null)if(r.memoizedProps!==s.pendingProps)Ir=!0;else{if(!pd(r,d)&&(s.flags&128)===0)return Ir=!1,vp(r,s,d);Ir=(r.flags&131072)!==0}else Ir=!1,jn&&(s.flags&1048576)!==0&&of(s,Ml,s.index);switch(s.lanes=0,s.tag){case 16:e:{var x=s.pendingProps;if(r=ps(s.elementType),s.type=r,typeof r=="function")fh(r)?(x=_s(r,x),s.tag=1,s=cd(null,s,r,x,d)):(s.tag=0,s=fp(null,s,r,x,d));else{if(r!=null){var M=r.$$typeof;if(M===At){s.tag=11,s=hp(null,s,r,x,d);break e}else if(M===_t){s.tag=14,s=Vc(null,s,r,x,d);break e}}throw s=Rt(r)||r,Error(F(306,s,""))}}return s;case 0:return fp(r,s,s.type,s.pendingProps,d);case 1:return x=s.type,M=_s(x,s.pendingProps),cd(r,s,x,M,d);case 3:e:{if(Ue(s,s.stateNode.containerInfo),r===null)throw Error(F(387));x=s.pendingProps;var k=s.memoizedState;M=k.element,Ws(r,s),Zu(s,x,null,d);var X=s.memoizedState;if(x=X.cache,Wo(s,Xi,x),x!==k.cache&&gh(s,[Xi],d,!0),ou(),x=X.element,k.isDehydrated)if(k={element:x,isDehydrated:!1,cache:X.cache},s.updateQueue.baseState=k,s.memoizedState=k,s.flags&256){s=pp(r,s,x,d);break e}else if(x!==M){M=Pa(Error(F(424)),s),Xo(M),s=pp(r,s,x,d);break e}else{switch(r=s.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(wi=Oo(r.firstChild),Jr=s,jn=!0,Ho=null,fs=!0,d=bh(s,null,x,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(Mo(),x===M){s=vr(r,s,d);break e}wa(r,s,x,d)}s=s.child}return s;case 26:return ud(r,s),r===null?(d=Vd(s.type,null,s.pendingProps,null))?s.memoizedState=d:jn||(d=s.type,r=s.pendingProps,x=bu(Mn.current).createElement(d),x[li]=s,x[St]=r,Rr(x,d,r),xi(x),s.stateNode=x):s.memoizedState=Vd(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return Ln(s),r===null&&jn&&(x=s.stateNode=Km(s.type,s.pendingProps,Mn.current),Jr=s,fs=!0,M=wi,ar(s.type)?(Bd=M,wi=Oo(x.firstChild)):wi=M),wa(r,s,s.pendingProps.children,d),ud(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&jn&&((M=x=wi)&&(x=ia(x,s.type,s.pendingProps,fs),x!==null?(s.stateNode=x,Jr=s,wi=Oo(x.firstChild),fs=!1,M=!0):M=!1),M||Ha(s)),Ln(s),M=s.type,k=s.pendingProps,X=r!==null?r.memoizedProps:null,x=k.children,Zf(M,k)?x=null:X!==null&&Zf(M,X)&&(s.flags|=32),s.memoizedState!==null&&(M=Hu(r,s,Bc,null,null,d),$f._currentValue=M),ud(r,s),wa(r,s,x,d),s.child;case 6:return r===null&&jn&&((r=d=wi)&&(d=ra(d,s.pendingProps,fs),d!==null?(s.stateNode=d,Jr=s,wi=null,r=!0):r=!1),r||Ha(s)),null;case 13:return _p(r,s,d);case 4:return Ue(s,s.stateNode.containerInfo),x=s.pendingProps,r===null?s.child=Do(s,null,x,d):wa(r,s,x,d),s.child;case 11:return hp(r,s,s.type,s.pendingProps,d);case 7:return wa(r,s,s.pendingProps,d),s.child;case 8:return wa(r,s,s.pendingProps.children,d),s.child;case 12:return wa(r,s,s.pendingProps.children,d),s.child;case 10:return x=s.pendingProps,Wo(s,s.type,x.value),wa(r,s,x.children,d),s.child;case 9:return M=s.type._context,x=s.pendingProps.children,Qo(s),M=yr(M),x=x(M),s.flags|=1,wa(r,s,x,d),s.child;case 14:return Vc(r,s,s.type,s.pendingProps,d);case 15:return bm(r,s,s.type,s.pendingProps,d);case 19:return kh(r,s,d);case 31:return Og(r,s,d);case 22:return Uc(r,s,d,s.pendingProps);case 24:return Qo(s),x=yr(Xi),r===null?(M=kc(),M===null&&(M=ji,k=Cl(),M.pooledCache=k,k.refCount++,k!==null&&(M.pooledCacheLanes|=d),M=k),s.memoizedState={parent:x,cache:M},wh(s),Wo(s,Xi,M)):((r.lanes&d)!==0&&(Ws(r,s),Zu(s,null,null,d),ou()),M=r.memoizedState,k=s.memoizedState,M.parent!==x?(M={parent:x,cache:x},s.memoizedState=M,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=M),Wo(s,Xi,x)):(x=k.cache,Wo(s,Xi,x),x!==M.cache&&gh(s,[Xi],d,!0))),wa(r,s,s.pendingProps.children,d),s.child;case 29:throw s.pendingProps}throw Error(F(156,s.tag))}function Nl(r){r.flags|=4}function xp(r,s,d,x,M){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(M&335544128)===M)if(r.stateNode.complete)r.flags|=8192;else if(Op())r.flags|=8192;else throw au=Pc,Dc}else r.flags&=-16777217}function Sm(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!em(s))if(Op())r.flags|=8192;else throw au=Pc,Dc}function bf(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?xt():536870912,r.lanes|=s,Oh|=s)}function wf(r,s){if(!jn)switch(r.tailMode){case"hidden":s=r.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var x=null;d!==null;)d.alternate!==null&&(x=d),d=d.sibling;x===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:x.sibling=null}}function Ui(r){var s=r.alternate!==null&&r.alternate.child===r.child,d=0,x=0;if(s)for(var M=r.child;M!==null;)d|=M.lanes|M.childLanes,x|=M.subtreeFlags&65011712,x|=M.flags&65011712,M.return=r,M=M.sibling;else for(M=r.child;M!==null;)d|=M.lanes|M.childLanes,x|=M.subtreeFlags,x|=M.flags,M.return=r,M=M.sibling;return r.subtreeFlags|=x,r.childLanes=d,s}function Em(r,s,d){var x=s.pendingProps;switch(Fu(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ui(s),null;case 1:return Ui(s),null;case 3:return d=s.stateNode,x=null,r!==null&&(x=r.memoizedState.cache),s.memoizedState.cache!==x&&(s.flags|=2048),Ao(Xi),yi(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(Eo(s)?Nl(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,Co())),Ui(s),null;case 26:var M=s.type,k=s.memoizedState;return r===null?(Nl(s),k!==null?(Ui(s),Sm(s,k)):(Ui(s),xp(s,M,null,x,d))):k?k!==r.memoizedState?(Nl(s),Ui(s),Sm(s,k)):(Ui(s),s.flags&=-16777217):(r=r.memoizedProps,r!==x&&Nl(s),Ui(s),xp(s,M,r,x,d)),null;case 27:if(rn(s),d=Mn.current,M=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==x&&Nl(s);else{if(!x){if(s.stateNode===null)throw Error(F(166));return Ui(s),null}r=Ct.current,Eo(s)?ds(s):(r=Km(M,x,d),s.stateNode=r,Nl(s))}return Ui(s),null;case 5:if(rn(s),M=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==x&&Nl(s);else{if(!x){if(s.stateNode===null)throw Error(F(166));return Ui(s),null}if(k=Ct.current,Eo(s))ds(s);else{var X=bu(Mn.current);switch(k){case 1:k=X.createElementNS("http://www.w3.org/2000/svg",M);break;case 2:k=X.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;default:switch(M){case"svg":k=X.createElementNS("http://www.w3.org/2000/svg",M);break;case"math":k=X.createElementNS("http://www.w3.org/1998/Math/MathML",M);break;case"script":k=X.createElement("div"),k.innerHTML="<script><\/script>",k=k.removeChild(k.firstChild);break;case"select":k=typeof x.is=="string"?X.createElement("select",{is:x.is}):X.createElement("select"),x.multiple?k.multiple=!0:x.size&&(k.size=x.size);break;default:k=typeof x.is=="string"?X.createElement(M,{is:x.is}):X.createElement(M)}}k[li]=s,k[St]=x;e:for(X=s.child;X!==null;){if(X.tag===5||X.tag===6)k.appendChild(X.stateNode);else if(X.tag!==4&&X.tag!==27&&X.child!==null){X.child.return=X,X=X.child;continue}if(X===s)break e;for(;X.sibling===null;){if(X.return===null||X.return===s)break e;X=X.return}X.sibling.return=X.return,X=X.sibling}s.stateNode=k;e:switch(Rr(k,M,x),M){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}x&&Nl(s)}}return Ui(s),xp(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,d),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==x&&Nl(s);else{if(typeof x!="string"&&s.stateNode===null)throw Error(F(166));if(r=Mn.current,Eo(s)){if(r=s.stateNode,d=s.memoizedProps,x=null,M=Jr,M!==null)switch(M.tag){case 27:case 5:x=M.memoizedProps}r[li]=s,r=!!(r.nodeValue===d||x!==null&&x.suppressHydrationWarning===!0||Dd(r.nodeValue,d)),r||Ha(s,!0)}else r=bu(r).createTextNode(x),r[li]=s,s.stateNode=r}return Ui(s),null;case 31:if(d=s.memoizedState,r===null||r.memoizedState!==null){if(x=Eo(s),d!==null){if(r===null){if(!x)throw Error(F(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(F(557));r[li]=s}else Mo(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ui(s),r=!1}else d=Co(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=d),r=!0;if(!r)return s.flags&256?($a(s),s):($a(s),null);if((s.flags&128)!==0)throw Error(F(558))}return Ui(s),null;case 13:if(x=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(M=Eo(s),x!==null&&x.dehydrated!==null){if(r===null){if(!M)throw Error(F(318));if(M=s.memoizedState,M=M!==null?M.dehydrated:null,!M)throw Error(F(317));M[li]=s}else Mo(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;Ui(s),M=!1}else M=Co(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=M),M=!0;if(!M)return s.flags&256?($a(s),s):($a(s),null)}return $a(s),(s.flags&128)!==0?(s.lanes=d,s):(d=x!==null,r=r!==null&&r.memoizedState!==null,d&&(x=s.child,M=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(M=x.alternate.memoizedState.cachePool.pool),k=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(k=x.memoizedState.cachePool.pool),k!==M&&(x.flags|=2048)),d!==r&&d&&(s.child.flags|=8192),bf(s,s.updateQueue),Ui(s),null);case 4:return yi(),r===null&&Ad(s.stateNode.containerInfo),Ui(s),null;case 10:return Ao(s.type),Ui(s),null;case 19:if(lt(hr),x=s.memoizedState,x===null)return Ui(s),null;if(M=(s.flags&128)!==0,k=x.rendering,k===null)if(M)wf(x,!1);else{if(Dr!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(k=el(r),k!==null){for(s.flags|=128,wf(x,!1),r=k.updateQueue,s.updateQueue=r,bf(s,r),s.subtreeFlags=0,r=d,d=s.child;d!==null;)sd(d,r),d=d.sibling;return zt(hr,hr.current&1|2),jn&&Yo(s,x.treeForkCount),s.child}r=r.sibling}x.tail!==null&&ln()>kf&&(s.flags|=128,M=!0,wf(x,!1),s.lanes=4194304)}else{if(!M)if(r=el(k),r!==null){if(s.flags|=128,M=!0,r=r.updateQueue,s.updateQueue=r,bf(s,r),wf(x,!0),x.tail===null&&x.tailMode==="hidden"&&!k.alternate&&!jn)return Ui(s),null}else 2*ln()-x.renderingStartTime>kf&&d!==536870912&&(s.flags|=128,M=!0,wf(x,!1),s.lanes=4194304);x.isBackwards?(k.sibling=s.child,s.child=k):(r=x.last,r!==null?r.sibling=k:s.child=k,x.last=k)}return x.tail!==null?(r=x.tail,x.rendering=r,x.tail=r.sibling,x.renderingStartTime=ln(),r.sibling=null,d=hr.current,zt(hr,M?d&1|2:d&1),jn&&Yo(s,x.treeForkCount),r):(Ui(s),null);case 22:case 23:return $a(s),Rl(),x=s.memoizedState!==null,r!==null?r.memoizedState!==null!==x&&(s.flags|=8192):x&&(s.flags|=8192),x?(d&536870912)!==0&&(s.flags&128)===0&&(Ui(s),s.subtreeFlags&6&&(s.flags|=8192)):Ui(s),d=s.updateQueue,d!==null&&bf(s,d.retryQueue),d=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),x=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(x=s.memoizedState.cachePool.pool),x!==d&&(s.flags|=2048),r!==null&&lt($s),null;case 24:return d=null,r!==null&&(d=r.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Ao(Xi),Ui(s),null;case 25:return null;case 30:return null}throw Error(F(156,s.tag))}function Mm(r,s){switch(Fu(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Ao(Xi),yi(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return rn(s),null;case 31:if(s.memoizedState!==null){if($a(s),s.alternate===null)throw Error(F(340));Mo()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if($a(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(F(340));Mo()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return lt(hr),null;case 4:return yi(),null;case 10:return Ao(s.type),null;case 22:case 23:return $a(s),Rl(),r!==null&&lt($s),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Ao(Xi),null;case 25:return null;default:return null}}function Cm(r,s){switch(Fu(s),s.tag){case 3:Ao(Xi),yi();break;case 26:case 27:case 5:rn(s);break;case 4:yi();break;case 31:s.memoizedState!==null&&$a(s);break;case 13:$a(s);break;case 19:lt(hr);break;case 10:Ao(s.type);break;case 22:case 23:$a(s),Rl(),r!==null&&lt($s);break;case 24:Ao(Xi)}}function Tf(r,s){try{var d=s.updateQueue,x=d!==null?d.lastEffect:null;if(x!==null){var M=x.next;d=M;do{if((d.tag&r)===r){x=void 0;var k=d.create,X=d.inst;x=k(),X.destroy=x}d=d.next}while(d!==M)}}catch(se){mi(s,s.return,se)}}function Ku(r,s,d){try{var x=s.updateQueue,M=x!==null?x.lastEffect:null;if(M!==null){var k=M.next;x=k;do{if((x.tag&r)===r){var X=x.inst,se=X.destroy;if(se!==void 0){X.destroy=void 0,M=s;var ke=d,tt=se;try{tt()}catch(ft){mi(M,ke,ft)}}}x=x.next}while(x!==k)}}catch(ft){mi(s,s.return,ft)}}function Sf(r){var s=r.updateQueue;if(s!==null){var d=r.stateNode;try{ff(s,d)}catch(x){mi(r,r.return,x)}}}function md(r,s,d){d.props=_s(r.type,r.memoizedProps),d.state=r.memoizedState;try{d.componentWillUnmount()}catch(x){mi(r,s,x)}}function Dh(r,s){try{var d=r.ref;if(d!==null){switch(r.tag){case 26:case 27:case 5:var x=r.stateNode;break;case 30:x=r.stateNode;break;default:x=r.stateNode}typeof d=="function"?r.refCleanup=d(x):d.current=x}}catch(M){mi(r,s,M)}}function Qa(r,s){var d=r.ref,x=r.refCleanup;if(d!==null)if(typeof x=="function")try{x()}catch(M){mi(r,s,M)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(M){mi(r,s,M)}else d.current=null}function Ph(r){var s=r.type,d=r.memoizedProps,x=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":d.autoFocus&&x.focus();break e;case"img":d.src?x.src=d.src:d.srcSet&&(x.srcset=d.srcSet)}}catch(M){mi(r,r.return,M)}}function bp(r,s,d){try{var x=r.stateNode;Gf(x,r.type,d,s),x[St]=s}catch(M){mi(r,r.return,M)}}function Im(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&ar(r.type)||r.tag===4}function wp(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||Im(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&ar(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Tp(r,s,d){var x=r.tag;if(x===5||x===6)r=r.stateNode,s?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(r,s):(s=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,s.appendChild(r),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=Aa));else if(x!==4&&(x===27&&ar(r.type)&&(d=r.stateNode,s=null),r=r.child,r!==null))for(Tp(r,s,d),r=r.sibling;r!==null;)Tp(r,s,d),r=r.sibling}function gd(r,s,d){var x=r.tag;if(x===5||x===6)r=r.stateNode,s?d.insertBefore(r,s):d.appendChild(r);else if(x!==4&&(x===27&&ar(r.type)&&(d=r.stateNode),r=r.child,r!==null))for(gd(r,s,d),r=r.sibling;r!==null;)gd(r,s,d),r=r.sibling}function Am(r){var s=r.stateNode,d=r.memoizedProps;try{for(var x=r.type,M=s.attributes;M.length;)s.removeAttributeNode(M[0]);Rr(s,x,d),s[li]=r,s[St]=d}catch(k){mi(r,r.return,k)}}var pu=!1,Ar=!1,Sp=!1,Ep=typeof WeakSet=="function"?WeakSet:Set,kr=null;function Ng(r,s){if(r=r.containerInfo,Pd=Qh,r=fa(r),va(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var x=d.getSelection&&d.getSelection();if(x&&x.rangeCount!==0){d=x.anchorNode;var M=x.anchorOffset,k=x.focusNode;x=x.focusOffset;try{d.nodeType,k.nodeType}catch{d=null;break e}var X=0,se=-1,ke=-1,tt=0,ft=0,wt=r,nt=null;t:for(;;){for(var st;wt!==d||M!==0&&wt.nodeType!==3||(se=X+M),wt!==k||x!==0&&wt.nodeType!==3||(ke=X+x),wt.nodeType===3&&(X+=wt.nodeValue.length),(st=wt.firstChild)!==null;)nt=wt,wt=st;for(;;){if(wt===r)break t;if(nt===d&&++tt===M&&(se=X),nt===k&&++ft===x&&(ke=X),(st=wt.nextSibling)!==null)break;wt=nt,nt=wt.parentNode}wt=st}d=se===-1||ke===-1?null:{start:se,end:ke}}else d=null}d=d||{start:0,end:0}}else d=null;for(Rd={focusedElem:r,selectionRange:d},Qh=!1,kr=s;kr!==null;)if(s=kr,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,kr=r;else for(;kr!==null;){switch(s=kr,k=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(d=0;d<r.length;d++)M=r[d],M.ref.impl=M.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&k!==null){r=void 0,d=s,M=k.memoizedProps,k=k.memoizedState,x=d.stateNode;try{var tn=_s(d.type,M);r=x.getSnapshotBeforeUpdate(tn,k),x.__reactInternalSnapshotBeforeUpdate=r}catch(wn){mi(d,d.return,wn)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,d=r.nodeType,d===9)Ka(r);else if(d===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Ka(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(F(163))}if(r=s.sibling,r!==null){r.return=s.return,kr=r;break}kr=s.return}}function fr(r,s,d){var x=d.flags;switch(d.tag){case 0:case 11:case 15:Bl(r,d),x&4&&Tf(5,d);break;case 1:if(Bl(r,d),x&4)if(r=d.stateNode,s===null)try{r.componentDidMount()}catch(X){mi(d,d.return,X)}else{var M=_s(d.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(M,s,r.__reactInternalSnapshotBeforeUpdate)}catch(X){mi(d,d.return,X)}}x&64&&Sf(d),x&512&&Dh(d,d.return);break;case 3:if(Bl(r,d),x&64&&(r=d.updateQueue,r!==null)){if(s=null,d.child!==null)switch(d.child.tag){case 27:case 5:s=d.child.stateNode;break;case 1:s=d.child.stateNode}try{ff(r,s)}catch(X){mi(d,d.return,X)}}break;case 27:s===null&&x&4&&Am(d);case 26:case 5:Bl(r,d),s===null&&x&4&&Ph(d),x&512&&Dh(d,d.return);break;case 12:Bl(r,d);break;case 31:Bl(r,d),x&4&&Mp(r,d);break;case 13:Bl(r,d),x&4&&Cp(r,d),x&64&&(r=d.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(d=qg.bind(null,d),Nd(r,d))));break;case 22:if(x=d.memoizedState!==null||pu,!x){s=s!==null&&s.memoizedState!==null||Ar,M=pu;var k=Ar;pu=x,(Ar=s)&&!k?mu(r,d,(d.subtreeFlags&8772)!==0):Bl(r,d),pu=M,Ar=k}break;case 30:break;default:Bl(r,d)}}function jc(r){var s=r.alternate;s!==null&&(r.alternate=null,jc(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&as(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var rr=null,Ba=!1;function Ro(r,s,d){for(d=d.child;d!==null;)Rh(r,s,d),d=d.sibling}function Rh(r,s,d){if(De&&typeof De.onCommitFiberUnmount=="function")try{De.onCommitFiberUnmount(Ve,d)}catch{}switch(d.tag){case 26:Ar||Qa(d,s),Ro(r,s,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:Ar||Qa(d,s);var x=rr,M=Ba;ar(d.type)&&(rr=d.stateNode,Ba=!1),Ro(r,s,d),qh(d.stateNode),rr=x,Ba=M;break;case 5:Ar||Qa(d,s);case 6:if(x=rr,M=Ba,rr=null,Ro(r,s,d),rr=x,Ba=M,rr!==null)if(Ba)try{(rr.nodeType===9?rr.body:rr.nodeName==="HTML"?rr.ownerDocument.body:rr).removeChild(d.stateNode)}catch(k){mi(d,s,k)}else try{rr.removeChild(d.stateNode)}catch(k){mi(d,s,k)}break;case 18:rr!==null&&(Ba?(r=rr,zo(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,d.stateNode),ef(r)):zo(rr,d.stateNode));break;case 4:x=rr,M=Ba,rr=d.stateNode.containerInfo,Ba=!0,Ro(r,s,d),rr=x,Ba=M;break;case 0:case 11:case 14:case 15:Ku(2,d,s),Ar||Ku(4,d,s),Ro(r,s,d);break;case 1:Ar||(Qa(d,s),x=d.stateNode,typeof x.componentWillUnmount=="function"&&md(d,s,x)),Ro(r,s,d);break;case 21:Ro(r,s,d);break;case 22:Ar=(x=Ar)||d.memoizedState!==null,Ro(r,s,d),Ar=x;break;default:Ro(r,s,d)}}function Mp(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{ef(r)}catch(d){mi(s,s.return,d)}}}function Cp(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{ef(r)}catch(d){mi(s,s.return,d)}}function Ef(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new Ep),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new Ep),s;default:throw Error(F(435,r.tag))}}function Lh(r,s){var d=Ef(r);s.forEach(function(x){if(!d.has(x)){d.add(x);var M=Zg.bind(null,r,x);x.then(M,M)}})}function ma(r,s){var d=s.deletions;if(d!==null)for(var x=0;x<d.length;x++){var M=d[x],k=r,X=s,se=X;e:for(;se!==null;){switch(se.tag){case 27:if(ar(se.type)){rr=se.stateNode,Ba=!1;break e}break;case 5:rr=se.stateNode,Ba=!1;break e;case 3:case 4:rr=se.stateNode.containerInfo,Ba=!0;break e}se=se.return}if(rr===null)throw Error(F(160));Rh(k,X,M),rr=null,Ba=!1,k=M.alternate,k!==null&&(k.return=null),M.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)Gc(s,r),s=s.sibling}var Ls=null;function Gc(r,s){var d=r.alternate,x=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:ma(s,r),Ta(r),x&4&&(Ku(3,r,r.return),Tf(3,r),Ku(5,r,r.return));break;case 1:ma(s,r),Ta(r),x&512&&(Ar||d===null||Qa(d,d.return)),x&64&&pu&&(r=r.updateQueue,r!==null&&(x=r.callbacks,x!==null&&(d=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=d===null?x:d.concat(x))));break;case 26:var M=Ls;if(ma(s,r),Ta(r),x&512&&(Ar||d===null||Qa(d,d.return)),x&4){var k=d!==null?d.memoizedState:null;if(x=r.memoizedState,d===null)if(x===null)if(r.stateNode===null){e:{x=r.type,d=r.memoizedProps,M=M.ownerDocument||M;t:switch(x){case"title":k=M.getElementsByTagName("title")[0],(!k||k[yn]||k[li]||k.namespaceURI==="http://www.w3.org/2000/svg"||k.hasAttribute("itemprop"))&&(k=M.createElement(x),M.head.insertBefore(k,M.querySelector("head > title"))),Rr(k,x,d),k[li]=r,xi(k),x=k;break e;case"link":var X=Ud("link","href",M).get(x+(d.href||""));if(X){for(var se=0;se<X.length;se++)if(k=X[se],k.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&k.getAttribute("rel")===(d.rel==null?null:d.rel)&&k.getAttribute("title")===(d.title==null?null:d.title)&&k.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){X.splice(se,1);break t}}k=M.createElement(x),Rr(k,x,d),M.head.appendChild(k);break;case"meta":if(X=Ud("meta","content",M).get(x+(d.content||""))){for(se=0;se<X.length;se++)if(k=X[se],k.getAttribute("content")===(d.content==null?null:""+d.content)&&k.getAttribute("name")===(d.name==null?null:d.name)&&k.getAttribute("property")===(d.property==null?null:d.property)&&k.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&k.getAttribute("charset")===(d.charSet==null?null:d.charSet)){X.splice(se,1);break t}}k=M.createElement(x),Rr(k,x,d),M.head.appendChild(k);break;default:throw Error(F(468,x))}k[li]=r,xi(k),x=k}r.stateNode=x}else jd(M,r.type,r.stateNode);else r.stateNode=ig(M,x,r.memoizedProps);else k!==x?(k===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):k.count--,x===null?jd(M,r.type,r.stateNode):ig(M,x,r.memoizedProps)):x===null&&r.stateNode!==null&&bp(r,r.memoizedProps,d.memoizedProps)}break;case 27:ma(s,r),Ta(r),x&512&&(Ar||d===null||Qa(d,d.return)),d!==null&&x&4&&bp(r,r.memoizedProps,d.memoizedProps);break;case 5:if(ma(s,r),Ta(r),x&512&&(Ar||d===null||Qa(d,d.return)),r.flags&32){M=r.stateNode;try{Is(M,"")}catch(tn){mi(r,r.return,tn)}}x&4&&r.stateNode!=null&&(M=r.memoizedProps,bp(r,M,d!==null?d.memoizedProps:M)),x&1024&&(Sp=!0);break;case 6:if(ma(s,r),Ta(r),x&4){if(r.stateNode===null)throw Error(F(162));x=r.memoizedProps,d=r.stateNode;try{d.nodeValue=x}catch(tn){mi(r,r.return,tn)}}break;case 3:if(Wc=null,M=Ls,Ls=Zh(s.containerInfo),ma(s,r),Ls=M,Ta(r),x&4&&d!==null&&d.memoizedState.isDehydrated)try{ef(s.containerInfo)}catch(tn){mi(r,r.return,tn)}Sp&&(Sp=!1,km(r));break;case 4:x=Ls,Ls=Zh(r.stateNode.containerInfo),ma(s,r),Ta(r),Ls=x;break;case 12:ma(s,r),Ta(r);break;case 31:ma(s,r),Ta(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,Lh(r,x)));break;case 13:ma(s,r),Ta(r),r.child.flags&8192&&r.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(Nh=ln()),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,Lh(r,x)));break;case 22:M=r.memoizedState!==null;var ke=d!==null&&d.memoizedState!==null,tt=pu,ft=Ar;if(pu=tt||M,Ar=ft||ke,ma(s,r),Ar=ft,pu=tt,Ta(r),x&8192)e:for(s=r.stateNode,s._visibility=M?s._visibility&-2:s._visibility|1,M&&(d===null||ke||pu||Ar||eo(r)),d=null,s=r;;){if(s.tag===5||s.tag===26){if(d===null){ke=d=s;try{if(k=ke.stateNode,M)X=k.style,typeof X.setProperty=="function"?X.setProperty("display","none","important"):X.display="none";else{se=ke.stateNode;var wt=ke.memoizedProps.style,nt=wt!=null&&wt.hasOwnProperty("display")?wt.display:null;se.style.display=nt==null||typeof nt=="boolean"?"":(""+nt).trim()}}catch(tn){mi(ke,ke.return,tn)}}}else if(s.tag===6){if(d===null){ke=s;try{ke.stateNode.nodeValue=M?"":ke.memoizedProps}catch(tn){mi(ke,ke.return,tn)}}}else if(s.tag===18){if(d===null){ke=s;try{var st=ke.stateNode;M?ac(st,!0):ac(ke.stateNode,!1)}catch(tn){mi(ke,ke.return,tn)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;d===s&&(d=null),s=s.return}d===s&&(d=null),s.sibling.return=s.return,s=s.sibling}x&4&&(x=r.updateQueue,x!==null&&(d=x.retryQueue,d!==null&&(x.retryQueue=null,Lh(r,d))));break;case 19:ma(s,r),Ta(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,Lh(r,x)));break;case 30:break;case 21:break;default:ma(s,r),Ta(r)}}function Ta(r){var s=r.flags;if(s&2){try{for(var d,x=r.return;x!==null;){if(Im(x)){d=x;break}x=x.return}if(d==null)throw Error(F(160));switch(d.tag){case 27:var M=d.stateNode,k=wp(r);gd(r,k,M);break;case 5:var X=d.stateNode;d.flags&32&&(Is(X,""),d.flags&=-33);var se=wp(r);gd(r,se,X);break;case 3:case 4:var ke=d.stateNode.containerInfo,tt=wp(r);Tp(r,tt,ke);break;default:throw Error(F(161))}}catch(ft){mi(r,r.return,ft)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function km(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;km(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function Bl(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)fr(r,s.alternate,s),s=s.sibling}function eo(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:Ku(4,s,s.return),eo(s);break;case 1:Qa(s,s.return);var d=s.stateNode;typeof d.componentWillUnmount=="function"&&md(s,s.return,d),eo(s);break;case 27:qh(s.stateNode);case 26:case 5:Qa(s,s.return),eo(s);break;case 22:s.memoizedState===null&&eo(s);break;case 30:eo(s);break;default:eo(s)}r=r.sibling}}function mu(r,s,d){for(d=d&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var x=s.alternate,M=r,k=s,X=k.flags;switch(k.tag){case 0:case 11:case 15:mu(M,k,d),Tf(4,k);break;case 1:if(mu(M,k,d),x=k,M=x.stateNode,typeof M.componentDidMount=="function")try{M.componentDidMount()}catch(tt){mi(x,x.return,tt)}if(x=k,M=x.updateQueue,M!==null){var se=x.stateNode;try{var ke=M.shared.hiddenCallbacks;if(ke!==null)for(M.shared.hiddenCallbacks=null,M=0;M<ke.length;M++)Th(ke[M],se)}catch(tt){mi(x,x.return,tt)}}d&&X&64&&Sf(k),Dh(k,k.return);break;case 27:Am(k);case 26:case 5:mu(M,k,d),d&&x===null&&X&4&&Ph(k),Dh(k,k.return);break;case 12:mu(M,k,d);break;case 31:mu(M,k,d),d&&X&4&&Mp(M,k);break;case 13:mu(M,k,d),d&&X&4&&Cp(M,k);break;case 22:k.memoizedState===null&&mu(M,k,d),Dh(k,k.return);break;case 30:break;default:mu(M,k,d)}s=s.sibling}}function _d(r,s){var d=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==d&&(r!=null&&r.refCount++,d!=null&&xa(d))}function qc(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&xa(r))}function to(r,s,d,x){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Ip(r,s,d,x),s=s.sibling}function Ip(r,s,d,x){var M=s.flags;switch(s.tag){case 0:case 11:case 15:to(r,s,d,x),M&2048&&Tf(9,s);break;case 1:to(r,s,d,x);break;case 3:to(r,s,d,x),M&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&xa(r)));break;case 12:if(M&2048){to(r,s,d,x),r=s.stateNode;try{var k=s.memoizedProps,X=k.id,se=k.onPostCommit;typeof se=="function"&&se(X,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(ke){mi(s,s.return,ke)}}else to(r,s,d,x);break;case 31:to(r,s,d,x);break;case 13:to(r,s,d,x);break;case 23:break;case 22:k=s.stateNode,X=s.alternate,s.memoizedState!==null?k._visibility&2?to(r,s,d,x):Mf(r,s):k._visibility&2?to(r,s,d,x):(k._visibility|=2,Zc(r,s,d,x,(s.subtreeFlags&10256)!==0||!1)),M&2048&&_d(X,s);break;case 24:to(r,s,d,x),M&2048&&qc(s.alternate,s);break;default:to(r,s,d,x)}}function Zc(r,s,d,x,M){for(M=M&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var k=r,X=s,se=d,ke=x,tt=X.flags;switch(X.tag){case 0:case 11:case 15:Zc(k,X,se,ke,M),Tf(8,X);break;case 23:break;case 22:var ft=X.stateNode;X.memoizedState!==null?ft._visibility&2?Zc(k,X,se,ke,M):Mf(k,X):(ft._visibility|=2,Zc(k,X,se,ke,M)),M&&tt&2048&&_d(X.alternate,X);break;case 24:Zc(k,X,se,ke,M),M&&tt&2048&&qc(X.alternate,X);break;default:Zc(k,X,se,ke,M)}s=s.sibling}}function Mf(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var d=r,x=s,M=x.flags;switch(x.tag){case 22:Mf(d,x),M&2048&&_d(x.alternate,x);break;case 24:Mf(d,x),M&2048&&qc(x.alternate,x);break;default:Mf(d,x)}s=s.sibling}}var Cf=8192;function zh(r,s,d){if(r.subtreeFlags&Cf)for(r=r.child;r!==null;)Dm(r,s,d),r=r.sibling}function Dm(r,s,d){switch(r.tag){case 26:zh(r,s,d),r.flags&Cf&&r.memoizedState!==null&&rg(d,Ls,r.memoizedState,r.memoizedProps);break;case 5:zh(r,s,d);break;case 3:case 4:var x=Ls;Ls=Zh(r.stateNode.containerInfo),zh(r,s,d),Ls=x;break;case 22:r.memoizedState===null&&(x=r.alternate,x!==null&&x.memoizedState!==null?(x=Cf,Cf=16777216,zh(r,s,d),Cf=x):zh(r,s,d));break;default:zh(r,s,d)}}function Pm(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function gu(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var x=s[d];kr=x,Lm(x,r)}Pm(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Rm(r),r=r.sibling}function Rm(r){switch(r.tag){case 0:case 11:case 15:gu(r),r.flags&2048&&Ku(9,r,r.return);break;case 3:gu(r);break;case 12:gu(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,If(r)):gu(r);break;default:gu(r)}}function If(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var x=s[d];kr=x,Lm(x,r)}Pm(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:Ku(8,s,s.return),If(s);break;case 22:d=s.stateNode,d._visibility&2&&(d._visibility&=-3,If(s));break;default:If(s)}r=r.sibling}}function Lm(r,s){for(;kr!==null;){var d=kr;switch(d.tag){case 0:case 11:case 15:Ku(8,d,s);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var x=d.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:xa(d.memoizedState.cache)}if(x=d.child,x!==null)x.return=d,kr=x;else e:for(d=r;kr!==null;){x=kr;var M=x.sibling,k=x.return;if(jc(x),x===d){kr=null;break e}if(M!==null){M.return=k,kr=M;break e}kr=k}}}var Bg={getCacheForType:function(r){var s=yr(Xi),d=s.data.get(r);return d===void 0&&(d=r(),s.data.set(r,d)),d},cacheSignal:function(){return yr(Xi).controller.signal}},Fg=typeof WeakMap=="function"?WeakMap:Map,di=0,ji=null,Zn=null,Gn=0,Ei=0,no=null,Ju=!1,Yc=!1,yd=!1,_u=0,Dr=0,Lo=0,ec=0,Ap=0,io=0,Oh=0,Af=null,zs=null,vd=!1,Nh=0,kp=0,kf=1/0,Df=null,tc=null,Pr=0,nc=null,Hc=null,yu=0,Dp=0,Pp=null,Rp=null,Pf=0,Lp=null;function pi(){return(di&2)!==0&&Gn!==0?Gn&-Gn:Je.T!==null?rc():mr()}function Bh(){if(io===0)if((Gn&536870912)===0||jn){var r=Dn;Dn<<=1,(Dn&3932160)===0&&(Dn=262144),io=r}else io=536870912;return r=za.current,r!==null&&(r.flags|=32),io}function Os(r,s,d){(r===ji&&(Ei===2||Ei===9)||r.cancelPendingCommit!==null)&&(ll(r,0),ic(r,Gn,io,!1)),Xn(r,d),((di&2)===0||r!==ji)&&(r===ji&&((di&2)===0&&(ec|=d),Dr===4&&ic(r,Gn,io,!1)),cl(r))}function zm(r,s,d){if((di&6)!==0)throw Error(F(327));var x=!d&&(s&127)===0&&(s&r.expiredLanes)===0||qi(r,s),M=x?Ug(r,s):wd(r,s,!0),k=x;do{if(M===0){Yc&&!x&&ic(r,s,0,!1);break}else{if(d=r.current.alternate,k&&!Om(d)){M=wd(r,s,!1),k=!1;continue}if(M===2){if(k=s,r.errorRecoveryDisabledLanes&k)var X=0;else X=r.pendingLanes&-536870913,X=X!==0?X:X&536870912?536870912:0;if(X!==0){s=X;e:{var se=r;M=Af;var ke=se.current.memoizedState.isDehydrated;if(ke&&(ll(se,X).flags|=256),X=wd(se,X,!1),X!==2){if(yd&&!ke){se.errorRecoveryDisabledLanes|=k,ec|=k,M=4;break e}k=zs,zs=M,k!==null&&(zs===null?zs=k:zs.push.apply(zs,k))}M=X}if(k=!1,M!==2)continue}}if(M===1){ll(r,0),ic(r,s,0,!0);break}e:{switch(x=r,k=M,k){case 0:case 1:throw Error(F(345));case 4:if((s&4194048)!==s)break;case 6:ic(x,s,io,!Ju);break e;case 2:zs=null;break;case 3:case 5:break;default:throw Error(F(329))}if((s&62914560)===s&&(M=Nh+300-ln(),10<M)){if(ic(x,s,io,!Ju),Jn(x,0,!0)!==0)break e;yu=s,x.timeoutHandle=Od(zp.bind(null,x,d,zs,Df,vd,s,io,ec,Oh,Ju,k,"Throttled",-0,0),M);break e}zp(x,d,zs,Df,vd,s,io,ec,Oh,Ju,k,null,-0,0)}}break}while(!0);cl(r)}function zp(r,s,d,x,M,k,X,se,ke,tt,ft,wt,nt,st){if(r.timeoutHandle=-1,wt=s.subtreeFlags,wt&8192||(wt&16785408)===16785408){wt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Aa},Dm(s,k,wt);var tn=(k&62914560)===k?Nh-ln():(k&4194048)===k?kp-ln():0;if(tn=ag(wt,tn),tn!==null){yu=k,r.cancelPendingCommit=tn(Vm.bind(null,r,s,k,d,x,M,X,se,ke,ft,wt,null,nt,st)),ic(r,k,X,!tt);return}}Vm(r,s,k,d,x,M,X,se,ke)}function Om(r){for(var s=r;;){var d=s.tag;if((d===0||d===11||d===15)&&s.flags&16384&&(d=s.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var x=0;x<d.length;x++){var M=d[x],k=M.getSnapshot;M=M.value;try{if(!ya(k(),M))return!1}catch{return!1}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function ic(r,s,d,x){s&=~Ap,s&=~ec,r.suspendedLanes|=s,r.pingedLanes&=~s,x&&(r.warmLanes|=s),x=r.expirationTimes;for(var M=s;0<M;){var k=31-ut(M),X=1<<k;x[k]=-1,M&=~X}d!==0&&ni(r,d,s)}function Rf(){return(di&6)===0?(Xc(0),!1):!0}function xd(){if(Zn!==null){if(Ei===0)var r=Zn.return;else r=Zn,Io=Ds=null,al(r),Rs=null,Rc=0,r=Zn;for(;r!==null;)Cm(r.alternate,r),r=r.return;Zn=null}}function ll(r,s){var d=r.timeoutHandle;d!==-1&&(r.timeoutHandle=-1,Wg(d)),d=r.cancelPendingCommit,d!==null&&(r.cancelPendingCommit=null,d()),yu=0,xd(),ji=r,Zn=d=hs(r.current,null),Gn=s,Ei=0,no=null,Ju=!1,Yc=qi(r,s),yd=!1,Oh=io=Ap=ec=Lo=Dr=0,zs=Af=null,vd=!1,(s&8)!==0&&(s|=s&32);var x=r.entangledLanes;if(x!==0)for(r=r.entanglements,x&=s;0<x;){var M=31-ut(x),k=1<<M;s|=r[M],x&=~k}return _u=s,bo(),d}function bd(r,s){on=null,Je.H=Ki,s===Bt||s===Al?(s=vh(),Ei=3):s===Dc?(s=vh(),Ei=4):Ei=s===cp?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,no=s,Zn===null&&(Dr=1,du(r,Pa(s,r.current)))}function Op(){var r=za.current;return r===null?!0:(Gn&4194048)===Gn?ea===null:(Gn&62914560)===Gn||(Gn&536870912)!==0?r===ea:!1}function Np(){var r=Je.H;return Je.H=Ki,r===null?Ki:r}function Lf(){var r=Je.A;return Je.A=Bg,r}function vu(){Dr=4,Ju||(Gn&4194048)!==Gn&&za.current!==null||(Yc=!0),(Lo&134217727)===0&&(ec&134217727)===0||ji===null||ic(ji,Gn,io,!1)}function wd(r,s,d){var x=di;di|=2;var M=Np(),k=Lf();(ji!==r||Gn!==s)&&(Df=null,ll(r,s)),s=!1;var X=Dr;e:do try{if(Ei!==0&&Zn!==null){var se=Zn,ke=no;switch(Ei){case 8:xd(),X=6;break e;case 3:case 2:case 9:case 6:za.current===null&&(s=!0);var tt=Ei;if(Ei=0,no=null,Fh(r,se,ke,tt),d&&Yc){X=0;break e}break;default:tt=Ei,Ei=0,no=null,Fh(r,se,ke,tt)}}Vg(),X=Dr;break}catch(ft){bd(r,ft)}while(!0);return s&&r.shellSuspendCounter++,Io=Ds=null,di=x,Je.H=M,Je.A=k,Zn===null&&(ji=null,Gn=0,bo()),X}function Vg(){for(;Zn!==null;)Nm(Zn)}function Ug(r,s){var d=di;di|=2;var x=Np(),M=Lf();ji!==r||Gn!==s?(Df=null,kf=ln()+500,ll(r,s)):Yc=qi(r,s);e:do try{if(Ei!==0&&Zn!==null){s=Zn;var k=no;t:switch(Ei){case 1:Ei=0,no=null,Fh(r,s,k,1);break;case 2:case 9:if(kl(k)){Ei=0,no=null,Bm(s);break}s=function(){Ei!==2&&Ei!==9||ji!==r||(Ei=7),cl(r)},k.then(s,s);break e;case 3:Ei=7;break e;case 4:Ei=5;break e;case 7:kl(k)?(Ei=0,no=null,Bm(s)):(Ei=0,no=null,Fh(r,s,k,7));break;case 5:var X=null;switch(Zn.tag){case 26:X=Zn.memoizedState;case 5:case 27:var se=Zn;if(X?em(X):se.stateNode.complete){Ei=0,no=null;var ke=se.sibling;if(ke!==null)Zn=ke;else{var tt=se.return;tt!==null?(Zn=tt,Td(tt)):Zn=null}break t}}Ei=0,no=null,Fh(r,s,k,5);break;case 6:Ei=0,no=null,Fh(r,s,k,6);break;case 8:xd(),Dr=6;break e;default:throw Error(F(462))}}jg();break}catch(ft){bd(r,ft)}while(!0);return Io=Ds=null,Je.H=x,Je.A=M,di=d,Zn!==null?0:(ji=null,Gn=0,bo(),Dr)}function jg(){for(;Zn!==null&&!zr();)Nm(Zn)}function Nm(r){var s=Tm(r.alternate,r,_u);r.memoizedProps=r.pendingProps,s===null?Td(r):Zn=s}function Bm(r){var s=r,d=s.alternate;switch(s.tag){case 15:case 0:s=dp(d,s,s.pendingProps,s.type,void 0,Gn);break;case 11:s=dp(d,s,s.pendingProps,s.type.render,s.ref,Gn);break;case 5:al(s);default:Cm(d,s),s=Zn=sd(s,_u),s=Tm(d,s,_u)}r.memoizedProps=r.pendingProps,s===null?Td(r):Zn=s}function Fh(r,s,d,x){Io=Ds=null,al(s),Rs=null,Rc=0;var M=s.return;try{if(up(r,M,s,d,Gn)){Dr=1,du(r,Pa(d,r.current)),Zn=null;return}}catch(k){if(M!==null)throw Zn=M,k;Dr=1,du(r,Pa(d,r.current)),Zn=null;return}s.flags&32768?(jn||x===1?r=!0:Yc||(Gn&536870912)!==0?r=!1:(Ju=r=!0,(x===2||x===9||x===3||x===6)&&(x=za.current,x!==null&&x.tag===13&&(x.flags|=16384))),Fm(s,r)):Td(s)}function Td(r){var s=r;do{if((s.flags&32768)!==0){Fm(s,Ju);return}r=s.return;var d=Em(s.alternate,s,_u);if(d!==null){Zn=d;return}if(s=s.sibling,s!==null){Zn=s;return}Zn=s=r}while(s!==null);Dr===0&&(Dr=5)}function Fm(r,s){do{var d=Mm(r.alternate,r);if(d!==null){d.flags&=32767,Zn=d;return}if(d=r.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!s&&(r=r.sibling,r!==null)){Zn=r;return}Zn=r=d}while(r!==null);Dr=6,Zn=null}function Vm(r,s,d,x,M,k,X,se,ke){r.cancelPendingCommit=null;do Vh();while(Pr!==0);if((di&6)!==0)throw Error(F(327));if(s!==null){if(s===r.current)throw Error(F(177));if(k=s.lanes|s.childLanes,k|=xo,Ci(r,d,k,X,se,ke),r===ji&&(Zn=ji=null,Gn=0),Hc=s,nc=r,yu=d,Dp=k,Pp=M,Rp=x,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,Yg(J,function(){return Fp(),null})):(r.callbackNode=null,r.callbackPriority=0),x=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||x){x=Je.T,Je.T=null,M=Tt.p,Tt.p=2,X=di,di|=4;try{Ng(r,s,d)}finally{di=X,Tt.p=M,Je.T=x}}Pr=1,Um(),jm(),Gm()}}function Um(){if(Pr===1){Pr=0;var r=nc,s=Hc,d=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||d){d=Je.T,Je.T=null;var x=Tt.p;Tt.p=2;var M=di;di|=4;try{Gc(s,r);var k=Rd,X=fa(r.containerInfo),se=k.focusedElem,ke=k.selectionRange;if(X!==se&&se&&se.ownerDocument&&tu(se.ownerDocument.documentElement,se)){if(ke!==null&&va(se)){var tt=ke.start,ft=ke.end;if(ft===void 0&&(ft=tt),"selectionStart"in se)se.selectionStart=tt,se.selectionEnd=Math.min(ft,se.value.length);else{var wt=se.ownerDocument||document,nt=wt&&wt.defaultView||window;if(nt.getSelection){var st=nt.getSelection(),tn=se.textContent.length,wn=Math.min(ke.start,tn),Mi=ke.end===void 0?wn:Math.min(ke.end,tn);!st.extend&&wn>Mi&&(X=Mi,Mi=wn,wn=X);var qe=eu(se,wn),Ne=eu(se,Mi);if(qe&&Ne&&(st.rangeCount!==1||st.anchorNode!==qe.node||st.anchorOffset!==qe.offset||st.focusNode!==Ne.node||st.focusOffset!==Ne.offset)){var et=wt.createRange();et.setStart(qe.node,qe.offset),st.removeAllRanges(),wn>Mi?(st.addRange(et),st.extend(Ne.node,Ne.offset)):(et.setEnd(Ne.node,Ne.offset),st.addRange(et))}}}}for(wt=[],st=se;st=st.parentNode;)st.nodeType===1&&wt.push({element:st,left:st.scrollLeft,top:st.scrollTop});for(typeof se.focus=="function"&&se.focus(),se=0;se<wt.length;se++){var pt=wt[se];pt.element.scrollLeft=pt.left,pt.element.scrollTop=pt.top}}Qh=!!Pd,Rd=Pd=null}finally{di=M,Tt.p=x,Je.T=d}}r.current=s,Pr=2}}function jm(){if(Pr===2){Pr=0;var r=nc,s=Hc,d=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||d){d=Je.T,Je.T=null;var x=Tt.p;Tt.p=2;var M=di;di|=4;try{fr(r,s.alternate,s)}finally{di=M,Tt.p=x,Je.T=d}}Pr=3}}function Gm(){if(Pr===4||Pr===3){Pr=0,pl();var r=nc,s=Hc,d=yu,x=Rp;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Pr=5:(Pr=0,Hc=nc=null,Bp(r,r.pendingLanes));var M=r.pendingLanes;if(M===0&&(tc=null),It(d),s=s.stateNode,De&&typeof De.onCommitFiberRoot=="function")try{De.onCommitFiberRoot(Ve,s,void 0,(s.current.flags&128)===128)}catch{}if(x!==null){s=Je.T,M=Tt.p,Tt.p=2,Je.T=null;try{for(var k=r.onRecoverableError,X=0;X<x.length;X++){var se=x[X];k(se.value,{componentStack:se.stack})}}finally{Je.T=s,Tt.p=M}}(yu&3)!==0&&Vh(),cl(r),M=r.pendingLanes,(d&261930)!==0&&(M&42)!==0?r===Lp?Pf++:(Pf=0,Lp=r):Pf=0,Xc(0)}}function Bp(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,xa(s)))}function Vh(){return Um(),jm(),Gm(),Fp()}function Fp(){if(Pr!==5)return!1;var r=nc,s=Dp;Dp=0;var d=It(yu),x=Je.T,M=Tt.p;try{Tt.p=32>d?32:d,Je.T=null,d=Pp,Pp=null;var k=nc,X=yu;if(Pr=0,Hc=nc=null,yu=0,(di&6)!==0)throw Error(F(331));var se=di;if(di|=4,Rm(k.current),Ip(k,k.current,X,d),di=se,Xc(0,!1),De&&typeof De.onPostCommitFiberRoot=="function")try{De.onPostCommitFiberRoot(Ve,k)}catch{}return!0}finally{Tt.p=M,Je.T=x,Bp(r,s)}}function xu(r,s,d){s=Pa(d,s),s=Ol(r.stateNode,s,2),r=Jo(r,s,2),r!==null&&(Xn(r,2),cl(r))}function mi(r,s,d){if(r.tag===3)xu(r,r,d);else for(;s!==null;){if(s.tag===3){xu(s,r,d);break}else if(s.tag===1){var x=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(tc===null||!tc.has(x))){r=Pa(d,r),d=Ih(2),x=Jo(s,d,2),x!==null&&(Ah(d,x,s,r),Xn(x,2),cl(x));break}}s=s.return}}function zf(r,s,d){var x=r.pingCache;if(x===null){x=r.pingCache=new Fg;var M=new Set;x.set(s,M)}else M=x.get(s),M===void 0&&(M=new Set,x.set(s,M));M.has(d)||(yd=!0,M.add(d),r=Gg.bind(null,r,s,d),s.then(r,r))}function Gg(r,s,d){var x=r.pingCache;x!==null&&x.delete(s),r.pingedLanes|=r.suspendedLanes&d,r.warmLanes&=~d,ji===r&&(Gn&d)===d&&(Dr===4||Dr===3&&(Gn&62914560)===Gn&&300>ln()-Nh?(di&2)===0&&ll(r,0):Ap|=d,Oh===Gn&&(Oh=0)),cl(r)}function Vp(r,s){s===0&&(s=xt()),r=Da(r,s),r!==null&&(Xn(r,s),cl(r))}function qg(r){var s=r.memoizedState,d=0;s!==null&&(d=s.retryLane),Vp(r,d)}function Zg(r,s){var d=0;switch(r.tag){case 31:case 13:var x=r.stateNode,M=r.memoizedState;M!==null&&(d=M.retryLane);break;case 19:x=r.stateNode;break;case 22:x=r.stateNode._retryCache;break;default:throw Error(F(314))}x!==null&&x.delete(s),Vp(r,d)}function Yg(r,s){return Us(r,s)}var Sd=null,Uh=null,Ed=!1,Of=!1,ul=!1,ys=0;function cl(r){r!==Uh&&r.next===null&&(Uh===null?Sd=Uh=r:Uh=Uh.next=r),Of=!0,Ed||(Ed=!0,Up())}function Xc(r,s){if(!ul&&Of){ul=!0;do for(var d=!1,x=Sd;x!==null;){if(r!==0){var M=x.pendingLanes;if(M===0)var k=0;else{var X=x.suspendedLanes,se=x.pingedLanes;k=(1<<31-ut(42|r)+1)-1,k&=M&~(X&~se),k=k&201326741?k&201326741|1:k?k|2:0}k!==0&&(d=!0,Cd(x,k))}else k=Gn,k=Jn(x,x===ji?k:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(k&3)===0||qi(x,k)||(d=!0,Cd(x,k));x=x.next}while(d);ul=!1}}function Hg(){Nf()}function Nf(){Of=Ed=!1;var r=0;ys!==0&&Hp()&&(r=ys);for(var s=ln(),d=null,x=Sd;x!==null;){var M=x.next,k=Md(x,s);k===0?(x.next=null,d===null?Sd=M:d.next=M,M===null&&(Uh=d)):(d=x,(r!==0||(k&3)!==0)&&(Of=!0)),x=M}Pr!==0&&Pr!==5||Xc(r),ys!==0&&(ys=0)}function Md(r,s){for(var d=r.suspendedLanes,x=r.pingedLanes,M=r.expirationTimes,k=r.pendingLanes&-62914561;0<k;){var X=31-ut(k),se=1<<X,ke=M[X];ke===-1?((se&d)===0||(se&x)!==0)&&(M[X]=gn(se,s)):ke<=s&&(r.expiredLanes|=se),k&=~se}if(s=ji,d=Gn,d=Jn(r,r===s?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x=r.callbackNode,d===0||r===s&&(Ei===2||Ei===9)||r.cancelPendingCommit!==null)return x!==null&&x!==null&&rs(x),r.callbackNode=null,r.callbackPriority=0;if((d&3)===0||qi(r,d)){if(s=d&-d,s===r.callbackPriority)return s;switch(x!==null&&rs(x),It(d)){case 2:case 8:d=te;break;case 32:d=J;break;case 268435456:d=ve;break;default:d=J}return x=qm.bind(null,r),d=Us(d,x),r.callbackPriority=s,r.callbackNode=d,s}return x!==null&&x!==null&&rs(x),r.callbackPriority=2,r.callbackNode=null,2}function qm(r,s){if(Pr!==0&&Pr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var d=r.callbackNode;if(Vh()&&r.callbackNode!==d)return null;var x=Gn;return x=Jn(r,r===ji?x:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x===0?null:(zm(r,x,s),Md(r,ln()),r.callbackNode!=null&&r.callbackNode===d?qm.bind(null,r):null)}function Cd(r,s){if(Vh())return null;zm(r,s,!0)}function Up(){On(function(){(di&6)!==0?Us(je,Hg):Nf()})}function rc(){if(ys===0){var r=ba;r===0&&(r=pn,pn<<=1,(pn&261888)===0&&(pn=256)),ys=r}return ys}function jp(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:In(""+r)}function Gp(r,s){var d=s.ownerDocument.createElement("input");return d.name=s.name,d.value=s.value,r.id&&d.setAttribute("form",r.id),s.parentNode.insertBefore(d,s),r=new FormData(r),d.parentNode.removeChild(d),r}function qp(r,s,d,x,M){if(s==="submit"&&d&&d.stateNode===M){var k=jp((M[St]||null).action),X=x.submitter;X&&(s=(s=X[St]||null)?jp(s.formAction):X.getAttribute("formAction"),s!==null&&(k=s,X=null));var se=new Yl("action","action",null,x,M);r.push({event:se,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(ys!==0){var ke=X?Gp(M,X):new FormData(M);Qi(d,{pending:!0,data:ke,method:M.method,action:k},null,ke)}}else typeof k=="function"&&(se.preventDefault(),ke=X?Gp(M,X):new FormData(M),Qi(d,{pending:!0,data:ke,method:M.method,action:k},k,ke))},currentTarget:M}]})}}for(var Id=0;Id<ur.length;Id++){var jh=ur[Id],Zm=jh.toLowerCase(),Xg=jh[0].toUpperCase()+jh.slice(1);hi(Zm,"on"+Xg)}hi(Xe,"onAnimationEnd"),hi(bt,"onAnimationIteration"),hi(Zt,"onAnimationStart"),hi("dblclick","onDoubleClick"),hi("focusin","onFocus"),hi("focusout","onBlur"),hi(Qt,"onTransitionRun"),hi(un,"onTransitionStart"),hi(zn,"onTransitionCancel"),hi(Cn,"onTransitionEnd"),Gs("onMouseEnter",["mouseout","mouseover"]),Gs("onMouseLeave",["mouseout","mouseover"]),Gs("onPointerEnter",["pointerout","pointerover"]),Gs("onPointerLeave",["pointerout","pointerover"]),Vn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),$g=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Bf));function Ym(r,s){s=(s&4)!==0;for(var d=0;d<r.length;d++){var x=r[d],M=x.event;x=x.listeners;e:{var k=void 0;if(s)for(var X=x.length-1;0<=X;X--){var se=x[X],ke=se.instance,tt=se.currentTarget;if(se=se.listener,ke!==k&&M.isPropagationStopped())break e;k=se,M.currentTarget=tt;try{k(M)}catch(ft){Wr(ft)}M.currentTarget=null,k=ke}else for(X=0;X<x.length;X++){if(se=x[X],ke=se.instance,tt=se.currentTarget,se=se.listener,ke!==k&&M.isPropagationStopped())break e;k=se,M.currentTarget=tt;try{k(M)}catch(ft){Wr(ft)}M.currentTarget=null,k=ke}}}}function Wn(r,s){var d=s[Tn];d===void 0&&(d=s[Tn]=new Set);var x=r+"__bubble";d.has(x)||(Zp(s,r,2,!1),d.add(x))}function Ff(r,s,d){var x=0;s&&(x|=4),Zp(d,r,x,s)}var hl="_reactListening"+Math.random().toString(36).slice(2);function Ad(r){if(!r[hl]){r[hl]=!0,lo.forEach(function(d){d!=="selectionchange"&&($g.has(d)||Ff(d,!1,r),Ff(d,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[hl]||(s[hl]=!0,Ff("selectionchange",!1,s))}}function Zp(r,s,d,x){switch(cg(s)){case 2:var M=am;break;case 8:M=ug;break;default:M=uc}d=M.bind(null,s,d,r),M=void 0,!An||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(M=!0),x?M!==void 0?r.addEventListener(s,d,{capture:!0,passive:M}):r.addEventListener(s,d,!0):M!==void 0?r.addEventListener(s,d,{passive:M}):r.addEventListener(s,d,!1)}function kd(r,s,d,x,M){var k=x;if((s&1)===0&&(s&2)===0&&x!==null)e:for(;;){if(x===null)return;var X=x.tag;if(X===3||X===4){var se=x.stateNode.containerInfo;if(se===M)break;if(X===4)for(X=x.return;X!==null;){var ke=X.tag;if((ke===3||ke===4)&&X.stateNode.containerInfo===M)return;X=X.return}for(;se!==null;){if(X=ui(se),X===null)return;if(ke=X.tag,ke===5||ke===6||ke===26||ke===27){x=k=X;continue e}se=se.parentNode}}x=x.return}Qn(function(){var tt=k,ft=Xr(d),wt=[];e:{var nt=oi.get(r);if(nt!==void 0){var st=Yl,tn=r;switch(r){case"keypress":if(bi(d)===0)break e;case"keydown":case"keyup":st=zi;break;case"focusin":tn="focus",st=mo;break;case"focusout":tn="blur",st=mo;break;case"beforeblur":case"afterblur":st=mo;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":st=Vo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":st=ml;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":st=wc;break;case Xe:case bt:case Zt:st=yc;break;case Cn:st=_a;break;case"scroll":case"scrollend":st=ua;break;case"wheel":st=ha;break;case"copy":case"cut":case"paste":st=vc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":st=gl;break;case"toggle":case"beforetoggle":st=_l}var wn=(s&4)!==0,Mi=!wn&&(r==="scroll"||r==="scrollend"),qe=wn?nt!==null?nt+"Capture":null:nt;wn=[];for(var Ne=tt,et;Ne!==null;){var pt=Ne;if(et=pt.stateNode,pt=pt.tag,pt!==5&&pt!==26&&pt!==27||et===null||qe===null||(pt=Za(Ne,qe),pt!=null&&wn.push(Gh(Ne,pt,et))),Mi)break;Ne=Ne.return}0<wn.length&&(nt=new st(nt,tn,null,d,ft),wt.push({event:nt,listeners:wn}))}}if((s&7)===0){e:{if(nt=r==="mouseover"||r==="pointerover",st=r==="mouseout"||r==="pointerout",nt&&d!==ga&&(tn=d.relatedTarget||d.fromElement)&&(ui(tn)||tn[bn]))break e;if((st||nt)&&(nt=ft.window===ft?ft:(nt=ft.ownerDocument)?nt.defaultView||nt.parentWindow:window,st?(tn=d.relatedTarget||d.toElement,st=tt,tn=tn?ui(tn):null,tn!==null&&(Mi=ee(tn),wn=tn.tag,tn!==Mi||wn!==5&&wn!==27&&wn!==6)&&(tn=null)):(st=null,tn=tt),st!==tn)){if(wn=Vo,pt="onMouseLeave",qe="onMouseEnter",Ne="mouse",(r==="pointerout"||r==="pointerover")&&(wn=gl,pt="onPointerLeave",qe="onPointerEnter",Ne="pointer"),Mi=st==null?nt:Ts(st),et=tn==null?nt:Ts(tn),nt=new wn(pt,Ne+"leave",st,d,ft),nt.target=Mi,nt.relatedTarget=et,pt=null,ui(ft)===tt&&(wn=new wn(qe,Ne+"enter",tn,d,ft),wn.target=et,wn.relatedTarget=Mi,pt=wn),Mi=pt,st&&tn)t:{for(wn=Hm,qe=st,Ne=tn,et=0,pt=qe;pt;pt=wn(pt))et++;pt=0;for(var Jt=Ne;Jt;Jt=wn(Jt))pt++;for(;0<et-pt;)qe=wn(qe),et--;for(;0<pt-et;)Ne=wn(Ne),pt--;for(;et--;){if(qe===Ne||Ne!==null&&qe===Ne.alternate){wn=qe;break t}qe=wn(qe),Ne=wn(Ne)}wn=null}else wn=null;st!==null&&Uf(wt,nt,st,wn,!1),tn!==null&&Mi!==null&&Uf(wt,Mi,tn,wn,!0)}}e:{if(nt=tt?Ts(tt):window,st=nt.nodeName&&nt.nodeName.toLowerCase(),st==="select"||st==="input"&&nt.type==="file")var ai=yo;else if(zu(nt))if(Sc)ai=Ec;else{ai=Nu;var hn=ch}else st=nt.nodeName,!st||st.toLowerCase()!=="input"||nt.type!=="checkbox"&&nt.type!=="radio"?tt&&qs(tt.elementType)&&(ai=yo):ai=Jl;if(ai&&(ai=ai(r,tt))){Wl(wt,ai,d,ft);break e}hn&&hn(r,nt,tt),r==="focusout"&&tt&&nt.type==="number"&&tt.memoizedProps.value!=null&&Zl(nt,"number",nt.value)}switch(hn=tt?Ts(tt):window,r){case"focusin":(zu(hn)||hn.contentEditable==="true")&&(o=hn,u=tt,g=null);break;case"focusout":g=u=o=null;break;case"mousedown":E=!0;break;case"contextmenu":case"mouseup":case"dragend":E=!1,P(wt,d,ft);break;case"selectionchange":if(_)break;case"keydown":case"keyup":P(wt,d,ft)}var Nn;if(Bi)e:{switch(r){case"compositionstart":var Hn="onCompositionStart";break e;case"compositionend":Hn="onCompositionEnd";break e;case"compositionupdate":Hn="onCompositionUpdate";break e}Hn=void 0}else us?$l(r,d)&&(Hn="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Hn="onCompositionStart");Hn&&(yl&&d.locale!=="ko"&&(us||Hn!=="onCompositionStart"?Hn==="onCompositionEnd"&&us&&(Nn=Zs()):(la=ft,ls="value"in la?la.value:la.textContent,us=!0)),hn=Vf(tt,Hn),0<hn.length&&(Hn=new xc(Hn,r,null,d,ft),wt.push({event:Hn,listeners:hn}),Nn?Hn.data=Nn:(Nn=sh(d),Nn!==null&&(Hn.data=Nn)))),(Nn=go?Lu(r,d):oh(r,d))&&(Hn=Vf(tt,"onBeforeInput"),0<Hn.length&&(hn=new xc("onBeforeInput","beforeinput",null,d,ft),wt.push({event:hn,listeners:Hn}),hn.data=Nn)),qp(wt,r,tt,d,ft)}Ym(wt,s)})}function Gh(r,s,d){return{instance:r,listener:s,currentTarget:d}}function Vf(r,s){for(var d=s+"Capture",x=[];r!==null;){var M=r,k=M.stateNode;if(M=M.tag,M!==5&&M!==26&&M!==27||k===null||(M=Za(r,d),M!=null&&x.unshift(Gh(r,M,k)),M=Za(r,s),M!=null&&x.push(Gh(r,M,k))),r.tag===3)return x;r=r.return}return[]}function Hm(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Uf(r,s,d,x,M){for(var k=s._reactName,X=[];d!==null&&d!==x;){var se=d,ke=se.alternate,tt=se.stateNode;if(se=se.tag,ke!==null&&ke===x)break;se!==5&&se!==26&&se!==27||tt===null||(ke=tt,M?(tt=Za(d,k),tt!=null&&X.unshift(Gh(d,tt,ke))):M||(tt=Za(d,k),tt!=null&&X.push(Gh(d,tt,ke)))),d=d.return}X.length!==0&&r.push({event:s,listeners:X})}var Xm=/\r\n?/g,jf=/\u0000|\uFFFD/g;function Yp(r){return(typeof r=="string"?r:""+r).replace(Xm,`
`).replace(jf,"")}function Dd(r,s){return s=Yp(s),Yp(r)===s}function Ri(r,s,d,x,M,k){switch(d){case"children":typeof x=="string"?s==="body"||s==="textarea"&&x===""||Is(r,x):(typeof x=="number"||typeof x=="bigint")&&s!=="body"&&Is(r,""+x);break;case"className":Es(r,"class",x);break;case"tabIndex":Es(r,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":Es(r,d,x);break;case"style":Ru(r,x,k);break;case"data":if(s!=="object"){Es(r,"data",x);break}case"src":case"href":if(x===""&&(s!=="a"||d!=="href")){r.removeAttribute(d);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(d);break}x=In(""+x),r.setAttribute(d,x);break;case"action":case"formAction":if(typeof x=="function"){r.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof k=="function"&&(d==="formAction"?(s!=="input"&&Ri(r,s,"name",M.name,M,null),Ri(r,s,"formEncType",M.formEncType,M,null),Ri(r,s,"formMethod",M.formMethod,M,null),Ri(r,s,"formTarget",M.formTarget,M,null)):(Ri(r,s,"encType",M.encType,M,null),Ri(r,s,"method",M.method,M,null),Ri(r,s,"target",M.target,M,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(d);break}x=In(""+x),r.setAttribute(d,x);break;case"onClick":x!=null&&(r.onclick=Aa);break;case"onScroll":x!=null&&Wn("scroll",r);break;case"onScrollEnd":x!=null&&Wn("scrollend",r);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(F(61));if(d=x.__html,d!=null){if(M.children!=null)throw Error(F(60));r.innerHTML=d}}break;case"multiple":r.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":r.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){r.removeAttribute("xlink:href");break}d=In(""+x),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(d,""+x):r.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(d,""):r.removeAttribute(d);break;case"capture":case"download":x===!0?r.setAttribute(d,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(d,x):r.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?r.setAttribute(d,x):r.removeAttribute(d);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?r.removeAttribute(d):r.setAttribute(d,x);break;case"popover":Wn("beforetoggle",r),Wn("toggle",r),Fo(r,"popover",x);break;case"xlinkActuate":ja(r,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":ja(r,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":ja(r,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":ja(r,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":ja(r,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":ja(r,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":ja(r,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":ja(r,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":ja(r,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":Fo(r,"is",x);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=ei.get(d)||d,Fo(r,d,x))}}function vs(r,s,d,x,M,k){switch(d){case"style":Ru(r,x,k);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(F(61));if(d=x.__html,d!=null){if(M.children!=null)throw Error(F(60));r.innerHTML=d}}break;case"children":typeof x=="string"?Is(r,x):(typeof x=="number"||typeof x=="bigint")&&Is(r,""+x);break;case"onScroll":x!=null&&Wn("scroll",r);break;case"onScrollEnd":x!=null&&Wn("scrollend",r);break;case"onClick":x!=null&&(r.onclick=Aa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Tr.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(M=d.endsWith("Capture"),s=d.slice(2,M?d.length-7:void 0),k=r[St]||null,k=k!=null?k[d]:null,typeof k=="function"&&r.removeEventListener(s,k,M),typeof x=="function")){typeof k!="function"&&k!==null&&(d in r?r[d]=null:r.hasAttribute(d)&&r.removeAttribute(d)),r.addEventListener(s,x,M);break e}d in r?r[d]=x:x===!0?r.setAttribute(d,""):Fo(r,d,x)}}}function Rr(r,s,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Wn("error",r),Wn("load",r);var x=!1,M=!1,k;for(k in d)if(d.hasOwnProperty(k)){var X=d[k];if(X!=null)switch(k){case"src":x=!0;break;case"srcSet":M=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(F(137,s));default:Ri(r,s,k,X,d,null)}}M&&Ri(r,s,"srcSet",d.srcSet,d,null),x&&Ri(r,s,"src",d.src,d,null);return;case"input":Wn("invalid",r);var se=k=X=M=null,ke=null,tt=null;for(x in d)if(d.hasOwnProperty(x)){var ft=d[x];if(ft!=null)switch(x){case"name":M=ft;break;case"type":X=ft;break;case"checked":ke=ft;break;case"defaultChecked":tt=ft;break;case"value":k=ft;break;case"defaultValue":se=ft;break;case"children":case"dangerouslySetInnerHTML":if(ft!=null)throw Error(F(137,s));break;default:Ri(r,s,x,ft,d,null)}}Pu(r,k,se,ke,tt,X,M,!1);return;case"select":Wn("invalid",r),x=X=k=null;for(M in d)if(d.hasOwnProperty(M)&&(se=d[M],se!=null))switch(M){case"value":k=se;break;case"defaultValue":X=se;break;case"multiple":x=se;default:Ri(r,s,M,se,d,null)}s=k,d=X,r.multiple=!!x,s!=null?uo(r,!!x,s,!1):d!=null&&uo(r,!!x,d,!0);return;case"textarea":Wn("invalid",r),k=M=x=null;for(X in d)if(d.hasOwnProperty(X)&&(se=d[X],se!=null))switch(X){case"value":x=se;break;case"defaultValue":M=se;break;case"children":k=se;break;case"dangerouslySetInnerHTML":if(se!=null)throw Error(F(91));break;default:Ri(r,s,X,se,d,null)}Cs(r,x,M,k);return;case"option":for(ke in d)if(d.hasOwnProperty(ke)&&(x=d[ke],x!=null))switch(ke){case"selected":r.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:Ri(r,s,ke,x,d,null)}return;case"dialog":Wn("beforetoggle",r),Wn("toggle",r),Wn("cancel",r),Wn("close",r);break;case"iframe":case"object":Wn("load",r);break;case"video":case"audio":for(x=0;x<Bf.length;x++)Wn(Bf[x],r);break;case"image":Wn("error",r),Wn("load",r);break;case"details":Wn("toggle",r);break;case"embed":case"source":case"link":Wn("error",r),Wn("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(tt in d)if(d.hasOwnProperty(tt)&&(x=d[tt],x!=null))switch(tt){case"children":case"dangerouslySetInnerHTML":throw Error(F(137,s));default:Ri(r,s,tt,x,d,null)}return;default:if(qs(s)){for(ft in d)d.hasOwnProperty(ft)&&(x=d[ft],x!==void 0&&vs(r,s,ft,x,d,void 0));return}}for(se in d)d.hasOwnProperty(se)&&(x=d[se],x!=null&&Ri(r,s,se,x,d,null))}function Gf(r,s,d,x){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var M=null,k=null,X=null,se=null,ke=null,tt=null,ft=null;for(st in d){var wt=d[st];if(d.hasOwnProperty(st)&&wt!=null)switch(st){case"checked":break;case"value":break;case"defaultValue":ke=wt;default:x.hasOwnProperty(st)||Ri(r,s,st,null,x,wt)}}for(var nt in x){var st=x[nt];if(wt=d[nt],x.hasOwnProperty(nt)&&(st!=null||wt!=null))switch(nt){case"type":k=st;break;case"name":M=st;break;case"checked":tt=st;break;case"defaultChecked":ft=st;break;case"value":X=st;break;case"defaultValue":se=st;break;case"children":case"dangerouslySetInnerHTML":if(st!=null)throw Error(F(137,s));break;default:st!==wt&&Ri(r,s,nt,st,x,wt)}}ql(r,X,se,ke,tt,ft,k,M);return;case"select":st=X=se=nt=null;for(k in d)if(ke=d[k],d.hasOwnProperty(k)&&ke!=null)switch(k){case"value":break;case"multiple":st=ke;default:x.hasOwnProperty(k)||Ri(r,s,k,null,x,ke)}for(M in x)if(k=x[M],ke=d[M],x.hasOwnProperty(M)&&(k!=null||ke!=null))switch(M){case"value":nt=k;break;case"defaultValue":se=k;break;case"multiple":X=k;default:k!==ke&&Ri(r,s,M,k,x,ke)}s=se,d=X,x=st,nt!=null?uo(r,!!d,nt,!1):!!x!=!!d&&(s!=null?uo(r,!!d,s,!0):uo(r,!!d,d?[]:"",!1));return;case"textarea":st=nt=null;for(se in d)if(M=d[se],d.hasOwnProperty(se)&&M!=null&&!x.hasOwnProperty(se))switch(se){case"value":break;case"children":break;default:Ri(r,s,se,null,x,M)}for(X in x)if(M=x[X],k=d[X],x.hasOwnProperty(X)&&(M!=null||k!=null))switch(X){case"value":nt=M;break;case"defaultValue":st=M;break;case"children":break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(F(91));break;default:M!==k&&Ri(r,s,X,M,x,k)}_c(r,nt,st);return;case"option":for(var tn in d)if(nt=d[tn],d.hasOwnProperty(tn)&&nt!=null&&!x.hasOwnProperty(tn))switch(tn){case"selected":r.selected=!1;break;default:Ri(r,s,tn,null,x,nt)}for(ke in x)if(nt=x[ke],st=d[ke],x.hasOwnProperty(ke)&&nt!==st&&(nt!=null||st!=null))switch(ke){case"selected":r.selected=nt&&typeof nt!="function"&&typeof nt!="symbol";break;default:Ri(r,s,ke,nt,x,st)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var wn in d)nt=d[wn],d.hasOwnProperty(wn)&&nt!=null&&!x.hasOwnProperty(wn)&&Ri(r,s,wn,null,x,nt);for(tt in x)if(nt=x[tt],st=d[tt],x.hasOwnProperty(tt)&&nt!==st&&(nt!=null||st!=null))switch(tt){case"children":case"dangerouslySetInnerHTML":if(nt!=null)throw Error(F(137,s));break;default:Ri(r,s,tt,nt,x,st)}return;default:if(qs(s)){for(var Mi in d)nt=d[Mi],d.hasOwnProperty(Mi)&&nt!==void 0&&!x.hasOwnProperty(Mi)&&vs(r,s,Mi,void 0,x,nt);for(ft in x)nt=x[ft],st=d[ft],!x.hasOwnProperty(ft)||nt===st||nt===void 0&&st===void 0||vs(r,s,ft,nt,x,st);return}}for(var qe in d)nt=d[qe],d.hasOwnProperty(qe)&&nt!=null&&!x.hasOwnProperty(qe)&&Ri(r,s,qe,null,x,nt);for(wt in x)nt=x[wt],st=d[wt],!x.hasOwnProperty(wt)||nt===st||nt==null&&st==null||Ri(r,s,wt,nt,x,st)}function $m(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Wm(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,d=performance.getEntriesByType("resource"),x=0;x<d.length;x++){var M=d[x],k=M.transferSize,X=M.initiatorType,se=M.duration;if(k&&se&&$m(X)){for(X=0,se=M.responseEnd,x+=1;x<d.length;x++){var ke=d[x],tt=ke.startTime;if(tt>se)break;var ft=ke.transferSize,wt=ke.initiatorType;ft&&$m(wt)&&(ke=ke.responseEnd,X+=ft*(ke<se?1:(se-tt)/(ke-tt)))}if(--x,s+=8*(k+X)/(M.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var Pd=null,Rd=null;function bu(r){return r.nodeType===9?r:r.ownerDocument}function qf(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Ld(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function Zf(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var zd=null;function Hp(){var r=window.event;return r&&r.type==="popstate"?r===zd?!1:(zd=r,!0):(zd=null,!1)}var Od=typeof setTimeout=="function"?setTimeout:void 0,Wg=typeof clearTimeout=="function"?clearTimeout:void 0,Qm=typeof Promise=="function"?Promise:void 0,On=typeof queueMicrotask=="function"?queueMicrotask:typeof Qm<"u"?function(r){return Qm.resolve(null).then(r).catch(wu)}:Od;function wu(r){setTimeout(function(){throw r})}function ar(r){return r==="head"}function zo(r,s){var d=s,x=0;do{var M=d.nextSibling;if(r.removeChild(d),M&&M.nodeType===8)if(d=M.data,d==="/$"||d==="/&"){if(x===0){r.removeChild(M),ef(s);return}x--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")x++;else if(d==="html")qh(r.ownerDocument.documentElement);else if(d==="head"){d=r.ownerDocument.head,qh(d);for(var k=d.firstChild;k;){var X=k.nextSibling,se=k.nodeName;k[yn]||se==="SCRIPT"||se==="STYLE"||se==="LINK"&&k.rel.toLowerCase()==="stylesheet"||d.removeChild(k),k=X}}else d==="body"&&qh(r.ownerDocument.body);d=M}while(d);ef(s)}function ac(r,s){var d=r;r=0;do{var x=d.nextSibling;if(d.nodeType===1?s?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(s?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),x&&x.nodeType===8)if(d=x.data,d==="/$"){if(r===0)break;r--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||r++;d=x}while(d)}function Ka(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var d=s;switch(s=s.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":Ka(d),as(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}r.removeChild(d)}}function ia(r,s,d,x){for(;r.nodeType===1;){var M=d;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!x&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(x){if(!r[yn])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(k=r.getAttribute("rel"),k==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(k!==M.rel||r.getAttribute("href")!==(M.href==null||M.href===""?null:M.href)||r.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin)||r.getAttribute("title")!==(M.title==null?null:M.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(k=r.getAttribute("src"),(k!==(M.src==null?null:M.src)||r.getAttribute("type")!==(M.type==null?null:M.type)||r.getAttribute("crossorigin")!==(M.crossOrigin==null?null:M.crossOrigin))&&k&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var k=M.name==null?null:""+M.name;if(M.type==="hidden"&&r.getAttribute("name")===k)return r}else return r;if(r=Oo(r.nextSibling),r===null)break}return null}function ra(r,s,d){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!d||(r=Oo(r.nextSibling),r===null))return null;return r}function Xp(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=Oo(r.nextSibling),r===null))return null;return r}function xs(r){return r.data==="$?"||r.data==="$~"}function jr(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function Nd(r,s){var d=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||d.readyState!=="loading")s();else{var x=function(){s(),d.removeEventListener("DOMContentLoaded",x)};d.addEventListener("DOMContentLoaded",x),r._reactRetry=x}}function Oo(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var Bd=null;function sc(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"||d==="/&"){if(s===0)return Oo(r.nextSibling);s--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||s++}r=r.nextSibling}return null}function $c(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(s===0)return r;s--}else d!=="/$"&&d!=="/&"||s++}r=r.previousSibling}return null}function Km(r,s,d){switch(s=bu(d),r){case"html":if(r=s.documentElement,!r)throw Error(F(452));return r;case"head":if(r=s.head,!r)throw Error(F(453));return r;case"body":if(r=s.body,!r)throw Error(F(454));return r;default:throw Error(F(451))}}function qh(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);as(r)}var ro=new Map,$p=new Set;function Zh(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Fl=Tt.d;Tt.d={f:Wp,r:Ja,D:oc,C:Fd,L:Qp,m:Jm,X:tg,S:eg,M:ng};function Wp(){var r=Fl.f(),s=Rf();return r||s}function Ja(r){var s=js(r);s!==null&&s.tag===5&&s.type==="form"?ta(s):Fl.r(r)}var es=typeof document>"u"?null:document;function Fa(r,s,d){var x=es;if(x&&typeof s=="string"&&s){var M=lr(s);M='link[rel="'+r+'"][href="'+M+'"]',typeof d=="string"&&(M+='[crossorigin="'+d+'"]'),$p.has(M)||($p.add(M),r={rel:r,crossOrigin:d,href:s},x.querySelector(M)===null&&(s=x.createElement("link"),Rr(s,"link",r),xi(s),x.head.appendChild(s)))}}function oc(r){Fl.D(r),Fa("dns-prefetch",r,null)}function Fd(r,s){Fl.C(r,s),Fa("preconnect",r,s)}function Qp(r,s,d){Fl.L(r,s,d);var x=es;if(x&&r&&s){var M='link[rel="preload"][as="'+lr(s)+'"]';s==="image"&&d&&d.imageSrcSet?(M+='[imagesrcset="'+lr(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(M+='[imagesizes="'+lr(d.imageSizes)+'"]')):M+='[href="'+lr(r)+'"]';var k=M;switch(s){case"style":k=Tu(r);break;case"script":k=lc(r)}ro.has(k)||(r=ce({rel:"preload",href:s==="image"&&d&&d.imageSrcSet?void 0:r,as:s},d),ro.set(k,r),x.querySelector(M)!==null||s==="style"&&x.querySelector(Yh(k))||s==="script"&&x.querySelector(Xh(k))||(s=x.createElement("link"),Rr(s,"link",r),xi(s),x.head.appendChild(s)))}}function Jm(r,s){Fl.m(r,s);var d=es;if(d&&r){var x=s&&typeof s.as=="string"?s.as:"script",M='link[rel="modulepreload"][as="'+lr(x)+'"][href="'+lr(r)+'"]',k=M;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":k=lc(r)}if(!ro.has(k)&&(r=ce({rel:"modulepreload",href:r},s),ro.set(k,r),d.querySelector(M)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(Xh(k)))return}x=d.createElement("link"),Rr(x,"link",r),xi(x),d.head.appendChild(x)}}}function eg(r,s,d){Fl.S(r,s,d);var x=es;if(x&&r){var M=Ia(x).hoistableStyles,k=Tu(r);s=s||"default";var X=M.get(k);if(!X){var se={loading:0,preload:null};if(X=x.querySelector(Yh(k)))se.loading=5;else{r=ce({rel:"stylesheet",href:r,"data-precedence":s},d),(d=ro.get(k))&&$h(r,d);var ke=X=x.createElement("link");xi(ke),Rr(ke,"link",r),ke._p=new Promise(function(tt,ft){ke.onload=tt,ke.onerror=ft}),ke.addEventListener("load",function(){se.loading|=1}),ke.addEventListener("error",function(){se.loading|=2}),se.loading|=4,Yf(X,s,x)}X={type:"stylesheet",instance:X,count:1,state:se},M.set(k,X)}}}function tg(r,s){Fl.X(r,s);var d=es;if(d&&r){var x=Ia(d).hoistableScripts,M=lc(r),k=x.get(M);k||(k=d.querySelector(Xh(M)),k||(r=ce({src:r,async:!0},s),(s=ro.get(M))&&Wh(r,s),k=d.createElement("script"),xi(k),Rr(k,"link",r),d.head.appendChild(k)),k={type:"script",instance:k,count:1,state:null},x.set(M,k))}}function ng(r,s){Fl.M(r,s);var d=es;if(d&&r){var x=Ia(d).hoistableScripts,M=lc(r),k=x.get(M);k||(k=d.querySelector(Xh(M)),k||(r=ce({src:r,async:!0,type:"module"},s),(s=ro.get(M))&&Wh(r,s),k=d.createElement("script"),xi(k),Rr(k,"link",r),d.head.appendChild(k)),k={type:"script",instance:k,count:1,state:null},x.set(M,k))}}function Vd(r,s,d,x){var M=(M=Mn.current)?Zh(M):null;if(!M)throw Error(F(446));switch(r){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(s=Tu(d.href),d=Ia(M).hoistableStyles,x=d.get(s),x||(x={type:"style",instance:null,count:0,state:null},d.set(s,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){r=Tu(d.href);var k=Ia(M).hoistableStyles,X=k.get(r);if(X||(M=M.ownerDocument||M,X={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},k.set(r,X),(k=M.querySelector(Yh(r)))&&!k._p&&(X.instance=k,X.state.loading=5),ro.has(r)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},ro.set(r,d),k||Hh(M,r,d,X.state))),s&&x===null)throw Error(F(528,""));return X}if(s&&x!==null)throw Error(F(529,""));return null;case"script":return s=d.async,d=d.src,typeof d=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=lc(d),d=Ia(M).hoistableScripts,x=d.get(s),x||(x={type:"script",instance:null,count:0,state:null},d.set(s,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(F(444,r))}}function Tu(r){return'href="'+lr(r)+'"'}function Yh(r){return'link[rel="stylesheet"]['+r+"]"}function Kp(r){return ce({},r,{"data-precedence":r.precedence,precedence:null})}function Hh(r,s,d,x){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?x.loading=1:(s=r.createElement("link"),x.preload=s,s.addEventListener("load",function(){return x.loading|=1}),s.addEventListener("error",function(){return x.loading|=2}),Rr(s,"link",d),xi(s),r.head.appendChild(s))}function lc(r){return'[src="'+lr(r)+'"]'}function Xh(r){return"script[async]"+r}function ig(r,s,d){if(s.count++,s.instance===null)switch(s.type){case"style":var x=r.querySelector('style[data-href~="'+lr(d.href)+'"]');if(x)return s.instance=x,xi(x),x;var M=ce({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return x=(r.ownerDocument||r).createElement("style"),xi(x),Rr(x,"style",M),Yf(x,d.precedence,r),s.instance=x;case"stylesheet":M=Tu(d.href);var k=r.querySelector(Yh(M));if(k)return s.state.loading|=4,s.instance=k,xi(k),k;x=Kp(d),(M=ro.get(M))&&$h(x,M),k=(r.ownerDocument||r).createElement("link"),xi(k);var X=k;return X._p=new Promise(function(se,ke){X.onload=se,X.onerror=ke}),Rr(k,"link",x),s.state.loading|=4,Yf(k,d.precedence,r),s.instance=k;case"script":return k=lc(d.src),(M=r.querySelector(Xh(k)))?(s.instance=M,xi(M),M):(x=d,(M=ro.get(k))&&(x=ce({},d),Wh(x,M)),r=r.ownerDocument||r,M=r.createElement("script"),xi(M),Rr(M,"link",x),r.head.appendChild(M),s.instance=M);case"void":return null;default:throw Error(F(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(x=s.instance,s.state.loading|=4,Yf(x,d.precedence,r));return s.instance}function Yf(r,s,d){for(var x=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),M=x.length?x[x.length-1]:null,k=M,X=0;X<x.length;X++){var se=x[X];if(se.dataset.precedence===s)k=se;else if(k!==M)break}k?k.parentNode.insertBefore(r,k.nextSibling):(s=d.nodeType===9?d.head:d,s.insertBefore(r,s.firstChild))}function $h(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function Wh(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Wc=null;function Ud(r,s,d){if(Wc===null){var x=new Map,M=Wc=new Map;M.set(d,x)}else M=Wc,x=M.get(d),x||(x=new Map,M.set(d,x));if(x.has(r))return x;for(x.set(r,null),d=d.getElementsByTagName(r),M=0;M<d.length;M++){var k=d[M];if(!(k[yn]||k[li]||r==="link"&&k.getAttribute("rel")==="stylesheet")&&k.namespaceURI!=="http://www.w3.org/2000/svg"){var X=k.getAttribute(s)||"";X=r+X;var se=x.get(X);se?se.push(k):x.set(X,[k])}}return x}function jd(r,s,d){r=r.ownerDocument||r,r.head.insertBefore(d,s==="title"?r.querySelector("head > title"):null)}function Jp(r,s,d){if(d===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return r=s.disabled,typeof s.precedence=="string"&&r==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function em(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function rg(r,s,d,x){if(d.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var M=Tu(x.href),k=s.querySelector(Yh(M));if(k){s=k._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=Hf.bind(r),s.then(r,r)),d.state.loading|=4,d.instance=k,xi(k);return}k=s.ownerDocument||s,x=Kp(x),(M=ro.get(M))&&$h(x,M),k=k.createElement("link"),xi(k);var X=k;X._p=new Promise(function(se,ke){X.onload=se,X.onerror=ke}),Rr(k,"link",x),d.instance=k}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(d,s),(s=d.state.preload)&&(d.state.loading&3)===0&&(r.count++,d=Hf.bind(r),s.addEventListener("load",d),s.addEventListener("error",d))}}var Gd=0;function ag(r,s){return r.stylesheets&&r.count===0&&Xf(r,r.stylesheets),0<r.count||0<r.imgCount?function(d){var x=setTimeout(function(){if(r.stylesheets&&Xf(r,r.stylesheets),r.unsuspend){var k=r.unsuspend;r.unsuspend=null,k()}},6e4+s);0<r.imgBytes&&Gd===0&&(Gd=62500*Wm());var M=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Xf(r,r.stylesheets),r.unsuspend)){var k=r.unsuspend;r.unsuspend=null,k()}},(r.imgBytes>Gd?50:800)+s);return r.unsuspend=d,function(){r.unsuspend=null,clearTimeout(x),clearTimeout(M)}}:null}function Hf(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Xf(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var qd=null;function Xf(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,qd=new Map,s.forEach(Qg,r),qd=null,Hf.call(r))}function Qg(r,s){if(!(s.state.loading&4)){var d=qd.get(r);if(d)var x=d.get(null);else{d=new Map,qd.set(r,d);for(var M=r.querySelectorAll("link[data-precedence],style[data-precedence]"),k=0;k<M.length;k++){var X=M[k];(X.nodeName==="LINK"||X.getAttribute("media")!=="not all")&&(d.set(X.dataset.precedence,X),x=X)}x&&d.set(null,x)}M=s.instance,X=M.getAttribute("data-precedence"),k=d.get(X)||x,k===x&&d.set(null,M),d.set(X,M),this.count++,x=Hf.bind(this),M.addEventListener("load",x),M.addEventListener("error",x),k?k.parentNode.insertBefore(M,k.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(M,r.firstChild)),s.state.loading|=4}}var $f={$$typeof:rt,Provider:null,Consumer:null,_currentValue:$t,_currentValue2:$t,_threadCount:0};function tm(r,s,d,x,M,k,X,se,ke){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Zi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Zi(0),this.hiddenUpdates=Zi(null),this.identifierPrefix=x,this.onUncaughtError=M,this.onCaughtError=k,this.onRecoverableError=X,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ke,this.incompleteTransitions=new Map}function nm(r,s,d,x,M,k,X,se,ke,tt,ft,wt){return r=new tm(r,s,d,X,ke,tt,ft,wt,se),s=1,k===!0&&(s|=24),k=cs(3,null,null,s),r.current=k,k.stateNode=r,s=Cl(),s.refCount++,r.pooledCache=s,s.refCount++,k.memoizedState={element:x,isDehydrated:d,cache:s},wh(k),r}function sg(r){return r?(r=kn,r):kn}function og(r,s,d,x,M,k){M=sg(M),x.context===null?x.context=M:x.pendingContext=M,x=qn(s),x.payload={element:d},k=k===void 0?null:k,k!==null&&(x.callback=k),d=Jo(r,x,s),d!==null&&(Os(d,r,s),Pl(d,r,s))}function im(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<s?d:s}}function Qc(r,s){im(r,s),(r=r.alternate)&&im(r,s)}function rm(r){if(r.tag===13||r.tag===31){var s=Da(r,67108864);s!==null&&Os(s,r,67108864),Qc(r,67108864)}}function lg(r){if(r.tag===13||r.tag===31){var s=pi();s=Ca(s);var d=Da(r,s);d!==null&&Os(d,r,s),Qc(r,s)}}var Qh=!0;function am(r,s,d,x){var M=Je.T;Je.T=null;var k=Tt.p;try{Tt.p=2,uc(r,s,d,x)}finally{Tt.p=k,Je.T=M}}function ug(r,s,d,x){var M=Je.T;Je.T=null;var k=Tt.p;try{Tt.p=8,uc(r,s,d,x)}finally{Tt.p=k,Je.T=M}}function uc(r,s,d,x){if(Qh){var M=Zd(x);if(M===null)kd(r,s,x,Yd,d),om(r,x);else if(Jg(M,r,s,d,x))x.stopPropagation();else if(om(r,x),s&4&&-1<Kg.indexOf(r)){for(;M!==null;){var k=js(M);if(k!==null)switch(k.tag){case 3:if(k=k.stateNode,k.current.memoizedState.isDehydrated){var X=Ge(k.pendingLanes);if(X!==0){var se=k;for(se.pendingLanes|=2,se.entangledLanes|=2;X;){var ke=1<<31-ut(X);se.entanglements[1]|=ke,X&=~ke}cl(k),(di&6)===0&&(kf=ln()+500,Xc(0))}}break;case 31:case 13:se=Da(k,2),se!==null&&Os(se,k,2),Rf(),Qc(k,2)}if(k=Zd(x),k===null&&kd(r,s,x,Yd,d),k===M)break;M=k}M!==null&&x.stopPropagation()}else kd(r,s,x,null,d)}}function Zd(r){return r=Xr(r),Kc(r)}var Yd=null;function Kc(r){if(Yd=null,r=ui(r),r!==null){var s=ee(r);if(s===null)r=null;else{var d=s.tag;if(d===13){if(r=L(s),r!==null)return r;r=null}else if(d===31){if(r=f(s),r!==null)return r;r=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return Yd=r,null}function cg(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(wr()){case je:return 2;case te:return 8;case J:case oe:return 32;case ve:return 268435456;default:return 32}default:return 32}}var sm=!1,Su=null,Eu=null,cc=null,Wf=new Map,Qf=new Map,hc=[],Kg="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function om(r,s){switch(r){case"focusin":case"focusout":Su=null;break;case"dragenter":case"dragleave":Eu=null;break;case"mouseover":case"mouseout":cc=null;break;case"pointerover":case"pointerout":Wf.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qf.delete(s.pointerId)}}function fl(r,s,d,x,M,k){return r===null||r.nativeEvent!==k?(r={blockedOn:s,domEventName:d,eventSystemFlags:x,nativeEvent:k,targetContainers:[M]},s!==null&&(s=js(s),s!==null&&rm(s)),r):(r.eventSystemFlags|=x,s=r.targetContainers,M!==null&&s.indexOf(M)===-1&&s.push(M),r)}function Jg(r,s,d,x,M){switch(s){case"focusin":return Su=fl(Su,r,s,d,x,M),!0;case"dragenter":return Eu=fl(Eu,r,s,d,x,M),!0;case"mouseover":return cc=fl(cc,r,s,d,x,M),!0;case"pointerover":var k=M.pointerId;return Wf.set(k,fl(Wf.get(k)||null,r,s,d,x,M)),!0;case"gotpointercapture":return k=M.pointerId,Qf.set(k,fl(Qf.get(k)||null,r,s,d,x,M)),!0}return!1}function Kh(r){var s=ui(r.target);if(s!==null){var d=ee(s);if(d!==null){if(s=d.tag,s===13){if(s=L(d),s!==null){r.blockedOn=s,Zr(r.priority,function(){lg(d)});return}}else if(s===31){if(s=f(d),s!==null){r.blockedOn=s,Zr(r.priority,function(){lg(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Hd(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var d=Zd(r.nativeEvent);if(d===null){d=r.nativeEvent;var x=new d.constructor(d.type,d);ga=x,d.target.dispatchEvent(x),ga=null}else return s=js(d),s!==null&&rm(s),r.blockedOn=d,!1;s.shift()}return!0}function hg(r,s,d){Hd(r)&&d.delete(s)}function e_(){sm=!1,Su!==null&&Hd(Su)&&(Su=null),Eu!==null&&Hd(Eu)&&(Eu=null),cc!==null&&Hd(cc)&&(cc=null),Wf.forEach(hg),Qf.forEach(hg)}function Jh(r,s){r.blockedOn===s&&(r.blockedOn=null,sm||(sm=!0,R.unstable_scheduleCallback(R.unstable_NormalPriority,e_)))}var Kf=null;function fg(r){Kf!==r&&(Kf=r,R.unstable_scheduleCallback(R.unstable_NormalPriority,function(){Kf===r&&(Kf=null);for(var s=0;s<r.length;s+=3){var d=r[s],x=r[s+1],M=r[s+2];if(typeof x!="function"){if(Kc(x||d)===null)continue;break}var k=js(d);k!==null&&(r.splice(s,3),s-=3,Qi(k,{pending:!0,data:M,method:d.method,action:x},x,M))}}))}function ef(r){function s(ke){return Jh(ke,r)}Su!==null&&Jh(Su,r),Eu!==null&&Jh(Eu,r),cc!==null&&Jh(cc,r),Wf.forEach(s),Qf.forEach(s);for(var d=0;d<hc.length;d++){var x=hc[d];x.blockedOn===r&&(x.blockedOn=null)}for(;0<hc.length&&(d=hc[0],d.blockedOn===null);)Kh(d),d.blockedOn===null&&hc.shift();if(d=(r.ownerDocument||r).$$reactFormReplay,d!=null)for(x=0;x<d.length;x+=3){var M=d[x],k=d[x+1],X=M[St]||null;if(typeof k=="function")X||fg(d);else if(X){var se=null;if(k&&k.hasAttribute("formAction")){if(M=k,X=k[St]||null)se=X.formAction;else if(Kc(M)!==null)continue}else se=X.action;typeof se=="function"?d[x+1]=se:(d.splice(x,3),x-=3),fg(d)}}}function lm(){function r(k){k.canIntercept&&k.info==="react-transition"&&k.intercept({handler:function(){return new Promise(function(X){return M=X})},focusReset:"manual",scroll:"manual"})}function s(){M!==null&&(M(),M=null),x||setTimeout(d,20)}function d(){if(!x&&!navigation.transition){var k=navigation.currentEntry;k&&k.url!=null&&navigation.navigate(k.url,{state:k.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var x=!1,M=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(d,100),function(){x=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),M!==null&&(M(),M=null)}}}function Xd(r){this._internalRoot=r}$d.prototype.render=Xd.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(F(409));var d=s.current,x=pi();og(d,x,r,s,null,null)},$d.prototype.unmount=Xd.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;og(r.current,2,null,r,null,null),Rf(),s[bn]=null}};function $d(r){this._internalRoot=r}$d.prototype.unstable_scheduleHydration=function(r){if(r){var s=mr();r={blockedOn:null,target:r,priority:s};for(var d=0;d<hc.length&&s!==0&&s<hc[d].priority;d++);hc.splice(d,0,r),d===0&&Kh(r)}};var um=B.version;if(um!=="19.2.3")throw Error(F(527,um,"19.2.3"));Tt.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(F(188)):(r=Object.keys(r).join(","),Error(F(268,r)));return r=ge(s),r=r!==null?Te(r):null,r=r===null?null:r.stateNode,r};var dg={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:Je,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wd.isDisabled&&Wd.supportsFiber)try{Ve=Wd.inject(dg),De=Wd}catch{}}return pm.createRoot=function(r,s){if(!U(r))throw Error(F(299));var d=!1,x="",M=zl,k=ol,X=_f;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(x=s.identifierPrefix),s.onUncaughtError!==void 0&&(M=s.onUncaughtError),s.onCaughtError!==void 0&&(k=s.onCaughtError),s.onRecoverableError!==void 0&&(X=s.onRecoverableError)),s=nm(r,1,!1,null,null,d,x,null,M,k,X,lm),r[bn]=s.current,Ad(r),new Xd(s)},pm.hydrateRoot=function(r,s,d){if(!U(r))throw Error(F(299));var x=!1,M="",k=zl,X=ol,se=_f,ke=null;return d!=null&&(d.unstable_strictMode===!0&&(x=!0),d.identifierPrefix!==void 0&&(M=d.identifierPrefix),d.onUncaughtError!==void 0&&(k=d.onUncaughtError),d.onCaughtError!==void 0&&(X=d.onCaughtError),d.onRecoverableError!==void 0&&(se=d.onRecoverableError),d.formState!==void 0&&(ke=d.formState)),s=nm(r,1,!0,s,d??null,x,M,ke,k,X,se,lm),s.context=sg(null),d=s.current,x=pi(),x=Ca(x),M=qn(x),M.callback=null,Jo(d,M,x),d=x,s.current.lanes=d,Xn(s,d),cl(s),r[bn]=s.current,Ad(r),new $d(s)},pm.version="19.2.3",pm}var X_;function Sv(){if(X_)return f_.exports;X_=1;function R(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(R)}catch(B){console.error(B)}}return R(),f_.exports=Tv(),f_.exports}var Ev=Sv(),Sg={exports:{}};var Mv=Sg.exports,$_;function Cv(){return $_||($_=1,(function(R,B){(function(Y,F){R.exports=F()})(Mv,(function(){var Y={},F={};function U(L,f,ue){if(F[L]=ue,L==="index"){var ge="var sharedModule = {}; ("+F.shared+")(sharedModule); ("+F.worker+")(sharedModule);",Te={};return F.shared(Te),F.index(Y,Te),typeof window<"u"&&Y.setWorkerUrl(window.URL.createObjectURL(new Blob([ge],{type:"text/javascript"}))),Y}}U("shared",["exports"],(function(L){function f(i,e,n,l){return new(n||(n=Promise))((function(h,m){function y(I){try{S(l.next(I))}catch(D){m(D)}}function w(I){try{S(l.throw(I))}catch(D){m(D)}}function S(I){var D;I.done?h(I.value):(D=I.value,D instanceof n?D:new n((function(O){O(D)}))).then(y,w)}S((l=l.apply(i,e||[])).next())}))}function ue(i,e){this.x=i,this.y=e}function ge(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Te,ce;typeof SuppressedError=="function"&&SuppressedError,ue.prototype={clone(){return new ue(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround(i,e){const n=Math.cos(i),l=Math.sin(i),h=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ue},ue.convert=function(i){if(i instanceof ue)return i;if(Array.isArray(i))return new ue(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new ue(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var Pe=(function(){if(ce)return Te;function i(e,n,l,h){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=h}return ce=1,Te=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,h=0;h<8;h++){var m=this.sampleCurveX(l)-e;if(Math.abs(m)<n)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=m/y}var w=0,S=1;for(l=e,h=0;h<20&&(m=this.sampleCurveX(l),!(Math.abs(m-e)<n));h++)e>m?w=l:S=l,l=.5*(S-w)+w;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Te})(),Oe=ge(Pe);let Fe,at;function Ie(){return Fe==null&&(Fe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Fe}function Et(){if(at==null&&(at=!1,Ie())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<25;l++){const h=4*l;e.fillStyle=`rgb(${h},${h+1},${h+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&n[l]!==l){at=!0;break}}}return at||!1}var vt=1e-6,rt=typeof Float32Array<"u"?Float32Array:Array;function At(){var i=new rt(9);return rt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function Mt(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Lt(){var i=new rt(3);return rt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function _t(i){var e=i[0],n=i[1],l=i[2];return Math.sqrt(e*e+n*n+l*l)}function Gt(i,e,n){var l=new rt(3);return l[0]=i,l[1]=e,l[2]=n,l}function Ft(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function xn(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function dn(i,e,n){var l=e[0],h=e[1],m=e[2],y=n[0],w=n[1],S=n[2];return i[0]=h*S-m*w,i[1]=m*y-l*S,i[2]=l*w-h*y,i}var sn,En=_t;function Rt(i,e,n){var l=e[0],h=e[1],m=e[2],y=e[3];return i[0]=n[0]*l+n[4]*h+n[8]*m+n[12]*y,i[1]=n[1]*l+n[5]*h+n[9]*m+n[13]*y,i[2]=n[2]*l+n[6]*h+n[10]*m+n[14]*y,i[3]=n[3]*l+n[7]*h+n[11]*m+n[15]*y,i}function fn(){var i=new rt(4);return rt!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function Je(i,e,n,l){var h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",m=Math.PI/360;e*=m,l*=m,n*=m;var y=Math.sin(e),w=Math.cos(e),S=Math.sin(n),I=Math.cos(n),D=Math.sin(l),O=Math.cos(l);switch(h){case"xyz":i[0]=y*I*O+w*S*D,i[1]=w*S*O-y*I*D,i[2]=w*I*D+y*S*O,i[3]=w*I*O-y*S*D;break;case"xzy":i[0]=y*I*O-w*S*D,i[1]=w*S*O-y*I*D,i[2]=w*I*D+y*S*O,i[3]=w*I*O+y*S*D;break;case"yxz":i[0]=y*I*O+w*S*D,i[1]=w*S*O-y*I*D,i[2]=w*I*D-y*S*O,i[3]=w*I*O+y*S*D;break;case"yzx":i[0]=y*I*O+w*S*D,i[1]=w*S*O+y*I*D,i[2]=w*I*D-y*S*O,i[3]=w*I*O-y*S*D;break;case"zxy":i[0]=y*I*O-w*S*D,i[1]=w*S*O+y*I*D,i[2]=w*I*D+y*S*O,i[3]=w*I*O-y*S*D;break;case"zyx":i[0]=y*I*O-w*S*D,i[1]=w*S*O+y*I*D,i[2]=w*I*D-y*S*O,i[3]=w*I*O+y*S*D;break;default:throw new Error("Unknown angle order "+h)}return i}function Tt(){var i=new rt(2);return rt!=Float32Array&&(i[0]=0,i[1]=0),i}function $t(i,e){var n=new rt(2);return n[0]=i,n[1]=e,n}Lt(),sn=new rt(4),rt!=Float32Array&&(sn[0]=0,sn[1]=0,sn[2]=0,sn[3]=0),Lt(),Gt(1,0,0),Gt(0,1,0),fn(),fn(),At(),Tt();const Ht=8192;function Pt(i,e,n){return e*(Ht/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function Re(i,e){return(i%e+e)%e}function lt(i,e,n){return i*(1-n)+e*n}function zt(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Ct(i,e,n,l){const h=new Oe(i,e,n,l);return m=>h.solve(m)}const en=Ct(.25,.1,.25,1);function Mn(i,e,n){return Math.min(n,Math.max(e,i))}function Rn(i,e,n){const l=n-e,h=((i-e)%l+l)%l+e;return h===e?n:h}function Ue(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}let yi=1;function Ln(i,e,n){const l={};for(const h in i)l[h]=e.call(this,i[h],h,i);return l}function rn(i,e,n){const l={};for(const h in i)e.call(this,i[h],h,i)&&(l[h]=i[h]);return l}function Se(i){return Array.isArray(i)?i.map(Se):typeof i=="object"&&i?Ln(i,Se):i}const oa={};function vi(i){oa[i]||(typeof console<"u"&&console.warn(i),oa[i]=!0)}function er(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Ma(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Ai=null;function Vs(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Dt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Us(i,e,n,l,h){return f(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(i,{timestamp:0});try{const y=m?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const w=y.startsWith("BGR"),S=new Uint8ClampedArray(l*h*4);if(yield m.copyTo(S,(function(I,D,O,j,G){const H=4*Math.max(-D,0),W=(Math.max(0,O)-O)*j*4+H,K=4*j,ie=Math.max(0,D),ye=Math.max(0,O);return{rect:{x:ie,y:ye,width:Math.min(I.width,D+j)-ie,height:Math.min(I.height,O+G)-ye},layout:[{offset:W,stride:K}]}})(i,e,n,l,h)),w)for(let I=0;I<S.length;I+=4){const D=S[I];S[I]=S[I+2],S[I+2]=D}return S}finally{m.close()}}))}let rs,zr;function pl(i,e,n,l){return i.addEventListener(e,n,l),{unsubscribe:()=>{i.removeEventListener(e,n,l)}}}function ln(i){return i*Math.PI/180}function wr(i){return i/Math.PI*180}const je={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},te={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},J="AbortError";class oe extends Error{constructor(e=J){super(e instanceof Error?e.message:e),this.name=J,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function ve(i){return i.name===J}const xe={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function He(i){return xe.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Ve="global-dispatcher";class De extends Error{constructor(e,n,l,h){super(`AJAXError: ${n} (${e}): ${l}`),this.status=e,this.statusText=n,this.url=l,this.body=h}}const Le=()=>Ma(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ut=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=He(i.url);if(l)return l(i,e);if(Ma(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Ve},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Le())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,h){return f(this,void 0,void 0,(function*(){const m=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:Le(),signal:h.signal});let y,w;l.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");try{y=yield fetch(m)}catch(I){throw ve(I)?I:new De(0,I.message,l.url,new Blob)}if(!y.ok){const I=yield y.blob();throw new De(y.status,y.statusText,l.url,I)}w=l.type==="arrayBuffer"||l.type==="image"?y.arrayBuffer():l.type==="json"?y.json():y.text();const S=yield w;return h.signal.throwIfAborted(),{data:S,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}}))})(i,e);if(Ma(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Ve},e)}var n;return(function(l,h){return new Promise(((m,y)=>{var w;const S=new XMLHttpRequest;S.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(S.responseType="arraybuffer");for(const I in l.headers)S.setRequestHeader(I,l.headers[I]);l.type==="json"&&(S.responseType="text",!((w=l.headers)===null||w===void 0)&&w.Accept||S.setRequestHeader("Accept","application/json")),S.withCredentials=l.credentials==="include",S.onerror=()=>{y(new Error(S.statusText))},S.onload=()=>{if(!h.signal.aborted)if((S.status>=200&&S.status<300||S.status===0)&&S.response!==null){let I=S.response;if(l.type==="json")try{I=JSON.parse(S.response)}catch(D){return void y(D)}m({data:I,cacheControl:S.getResponseHeader("Cache-Control"),expires:S.getResponseHeader("Expires")})}else{const I=new Blob([S.response],{type:S.getResponseHeader("Content-Type")});y(new De(S.status,S.statusText,l.url,I))}},h.signal.addEventListener("abort",(()=>{S.abort(),y(new oe(h.signal.reason))})),S.send(l.body)}))})(i,e)};function ht(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Ut(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function qt(i,e,n){if(n&&n[i]){const l=n[i].indexOf(e);l!==-1&&n[i].splice(l,1)}}class pn{constructor(e,n={}){Ue(this,n),this.type=e}}class Dn extends pn{constructor(e,n={}){super("error",Ue({error:e},n))}}class Fn{on(e,n){return this._listeners=this._listeners||{},Ut(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return qt(e,n,this._listeners),qt(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Ut(e,n,this._oneTimeListeners),this):new Promise((l=>this.once(e,l)))}fire(e,n){typeof e=="string"&&(e=new pn(e,n||{}));const l=e.type;if(this.listens(l)){e.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of h)w.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of m)qt(l,w,this._oneTimeListeners),w.call(this,e);const y=this._eventedParent;y&&(Ue(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Dn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var Ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Jn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qi(i,e){const n={};for(const l in i)l!=="ref"&&(n[l]=i[l]);return Jn.forEach((l=>{l in e&&(n[l]=e[l])})),n}function gn(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!gn(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!gn(i[n],e[n]))return!1;return!0}return i===e}function xt(i,e){i.push(e)}function Zi(i,e,n){xt(n,{command:"addSource",args:[i,e[i]]})}function Xn(i,e,n){xt(e,{command:"removeSource",args:[i]}),n[i]=!0}function Ci(i,e,n,l){Xn(i,n,l),Zi(i,e,n)}function ni(i,e,n){let l;for(l in i[n])if(Object.prototype.hasOwnProperty.call(i[n],l)&&l!=="data"&&!gn(i[n][l],e[n][l]))return!1;for(l in e[n])if(Object.prototype.hasOwnProperty.call(e[n],l)&&l!=="data"&&!gn(i[n][l],e[n][l]))return!1;return!0}function Ni(i,e,n,l,h,m){i=i||{},e=e||{};for(const y in i)Object.prototype.hasOwnProperty.call(i,y)&&(gn(i[y],e[y])||n.push({command:m,args:[l,y,e[y],h]}));for(const y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(i,y)&&(gn(i[y],e[y])||n.push({command:m,args:[l,y,e[y],h]}))}function Bo(i){return i.id}function Ca(i,e){return i[e.id]=e,i}class It{constructor(e,n,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function mr(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}class Zr extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Va{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,h]of n)this.bindings[l]=h}concat(e){return new Va(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const li={kind:"null"},St={kind:"number"},bn={kind:"string"},Tn={kind:"boolean"},gr={kind:"color"},ws={kind:"projectionDefinition"},Ua={kind:"object"},yn={kind:"value"},as={kind:"collator"},ui={kind:"formatted"},js={kind:"padding"},Ts={kind:"colorArray"},Ia={kind:"numberArray"},xi={kind:"resolvedImage"},lo={kind:"variableAnchorOffsetCollection"};function Tr(i,e){return{kind:"array",itemType:i,N:e}}function Vn(i){if(i.kind==="array"){const e=Vn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Gs=[li,St,bn,Tn,gr,ws,ui,Ua,Tr(yn),js,Ia,Ts,xi,lo];function Yr(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Yr(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Gs)if(!Yr(n,e))return null}}return`Expected ${Vn(i)} but found ${Vn(e)} instead.`}function ss(i,e){return e.some((n=>n.kind===i.kind))}function Ss(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function Hr(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Fo=.96422,Es=.82521,ja=4/29,Yn=6/29,Du=3*Yn*Yn,mc=Yn*Yn*Yn,Ms=Math.PI/180,os=180/Math.PI;function Ga(i){return(i%=360)<0&&(i+=360),i}function gc([i,e,n,l]){let h,m;const y=ql((.2225045*(i=lr(i))+.7168786*(e=lr(e))+.0606169*(n=lr(n)))/1);i===e&&e===n?h=m=y:(h=ql((.4360747*i+.3850649*e+.1430804*n)/Fo),m=ql((.0139322*i+.0971045*e+.7141733*n)/Es));const w=116*y-16;return[w<0?0:w,500*(h-y),200*(y-m),l]}function lr(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function ql(i){return i>mc?Math.pow(i,1/3):i/Du+ja}function Pu([i,e,n,l]){let h=(i+16)/116,m=isNaN(e)?h:h+e/500,y=isNaN(n)?h:h-n/200;return h=1*uo(h),m=Fo*uo(m),y=Es*uo(y),[Zl(3.1338561*m-1.6168667*h-.4906146*y),Zl(-.9787684*m+1.9161415*h+.033454*y),Zl(.0719453*m-.2289914*h+1.4052427*y),l]}function Zl(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function uo(i){return i>Yn?i*i*i:Du*(i-ja)}const _c=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Cs(i,e){return _c(i,e)?i[e]:void 0}function Is(i){return parseInt(i.padEnd(2,i),16)/255}function ih(i,e){return co(e?i/100:i,0,1)}function co(i,e,n){return Math.min(Math.max(e,i),n)}function Ru(i){return!i.some(Number.isNaN)}const qs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ei(i,e,n){return i+n*(e-i)}function qa(i,e,n){return i.map(((l,h)=>ei(l,e[h],n)))}class In{constructor(e,n,l,h=1,m=!0){this.r=e,this.g=n,this.b=l,this.a=h,m||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[e,n,l,h]))}static parse(e){if(e instanceof In)return e;if(typeof e!="string")return;const n=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Cs(qs,l);if(h){const[y,w,S]=h;return[y/255,w/255,S/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const y=l.length<6?1:2;let w=1;return[Is(l.slice(w,w+=y)),Is(l.slice(w,w+=y)),Is(l.slice(w,w+=y)),Is(l.slice(w,w+y)||"ff")]}if(l.startsWith("rgb")){const y=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[w,S,I,D,O,j,G,H,W,K,ie,ye]=y,ae=[D||" ",G||" ",K].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const le=[I,j,W].join(""),we=le==="%%%"?100:le===""?255:0;if(we){const Me=[co(+S/we,0,1),co(+O/we,0,1),co(+H/we,0,1),ie?ih(+ie,ye):1];if(Ru(Me))return Me}}return}}const m=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,w,S,I,D,O,j,G,H]=m,W=[S||" ",D||" ",j].join("");if(W==="  "||W==="  /"||W===",,"||W===",,,"){const K=[+w,co(+I,0,100),co(+O,0,100),G?ih(+G,H):1];if(Ru(K))return(function([ie,ye,ae,le]){function we(Me){const Ye=(Me+ie/30)%12,ct=ye*Math.min(ae,1-ae);return ae-ct*Math.max(-1,Math.min(Ye-3,9-Ye,1))}return ie=Ga(ie),ye/=100,ae/=100,[we(0),we(8),we(4),le]})(K)}}})(e);return n?new In(...n,!1):void 0}get rgb(){const{r:e,g:n,b:l,a:h}=this,m=h||1/0;return this.overwriteGetter("rgb",[e/m,n/m,l/m,h])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,l,h,m]=gc(e),y=Math.sqrt(l*l+h*h);return[Math.round(1e4*y)?Ga(Math.atan2(h,l)*os):NaN,y,n,m]})(this.rgb))}get lab(){return this.overwriteGetter("lab",gc(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,l,h]=this.rgb;return`rgba(${[e,n,l].map((m=>Math.round(255*m))).join(",")},${h})`}static interpolate(e,n,l,h="rgb"){switch(h){case"rgb":{const[m,y,w,S]=qa(e.rgb,n.rgb,l);return new In(m,y,w,S,!1)}case"hcl":{const[m,y,w,S]=e.hcl,[I,D,O,j]=n.hcl;let G,H;if(isNaN(m)||isNaN(I))isNaN(m)?isNaN(I)?G=NaN:(G=I,w!==1&&w!==0||(H=D)):(G=m,O!==1&&O!==0||(H=y));else{let ae=I-m;I>m&&ae>180?ae-=360:I<m&&m-I>180&&(ae+=360),G=m+l*ae}const[W,K,ie,ye]=(function([ae,le,we,Me]){return ae=isNaN(ae)?0:ae*Ms,Pu([we,Math.cos(ae)*le,Math.sin(ae)*le,Me])})([G,H??ei(y,D,l),ei(w,O,l),ei(S,j,l)]);return new In(W,K,ie,ye,!1)}case"lab":{const[m,y,w,S]=Pu(qa(e.lab,n.lab,l));return new In(m,y,w,S,!1)}}}}In.black=new In(0,0,0,1),In.white=new In(1,1,1,1),In.transparent=new In(0,0,0,0),In.red=new In(1,0,0,1);class Aa{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ga=["bottom","center","top"];class Xr{constructor(e,n,l,h,m,y){this.text=e,this.image=n,this.scale=l,this.fontStack=h,this.textColor=m,this.verticalAlign=y}}class Yi{constructor(e){this.sections=e}static fromString(e){return new Yi([new Xr(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof Yi?e:Yi.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class tr{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof tr)return e;if(typeof e=="number")return new tr([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new tr(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new tr(qa(e.values,n.values,l))}}class ki{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ki)return e;if(typeof e=="number")return new ki([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new ki(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new ki(qa(e.values,n.values,l))}}class mn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof mn)return e;if(typeof e=="string"){const l=In.parse(e);return l?new mn([l]):void 0}if(!Array.isArray(e))return;const n=[];for(const l of e){if(typeof l!="string")return;const h=In.parse(l);if(!h)return;n.push(h)}return new mn(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l,h="rgb"){const m=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let y=0;y<e.values.length;y++)m.push(In.interpolate(e.values[y],n.values[y],l,h));return new mn(m)}}class Qn extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Za=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Li{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Li)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const l=e[n],h=e[n+1];if(typeof l!="string"||!Za.has(l)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Li(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){const h=e.values,m=n.values;if(h.length!==m.length)throw new Qn(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const y=[];for(let w=0;w<h.length;w+=2){if(h[w]!==m[w])throw new Qn(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${h[w]}, to[${w}]: ${m[w]}`);y.push(h[w]);const[S,I]=h[w+1],[D,O]=m[w+1];y.push([ei(S,D,l),ei(I,O,l)])}return new Li(y)}}class An{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new An({name:e,available:!1}):null}}class ci{constructor(e,n,l){this.from=e,this.to=n,this.transition=l}static interpolate(e,n,l){return new ci(e,n,l)}static parse(e){return e instanceof ci?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new ci(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new ci(e.from,e.to,e.transition):typeof e=="string"?new ci(e,e,1):void 0}}function la(i,e,n,l){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,e,n,l]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ls(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof ci||i instanceof In||i instanceof Aa||i instanceof Yi||i instanceof tr||i instanceof ki||i instanceof mn||i instanceof Li||i instanceof An)return!0;if(Array.isArray(i)){for(const e of i)if(!ls(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!ls(i[e]))return!1;return!0}return!1}function si(i){if(i===null)return li;if(typeof i=="string")return bn;if(typeof i=="boolean")return Tn;if(typeof i=="number")return St;if(i instanceof In)return gr;if(i instanceof ci)return ws;if(i instanceof Aa)return as;if(i instanceof Yi)return ui;if(i instanceof tr)return js;if(i instanceof ki)return Ia;if(i instanceof mn)return Ts;if(i instanceof Li)return lo;if(i instanceof An)return xi;if(Array.isArray(i)){const e=i.length;let n;for(const l of i){const h=si(l);if(n){if(n===h)continue;n=yn;break}n=h}return Tr(n||yn,e)}return Ua}function Zs(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof In||i instanceof ci||i instanceof Yi||i instanceof tr||i instanceof ki||i instanceof mn||i instanceof Li||i instanceof An?i.toString():JSON.stringify(i)}class bi{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ls(e[1]))return n.error("invalid value");const l=e[1];let h=si(l);const m=n.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new bi(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ho={string:bn,number:St,boolean:Tn,object:Ua};class Or{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,h=1;const m=e[0];if(m==="array"){let w,S;if(e.length>2){const I=e[1];if(typeof I!="string"||!(I in ho)||I==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=ho[I],h++}else w=yn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=e[2],h++}l=Tr(w,S)}else{if(!ho[m])throw new Error(`Types doesn't contain name = ${m}`);l=ho[m]}const y=[];for(;h<e.length;h++){const w=n.parse(e[h],h,yn);if(!w)return null;y.push(w)}return new Or(l,y)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!Yr(this.type,si(l)))return l;if(n===this.args.length-1)throw new Qn(`Expected value to be of type ${Vn(this.type)}, but found ${Vn(si(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const nr={"to-boolean":Tn,"to-color":gr,"to-number":St,"to-string":bn};class $r{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0];if(!nr[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");const h=nr[l],m=[];for(let y=1;y<e.length;y++){const w=n.parse(e[y],y,yn);if(!w)return null;m.push(w)}return new $r(h,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,l;for(const h of this.args){if(n=h.evaluate(e),l=null,n instanceof In)return n;if(typeof n=="string"){const m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:la(n[0],n[1],n[2],n[3]),!l))return new In(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Qn(l||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const l of this.args){n=l.evaluate(e);const h=tr.parse(n);if(h)return h}throw new Qn(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const l of this.args){n=l.evaluate(e);const h=ki.parse(n);if(h)return h}throw new Qn(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const l of this.args){n=l.evaluate(e);const h=mn.parse(n);if(h)return h}throw new Qn(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const l of this.args){n=l.evaluate(e);const h=Li.parse(n);if(h)return h}throw new Qn(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new Qn(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return Yi.fromString(Zs(this.args[0].evaluate(e)));case"resolvedImage":return An.fromString(Zs(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Zs(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const Yl=["Unknown","Point","LineString","Polygon"];class fo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Yl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=In.parse(e),this._parseColorCache.set(e,n)),n}}class ua{constructor(e,n,l=[],h,m=new Va,y=[]){this.registry=e,this.path=l,this.key=l.map((w=>`[${w}]`)).join(""),this.scope=m,this.errors=y,this.expectedType=h,this._isConstant=n}parse(e,n,l,h,m={}){return n?this.concat(n,l,h)._parse(e,m):this._parse(e,m)}_parse(e,n){function l(h,m,y){return y==="assert"?new Or(m,[h]):y==="coerce"?new $r(m,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let y=m.parse(e,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,S=y.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||S.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(S.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(S.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(S.kind)||w.kind==="colorArray"&&["value","string","array"].includes(S.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(S.kind))y=l(y,w,n.typeAnnotation||"coerce");else if(this.checkSubtype(w,S))return null}else y=l(y,w,n.typeAnnotation||"assert")}if(!(y instanceof bi)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const w=new fo;try{y=new bi(y.type,y.evaluate(w))}catch(S){return this.error(S.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l){const h=typeof e=="number"?this.path.concat(e):this.path,m=l?this.scope.concat(l):this.scope;return new ua(this.registry,this._isConstant,h,n||null,m,this.errors)}error(e,...n){const l=`${this.key}${n.map((h=>`[${h}]`)).join("")}`;this.errors.push(new Zr(l,e))}checkSubtype(e,n){const l=Yr(e,n);return l&&this.error(l),l}}class $n{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const y=e[m];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const w=n.parse(e[m+1],m+1);if(!w)return null;l.push([y,w])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return h?new $n(l,h):null}outputDefined(){return this.result.outputDefined()}}class po{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new po(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class vn{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,St),h=n.parse(e[2],2,Tr(n.expectedType||yn));return l&&h?new vn(h.type.itemType,l,h):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new Qn(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new Qn(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new Qn(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class _n{constructor(e,n){this.type=Tn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,yn),h=n.parse(e[2],2,yn);return l&&h?ss(l.type,[Tn,bn,St,li,yn])?new _n(l,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!Ss(n,["boolean","string","number","null"]))throw new Qn(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(si(n))} instead.`);if(!Ss(l,["string","array"]))throw new Qn(`Expected second argument to be of type array or string, but found ${Vn(si(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Vo{constructor(e,n,l){this.type=St,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,yn),h=n.parse(e[2],2,yn);if(!l||!h)return null;if(!ss(l.type,[Tn,bn,St,li,yn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(l.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,St);return m?new Vo(l,h,m):null}return new Vo(l,h)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Ss(n,["boolean","string","number","null"]))throw new Qn(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(si(n))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(e)),Ss(l,["string"])){const m=l.indexOf(n,h);return m===-1?-1:[...l.slice(0,m)].length}if(Ss(l,["array"]))return l.indexOf(n,h);throw new Qn(`Expected second argument to be of type array or string, but found ${Vn(si(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class Pn{constructor(e,n,l,h,m,y){this.inputType=e,this.type=n,this.input=l,this.cases=h,this.outputs=m,this.otherwise=y}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const m={},y=[];for(let I=2;I<e.length-1;I+=2){let D=e[I];const O=e[I+1];Array.isArray(D)||(D=[D]);const j=n.concat(I);if(D.length===0)return j.error("Expected at least one branch label.");for(const H of D){if(typeof H!="number"&&typeof H!="string")return j.error("Branch labels must be numbers or strings.");if(typeof H=="number"&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof H=="number"&&Math.floor(H)!==H)return j.error("Numeric branch labels must be integer values.");if(l){if(j.checkSubtype(l,si(H)))return null}else l=si(H);if(m[String(H)]!==void 0)return j.error("Branch labels must be unique.");m[String(H)]=y.length}const G=n.parse(O,I,h);if(!G)return null;h=h||G.type,y.push(G)}const w=n.parse(e[1],1,yn);if(!w)return null;const S=n.parse(e[e.length-1],e.length-1,h);return S?w.type.kind!=="value"&&n.concat(1).checkSubtype(l,w.type)?null:new Pn(l,h,w,m,y,S):null}evaluate(e){const n=this.input.evaluate(e);return(si(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class ml{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const h=[];for(let y=1;y<e.length-1;y+=2){const w=n.parse(e[y],y,Tn);if(!w)return null;const S=n.parse(e[y+1],y+1,l);if(!S)return null;h.push([w,S]),l=l||S.type}const m=n.parse(e[e.length-1],e.length-1,l);if(!m)return null;if(!l)throw new Error("Can't infer output type");return new ml(l,h,m)}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Nr{constructor(e,n,l,h){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,yn),h=n.parse(e[2],2,St);if(!l||!h)return null;if(!ss(l.type,[Tr(yn),bn,yn]))return n.error(`Expected first argument to be of type array or string, but found ${Vn(l.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,St);return m?new Nr(l.type,l,h,m):null}return new Nr(l.type,l,h)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let h;if(this.endIndex&&(h=this.endIndex.evaluate(e)),Ss(n,["string"]))return[...n].slice(l,h).join("");if(Ss(n,["array"]))return n.slice(l,h);throw new Qn(`Expected first argument to be of type array or string, but found ${Vn(si(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function mo(i,e){const n=i.length-1;let l,h,m=0,y=n,w=0;for(;m<=y;)if(w=Math.floor((m+y)/2),l=i[w],h=i[w+1],l<=e){if(w===n||e<h)return w;m=w+1}else{if(!(l>e))throw new Qn("Input is not a number.");y=w-1}return 0}class Br{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,m]of l)this.labels.push(h),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,St);if(!l)return null;const h=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let y=1;y<e.length;y+=2){const w=y===1?-1/0:e[y],S=e[y+1],I=y,D=y+1;if(typeof w!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(h.length&&h[h.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);const O=n.parse(S,D,m);if(!O)return null;m=m||O.type,h.push([w,O])}return new Br(m,l,h)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return l[0].evaluate(e);const m=n.length;return h>=n[m-1]?l[m-1].evaluate(e):l[mo(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function yc(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Hl,vc,af=(function(){if(vc)return Hl;function i(e,n,l,h){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(h-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=h}return vc=1,Hl=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,h=0;h<8;h++){var m=this.sampleCurveX(l)-e;if(Math.abs(m)<n)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=m/y}var w=0,S=1;for(l=e,h=0;h<20&&(m=this.sampleCurveX(l),!(Math.abs(m-e)<n));h++)e>m?w=l:S=l,l=.5*(S-w)+w;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},Hl})(),xc=yc(af);class ca{constructor(e,n,l,h,m){this.type=e,this.operator=n,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[y,w]of m)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(e,n,l,h){let m=0;if(e.name==="exponential")m=As(n,e.base,l,h);else if(e.name==="linear")m=As(n,1,l,h);else if(e.name==="cubic-bezier"){const y=e.controlPoints;m=new xc(y[0],y[1],y[2],y[3]).solve(As(n,1,l,h))}return m}static parse(e,n){let[l,h,m,...y]=e;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const I=h[1];if(typeof I!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:I}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const I=h.slice(1);if(I.length!==4||I.some((D=>typeof D!="number"||D<0||D>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,St),!m)return null;const w=[];let S=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||n.expectedType==Ts?n.expectedType&&n.expectedType.kind!=="value"&&(S=n.expectedType):S=gr;for(let I=0;I<y.length;I+=2){const D=y[I],O=y[I+1],j=I+3,G=I+4;if(typeof D!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(w.length&&w[w.length-1][0]>=D)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const H=n.parse(O,G,S);if(!H)return null;S=S||H.type,w.push([D,H])}return Hr(S,St)||Hr(S,ws)||Hr(S,gr)||Hr(S,js)||Hr(S,Ia)||Hr(S,Ts)||Hr(S,lo)||Hr(S,Tr(St))?new ca(S,l,h,m,w):n.error(`Type ${Vn(S)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return l[0].evaluate(e);const m=n.length;if(h>=n[m-1])return l[m-1].evaluate(e);const y=mo(n,h),w=ca.interpolationFactor(this.interpolation,h,n[y],n[y+1]),S=l[y].evaluate(e),I=l[y+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ei(S,I,w);case"color":return In.interpolate(S,I,w);case"padding":return tr.interpolate(S,I,w);case"colorArray":return mn.interpolate(S,I,w);case"numberArray":return ki.interpolate(S,I,w);case"variableAnchorOffsetCollection":return Li.interpolate(S,I,w);case"array":return qa(S,I,w);case"projectionDefinition":return ci.interpolate(S,I,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return In.interpolate(S,I,w,"hcl");case"colorArray":return mn.interpolate(S,I,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return In.interpolate(S,I,w,"lab");case"colorArray":return mn.interpolate(S,I,w,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function As(i,e,n,l){const h=l-n,m=i-n;return h===0?0:e===1?m/h:(Math.pow(e,m)-1)/(Math.pow(e,h)-1)}const Di={color:In.interpolate,number:ei,padding:tr.interpolate,numberArray:ki.interpolate,colorArray:mn.interpolate,variableAnchorOffsetCollection:Li.interpolate,array:qa};class ka{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l=null;const h=n.expectedType;h&&h.kind!=="value"&&(l=h);const m=[];for(const w of e.slice(1)){const S=n.parse(w,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!S)return null;l=l||S.type,m.push(S)}if(!l)throw new Error("No output type");const y=h&&m.some((w=>Yr(h,w.type)));return new ka(y?yn:l,m)}evaluate(e){let n,l=null,h=0;for(const m of this.args)if(h++,l=m.evaluate(e),l&&l instanceof An&&!l.available&&(n||(n=l.name),l=null,h===this.args.length&&(l=n)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Fr(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Xl(i,e,n,l){return l.compare(e,n)===0}function zi(i,e,n){const l=i!=="=="&&i!=="!=";return class Ry{constructor(m,y,w){this.type=Tn,this.lhs=m,this.rhs=y,this.collator=w,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const w=m[0];let S=y.parse(m[1],1,yn);if(!S)return null;if(!Fr(w,S.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${Vn(S.type)}'.`);let I=y.parse(m[2],2,yn);if(!I)return null;if(!Fr(w,I.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${Vn(I.type)}'.`);if(S.type.kind!==I.type.kind&&S.type.kind!=="value"&&I.type.kind!=="value")return y.error(`Cannot compare types '${Vn(S.type)}' and '${Vn(I.type)}'.`);l&&(S.type.kind==="value"&&I.type.kind!=="value"?S=new Or(I.type,[S]):S.type.kind!=="value"&&I.type.kind==="value"&&(I=new Or(S.type,[I])));let D=null;if(m.length===4){if(S.type.kind!=="string"&&I.type.kind!=="string"&&S.type.kind!=="value"&&I.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(D=y.parse(m[3],3,as),!D)return null}return new Ry(S,I,D)}evaluate(m){const y=this.lhs.evaluate(m),w=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const S=si(y),I=si(w);if(S.kind!==I.kind||S.kind!=="string"&&S.kind!=="number")throw new Qn(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${S.kind}, ${I.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const S=si(y),I=si(w);if(S.kind!=="string"||I.kind!=="string")return e(m,y,w)}return this.collator?n(m,y,w,this.collator.evaluate(m)):e(m,y,w)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const rh=zi("==",(function(i,e,n){return e===n}),Xl),gl=zi("!=",(function(i,e,n){return e!==n}),(function(i,e,n,l){return!Xl(0,e,n,l)})),bc=zi("<",(function(i,e,n){return e<n}),(function(i,e,n,l){return l.compare(e,n)<0})),wc=zi(">",(function(i,e,n){return e>n}),(function(i,e,n,l){return l.compare(e,n)>0})),Uo=zi("<=",(function(i,e,n){return e<=n}),(function(i,e,n,l){return l.compare(e,n)<=0})),_a=zi(">=",(function(i,e,n){return e>=n}),(function(i,e,n,l){return l.compare(e,n)>=0}));class jo{constructor(e,n,l){this.type=as,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const h=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Tn);if(!h)return null;const m=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Tn);if(!m)return null;let y=null;return l.locale&&(y=n.parse(l.locale,1,bn),!y)?null:new jo(h,m,y)}evaluate(e){return new Aa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class ha{constructor(e,n,l,h,m){this.type=bn,this.number=e,this.locale=n,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,St);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=n.parse(h.locale,1,bn),!m))return null;let y=null;if(h.currency&&(y=n.parse(h.currency,1,bn),!y))return null;let w=null;if(h["min-fraction-digits"]&&(w=n.parse(h["min-fraction-digits"],1,St),!w))return null;let S=null;return h["max-fraction-digits"]&&(S=n.parse(h["max-fraction-digits"],1,St),!S)?null:new ha(l,m,y,w,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Ys{constructor(e){this.type=ui,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const h=[];let m=!1;for(let y=1;y<=e.length-1;++y){const w=e[y];if(m&&typeof w=="object"&&!Array.isArray(w)){m=!1;let S=null;if(w["font-scale"]&&(S=n.parse(w["font-scale"],1,St),!S))return null;let I=null;if(w["text-font"]&&(I=n.parse(w["text-font"],1,Tr(bn)),!I))return null;let D=null;if(w["text-color"]&&(D=n.parse(w["text-color"],1,gr),!D))return null;let O=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!ga.includes(w["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(O=n.parse(w["vertical-align"],1,bn),!O)return null}const j=h[h.length-1];j.scale=S,j.font=I,j.textColor=D,j.verticalAlign=O}else{const S=n.parse(e[y],1,yn);if(!S)return null;const I=S.type.kind;if(I!=="string"&&I!=="value"&&I!=="null"&&I!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:S,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Ys(h)}evaluate(e){return new Yi(this.sections.map((n=>{const l=n.content.evaluate(e);return si(l)===xi?new Xr("",l,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Xr(Zs(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class _l{constructor(e){this.type=xi,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const l=n.parse(e[1],1,bn);return l?new _l(l):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),l=An.fromString(n);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(n)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class Go{constructor(e){this.type=St,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Vn(l.type)} instead.`):new Go(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new Qn(`Expected value to be of type string or array, but found ${Vn(si(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Bi=8192;function qo(i,e){const n=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*Bi),Math.round(l*h*Bi)]}function go(i,e){const n=Math.pow(2,e.z);return[(h=(i[0]/Bi+e.x)/n,360*h-180),(l=(i[1]/Bi+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,h}function yl(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function _o(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function ah(i,e,n){const l=i[0]-e[0],h=i[1]-e[1],m=i[0]-n[0],y=i[1]-n[1];return l*y-m*h==0&&l*m<=0&&h*y<=0}function $l(i,e,n,l){return(h=[l[0]-n[0],l[1]-n[1]])[0]*(m=[e[0]-i[0],e[1]-i[1]])[1]-h[1]*m[0]!=0&&!(!zu(i,e,n,l)||!zu(n,l,i,e));var h,m}function sh(i,e,n){for(const l of n)for(let h=0;h<l.length-1;++h)if($l(i,e,l[h],l[h+1]))return!0;return!1}function us(i,e,n=!1){let l=!1;for(const w of e)for(let S=0;S<w.length-1;S++){if(ah(i,w[S],w[S+1]))return n;(m=w[S])[1]>(h=i)[1]!=(y=w[S+1])[1]>h[1]&&h[0]<(y[0]-m[0])*(h[1]-m[1])/(y[1]-m[1])+m[0]&&(l=!l)}var h,m,y;return l}function Lu(i,e){for(const n of e)if(us(i,n))return!0;return!1}function oh(i,e){for(const n of i)if(!us(n,e))return!1;for(let n=0;n<i.length-1;++n)if(sh(i[n],i[n+1],e))return!1;return!0}function Tc(i,e){for(const n of e)if(oh(i,n))return!0;return!1}function zu(i,e,n,l){const h=l[0]-n[0],m=l[1]-n[1],y=(i[0]-n[0])*m-h*(i[1]-n[1]),w=(e[0]-n[0])*m-h*(e[1]-n[1]);return y>0&&w<0||y<0&&w>0}function Wl(i,e,n){const l=[];for(let h=0;h<i.length;h++){const m=[];for(let y=0;y<i[h].length;y++){const w=qo(i[h][y],n);yl(e,w),m.push(w)}l.push(m)}return l}function Zo(i,e,n){const l=[];for(let h=0;h<i.length;h++){const m=Wl(i[h],e,n);l.push(m)}return l}function vl(i,e,n,l){if(i[0]<n[0]||i[0]>n[2]){const h=.5*l;let m=i[0]-n[0]>h?-l:n[0]-i[0]>h?l:0;m===0&&(m=i[0]-n[2]>h?-l:n[2]-i[0]>h?l:0),i[0]+=m}yl(e,i)}function lh(i,e,n,l){const h=Math.pow(2,l.z)*Bi,m=[l.x*Bi,l.y*Bi],y=[];for(const w of i)for(const S of w){const I=[S.x+m[0],S.y+m[1]];vl(I,e,n,h),y.push(I)}return y}function Ql(i,e,n,l){const h=Math.pow(2,l.z)*Bi,m=[l.x*Bi,l.y*Bi],y=[];for(const S of i){const I=[];for(const D of S){const O=[D.x+m[0],D.y+m[1]];yl(e,O),I.push(O)}y.push(I)}if(e[2]-e[0]<=h/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const S of y)for(const I of S)vl(I,e,n,h)}var w;return y}class yo{constructor(e,n){this.type=Tn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ls(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const h=[];for(const m of l.features){const{type:y,coordinates:w}=m.geometry;y==="Polygon"&&h.push(w),y==="MultiPolygon"&&h.push(...w)}if(h.length)return new yo(l,{type:"MultiPolygon",coordinates:h})}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new yo(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new yo(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(l.type==="Polygon"){const w=Wl(l.coordinates,m,y),S=lh(n.geometry(),h,m,y);if(!_o(h,m))return!1;for(const I of S)if(!us(I,w))return!1}if(l.type==="MultiPolygon"){const w=Zo(l.coordinates,m,y),S=lh(n.geometry(),h,m,y);if(!_o(h,m))return!1;for(const I of S)if(!Lu(I,w))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(l.type==="Polygon"){const w=Wl(l.coordinates,m,y),S=Ql(n.geometry(),h,m,y);if(!_o(h,m))return!1;for(const I of S)if(!oh(I,w))return!1}if(l.type==="MultiPolygon"){const w=Zo(l.coordinates,m,y),S=Ql(n.geometry(),h,m,y);if(!_o(h,m))return!1;for(const I of S)if(!Tc(I,w))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Sc=class{constructor(i=[],e=(n,l)=>n<l?-1:n>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:n}=this,l=e[i];for(;i>0;){const h=i-1>>1,m=e[h];if(n(l,m)>=0)break;e[i]=m,i=h}e[i]=l}_down(i){const{data:e,compare:n}=this,l=this.length>>1,h=e[i];for(;i<l;){let m=1+(i<<1);const y=m+1;if(y<this.length&&n(e[y],e[m])<0&&(m=y),n(e[m],h)>=0)break;e[i]=e[m],i=m}e[i]=h}};function Kl(i,e,n=0,l=i.length-1,h=Ou){for(;l>n;){if(l-n>600){const S=l-n+1,I=e-n+1,D=Math.log(S),O=.5*Math.exp(2*D/3),j=.5*Math.sqrt(D*O*(S-O)/S)*(I-S/2<0?-1:1);Kl(i,e,Math.max(n,Math.floor(e-I*O/S+j)),Math.min(l,Math.floor(e+(S-I)*O/S+j)),h)}const m=i[e];let y=n,w=l;for(Hs(i,n,e),h(i[l],m)>0&&Hs(i,n,l);y<w;){for(Hs(i,y,w),y++,w--;h(i[y],m)<0;)y++;for(;h(i[w],m)>0;)w--}h(i[n],m)===0?Hs(i,n,w):(w++,Hs(i,w,l)),w<=e&&(n=w+1),e<=w&&(l=w-1)}}function Hs(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function Ou(i,e){return i<e?-1:i>e?1:0}function xl(i,e){if(i.length<=1)return[i];const n=[];let l,h;for(const m of i){const y=ch(m);y!==0&&(m.area=Math.abs(y),h===void 0&&(h=y<0),h===y<0?(l&&n.push(l),l=[m]):l.push(m))}if(l&&n.push(l),e>1)for(let m=0;m<n.length;m++)n[m].length<=e||(Kl(n[m],e,1,n[m].length-1,uh),n[m]=n[m].slice(0,e));return n}function uh(i,e){return e.area-i.area}function ch(i){let e=0;for(let n,l,h=0,m=i.length,y=m-1;h<m;y=h++)n=i[h],l=i[y],e+=(l.x-n.x)*(n.y+l.y);return e}const Nu=1/298.257223563,Jl=Nu*(2-Nu),Ec=Math.PI/180;class Bu{constructor(e){const n=6378.137*Ec*1e3,l=Math.cos(e*Ec),h=1/(1-Jl*(1-l*l)),m=Math.sqrt(h);this.kx=n*m*l,this.ky=n*m*h*(1-Jl)}distance(e,n){const l=this.wrap(e[0]-n[0])*this.kx,h=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+h*h)}pointOnLine(e,n){let l,h,m,y,w=1/0;for(let S=0;S<e.length-1;S++){let I=e[S][0],D=e[S][1],O=this.wrap(e[S+1][0]-I)*this.kx,j=(e[S+1][1]-D)*this.ky,G=0;O===0&&j===0||(G=(this.wrap(n[0]-I)*this.kx*O+(n[1]-D)*this.ky*j)/(O*O+j*j),G>1?(I=e[S+1][0],D=e[S+1][1]):G>0&&(I+=O/this.kx*G,D+=j/this.ky*G)),O=this.wrap(n[0]-I)*this.kx,j=(n[1]-D)*this.ky;const H=O*O+j*j;H<w&&(w=H,l=I,h=D,m=S,y=G)}return{point:[l,h],index:m,t:Math.max(0,Math.min(1,y))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function ya(i,e){return e[0]-i[0]}function vo(i){return i[1]-i[0]+1}function Vr(i,e){return i[1]>=i[0]&&i[1]<e}function eu(i,e){if(i[0]>i[1])return[null,null];const n=vo(i);if(e){if(n===2)return[i,null];const h=Math.floor(n/2);return[[i[0],i[0]+h],[i[0]+h,i[1]]]}if(n===1)return[i,null];const l=Math.floor(n/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function tu(i,e){if(!Vr(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)yl(n,i[l]);return n}function fa(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const l of n)yl(e,l);return e}function va(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function _(i,e,n){if(!va(i)||!va(e))return NaN;let l=0,h=0;return i[2]<e[0]&&(l=e[0]-i[2]),i[0]>e[2]&&(l=i[0]-e[2]),i[1]>e[3]&&(h=i[1]-e[3]),i[3]<e[1]&&(h=e[1]-i[3]),n.distance([0,0],[l,h])}function o(i,e,n){const l=n.pointOnLine(e,i);return n.distance(i,l.point)}function u(i,e,n,l,h){const m=Math.min(o(i,[n,l],h),o(e,[n,l],h)),y=Math.min(o(n,[i,e],h),o(l,[i,e],h));return Math.min(m,y)}function g(i,e,n,l,h){if(!Vr(e,i.length)||!Vr(l,n.length))return 1/0;let m=1/0;for(let y=e[0];y<e[1];++y){const w=i[y],S=i[y+1];for(let I=l[0];I<l[1];++I){const D=n[I],O=n[I+1];if($l(w,S,D,O))return 0;m=Math.min(m,u(w,S,D,O,h))}}return m}function E(i,e,n,l,h){if(!Vr(e,i.length)||!Vr(l,n.length))return NaN;let m=1/0;for(let y=e[0];y<=e[1];++y)for(let w=l[0];w<=l[1];++w)if(m=Math.min(m,h.distance(i[y],n[w])),m===0)return m;return m}function P(i,e,n){if(us(i,e,!0))return 0;let l=1/0;for(const h of e){const m=h[0],y=h[h.length-1];if(m!==y&&(l=Math.min(l,o(i,[y,m],n)),l===0))return l;const w=n.pointOnLine(h,i);if(l=Math.min(l,n.distance(i,w.point)),l===0)return l}return l}function V(i,e,n,l){if(!Vr(e,i.length))return NaN;for(let m=e[0];m<=e[1];++m)if(us(i[m],n,!0))return 0;let h=1/0;for(let m=e[0];m<e[1];++m){const y=i[m],w=i[m+1];for(const S of n)for(let I=0,D=S.length,O=D-1;I<D;O=I++){const j=S[O],G=S[I];if($l(y,w,j,G))return 0;h=Math.min(h,u(y,w,j,G,l))}}return h}function $(i,e){for(const n of i)for(const l of n)if(us(l,e,!0))return!0;return!1}function re(i,e,n,l=1/0){const h=fa(i),m=fa(e);if(l!==1/0&&_(h,m,n)>=l)return l;if(_o(h,m)){if($(i,e))return 0}else if($(e,i))return 0;let y=1/0;for(const w of i)for(let S=0,I=w.length,D=I-1;S<I;D=S++){const O=w[D],j=w[S];for(const G of e)for(let H=0,W=G.length,K=W-1;H<W;K=H++){const ie=G[K],ye=G[H];if($l(O,j,ie,ye))return 0;y=Math.min(y,u(O,j,ie,ye,n))}}return y}function fe(i,e,n,l,h,m){if(!m)return;const y=_(tu(l,m),h,n);y<e&&i.push([y,m,[0,0]])}function Be(i,e,n,l,h,m,y){if(!m||!y)return;const w=_(tu(l,m),tu(h,y),n);w<e&&i.push([w,m,y])}function Xe(i,e,n,l,h=1/0){let m=Math.min(l.distance(i[0],n[0][0]),h);if(m===0)return m;const y=new Sc([[0,[0,i.length-1],[0,0]]],ya),w=fa(n);for(;y.length>0;){const S=y.pop();if(S[0]>=m)continue;const I=S[1],D=e?50:100;if(vo(I)<=D){if(!Vr(I,i.length))return NaN;if(e){const O=V(i,I,n,l);if(isNaN(O)||O===0)return O;m=Math.min(m,O)}else for(let O=I[0];O<=I[1];++O){const j=P(i[O],n,l);if(m=Math.min(m,j),m===0)return 0}}else{const O=eu(I,e);fe(y,m,l,i,w,O[0]),fe(y,m,l,i,w,O[1])}}return m}function bt(i,e,n,l,h,m=1/0){let y=Math.min(m,h.distance(i[0],n[0]));if(y===0)return y;const w=new Sc([[0,[0,i.length-1],[0,n.length-1]]],ya);for(;w.length>0;){const S=w.pop();if(S[0]>=y)continue;const I=S[1],D=S[2],O=e?50:100,j=l?50:100;if(vo(I)<=O&&vo(D)<=j){if(!Vr(I,i.length)&&Vr(D,n.length))return NaN;let G;if(e&&l)G=g(i,I,n,D,h),y=Math.min(y,G);else if(e&&!l){const H=i.slice(I[0],I[1]+1);for(let W=D[0];W<=D[1];++W)if(G=o(n[W],H,h),y=Math.min(y,G),y===0)return y}else if(!e&&l){const H=n.slice(D[0],D[1]+1);for(let W=I[0];W<=I[1];++W)if(G=o(i[W],H,h),y=Math.min(y,G),y===0)return y}else G=E(i,I,n,D,h),y=Math.min(y,G)}else{const G=eu(I,e),H=eu(D,l);Be(w,y,h,i,n,G[0],H[0]),Be(w,y,h,i,n,G[0],H[1]),Be(w,y,h,i,n,G[1],H[0]),Be(w,y,h,i,n,G[1],H[1])}}return y}function Zt(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class Qt{constructor(e,n){this.type=St,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ls(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new Qt(l,l.features.map((h=>Zt(h.geometry))).flat());if(l.type==="Feature")return new Qt(l,Zt(l.geometry));if("type"in l&&"coordinates"in l)return new Qt(l,Zt(l))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const h=n.geometry(),m=h.flat().map((S=>go([S.x,S.y],n.canonical)));if(h.length===0)return NaN;const y=new Bu(m[0][1]);let w=1/0;for(const S of l){switch(S.type){case"Point":w=Math.min(w,bt(m,!1,[S.coordinates],!1,y,w));break;case"LineString":w=Math.min(w,bt(m,!1,S.coordinates,!0,y,w));break;case"Polygon":w=Math.min(w,Xe(m,!1,S.coordinates,y,w))}if(w===0)return w}return w})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const h=n.geometry(),m=h.flat().map((S=>go([S.x,S.y],n.canonical)));if(h.length===0)return NaN;const y=new Bu(m[0][1]);let w=1/0;for(const S of l){switch(S.type){case"Point":w=Math.min(w,bt(m,!0,[S.coordinates],!1,y,w));break;case"LineString":w=Math.min(w,bt(m,!0,S.coordinates,!0,y,w));break;case"Polygon":w=Math.min(w,Xe(m,!0,S.coordinates,y,w))}if(w===0)return w}return w})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,l){const h=n.geometry();if(h.length===0||h[0].length===0)return NaN;const m=xl(h,0).map((S=>S.map((I=>I.map((D=>go([D.x,D.y],n.canonical))))))),y=new Bu(m[0][0][0][1]);let w=1/0;for(const S of l)for(const I of m){switch(S.type){case"Point":w=Math.min(w,Xe([S.coordinates],!1,I,y,w));break;case"LineString":w=Math.min(w,Xe(S.coordinates,!0,I,y,w));break;case"Polygon":w=Math.min(w,re(I,S.coordinates,y,w))}if(w===0)return w}return w})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class un{constructor(e){this.type=yn,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=e[1];return l==null?n.error("Global state property must be defined."):typeof l!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new un(l)}evaluate(e){var n;const l=(n=e.globals)===null||n===void 0?void 0:n.globalState;return l&&Object.keys(l).length!==0?Cs(l,this.key):null}eachChild(){}outputDefined(){return!1}}const zn={"==":rh,"!=":gl,">":wc,"<":bc,">=":_a,"<=":Uo,array:Or,at:vn,boolean:Or,case:ml,coalesce:ka,collator:jo,format:Ys,image:_l,in:_n,"index-of":Vo,interpolate:ca,"interpolate-hcl":ca,"interpolate-lab":ca,length:Go,let:$n,literal:bi,match:Pn,number:Or,"number-format":ha,object:Or,slice:Nr,step:Br,string:Or,"to-boolean":$r,"to-color":$r,"to-number":$r,"to-string":$r,var:po,within:yo,distance:Qt,"global-state":un};class Cn{constructor(e,n,l,h){this.name=e,this.type=n,this._evaluate=l,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const l=e[0],h=Cn.definitions[l];if(!h)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=y.filter((([I])=>!Array.isArray(I)||I.length===e.length-1));let S=null;for(const[I,D]of w){S=new ua(n.registry,_r,n.path,null,n.scope);const O=[];let j=!1;for(let G=1;G<e.length;G++){const H=e[G],W=Array.isArray(I)?I[G-1]:I.type,K=S.parse(H,1+O.length,W);if(!K){j=!0;break}O.push(K)}if(!j)if(Array.isArray(I)&&I.length!==O.length)S.error(`Expected ${I.length} arguments, but found ${O.length} instead.`);else{for(let G=0;G<O.length;G++){const H=Array.isArray(I)?I[G]:I.type,W=O[G];S.concat(G+1).checkSubtype(H,W.type)}if(S.errors.length===0)return new Cn(l,m,D,O)}}if(w.length===1)n.errors.push(...S.errors);else{const I=(w.length?w:y).map((([O])=>{return j=O,Array.isArray(j)?`(${j.map(Vn).join(", ")})`:`(${Vn(j.type)}...)`;var j})).join(" | "),D=[];for(let O=1;O<e.length;O++){const j=n.parse(e[O],1+D.length);if(!j)return null;D.push(Vn(j.type))}n.error(`Expected arguments of type ${I}, but found (${D.join(", ")}) instead.`)}return null}static register(e,n){Cn.definitions=n;for(const l in n)e[l]=Cn}}function oi(i,[e,n,l,h]){e=e.evaluate(i),n=n.evaluate(i),l=l.evaluate(i);const m=h?h.evaluate(i):1,y=la(e,n,l,m);if(y)throw new Qn(y);return new In(e/255,n/255,l/255,m,!1)}function ur(i,e){return i in e}function hi(i,e){const n=e[i];return n===void 0?null:n}function Wr(i){return{type:i}}function _r(i){if(i instanceof po)return _r(i.boundExpression);if(i instanceof Cn&&i.name==="error"||i instanceof jo||i instanceof yo||i instanceof Qt||i instanceof un)return!1;const e=i instanceof $r||i instanceof Or;let n=!0;return i.eachChild((l=>{n=e?n&&_r(l):n&&l instanceof bi})),!!n&&ks(i)&&bo(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ks(i){if(i instanceof Cn&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof yo||i instanceof Qt)return!1;let e=!0;return i.eachChild((n=>{e&&!ks(n)&&(e=!1)})),e}function xo(i){if(i instanceof Cn&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!xo(n)&&(e=!1)})),e}function bo(i,e){if(i instanceof Cn&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((l=>{n&&!bo(l,e)&&(n=!1)})),n}function bl(i){return{result:"success",value:i}}function Xs(i){return{result:"error",value:i}}function Da(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function nu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function wo(i){return!!i.expression&&i.expression.interpolated}function kn(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function hh(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&si(i)===Ua}function cs(i){return i}function fh(i,e){const n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),h=i.type||(wo(e)?"exponential":"interval"),m=(function(D){switch(D.type){case"color":return In.parse;case"padding":return tr.parse;case"numberArray":return ki.parse;case"colorArray":return mn.parse;default:return null}})(e);if(m&&((i=mr({},i)).stops&&(i.stops=i.stops.map((D=>[D[0],m(D[1])]))),i.default=m(i.default?i.default:e.default)),i.colorSpace&&(y=i.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var y;const w=(function(D){switch(D){case"exponential":return wl;case"interval":return dh;case"categorical":return sd;case"identity":return sf;default:throw new Error(`Unknown function type "${D}"`)}})(h);let S,I;if(h==="categorical"){S=Object.create(null);for(const D of i.stops)S[D[0]]=D[1];I=typeof i.stops[0][0]}if(n){const D={},O=[];for(let H=0;H<i.stops.length;H++){const W=i.stops[H],K=W[0].zoom;D[K]===void 0&&(D[K]={zoom:K,type:i.type,property:i.property,default:i.default,stops:[]},O.push(K)),D[K].stops.push([W[0].value,W[1]])}const j=[];for(const H of O)j.push([D[H].zoom,fh(D[H],e)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:ca.interpolationFactor.bind(void 0,G),zoomStops:j.map((H=>H[0])),evaluate:({zoom:H},W)=>wl({stops:j,base:i.base},e,H).evaluate(H,W)}}if(l){const D=h==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:ca.interpolationFactor.bind(void 0,D),zoomStops:i.stops.map((O=>O[0])),evaluate:({zoom:O})=>w(i,e,O,S,I)}}return{kind:"source",evaluate(D,O){const j=O&&O.properties?O.properties[i.property]:void 0;return j===void 0?hs(i.default,e.default):w(i,e,j,S,I)}}}function hs(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function sd(i,e,n,l,h){return hs(typeof n===h?l[n]:void 0,i.default,e.default)}function dh(i,e,n){if(kn(n)!=="number")return hs(i.default,e.default);const l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];const h=mo(i.stops.map((m=>m[0])),n);return i.stops[h][1]}function wl(i,e,n){const l=i.base!==void 0?i.base:1;if(kn(n)!=="number")return hs(i.default,e.default);const h=i.stops.length;if(h===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[h-1][0])return i.stops[h-1][1];const m=mo(i.stops.map((D=>D[0])),n),y=(function(D,O,j,G){const H=G-j,W=D-j;return H===0?0:O===1?W/H:(Math.pow(O,W)-1)/(Math.pow(O,H)-1)})(n,l,i.stops[m][0],i.stops[m+1][0]),w=i.stops[m][1],S=i.stops[m+1][1],I=Di[e.type]||cs;return typeof w.evaluate=="function"?{evaluate(...D){const O=w.evaluate.apply(void 0,D),j=S.evaluate.apply(void 0,D);if(O!==void 0&&j!==void 0)return I(O,j,y,i.colorSpace)}}:I(w,S,y,i.colorSpace)}function sf(i,e,n){switch(e.type){case"color":n=In.parse(n);break;case"formatted":n=Yi.fromString(n.toString());break;case"resolvedImage":n=An.fromString(n.toString());break;case"padding":n=tr.parse(n);break;case"colorArray":n=mn.parse(n);break;case"numberArray":n=ki.parse(n);break;default:kn(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return hs(n,i.default,e.default)}Cn.register(zn,{error:[{kind:"error"},[bn],(i,[e])=>{throw new Qn(e.evaluate(i))}],typeof:[bn,[yn],(i,[e])=>Vn(si(e.evaluate(i)))],"to-rgba":[Tr(St,4),[gr],(i,[e])=>{const[n,l,h,m]=e.evaluate(i).rgb;return[255*n,255*l,255*h,m]}],rgb:[gr,[St,St,St],oi],rgba:[gr,[St,St,St,St],oi],has:{type:Tn,overloads:[[[bn],(i,[e])=>ur(e.evaluate(i),i.properties())],[[bn,Ua],(i,[e,n])=>ur(e.evaluate(i),n.evaluate(i))]]},get:{type:yn,overloads:[[[bn],(i,[e])=>hi(e.evaluate(i),i.properties())],[[bn,Ua],(i,[e,n])=>hi(e.evaluate(i),n.evaluate(i))]]},"feature-state":[yn,[bn],(i,[e])=>hi(e.evaluate(i),i.featureState||{})],properties:[Ua,[],i=>i.properties()],"geometry-type":[bn,[],i=>i.geometryType()],id:[yn,[],i=>i.id()],zoom:[St,[],i=>i.globals.zoom],"heatmap-density":[St,[],i=>i.globals.heatmapDensity||0],elevation:[St,[],i=>i.globals.elevation||0],"line-progress":[St,[],i=>i.globals.lineProgress||0],accumulated:[yn,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[St,Wr(St),(i,e)=>{let n=0;for(const l of e)n+=l.evaluate(i);return n}],"*":[St,Wr(St),(i,e)=>{let n=1;for(const l of e)n*=l.evaluate(i);return n}],"-":{type:St,overloads:[[[St,St],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[St],(i,[e])=>-e.evaluate(i)]]},"/":[St,[St,St],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[St,[St,St],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[St,[],()=>Math.LN2],pi:[St,[],()=>Math.PI],e:[St,[],()=>Math.E],"^":[St,[St,St],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[St,[St],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[St,[St],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[St,[St],(i,[e])=>Math.log(e.evaluate(i))],log2:[St,[St],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[St,[St],(i,[e])=>Math.sin(e.evaluate(i))],cos:[St,[St],(i,[e])=>Math.cos(e.evaluate(i))],tan:[St,[St],(i,[e])=>Math.tan(e.evaluate(i))],asin:[St,[St],(i,[e])=>Math.asin(e.evaluate(i))],acos:[St,[St],(i,[e])=>Math.acos(e.evaluate(i))],atan:[St,[St],(i,[e])=>Math.atan(e.evaluate(i))],min:[St,Wr(St),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[St,Wr(St),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[St,[St],(i,[e])=>Math.abs(e.evaluate(i))],round:[St,[St],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[St,[St],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[St,[St],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Tn,[bn,yn],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[Tn,[yn],(i,[e])=>i.id()===e.value],"filter-type-==":[Tn,[bn],(i,[e])=>i.geometryType()===e.value],"filter-<":[Tn,[bn,yn],(i,[e,n])=>{const l=i.properties()[e.value],h=n.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Tn,[yn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[Tn,[bn,yn],(i,[e,n])=>{const l=i.properties()[e.value],h=n.value;return typeof l==typeof h&&l>h}],"filter-id->":[Tn,[yn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[Tn,[bn,yn],(i,[e,n])=>{const l=i.properties()[e.value],h=n.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Tn,[yn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[Tn,[bn,yn],(i,[e,n])=>{const l=i.properties()[e.value],h=n.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Tn,[yn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[Tn,[yn],(i,[e])=>e.value in i.properties()],"filter-has-id":[Tn,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Tn,[Tr(bn)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Tn,[Tr(yn)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Tn,[bn,Tr(yn)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Tn,[bn,Tr(yn)],(i,[e,n])=>(function(l,h,m,y){for(;m<=y;){const w=m+y>>1;if(h[w]===l)return!0;h[w]>l?y=w-1:m=w+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Tn,overloads:[[[Tn,Tn],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[Wr(Tn),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Tn,overloads:[[[Tn,Tn],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[Wr(Tn),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[Tn,[Tn],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Tn,[bn],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[bn,[bn],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[bn,[bn],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[bn,Wr(yn),(i,e)=>e.map((n=>Zs(n.evaluate(i)))).join("")],"resolved-locale":[bn,[as],(i,[e])=>e.evaluate(i).resolvedLocale()]});class ph{constructor(e,n,l){this.expression=e,this._warningHistory={},this._evaluator=new fo,this._defaultValue=n?(function(h){if(h.type==="color"&&hh(h.default))return new In(0,0,0,0);switch(h.type){case"color":return In.parse(h.default)||null;case"padding":return tr.parse(h.default)||null;case"numberArray":return ki.parse(h.default)||null;case"colorArray":return mn.parse(h.default)||null;case"variableAnchorOffsetCollection":return Li.parse(h.default)||null;case"projectionDefinition":return ci.parse(h.default)||null;default:return h.default===void 0?null:h.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=l}evaluateWithoutErrorHandling(e,n,l,h,m,y){return this._globalState&&(e=Kr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,h,m,y){this._globalState&&(e=Kr(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Qn(`Expected value to be one of ${Object.keys(this._enumValues).map((S=>JSON.stringify(S))).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Tl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in zn}function Mc(i,e,n){const l=new ua(zn,_r,[],e?(function(m){const y={color:gr,string:bn,number:St,enum:bn,boolean:Tn,formatted:ui,padding:js,numberArray:Ia,colorArray:Ts,projectionDefinition:ws,resolvedImage:xi,variableAnchorOffsetCollection:lo};return m.type==="array"?Tr(y[m.value]||yn,m.length):y[m.type]})(e):void 0),h=l.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?bl(new ph(h,e,n)):Xs(l.errors)}class Pa{constructor(e,n,l){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!xo(n.expression),this.globalStateRefs=Qr(n.expression),this._globalState=l}evaluateWithoutErrorHandling(e,n,l,h,m,y){return this._globalState&&(e=Kr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,h,m,y)}evaluate(e,n,l,h,m,y){return this._globalState&&(e=Kr(e,this._globalState)),this._styleExpression.evaluate(e,n,l,h,m,y)}}class Sl{constructor(e,n,l,h,m){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!xo(n.expression),this.globalStateRefs=Qr(n.expression),this.interpolationType=h,this._globalState=m}evaluateWithoutErrorHandling(e,n,l,h,m,y){return this._globalState&&(e=Kr(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,h,m,y)}evaluate(e,n,l,h,m,y){return this._globalState&&(e=Kr(e,this._globalState)),this._styleExpression.evaluate(e,n,l,h,m,y)}interpolationFactor(e,n,l){return this.interpolationType?ca.interpolationFactor(this.interpolationType,e,n,l):0}}function El(i,e,n){const l=Mc(i,e,n);if(l.result==="error")return l;const h=l.value.expression,m=ks(h);if(!m&&!Da(e))return Xs([new Zr("","data expressions not supported")]);const y=bo(h,["zoom"]);if(!y&&!nu(e))return Xs([new Zr("","zoom expressions not supported")]);const w=Ml(h);return w||y?w instanceof Zr?Xs([w]):w instanceof ca&&!wo(e)?Xs([new Zr("",'"interpolate" expressions cannot be used with this property')]):bl(w?new Sl(m?"camera":"composite",l.value,w.labels,w instanceof ca?w.interpolation:void 0,n):new Pa(m?"constant":"source",l.value,n)):Xs([new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class iu{constructor(e,n){this._parameters=e,this._specification=n,mr(this,fh(this._parameters,this._specification))}static deserialize(e){return new iu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ml(i){let e=null;if(i instanceof $n)e=Ml(i.result);else if(i instanceof ka){for(const n of i.args)if(e=Ml(n),e)break}else(i instanceof Br||i instanceof ca)&&i.input instanceof Cn&&i.input.name==="zoom"&&(e=i);return e instanceof Zr||i.eachChild((n=>{const l=Ml(n);l instanceof Zr?e=l:!e&&l?e=new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Zr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Qr(i,e=new Set){return i instanceof un&&e.add(i.key),i.eachChild((n=>{Qr(n,e)})),e}function Kr(i,e){const{zoom:n,heatmapDensity:l,elevation:h,lineProgress:m,isSupportedScript:y,accumulated:w}=i??{};return{zoom:n,heatmapDensity:l,elevation:h,lineProgress:m,isSupportedScript:y,accumulated:w,globalState:e}}function To(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!To(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const So={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ya(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};To(i)||(i=ru(i));const n=Mc(i,So,e);if(n.result==="error")throw new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,h,m)=>n.value.evaluate(l,h,{},m),needGeometry:of(i),getGlobalStateRefs:()=>Qr(n.value.expression)}}function Yo(i,e){return i<e?-1:i>e?1:0}function of(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(of(i[e]))return!0;return!1}function ru(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?Fu(i[1],i[2],"=="):e==="!="?wi(Fu(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Fu(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(ru))):e==="all"?["all"].concat(i.slice(1).map(ru)):e==="none"?["all"].concat(i.slice(1).map(ru).map(wi)):e==="in"?lf(i[1],i.slice(2)):e==="!in"?wi(lf(i[1],i.slice(2))):e==="has"?Jr(i[1]):e!=="!has"||wi(Jr(i[1]));var n}function Fu(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function lf(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(Yo)]]:["filter-in-small",i,["literal",e]]}}function Jr(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function wi(i){return["!",i]}function jn(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let h="[";for(const m of i)h+=`${jn(m)},`;return`${h}]`}const n=Object.keys(i).sort();let l="{";for(let h=0;h<n.length;h++)l+=`${JSON.stringify(n[h])}:${jn(i[n[h]])},`;return`${l}}`}function Ho(i){let e="";for(const n of Jn)e+=`/${jn(i[n])}`;return e}function fs(i){const e=i.value;return e?[new It(i.key,e,"constants have been deprecated as of v8")]:[]}function Hi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function Ha(i){if(Array.isArray(i))return i.map(Ha);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=Ha(i[n]);return e}return Hi(i)}function ds(i){const e=i.key,n=i.value,l=i.valueSpec||{},h=i.objectElementValidators||{},m=i.style,y=i.styleSpec,w=i.validateSpec;let S=[];const I=kn(n);if(I!=="object")return[new It(e,n,`object expected, ${I} found`)];for(const D in n){const O=D.split(".")[0],j=Cs(l,O)||l["*"];let G;if(Cs(h,O))G=h[O];else if(Cs(l,O))G=w;else if(h["*"])G=h["*"];else{if(!l["*"]){S.push(new It(e,n[D],`unknown property "${D}"`));continue}G=w}S=S.concat(G({key:(e&&`${e}.`)+D,value:n[D],valueSpec:j,style:m,styleSpec:y,object:n,objectKey:D,validateSpec:w},n))}for(const D in l)h[D]||l[D].required&&l[D].default===void 0&&n[D]===void 0&&S.push(new It(e,n,`missing required property "${D}"`));return S}function Cc(i){const e=i.value,n=i.valueSpec,l=i.style,h=i.styleSpec,m=i.key,y=i.arrayElementValidator||i.validateSpec;if(kn(e)!=="array")return[new It(m,e,`array expected, ${kn(e)} found`)];if(n.length&&e.length!==n.length)return[new It(m,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new It(m,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let w={type:n.value,values:n.values};h.$version<7&&(w.function=n.function),kn(n.value)==="object"&&(w=n.value);let S=[];for(let I=0;I<e.length;I++)S=S.concat(y({array:e,arrayIndex:I,value:e[I],valueSpec:w,validateSpec:i.validateSpec,style:l,styleSpec:h,key:`${m}[${I}]`}));return S}function Eo(i){const e=i.key,n=i.value,l=i.valueSpec;let h=kn(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new It(e,n,`number expected, ${h} found`)]:"minimum"in l&&n<l.minimum?[new It(e,n,`${n} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&n>l.maximum?[new It(e,n,`${n} is greater than the maximum value ${l.maximum}`)]:[]}function Mo(i){const e=i.valueSpec,n=Hi(i.value.type);let l,h,m,y={};const w=n!=="categorical"&&i.value.property===void 0,S=!w,I=kn(i.value.stops)==="array"&&kn(i.value.stops[0])==="array"&&kn(i.value.stops[0][0])==="object",D=ds({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(G){if(n==="identity")return[new It(G.key,G.value,'identity function may not have a "stops" property')];let H=[];const W=G.value;return H=H.concat(Cc({key:G.key,value:W,valueSpec:G.valueSpec,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:O})),kn(W)==="array"&&W.length===0&&H.push(new It(G.key,W,"array must have at least one stop")),H},default:function(G){return G.validateSpec({key:G.key,value:G.value,valueSpec:e,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec})}}});return n==="identity"&&w&&D.push(new It(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||D.push(new It(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!wo(i.valueSpec)&&D.push(new It(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(S&&!Da(i.valueSpec)?D.push(new It(i.key,i.value,"property functions not supported")):w&&!nu(i.valueSpec)&&D.push(new It(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!I||i.value.property!==void 0||D.push(new It(i.key,i.value,'"property" property is required')),D;function O(G){let H=[];const W=G.value,K=G.key;if(kn(W)!=="array")return[new It(K,W,`array expected, ${kn(W)} found`)];if(W.length!==2)return[new It(K,W,`array length 2 expected, length ${W.length} found`)];if(I){if(kn(W[0])!=="object")return[new It(K,W,`object expected, ${kn(W[0])} found`)];if(W[0].zoom===void 0)return[new It(K,W,"object stop key must have zoom")];if(W[0].value===void 0)return[new It(K,W,"object stop key must have value")];if(m&&m>Hi(W[0].zoom))return[new It(K,W[0].zoom,"stop zoom values must appear in ascending order")];Hi(W[0].zoom)!==m&&(m=Hi(W[0].zoom),h=void 0,y={}),H=H.concat(ds({key:`${K}[0]`,value:W[0],valueSpec:{zoom:{}},validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Eo,value:j}}))}else H=H.concat(j({key:`${K}[0]`,value:W[0],validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec},W));return Tl(Ha(W[1]))?H.concat([new It(`${K}[1]`,W[1],"expressions are not allowed in function stops.")]):H.concat(G.validateSpec({key:`${K}[1]`,value:W[1],valueSpec:e,validateSpec:G.validateSpec,style:G.style,styleSpec:G.styleSpec}))}function j(G,H){const W=kn(G.value),K=Hi(G.value),ie=G.value!==null?G.value:H;if(l){if(W!==l)return[new It(G.key,ie,`${W} stop domain type must match previous stop domain type ${l}`)]}else l=W;if(W!=="number"&&W!=="string"&&W!=="boolean")return[new It(G.key,ie,"stop domain value must be a number, string, or boolean")];if(W!=="number"&&n!=="categorical"){let ye=`number expected, ${W} found`;return Da(e)&&n===void 0&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(G.key,ie,ye)]}return n!=="categorical"||W!=="number"||isFinite(K)&&Math.floor(K)===K?n!=="categorical"&&W==="number"&&h!==void 0&&K<h?[new It(G.key,ie,"stop domain values must appear in ascending order")]:(h=K,n==="categorical"&&K in y?[new It(G.key,ie,"stop domain values must be unique")]:(y[K]=!0,[])):[new It(G.key,ie,`integer expected, found ${K}`)]}}function Co(i){const e=(i.expressionContext==="property"?El:Mc)(Ha(i.value),i.valueSpec);if(e.result==="error")return e.value.map((l=>new It(`${i.key}${l.key}`,i.value,l.message)));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new It(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!xo(n))return[new It(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!xo(n))return[new It(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!bo(n,["zoom","feature-state"]))return[new It(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ks(n))return[new It(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xo(i){const e=i.key,n=i.value,l=kn(n);return l!=="string"?[new It(e,n,`color expected, ${l} found`)]:In.parse(String(n))?[]:[new It(e,n,`color expected, "${n}" found`)]}function $o(i){const e=i.key,n=i.value,l=i.valueSpec,h=[];return Array.isArray(l.values)?l.values.indexOf(Hi(n))===-1&&h.push(new It(e,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(Hi(n))===-1&&h.push(new It(e,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function Ds(i){return To(Ha(i.value))?Co(mr({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Io(i)}function Io(i){const e=i.value,n=i.key;if(kn(e)!=="array")return[new It(n,e,`array expected, ${kn(e)} found`)];const l=i.styleSpec;let h,m=[];if(e.length<1)return[new It(n,e,"filter array must have at least 1 element")];switch(m=m.concat($o({key:`${n}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Hi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Hi(e[1])==="$type"&&m.push(new It(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new It(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=kn(e[1]),h!=="string"&&m.push(new It(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let y=2;y<e.length;y++)h=kn(e[y]),Hi(e[1])==="$type"?m=m.concat($o({key:`${n}[${y}]`,value:e[y],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&m.push(new It(`${n}[${y}]`,e[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)m=m.concat(Io({key:`${n}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=kn(e[1]),e.length!==2?m.push(new It(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&m.push(new It(`${n}[1]`,e[1],`string expected, ${h} found`))}return m}function Wo(i,e){const n=i.key,l=i.validateSpec,h=i.style,m=i.styleSpec,y=i.value,w=i.objectKey,S=m[`${e}_${i.layerType}`];if(!S)return[];const I=w.match(/^(.*)-transition$/);if(e==="paint"&&I&&S[I[1]]&&S[I[1]].transition)return l({key:n,value:y,valueSpec:m.transition,style:h,styleSpec:m});const D=i.valueSpec||S[w];if(!D)return[new It(n,y,`unknown property "${w}"`)];let O;if(kn(y)==="string"&&Da(D)&&!D.tokens&&(O=/^{([^}]+)}$/.exec(y)))return[new It(n,y,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(O[1])} }\`.`)];const j=[];return i.layerType==="symbol"&&w==="text-font"&&hh(Ha(y))&&Hi(y.type)==="identity"&&j.push(new It(n,y,'"text-font" does not support identity functions')),j.concat(l({key:i.key,value:y,valueSpec:D,style:h,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:w}))}function Ao(i){return Wo(i,"paint")}function mh(i){return Wo(i,"layout")}function gh(i){let e=[];const n=i.value,l=i.key,h=i.style,m=i.styleSpec;if(kn(n)!=="object")return[new It(l,n,`object expected, ${kn(n)} found`)];n.type||n.ref||e.push(new It(l,n,'either "type" or "ref" is required'));let y=Hi(n.type);const w=Hi(n.ref);if(n.id){const S=Hi(n.id);for(let I=0;I<i.arrayIndex;I++){const D=h.layers[I];Hi(D.id)===S&&e.push(new It(l,n.id,`duplicate layer id "${n.id}", previously used at line ${D.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach((I=>{I in n&&e.push(new It(l,n[I],`"${I}" is prohibited for ref layers`))})),h.layers.forEach((I=>{Hi(I.id)===w&&(S=I)})),S?S.ref?e.push(new It(l,n.ref,"ref cannot reference another ref layer")):y=Hi(S.type):e.push(new It(l,n.ref,`ref layer "${w}" not found`))}else if(y!=="background")if(n.source){const S=h.sources&&h.sources[n.source],I=S&&Hi(S.type);S?I==="vector"&&y==="raster"?e.push(new It(l,n.source,`layer "${n.id}" requires a raster source`)):I!=="raster-dem"&&y==="hillshade"||I!=="raster-dem"&&y==="color-relief"?e.push(new It(l,n.source,`layer "${n.id}" requires a raster-dem source`)):I==="raster"&&y!=="raster"?e.push(new It(l,n.source,`layer "${n.id}" requires a vector source`)):I!=="vector"||n["source-layer"]?I==="raster-dem"&&y!=="hillshade"&&y!=="color-relief"?e.push(new It(l,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]||I==="geojson"&&S.lineMetrics||e.push(new It(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new It(l,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new It(l,n.source,`source "${n.source}" not found`))}else e.push(new It(l,n,'missing required property "source"'));return e=e.concat(ds({key:l,value:n,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:n.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Ds,layout:S=>ds({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>mh(mr({layerType:y},I))}}),paint:S=>ds({layer:n,key:S.key,value:S.value,style:S.style,styleSpec:S.styleSpec,validateSpec:S.validateSpec,objectElementValidators:{"*":I=>Ao(mr({layerType:y},I))}})}})),e}function Ps(i){const e=i.value,n=i.key,l=kn(e);return l!=="string"?[new It(n,e,`string expected, ${l} found`)]:[]}const Vu={promoteId:function({key:i,value:e}){if(kn(e)==="string")return Ps({key:i,value:e});{const n=[];for(const l in e)n.push(...Ps({key:`${i}.${l}`,value:e[l]}));return n}}};function Qo(i){const e=i.value,n=i.key,l=i.styleSpec,h=i.style,m=i.validateSpec;if(!e.type)return[new It(n,e,'"type" is required')];const y=Hi(e.type);let w;switch(y){case"vector":case"raster":return w=ds({key:n,value:e,valueSpec:l[`source_${y.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:Vu,validateSpec:m}),w;case"raster-dem":return w=(function(S){var I;const D=(I=S.sourceName)!==null&&I!==void 0?I:"",O=S.value,j=S.styleSpec,G=j.source_raster_dem,H=S.style;let W=[];const K=kn(O);if(O===void 0)return W;if(K!=="object")return W.push(new It("source_raster_dem",O,`object expected, ${K} found`)),W;const ie=Hi(O.encoding)==="custom",ye=["redFactor","greenFactor","blueFactor","baseShift"],ae=S.value.encoding?`"${S.value.encoding}"`:"Default";for(const le in O)!ie&&ye.includes(le)?W.push(new It(le,O[le],`In "${D}": "${le}" is only valid when "encoding" is set to "custom". ${ae} encoding found`)):G[le]?W=W.concat(S.validateSpec({key:le,value:O[le],valueSpec:G[le],validateSpec:S.validateSpec,style:H,styleSpec:j})):W.push(new It(le,O[le],`unknown property "${le}"`));return W})({sourceName:n,value:e,style:i.style,styleSpec:l,validateSpec:m}),w;case"geojson":if(w=ds({key:n,value:e,valueSpec:l.source_geojson,style:h,styleSpec:l,validateSpec:m,objectElementValidators:Vu}),e.cluster)for(const S in e.clusterProperties){const[I,D]=e.clusterProperties[S],O=typeof I=="string"?[I,["accumulated"],["get",S]]:I;w.push(...Co({key:`${n}.${S}.map`,value:D,expressionContext:"cluster-map"})),w.push(...Co({key:`${n}.${S}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return w;case"video":return ds({key:n,value:e,valueSpec:l.source_video,style:h,validateSpec:m,styleSpec:l});case"image":return ds({key:n,value:e,valueSpec:l.source_image,style:h,validateSpec:m,styleSpec:l});case"canvas":return[new It(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $o({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function yr(i){const e=i.value,n=i.styleSpec,l=n.light,h=i.style;let m=[];const y=kn(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new It("light",e,`object expected, ${y} found`)]),m;for(const w in e){const S=w.match(/^(.*)-transition$/);m=m.concat(S&&l[S[1]]&&l[S[1]].transition?i.validateSpec({key:w,value:e[w],valueSpec:n.transition,validateSpec:i.validateSpec,style:h,styleSpec:n}):l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new It(w,e[w],`unknown property "${w}"`)])}return m}function Ic(i){const e=i.value,n=i.styleSpec,l=n.sky,h=i.style,m=kn(e);if(e===void 0)return[];if(m!=="object")return[new It("sky",e,`object expected, ${m} found`)];let y=[];for(const w in e)y=y.concat(l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],style:h,styleSpec:n}):[new It(w,e[w],`unknown property "${w}"`)]);return y}function _h(i){const e=i.value,n=i.styleSpec,l=n.terrain,h=i.style;let m=[];const y=kn(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new It("terrain",e,`object expected, ${y} found`)]),m;for(const w in e)m=m.concat(l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new It(w,e[w],`unknown property "${w}"`)]);return m}function uf(i){let e=[];const n=i.value,l=i.key;if(Array.isArray(n)){const h=[],m=[];for(const y in n)n[y].id&&h.includes(n[y].id)&&e.push(new It(l,n,`all the sprites' ids must be unique, but ${n[y].id} is duplicated`)),h.push(n[y].id),n[y].url&&m.includes(n[y].url)&&e.push(new It(l,n,`all the sprites' URLs must be unique, but ${n[y].url} is duplicated`)),m.push(n[y].url),e=e.concat(ds({key:`${l}[${y}]`,value:n[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Ps({key:l,value:n})}function od(i){return e=i.value,e&&e.constructor===Object?[]:[new It(i.key,i.value,`object expected, ${kn(i.value)} found`)];var e}const cf={"*":()=>[],array:Cc,boolean:function(i){const e=i.value,n=i.key,l=kn(e);return l!=="boolean"?[new It(n,e,`boolean expected, ${l} found`)]:[]},number:Eo,color:Xo,constants:fs,enum:$o,filter:Ds,function:Mo,layer:gh,object:ds,source:Qo,light:yr,sky:Ic,terrain:_h,projection:function(i){const e=i.value,n=i.styleSpec,l=n.projection,h=i.style,m=kn(e);if(e===void 0)return[];if(m!=="object")return[new It("projection",e,`object expected, ${m} found`)];let y=[];for(const w in e)y=y.concat(l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],style:h,styleSpec:n}):[new It(w,e[w],`unknown property "${w}"`)]);return y},projectionDefinition:function(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const l=kn(n);return l!=="array"||(function(h){return Array.isArray(h)&&h.length===3&&typeof h[0]=="string"&&typeof h[1]=="string"&&typeof h[2]=="number"})(n)||(function(h){return!!["interpolate","step","literal"].includes(h[0])})(n)?["array","string"].includes(l)?[]:[new It(e,n,`projection expected, invalid type "${l}" found`)]:[new It(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Ps,formatted:function(i){return Ps(i).length===0?[]:Co(i)},resolvedImage:function(i){return Ps(i).length===0?[]:Co(i)},padding:function(i){const e=i.key,n=i.value;if(kn(n)==="array"){if(n.length<1||n.length>4)return[new It(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const l={type:"number"};let h=[];for(let m=0;m<n.length;m++)h=h.concat(i.validateSpec({key:`${e}[${m}]`,value:n[m],validateSpec:i.validateSpec,valueSpec:l}));return h}return Eo({key:e,value:n,valueSpec:{}})},numberArray:function(i){const e=i.key,n=i.value;if(kn(n)==="array"){const l={type:"number"};if(n.length<1)return[new It(e,n,"array length at least 1 expected, length 0 found")];let h=[];for(let m=0;m<n.length;m++)h=h.concat(i.validateSpec({key:`${e}[${m}]`,value:n[m],validateSpec:i.validateSpec,valueSpec:l}));return h}return Eo({key:e,value:n,valueSpec:{}})},colorArray:function(i){const e=i.key,n=i.value;if(kn(n)==="array"){if(n.length<1)return[new It(e,n,"array length at least 1 expected, length 0 found")];let l=[];for(let h=0;h<n.length;h++)l=l.concat(Xo({key:`${e}[${h}]`,value:n[h]}));return l}return Xo({key:e,value:n})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,l=kn(n),h=i.styleSpec;if(l!=="array"||n.length<1||n.length%2!=0)return[new It(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let y=0;y<n.length;y+=2)m=m.concat($o({key:`${e}[${y}]`,value:n[y],valueSpec:h.layout_symbol["text-anchor"]})),m=m.concat(Cc({key:`${e}[${y+1}]`,value:n[y+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:h}));return m},sprite:uf,state:od};function Xi(i){const e=i.value,n=i.valueSpec,l=i.styleSpec;return i.validateSpec=Xi,n.expression&&hh(Hi(e))?Mo(i):n.expression&&Tl(Ha(e))?Co(i):n.type&&cf[n.type]?cf[n.type](i):ds(mr({},i,{valueSpec:n.type?l[n.type]:n}))}function Cl(i){const e=i.value,n=i.key,l=Ps(i);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new It(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new It(n,e,'"glyphs" url must include a "{range}" token'))),l}function xa(i,e=Ge){let n=[];return n=n.concat(Xi({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Xi,objectElementValidators:{glyphs:Cl,"*":()=>[]}})),i.constants&&(n=n.concat(fs({key:"constants",value:i.constants}))),yh(n)}function Ra(i){return function(e){return i(Object.assign({},e,{validateSpec:Xi}))}}function yh(i){return[].concat(i).sort(((e,n)=>e.line-n.line))}function ba(i){return function(...e){return yh(i.apply(this,e))}}xa.source=ba(Ra(Qo)),xa.sprite=ba(Ra(uf)),xa.glyphs=ba(Ra(Cl)),xa.light=ba(Ra(yr)),xa.sky=ba(Ra(Ic)),xa.terrain=ba(Ra(_h)),xa.state=ba(Ra(od)),xa.layer=ba(Ra(gh)),xa.filter=ba(Ra(Ds)),xa.paintProperty=ba(Ra(Ao)),xa.layoutProperty=ba(Ra(mh));const Uu=Ge,ju=xa,Gu=ju.light,Ac=ju.sky,Xa=ju.paintProperty,$s=ju.layoutProperty;function kc(i,e){let n=!1;if(e&&e.length)for(const l of e)i.fire(new Dn(new Error(l.message))),n=!0;return n}class Il{constructor(e,n,l){const h=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(n=y[1])+2*(l=y[2]);for(let S=0;S<this.d*this.d;S++){const I=y[3+S],D=y[3+S+1];h.push(I===D?null:y.subarray(I,D))}const w=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*l;for(let y=0;y<this.d*this.d;y++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=l,this.scale=n/e,this.uid=0;const m=l/n*e;this.min=-m,this.max=e+m}insert(e,n,l,h,m){this._forEachCell(n,l,h,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,l,h,m,y){this.cells[m].push(y)}query(e,n,l,h,m){const y=this.min,w=this.max;if(e<=y&&n<=y&&w<=l&&w<=h&&!m)return Array.prototype.slice.call(this.keys);{const S=[];return this._forEachCell(e,n,l,h,this._queryCell,S,{},m),S}}_queryCell(e,n,l,h,m,y,w,S){const I=this.cells[m];if(I!==null){const D=this.keys,O=this.bboxes;for(let j=0;j<I.length;j++){const G=I[j];if(w[G]===void 0){const H=4*G;(S?S(O[H+0],O[H+1],O[H+2],O[H+3]):e<=O[H+2]&&n<=O[H+3]&&l>=O[H+0]&&h>=O[H+1])?(w[G]=!0,y.push(D[G])):w[G]=!1}}}}_forEachCell(e,n,l,h,m,y,w,S){const I=this._convertToCellCoord(e),D=this._convertToCellCoord(n),O=this._convertToCellCoord(l),j=this._convertToCellCoord(h);for(let G=I;G<=O;G++)for(let H=D;H<=j;H++){const W=this.d*H+G;if((!S||S(this._convertFromCellCoord(G),this._convertFromCellCoord(H),this._convertFromCellCoord(G+1),this._convertFromCellCoord(H+1)))&&m.call(this,e,n,l,h,W,y,w,S))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let l=0;for(let y=0;y<this.cells.length;y++)l+=this.cells[y].length;const h=new Int32Array(n+l+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let m=n;for(let y=0;y<e.length;y++){const w=e[y];h[3+y]=m,h.set(w,m),m+=w.length}return h[3+e.length]=m,h.set(this.keys,m),m+=this.keys.length,h[3+e.length+1]=m,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer}static serialize(e,n){const l=e.toArrayBuffer();return n&&n.push(l),{buffer:l}}static deserialize(e){return new Il(e.buffer)}}const ko={};function Bt(i,e,n={}){if(ko[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),ko[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Bt("Object",Object),Bt("Set",Set),Bt("TransferableGridIndex",Il),Bt("Color",In),Bt("Error",Error),Bt("AJAXError",De),Bt("ResolvedImage",An),Bt("StylePropertyFunction",iu),Bt("StyleExpression",ph,{omit:["_evaluator"]}),Bt("ZoomDependentExpression",Sl),Bt("ZoomConstantExpression",Pa),Bt("CompoundExpression",Cn,{omit:["_evaluate"]});for(const i in zn)zn[i]._classRegistryKey||Bt(`Expression_${i}`,zn[i]);function Dc(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Al(i){return i.$name||i.constructor._classRegistryKey}function Pc(i){return!(function(e){if(e===null||typeof e!="object")return!1;const n=Al(e);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Dc(i)||Vs(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function kl(i,e){if(Pc(i))return(Dc(i)||Vs(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const m=[];for(const y of i)m.push(kl(y,e));return m}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=Al(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!ko[n])throw new Error(`${n} is not registered.`);const{klass:l}=ko[n],h=l.serialize?l.serialize(i,e):{};if(l.serialize){if(e&&h===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in i){if(!i.hasOwnProperty(m)||ko[n].omit.indexOf(m)>=0)continue;const y=i[m];h[m]=ko[n].shallow.indexOf(m)>=0?y:kl(y,e)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(h.$name=n),h}function qu(i){if(Pc(i))return i;if(Array.isArray(i))return i.map(qu);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=Al(i)||"Object";if(!ko[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=ko[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const l=Object.create(n.prototype);for(const h of Object.keys(i)){if(h==="$name")continue;const m=i[h];l[h]=ko[e].shallow.indexOf(h)>=0?m:qu(m)}return l}class ps{constructor(){this.first=!0}update(e,n){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}function au(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function vh(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function hf(i){return/\s/u.test(String.fromCodePoint(i))}function Rs(i){for(const e of i)if(vh(e.codePointAt(0)))return!0;return!1}function Rc(i){for(const e of i)if(!xh(e.codePointAt(0)))return!1;return!0}function Lc(i){const e=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const Dl=Lc(["Arab","Dupl","Mong","Ougr","Syrc"]);function xh(i){return!Dl.test(String.fromCodePoint(i))}function zc(i){return!(vh(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Do=Lc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function bh(i){return Do.test(String.fromCodePoint(i))}function Ko(i,e){return!(!e&&bh(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function wh(i){for(const e of i)if(bh(e.codePointAt(0)))return!0;return!1}const Ws=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Ws.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return f(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,l=new Promise((m=>{this.loadScriptResolve=m}));e(n);const h=new Promise((m=>setTimeout((()=>m()),this.TIMEOUT)));if(yield Promise.race([l,h]),this.isParsed()){const m={pluginStatus:"loaded",pluginURL:n};return this.setState(m),m}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class qn{constructor(e,n){this.isSupportedScript=Jo,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new ps,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ps,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*n}}}function Jo(i){return(function(e,n){for(const l of e)if(!Ko(l.codePointAt(0),n))return!1;return!0})(i,Ws.getRTLTextPluginStatus()==="loaded")}const Pl="-transition";class su{constructor(e,n,l){this.property=e,this.value=n,this.expression=(function(h,m,y){if(hh(h))return new iu(h,m);if(Tl(h)){const w=El(h,m,y);if(w.result==="error")throw new Error(w.value.map((S=>`${S.key}: ${S.message}`)).join(", "));return w.value}{let w=h;return m.type==="color"&&typeof h=="string"?w=In.parse(h):m.type!=="padding"||typeof h!="number"&&!Array.isArray(h)?m.type!=="numberArray"||typeof h!="number"&&!Array.isArray(h)?m.type!=="colorArray"||typeof h!="string"&&!Array.isArray(h)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(h)?w=Li.parse(h):m.type==="projectionDefinition"&&typeof h=="string"&&(w=ci.parse(h)):w=mn.parse(h):w=ki.parse(h):w=tr.parse(h),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>w}}})(n===void 0?e.specification.default:n,e.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class Oc{constructor(e,n){this.property=e,this.value=new su(e,void 0,n)}transitioned(e,n){return new Zu(this.property,this.value,n,Ue({},e.transition,this.transition),e.now)}untransitioned(){return new Zu(this.property,this.value,null,{},0)}}class ou{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return Se(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Oc(this._values[e].property,this._globalState)),this._values[e].value=new su(this._values[e].property,n===null?void 0:Se(n),this._globalState)}getTransition(e){return Se(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Oc(this._values[e].property,this._globalState)),this._values[e].transition=Se(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const h=this.getTransition(n);h!==void 0&&(e[`${n}${Pl}`]=h)}return e}transitioned(e,n){const l=new Th(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,n._values[h]);return l}untransitioned(){const e=new Th(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Zu{constructor(e,n,l,h,m){this.property=e,this.value=n,this.begin=m+h.delay||0,this.end=this.begin+h.duration||0,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const h=e.now||0,m=this.value.possiblyEvaluate(e,n,l),y=this.prior;if(y){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return y.possiblyEvaluate(e,n,l);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,n,l),m,zt(w))}}return m}}class Th{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const h=new lu(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,n,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ff{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Se(this._values[e].value)}setValue(e,n){this._values[e]=new su(this._values[e].property,n===null?void 0:Se(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){const h=new lu(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(e,n,l);return h}}class La{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,h){return this.property.evaluate(this.value,this.parameters,e,n,l,h)}}class lu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Kt{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,l){const h=Di[this.specification.type];return h?h(e,n,l):e}}class cn{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,h){return new La(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,h)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new La(this,{kind:"constant",value:void 0},e.parameters);const h=Di[this.specification.type];if(h){const m=h(e.value.value,n.value.value,l);return new La(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,n,l,h,m,y){return e.kind==="constant"?e.value:e.evaluate(n,l,h,m,y)}}class Rl extends cn{possiblyEvaluate(e,n,l,h){if(e.value===void 0)return new La(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},l,h),y=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,w=this._calculate(y,y,y,n);return new La(this,{kind:"constant",value:w},n)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new La(this,{kind:"constant",value:m},n)}return new La(this,e.expression,n)}evaluate(e,n,l,h,m,y){if(e.kind==="source"){const w=e.evaluate(n,l,h,m,y);return this._calculate(w,w,w,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},l,h),e.evaluate({zoom:Math.floor(n.zoom)},l,h),e.evaluate({zoom:Math.floor(n.zoom)+1},l,h),n):e.value}_calculate(e,n,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class za{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,h){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},l,h);return this._calculate(m,m,m,n)}return this._calculate(e.expression.evaluate(new qn(Math.floor(n.zoom-1),n)),e.expression.evaluate(new qn(Math.floor(n.zoom),n)),e.expression.evaluate(new qn(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class ea{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,h){return!!e.expression.evaluate(n,null,{},l,h)}interpolate(){return!1}}class cr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const l=e[n];l.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new su(l,void 0,void 0),m=this.defaultTransitionablePropertyValues[n]=new Oc(l,void 0);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}Bt("DataDrivenProperty",cn),Bt("DataConstantProperty",Kt),Bt("CrossFadedDataDrivenProperty",Rl),Bt("CrossFadedProperty",za),Bt("ColorRampProperty",ea);class Oa extends Fn{constructor(e,n,l){if(super(),this.id=e.id,this.type=e.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Ya(e.filter,l)),n.layout&&(this._unevaluatedLayout=new ff(n.layout,l)),n.paint)){this._transitionablePaint=new ou(n.paint,l);for(const h in e.paint)this.setPaintProperty(h,e.paint[h],{validate:!1});for(const h in e.layout)this.setLayoutProperty(h,e.layout[h],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new lu(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=Ya(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[n];for(const h of l.getGlobalStateRefs())e.add(h)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const h=this._transitionablePaint._values[l].value;for(const m of h.getGlobalStateRefs()){const y=(e=n.get(m))!==null&&e!==void 0?e:[];y.push({name:l,value:h.value}),n.set(m,y)}}return n}setLayoutProperty(e,n,l={}){n!=null&&this._validate($s,`layers.${this.id}.layout.${e}`,e,n,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(Pl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,l={}){if(n!=null&&this._validate(Xa,`layers.${this.id}.paint.${e}`,e,n,l))return!1;if(e.endsWith(Pl))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[e],m=h.property.specification["property-type"]==="cross-faded-data-driven",y=h.value.isDataDriven(),w=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const S=this._transitionablePaint._values[e].value;return S.isDataDriven()||y||m||this._handleOverridablePaintPropertyUpdate(e,w,S)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),rn(e,((n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length)))}_validate(e,n,l,h,m={}){return(!m||m.validate!==!1)&&kc(this,e.call(ju,{key:n,layerType:this.type,objectKey:l,value:h,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof La&&Da(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let df;var Ll={get paint(){return df=df||new cr({"raster-opacity":new Kt(Ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Kt(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Kt(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Kt(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Kt(Ge.paint_raster["raster-saturation"]),"raster-contrast":new Kt(Ge.paint_raster["raster-contrast"]),"raster-resampling":new Kt(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Kt(Ge.paint_raster["raster-fade-duration"])})}};class $a extends Oa{constructor(e,n){super(e,Ll,n)}}const hr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class el{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ii{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function on(i,e=1){let n=0,l=0;return{members:i.map((h=>{const m=hr[h.type].BYTES_PER_ELEMENT,y=n=Ti(n,Math.max(e,m)),w=h.components||1;return l=Math.max(l,m),n+=m*w,{name:h.name,type:h.type,components:w,offset:y}})),size:Ti(n,Math.max(l,e)),alignment:e}}function Ti(i,e){return Math.ceil(i/e)*e}class $i extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=l,e}}$i.prototype.bytesPerElement=4,Bt("StructArrayLayout2i4",$i);class uu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const m=3*e;return this.int16[m+0]=n,this.int16[m+1]=l,this.int16[m+2]=h,e}}uu.prototype.bytesPerElement=6,Bt("StructArrayLayout3i6",uu);class ms extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,h)}emplace(e,n,l,h,m){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=l,this.int16[y+2]=h,this.int16[y+3]=m,e}}ms.prototype.bytesPerElement=8,Bt("StructArrayLayout4i8",ms);class tl extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,h,m,y)}emplace(e,n,l,h,m,y,w){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.int16[S+2]=h,this.int16[S+3]=m,this.int16[S+4]=y,this.int16[S+5]=w,e}}tl.prototype.bytesPerElement=12,Bt("StructArrayLayout2i4i12",tl);class Yu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,h,m,y)}emplace(e,n,l,h,m,y,w){const S=4*e,I=8*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.uint8[I+4]=h,this.uint8[I+5]=m,this.uint8[I+6]=y,this.uint8[I+7]=w,e}}Yu.prototype.bytesPerElement=8,Bt("StructArrayLayout2i4ub8",Yu);class nl extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=l,e}}nl.prototype.bytesPerElement=8,Bt("StructArrayLayout2f8",nl);class il extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y,w,S,I,D){const O=this.length;return this.resize(O+1),this.emplace(O,e,n,l,h,m,y,w,S,I,D)}emplace(e,n,l,h,m,y,w,S,I,D,O){const j=10*e;return this.uint16[j+0]=n,this.uint16[j+1]=l,this.uint16[j+2]=h,this.uint16[j+3]=m,this.uint16[j+4]=y,this.uint16[j+5]=w,this.uint16[j+6]=S,this.uint16[j+7]=I,this.uint16[j+8]=D,this.uint16[j+9]=O,e}}il.prototype.bytesPerElement=20,Bt("StructArrayLayout10ui20",il);class pf extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y,w,S){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,l,h,m,y,w,S)}emplace(e,n,l,h,m,y,w,S,I){const D=8*e;return this.uint16[D+0]=n,this.uint16[D+1]=l,this.uint16[D+2]=h,this.uint16[D+3]=m,this.uint16[D+4]=y,this.uint16[D+5]=w,this.uint16[D+6]=S,this.uint16[D+7]=I,e}}pf.prototype.bytesPerElement=16,Bt("StructArrayLayout8ui16",pf);class Wi extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y,w,S,I,D,O,j){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,l,h,m,y,w,S,I,D,O,j)}emplace(e,n,l,h,m,y,w,S,I,D,O,j,G){const H=12*e;return this.int16[H+0]=n,this.int16[H+1]=l,this.int16[H+2]=h,this.int16[H+3]=m,this.uint16[H+4]=y,this.uint16[H+5]=w,this.uint16[H+6]=S,this.uint16[H+7]=I,this.int16[H+8]=D,this.int16[H+9]=O,this.int16[H+10]=j,this.int16[H+11]=G,e}}Wi.prototype.bytesPerElement=24,Bt("StructArrayLayout4i4ui4i24",Wi);class Qs extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const m=3*e;return this.float32[m+0]=n,this.float32[m+1]=l,this.float32[m+2]=h,e}}Qs.prototype.bytesPerElement=12,Bt("StructArrayLayout3f12",Qs);class Hu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Hu.prototype.bytesPerElement=4,Bt("StructArrayLayout1ul4",Hu);class Xu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y,w,S,I){const D=this.length;return this.resize(D+1),this.emplace(D,e,n,l,h,m,y,w,S,I)}emplace(e,n,l,h,m,y,w,S,I,D){const O=10*e,j=5*e;return this.int16[O+0]=n,this.int16[O+1]=l,this.int16[O+2]=h,this.int16[O+3]=m,this.int16[O+4]=y,this.int16[O+5]=w,this.uint32[j+3]=S,this.uint16[O+8]=I,this.uint16[O+9]=D,e}}Xu.prototype.bytesPerElement=20,Bt("StructArrayLayout6i1ul2ui20",Xu);class Nc extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,h,m,y)}emplace(e,n,l,h,m,y,w){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=l,this.int16[S+2]=h,this.int16[S+3]=m,this.int16[S+4]=y,this.int16[S+5]=w,e}}Nc.prototype.bytesPerElement=12,Bt("StructArrayLayout2i2i2i12",Nc);class Bc extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,h,m)}emplace(e,n,l,h,m,y){const w=4*e,S=8*e;return this.float32[w+0]=n,this.float32[w+1]=l,this.float32[w+2]=h,this.int16[S+6]=m,this.int16[S+7]=y,e}}Bc.prototype.bytesPerElement=16,Bt("StructArrayLayout2f1f2i16",Bc);class Fc extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,h,m,y)}emplace(e,n,l,h,m,y,w){const S=16*e,I=4*e,D=8*e;return this.uint8[S+0]=n,this.uint8[S+1]=l,this.float32[I+1]=h,this.float32[I+2]=m,this.int16[D+6]=y,this.int16[D+7]=w,e}}Fc.prototype.bytesPerElement=16,Bt("StructArrayLayout2ub2f2i16",Fc);class rl extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=l,this.uint16[m+2]=h,e}}rl.prototype.bytesPerElement=6,Bt("StructArrayLayout3ui6",rl);class al extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y,w,S,I,D,O,j,G,H,W,K,ie){const ye=this.length;return this.resize(ye+1),this.emplace(ye,e,n,l,h,m,y,w,S,I,D,O,j,G,H,W,K,ie)}emplace(e,n,l,h,m,y,w,S,I,D,O,j,G,H,W,K,ie,ye){const ae=24*e,le=12*e,we=48*e;return this.int16[ae+0]=n,this.int16[ae+1]=l,this.uint16[ae+2]=h,this.uint16[ae+3]=m,this.uint32[le+2]=y,this.uint32[le+3]=w,this.uint32[le+4]=S,this.uint16[ae+10]=I,this.uint16[ae+11]=D,this.uint16[ae+12]=O,this.float32[le+7]=j,this.float32[le+8]=G,this.uint8[we+36]=H,this.uint8[we+37]=W,this.uint8[we+38]=K,this.uint32[le+10]=ie,this.int16[ae+22]=ye,e}}al.prototype.bytesPerElement=48,Bt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",al);class da extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,h,m,y,w,S,I,D,O,j,G,H,W,K,ie,ye,ae,le,we,Me,Ye,ct,it,gt,Ot,yt){const ot=this.length;return this.resize(ot+1),this.emplace(ot,e,n,l,h,m,y,w,S,I,D,O,j,G,H,W,K,ie,ye,ae,le,we,Me,Ye,ct,it,gt,Ot,yt)}emplace(e,n,l,h,m,y,w,S,I,D,O,j,G,H,W,K,ie,ye,ae,le,we,Me,Ye,ct,it,gt,Ot,yt,ot){const Ke=32*e,Yt=16*e;return this.int16[Ke+0]=n,this.int16[Ke+1]=l,this.int16[Ke+2]=h,this.int16[Ke+3]=m,this.int16[Ke+4]=y,this.int16[Ke+5]=w,this.int16[Ke+6]=S,this.int16[Ke+7]=I,this.uint16[Ke+8]=D,this.uint16[Ke+9]=O,this.uint16[Ke+10]=j,this.uint16[Ke+11]=G,this.uint16[Ke+12]=H,this.uint16[Ke+13]=W,this.uint16[Ke+14]=K,this.uint16[Ke+15]=ie,this.uint16[Ke+16]=ye,this.uint16[Ke+17]=ae,this.uint16[Ke+18]=le,this.uint16[Ke+19]=we,this.uint16[Ke+20]=Me,this.uint16[Ke+21]=Ye,this.uint16[Ke+22]=ct,this.uint32[Yt+12]=it,this.float32[Yt+13]=gt,this.float32[Yt+14]=Ot,this.uint16[Ke+30]=yt,this.uint16[Ke+31]=ot,e}}da.prototype.bytesPerElement=64,Bt("StructArrayLayout8i15ui1ul2f2ui64",da);class Fi extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Fi.prototype.bytesPerElement=4,Bt("StructArrayLayout1f4",Fi);class Po extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const m=3*e;return this.uint16[6*e+0]=n,this.float32[m+1]=l,this.float32[m+2]=h,e}}Po.prototype.bytesPerElement=12,Bt("StructArrayLayout1ui2f12",Po);class cu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,l)}emplace(e,n,l,h){const m=4*e;return this.uint32[2*e+0]=n,this.uint16[m+2]=l,this.uint16[m+3]=h,e}}cu.prototype.bytesPerElement=8,Bt("StructArrayLayout1ul2ui8",cu);class $u extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=l,e}}$u.prototype.bytesPerElement=4,Bt("StructArrayLayout2ui4",$u);class Wu extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Wu.prototype.bytesPerElement=2,Bt("StructArrayLayout1ui2",Wu);class Ks extends ii{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,h)}emplace(e,n,l,h,m){const y=4*e;return this.float32[y+0]=n,this.float32[y+1]=l,this.float32[y+2]=h,this.float32[y+3]=m,e}}Ks.prototype.bytesPerElement=16,Bt("StructArrayLayout4f16",Ks);class v extends el{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ue(this.anchorPointX,this.anchorPointY)}}v.prototype.size=20;class t extends Xu{get(e){return new v(this,e)}}Bt("CollisionBoxArray",t);class a extends el{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}a.prototype.size=48;class c extends al{get(e){return new a(this,e)}}Bt("PlacedSymbolArray",c);class p extends el{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class b extends da{get(e){return new p(this,e)}}Bt("SymbolInstanceArray",b);class T extends Fi{getoffsetX(e){return this.float32[1*e+0]}}Bt("GlyphOffsetArray",T);class C extends uu{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Bt("SymbolLineVertexArray",C);class A extends el{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}A.prototype.size=12;class z extends Po{get(e){return new A(this,e)}}Bt("TextAnchorOffsetArray",z);class N extends el{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}N.prototype.size=8;class Z extends cu{get(e){return new N(this,e)}}Bt("FeatureIndexArray",Z);class q extends $i{}class Q extends $i{}class ne extends $i{}class he extends tl{}class pe extends Yu{}class de extends nl{}class me extends il{}class Ee extends pf{}class _e extends Wi{}class Ce extends Qs{}class Ae extends Hu{}class be extends Nc{}class ze extends Fc{}class $e extends rl{}class Ze extends $u{}const We=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:Qe}=We;class mt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,l,h){const m=this.segments[this.segments.length-1];return e>mt.MAX_VERTEX_ARRAY_LENGTH&&vi(`Max vertices per segment is ${mt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${mt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!m||m.vertexLength+e>mt.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h?this.createNewSegment(n,l,h):m}createNewSegment(e,n,l){const h={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(h.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(h),h}getOrCreateLatestSegment(e,n,l){return this.prepareSegment(0,e,n,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,h){return new mt([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function kt(i,e){return 256*(i=Mn(Math.floor(i),0,255))+Mn(Math.floor(e),0,255)}mt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Bt("SegmentVector",mt);const dt=on([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Wt=on([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Sn,ti,Si,ri={exports:{}},Oi={exports:{}},fi={exports:{}},Sr=(function(){if(Si)return ri.exports;Si=1;var i=(Sn||(Sn=1,Oi.exports=function(n,l){var h,m,y,w,S,I,D,O;for(m=n.length-(h=3&n.length),y=l,S=3432918353,I=461845907,O=0;O<m;)D=255&n.charCodeAt(O)|(255&n.charCodeAt(++O))<<8|(255&n.charCodeAt(++O))<<16|(255&n.charCodeAt(++O))<<24,++O,y=27492+(65535&(w=5*(65535&(y=(y^=D=(65535&(D=(D=(65535&D)*S+(((D>>>16)*S&65535)<<16)&4294967295)<<15|D>>>17))*I+(((D>>>16)*I&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(D=0,h){case 3:D^=(255&n.charCodeAt(O+2))<<16;case 2:D^=(255&n.charCodeAt(O+1))<<8;case 1:y^=D=(65535&(D=(D=(65535&(D^=255&n.charCodeAt(O)))*S+(((D>>>16)*S&65535)<<16)&4294967295)<<15|D>>>17))*I+(((D>>>16)*I&65535)<<16)&4294967295}return y^=n.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Oi.exports),e=(ti||(ti=1,fi.exports=function(n,l){for(var h,m=n.length,y=l^m,w=0;m>=4;)h=1540483477*(65535&(h=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24))+((1540483477*(h>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++w;switch(m){case 3:y^=(255&n.charCodeAt(w+2))<<16;case 2:y^=(255&n.charCodeAt(w+1))<<8;case 1:y=1540483477*(65535&(y^=255&n.charCodeAt(w)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),fi.exports);return ri.exports=i,ri.exports.murmur3=i,ri.exports.murmur2=e,ri.exports})(),Pi=ge(Sr);class Er{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,l,h){this.ids.push(Qi(e)),this.positions.push(n,l,h)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=Qi(e);let l=0,h=this.ids.length-1;for(;l<h;){const y=l+h>>1;this.ids[y]>=n?h=y:l=y+1}const m=[];for(;this.ids[l]===n;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(e,n){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return ir(l,h,0,l.length-1),n&&n.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(e){const n=new Er;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function Qi(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Pi(String(i))}function ir(i,e,n,l){for(;n<l;){const h=i[n+l>>1];let m=n-1,y=l+1;for(;;){do m++;while(i[m]<h);do y--;while(i[y]>h);if(m>=y)break;ta(i,m,y),ta(e,3*m,3*y),ta(e,3*m+1,3*y+1),ta(e,3*m+2,3*y+2)}y-n<l-y?(ir(i,e,n,y),n=y+1):(ir(i,e,y+1,l),l=y)}}function ta(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}Bt("FeaturePositionMap",Er);class pa{constructor(e,n){this.gl=e.gl,this.location=n}}class Js extends pa{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class sl extends pa{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class hu extends pa{constructor(e,n){super(e,n),this.current=In.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Sh=new Float32Array(16);function fu(i){return[kt(255*i.r,255*i.g),kt(255*i.b,255*i.a)]}class Wa{constructor(e,n,l){this.value=e,this.uniformNames=n.map((h=>`u_${h}`)),this.type=l}setUniform(e,n,l){e.set(l.constantOr(this.value))}getBinding(e,n,l){return this.type==="color"?new hu(e,n):new Js(e,n)}}class Mr{constructor(e,n){this.uniformNames=n.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,l,h){let m=null;h==="u_pattern_to"?m=this.patternTo:h==="u_pattern_from"?m=this.patternFrom:h==="u_dasharray_to"?m=this.dashTo:h==="u_dasharray_from"?m=this.dashFrom:h==="u_pixel_ratio_to"?m=this.pixelRatioTo:h==="u_pixel_ratio_from"&&(m=this.pixelRatioFrom),m!==null&&e.set(m)}getBinding(e,n,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new sl(e,n):new Js(e,n)}}class Ur{constructor(e,n,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map((m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new h}populatePaintArray(e,n,l){const h=this.paintVertexArray.length,m=this.expression.evaluate(new qn(0,l),n,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(h,e,m)}updatePaintArray(e,n,l,h,m){const y=this.expression.evaluate(new qn(0,m),l,h);this._setPaintValue(e,n,y)}_setPaintValue(e,n,l){if(this.type==="color"){const h=fu(l);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class na{constructor(e,n,l,h,m,y){this.expression=e,this.uniformNames=n.map((w=>`u_${w}_t`)),this.type=l,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map((w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new y}populatePaintArray(e,n,l){const h=this.expression.evaluate(new qn(this.zoom,l),n,{},l.canonical,[],l.formattedSection),m=this.expression.evaluate(new qn(this.zoom+1,l),n,{},l.canonical,[],l.formattedSection),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,h,m)}updatePaintArray(e,n,l,h,m){const y=this.expression.evaluate(new qn(this.zoom,m),l,h),w=this.expression.evaluate(new qn(this.zoom+1,m),l,h);this._setPaintValue(e,n,y,w)}_setPaintValue(e,n,l,h){if(this.type==="color"){const m=fu(l),y=fu(h);for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,m[0],m[1],y[0],y[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const l=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=Mn(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(h)}getBinding(e,n,l){return new Js(e,n)}}class gs{constructor(e,n,l,h,m,y){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=h,this.layerId=y,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,n,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(h,e,this.getPositionIds(n),l)}updatePaintArray(e,n,l,h,m){this._setPaintValues(e,n,this.getPositionIds(l),m)}_setPaintValues(e,n,l,h){const m=this.getPositions(h);if(!m||!l)return;const y=m[l.min],w=m[l.mid],S=m[l.max];if(y&&w&&S)for(let I=e;I<n;I++)this.emplace(this.zoomInPaintVertexArray,I,w,y),this.emplace(this.zoomOutPaintVertexArray,I,w,S)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ki extends gs{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return dt.members}emplace(e,n,l,h){e.emplace(n,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],h.tlbr[0],h.tlbr[1],h.tlbr[2],h.tlbr[3],l.pixelRatio,h.pixelRatio)}}class Cr extends gs{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return Wt.members}emplace(e,n,l,h){e.emplace(n,0,l.y,l.height,l.width,0,h.y,h.height,h.width)}}class Na{constructor(e,n,l){this.binders={},this._buffers=[];const h=[];for(const m in e.paint._values){if(!l(m))continue;const y=e.paint.get(m);if(!(y instanceof La&&Da(y.property.specification)))continue;const w=mf(m,e.type),S=y.value,I=y.property.specification.type,D=y.property.useIntegerZoom,O=y.property.specification["property-type"],j=O==="cross-faded"||O==="cross-faded-data-driven";if(S.kind==="constant")this.binders[m]=j?new Mr(S.value,w):new Wa(S.value,w,I),h.push(`/u_${m}`);else if(S.kind==="source"||j){const G=Eh(m,I,"source");this.binders[m]=j?m==="line-dasharray"?new Cr(S,I,D,n,G,e.id):new Ki(S,I,D,n,G,e.id):new Ur(S,w,I,G),h.push(`/a_${m}`)}else{const G=Eh(m,I,"composite");this.binders[m]=new na(S,w,I,D,n,G),h.push(`/z_${m}`)}}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Ur||n instanceof na?n.maxValue:0}populatePaintArrays(e,n,l){for(const h in this.binders){const m=this.binders[h];(m instanceof Ur||m instanceof na||m instanceof gs)&&m.populatePaintArray(e,n,l)}}setConstantPatternPositions(e,n){for(const l in this.binders){const h=this.binders[l];h instanceof Mr&&h.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const l in this.binders){const h=this.binders[l];h instanceof Mr&&h.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,l,h,m){let y=!1;for(const w in e){const S=n.getPositions(w);for(const I of S){const D=l.feature(I.index);for(const O in this.binders){const j=this.binders[O];if((j instanceof Ur||j instanceof na||j instanceof gs)&&j.expression.isStateDependent===!0){const G=h.paint.get(O);j.expression=G.value,j.updatePaintArray(I.start,I.end,D,e[w],m),y=!0}}}}return y}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof Wa||l instanceof Mr)&&e.push(...l.uniformNames.map((h=>`#define HAS_UNIFORM_${h}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Ur||l instanceof na)for(let h=0;h<l.paintVertexAttributes.length;h++)e.push(l.paintVertexAttributes[h].name);else if(l instanceof gs){const h=l.getVertexAttributes();for(const m of h)e.push(m.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Wa||l instanceof Mr||l instanceof na)for(const h of l.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Wa||m instanceof Mr||m instanceof na){for(const y of m.uniformNames)if(n[y]){const w=m.getBinding(e,n[y],y);l.push({name:y,property:h,binding:w})}}}return l}setUniforms(e,n,l,h){for(const{name:m,property:y,binding:w}of n)this.binders[y].setUniform(w,h,l.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const l=this.binders[n];if(e&&l instanceof gs){const h=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof Ur||l instanceof na)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof Ur||l instanceof na||l instanceof gs)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Ur||n instanceof na||n instanceof gs)&&n.destroy()}}}class Vi{constructor(e,n,l=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new Na(h,n,l);this.needsUpload=!1,this._featureMap=new Er,this._bufferOffset=0}populatePaintArrays(e,n,l,h){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,n,h);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,h){for(const m of l)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,h)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function mf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Eh(i,e,n){const l={color:{source:nl,composite:Ks},number:{source:Fi,composite:nl}},h=(function(m){return{"line-pattern":{source:me,composite:me},"fill-pattern":{source:me,composite:me},"fill-extrusion-pattern":{source:me,composite:me},"line-dasharray":{source:Ee,composite:Ee}}[m]})(i);return h&&h[n]||l[e][n]}Bt("ConstantBinder",Wa),Bt("CrossFadedConstantBinder",Mr),Bt("SourceExpressionBinder",Ur),Bt("CrossFadedPatternBinder",Ki),Bt("CrossFadedDasharrayBinder",Cr),Bt("CompositeExpressionBinder",na),Bt("ProgramConfiguration",Na,{omit:["_buffers"]}),Bt("ProgramConfigurationSet",Vi);const Mh=Math.pow(2,14)-1,gf=-Mh-1;function _s(i){const e=Ht/i.extent,n=i.loadGeometry();for(let l=0;l<n.length;l++){const h=n[l];for(let m=0;m<h.length;m++){const y=h[m],w=Math.round(y.x*e),S=Math.round(y.y*e);y.x=Mn(w,gf,Mh),y.y=Mn(S,gf,Mh),(w<y.x||w>y.x+1||S<y.y||S>y.y+1)&&vi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function zl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?_s(i):[]}}const ol=-32768;function _f(i,e,n,l,h){i.emplaceBack(ol+8*e+l,ol+8*n+h)}class du{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new Q,this.indexArray=new $e,this.segments=new mt,this.programConfigurations=new Vi(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){const h=this.layers[0],m=[];let y=null,w=!1,S=h.type==="heatmap";if(h.type==="circle"){const D=h;y=D.layout.get("circle-sort-key"),w=!y.isConstant(),S=S||D.paint.get("circle-pitch-alignment")==="map"}const I=S?n.subdivisionGranularity.circle:1;for(const{feature:D,id:O,index:j,sourceLayerIndex:G}of e){const H=this.layers[0]._featureFilter.needGeometry,W=zl(D,H);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),W,l))continue;const K=w?y.evaluate(W,{},l):void 0,ie={id:O,properties:D.properties,type:D.type,sourceLayerIndex:G,index:j,geometry:H?W.geometry:_s(D),patterns:{},sortKey:K};m.push(ie)}w&&m.sort(((D,O)=>D.sortKey-O.sortKey));for(const D of m){const{geometry:O,index:j,sourceLayerIndex:G}=D,H=e[j].feature;this.addFeature(D,O,j,l,I),n.featureIndex.insert(H,O,j,G,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qe),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,h,m=1){let y;switch(m){case 1:y=[0,7];break;case 3:y=[0,2,5,7];break;case 5:y=[0,1,3,4,6,7];break;case 7:y=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${m}; valid values are 1, 3, 5, 7.`)}const w=y.length;for(const S of n)for(const I of S){const D=I.x,O=I.y;if(D<0||D>=Ht||O<0||O>=Ht)continue;const j=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,e.sortKey),G=j.vertexLength;for(let H=0;H<w;H++)for(let W=0;W<w;W++)_f(this.layoutVertexArray,D,O,y[W],y[H]);for(let H=0;H<w-1;H++)for(let W=0;W<w-1;W++){const K=G+H*w+W,ie=G+(H+1)*w+W;this.indexArray.emplaceBack(K,ie+1,K+1),this.indexArray.emplaceBack(K,ie,ie+1)}j.vertexLength+=w*w,j.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:{},canonical:h})}}function Ch(i,e){for(let n=0;n<i.length;n++)if(Vc(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Vc(i,e[n]))return!0;return!!up(i,e)}function Ol(i,e,n){return!!Vc(i,e)||!!Ir(e,i,n)}function Ih(i,e){if(i.length===1)return hp(e,i[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let h=0;h<l.length;h++)if(Vc(i,l[h]))return!0}for(let n=0;n<i.length;n++)if(hp(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(up(i,e[n]))return!0;return!1}function Ah(i,e,n){if(i.length>1){if(up(i,e))return!0;for(let l=0;l<e.length;l++)if(Ir(e[l],i,n))return!0}for(let l=0;l<i.length;l++)if(Ir(i[l],e,n))return!0;return!1}function up(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const l=i[n],h=i[n+1];for(let m=0;m<e.length-1;m++)if(cp(l,h,e[m],e[m+1]))return!0}return!1}function cp(i,e,n,l){return er(i,n,l)!==er(e,n,l)&&er(i,e,n)!==er(i,e,l)}function Ir(i,e,n){const l=n*n;if(e.length===1)return i.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(wa(i,e[h-1],e[h])<l)return!0;return!1}function wa(i,e,n){const l=e.distSqr(n);if(l===0)return i.distSqr(e);const h=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/l;return i.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function hp(i,e){let n,l,h,m=!1;for(let y=0;y<i.length;y++){n=i[y];for(let w=0,S=n.length-1;w<n.length;S=w++)l=n[w],h=n[S],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(m=!m)}return m}function Vc(i,e){let n=!1;for(let l=0,h=i.length-1;l<i.length;h=l++){const m=i[l],y=i[h];m.y>e.y!=y.y>e.y&&e.x<(y.x-m.x)*(e.y-m.y)/(y.y-m.y)+m.x&&(n=!n)}return n}function bm(i,e,n){const l=n[0],h=n[2];if(i.x<l.x&&e.x<l.x||i.x>h.x&&e.x>h.x||i.y<l.y&&e.y<l.y||i.y>h.y&&e.y>h.y)return!1;const m=er(i,e,n[0]);return m!==er(i,e,n[1])||m!==er(i,e,n[2])||m!==er(i,e,n[3])}function Uc(i,e,n){const l=e.paint.get(i).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(i)}function Qu(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function yf(i,e,n,l,h){if(!e[0]&&!e[1])return i;const m=ue.convert(e)._mult(h);n==="viewport"&&m._rotate(-l);const y=[];for(let w=0;w<i.length;w++)y.push(i[w].sub(m));return y}function ld(i){const e=[];for(let n=0;n<i.length;n++){const l=i[n],h=e.at(-1);(n===0||h&&!l.equals(h))&&e.push(l)}return e}function wm({queryGeometry:i,size:e},n){return Ol(i,n,e)}function Og({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:h},m){return Ol(i,m,e*(n.projectTileCoordinates(m.x,m.y,l,h).signedDistanceFromCamera/n.cameraToCenterDistance))}function ud({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:h},m){const y=n.projectTileCoordinates(m.x,m.y,l,h).signedDistanceFromCamera,w=e*(n.cameraToCenterDistance/y);return Ol(i,cd(m,n,l,h),w)}function fp({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:h},m){return Ol(i,cd(m,n,l,h),e)}function dp({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:h,pitchAlignment:m="map",pitchScale:y="map"},w){const S=m==="map"?y==="map"?wm:Og:y==="map"?ud:fp,I={queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:h};for(const D of w)for(const O of D)if(S(I,O))return!0;return!1}function cd(i,e,n,l){const h=e.projectTileCoordinates(i.x,i.y,n,l).point;return new ue((.5*h.x+.5)*e.width,(.5*-h.y+.5)*e.height)}let pp,hd;Bt("CircleBucket",du,{omit:["layers"]});var mp={get paint(){return hd=hd||new cr({"circle-radius":new cn(Ge.paint_circle["circle-radius"]),"circle-color":new cn(Ge.paint_circle["circle-color"]),"circle-blur":new cn(Ge.paint_circle["circle-blur"]),"circle-opacity":new cn(Ge.paint_circle["circle-opacity"]),"circle-translate":new Kt(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Kt(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Kt(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Kt(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new cn(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new cn(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new cn(Ge.paint_circle["circle-stroke-opacity"])})},get layout(){return pp=pp||new cr({"circle-sort-key":new cn(Ge.layout_circle["circle-sort-key"])})}};class gp extends Oa{constructor(e,n){super(e,mp,n)}createBucket(e){return new du(e)}queryRadius(e){const n=e;return Uc("circle-radius",this,n)+Uc("circle-stroke-width",this,n)+Qu(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:h,transform:m,pixelsToTileUnits:y,unwrappedTileID:w,getElevation:S}){const I=yf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-m.bearingInRadians,y),D=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),O=this.paint.get("circle-pitch-scale"),j=this.paint.get("circle-pitch-alignment");let G,H;return j==="map"?(G=I,H=D*y):(G=(function(W,K,ie,ye){return W.map((ae=>cd(ae,K,ie,ye)))})(I,m,w,S),H=D),dp({queryGeometry:G,size:H,transform:m,unwrappedTileID:w,getElevation:S,pitchAlignment:j,pitchScale:O},h)}}class _p extends du{}let fd;Bt("HeatmapBucket",_p,{omit:["layers"]});var dd={get paint(){return fd=fd||new cr({"heatmap-radius":new cn(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new cn(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Kt(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ea(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Kt(Ge.paint_heatmap["heatmap-opacity"])})}};function vf(i,{width:e,height:n},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*l)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${e*n*l}`)}else h=new Uint8Array(e*n*l);return i.width=e,i.height=n,i.data=h,i}function yp(i,{width:e,height:n},l){if(e===i.width&&n===i.height)return;const h=vf({},{width:e,height:n},l);xf(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},l),i.width=e,i.height=n,i.data=h.data}function xf(i,e,n,l,h,m){if(h.width===0||h.height===0)return e;if(h.width>i.width||h.height>i.height||n.x>i.width-h.width||n.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,w=e.data;if(y===w)throw new Error("srcData equals dstData, so image is already copied");for(let S=0;S<h.height;S++){const I=((n.y+S)*i.width+n.x)*m,D=((l.y+S)*e.width+l.x)*m;for(let O=0;O<h.width*m;O++)w[D+O]=y[I+O]}return e}class kh{constructor(e,n){vf(this,e,1,n)}resize(e){yp(this,e,1)}clone(){return new kh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,h,m){xf(e,n,l,h,m,1)}}class vr{constructor(e,n){vf(this,e,4,n)}resize(e){yp(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new vr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,h,m){xf(e,n,l,h,m,4)}setPixel(e,n,l){const h=4*(e*this.width+n);this.data[h+0]=Math.round(255*l.r/l.a),this.data[h+1]=Math.round(255*l.g/l.a),this.data[h+2]=Math.round(255*l.b/l.a),this.data[h+3]=Math.round(255*l.a)}}function pd(i){const e={},n=i.resolution||256,l=i.clips?i.clips.length:1,h=i.image||new vr({width:n,height:l});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(y,w,S)=>{e[i.evaluationKey]=S;const I=i.expression.evaluate(e);h.setPixel(y/4/n,w/4,I)};if(i.clips)for(let y=0,w=0;y<l;++y,w+=4*n)for(let S=0,I=0;S<n;S++,I+=4){const D=S/(n-1),{start:O,end:j}=i.clips[y];m(w,I,O*(1-D)+j*D)}else for(let y=0,w=0;y<n;y++,w+=4)m(0,w,y/(n-1));return h}Bt("AlphaImage",kh),Bt("RGBAImage",vr);const vp="big-fb";class Tm extends Oa{createBucket(e){return new _p(e)}constructor(e,n){super(e,dd,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=pd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(vp)&&this.heatmapFbos.delete(vp)}queryRadius(e){return Uc("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:h,transform:m,pixelsToTileUnits:y,unwrappedTileID:w,getElevation:S}){return dp({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,l)*y,transform:m,unwrappedTileID:w,getElevation:S},h)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Nl;var xp={get paint(){return Nl=Nl||new cr({"hillshade-illumination-direction":new Kt(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Kt(Ge.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Kt(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Kt(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Kt(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Kt(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Kt(Ge.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Kt(Ge.paint_hillshade["hillshade-method"])})}};class Sm extends Oa{constructor(e,n){super(e,xp,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,h=this.paint.get("hillshade-shadow-color").values;const m=Math.max(e.length,n.length,l.length,h.length);e=e.concat(Array(m-e.length).fill(e.at(-1))),n=n.concat(Array(m-n.length).fill(n.at(-1))),l=l.concat(Array(m-l.length).fill(l.at(-1))),h=h.concat(Array(m-h.length).fill(h.at(-1)));const y=n.map(ln);return{directionRadians:e.map(ln),altitudeRadians:y,shadowColor:h,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let bf;var wf={get paint(){return bf=bf||new cr({"color-relief-opacity":new Kt(Ge["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ea(Ge["paint_color-relief"]["color-relief-color"])})}};class Ui{constructor(e,n,l,h){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,h)}update(e,n,l){const{width:h,height:m}=e,y=!(this.size&&this.size[0]===h&&this.size[1]===m||l),{context:w}=this,{gl:S}=w;if(this.useMipmap=!!(n&&n.useMipmap),S.bindTexture(S.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===S.RGBA&&(!n||n.premultiply!==!1)),y)this.size=[h,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Vs(e)?S.texImage2D(S.TEXTURE_2D,0,this.format,this.format,S.UNSIGNED_BYTE,e):S.texImage2D(S.TEXTURE_2D,0,this.format,h,m,0,this.format,S.UNSIGNED_BYTE,e.data);else{const{x:I,y:D}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Vs(e)?S.texSubImage2D(S.TEXTURE_2D,0,I,D,S.RGBA,S.UNSIGNED_BYTE,e):S.texSubImage2D(S.TEXTURE_2D,0,I,D,h,m,S.RGBA,S.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&S.generateMipmap(S.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,l){const{context:h}=this,{gl:m}=h;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||e),this.filter=e),n!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Em{constructor(e,n,l,h=1,m=1,y=1,w=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void vi(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const S=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=m,this.blueFactor=y,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let I=0;I<S;I++)this.data[this._idx(-1,I)]=this.data[this._idx(0,I)],this.data[this._idx(S,I)]=this.data[this._idx(S-1,I)],this.data[this._idx(I,-1)]=this.data[this._idx(I,0)],this.data[this._idx(I,S)]=this.data[this._idx(I,S-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(S,-1)]=this.data[this._idx(S-1,0)],this.data[this._idx(-1,S)]=this.data[this._idx(0,S-1)],this.data[this._idx(S,S)]=this.data[this._idx(S-1,S-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let I=0;I<S;I++)for(let D=0;D<S;D++){const O=this.get(I,D);O>this.max&&(this.max=O),O<this.min&&(this.min=O)}}get(e,n){const l=new Uint8Array(this.data.buffer),h=4*this._idx(e,n);return this.unpack(l[h],l[h+1],l[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,l){return e*this.redFactor+n*this.greenFactor+l*this.blueFactor-this.baseShift}pack(e){return Mm(e,this.getUnpackVector())}getPixels(){return new vr({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,m=n*this.dim+this.dim,y=l*this.dim,w=l*this.dim+this.dim;switch(n){case-1:h=m-1;break;case 1:m=h+1}switch(l){case-1:y=w-1;break;case 1:w=y+1}const S=-n*this.dim,I=-l*this.dim;for(let D=y;D<w;D++)for(let O=h;O<m;O++)this.data[this._idx(O,D)]=e.data[this._idx(O+S,D+I)]}}function Mm(i,e){const n=e[0],l=e[1],h=e[2],m=e[3],y=Math.min(n,l,h),w=Math.round((i+m)/y);return{r:Math.floor(w*y/n)%256,g:Math.floor(w*y/l)%256,b:Math.floor(w*y/h)%256}}Bt("DEMData",Em);class Cm extends Oa{constructor(e,n){super(e,wf,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof Pa&&l._styleExpression.expression instanceof ca){this.colorRampExpression=l;const y=l._styleExpression.expression;n.elevationStops=y.labels,n.colorStops=[];for(const w of n.elevationStops)n.colorStops.push(y.evaluate({globals:{elevation:w}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[In.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const h={elevationStops:[],colorStops:[]},m=(n.elevationStops.length-1)/(e-1);for(let y=0;y<n.elevationStops.length-.5;y+=m)h.elevationStops.push(n.elevationStops[Math.round(y)]),h.colorStops.push(n.colorStops[Math.round(y)]);return vi(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),h}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const h=this._createColorRamp(n),m=new vr({width:h.colorStops.length,height:1}),y=new vr({width:h.colorStops.length,height:1});for(let w=0;w<h.elevationStops.length;w++){const S=Mm(h.elevationStops[w],l);y.setPixel(0,w,new In(S.r/255,S.g/255,S.b/255,1)),m.setPixel(0,w,h.colorStops[w])}return this.colorRampTextures={elevationTexture:new Ui(e,y,e.gl.RGBA),colorTexture:new Ui(e,m,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Tf=on([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ku}=Tf;function Sf(i,e,n){const l=n.patternDependencies;let h=!1;for(const m of e){const y=m.paint.get(`${i}-pattern`);y.isConstant()||(h=!0);const w=y.constantOr(null);w&&(h=!0,l[w.to]=!0,l[w.from]=!0)}return h}function md(i,e,n,l,h){const{zoom:m}=l,y=h.patternDependencies;for(const w of e){const S=w.paint.get(`${i}-pattern`).value;if(S.kind!=="constant"){let I=S.evaluate({zoom:m-1},n,{},h.availableImages),D=S.evaluate({zoom:m},n,{},h.availableImages),O=S.evaluate({zoom:m+1},n,{},h.availableImages);I=I&&I.name?I.name:I,D=D&&D.name?D.name:D,O=O&&O.name?O.name:O,y[I]=!0,y[D]=!0,y[O]=!0,n.patterns[w.id]={min:I,mid:D,max:O}}}return n}function Dh(i,e,n,l,h){let m;if(h===(function(y,w,S,I){let D=0;for(let O=w,j=S-I;O<S;O+=I)D+=(y[j]-y[O])*(y[O+1]+y[j+1]),j=O;return D})(i,e,n,l)>0)for(let y=e;y<n;y+=l)m=Cp(y/l|0,i[y],i[y+1],m);else for(let y=n-l;y>=e;y-=l)m=Cp(y/l|0,i[y],i[y+1],m);return m&&jc(m,m.next)&&(Ef(m),m=m.next),m}function Qa(i,e){if(!i)return i;e||(e=i);let n,l=i;do if(n=!1,l.steiner||!jc(l,l.next)&&fr(l.prev,l,l.next)!==0)l=l.next;else{if(Ef(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function Ph(i,e,n,l,h,m,y){if(!i)return;!y&&m&&(function(S,I,D,O){let j=S;do j.z===0&&(j.z=Ar(j.x,j.y,I,D,O)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==S);j.prevZ.nextZ=null,j.prevZ=null,(function(G){let H,W=1;do{let K,ie=G;G=null;let ye=null;for(H=0;ie;){H++;let ae=ie,le=0;for(let Me=0;Me<W&&(le++,ae=ae.nextZ,ae);Me++);let we=W;for(;le>0||we>0&&ae;)le!==0&&(we===0||!ae||ie.z<=ae.z)?(K=ie,ie=ie.nextZ,le--):(K=ae,ae=ae.nextZ,we--),ye?ye.nextZ=K:G=K,K.prevZ=ye,ye=K;ie=ae}ye.nextZ=null,W*=2}while(H>1)})(j)})(i,l,h,m);let w=i;for(;i.prev!==i.next;){const S=i.prev,I=i.next;if(m?Im(i,l,h,m):bp(i))e.push(S.i,i.i,I.i),Ef(i),i=I.next,w=I.next;else if((i=I)===w){y?y===1?Ph(i=wp(Qa(i),e),e,n,l,h,m,2):y===2&&Tp(i,e,n,l,h,m):Ph(Qa(i),e,n,l,h,m,1);break}}}function bp(i){const e=i.prev,n=i,l=i.next;if(fr(e,n,l)>=0)return!1;const h=e.x,m=n.x,y=l.x,w=e.y,S=n.y,I=l.y,D=Math.min(h,m,y),O=Math.min(w,S,I),j=Math.max(h,m,y),G=Math.max(w,S,I);let H=l.next;for(;H!==e;){if(H.x>=D&&H.x<=j&&H.y>=O&&H.y<=G&&kr(h,w,m,S,y,I,H.x,H.y)&&fr(H.prev,H,H.next)>=0)return!1;H=H.next}return!0}function Im(i,e,n,l){const h=i.prev,m=i,y=i.next;if(fr(h,m,y)>=0)return!1;const w=h.x,S=m.x,I=y.x,D=h.y,O=m.y,j=y.y,G=Math.min(w,S,I),H=Math.min(D,O,j),W=Math.max(w,S,I),K=Math.max(D,O,j),ie=Ar(G,H,e,n,l),ye=Ar(W,K,e,n,l);let ae=i.prevZ,le=i.nextZ;for(;ae&&ae.z>=ie&&le&&le.z<=ye;){if(ae.x>=G&&ae.x<=W&&ae.y>=H&&ae.y<=K&&ae!==h&&ae!==y&&kr(w,D,S,O,I,j,ae.x,ae.y)&&fr(ae.prev,ae,ae.next)>=0||(ae=ae.prevZ,le.x>=G&&le.x<=W&&le.y>=H&&le.y<=K&&le!==h&&le!==y&&kr(w,D,S,O,I,j,le.x,le.y)&&fr(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;ae&&ae.z>=ie;){if(ae.x>=G&&ae.x<=W&&ae.y>=H&&ae.y<=K&&ae!==h&&ae!==y&&kr(w,D,S,O,I,j,ae.x,ae.y)&&fr(ae.prev,ae,ae.next)>=0)return!1;ae=ae.prevZ}for(;le&&le.z<=ye;){if(le.x>=G&&le.x<=W&&le.y>=H&&le.y<=K&&le!==h&&le!==y&&kr(w,D,S,O,I,j,le.x,le.y)&&fr(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function wp(i,e){let n=i;do{const l=n.prev,h=n.next.next;!jc(l,h)&&rr(l,n,n.next,h)&&Rh(l,h)&&Rh(h,l)&&(e.push(l.i,n.i,h.i),Ef(n),Ef(n.next),n=i=h),n=n.next}while(n!==i);return Qa(n)}function Tp(i,e,n,l,h,m){let y=i;do{let w=y.next.next;for(;w!==y.prev;){if(y.i!==w.i&&Ng(y,w)){let S=Mp(y,w);return y=Qa(y,y.next),S=Qa(S,S.next),Ph(y,e,n,l,h,m,0),void Ph(S,e,n,l,h,m,0)}w=w.next}y=y.next}while(y!==i)}function gd(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function Am(i,e){const n=(function(h,m){let y=m;const w=h.x,S=h.y;let I,D=-1/0;if(jc(h,y))return y;do{if(jc(h,y.next))return y.next;if(S<=y.y&&S>=y.next.y&&y.next.y!==y.y){const W=y.x+(S-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(W<=w&&W>D&&(D=W,I=y.x<y.next.x?y:y.next,W===w))return I}y=y.next}while(y!==m);if(!I)return null;const O=I,j=I.x,G=I.y;let H=1/0;y=I;do{if(w>=y.x&&y.x>=j&&w!==y.x&&Ep(S<G?w:D,S,j,G,S<G?D:w,S,y.x,y.y)){const W=Math.abs(S-y.y)/(w-y.x);Rh(y,h)&&(W<H||W===H&&(y.x>I.x||y.x===I.x&&pu(I,y)))&&(I=y,H=W)}y=y.next}while(y!==O);return I})(i,e);if(!n)return e;const l=Mp(n,i);return Qa(l,l.next),Qa(n,n.next)}function pu(i,e){return fr(i.prev,i,e.prev)<0&&fr(e.next,i,i.next)<0}function Ar(i,e,n,l,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Sp(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Ep(i,e,n,l,h,m,y,w){return(h-y)*(e-w)>=(i-y)*(m-w)&&(i-y)*(l-w)>=(n-y)*(e-w)&&(n-y)*(m-w)>=(h-y)*(l-w)}function kr(i,e,n,l,h,m,y,w){return!(i===y&&e===w)&&Ep(i,e,n,l,h,m,y,w)}function Ng(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,l){let h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==l.i&&h.next.i!==l.i&&rr(h,h.next,n,l))return!0;h=h.next}while(h!==n);return!1})(i,e)&&(Rh(i,e)&&Rh(e,i)&&(function(n,l){let h=n,m=!1;const y=(n.x+l.x)/2,w=(n.y+l.y)/2;do h.y>w!=h.next.y>w&&h.next.y!==h.y&&y<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next;while(h!==n);return m})(i,e)&&(fr(i.prev,i,e.prev)||fr(i,e.prev,e))||jc(i,e)&&fr(i.prev,i,i.next)>0&&fr(e.prev,e,e.next)>0)}function fr(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function jc(i,e){return i.x===e.x&&i.y===e.y}function rr(i,e,n,l){const h=Ro(fr(i,e,n)),m=Ro(fr(i,e,l)),y=Ro(fr(n,l,i)),w=Ro(fr(n,l,e));return h!==m&&y!==w||!(h!==0||!Ba(i,n,e))||!(m!==0||!Ba(i,l,e))||!(y!==0||!Ba(n,i,l))||!(w!==0||!Ba(n,e,l))}function Ba(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Ro(i){return i>0?1:i<0?-1:0}function Rh(i,e){return fr(i.prev,i,i.next)<0?fr(i,e,i.next)>=0&&fr(i,i.prev,e)>=0:fr(i,e,i.prev)<0||fr(i,i.next,e)<0}function Mp(i,e){const n=Lh(i.i,i.x,i.y),l=Lh(e.i,e.x,e.y),h=i.next,m=e.prev;return i.next=e,e.prev=i,n.next=h,h.prev=n,l.next=n,n.prev=l,m.next=l,l.prev=m,l}function Cp(i,e,n,l){const h=Lh(i,e,n);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Ef(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function Lh(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class ma{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Ls{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Ls.noSubdivision=new Ls({fill:new ma(0,0),line:new ma(0,0),tile:new ma(0,0),stencil:new ma(0,0),circle:1}),Bt("SubdivisionGranularityExpression",ma),Bt("SubdivisionGranularitySetting",Ls);const Gc=-32768,Ta=32767;class km{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=Ht/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(e),h=0|Math.round(n),m=this._getKey(l,h);if(this._vertexDictionary.has(m))return this._vertexDictionary.get(m);const y=this._vertexBuffer.length/2;return this._vertexDictionary.set(m,y),this._vertexBuffer.push(l,h),y}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(h,m){const y=[];for(let w=0;w<m.length;w+=3){const S=m[w],I=m[w+1],D=m[w+2],O=h[2*S],j=h[2*S+1];(h[2*I]-O)*(h[2*D+1]-j)-(h[2*I+1]-j)*(h[2*D]-O)>0?(y.push(S),y.push(D),y.push(I)):(y.push(S),y.push(I),y.push(D))}return y})(this._vertexBuffer,e);const n=[],l=e.length;for(let h=0;h<l;h+=3){const m=[e[h+0],e[h+1],e[h+2]],y=[this._vertexBuffer[2*e[h+0]+0],this._vertexBuffer[2*e[h+0]+1],this._vertexBuffer[2*e[h+1]+0],this._vertexBuffer[2*e[h+1]+1],this._vertexBuffer[2*e[h+2]+0],this._vertexBuffer[2*e[h+2]+1]];let w=1/0,S=1/0,I=-1/0,D=-1/0;for(let W=0;W<3;W++){const K=y[2*W],ie=y[2*W+1];w=Math.min(w,K),I=Math.max(I,K),S=Math.min(S,ie),D=Math.max(D,ie)}if(w===I||S===D)continue;const O=Math.floor(w/this._granularityCellSize),j=Math.ceil(I/this._granularityCellSize),G=Math.floor(S/this._granularityCellSize),H=Math.ceil(D/this._granularityCellSize);if(O!==j||G!==H)for(let W=G;W<H;W++){const K=this._scanlineGenerateVertexRingForCellRow(W,y,m);mu(this._vertexBuffer,K,n)}else n.push(...m)}return n}_scanlineGenerateVertexRingForCellRow(e,n,l){const h=e*this._granularityCellSize,m=h+this._granularityCellSize,y=[];for(let w=0;w<3;w++){const S=n[2*w],I=n[2*w+1],D=n[2*(w+1)%6],O=n[(2*(w+1)+1)%6],j=n[2*(w+2)%6],G=n[(2*(w+2)+1)%6],H=D-S,W=O-I,K=H===0,ie=W===0,ye=(h-I)/W,ae=(m-I)/W,le=Math.min(ye,ae),we=Math.max(ye,ae);if(!ie&&(le>=1||we<=0)||ie&&(I<h||I>m)){O>=h&&O<=m&&y.push(l[(w+1)%3]);continue}!ie&&le>0&&y.push(this._vertexToIndex(S+H*le,I+W*le));const Me=S+H*Math.max(le,0),Ye=S+H*Math.min(we,1);K||this._generateIntraEdgeVertices(y,S,I,D,O,Me,Ye),!ie&&we<1&&y.push(this._vertexToIndex(S+H*we,I+W*we)),(ie||O>=h&&O<=m)&&y.push(l[(w+1)%3]),!ie&&(O<=h||O>=m)&&this._generateInterEdgeVertices(y,S,I,D,O,j,G,Ye,h,m)}return y}_generateIntraEdgeVertices(e,n,l,h,m,y,w){const S=h-n,I=m-l,D=I===0,O=D?Math.min(n,h):Math.min(y,w),j=D?Math.max(n,h):Math.max(y,w),G=Math.floor(O/this._granularityCellSize)+1,H=Math.ceil(j/this._granularityCellSize)-1;if(D?n<h:y<w)for(let W=G;W<=H;W++){const K=W*this._granularityCellSize;e.push(this._vertexToIndex(K,l+I*(K-n)/S))}else for(let W=H;W>=G;W--){const K=W*this._granularityCellSize;e.push(this._vertexToIndex(K,l+I*(K-n)/S))}}_generateInterEdgeVertices(e,n,l,h,m,y,w,S,I,D){const O=m-l,j=y-h,G=w-m,H=(I-m)/G,W=(D-m)/G,K=Math.min(H,W),ie=Math.max(H,W),ye=h+j*K;let ae=Math.floor(Math.min(ye,S)/this._granularityCellSize)+1,le=Math.ceil(Math.max(ye,S)/this._granularityCellSize)-1,we=S<ye;const Me=G===0;if(Me&&(w===I||w===D))return;if(Me||K>=1||ie<=0){const ct=l-w,it=y+(n-y)*Math.min((I-w)/ct,(D-w)/ct);ae=Math.floor(Math.min(it,S)/this._granularityCellSize)+1,le=Math.ceil(Math.max(it,S)/this._granularityCellSize)-1,we=S<it}const Ye=O>0?D:I;if(we)for(let ct=ae;ct<=le;ct++)e.push(this._vertexToIndex(ct*this._granularityCellSize,Ye));else for(let ct=le;ct>=ae;ct--)e.push(this._vertexToIndex(ct*this._granularityCellSize,Ye))}_generateOutline(e){const n=[];for(const l of e){const h=eo(l,this._granularity,!0),m=this._pointArrayToIndices(h),y=[];for(let w=1;w<m.length;w++)y.push(m[w-1]),y.push(m[w]);n.push(y)}return n}_handlePoles(e){let n=!1,l=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(n||l)&&this._fillPoles(e,n,l)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const l=e[n+1];l===Gc&&(e[n+1]=-32767),l===Ta&&(e[n+1]=32766)}}_generatePoleQuad(e,n,l,h,m,y){h>m!=(y===Gc)?(e.push(n),e.push(l),e.push(this._vertexToIndex(h,y)),e.push(l),e.push(this._vertexToIndex(m,y)),e.push(this._vertexToIndex(h,y))):(e.push(l),e.push(n),e.push(this._vertexToIndex(h,y)),e.push(this._vertexToIndex(m,y)),e.push(l),e.push(this._vertexToIndex(h,y)))}_fillPoles(e,n,l){const h=this._vertexBuffer,m=Ht,y=e.length;for(let w=2;w<y;w+=3){const S=e[w-2],I=e[w-1],D=e[w],O=h[2*S],j=h[2*S+1],G=h[2*I],H=h[2*I+1],W=h[2*D],K=h[2*D+1];n&&(j===0&&H===0&&this._generatePoleQuad(e,S,I,O,G,Gc),H===0&&K===0&&this._generatePoleQuad(e,I,D,G,W,Gc),K===0&&j===0&&this._generatePoleQuad(e,D,S,W,O,Gc)),l&&(j===m&&H===m&&this._generatePoleQuad(e,S,I,O,G,Ta),H===m&&K===m&&this._generatePoleQuad(e,I,D,G,W,Ta),K===m&&j===m&&this._generatePoleQuad(e,D,S,W,O,Ta))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:h}=(function(w){const S=[],I=[];for(const D of w)if(D.length!==0){D!==w[0]&&S.push(I.length/2);for(let O=0;O<D.length;O++)I.push(D[O].x),I.push(D[O].y)}return{flattened:I,holeIndices:S}})(e);let m;this._initializeVertices(l);try{const w=(function(I,D,O=2){const j=D&&D.length,G=j?D[0]*O:I.length;let H=Dh(I,0,G,O,!0);const W=[];if(!H||H.next===H.prev)return W;let K,ie,ye;if(j&&(H=(function(ae,le,we,Me){const Ye=[];for(let ct=0,it=le.length;ct<it;ct++){const gt=Dh(ae,le[ct]*Me,ct<it-1?le[ct+1]*Me:ae.length,Me,!1);gt===gt.next&&(gt.steiner=!0),Ye.push(Sp(gt))}Ye.sort(gd);for(let ct=0;ct<Ye.length;ct++)we=Am(Ye[ct],we);return we})(I,D,H,O)),I.length>80*O){K=I[0],ie=I[1];let ae=K,le=ie;for(let we=O;we<G;we+=O){const Me=I[we],Ye=I[we+1];Me<K&&(K=Me),Ye<ie&&(ie=Ye),Me>ae&&(ae=Me),Ye>le&&(le=Ye)}ye=Math.max(ae-K,le-ie),ye=ye!==0?32767/ye:0}return Ph(H,W,O,K,ie,ye,0),W})(l,h),S=this._convertIndices(l,w);m=this._subdivideTrianglesScanline(S)}catch(w){console.error(w)}let y=[];return n&&(y=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(m),{verticesFlattened:this._vertexBuffer,indicesTriangles:m,indicesLineList:y}}_convertIndices(e,n){const l=[];for(let h=0;h<n.length;h++)l.push(this._vertexToIndex(e[2*n[h]],e[2*n[h]+1]));return l}_pointArrayToIndices(e){const n=[];for(let l=0;l<e.length;l++){const h=e[l];n.push(this._vertexToIndex(h.x,h.y))}return n}}function Bl(i,e,n,l=!0){return new km(n,e).subdividePolygonInternal(i,l)}function eo(i,e,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const l=i[0],h=i[i.length-1],m=n&&(l.x!==h.x||l.y!==h.y);if(e<2)return m?[...i,i[0]]:[...i];const y=Math.floor(Ht/e),w=[];w.push(new ue(i[0].x,i[0].y));const S=i.length,I=m?S:S-1;for(let D=0;D<I;D++){const O=i[D],j=D<S-1?i[D+1]:i[0],G=O.x,H=O.y,W=j.x,K=j.y,ie=G!==W,ye=H!==K;if(!ie&&!ye)continue;const ae=W-G,le=K-H,we=Math.abs(ae),Me=Math.abs(le);let Ye=G,ct=H;for(;;){const gt=ae>0?(Math.floor(Ye/y)+1)*y:(Math.ceil(Ye/y)-1)*y,Ot=le>0?(Math.floor(ct/y)+1)*y:(Math.ceil(ct/y)-1)*y,yt=Math.abs(Ye-gt),ot=Math.abs(ct-Ot),Ke=Math.abs(Ye-W),Yt=Math.abs(ct-K),jt=ie?yt/we:Number.POSITIVE_INFINITY,Xt=ye?ot/Me:Number.POSITIVE_INFINITY;if((Ke<=yt||!ie)&&(Yt<=ot||!ye))break;if(jt<Xt&&ie||!ye){Ye=gt,ct+=le*jt;const Vt=new ue(Ye,Math.round(ct));w[w.length-1].x===Vt.x&&w[w.length-1].y===Vt.y||w.push(Vt)}else{Ye+=ae*Xt,ct=Ot;const Vt=new ue(Math.round(Ye),ct);w[w.length-1].x===Vt.x&&w[w.length-1].y===Vt.y||w.push(Vt)}}const it=new ue(W,K);w[w.length-1].x===it.x&&w[w.length-1].y===it.y||w.push(it)}return w}function mu(i,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,h=i[2*e[0]];for(let S=1;S<e.length;S++){const I=i[2*e[S]];I<h&&(h=I,l=S)}const m=e.length;let y=l,w=(y+1)%m;for(;;){const S=y-1>=0?y-1:m-1,I=(w+1)%m,D=i[2*e[S]],O=i[2*e[I]],j=i[2*e[y]],G=i[2*e[y]+1],H=i[2*e[w]+1];let W=!1;if(D<O)W=!0;else if(D>O)W=!1;else{const K=H-G,ie=-(i[2*e[w]]-j),ye=G<H?1:-1;((D-j)*K+(i[2*e[S]+1]-G)*ie)*ye>((O-j)*K+(i[2*e[I]+1]-G)*ie)*ye&&(W=!0)}if(W){const K=e[S],ie=e[y],ye=e[w];K!==ie&&K!==ye&&ie!==ye&&n.push(ye,ie,K),y--,y<0&&(y=m-1)}else{const K=e[I],ie=e[y],ye=e[w];K!==ie&&K!==ye&&ie!==ye&&n.push(ye,ie,K),w++,w>=m&&(w=0)}if(S===I)break}}function _d(i,e,n,l,h,m,y,w,S){const I=h.length/2,D=y&&w&&S;if(I<mt.MAX_VERTEX_ARRAY_LENGTH){const O=e.prepareSegment(I,n,l),j=O.vertexLength;for(let W=0;W<m.length;W+=3)l.emplaceBack(j+m[W],j+m[W+1],j+m[W+2]);let G,H;O.vertexLength+=I,O.primitiveLength+=m.length/3,D&&(H=y.prepareSegment(I,n,w),G=H.vertexLength,H.vertexLength+=I);for(let W=0;W<h.length;W+=2)i(h[W],h[W+1]);if(D)for(let W=0;W<S.length;W++){const K=S[W];for(let ie=1;ie<K.length;ie+=2)w.emplaceBack(G+K[ie-1],G+K[ie]);H.primitiveLength+=K.length/2}}else(function(O,j,G,H,W,K){const ie=[];for(let Me=0;Me<H.length/2;Me++)ie.push(-1);const ye={count:0};let ae=0,le=O.getOrCreateLatestSegment(j,G),we=le.vertexLength;for(let Me=2;Me<W.length;Me+=3){const Ye=W[Me-2],ct=W[Me-1],it=W[Me];let gt=ie[Ye]<ae,Ot=ie[ct]<ae,yt=ie[it]<ae;le.vertexLength+((gt?1:0)+(Ot?1:0)+(yt?1:0))>mt.MAX_VERTEX_ARRAY_LENGTH&&(le=O.createNewSegment(j,G),ae=ye.count,gt=!0,Ot=!0,yt=!0,we=0);const ot=qc(ie,H,K,ye,Ye,gt,le),Ke=qc(ie,H,K,ye,ct,Ot,le),Yt=qc(ie,H,K,ye,it,yt,le);G.emplaceBack(we+ot-ae,we+Ke-ae,we+Yt-ae),le.primitiveLength++}})(e,n,l,h,m,i),D&&(function(O,j,G,H,W,K){const ie=[];for(let Me=0;Me<H.length/2;Me++)ie.push(-1);const ye={count:0};let ae=0,le=O.getOrCreateLatestSegment(j,G),we=le.vertexLength;for(let Me=0;Me<W.length;Me++){const Ye=W[Me];for(let ct=1;ct<W[Me].length;ct+=2){const it=Ye[ct-1],gt=Ye[ct];let Ot=ie[it]<ae,yt=ie[gt]<ae;le.vertexLength+((Ot?1:0)+(yt?1:0))>mt.MAX_VERTEX_ARRAY_LENGTH&&(le=O.createNewSegment(j,G),ae=ye.count,Ot=!0,yt=!0,we=0);const ot=qc(ie,H,K,ye,it,Ot,le),Ke=qc(ie,H,K,ye,gt,yt,le);G.emplaceBack(we+ot-ae,we+Ke-ae),le.primitiveLength++}}})(y,n,w,h,S,i),e.forceNewSegmentOnNextPrepare(),y?.forceNewSegmentOnNextPrepare()}function qc(i,e,n,l,h,m,y){if(m){const w=l.count;return n(e[2*h],e[2*h+1]),i[h]=l.count,l.count++,y.vertexLength++,w}return i[h]}class to{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ne,this.indexArray=new $e,this.indexArray2=new Ze,this.programConfigurations=new Vi(e.layers,e.zoom),this.segments=new mt,this.segments2=new mt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=Sf("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),m=!h.isConstant(),y=[];for(const{feature:w,id:S,index:I,sourceLayerIndex:D}of e){const O=this.layers[0]._featureFilter.needGeometry,j=zl(w,O);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),j,l))continue;const G=m?h.evaluate(j,{},l,n.availableImages):void 0,H={id:S,properties:w.properties,type:w.type,sourceLayerIndex:D,index:I,geometry:O?j.geometry:_s(w),patterns:{},sortKey:G};y.push(H)}m&&y.sort(((w,S)=>w.sortKey-S.sortKey));for(const w of y){const{geometry:S,index:I,sourceLayerIndex:D}=w;if(this.hasDependencies){const O=md("fill",this.layers,w,{zoom:this.zoom},n);this.patternFeatures.push(O)}else this.addFeature(w,S,I,l,{},n.subdivisionGranularity);n.featureIndex.insert(e[I].feature,S,I,D,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}addFeatures(e,n,l){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,l,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ku),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,l,h,m,y){for(const w of xl(n,500)){const S=Bl(w,h,y.fill.getGranularityForZoomLevel(h.z)),I=this.layoutVertexArray;_d(((D,O)=>{I.emplaceBack(D,O)}),this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles,this.segments2,this.indexArray2,S.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:m,canonical:h})}}let Ip,Zc;Bt("FillBucket",to,{omit:["layers","patternFeatures"]});var Mf={get paint(){return Zc=Zc||new cr({"fill-antialias":new Kt(Ge.paint_fill["fill-antialias"]),"fill-opacity":new cn(Ge.paint_fill["fill-opacity"]),"fill-color":new cn(Ge.paint_fill["fill-color"]),"fill-outline-color":new cn(Ge.paint_fill["fill-outline-color"]),"fill-translate":new Kt(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Kt(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Rl(Ge.paint_fill["fill-pattern"])})},get layout(){return Ip=Ip||new cr({"fill-sort-key":new cn(Ge.layout_fill["fill-sort-key"])})}};class Cf extends Oa{constructor(e,n){super(e,Mf,n)}recalculate(e,n){super.recalculate(e,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new to(e)}queryRadius(){return Qu(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:l,pixelsToTileUnits:h}){return Ih(yf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,h),n)}isTileClipped(){return!0}}const zh=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Dm=on([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Pm}=zh;class gu{constructor(e,n,l,h,m){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=h,this._values=m,e.readFields(Rm,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,l=[];let h,m=1,y=0,w=0,S=0;for(;e.pos<n;){if(y<=0){const I=e.readVarint();m=7&I,y=I>>3}if(y--,m===1||m===2)w+=e.readSVarint(),S+=e.readSVarint(),m===1&&(h&&l.push(h),h=[]),h&&h.push(new ue(w,S));else{if(m!==7)throw new Error(`unknown command ${m}`);h&&h.push(h[0].clone())}}return h&&l.push(h),l}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let l=1,h=0,m=0,y=0,w=1/0,S=-1/0,I=1/0,D=-1/0;for(;e.pos<n;){if(h<=0){const O=e.readVarint();l=7&O,h=O>>3}if(h--,l===1||l===2)m+=e.readSVarint(),y+=e.readSVarint(),m<w&&(w=m),m>S&&(S=m),y<I&&(I=y),y>D&&(D=y);else if(l!==7)throw new Error(`unknown command ${l}`)}return[w,I,S,D]}toGeoJSON(e,n,l){const h=this.extent*Math.pow(2,l),m=this.extent*e,y=this.extent*n,w=this.loadGeometry();function S(j){return[360*(j.x+m)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(j.y+y)/h)*Math.PI))-90]}function I(j){return j.map(S)}let D;if(this.type===1){const j=[];for(const H of w)j.push(H[0]);const G=I(j);D=j.length===1?{type:"Point",coordinates:G[0]}:{type:"MultiPoint",coordinates:G}}else if(this.type===2){const j=w.map(I);D=j.length===1?{type:"LineString",coordinates:j[0]}:{type:"MultiLineString",coordinates:j}}else{if(this.type!==3)throw new Error("unknown feature type");{const j=If(w),G=[];for(const H of j)G.push(H.map(I));D=G.length===1?{type:"Polygon",coordinates:G[0]}:{type:"MultiPolygon",coordinates:G}}}const O={type:"Feature",geometry:D,properties:this.properties};return this.id!=null&&(O.id=this.id),O}}function Rm(i,e,n){i===1?e.id=n.readVarint():i===2?(function(l,h){const m=l.readVarint()+l.pos;for(;l.pos<m;){const y=h._keys[l.readVarint()],w=h._values[l.readVarint()];h.properties[y]=w}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function If(i){const e=i.length;if(e<=1)return[i];const n=[];let l,h;for(let m=0;m<e;m++){const y=Lm(i[m]);y!==0&&(h===void 0&&(h=y<0),h===y<0?(l&&n.push(l),l=[i[m]]):l&&l.push(i[m]))}return l&&n.push(l),n}function Lm(i){let e=0;for(let n,l,h=0,m=i.length,y=m-1;h<m;y=h++)n=i[h],l=i[y],e+=(l.x-n.x)*(n.y+l.y);return e}gu.types=["Unknown","Point","LineString","Polygon"];class Bg{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Fg,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new gu(this._pbf,n,this.extent,this._keys,this._values)}}function Fg(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(l){let h=null;const m=l.readVarint()+l.pos;for(;l.pos<m;){const y=l.readVarint()>>3;h=y===1?l.readString():y===2?l.readFloat():y===3?l.readDouble():y===4?l.readVarint64():y===5?l.readVarint():y===6?l.readSVarint():y===7?l.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h})(n))}class di{constructor(e,n){this.layers=e.readFields(ji,{},n)}}function ji(i,e,n){if(i===3){const l=new Bg(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}const Zn=Math.pow(2,13);function Gn(i,e,n,l,h,m,y,w){i.emplaceBack(e,n,2*Math.floor(l*Zn)+y,h*Zn*2,m*Zn*2,Math.round(w))}class Ei{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new he,this.centroidVertexArray=new q,this.indexArray=new $e,this.programConfigurations=new Vi(e.layers,e.zoom),this.segments=new mt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.features=[],this.hasDependencies=Sf("fill-extrusion",this.layers,n);for(const{feature:h,id:m,index:y,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,I=zl(h,S);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),I,l))continue;const D={id:m,sourceLayerIndex:w,index:y,geometry:S?I.geometry:_s(h),properties:h.properties,type:h.type,patterns:{}};this.hasDependencies?this.features.push(md("fill-extrusion",this.layers,D,{zoom:this.zoom},n)):this.addFeature(D,D.geometry,y,l,{},n.subdivisionGranularity),n.featureIndex.insert(h,D.geometry,y,w,this.index,!0)}}addFeatures(e,n,l){for(const h of this.features){const{geometry:m}=h;this.addFeature(h,m,h.index,n,l,e.subdivisionGranularity)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pm),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Dm.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,l,h,m,y){for(const w of xl(n,500)){const S={x:0,y:0,sampleCount:0},I=this.layoutVertexArray.length;this.processPolygon(S,h,e,w,y);const D=this.layoutVertexArray.length-I,O=Math.floor(S.x/S.sampleCount),j=Math.floor(S.y/S.sampleCount);for(let G=0;G<D;G++)this.centroidVertexArray.emplaceBack(O,j)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:m,canonical:h})}processPolygon(e,n,l,h,m){if(h.length<1||Yc(h[0]))return;for(const O of h)O.length!==0&&no(e,O);const y={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=m.fill.getGranularityForZoomLevel(n.z),S=gu.types[l.type]==="Polygon";for(const O of h){if(O.length===0||Yc(O))continue;const j=eo(O,w,S);this._generateSideFaces(j,y)}if(!S)return;const I=Bl(h,n,w,!1),D=this.layoutVertexArray;_d(((O,j)=>{Gn(D,O,j,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,I.verticesFlattened,I.indicesTriangles)}_generateSideFaces(e,n){let l=0;for(let h=1;h<e.length;h++){const m=e[h],y=e[h-1];if(Ju(m,y))continue;n.segment.vertexLength+4>mt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=m.sub(y)._perp()._unit(),S=y.dist(m);l+S>32768&&(l=0),Gn(this.layoutVertexArray,m.x,m.y,w.x,w.y,0,0,l),Gn(this.layoutVertexArray,m.x,m.y,w.x,w.y,0,1,l),l+=S,Gn(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,0,l),Gn(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,1,l);const I=n.segment.vertexLength;this.indexArray.emplaceBack(I,I+2,I+1),this.indexArray.emplaceBack(I+1,I+2,I+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function no(i,e){for(let n=0;n<e.length;n++){const l=e[n];n===e.length-1&&e[0].x===l.x&&e[0].y===l.y||(i.x+=l.x,i.y+=l.y,i.sampleCount++)}}function Ju(i,e){return i.x===e.x&&(i.x<0||i.x>Ht)||i.y===e.y&&(i.y<0||i.y>Ht)}function Yc(i){return i.every((e=>e.x<0))||i.every((e=>e.x>Ht))||i.every((e=>e.y<0))||i.every((e=>e.y>Ht))}let yd;Bt("FillExtrusionBucket",Ei,{omit:["layers","features"]});var _u={get paint(){return yd=yd||new cr({"fill-extrusion-opacity":new Kt(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new cn(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Kt(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Kt(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Rl(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new cn(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new cn(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Kt(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Dr extends Oa{constructor(e,n){super(e,_u,n)}createBucket(e){return new Ei(e)}queryRadius(){return Qu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:h,transform:m,pixelsToTileUnits:y,pixelPosMatrix:w}){const S=yf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-m.bearingInRadians,y),I=this.paint.get("fill-extrusion-height").evaluate(n,l),D=this.paint.get("fill-extrusion-base").evaluate(n,l),O=(function(G,H){const W=[];for(const K of G){const ie=[K.x,K.y,0,1];Rt(ie,ie,H),W.push(new ue(ie[0]/ie[3],ie[1]/ie[3]))}return W})(S,w),j=(function(G,H,W,K){const ie=[],ye=[],ae=K[8]*H,le=K[9]*H,we=K[10]*H,Me=K[11]*H,Ye=K[8]*W,ct=K[9]*W,it=K[10]*W,gt=K[11]*W;for(const Ot of G){const yt=[],ot=[];for(const Ke of Ot){const Yt=Ke.x,jt=Ke.y,Xt=K[0]*Yt+K[4]*jt+K[12],Vt=K[1]*Yt+K[5]*jt+K[13],an=K[2]*Yt+K[6]*jt+K[14],Kn=K[3]*Yt+K[7]*jt+K[15],Un=an+we,sr=Kn+Me,ts=Xt+Ye,aa=Vt+ct,or=an+it,Ji=Kn+gt,_i=new ue((Xt+ae)/sr,(Vt+le)/sr);_i.z=Un/sr,yt.push(_i);const xr=new ue(ts/Ji,aa/Ji);xr.z=or/Ji,ot.push(xr)}ie.push(yt),ye.push(ot)}return[ie,ye]})(h,D,I,w);return(function(G,H,W){let K=1/0;Ih(W,H)&&(K=ec(W,H[0]));for(let ie=0;ie<H.length;ie++){const ye=H[ie],ae=G[ie];for(let le=0;le<ye.length-1;le++){const we=ye[le],Me=[we,ye[le+1],ae[le+1],ae[le],we];Ch(W,Me)&&(K=Math.min(K,ec(W,Me)))}}return K!==1/0&&K})(j[0],j[1],O)}}function Lo(i,e){return i.x*e.x+i.y*e.y}function ec(i,e){if(i.length===1){let n=0;const l=e[n++];let h;for(;!h||l.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const m=e[n],y=i[0],w=h.sub(l),S=m.sub(l),I=y.sub(l),D=Lo(w,w),O=Lo(w,S),j=Lo(S,S),G=Lo(I,w),H=Lo(I,S),W=D*j-O*O,K=(j*G-O*H)/W,ie=(D*H-O*G)/W,ye=l.z*(1-K-ie)+h.z*K+m.z*ie;if(isFinite(ye))return ye}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}const Ap=on([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:io}=Ap,Oh=on([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Af}=Oh,zs=Math.cos(Math.PI/180*37.5),vd=Math.pow(2,14)/.5;class Nh{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new pe,this.layoutVertexArray2=new de,this.indexArray=new $e,this.programConfigurations=new Vi(e.layers,e.zoom),this.segments=new mt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=Sf("line",this.layers,n)||this.hasLineDasharray(this.layers);const h=this.layers[0].layout.get("line-sort-key"),m=!h.isConstant(),y=[];for(const{feature:w,id:S,index:I,sourceLayerIndex:D}of e){const O=this.layers[0]._featureFilter.needGeometry,j=zl(w,O);if(!this.layers[0]._featureFilter.filter(new qn(this.zoom),j,l))continue;const G=m?h.evaluate(j,{},l):void 0,H={id:S,properties:w.properties,type:w.type,sourceLayerIndex:D,index:I,geometry:O?j.geometry:_s(w),patterns:{},dashes:{},sortKey:G};y.push(H)}m&&y.sort(((w,S)=>w.sortKey-S.sortKey));for(const w of y){const{geometry:S,index:I,sourceLayerIndex:D}=w;this.hasDependencies?(Sf("line",this.layers,n)?md("line",this.layers,w,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,w,this.zoom,n),this.patternFeatures.push(w)):this.addFeature(w,S,I,l,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[I].feature,S,I,D,this.index)}}update(e,n,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l,dashPositions:h})}addFeatures(e,n,l,h){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,l,h,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Af)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,io),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,h,m,y,w){const S=this.layers[0].layout,I=S.get("line-join").evaluate(e,{}),D=S.get("line-cap"),O=S.get("line-miter-limit"),j=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const G of n)this.addLine(G,e,I,D,O,j,h,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:m,dashPositions:y,canonical:h})}addLine(e,n,l,h,m,y,w,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=eo(e,w?S.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ae=0;ae<e.length-1;ae++)this.totalDistance+=e[ae].dist(e[ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const I=gu.types[n.type]==="Polygon";let D=e.length;for(;D>=2&&e[D-1].equals(e[D-2]);)D--;let O=0;for(;O<D-1&&e[O].equals(e[O+1]);)O++;if(D<(I?3:2))return;l==="bevel"&&(m=1.05);const j=this.overscaling<=16?122880/(512*this.overscaling):0,G=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray);let H,W,K,ie,ye;this.e1=this.e2=-1,I&&(H=e[D-2],ye=e[O].sub(H)._unit()._perp());for(let ae=O;ae<D;ae++){if(K=ae===D-1?I?e[O+1]:void 0:e[ae+1],K&&e[ae].equals(K))continue;ye&&(ie=ye),H&&(W=H),H=e[ae],ye=K?K.sub(H)._unit()._perp():ie,ie=ie||ye;let le=ie.add(ye);le.x===0&&le.y===0||le._unit();const we=ie.x*ye.x+ie.y*ye.y,Me=le.x*ye.x+le.y*ye.y,Ye=Me!==0?1/Me:1/0,ct=2*Math.sqrt(2-2*Me),it=Me<zs&&W&&K,gt=ie.x*ye.y-ie.y*ye.x>0;if(it&&ae>O){const ot=H.dist(W);if(ot>2*j){const Ke=H.sub(H.sub(W)._mult(j/ot)._round());this.updateDistance(W,Ke),this.addCurrentVertex(Ke,ie,0,0,G),W=Ke}}const Ot=W&&K;let yt=Ot?l:I?"butt":h;if(Ot&&yt==="round"&&(Ye<y?yt="miter":Ye<=2&&(yt="fakeround")),yt==="miter"&&Ye>m&&(yt="bevel"),yt==="bevel"&&(Ye>2&&(yt="flipbevel"),Ye<m&&(yt="miter")),W&&this.updateDistance(W,H),yt==="miter")le._mult(Ye),this.addCurrentVertex(H,le,0,0,G);else if(yt==="flipbevel"){if(Ye>100)le=ye.mult(-1);else{const ot=Ye*ie.add(ye).mag()/ie.sub(ye).mag();le._perp()._mult(ot*(gt?-1:1))}this.addCurrentVertex(H,le,0,0,G),this.addCurrentVertex(H,le.mult(-1),0,0,G)}else if(yt==="bevel"||yt==="fakeround"){const ot=-Math.sqrt(Ye*Ye-1),Ke=gt?ot:0,Yt=gt?0:ot;if(W&&this.addCurrentVertex(H,ie,Ke,Yt,G),yt==="fakeround"){const jt=Math.round(180*ct/Math.PI/20);for(let Xt=1;Xt<jt;Xt++){let Vt=Xt/jt;if(Vt!==.5){const Kn=Vt-.5;Vt+=Vt*Kn*(Vt-1)*((1.0904+we*(we*(3.55645-1.43519*we)-3.2452))*Kn*Kn+(.848013+we*(.215638*we-1.06021)))}const an=ye.sub(ie)._mult(Vt)._add(ie)._unit()._mult(gt?-1:1);this.addHalfVertex(H,an.x,an.y,!1,gt,0,G)}}K&&this.addCurrentVertex(H,ye,-Ke,-Yt,G)}else if(yt==="butt")this.addCurrentVertex(H,le,0,0,G);else if(yt==="square"){const ot=W?1:-1;this.addCurrentVertex(H,le,ot,ot,G)}else yt==="round"&&(W&&(this.addCurrentVertex(H,ie,0,0,G),this.addCurrentVertex(H,ie,1,1,G,!0)),K&&(this.addCurrentVertex(H,ye,-1,-1,G,!0),this.addCurrentVertex(H,ye,0,0,G)));if(it&&ae<D-1){const ot=H.dist(K);if(ot>2*j){const Ke=H.add(K.sub(H)._mult(j/ot)._round());this.updateDistance(H,Ke),this.addCurrentVertex(Ke,ye,0,0,G),H=Ke}}}}addCurrentVertex(e,n,l,h,m,y=!1){const w=n.y*h-n.x,S=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*l,n.y-n.x*l,y,!1,l,m),this.addHalfVertex(e,w,S,y,!0,-h,m),this.distance>vd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,l,h,m,y))}addHalfVertex({x:e,y:n},l,h,m,y,w,S){const I=.5*(this.lineClips?this.scaledDistance*(vd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(y?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(w===0?0:w<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,D,this.e2),S.primitiveLength++),y?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const l=n.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(e,n,l,h){for(const m of e){const y=m.paint.get("line-dasharray");if(!y||y.value.kind==="constant")continue;const w=m.layout.get("line-cap")==="round",S={dasharray:y.value.evaluate({zoom:l-1},n,{}),round:w},I={dasharray:y.value.evaluate({zoom:l},n,{}),round:w},D={dasharray:y.value.evaluate({zoom:l+1},n,{}),round:w},O=`${S.dasharray.join(",")},${S.round}`,j=`${I.dasharray.join(",")},${I.round}`,G=`${D.dasharray.join(",")},${D.round}`;h.dashDependencies[O]=S,h.dashDependencies[j]=I,h.dashDependencies[G]=D,n.dashes[m.id]={min:O,mid:j,max:G}}}}let kp,kf;Bt("LineBucket",Nh,{omit:["layers","patternFeatures"]});var Df={get paint(){return kf=kf||new cr({"line-opacity":new cn(Ge.paint_line["line-opacity"]),"line-color":new cn(Ge.paint_line["line-color"]),"line-translate":new Kt(Ge.paint_line["line-translate"]),"line-translate-anchor":new Kt(Ge.paint_line["line-translate-anchor"]),"line-width":new cn(Ge.paint_line["line-width"]),"line-gap-width":new cn(Ge.paint_line["line-gap-width"]),"line-offset":new cn(Ge.paint_line["line-offset"]),"line-blur":new cn(Ge.paint_line["line-blur"]),"line-dasharray":new Rl(Ge.paint_line["line-dasharray"]),"line-pattern":new Rl(Ge.paint_line["line-pattern"]),"line-gradient":new ea(Ge.paint_line["line-gradient"])})},get layout(){return kp=kp||new cr({"line-cap":new Kt(Ge.layout_line["line-cap"]),"line-join":new cn(Ge.layout_line["line-join"]),"line-miter-limit":new Kt(Ge.layout_line["line-miter-limit"]),"line-round-limit":new Kt(Ge.layout_line["line-round-limit"]),"line-sort-key":new cn(Ge.layout_line["line-sort-key"])})}};class tc extends cn{possiblyEvaluate(e,n){return n=new qn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,h){return n=Ue({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,h)}}let Pr;class nc extends Oa{constructor(e,n){super(e,Df,n),this.gradientVersion=0,Pr||(Pr=new tc(Df.paint.properties["line-width"].specification),Pr.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof Br,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Pr.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Nh(e)}queryRadius(e){const n=e,l=Hc(Uc("line-width",this,n),Uc("line-gap-width",this,n)),h=Uc("line-offset",this,n);return l/2+Math.abs(h)+Qu(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:h,transform:m,pixelsToTileUnits:y}){const w=yf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-m.bearingInRadians,y),S=y/2*Hc(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),I=this.paint.get("line-offset").evaluate(n,l);return I&&(h=(function(D,O){const j=[];for(let G=0;G<D.length;G++){const H=ld(D[G]),W=[];for(let K=0;K<H.length;K++){const ie=H[K],ye=H[K-1],ae=H[K+1],le=K===0?new ue(0,0):ie.sub(ye)._unit()._perp(),we=K===H.length-1?new ue(0,0):ae.sub(ie)._unit()._perp(),Me=le._add(we)._unit(),Ye=Me.x*we.x+Me.y*we.y;Ye!==0&&Me._mult(1/Ye),W.push(Me._mult(O)._add(ie))}j.push(W)}return j})(h,I*y)),(function(D,O,j){for(let G=0;G<O.length;G++){const H=O[G];if(D.length>=3){for(let W=0;W<H.length;W++)if(Vc(D,H[W]))return!0}if(Ah(D,H,j))return!0}return!1})(w,h,S)}isTileClipped(){return!0}}function Hc(i,e){return e>0?e+2*i:i}const yu=on([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Dp=on([{name:"a_projected_pos",components:3,type:"Float32"}],4);on([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Pp=on([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);on([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Rp=on([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Pf=on([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Lp(i,e,n){return i.sections.forEach((l=>{l.text=(function(h,m,y){const w=m.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?h=h.toLocaleUpperCase():w==="lowercase"&&(h=h.toLocaleLowerCase()),Ws.applyArabicShaping&&(h=Ws.applyArabicShaping(h)),h})(l.text,e,n)})),i}on([{name:"triangle",components:3,type:"Uint16"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),on([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),on([{type:"Float32",name:"offsetX"}]),on([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),on([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var pi=24;const Bh={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},Os={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},zm={40:!0};function zp(i,e,n,l,h,m){if("fontStack"in e){const y=n[e.fontStack],w=y&&y[i];return w?w.metrics.advance*e.scale+h:0}{const y=l[e.imageName];return y?y.displaySize[0]*e.scale*pi/m+h:0}}function Om(i,e,n,l){const h=Math.pow(i-e,2);return l?i<e?h/2:2*h:h+Math.abs(n)*n}function ic(i,e,n){let l=0;return i===10&&(l-=1e4),n&&(l+=150),i!==40&&i!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function Rf(i,e,n,l,h,m){let y=null,w=Om(e,n,h,m);for(const S of l){const I=Om(e-S.x,n,h,m)+S.badness;I<=w&&(y=S,w=I)}return{index:i,x:e,priorBreak:y,badness:w}}function xd(i){return i?xd(i.priorBreak).concat(i.index):[]}class ll{constructor(e="",n=[],l=[]){this.text=e,this.sections=n,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(e,n){const l=new ll;for(let h=0;h<e.sections.length;h++){const m=e.sections[h];m.image?l.addImageSection(m):l.addTextSection(m,n)}return l}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",l={premature:!0,value:void 0};const h=e[Symbol.iterator]();let m=h.next();const y=e[Symbol.iterator]();y.next();let w=y.next();for(;!m.done;)n+=!w.done&&zc(w.value.codePointAt(0))&&!Bh[w.value]||!l.premature&&zc(l.value.codePointAt(0))&&!Bh[l.value]||!Bh[m.value]?m.value:Bh[m.value],l={value:m.value,premature:!1},m=h.next(),w=y.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,l=this.text.match(/\S\s*$/),h=l?l[0].length-1:0;this.text=this.text.substring(n,this.text.length-h),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-h)}substring(e,n){const l=[...this.text].slice(e,n).join(""),h=this.sectionIndex.slice(e,n);return new ll(l,this.sections,h)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,l=0;for(let h=0;h<this.length();h++){const m=this.getSection(h);if("imageName"in m){const y=e[m.imageName];if(!y)continue;const w=y.displaySize;n=Math.max(n,w[0]),l=Math.max(l,w[1])}}return{maxImageWidth:n,maxImageHeight:l}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const l=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>l)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void vi("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):vi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,l,h,m){const y=[],w=this.determineAverageLineWidth(e,n,l,h,m),S=this.hasZeroWidthSpaces();let I=0,D=0;const O=this.text[Symbol.iterator]();let j=O.next();const G=this.text[Symbol.iterator]();G.next();let H=G.next();const W=this.text[Symbol.iterator]();W.next(),W.next();let K=W.next();for(;!j.done;){const ie=this.getSection(D),ye=j.value.codePointAt(0);if(hf(ye)||(I+=zp(ye,ie,l,h,e,m)),!H.done){const ae=au(ye),le=H.value.codePointAt(0);(Os[ye]||ae||"imageName"in ie||!K.done&&zm[le])&&y.push(Rf(D+1,I,w,y,ic(ye,le,ae&&S),!1))}D++,j=O.next(),H=G.next(),K=W.next()}return xd(Rf(this.length(),I,w,y,0,!0))}determineAverageLineWidth(e,n,l,h,m){let y=0,w=0;for(const S of this.text){const I=this.getSection(w);y+=zp(S.codePointAt(0),I,l,h,e,m),w++}return y/Math.max(1,Math.ceil(y/n))}}const bd=4294967296,Op=1/bd,Np=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Lf{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,l=this.length){for(;this.pos<l;){const h=this.readVarint(),m=h>>3,y=this.pos;this.type=7&h,e(m,n,this),this.pos===y&&this.skip(h)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*bd;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*bd;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let l,h;return h=n[this.pos++],l=127&h,h<128?l:(h=n[this.pos++],l|=(127&h)<<7,h<128?l:(h=n[this.pos++],l|=(127&h)<<14,h<128?l:(h=n[this.pos++],l|=(127&h)<<21,h<128?l:(h=n[this.pos],l|=(15&h)<<28,(function(m,y,w){const S=w.buf;let I,D;if(D=S[w.pos++],I=(112&D)>>4,D<128||(D=S[w.pos++],I|=(127&D)<<3,D<128)||(D=S[w.pos++],I|=(127&D)<<10,D<128)||(D=S[w.pos++],I|=(127&D)<<17,D<128)||(D=S[w.pos++],I|=(127&D)<<24,D<128)||(D=S[w.pos++],I|=(1&D)<<31,D<128))return vu(m,I,y);throw new Error("Expected varint not more than 10 bytes")})(l,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&Np?Np.decode(this.buf.subarray(n,e)):(function(l,h,m){let y="",w=h;for(;w<m;){const S=l[w];let I,D,O,j=null,G=S>239?4:S>223?3:S>191?2:1;if(w+G>m)break;G===1?S<128&&(j=S):G===2?(I=l[w+1],(192&I)==128&&(j=(31&S)<<6|63&I,j<=127&&(j=null))):G===3?(I=l[w+1],D=l[w+2],(192&I)==128&&(192&D)==128&&(j=(15&S)<<12|(63&I)<<6|63&D,(j<=2047||j>=55296&&j<=57343)&&(j=null))):G===4&&(I=l[w+1],D=l[w+2],O=l[w+3],(192&I)==128&&(192&D)==128&&(192&O)==128&&(j=(15&S)<<18|(63&I)<<12|(63&D)<<6|63&O,(j<=65535||j>=1114112)&&(j=null))),j===null?(j=65533,G=1):j>65535&&(j-=65536,y+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),y+=String.fromCharCode(j),w+=G}return y})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const l=new Uint8Array(n);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Op),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Op),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,l){let h,m;if(n>=0?(h=n%4294967296|0,m=n/4294967296|0):(h=~(-n%4294967296),m=~(-n/4294967296),4294967295^h?h=h+1|0:(h=0,m=m+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(y,w,S){S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,y>>>=7,S.buf[S.pos++]=127&y|128,S.buf[S.pos]=127&(y>>>=7)})(h,0,l),(function(y,w){const S=(7&y)<<4;w.buf[w.pos++]|=S|((y>>>=3)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y)))))})(m,l)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(h,m,y){for(let w,S,I=0;I<m.length;I++){if(w=m.charCodeAt(I),w>55295&&w<57344){if(!S){w>56319||I+1===m.length?(h[y++]=239,h[y++]=191,h[y++]=189):S=w;continue}if(w<56320){h[y++]=239,h[y++]=191,h[y++]=189,S=w;continue}w=S-55296<<10|w-56320|65536,S=null}else S&&(h[y++]=239,h[y++]=191,h[y++]=189,S=null);w<128?h[y++]=w:(w<2048?h[y++]=w>>6|192:(w<65536?h[y++]=w>>12|224:(h[y++]=w>>18|240,h[y++]=w>>12&63|128),h[y++]=w>>6&63|128),h[y++]=63&w|128)}return y})(this.buf,e,this.pos);const l=this.pos-n;l>=128&&wd(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let l=0;l<n;l++)this.buf[this.pos++]=e[l]}writeRawMessage(e,n){this.pos++;const l=this.pos;e(n,this);const h=this.pos-l;h>=128&&wd(l,h,this),this.pos=l-1,this.writeVarint(h),this.pos+=h}writeMessage(e,n,l){this.writeTag(e,2),this.writeRawMessage(n,l)}writePackedVarint(e,n){n.length&&this.writeMessage(e,Vg,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,Ug,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,Bm,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,jg,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,Nm,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,Fh,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,Td,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,Fm,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,Vm,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function vu(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function wd(i,e,n){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(let h=n.pos-1;h>=i;h--)n.buf[h+l]=n.buf[h]}function Vg(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function Ug(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function jg(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function Nm(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function Bm(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function Fh(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function Td(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function Fm(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function Vm(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}function Um(i,e,n){i===1&&n.readMessage(jm,e)}function jm(i,e,n){if(i===3){const{id:l,bitmap:h,width:m,height:y,left:w,top:S,advance:I}=n.readMessage(Gm,{});e.push({id:l,bitmap:new kh({width:m+6,height:y+6},h),metrics:{width:m,height:y,left:w,top:S,advance:I}})}}function Gm(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function Bp(i){let e=0,n=0;for(const y of i)e+=y.w*y.h,n=Math.max(n,y.w);i.sort(((y,w)=>w.h-y.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,m=0;for(const y of i)for(let w=l.length-1;w>=0;w--){const S=l[w];if(!(y.w>S.w||y.h>S.h)){if(y.x=S.x,y.y=S.y,m=Math.max(m,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===S.w&&y.h===S.h){const I=l.pop();I&&w<l.length&&(l[w]=I)}else y.h===S.h?(S.x+=y.w,S.w-=y.w):y.w===S.w?(S.y+=y.h,S.h-=y.h):(l.push({x:S.x+y.w,y:S.y,w:S.w-y.w,h:y.h}),S.y+=y.h,S.h-=y.h);break}}return{w:h,h:m,fill:e/(h*m)||0}}class Vh{constructor(e,{pixelRatio:n,version:l,stretchX:h,stretchY:m,content:y,textFitWidth:w,textFitHeight:S}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=m,this.content=y,this.version=l,this.textFitWidth=w,this.textFitHeight=S}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Fp{constructor(e,n){const l={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,l,m),this.addImages(n,h,m);const{w:y,h:w}=Bp(m),S=new vr({width:y||1,height:w||1});for(const I in e){const D=e[I],O=l[I].paddedRect;vr.copy(D.data,S,{x:0,y:0},{x:O.x+1,y:O.y+1},D.data)}for(const I in n){const D=n[I],O=h[I].paddedRect,j=O.x+1,G=O.y+1,H=D.data.width,W=D.data.height;vr.copy(D.data,S,{x:0,y:0},{x:j,y:G},D.data),vr.copy(D.data,S,{x:0,y:W-1},{x:j,y:G-1},{width:H,height:1}),vr.copy(D.data,S,{x:0,y:0},{x:j,y:G+W},{width:H,height:1}),vr.copy(D.data,S,{x:H-1,y:0},{x:j-1,y:G},{width:1,height:W}),vr.copy(D.data,S,{x:0,y:0},{x:j+H,y:G},{width:1,height:W})}this.image=S,this.iconPositions=l,this.patternPositions=h}addImages(e,n,l){for(const h in e){const m=e[h],y={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(y),n[h]=new Vh(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),n)}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,m]=e.tl;l.update(n.data,void 0,{x:h,y:m})}}var xu;function mi(i,e,n,l,h,m,y,w,S,I,D,O,j,G,H){const W=ll.fromFeature(i,h);let K;O===L.aA.vertical&&W.verticalizePunctuation();let ie=W.determineLineBreaks(I,m,e,l,G);const{processBidirectionalText:ye,processStyledBidirectionalText:ae}=Ws;if(ye&&W.sections.length===1){K=[],ie=ie.map((Ye=>W.toCodeUnitIndex(Ye)));const Me=ye(W.toString(),ie);for(const Ye of Me){const ct=[...Ye].map((()=>0));K.push(new ll(Ye,W.sections,ct))}}else if(ae){K=[],ie=ie.map((it=>W.toCodeUnitIndex(it)));let Me=0;const Ye=[];for(const it of W.text)Ye.push(...Array(it.length).fill(W.sectionIndex[Me])),Me++;const ct=ae(W.text,Ye,ie);for(const it of ct){const gt=[];let Ot="";for(const yt of it[0])gt.push(it[1][Ot.length]),Ot+=yt;K.push(new ll(it[0],W.sections,gt))}}else K=(function(Me,Ye){const ct=[];let it=0;for(const gt of Ye)ct.push(Me.substring(it,gt)),it=gt;return it<Me.length()&&ct.push(Me.substring(it,Me.length())),ct})(W,ie);const le=[],we={positionedLines:le,text:W.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:O,iconsInText:!1,verticalizable:!1};return(function(Me,Ye,ct,it,gt,Ot,yt,ot,Ke,Yt,jt,Xt){let Vt=0,an=0,Kn=0,Un=0;const sr=ot==="right"?1:ot==="left"?0:.5,ts=pi/Xt;let aa=0;for(const _i of gt){_i.trim();const xr=_i.getMaxScale(),Lr={positionedGlyphs:[],lineOffset:0};Me.positionedLines[aa]=Lr;const Gi=Lr.positionedGlyphs;let ao=0;if(!_i.length()){an+=Ot,++aa;continue}const ns=Gg(it,_i,ts);let so=0;for(const Sa of _i.text){const dr=_i.getSection(so),sa=Sa.codePointAt(0),br=qg(Ke,jt,sa),Ea={glyph:sa,imageName:null,x:Vt,y:an+-17,vertical:br,scale:1,fontStack:"",sectionIndex:_i.getSectionIndex(so),metrics:null,rect:null};let Jc;if("fontStack"in dr){if(Jc=Zg(dr,sa,br,ns,Ye,ct),!Jc)continue;Ea.fontStack=dr.fontStack}else{if(Me.iconsInText=!0,dr.scale*=ts,Jc=Yg(dr,br,xr,ns,it),!Jc)continue;ao=Math.max(ao,Jc.imageOffset),Ea.imageName=dr.imageName}const{rect:Cu,metrics:fm,baselineOffset:tf}=Jc;Ea.y+=tf,Ea.scale=dr.scale,Ea.metrics=fm,Ea.rect=Cu,Gi.push(Ea),br?(Me.verticalizable=!0,Vt+=("imageName"in dr?fm.advance:pi)*dr.scale+Yt):Vt+=fm.advance*dr.scale+Yt,so++}Gi.length!==0&&(Kn=Math.max(Vt-Yt,Kn),Sd(Gi,0,Gi.length-1,sr)),Vt=0,Lr.lineOffset=Math.max(ao,(xr-1)*pi);const Vl=Ot*xr+ao;an+=Vl,Un=Math.max(Vl,Un),++aa}const{horizontalAlign:or,verticalAlign:Ji}=zf(yt);(function(_i,xr,Lr,Gi,ao,ns,so,Vl,Sa){const dr=(xr-Lr)*ao;let sa=0;sa=ns!==so?-Vl*Gi- -17:-Gi*Sa*so+.5*so;for(const br of _i)for(const Ea of br.positionedGlyphs)Ea.x+=dr,Ea.y+=sa})(Me.positionedLines,sr,or,Ji,Kn,Un,Ot,an,gt.length),Me.top+=-Ji*an,Me.bottom=Me.top+an,Me.left+=-or*Kn,Me.right=Me.left+Kn})(we,e,n,l,K,y,w,S,O,I,j,H),!(function(Me){for(const Ye of Me)if(Ye.positionedGlyphs.length!==0)return!1;return!0})(le)&&we}function zf(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Gg(i,e,n){const l=e.getMaxScale()*pi,{maxImageWidth:h,maxImageHeight:m}=e.getMaxImageSize(i),y=Math.max(l,m*n);return{verticalLineContentWidth:Math.max(l,h*n),horizontalLineContentHeight:y}}function Vp(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function qg(i,e,n){return!(i===L.aA.horizontal||!e&&!vh(n)||e&&(hf(n)||(l=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function Zg(i,e,n,l,h,m){const y=m[i.fontStack],w=(function(I,D,O,j){if(I&&I.rect)return I;const G=D[O.fontStack],H=G&&G[j];return H?{rect:null,metrics:H.metrics}:null})(y&&y[e],h,i,e);if(w===null)return null;let S;if(n)S=l.verticalLineContentWidth-i.scale*pi;else{const I=Vp(i.verticalAlign);S=(l.horizontalLineContentHeight-i.scale*pi)*I}return{rect:w.rect,metrics:w.metrics,baselineOffset:S}}function Yg(i,e,n,l,h){const m=h[i.imageName];if(!m)return null;const y=m.paddedRect,w=m.displaySize,S={width:w[0],height:w[1],left:1,top:-3,advance:e?w[1]:w[0]};let I;if(e)I=l.verticalLineContentWidth-w[1]*i.scale;else{const D=Vp(i.verticalAlign);I=(l.horizontalLineContentHeight-w[1]*i.scale)*D}return{rect:y,metrics:S,baselineOffset:I,imageOffset:(e?w[0]:w[1])*i.scale-pi*n}}function Sd(i,e,n,l){if(l===0)return;const h=i[n],m=(i[n].x+h.metrics.advance*h.scale)*l;for(let y=e;y<=n;y++)i[y].x-=m}function Uh(i,e,n){const{horizontalAlign:l,verticalAlign:h}=zf(n),m=e[0]-i.displaySize[0]*l,y=e[1]-i.displaySize[1]*h;return{image:i,top:y,bottom:y+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function Ed(i){var e,n;let l=i.left,h=i.top,m=i.right-l,y=i.bottom-h;const w=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",S=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",I=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(S==="proportional"){if(w==="stretchOnly"&&m/y<I||w==="proportional"){const D=Math.ceil(y*I);l*=D/m,m=D}}else if(w==="proportional"&&S==="stretchOnly"&&I!==0&&m/y>I){const D=Math.ceil(m/I);h*=D/y,y=D}return{x1:l,y1:h,x2:l+m,y2:h+y}}function Of(i,e,n,l,h,m){const y=i.image;let w;if(y.content){const K=y.content,ie=y.pixelRatio||1;w=[K[0]/ie,K[1]/ie,y.displaySize[0]-K[2]/ie,y.displaySize[1]-K[3]/ie]}const S=e.left*m,I=e.right*m;let D,O,j,G;n==="width"||n==="both"?(G=h[0]+S-l[3],O=h[0]+I+l[1]):(G=h[0]+(S+I-y.displaySize[0])/2,O=G+y.displaySize[0]);const H=e.top*m,W=e.bottom*m;return n==="height"||n==="both"?(D=h[1]+H-l[0],j=h[1]+W+l[2]):(D=h[1]+(H+W-y.displaySize[1])/2,j=D+y.displaySize[1]),{image:y,top:D,right:O,bottom:j,left:G,collisionPadding:w}}Bt("ImagePosition",Vh),Bt("ImageAtlas",Fp),L.aA=void 0,(xu=L.aA||(L.aA={}))[xu.none=0]="none",xu[xu.horizontal=1]="horizontal",xu[xu.vertical=2]="vertical",xu[xu.horizontalOnly=3]="horizontalOnly";const ul=128,ys=32640;function cl(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new qn(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=n;let m=0;for(;m<l.length&&l[m]<=i;)m++;m=Math.max(0,m-1);let y=m;for(;y<l.length&&l[y]<i+1;)y++;y=Math.min(l.length-1,y);const w=l[m],S=l[y];return n.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:S,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:S,minSize:n.evaluate(new qn(w)),maxSize:n.evaluate(new qn(S)),interpolationType:h}}}function Xc(i,e,n){let l="never";const h=i.get(e);return h?l=h:i.get(n)&&(l="always"),l}const Hg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Nf(i,e,n,l,h,m,y,w,S,I,D,O,j){const G=w?Math.min(ys,Math.round(w[0])):0,H=w?Math.min(ys,Math.round(w[1])):0;i.emplaceBack(e,n,Math.round(32*l),Math.round(32*h),m,y,(G<<1)+(S?1:0),H,16*I,16*D,256*O,256*j)}function Md(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function qm(i){for(const e of i.sections)if(wh(e.text))return!0;return!1}class Cd{constructor(e){this.layoutVertexArray=new _e,this.indexArray=new $e,this.programConfigurations=e,this.segments=new mt,this.dynamicLayoutVertexArray=new Ce,this.opacityVertexArray=new Ae,this.hasVisibleVertices=!1,this.placedSymbolArray=new c}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Dp.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Hg,!0),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Bt("SymbolBuffers",Cd);class Up{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new mt,this.collisionVertexArray=new ze}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Pp.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Bt("CollisionBuffers",Up);class rc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((y=>y.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cl(this.zoom,n["text-size"]),this.iconSizeData=cl(this.zoom,n["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=Xc(l,"text-overlap","text-allow-overlap")!=="never"||Xc(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((y=>L.aA[y]))),this.stateDependentLayerIds=this.layers.filter((y=>y.isStateDependent())).map((y=>y.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Cd(new Vi(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Cd(new Vi(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new T,this.lineVertexArray=new C,this.symbolInstances=new b,this.textAnchorOffsets=new z}calculateGlyphDependencies(e,n,l,h,m){for(const y of e)if(n[y.codePointAt(0)]=!0,(l||h)&&m){const w=Bh[y];w&&(n[w.codePointAt(0)]=!0)}}populate(e,n,l){const h=this.layers[0],m=h.layout,y=m.get("text-font"),w=m.get("text-field"),S=m.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Yi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),D=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,O=m.get("symbol-sort-key");if(this.features=[],!I&&!D)return;const j=n.iconDependencies,G=n.glyphDependencies,H=n.availableImages,W=new qn(this.zoom);for(const{feature:K,id:ie,index:ye,sourceLayerIndex:ae}of e){const le=h._featureFilter.needGeometry,we=zl(K,le);if(!h._featureFilter.filter(W,we,l))continue;let Me,Ye;if(le||(we.geometry=_s(K)),I){const it=h.getValueAndResolveTokens("text-field",we,l,H),gt=Yi.factory(it),Ot=this.hasRTLText=this.hasRTLText||qm(gt);(!Ot||Ws.getRTLTextPluginStatus()==="unavailable"||Ot&&Ws.isParsed())&&(Me=Lp(gt,h,we))}if(D){const it=h.getValueAndResolveTokens("icon-image",we,l,H);Ye=it instanceof An?it:An.fromString(it)}if(!Me&&!Ye)continue;const ct=this.sortFeaturesByKey?O.evaluate(we,{},l):void 0;if(this.features.push({id:ie,text:Me,icon:Ye,index:ye,sourceLayerIndex:ae,geometry:we.geometry,properties:K.properties,type:gu.types[K.type],sortKey:ct}),Ye&&(j[Ye.name]=!0),Me){const it=y.evaluate(we,{},l).join(","),gt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(L.aA.vertical)>=0;for(const Ot of Me.sections)if(Ot.image)j[Ot.image.name]=!0;else{const yt=Rs(Me.toString()),ot=Ot.fontStack||it,Ke=G[ot]=G[ot]||{};this.calculateGlyphDependencies(Ot.text,Ke,gt,this.allowVerticalPlacement,yt)}}}m.get("symbol-placement")==="line"&&(this.features=(function(K){const ie={},ye={},ae=[];let le=0;function we(it){ae.push(K[it]),le++}function Me(it,gt,Ot){const yt=ye[it];return delete ye[it],ye[gt]=yt,ae[yt].geometry[0].pop(),ae[yt].geometry[0]=ae[yt].geometry[0].concat(Ot[0]),yt}function Ye(it,gt,Ot){const yt=ie[gt];return delete ie[gt],ie[it]=yt,ae[yt].geometry[0].shift(),ae[yt].geometry[0]=Ot[0].concat(ae[yt].geometry[0]),yt}function ct(it,gt,Ot){const yt=Ot?gt[0][gt[0].length-1]:gt[0][0];return`${it}:${yt.x}:${yt.y}`}for(let it=0;it<K.length;it++){const gt=K[it],Ot=gt.geometry,yt=gt.text?gt.text.toString():null;if(!yt){we(it);continue}const ot=ct(yt,Ot),Ke=ct(yt,Ot,!0);if(ot in ye&&Ke in ie&&ye[ot]!==ie[Ke]){const Yt=Ye(ot,Ke,Ot),jt=Me(ot,Ke,ae[Yt].geometry);delete ie[ot],delete ye[Ke],ye[ct(yt,ae[jt].geometry,!0)]=jt,ae[Yt].geometry=null}else ot in ye?Me(ot,Ke,Ot):Ke in ie?Ye(ot,Ke,Ot):(we(it),ie[ot]=le-1,ye[Ke]=le-1)}return ae.filter((it=>it.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((K,ie)=>K.sortKey-ie.sortKey))}update(e,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0){let h=e.dist(n[e.segment+1]),m=e.dist(n[e.segment]);const y={};for(let w=e.segment+1;w<n.length;w++)y[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:h},w<n.length-1&&(h+=n[w+1].dist(n[w]));for(let w=e.segment||0;w>=0;w--)y[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:m},w>0&&(m+=n[w-1].dist(n[w]));for(let w=0;w<n.length;w++){const S=y[w];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,h,m,y,w,S,I,D,O,j){const G=e.indexArray,H=e.layoutVertexArray,W=e.segments.prepareSegment(4*n.length,H,G,this.canOverlap?y.sortKey:void 0),K=this.glyphOffsetArray.length,ie=W.vertexLength,ye=this.allowVerticalPlacement&&w===L.aA.vertical?Math.PI/2:0,ae=y.text&&y.text.sections;for(let le=0;le<n.length;le++){const{tl:we,tr:Me,bl:Ye,br:ct,tex:it,pixelOffsetTL:gt,pixelOffsetBR:Ot,minFontScaleX:yt,minFontScaleY:ot,glyphOffset:Ke,isSDF:Yt,sectionIndex:jt}=n[le],Xt=W.vertexLength,Vt=Ke[1];Nf(H,S.x,S.y,we.x,Vt+we.y,it.x,it.y,l,Yt,gt.x,gt.y,yt,ot),Nf(H,S.x,S.y,Me.x,Vt+Me.y,it.x+it.w,it.y,l,Yt,Ot.x,gt.y,yt,ot),Nf(H,S.x,S.y,Ye.x,Vt+Ye.y,it.x,it.y+it.h,l,Yt,gt.x,Ot.y,yt,ot),Nf(H,S.x,S.y,ct.x,Vt+ct.y,it.x+it.w,it.y+it.h,l,Yt,Ot.x,Ot.y,yt,ot),Md(e.dynamicLayoutVertexArray,S,ye),G.emplaceBack(Xt,Xt+2,Xt+1),G.emplaceBack(Xt+1,Xt+2,Xt+3),W.vertexLength+=4,W.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ke[0]),le!==n.length-1&&jt===n[le+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,y,y.index,{imagePositions:{},canonical:j,formattedSection:ae&&ae[jt]})}e.placedSymbolArray.emplaceBack(S.x,S.y,K,this.glyphOffsetArray.length-K,ie,I,D,S.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],w,0,!1,0,O)}_addCollisionDebugVertex(e,n,l,h,m,y){return n.emplaceBack(0,0),e.emplaceBack(l.x,l.y,h,m,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,n,l,h,m,y,w){const S=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),I=S.vertexLength,D=m.layoutVertexArray,O=m.collisionVertexArray,j=w.anchorX,G=w.anchorY;this._addCollisionDebugVertex(D,O,y,j,G,new ue(e,n)),this._addCollisionDebugVertex(D,O,y,j,G,new ue(l,n)),this._addCollisionDebugVertex(D,O,y,j,G,new ue(l,h)),this._addCollisionDebugVertex(D,O,y,j,G,new ue(e,h)),S.vertexLength+=4;const H=m.indexArray;H.emplaceBack(I,I+1),H.emplaceBack(I+1,I+2),H.emplaceBack(I+2,I+3),H.emplaceBack(I+3,I),S.primitiveLength+=4}addDebugCollisionBoxes(e,n,l,h){for(let m=e;m<n;m++){const y=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,h?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Up(be,Rp.members,Ze),this.iconCollisionBox=new Up(be,Rp.members,Ze);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,l,h,m,y,w,S,I){const D={};for(let O=n;O<l;O++){const j=e.get(O);D.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},D.textFeatureIndex=j.featureIndex;break}for(let O=h;O<m;O++){const j=e.get(O);D.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},D.verticalTextFeatureIndex=j.featureIndex;break}for(let O=y;O<w;O++){const j=e.get(O);D.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},D.iconFeatureIndex=j.featureIndex;break}for(let O=S;O<I;O++){const j=e.get(O);D.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,anchorPointX:j.anchorPointX,anchorPointY:j.anchorPointY},D.verticalIconFeatureIndex=j.featureIndex;break}return D}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),h=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<h;m+=4)e.indexArray.emplaceBack(m,m+2,m+1),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),h=[],m=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const S=this.symbolInstances.get(w);h.push(0|Math.round(n*S.anchorX+l*S.anchorY)),m.push(S.featureIndex)}return y.sort(((w,S)=>h[w]-h[S]||m[S]-m[w])),y}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((h,m,y)=>{h>=0&&y.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let jp,Gp;Bt("SymbolBucket",rc,{omit:["layers","collisionBoxArray","features","compareText"]}),rc.MAX_GLYPHS=65535,rc.addDynamicAttributes=Md;var qp={get paint(){return Gp=Gp||new cr({"icon-opacity":new cn(Ge.paint_symbol["icon-opacity"]),"icon-color":new cn(Ge.paint_symbol["icon-color"]),"icon-halo-color":new cn(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new cn(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new cn(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Kt(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Kt(Ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new cn(Ge.paint_symbol["text-opacity"]),"text-color":new cn(Ge.paint_symbol["text-color"],{runtimeType:gr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new cn(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new cn(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new cn(Ge.paint_symbol["text-halo-blur"]),"text-translate":new Kt(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new Kt(Ge.paint_symbol["text-translate-anchor"])})},get layout(){return jp=jp||new cr({"symbol-placement":new Kt(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Kt(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Kt(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new cn(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Kt(Ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Kt(Ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Kt(Ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Kt(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Kt(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Kt(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new cn(Ge.layout_symbol["icon-size"]),"icon-text-fit":new Kt(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Kt(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new cn(Ge.layout_symbol["icon-image"]),"icon-rotate":new cn(Ge.layout_symbol["icon-rotate"]),"icon-padding":new cn(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Kt(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new cn(Ge.layout_symbol["icon-offset"]),"icon-anchor":new cn(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Kt(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Kt(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Kt(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new cn(Ge.layout_symbol["text-field"]),"text-font":new cn(Ge.layout_symbol["text-font"]),"text-size":new cn(Ge.layout_symbol["text-size"]),"text-max-width":new cn(Ge.layout_symbol["text-max-width"]),"text-line-height":new Kt(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new cn(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new cn(Ge.layout_symbol["text-justify"]),"text-radial-offset":new cn(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Kt(Ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new cn(Ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new cn(Ge.layout_symbol["text-anchor"]),"text-max-angle":new Kt(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Kt(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new cn(Ge.layout_symbol["text-rotate"]),"text-padding":new Kt(Ge.layout_symbol["text-padding"]),"text-keep-upright":new Kt(Ge.layout_symbol["text-keep-upright"]),"text-transform":new cn(Ge.layout_symbol["text-transform"]),"text-offset":new cn(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new Kt(Ge.layout_symbol["text-allow-overlap"]),"text-overlap":new Kt(Ge.layout_symbol["text-overlap"]),"text-ignore-placement":new Kt(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new Kt(Ge.layout_symbol["text-optional"])})}};class Id{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:li,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Bt("FormatSectionOverride",Id,{omit:["defaultValue"]});class jh extends Oa{constructor(e,n){super(e,qp,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const m of l)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,l,h){const m=this.layout.get(e).evaluate(n,{},l,h),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Tl(y.value)||!m?m:(function(w,S){return S.replace(/{([^{}]+)}/g,((I,D)=>w&&D in w?String(w[D]):""))})(n.properties,m)}createBucket(e){return new rc(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of qp.paint.overridableProperties){if(!jh.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new Id(n),h=new ph(l,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new Pa("source",h):new Sl("composite",h,n.value.zoomStops),this.paint._values[e]=new La(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&jh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),h=qp.paint.properties[n];let m=!1;const y=w=>{for(const S of w)if(h.overrides&&h.overrides.hasOverride(S))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Yi)y(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const w=I=>{m||(I instanceof bi&&si(I.value)===ui?y(I.value.sections):I instanceof Ys?y(I.sections):I.eachChild(w))},S=l.value;S._styleExpression&&w(S._styleExpression.expression)}return m}}let Zm;var Xg={get paint(){return Zm=Zm||new cr({"background-color":new Kt(Ge.paint_background["background-color"]),"background-pattern":new za(Ge.paint_background["background-pattern"]),"background-opacity":new Kt(Ge.paint_background["background-opacity"])})}};class Bf extends Oa{constructor(e,n){super(e,Xg,n)}}class $g extends Oa{constructor(e,n){super(e,{},n),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ym{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Wn={once:!0},Ff=63710088e-1;class hl{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new hl(Rn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,h=e.lat*n,m=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return Ff*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof hl)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new hl(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new hl(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Ad=2*Math.PI*Ff;function Zp(i){return Ad*Math.cos(i*Math.PI/180)}function kd(i){return(180+i)/360}function Gh(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Vf(i,e){return i/Zp(e)}function Hm(i){return 360*i-180}function Uf(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Xm(i,e){return i*Zp(Uf(e))}class jf{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=hl.convert(e);return new jf(kd(l.lng),Gh(l.lat),Vf(n,l.lat))}toLngLat(){return new hl(Hm(this.x),Uf(this.y))}toAltitude(){return Xm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Ad*(e=Uf(this.y),1/Math.cos(e*Math.PI/180));var e}}function Yp(i,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class Dd{constructor(e,n,l){if(!(function(h,m,y){return!(h<0||h>25||y<0||y>=Math.pow(2,h)||m<0||m>=Math.pow(2,h))})(e,n,l))throw new Error(`x=${n}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=l,this.key=Rr(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,l){const h=(function(y,w,S){var I=Yp(256*y,256*(w=Math.pow(2,S)-w-1),S),D=Yp(256*(y+1),256*(w+1),S);return I[0]+","+I[1]+","+D[0]+","+D[1]})(this.x,this.y,this.z),m=(function(y,w,S){let I,D="";for(let O=y;O>0;O--)I=1<<O-1,D+=(w&I?1:0)+(S&I?2:0);return D})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,m).replace(/{bbox-epsg-3857}/g,h)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new ue((e.x*n-this.x)*Ht,(e.y*n-this.y)*Ht)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ri{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Rr(e,n.z,n.z,n.x,n.y)}}class vs{constructor(e,n,l,h,m){if(this.terrainRttPosMatrix32f=null,e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=n,this.canonical=new Dd(l,+h,+m),this.key=Rr(n,e,l,h,m)}clone(){return new vs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new vs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new vs(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?Rr(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):Rr(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new vs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new vs(n,this.wrap,n,l,h),new vs(n,this.wrap,n,l+1,h),new vs(n,this.wrap,n,l,h+1),new vs(n,this.wrap,n,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new vs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new vs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ri(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new jf(e.x-this.wrap,e.y))}}function Rr(i,e,n,l,h){(i*=2)<0&&(i=-1*i-1);const m=1<<n;return(m*m*i+m*h+l).toString(36)+n.toString(36)+e.toString(36)}function Gf(i,e){return e?i.properties[e]:i.id}function $m(i,e){const n={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const l of e.removeProperties){const h=i.addOrUpdateProperties.findIndex((m=>m.key===l));h>-1&&i.addOrUpdateProperties.splice(h,1)}return(i.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||i.newGeometry),n}function Wm(i){var e,n;if(!i)return{};const l={};return l.removeAll=i.removeAll,l.remove=new Set(i.remove||[]),l.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((h=>[h.id,h]))),l.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((h=>[h.id,h]))),l}Bt("CanonicalTileID",Dd),Bt("OverscaledTileID",vs,{omit:["terrainRttPosMatrix32f"]});class Pd{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Rd{constructor(e,n,l,h,m){this.type="Feature",this._vectorTileFeature=e,this._x=l,this._y=h,this._z=n,this.properties=e.properties,this.id=m}projectPoint(e,n,l,h){return[360*(e.x+n)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+l)/h)*Math.PI))-90]}projectLine(e,n,l,h){return e.map((m=>this.projectPoint(m,n,l,h)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),l=e.extent*this._x,h=e.extent*this._y,m=e.loadGeometry();switch(e.type){case 1:{const y=[];for(const S of m)y.push(S[0]);const w=this.projectLine(y,l,h,n);this._geometry=y.length===1?{type:"Point",coordinates:w[0]}:{type:"MultiPoint",coordinates:w};break}case 2:{const y=m.map((w=>this.projectLine(w,l,h,n)));this._geometry=y.length===1?{type:"LineString",coordinates:y[0]}:{type:"MultiLineString",coordinates:y};break}case 3:{const y=If(m),w=[];for(const S of y)w.push(S.map((I=>this.projectLine(I,l,h,n))));this._geometry=w.length===1?{type:"Polygon",coordinates:w[0]}:{type:"MultiPolygon",coordinates:w};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class bu{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,l){this._name=e,this.dataBuffer=n,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class qf extends bu{}class Ld extends qf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Zf extends qf{getValueFromBuffer(e){return this.dataBuffer[e]}}class zd extends bu{delta;constructor(e,n,l,h){super(e,n,h),this.delta=l}}class Hp extends zd{constructor(e,n,l,h){super(e,Int32Array.of(n),l,h)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class Od extends bu{constructor(e,n,l){super(e,Int32Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}class Wg{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,l,h,m=4096){this._name=e,this._geometryVector=n,this._idVector=l,this._propertyVectors=h,this._extent=m}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const h=e?.next().value,m={};for(const y of this.propertyVectors){if(!y)continue;const w=y.name,S=y.getValue(n);S!==null&&(m[w]=S)}n++,yield{id:l,geometry:h,properties:m}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let h;this.idVector&&(h=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const m={coordinates:n[l],type:this.geometryVector.geometryType(l)},y={};for(const w of this.propertyVectors){if(!w)continue;const S=w.name,I=w.getValue(l);I!==null&&(y[S]=I)}e.push({id:h,geometry:m,properties:y})}return e}containsMaxSaveIntegerValues(e){return e instanceof Ld||e instanceof Od&&e instanceof Hp||e instanceof Zf}}class Qm{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var On,wu,ar,zo,ac,Ka,ia,ra,Xp,xs;function jr(i,e,n){const l=new Int32Array(n);let h=0,m=e.get();for(let y=0;y<l.length;y++){let w=i[m++],S=127&w;w<128||(w=i[m++],S|=(127&w)<<7,w<128||(w=i[m++],S|=(127&w)<<14,w<128||(w=i[m++],S|=(127&w)<<21,w<128||(w=i[m++],S|=(15&w)<<28)))),l[h++]=S}return e.set(m),l}function Nd(i,e,n){const l=new BigInt64Array(n);for(let h=0;h<l.length;h++)l[h]=Km(i,e);return l}function Oo(i,e){let n,l;return l=i[e.get()],e.increment(),n=127&l,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<7,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<14,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<21,l<128?n:(l=i[e.get()],n|=(15&l)<<28,(function(h,m,y){let w,S;if(S=m[y.get()],y.increment(),w=(112&S)>>4,S<128||(S=m[y.get()],y.increment(),w|=(127&S)<<3,S<128)||(S=m[y.get()],y.increment(),w|=(127&S)<<10,S<128)||(S=m[y.get()],y.increment(),w|=(127&S)<<17,S<128)||(S=m[y.get()],y.increment(),w|=(127&S)<<24,S<128)||(S=m[y.get()],y.increment(),w|=(1&S)<<31,S<128))return 4294967296*w+(h>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,e)))))}function Bd(i,e,n,l){throw new Error("FastPFor is not implemented yet.")}function sc(i){return i>>>1^-(1&i)}function $c(i){return i>>1n^-(1n&i)}function Km(i,e){let n=0n,l=0,h=e.get();for(;h<i.length;){const m=i[h++];if(n|=BigInt(127&m)<<BigInt(l),!(128&m))break;if(l+=7,l>=64)throw new Error("Varint too long")}return e.set(h),n}function qh(i,e,n){const l=new Int32Array(n);let h=0;for(let m=0;m<e;m++){const y=i[m];l.fill(i[m+e],h,h+y),h+=y}return l}function ro(i,e,n){const l=new BigInt64Array(n);let h=0;for(let m=0;m<e;m++){const y=Number(i[m]);l.fill(i[m+e],h,h+y),h+=y}return l}function $p(i,e,n){const l=new Float64Array(n);let h=0;for(let m=0;m<e;m++){const y=i[m];l.fill(i[m+e],h,h+y),h+=y}return l}function Zh(i){const e=i.length/4*4;let n=1;if(e>=4)for(let l=i[0];n<e-4;n+=4)l=i[n]+=l,l=i[n+1]+=l,l=i[n+2]+=l,l=i[n+3]+=l;for(;n!=i.length;)i[n]+=i[n-1],++n}function Fl(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let n=2;if(e>=4)for(;n<e-4;n+=4){const l=i[n],h=i[n+1],m=i[n+2],y=i[n+3];i[n]=(l>>>1^-(1&l))+i[n-2],i[n+1]=(h>>>1^-(1&h))+i[n-1],i[n+2]=(m>>>1^-(1&m))+i[n],i[n+3]=(y>>>1^-(1&y))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(On||(On={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(wu||(wu={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(ar||(ar={}));class Wp{_dictionaryType;_offsetType;_lengthType;constructor(e,n,l){this._dictionaryType=e,this._offsetType=n,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function Ja(i,e){const n=(function(l,h){const m=l[h.get()],y=Object.values(ar)[m>>4];let w=null;switch(y){case ar.DATA:w=new Wp(Object.values(zo)[15&m]);break;case ar.OFFSET:w=new Wp(null,Object.values(ac)[15&m]);break;case ar.LENGTH:w=new Wp(null,null,Object.values(Ka)[15&m])}h.increment();const S=l[h.get()],I=Object.values(On)[S>>5],D=Object.values(On)[S>>2&7],O=Object.values(wu)[3&S];h.increment();const j=jr(l,h,2),G=j[0];return{physicalStreamType:y,logicalStreamType:w,logicalLevelTechnique1:I,logicalLevelTechnique2:D,physicalLevelTechnique:O,numValues:G,byteLength:j[1],decompressedCount:G}})(i,e);return n.logicalLevelTechnique1===On.MORTON?(function(l,h,m){const y=jr(h,m,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:y[0],coordinateShift:y[1]}})(n,i,e):On.RLE!==n.logicalLevelTechnique1&&On.RLE!==n.logicalLevelTechnique2||wu.NONE===n.physicalLevelTechnique?n:(function(l,h,m){const y=jr(h,m,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:y[1],runs:y[0],numRleValues:y[1]}})(n,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(zo||(zo={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(ac||(ac={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(Ka||(Ka={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(ia||(ia={}));class es{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const l=Math.floor(e/8);this.values[l]=this.values[l]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Fa(i,e,n,l,h){return(function(m,y,w){switch(y.logicalLevelTechnique1){case On.DELTA:return y.logicalLevelTechnique2===On.RLE?(function(S,I,D){const O=new Int32Array(D);let j=0,G=0;for(let H=0;H<I;H++){const W=S[H],K=sc(S[H+I]);for(let ie=0;ie<W;ie++)G+=K,O[j++]=G}return O})(m,y.runs,y.numRleValues):((function(S){S[0]=S[0]>>>1^-(1&S[0]);const I=S.length/4*4;let D=1;if(I>=4)for(;D<I-4;D+=4){const O=S[D],j=S[D+1],G=S[D+2],H=S[D+3];S[D]=(O>>>1^-(1&O))+S[D-1],S[D+1]=(j>>>1^-(1&j))+S[D],S[D+2]=(G>>>1^-(1&G))+S[D+1],S[D+3]=(H>>>1^-(1&H))+S[D+2]}for(;D!=S.length;++D)S[D]=(S[D]>>>1^-(1&S[D]))+S[D-1]})(m),m);case On.RLE:return(function(S,I,D){return D?(function(O,j,G){const H=new Int32Array(G);let W=0;for(let K=0;K<j;K++){const ie=O[K];let ye=O[K+j];ye=ye>>>1^-(1&ye),H.fill(ye,W,W+ie),W+=ie}return H})(S,I.runs,I.numRleValues):qh(S,I.runs,I.numRleValues)})(m,y,w);case On.MORTON:return Zh(m),m;case On.COMPONENTWISE_DELTA:return Fl(m),m;case On.NONE:return w&&(function(S){for(let I=0;I<S.length;I++){const D=S[I];S[I]=D>>>1^-(1&D)}})(m),m;default:throw new Error(`The specified Logical level technique is not supported: ${y.logicalLevelTechnique1}`)}})(Fd(i,e,n),n,l)}function oc(i,e,n){return(function(l,h){if(h.logicalLevelTechnique1===On.DELTA&&h.logicalLevelTechnique2===On.NONE)return(function(y){const w=new Int32Array(y.length+1);w[0]=0,w[1]=sc(y[0]);let S=w[1],I=2;for(;I!=w.length;++I){const D=y[I-1];S+=D>>>1^-(1&D),w[I]=w[I-1]+S}return w})(l);if(h.logicalLevelTechnique1===On.RLE&&h.logicalLevelTechnique2===On.NONE)return(function(y,w,S){const I=new Int32Array(S+1);I[0]=0;let D=1,O=I[0];for(let j=0;j<w;j++){const G=y[j],H=y[j+w];for(let W=D;W<D+G;W++)I[W]=H+O,O=I[W];D+=G}return I})(l,h.runs,h.numRleValues);if(h.logicalLevelTechnique1===On.NONE&&h.logicalLevelTechnique2===On.NONE){(function(y){let w=0;for(let S=0;S<y.length;S++)y[S]+=w,w=y[S]})(l);const m=new Int32Array(h.numValues+1);return m[0]=0,m.set(l,1),m}if(h.logicalLevelTechnique1===On.DELTA&&h.logicalLevelTechnique2===On.RLE){const m=(function(y,w,S){const I=new Int32Array(S+1);I[0]=0;let D=1,O=I[0];for(let j=0;j<w;j++){const G=y[j];let H=y[j+w];H=H>>>1^-(1&H);for(let W=D;W<D+G;W++)I[W]=H+O,O=I[W];D+=G}return I})(l,h.runs,h.numRleValues);return Zh(m),m}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(Fd(i,e,n),n)}function Fd(i,e,n){const l=n.physicalLevelTechnique;if(l===wu.FAST_PFOR)return Bd();if(l===wu.VARINT)return jr(i,e,n.numValues);if(l===wu.NONE){const h=e.get();e.add(n.byteLength);const m=i.subarray(h,e.get());return new Int32Array(m)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function Qp(i,e,n,l){const h=Fd(i,e,n);if(h.length===1){const m=h[0];return l?sc(m):m}return l?(function(m){return sc(m[1])})(h):(function(m){return m[1]})(h)}function Jm(i,e,n){return(function(l){if(l.length==2){const h=sc(l[1]);return[h,h]}return[sc(l[2]),sc(l[3])]})(Fd(i,e,n))}function eg(i,e,n){return(function(l){if(l.length==2){const h=$c(l[1]);return[h,h]}return[$c(l[2]),$c(l[3])]})(Nd(i,e,n.numValues))}function tg(i,e,n,l){return(function(h,m,y){switch(m.logicalLevelTechnique1){case On.DELTA:return m.logicalLevelTechnique2===On.RLE?(function(w,S,I){const D=new BigInt64Array(I);let O=0,j=0n;for(let G=0;G<S;G++){const H=Number(w[G]),W=$c(w[G+S]);for(let K=0;K<H;K++)j+=W,D[O++]=j}return D})(h,m.runs,m.numRleValues):((function(w){w[0]=w[0]>>1n^-(1n&w[0]);const S=w.length/4*4;let I=1;if(S>=4)for(;I<S-4;I+=4){const D=w[I],O=w[I+1],j=w[I+2],G=w[I+3];w[I]=(D>>1n^-(1n&D))+w[I-1],w[I+1]=(O>>1n^-(1n&O))+w[I],w[I+2]=(j>>1n^-(1n&j))+w[I+1],w[I+3]=(G>>1n^-(1n&G))+w[I+2]}for(;I!=w.length;++I)w[I]=(w[I]>>1n^-(1n&w[I]))+w[I-1]})(h),h);case On.RLE:return(function(w,S,I){return I?(function(D,O,j){const G=new BigInt64Array(j);let H=0;for(let W=0;W<O;W++){const K=Number(D[W]);let ie=D[W+O];ie=ie>>1n^-(1n&ie),G.fill(ie,H,H+K),H+=K}return G})(w,S.runs,S.numRleValues):ro(w,S.runs,S.numRleValues)})(h,m,y);case On.NONE:return y&&(function(w){for(let S=0;S<w.length;S++){const I=w[S];w[S]=I>>1n^-(1n&I)}})(h),h;default:throw new Error(`The specified Logical level technique is not supported: ${m.logicalLevelTechnique1}`)}})(Nd(i,e,n.numValues),n,l)}function ng(i,e,n,l){const h=Nd(i,e,n.numValues);if(h.length===1){const m=h[0];return l?$c(m):m}return l?(function(m){return $c(m[1])})(h):(function(m){return m[1]})(h)}function Vd(i,e,n,l,h){return(function(m,y,w,S){switch(y.logicalLevelTechnique1){case On.DELTA:return y.logicalLevelTechnique2===On.RLE&&(m=qh(m,y.runs,y.numRleValues)),(function(I,D){const O=new Int32Array(I.size());let j=0;I.get(0)?(O[0]=I.get(0)?D[0]>>>1^-(1&D[0]):0,j=1):O[0]=0;let G=1;for(;G!=O.length;++G)O[G]=I.get(G)?O[G-1]+(D[j]>>>1^-(1&D[j++])):O[G-1];return O})(S,m);case On.RLE:return(function(I,D,O,j){const G=D;return O?(function(H,W,K){const ie=new Int32Array(H.size());let ye=0;for(let ae=0;ae<K;ae++){const le=W[ae];let we=W[ae+K];we=we>>>1^-(1&we);for(let Me=ye;Me<ye+le;Me++)H.get(Me)?ie[Me]=we:(ie[Me]=0,ye++);ye+=le}return ie})(j,I,G.runs):(function(H,W,K){const ie=new Int32Array(H.size());let ye=0;for(let ae=0;ae<K;ae++){const le=W[ae],we=W[ae+K];for(let Me=ye;Me<ye+le;Me++)H.get(Me)?ie[Me]=we:(ie[Me]=0,ye++);ye+=le}return ie})(j,I,G.runs)})(m,y,w,S);case On.MORTON:return Zh(m),m;case On.COMPONENTWISE_DELTA:return Fl(m),m;case On.NONE:return m=w?(function(I,D){const O=new Int32Array(I.size());let j=0,G=0;for(;G!=O.length;++G)if(I.get(G)){const H=D[j++];O[G]=H>>>1^-(1&H)}else O[G]=0;return O})(S,m):(function(I,D){const O=new Int32Array(I.size());let j=0,G=0;for(;G!=O.length;++G)O[G]=I.get(G)?D[j++]:0;return O})(S,m),m;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===wu.FAST_PFOR?Bd():jr(i,e,n.numValues),n,l,h)}function Tu(i,e,n,l){const h=i.logicalLevelTechnique1;if(h===On.RLE)return i.runs===1?ia.CONST:ia.FLAT;const m=e instanceof es?e.size():e;if(h===On.DELTA&&i.logicalLevelTechnique2===On.RLE){const y=i.runs,w=2;if(i.numRleValues!==m)return ia.FLAT;if(y===1)return ia.SEQUENCE;if(y===2){const S=l.get();let I;if(i.physicalLevelTechnique===wu.VARINT)I=jr(n,l,4);else{const D=l.get();I=new Int32Array(n.buffer,n.byteOffset+D,4)}if(l.set(S),I[2]===w&&I[3]===w)return ia.SEQUENCE}}return i.numValues===1?ia.CONST:ia.FLAT}class Yh extends qf{getValueFromBuffer(e){return this.dataBuffer[e]}}class Kp extends zd{constructor(e,n,l,h){super(e,BigInt64Array.of(n),l,h)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class Hh{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,l){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function lc(i,e,n){return{x:Xh(i,e)-n,y:Xh(i>>1,e)-n}}function Xh(i,e){let n=0;for(let l=0;l<e;l++)n|=(i&1<<2*l)>>l;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(ra||(ra={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(Xp||(Xp={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(xs||(xs={}));class ig{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function Yf(i){const e=new Array(i.numGeometries);let n=1,l=1,h=1,m=0;const y=new ig;let w=0,S=0;const I=i.mortonSettings,D=i.topologyVector,O=D.geometryOffsets,j=D.partOffsets,G=D.ringOffsets,H=i.vertexOffsets,W=i.containsPolygonGeometry(),K=i.vertexBuffer;for(let ie=0;ie<i.numGeometries;ie++){const ye=i.geometryType(ie);if(ye===ra.POINT){if(H&&H.length!==0)if(i.vertexBufferType===xs.VEC_2){const ae=2*H[S++],le=new ue(K[ae],K[ae+1]);e[m++]=y.createPoint(le)}else{const ae=lc(K[H[S++]],I.numBits,I.coordinateShift),le=new ue(ae.x,ae.y);e[m++]=y.createPoint(le)}else{const ae=new ue(K[w++],K[w++]);e[m++]=y.createPoint(ae)}O&&h++,j&&n++,G&&l++}else if(ye===ra.MULTIPOINT){const ae=O[h]-O[h-1];h++;const le=new Array(ae);if(H&&H.length!==0){for(let we=0;we<ae;we++){const Me=2*H[S++];le[we]=new ue(K[Me],K[Me+1])}e[m++]=y.createMultiPoint(le)}else{for(let we=0;we<ae;we++){const Me=K[w++],Ye=K[w++];le[we]=new ue(Me,Ye)}e[m++]=y.createMultiPoint(le)}}else if(ye===ra.LINESTRING){let ae,le=0;W?(le=G[l]-G[l-1],l++):le=j[n]-j[n-1],n++,H&&H.length!==0?(ae=i.vertexBufferType===xs.VEC_2?jd(K,H,S,le,!1):Jp(K,H,S,le,!1,I),S+=le):(ae=Ud(K,w,le,!1),w+=2*le),e[m++]=y.createLineString(ae),O&&h++}else if(ye===ra.POLYGON){const ae=j[n]-j[n-1];n++;const le=new Array(ae-1);let we=G[l]-G[l-1];if(l++,H&&H.length!==0){const Me=i.vertexBufferType===xs.VEC_2?Wh(K,H,S,we):Wc(K,H,S,we,0,I);S+=we;for(let Ye=0;Ye<le.length;Ye++)we=G[l]-G[l-1],l++,le[Ye]=i.vertexBufferType===xs.VEC_2?Wh(K,H,S,we):Wc(K,H,S,we,0,I),S+=we;e[m++]=y.createPolygon(Me,le)}else{const Me=$h(K,w,we);w+=2*we;for(let Ye=0;Ye<le.length;Ye++)we=G[l]-G[l-1],l++,le[Ye]=$h(K,w,we),w+=2*we;e[m++]=y.createPolygon(Me,le)}O&&h++}else if(ye===ra.MULTILINESTRING){const ae=O[h]-O[h-1];h++;const le=new Array(ae);if(H&&H.length!==0){for(let we=0;we<ae;we++){let Me=0;W?(Me=G[l]-G[l-1],l++):Me=j[n]-j[n-1],n++;const Ye=i.vertexBufferType===xs.VEC_2?jd(K,H,S,Me,!1):Jp(K,H,S,Me,!1,I);le[we]=Ye,S+=Me}e[m++]=y.createMultiLineString(le)}else{for(let we=0;we<ae;we++){let Me=0;W?(Me=G[l]-G[l-1],l++):Me=j[n]-j[n-1],n++,le[we]=Ud(K,w,Me,!1),w+=2*Me}e[m++]=y.createMultiLineString(le)}}else{if(ye!==ra.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ae=O[h]-O[h-1];h++;const le=new Array(ae);let we=0;if(H&&H.length!==0){for(let Me=0;Me<ae;Me++){const Ye=j[n]-j[n-1];n++;const ct=new Array(Ye-1);we=G[l]-G[l-1],l++;const it=i.vertexBufferType===xs.VEC_2?Wh(K,H,S,we):Wc(K,H,S,we,0,I);S+=we;for(let gt=0;gt<ct.length;gt++)we=G[l]-G[l-1],l++,ct[gt]=i.vertexBufferType===xs.VEC_2?Wh(K,H,S,we):Wc(K,H,S,we,0,I),S+=we;le[Me]=y.createPolygon(it,ct)}e[m++]=y.createMultiPolygon(le)}else{for(let Me=0;Me<ae;Me++){const Ye=j[n]-j[n-1];n++;const ct=new Array(Ye-1);we=G[l]-G[l-1],l++;const it=$h(K,w,we);w+=2*we;for(let gt=0;gt<ct.length;gt++){const Ot=G[l]-G[l-1];l++,ct[gt]=$h(K,w,Ot),w+=2*Ot}le[Me]=y.createPolygon(it,ct)}e[m++]=y.createMultiPolygon(le)}}}}return e}function $h(i,e,n){return Ud(i,e,n,!0)}function Wh(i,e,n,l){return jd(i,e,n,l,!0)}function Wc(i,e,n,l,h,m){return Jp(i,e,n,l,!0,m)}function Ud(i,e,n,l){const h=new Array(l?n+1:n);for(let m=0;m<2*n;m+=2)h[m/2]=new ue(i[e+m],i[e+m+1]);return l&&(h[h.length-1]=h[0]),h}function jd(i,e,n,l,h){const m=new Array(h?l+1:l);for(let y=0;y<2*l;y+=2){const w=2*e[n+y/2];m[y/2]=new ue(i[w],i[w+1])}return h&&(m[m.length-1]=m[0]),m}function Jp(i,e,n,l,h,m){const y=new Array(h?l+1:l);for(let w=0;w<l;w++){const S=lc(i[e[n+w]],m.numBits,m.coordinateShift);y[w]=new ue(S.x,S.y)}return h&&(y[y.length-1]=y[0]),y}class em{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,l,h,m){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=l,this._vertexBuffer=h,this._mortonSettings=m}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=Yf(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=lc(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return Yf(this)}get mortonSettings(){return this._mortonSettings}}class rg extends em{_numGeometries;_geometryType;constructor(e,n,l,h,m,y,w){super(l,h,m,y,w),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===ra.POLYGON||this._geometryType===ra.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class Gd extends em{_geometryTypes;constructor(e,n,l,h,m,y){super(e,l,h,m,y),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===ra.POLYGON||this.geometryType(e)===ra.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class ag{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,l,h){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=l,this._topologyVector=h}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,l=n.partOffsets,h=n.ringOffsets,m=n.geometryOffsets;let y=0,w=1,S=1,I=1;for(let D=0;D<this.numGeometries;D++)switch(this.geometryType(D)){case ra.POLYGON:{const O=l[w]-l[w-1];w++;const j=[];for(let G=0;G<O;G++){const H=h[S]-h[S-1];S++;const W=[];for(let K=0;K<H;K++){const ie=this._vertexBuffer[y++],ye=this._vertexBuffer[y++];W.push(new ue(ie,ye))}W.length>0&&W.push(W[0]),j.push(W)}e[D]=j,m&&I++}break;case ra.MULTIPOLYGON:{const O=m[I]-m[I-1];I++;const j=[];for(let G=0;G<O;G++){const H=l[w]-l[w-1];w++;for(let W=0;W<H;W++){const K=h[S]-h[S-1];S++;const ie=[];for(let ye=0;ye<K;ye++){const ae=this._vertexBuffer[y++],le=this._vertexBuffer[y++];ie.push(new ue(ae,le))}ie.length>0&&ie.push(ie[0]),j.push(ie)}}e[D]=j}}return e}[Symbol.iterator](){return null}}function Hf(i,e,n,l,h,m){return new qd(i,e,n,l,h,m)}class qd extends ag{_numGeometries;_geometryType;constructor(e,n,l,h,m,y){super(l,h,m,y),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function Xf(i,e,n,l,h){return new Qg(i,e,n,l,h)}class Qg extends ag{_geometryTypes;constructor(e,n,l,h,m){super(n,l,h,m),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function $f(i,e,n,l,h){const m=Ja(i,n);let y=null,w=null,S=null,I=null,D=null,O=null,j=null,G=null;if(Tu(m,l,i,n)===ia.CONST){const W=Qp(i,n,m,!1);for(let K=0;K<e-1;K++){const ie=Ja(i,n);switch(ie.physicalStreamType){case ar.LENGTH:switch(ie.logicalStreamType.lengthType){case Ka.GEOMETRIES:y=oc(i,n,ie);break;case Ka.PARTS:w=oc(i,n,ie);break;case Ka.RINGS:S=oc(i,n,ie);break;case Ka.TRIANGLES:j=oc(i,n,ie)}break;case ar.OFFSET:switch(ie.logicalStreamType.offsetType){case ac.VERTEX:I=Fa(i,n,ie,!1);break;case ac.INDEX:G=Fa(i,n,ie,!1)}break;case ar.DATA:zo.VERTEX===ie.logicalStreamType.dictionaryType?D=Fa(i,n,ie,!0):(O={numBits:ie.numBits,coordinateShift:ie.coordinateShift},D=Fa(i,n,ie,!1))}}return G!==null?y!=null||w!=null?Hf(l,W,j,G,D,new Hh(y,w,S)):Hf(l,W,j,G,D):O===null?(function(K,ie,ye,ae,le){return new rg(K,ie,xs.VEC_2,ye,ae,le)})(l,W,new Hh(y,w,S),I,D):(function(K,ie,ye,ae,le,we){return new rg(K,ie,xs.MORTON,ye,ae,le,we)})(l,W,new Hh(y,w,S),I,D,O)}const H=Fa(i,n,m,!1);for(let W=0;W<e-1;W++){const K=Ja(i,n);switch(K.physicalStreamType){case ar.LENGTH:switch(K.logicalStreamType.lengthType){case Ka.GEOMETRIES:y=Fa(i,n,K,!1);break;case Ka.PARTS:w=Fa(i,n,K,!1);break;case Ka.RINGS:S=Fa(i,n,K,!1);break;case Ka.TRIANGLES:j=oc(i,n,K)}break;case ar.OFFSET:switch(K.logicalStreamType.offsetType){case ac.VERTEX:I=Fa(i,n,K,!1);break;case ac.INDEX:G=Fa(i,n,K,!1)}break;case ar.DATA:zo.VERTEX===K.logicalStreamType.dictionaryType?D=Fa(i,n,K,!0):(O={numBits:K.numBits,coordinateShift:K.coordinateShift},D=Fa(i,n,K,!1))}}return G!==null&&w===null?Xf(H,j,G,D):(y!==null?(y=tm(H,y,2),w!==null&&S!==null?(w=nm(H,y,w,!1),S=(function(W,K,ie,ye){const ae=new Int32Array(ie[ie.length-1]+1);let le=0;ae[0]=le;let we=1,Me=1,Ye=0;for(let ct=0;ct<W.length;ct++){const it=W[ct],gt=K[ct+1]-K[ct];if(it!==0&&it!==3)for(let Ot=0;Ot<gt;Ot++){const yt=ie[we]-ie[we-1];we++;for(let ot=0;ot<yt;ot++)le=ae[Me++]=le+ye[Ye++]}else for(let Ot=0;Ot<gt;Ot++)ae[Me++]=++le,we++}return ae})(H,y,w,S)):w!==null&&(w=(function(W,K,ie){const ye=new Int32Array(K[K.length-1]+1);let ae=0;ye[0]=ae;let le=1,we=0;for(let Me=0;Me<W.length;Me++){const Ye=W[Me],ct=K[Me+1]-K[Me];if(Ye===4||Ye===1)for(let it=0;it<ct;it++)ae=ye[le++]=ae+ie[we++];else for(let it=0;it<ct;it++)ye[le++]=++ae}return ye})(H,y,w))):w!==null&&S!==null?(w=tm(H,w,1),S=nm(H,w,S,!0)):w!==null&&(w=tm(H,w,0)),G!==null?Xf(H,j,G,D,new Hh(y,w,S)):O===null?(function(W,K,ie,ye){return new Gd(xs.VEC_2,W,K,ie,ye)})(H,new Hh(y,w,S),I,D):(function(W,K,ie,ye,ae){return new Gd(xs.MORTON,W,K,ie,ye,ae)})(H,new Hh(y,w,S),I,D,O))}function tm(i,e,n){const l=new Int32Array(i.length+1);let h=0;l[0]=h;let m=0;for(let y=0;y<i.length;y++)h=l[y+1]=h+(i[y]>n?e[m++]:1);return l}function nm(i,e,n,l){const h=new Int32Array(e[e.length-1]+1);let m=0;h[0]=m;let y=1,w=0;for(let S=0;S<i.length;S++){const I=i[S],D=e[S+1]-e[S];if(I===5||I===2||l&&(I===4||I===1))for(let O=0;O<D;O++)m=h[y++]=m+n[w++];else for(let O=0;O<D;O++)h[y++]=++m}return h}class sg extends bu{dataVector;constructor(e,n,l){super(e,n.getBuffer(),l),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class og extends qf{getValueFromBuffer(e){return this.dataBuffer[e]}}class im extends bu{constructor(e,n,l){super(e,BigInt64Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}function Qc(i,e,n){return rm(i,Math.ceil(e/8),n)}function rm(i,e,n){const l=new Uint8Array(e);let h=0;for(;h<e;){const m=i[n.increment()];if(m<=127){const y=m+3,w=i[n.increment()],S=h+y;l.fill(w,h,S),h=S}else{const y=256-m;for(let w=0;w<y;w++)l[h++]=i[n.increment()]}}return l}const lg=new TextDecoder;function Qh(i,e,n){return n-e>=12?lg.decode(i.subarray(e,n)):(function(l,h,m){let y="",w=h;for(;w<m;){const S=l[w];let I,D,O,j=null,G=S>239?4:S>223?3:S>191?2:1;if(w+G>m)break;G===1?S<128&&(j=S):G===2?(I=l[w+1],(192&I)==128&&(j=(31&S)<<6|63&I,j<=127&&(j=null))):G===3?(I=l[w+1],D=l[w+2],(192&I)==128&&(192&D)==128&&(j=(15&S)<<12|(63&I)<<6|63&D,(j<=2047||j>=55296&&j<=57343)&&(j=null))):G===4&&(I=l[w+1],D=l[w+2],O=l[w+3],(192&I)==128&&(192&D)==128&&(192&O)==128&&(j=(15&S)<<18|(63&I)<<12|(63&D)<<6|63&O,(j<=65535||j>=1114112)&&(j=null))),j===null?(j=65533,G=1):j>65535&&(j-=65536,y+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),y+=String.fromCharCode(j),w+=G}return y})(i,e,n)}class am extends bu{offsetBuffer;constructor(e,n,l,h){super(e,l,h),this.offsetBuffer=n}}class ug extends am{textEncoder;constructor(e,n,l,h){super(e,n,l,h??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return Qh(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class uc extends am{indexBuffer;textEncoder;constructor(e,n,l,h,m){super(e,l,h,m??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return Qh(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class Zd extends am{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,l,h,m,y,w){super(e,l,h,w),this.indexBuffer=n,this.symbolOffsetBuffer=m,this.symbolTableBuffer=y,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(l,h,m){const y=[],w=new Array(h.length).fill(0);for(let S=1;S<h.length;S++)w[S]=w[S-1]+h[S-1];for(let S=0;S<m.length;S++)if(m[S]===255)y.push(m[++S]);else{const I=h[m[S]],D=w[m[S]];for(let O=0;O<I;O++)y.push(l[D+O])}return new Uint8Array(y)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return Qh(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let l=e[0];for(let h=1;h<e.length;h++){const m=e[h];n[h-1]=m-l,l=m}return n}}function Yd(i,e,n,l,h,m){return n.type==="scalarType"?(function(y,w,S,I,D,O){let j=null,G=0;if(y===0)return null;if(O.nullable){const W=Ja(w,S);G=W.numValues;const K=S.get(),ie=Qc(w,G,S);S.set(K+W.byteLength),j=new es(ie,W.numValues)}const H=j??I;switch(D.physicalType){case 4:case 3:return(function(W,K,ie,ye,ae){const le=Ja(W,K),we=Tu(le,ae,W,K),Me=ye.physicalType===3;if(we===ia.FLAT){const Ye=Kc(ae)?Vd(W,K,le,Me,ae):Fa(W,K,le,Me);return new Ld(ie.name,Ye,ae)}if(we===ia.SEQUENCE){const Ye=Jm(W,K,le);return new Hp(ie.name,Ye[0],Ye[1],le.numRleValues)}{const Ye=Qp(W,K,le,Me);return new Od(ie.name,Ye,ae)}})(w,S,O,D,H);case 9:return(function(W,K,ie,ye,ae){let le=null,we=null,Me=null,Ye=null,ct=null,it=null,gt=null,Ot=null;for(let yt=0;yt<ye;yt++){const ot=Ja(K,ie);if(ot.byteLength!==0)switch(ot.physicalStreamType){case ar.PRESENT:{const Ke=Qc(K,ot.numValues,ie);it=new es(Ke,ot.numValues);break}case ar.OFFSET:we=ae!=null||it!=null?Vd(K,ie,ot,!1,ae??it):Fa(K,ie,ot,!1);break;case ar.LENGTH:{const Ke=oc(K,ie,ot);Ka.DICTIONARY===ot.logicalStreamType.lengthType?le=Ke:Ka.SYMBOL===ot.logicalStreamType.lengthType?Ye=Ke:gt=Ke;break}case ar.DATA:{const Ke=K.subarray(ie.get(),ie.get()+ot.byteLength);ie.add(ot.byteLength);const Yt=ot.logicalStreamType.dictionaryType;zo.FSST===Yt?ct=Ke:zo.SINGLE===Yt||zo.SHARED===Yt?Me=Ke:zo.NONE===Yt&&(Ot=Ke);break}}}return(function(yt,ot,Ke,Yt,jt,Xt,Vt){return ot?new Zd(yt,Ke,Yt,jt,Xt,ot,Vt):null})(W,ct,we,le,Me,Ye,ae??it)??(function(yt,ot,Ke,Yt,jt){return ot?jt?new uc(yt,Ke,Yt,ot,jt):new uc(yt,Ke,Yt,ot):null})(W,Me,we,le,ae??it)??(function(yt,ot,Ke,Yt,jt){if(!ot||!Ke)return null;if(Yt)return jt?new uc(yt,Yt,ot,Ke,jt):new uc(yt,Yt,ot,Ke);if(jt&&jt.size()!==ot.length-1){const Xt=new Int32Array(jt.size());let Vt=0;for(let an=0;an<jt.size();an++)Xt[an]=jt.get(an)?Vt++:0;return new uc(yt,Xt,ot,Ke,jt)}return jt?new ug(yt,ot,Ke,jt):new ug(yt,ot,Ke)})(W,gt,Ot,we,ae??it)})(O.name,w,S,O.nullable?y-1:y,j);case 0:return(function(W,K,ie,ye,ae){const le=Ja(W,K),we=le.numValues,Me=K.get(),Ye=Kc(ae)?(function(it,gt,Ot,yt){const ot=rm(it,Math.ceil(gt/8),Ot),Ke=new es(ot,gt),Yt=yt.size(),jt=new es(new Uint8Array(Yt),Yt);let Xt=0;for(let Vt=0;Vt<yt.size();Vt++){const an=!!yt.get(Vt)&&Ke.get(Xt++);jt.set(Vt,an)}return jt.getBuffer()})(W,we,K,ae):Qc(W,we,K);K.set(Me+le.byteLength);const ct=new es(Ye,we);return new sg(ie.name,ct,ae)})(w,S,O,0,H);case 6:case 5:return(function(W,K,ie,ye,ae){const le=Ja(W,K),we=Tu(le,ye,W,K),Me=ae.physicalType===5;if(we===ia.FLAT){const Ye=Kc(ye)?(function(ct,it,gt,Ot,yt){return(function(ot,Ke,Yt,jt){switch(Ke.logicalLevelTechnique1){case On.DELTA:return Ke.logicalLevelTechnique2===On.RLE&&(ot=ro(ot,Ke.runs,Ke.numRleValues)),(function(Xt,Vt){const an=new BigInt64Array(Xt.size());let Kn=0;Xt.get(0)?(an[0]=Xt.get(0)?Vt[0]>>1n^-(1n&Vt[0]):0n,Kn=1):an[0]=0n;let Un=1;for(;Un!=an.length;++Un)an[Un]=Xt.get(Un)?an[Un-1]+(Vt[Kn]>>1n^-(1n&Vt[Kn++])):an[Un-1];return an})(jt,ot);case On.RLE:return(function(Xt,Vt,an,Kn){const Un=Vt;return an?(function(sr,ts,aa){const or=new BigInt64Array(sr.size());let Ji=0;for(let _i=0;_i<aa;_i++){const xr=Number(ts[_i]);let Lr=ts[_i+aa];Lr=Lr>>1n^-(1n&Lr);for(let Gi=Ji;Gi<Ji+xr;Gi++)sr.get(Gi)?or[Gi]=Lr:(or[Gi]=0n,Ji++);Ji+=xr}return or})(Kn,Xt,Un.runs):(function(sr,ts,aa){const or=new BigInt64Array(sr.size());let Ji=0;for(let _i=0;_i<aa;_i++){const xr=Number(ts[_i]),Lr=ts[_i+aa];for(let Gi=Ji;Gi<Ji+xr;Gi++)sr.get(Gi)?or[Gi]=Lr:(or[Gi]=0n,Ji++);Ji+=xr}return or})(Kn,Xt,Un.runs)})(ot,Ke,Yt,jt);case On.NONE:return ot=Yt?(function(Xt,Vt){const an=new BigInt64Array(Xt.size());let Kn=0,Un=0;for(;Un!=an.length;++Un)if(Xt.get(Un)){const sr=Vt[Kn++];an[Un]=sr>>1n^-(1n&sr)}else an[Un]=0n;return an})(jt,ot):(function(Xt,Vt){const an=new BigInt64Array(Xt.size());let Kn=0,Un=0;for(;Un!=an.length;++Un)an[Un]=Xt.get(Un)?Vt[Kn++]:0n;return an})(jt,ot),ot;default:throw new Error("The specified Logical level technique is not supported")}})(Nd(ct,it,gt.numValues),gt,Ot,yt)})(W,K,le,Me,ye):tg(W,K,le,Me);return new Yh(ie.name,Ye,ye)}if(we===ia.SEQUENCE){const Ye=eg(W,K,le);return new Kp(ie.name,Ye[0],Ye[1],le.numRleValues)}{const Ye=ng(W,K,le,Me);return new im(ie.name,Ye,ye)}})(w,S,O,H,D);case 7:return(function(W,K,ie,ye){const ae=Ja(W,K),le=Kc(ye)?(function(we,Me,Ye,ct){const it=Me.get(),gt=it+ct*Float32Array.BYTES_PER_ELEMENT,Ot=new Uint8Array(we.subarray(it,gt)).buffer,yt=new Float32Array(Ot);Me.set(gt);const ot=Ye.size(),Ke=new Float32Array(ot);let Yt=0;for(let jt=0;jt<ot;jt++)Ke[jt]=Ye.get(jt)?yt[Yt++]:0;return Ke})(W,K,ye,ae.numValues):(function(we,Me,Ye){const ct=Me.get(),it=ct+Ye*Float32Array.BYTES_PER_ELEMENT,gt=new Uint8Array(we.subarray(ct,it)).buffer,Ot=new Float32Array(gt);return Me.set(it),Ot})(W,K,ae.numValues);return new og(ie.name,le,ye)})(w,S,O,H);case 8:return(function(W,K,ie,ye){const ae=Ja(W,K),le=Kc(ye)?(function(we,Me,Ye,ct){const it=Me.get(),gt=it+ct*Float64Array.BYTES_PER_ELEMENT,Ot=new Uint8Array(we.subarray(it,gt)).buffer,yt=new Float64Array(Ot);Me.set(gt);const ot=Ye.size(),Ke=new Float64Array(ot);let Yt=0;for(let jt=0;jt<ot;jt++)Ke[jt]=Ye.get(jt)?yt[Yt++]:0;return Ke})(W,K,ye,ae.numValues):(function(we,Me,Ye){const ct=Me.get(),it=ct+Ye*Float64Array.BYTES_PER_ELEMENT,gt=new Uint8Array(we.subarray(ct,it)).buffer,Ot=new Float64Array(gt);return Me.set(it),Ot})(W,K,ae.numValues);return new Zf(ie.name,le,ye)})(w,S,O,H);default:throw new Error(`The specified data type for the field is currently not supported: ${D}`)}})(l,i,e,h,n.scalarType,n):l!=1?null:(function(y,w,S,I){let D=null,O=null,j=null,G=null,H=!1;for(;!H;){const ye=Ja(y,w);switch(ye.physicalStreamType){case ar.LENGTH:Ka.DICTIONARY===ye.logicalStreamType.lengthType?D=oc(y,w,ye):j=oc(y,w,ye);break;case ar.DATA:zo.SINGLE===ye.logicalStreamType.dictionaryType||zo.SHARED===ye.logicalStreamType.dictionaryType?(O=y.subarray(w.get(),w.get()+ye.byteLength),H=!0):G=y.subarray(w.get(),w.get()+ye.byteLength),w.add(ye.byteLength)}}const W=S.complexType.children,K=[];let ie=0;for(const ye of W){const ae=jr(y,w,1)[0];if(ae==0)continue;const le=`${S.name}${ye.name==="default"?"":":"+ye.name}`;if(ae!==2||ye.type!=="scalarField"||ye.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const we=Ja(y,w),Me=Qc(y,we.numValues,w),Ye=Ja(y,w),ct=Ye.decompressedCount!==I?Vd(y,w,Ye,!1,new es(Me,we.numValues)):Fa(y,w,Ye,!1);K[ie++]=G?new Zd(le,ct,D,O,j,G,new es(Me,we.numValues)):new uc(le,ct,D,O,new es(Me,we.numValues))}return K})(i,e,n,h)}function Kc(i){return i instanceof es}function cg(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const sm=new TextDecoder;function Su(i,e){const n=jr(i,e,1)[0];if(n===0)return"";const l=e.get(),h=i.subarray(l,l+n);return e.add(n),sm.decode(h)}function Eu(i,e){const n=jr(i,e,1)[0]>>>0,l=!!(4&n),h=!!(2&n),m=jr(i,e,1)[0]>>>0,y={};if(1&n&&(y.nullable=!0),h){const w={};if(l?(w.type="logicalType",w.logicalType=m):(w.type="physicalType",w.physicalType=m),8&n){const S=jr(i,e,1)[0]>>>0;w.children=new Array(S);for(let I=0;I<S;I++)w.children[I]=Eu(i,e)}y.type="complexField",y.complexField=w}else{const w={};l?(w.type="logicalType",w.logicalType=m):(w.type="physicalType",w.physicalType=m),y.type="scalarField",y.scalarField=w}return y}function cc(i,e){const n=jr(i,e,1)[0]>>>0,l=(function(h){switch(h){case 0:case 1:case 2:case 3:{const m={};m.nullable=!!(1&h),m.columnScope=0;const y={};return y.physicalType=h>1?6:4,y.type="physicalType",m.scalarType=y,m.type="scalarType",m}case 4:{const m={nullable:!1,columnScope:0},y={type:"physicalType",physicalType:0};return m.type="complexType",m.complexType=y,m}case 30:{const m={nullable:!1,columnScope:0},y={type:"physicalType",physicalType:1};return m.type="complexType",m.complexType=y,m}default:return(function(m){let y=null;switch(m){case 10:case 11:y=0;break;case 12:case 13:y=1;break;case 14:case 15:y=2;break;case 16:case 17:y=3;break;case 18:case 19:y=4;break;case 20:case 21:y=5;break;case 22:case 23:y=6;break;case 24:case 25:y=7;break;case 26:case 27:y=8;break;case 28:case 29:y=9;break;default:return null}const w={};w.nullable=!!(1&m),w.columnScope=0;const S={type:"physicalType"};return S.physicalType=y,w.type="scalarType",w.scalarType=S,w})(h)}})(n);if(!l)throw new Error(`Unsupported column type code: ${n}`);if((function(h){return h>=10})(n)?l.name=Su(i,e):n>=0&&n<=3?l.name="id":n===4&&(l.name="geometry"),(function(h){return h===30})(n)){const h=jr(i,e,1)[0]>>>0,m=l.complexType;m.children=new Array(h);for(let y=0;y<h;y++)m.children[y]=Eu(i,e)}return l}function Wf(i,e){const n={featureTables:[]},l={};l.name=Su(i,e);const h=jr(i,e,1)[0]>>>0,m=jr(i,e,1)[0]>>>0;l.columns=new Array(m);for(let y=0;y<m;y++)l.columns[y]=cc(i,e);return n.featureTables.push(l),[n,h]}function Qf(i,e,n,l,h,m,y=!1){const w=e.scalarType.physicalType,S=Tu(h,m,i,n);if(w===4)switch(S){case ia.FLAT:{const I=Fa(i,n,h,!1);return new Ld(l,I,m)}case ia.SEQUENCE:{const I=Jm(i,n,h);return new Hp(l,I[0],I[1],h.numRleValues)}case ia.CONST:{const I=Qp(i,n,h,!1);return new Od(l,I,m)}}else switch(S){case ia.FLAT:{if(y){const D=(function(O,j,G,H){const W=(function(K,ie,ye){const ae=new Float64Array(ie);for(let le=0;le<ie;le++)ae[le]=Oo(K,ye);return ae})(O,G.numValues,j);return(function(K,ie,ye){switch(ie.logicalLevelTechnique1){case On.DELTA:return ie.logicalLevelTechnique2===On.RLE&&(K=$p(K,ie.runs,ie.numRleValues)),(function(ae){ae[0]=ae[0]%2==1?(ae[0]+1)/-2:ae[0]/2;const le=ae.length/4*4;let we=1;if(le>=4)for(;we<le-4;we+=4){const Me=ae[we],Ye=ae[we+1],ct=ae[we+2],it=ae[we+3];ae[we]=(Me%2==1?(Me+1)/-2:Me/2)+ae[we-1],ae[we+1]=(Ye%2==1?(Ye+1)/-2:Ye/2)+ae[we],ae[we+2]=(ct%2==1?(ct+1)/-2:ct/2)+ae[we+1],ae[we+3]=(it%2==1?(it+1)/-2:it/2)+ae[we+2]}for(;we!=ae.length;++we)ae[we]=(ae[we]%2==1?(ae[we]+1)/-2:ae[we]/2)+ae[we-1]})(K),K;case On.RLE:return(function(ae,le,we){return $p(ae,le.runs,le.numRleValues)})(K,ie);case On.NONE:return K;default:throw new Error(`The specified Logical level technique is not supported: ${ie.logicalLevelTechnique1}`)}})(W,G)})(i,n,h);return new Zf(l,D,m)}const I=tg(i,n,h,!1);return new Yh(l,I,m)}case ia.SEQUENCE:{const I=eg(i,n,h);return new Kp(l,I[0],I[1],h.numRleValues)}case ia.CONST:{const I=ng(i,n,h,!1);return new im(l,I,m)}}throw new Error("Vector type not supported for id column.")}class hc{constructor(e,n){var l;switch(this._featureData=e,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case ra.POINT:case ra.MULTIPOINT:this.type=1;break;case ra.LINESTRING:case ra.MULTILINESTRING:this.type=2;break;case ra.POLYGON:case ra.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const l=[];for(const h of n)l.push(new ue(h.x,h.y));e.push(l)}return e}}class Kg{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new hc(this.features[e],this.extent)}}class om{constructor(e){this.layers={};const n=(function(l,h,m=!0){const y=new Qm(0),w=[];for(;y.get()<l.length;){const S=jr(l,y,1)[0]>>>0,I=y.get()+S;if(I>l.length)throw new Error(`Block overruns tile: ${I} > ${l.length}`);if(jr(l,y,1)[0]>>>0!=1){y.set(I);continue}const D=Wf(l,y),O=D[1],j=D[0].featureTables[0];let G=null,H=null;const W=[];let K=0;for(const ye of j.columns){const ae=ye.name;if(ae==="id"){let le=null;if(ye.nullable){const Me=Ja(l,y),Ye=y.get(),ct=Qc(l,Me.numValues,y);y.set(Ye+Me.byteLength),le=new es(ct,Me.numValues)}const we=Ja(l,y);K=we.decompressedCount,G=Qf(l,ye,y,ae,we,le??K,m)}else if(ae==="geometry"){const le=jr(l,y,1)[0];if(K===0){const we=y.get();K=Ja(l,y).decompressedCount,y.set(we)}H=$f(l,le,y,K)}else{const le=cg(ye)?jr(l,y,1)[0]:1;if(le===0&&ye.type==="scalarType")continue;const we=Yd(l,y,ye,le,K);if(we)if(Array.isArray(we))for(const Me of we)W.push(Me);else W.push(we)}}const ie=new Wg(j.name,H,G,W,O);w.push(ie),y.set(I)}return w})(new Uint8Array(e));this.layers=n.reduce(((l,h)=>Object.assign(Object.assign({},l),{[h.name]:new Kg(h)})),{})}}class fl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new fl;return n.extend(e(new ue(this.minX,this.minY))),n.extend(e(new ue(this.maxX,this.minY))),n.extend(e(new ue(this.minX,this.maxY))),n.extend(e(new ue(this.maxX,this.maxY))),n}static fromPoints(e){const n=new fl;for(const l of e)n.extend(l);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class Jg{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of n){const h=[];for(const m of l)h.push(new ue(m[0],m[1]));e.push(h)}return e}}const Kh="_geojsonTileLayer";function Hd(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let m=0;m<i.length;m++)n.feature=i.feature(m),e.writeMessage(2,hg,n);const l=n.keys;for(const m of l)e.writeStringField(3,m);const h=n.values;for(const m of h)e.writeMessage(4,ef,m)}function hg(i,e){if(!i.feature)return;const n=i.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,e_,i),e.writeVarintField(3,n.type),e.writeMessage(4,fg,n)}function e_(i,e){for(const n in i.feature?.properties){let l=i.feature.properties[n],h=i.keycache[n];if(l===null)continue;h===void 0&&(i.keys.push(n),h=i.keys.length-1,i.keycache[n]=h),e.writeVarint(h),typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"&&(l=JSON.stringify(l));const m=typeof l+":"+l;let y=i.valuecache[m];y===void 0&&(i.values.push(l),y=i.values.length-1,i.valuecache[m]=y),e.writeVarint(y)}}function Jh(i,e){return(e<<3)+(7&i)}function Kf(i){return i<<1^i>>31}function fg(i,e){const n=i.loadGeometry(),l=i.type;let h=0,m=0;for(const y of n){let w=1;l===1&&(w=y.length),e.writeVarint(Jh(1,w));const S=l===3?y.length-1:y.length;for(let I=0;I<S;I++){I===1&&l!==1&&e.writeVarint(Jh(2,S-1));const D=y[I].x-h,O=y[I].y-m;e.writeVarint(Kf(D)),e.writeVarint(Kf(O)),h+=D,m+=O}i.type===3&&e.writeVarint(Jh(7,1))}}function ef(i,e){const n=typeof i;n==="string"?e.writeStringField(1,i):n==="boolean"?e.writeBooleanField(7,i):n==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class lm{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Il(Ht,16,0),this.grid3D=new Il(Ht,16,0),this.featureIndexArray=new Z,this.promoteId=n}insert(e,n,l,h,m,y){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,m);const S=y?this.grid3D:this.grid;for(let I=0;I<n.length;I++){const D=n[I],O=[1/0,1/0,-1/0,-1/0];for(let j=0;j<D.length;j++){const G=D[j];O[0]=Math.min(O[0],G.x),O[1]=Math.min(O[1],G.y),O[2]=Math.max(O[2],G.x),O[3]=Math.max(O[3],G.y)}O[0]<Ht&&O[1]<Ht&&O[2]>=0&&O[3]>=0&&S.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new di(new Lf(this.rawTileData)).layers:new om(this.rawTileData).layers,this.sourceLayerCoder=new Pd(this.vtLayers?Object.keys(this.vtLayers).sort():[Kh])),this.vtLayers}query(e,n,l,h){this.loadVTLayers();const m=e.params,y=Ht/e.tileSize/e.scale,w=Ya(m.filter,m.globalState),S=e.queryGeometry,I=e.queryPadding*y,D=fl.fromPoints(S),O=this.grid.query(D.minX-I,D.minY-I,D.maxX+I,D.maxY+I),j=fl.fromPoints(e.cameraQueryGeometry).expandBy(I),G=this.grid3D.query(j.minX,j.minY,j.maxX,j.maxY,((K,ie,ye,ae)=>(function(le,we,Me,Ye,ct){for(const gt of le)if(we<=gt.x&&Me<=gt.y&&Ye>=gt.x&&ct>=gt.y)return!0;const it=[new ue(we,Me),new ue(we,ct),new ue(Ye,ct),new ue(Ye,Me)];if(le.length>2){for(const gt of it)if(Vc(le,gt))return!0}for(let gt=0;gt<le.length-1;gt++)if(bm(le[gt],le[gt+1],it))return!0;return!1})(e.cameraQueryGeometry,K-I,ie-I,ye+I,ae+I)));for(const K of G)O.push(K);O.sort($d);const H={};let W;for(let K=0;K<O.length;K++){const ie=O[K];if(ie===W)continue;W=ie;const ye=this.featureIndexArray.get(ie);let ae=null;this.loadMatchingFeature(H,ye.bucketIndex,ye.sourceLayerIndex,ye.featureIndex,w,m.layers,m.availableImages,n,l,h,((le,we,Me)=>(ae||(ae=_s(le)),we.queryIntersectsFeature({queryGeometry:S,feature:le,featureState:Me,geometry:ae,zoom:this.z,transform:e.transform,pixelsToTileUnits:y,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return H}loadMatchingFeature(e,n,l,h,m,y,w,S,I,D,O){const j=this.bucketLayerIDs[n];if(y&&!j.some((K=>y.has(K))))return;const G=this.sourceLayerCoder.decode(l),H=this.vtLayers[G].feature(h);if(m.needGeometry){const K=zl(H,!0);if(!m.filter(new qn(this.tileID.overscaledZ),K,this.tileID.canonical))return}else if(!m.filter(new qn(this.tileID.overscaledZ),H))return;const W=this.getId(H,G);for(let K=0;K<j.length;K++){const ie=j[K];if(y&&!y.has(ie))continue;const ye=S[ie];if(!ye)continue;let ae={};W&&D&&(ae=D.getState(ye.sourceLayer||Kh,W));const le=Ue({},I[ie]);le.paint=Xd(le.paint,ye.paint,H,ae,w),le.layout=Xd(le.layout,ye.layout,H,ae,w);const we=!O||O(H,ye,ae);if(!we)continue;const Me=new Rd(H,this.z,this.x,this.y,W);Me.layer=le;let Ye=e[ie];Ye===void 0&&(Ye=e[ie]=[]),Ye.push({featureIndex:h,feature:Me,intersectionZ:we})}}lookupSymbolFeatures(e,n,l,h,m,y,w,S){const I={};this.loadVTLayers();const D=Ya(m.filterSpec,m.globalState);for(const O of e)this.loadMatchingFeature(I,l,h,O,D,y,w,S,n);return I}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){var l;let h=e.id;return this.promoteId&&(h=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof h=="boolean"&&(h=Number(h)),h===void 0&&(!((l=e.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(h=Number(e.properties.cluster_id))),h}}function Xd(i,e,n,l,h){return Ln(i,((m,y)=>{const w=e instanceof lu?e.get(y):null;return w&&w.evaluate?w.evaluate(n,l,h):w}))}function $d(i,e){return e-i}function um(i,e,n,l,h){const m=[];for(let y=0;y<i.length;y++){const w=i[y];let S;for(let I=0;I<w.length-1;I++){let D=w[I],O=w[I+1];D.x<e&&O.x<e||(D.x<e?D=new ue(e,D.y+(e-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x<e&&(O=new ue(e,D.y+(e-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y<n&&O.y<n||(D.y<n?D=new ue(D.x+(n-D.y)/(O.y-D.y)*(O.x-D.x),n)._round():O.y<n&&(O=new ue(D.x+(n-D.y)/(O.y-D.y)*(O.x-D.x),n)._round()),D.x>=l&&O.x>=l||(D.x>=l?D=new ue(l,D.y+(l-D.x)/(O.x-D.x)*(O.y-D.y))._round():O.x>=l&&(O=new ue(l,D.y+(l-D.x)/(O.x-D.x)*(O.y-D.y))._round()),D.y>=h&&O.y>=h||(D.y>=h?D=new ue(D.x+(h-D.y)/(O.y-D.y)*(O.x-D.x),h)._round():O.y>=h&&(O=new ue(D.x+(h-D.y)/(O.y-D.y)*(O.x-D.x),h)._round()),S&&D.equals(S[S.length-1])||(S=[D],m.push(S)),S.push(O)))))}}return m}function dg(i,e,n,l,h){switch(e){case 1:return(function(m,y,w,S){const I=[];for(const D of m)for(const O of D){const j=S===0?O.x:O.y;j>=y&&j<=w&&I.push([O])}return I})(i,n,l,h);case 2:return r(i,n,l,h,!1);case 3:return r(i,n,l,h,!0)}return[]}function Wd(i,e,n,l,h){const m=l===0?s:d;let y=[];const w=[];for(let D=0;D<i.length-1;D++){const O=i[D],j=i[D+1],G=l===0?O.x:O.y,H=l===0?j.x:j.y;let W=!1;G<e?H>e&&y.push(m(O,j,e)):G>n?H<n&&y.push(m(O,j,n)):y.push(O),H<e&&G>=e&&(y.push(m(O,j,e)),W=!0),H>n&&G<=n&&(y.push(m(O,j,n)),W=!0),!h&&W&&(w.push(y),y=[])}const S=i.length-1,I=l===0?i[S].x:i[S].y;return I>=e&&I<=n&&y.push(i[S]),h&&y.length>0&&!y[0].equals(y[y.length-1])&&y.push(new ue(y[0].x,y[0].y)),y.length>0&&w.push(y),w}function r(i,e,n,l,h){const m=[];for(const y of i){const w=Wd(y,e,n,l,h);w.length>0&&m.push(...w)}return m}function s(i,e,n){return new ue(n,i.y+(n-i.x)/(e.x-i.x)*(e.y-i.y))}function d(i,e,n){return new ue(i.x+(n-i.y)/(e.y-i.y)*(e.x-i.x),n)}Bt("FeatureIndex",lm,{omit:["rawTileData","sourceLayerCoder"]});class x extends ue{constructor(e,n,l,h){super(e,n),this.angle=l,h!==void 0&&(this.segment=h)}clone(){return new x(this.x,this.y,this.angle,this.segment)}}function M(i,e,n,l,h){if(e.segment===void 0||n===0)return!0;let m=e,y=e.segment+1,w=0;for(;w>-n/2;){if(y--,y<0)return!1;w-=i[y].dist(m),m=i[y]}w+=i[y].dist(i[y+1]),y++;const S=[];let I=0;for(;w<n/2;){const D=i[y],O=i[y+1];if(!O)return!1;let j=i[y-1].angleTo(D)-D.angleTo(O);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:w,angleDelta:j}),I+=j;w-S[0].distance>l;)I-=S.shift().angleDelta;if(I>h)return!1;y++,w+=D.dist(O)}return!0}function k(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function X(i,e,n){return i?.6*e*n:0}function se(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function ke(i,e,n,l,h,m){const y=X(n,h,m),w=se(n,l)*m;let S=0;const I=k(i)/2;for(let D=0;D<i.length-1;D++){const O=i[D],j=i[D+1],G=O.dist(j);if(S+G>I){const H=(I-S)/G,W=Di.number(O.x,j.x,H),K=Di.number(O.y,j.y,H),ie=new x(W,K,j.angleTo(O),D);return ie._round(),!y||M(i,ie,w,y,e)?ie:void 0}S+=G}}function tt(i,e,n,l,h,m,y,w,S){const I=X(l,m,y),D=se(l,h),O=D*y,j=i[0].x===0||i[0].x===S||i[0].y===0||i[0].y===S;return e-O<e/4&&(e=O+e/4),ft(i,j?e/2*w%e:(D/2+2*m)*y*w%e,e,I,n,O,j,!1,S)}function ft(i,e,n,l,h,m,y,w,S){const I=m/2,D=k(i);let O=0,j=e-n,G=[];for(let H=0;H<i.length-1;H++){const W=i[H],K=i[H+1],ie=W.dist(K),ye=K.angleTo(W);for(;j+n<O+ie;){j+=n;const ae=(j-O)/ie,le=Di.number(W.x,K.x,ae),we=Di.number(W.y,K.y,ae);if(le>=0&&le<S&&we>=0&&we<S&&j-I>=0&&j+I<=D){const Me=new x(le,we,ye,H);Me._round(),l&&!M(i,Me,m,l,h)||G.push(Me)}}O+=ie}return w||G.length||y||(G=ft(i,O/2,n,l,h,m,y,!0,S)),G}function wt(i,e,n,l){const h=[],m=i.image,y=m.pixelRatio,w=m.paddedRect.w-2,S=m.paddedRect.h-2;let I={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const D=m.stretchX||[[0,w]],O=m.stretchY||[[0,S]],j=(Ke,Yt)=>Ke+Yt[1]-Yt[0],G=D.reduce(j,0),H=O.reduce(j,0),W=w-G,K=S-H;let ie=0,ye=G,ae=0,le=H,we=0,Me=W,Ye=0,ct=K;if(m.content&&l){const Ke=m.content,Yt=Ke[2]-Ke[0],jt=Ke[3]-Ke[1];(m.textFitWidth||m.textFitHeight)&&(I=Ed(i)),ie=nt(D,0,Ke[0]),ae=nt(O,0,Ke[1]),ye=nt(D,Ke[0],Ke[2]),le=nt(O,Ke[1],Ke[3]),we=Ke[0]-ie,Ye=Ke[1]-ae,Me=Yt-ye,ct=jt-le}const it=I.x1,gt=I.y1,Ot=I.x2-it,yt=I.y2-gt,ot=(Ke,Yt,jt,Xt)=>{const Vt=tn(Ke.stretch-ie,ye,Ot,it),an=wn(Ke.fixed-we,Me,Ke.stretch,G),Kn=tn(Yt.stretch-ae,le,yt,gt),Un=wn(Yt.fixed-Ye,ct,Yt.stretch,H),sr=tn(jt.stretch-ie,ye,Ot,it),ts=wn(jt.fixed-we,Me,jt.stretch,G),aa=tn(Xt.stretch-ae,le,yt,gt),or=wn(Xt.fixed-Ye,ct,Xt.stretch,H),Ji=new ue(Vt,Kn),_i=new ue(sr,Kn),xr=new ue(sr,aa),Lr=new ue(Vt,aa),Gi=new ue(an/y,Un/y),ao=new ue(ts/y,or/y),ns=e*Math.PI/180;if(ns){const Sa=Math.sin(ns),dr=Math.cos(ns),sa=[dr,-Sa,Sa,dr];Ji._matMult(sa),_i._matMult(sa),Lr._matMult(sa),xr._matMult(sa)}const so=Ke.stretch+Ke.fixed,Vl=Yt.stretch+Yt.fixed;return{tl:Ji,tr:_i,bl:Lr,br:xr,tex:{x:m.paddedRect.x+1+so,y:m.paddedRect.y+1+Vl,w:jt.stretch+jt.fixed-so,h:Xt.stretch+Xt.fixed-Vl},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Gi,pixelOffsetBR:ao,minFontScaleX:Me/y/Ot,minFontScaleY:ct/y/yt,isSDF:n}};if(l&&(m.stretchX||m.stretchY)){const Ke=st(D,W,G),Yt=st(O,K,H);for(let jt=0;jt<Ke.length-1;jt++){const Xt=Ke[jt],Vt=Ke[jt+1];for(let an=0;an<Yt.length-1;an++)h.push(ot(Xt,Yt[an],Vt,Yt[an+1]))}}else h.push(ot({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:S+1}));return h}function nt(i,e,n){let l=0;for(const h of i)l+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return l}function st(i,e,n){const l=[{fixed:-1,stretch:0}];for(const[h,m]of i){const y=l[l.length-1];l.push({fixed:h-y.stretch,stretch:y.stretch}),l.push({fixed:h-y.stretch,stretch:y.stretch+(m-h)})}return l.push({fixed:e+1,stretch:n}),l}function tn(i,e,n,l){return i/e*n+l}function wn(i,e,n,l){return i-e*n/l}Bt("Anchor",x);class Mi{constructor(e,n,l,h,m,y,w,S,I,D){var O;if(this.boxStartIndex=e.length,I){let j=y.top,G=y.bottom;const H=y.collisionPadding;H&&(j-=H[1],G+=H[3]);let W=G-j;W>0&&(W=Math.max(10,W),this.circleDiameter=W)}else{const j=!((O=y.image)===null||O===void 0)&&O.content&&(y.image.textFitWidth||y.image.textFitHeight)?Ed(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};j.y1=j.y1*w-S[0],j.y2=j.y2*w+S[2],j.x1=j.x1*w-S[3],j.x2=j.x2*w+S[1];const G=y.collisionPadding;if(G&&(j.x1-=G[0]*w,j.y1-=G[1]*w,j.x2+=G[2]*w,j.y2+=G[3]*w),D){const H=new ue(j.x1,j.y1),W=new ue(j.x2,j.y1),K=new ue(j.x1,j.y2),ie=new ue(j.x2,j.y2),ye=D*Math.PI/180;H._rotate(ye),W._rotate(ye),K._rotate(ye),ie._rotate(ye),j.x1=Math.min(H.x,W.x,K.x,ie.x),j.x2=Math.max(H.x,W.x,K.x,ie.x),j.y1=Math.min(H.y,W.y,K.y,ie.y),j.y2=Math.max(H.y,W.y,K.y,ie.y)}e.emplaceBack(n.x,n.y,j.x1,j.y1,j.x2,j.y2,l,h,m)}this.boxEndIndex=e.length}}class qe{constructor(e=[],n=(l,h)=>l<h?-1:l>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,h=n[e];for(;e>0;){const m=e-1>>1,y=n[m];if(l(h,y)>=0)break;n[e]=y,e=m}n[e]=h}_down(e){const{data:n,compare:l}=this,h=this.length>>1,m=n[e];for(;e<h;){let y=1+(e<<1);const w=y+1;if(w<this.length&&l(n[w],n[y])<0&&(y=w),l(n[y],m)>=0)break;n[e]=n[y],e=y}n[e]=m}}function Ne(i,e=1,n=!1){const l=fl.fromPoints(i[0]),h=Math.min(l.width(),l.height());let m=h/2;const y=new qe([],et),{minX:w,minY:S,maxX:I,maxY:D}=l;if(h===0)return new ue(w,S);for(let G=w;G<I;G+=h)for(let H=S;H<D;H+=h)y.push(new pt(G+m,H+m,m,i));let O=(function(G){let H=0,W=0,K=0;const ie=G[0];for(let ye=0,ae=ie.length,le=ae-1;ye<ae;le=ye++){const we=ie[ye],Me=ie[le],Ye=we.x*Me.y-Me.x*we.y;W+=(we.x+Me.x)*Ye,K+=(we.y+Me.y)*Ye,H+=3*Ye}return new pt(W/H,K/H,0,G)})(i),j=y.length;for(;y.length;){const G=y.pop();(G.d>O.d||!O.d)&&(O=G,n&&console.log("found best %d after %d probes",Math.round(1e4*G.d)/1e4,j)),G.max-O.d<=e||(m=G.h/2,y.push(new pt(G.p.x-m,G.p.y-m,m,i)),y.push(new pt(G.p.x+m,G.p.y-m,m,i)),y.push(new pt(G.p.x-m,G.p.y+m,m,i)),y.push(new pt(G.p.x+m,G.p.y+m,m,i)),j+=4)}return n&&(console.log(`num probes: ${j}`),console.log(`best distance: ${O.d}`)),O.p}function et(i,e){return e.max-i.max}function pt(i,e,n,l){this.p=new ue(i,e),this.h=n,this.d=(function(h,m){let y=!1,w=1/0;for(let S=0;S<m.length;S++){const I=m[S];for(let D=0,O=I.length,j=O-1;D<O;j=D++){const G=I[D],H=I[j];G.y>h.y!=H.y>h.y&&h.x<(H.x-G.x)*(h.y-G.y)/(H.y-G.y)+G.x&&(y=!y),w=Math.min(w,wa(h,G,H))}}return(y?1:-1)*Math.sqrt(w)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var Jt;L.aQ=void 0,(Jt=L.aQ||(L.aQ={}))[Jt.center=1]="center",Jt[Jt.left=2]="left",Jt[Jt.right=3]="right",Jt[Jt.top=4]="top",Jt[Jt.bottom=5]="bottom",Jt[Jt["top-left"]=6]="top-left",Jt[Jt["top-right"]=7]="top-right",Jt[Jt["bottom-left"]=8]="bottom-left",Jt[Jt["bottom-right"]=9]="bottom-right";const ai=Number.POSITIVE_INFINITY;function hn(i,e){return e[1]!==ai?(function(n,l,h){let m=0,y=0;switch(l=Math.abs(l),h=Math.abs(h),n){case"top-right":case"top-left":case"top":y=h-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-h}switch(n){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}return[m,y]})(i,e[0],e[1]):(function(n,l){let h=0,m=0;l<0&&(l=0);const y=l/Math.SQRT2;switch(n){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-l;break;case"top":m=l-7}switch(n){case"top-right":case"bottom-right":h=-y;break;case"top-left":case"bottom-left":h=y;break;case"left":h=l;break;case"right":h=-l}return[h,m]})(i,e[0])}function Nn(i,e,n){var l;const h=i.layout,m=(l=h.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},n);if(m){const w=m.values,S=[];for(let I=0;I<w.length;I+=2){const D=S[I]=w[I],O=w[I+1].map((j=>j*pi));D.startsWith("top")?O[1]-=7:D.startsWith("bottom")&&(O[1]+=7),S[I+1]=O}return new Li(S)}const y=h.get("text-variable-anchor");if(y){let w;w=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(e,{},n)*pi,ai]:h.get("text-offset").evaluate(e,{},n).map((I=>I*pi));const S=[];for(const I of y)S.push(I,hn(I,w));return new Li(S)}return null}function Hn(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gi(i,e,n,l,h,m,y,w,S,I,D,O){let j=m.textMaxSize.evaluate(e,{});j===void 0&&(j=y);const G=i.layers[0].layout,H=G.get("icon-offset").evaluate(e,{},D),W=pg(n.horizontal),K=y/24,ie=i.tilePixelRatio*K,ye=i.tilePixelRatio*j/24,ae=i.tilePixelRatio*w,le=i.tilePixelRatio*G.get("symbol-spacing"),we=G.get("text-padding")*i.tilePixelRatio,Me=(function(jt,Xt,Vt,an=1){const Kn=jt.get("icon-padding").evaluate(Xt,{},Vt),Un=Kn&&Kn.values;return[Un[0]*an,Un[1]*an,Un[2]*an,Un[3]*an]})(G,e,D,i.tilePixelRatio),Ye=G.get("text-max-angle")/180*Math.PI,ct=G.get("text-rotation-alignment")!=="viewport"&&G.get("symbol-placement")!=="point",it=G.get("icon-rotation-alignment")==="map"&&G.get("symbol-placement")!=="point",gt=G.get("symbol-placement"),Ot=le/2,yt=G.get("icon-text-fit");let ot;l&&yt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(ot=Of(l,n.vertical,yt,G.get("icon-text-fit-padding"),H,K)),W&&(l=Of(l,W,yt,G.get("icon-text-fit-padding"),H,K)));const Ke=D?O.line.getGranularityForZoomLevel(D.z):1,Yt=(jt,Xt)=>{Xt.x<0||Xt.x>=Ht||Xt.y<0||Xt.y>=Ht||(function(Vt,an,Kn,Un,sr,ts,aa,or,Ji,_i,xr,Lr,Gi,ao,ns,so,Vl,Sa,dr,sa,br,Ea,Jc,Cu,fm){const tf=Vt.addToLineVertexArray(an,Kn);let Jf,Qd,Kd,Jd,P_=0,R_=0,L_=0,z_=0,l_=-1,u_=-1;const eh={};let O_=Pi("");if(Vt.allowVerticalPlacement&&Un.vertical){const bs=or.layout.get("text-rotate").evaluate(br,{},Cu)+90;Kd=new Mi(Ji,an,_i,xr,Lr,Un.vertical,Gi,ao,ns,bs),aa&&(Jd=new Mi(Ji,an,_i,xr,Lr,aa,Vl,Sa,ns,bs))}if(sr){const bs=or.layout.get("icon-rotate").evaluate(br,{}),dl=or.layout.get("icon-text-fit")!=="none",ed=wt(sr,bs,Jc,dl),Au=aa?wt(aa,bs,Jc,dl):void 0;Qd=new Mi(Ji,an,_i,xr,Lr,sr,Vl,Sa,!1,bs),P_=4*ed.length;const td=Vt.iconSizeData;let fc=null;td.kind==="source"?(fc=[ul*or.layout.get("icon-size").evaluate(br,{})],fc[0]>ys&&vi(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):td.kind==="composite"&&(fc=[ul*Ea.compositeIconSizes[0].evaluate(br,{},Cu),ul*Ea.compositeIconSizes[1].evaluate(br,{},Cu)],(fc[0]>ys||fc[1]>ys)&&vi(`${Vt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Vt.addSymbols(Vt.icon,ed,fc,sa,dr,br,L.aA.none,an,tf.lineStartIndex,tf.lineLength,-1,Cu),l_=Vt.icon.placedSymbolArray.length-1,Au&&(R_=4*Au.length,Vt.addSymbols(Vt.icon,Au,fc,sa,dr,br,L.aA.vertical,an,tf.lineStartIndex,tf.lineLength,-1,Cu),u_=Vt.icon.placedSymbolArray.length-1)}const N_=Object.keys(Un.horizontal);for(const bs of N_){const dl=Un.horizontal[bs];if(!Jf){O_=Pi(dl.text);const Au=or.layout.get("text-rotate").evaluate(br,{},Cu);Jf=new Mi(Ji,an,_i,xr,Lr,dl,Gi,ao,ns,Au)}const ed=dl.positionedLines.length===1;if(L_+=Mu(Vt,an,dl,ts,or,ns,br,so,tf,Un.vertical?L.aA.horizontal:L.aA.horizontalOnly,ed?N_:[bs],eh,l_,Ea,Cu),ed)break}Un.vertical&&(z_+=Mu(Vt,an,Un.vertical,ts,or,ns,br,so,tf,L.aA.vertical,["vertical"],eh,u_,Ea,Cu));const av=Jf?Jf.boxStartIndex:Vt.collisionBoxArray.length,sv=Jf?Jf.boxEndIndex:Vt.collisionBoxArray.length,ov=Kd?Kd.boxStartIndex:Vt.collisionBoxArray.length,lv=Kd?Kd.boxEndIndex:Vt.collisionBoxArray.length,uv=Qd?Qd.boxStartIndex:Vt.collisionBoxArray.length,cv=Qd?Qd.boxEndIndex:Vt.collisionBoxArray.length,hv=Jd?Jd.boxStartIndex:Vt.collisionBoxArray.length,fv=Jd?Jd.boxEndIndex:Vt.collisionBoxArray.length;let Iu=-1;const gg=(bs,dl)=>bs&&bs.circleDiameter?Math.max(bs.circleDiameter,dl):dl;Iu=gg(Jf,Iu),Iu=gg(Kd,Iu),Iu=gg(Qd,Iu),Iu=gg(Jd,Iu);const B_=Iu>-1?1:0;B_&&(Iu*=fm/pi),Vt.glyphOffsetArray.length>=rc.MAX_GLYPHS&&vi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),br.sortKey!==void 0&&Vt.addToSortKeyRanges(Vt.symbolInstances.length,br.sortKey);const dv=Nn(or,br,Cu),[pv,mv]=(function(bs,dl){const ed=bs.length,Au=dl?.values;if(Au?.length>0)for(let td=0;td<Au.length;td+=2){const fc=Au[td+1];bs.emplaceBack(L.aQ[Au[td]],fc[0],fc[1])}return[ed,bs.length]})(Vt.textAnchorOffsets,dv);Vt.symbolInstances.emplaceBack(an.x,an.y,eh.right>=0?eh.right:-1,eh.center>=0?eh.center:-1,eh.left>=0?eh.left:-1,eh.vertical||-1,l_,u_,O_,av,sv,ov,lv,uv,cv,hv,fv,_i,L_,z_,P_,R_,B_,0,Gi,Iu,pv,mv)})(i,Xt,jt,n,l,h,ot,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,ie,[we,we,we,we],ct,S,ae,Me,it,H,e,m,I,D,y)};if(gt==="line")for(const jt of um(e.geometry,0,0,Ht,Ht)){const Xt=eo(jt,Ke),Vt=tt(Xt,le,Ye,n.vertical||W,l,24,ye,i.overscaling,Ht);for(const an of Vt)W&&iv(i,W.text,Ot,an)||Yt(Xt,an)}else if(gt==="line-center"){for(const jt of e.geometry)if(jt.length>1){const Xt=eo(jt,Ke),Vt=ke(Xt,Ye,n.vertical||W,l,24,ye);Vt&&Yt(Xt,Vt)}}else if(e.type==="Polygon")for(const jt of xl(e.geometry,0)){const Xt=Ne(jt,16);Yt(eo(jt[0],Ke,!0),new x(Xt.x,Xt.y,0))}else if(e.type==="LineString")for(const jt of e.geometry){const Xt=eo(jt,Ke);Yt(Xt,new x(Xt[0].x,Xt[0].y,0))}else if(e.type==="Point")for(const jt of e.geometry)for(const Xt of jt)Yt([Xt],new x(Xt.x,Xt.y,0))}function Mu(i,e,n,l,h,m,y,w,S,I,D,O,j,G,H){const W=(function(ye,ae,le,we,Me,Ye,ct,it){const gt=we.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,Ot=[];for(const yt of ae.positionedLines)for(const ot of yt.positionedGlyphs){if(!ot.rect)continue;const Ke=ot.rect||{};let Yt=4,jt=!0,Xt=1,Vt=0;const an=(Me||it)&&ot.vertical,Kn=ot.metrics.advance*ot.scale/2;if(it&&ae.verticalizable&&(Vt=yt.lineOffset/2-(ot.imageName?-(pi-ot.metrics.width*ot.scale)/2:(ot.scale-1)*pi)),ot.imageName){const Sa=ct[ot.imageName];jt=Sa.sdf,Xt=Sa.pixelRatio,Yt=1/Xt}const Un=Me?[ot.x+Kn,ot.y]:[0,0];let sr=Me?[0,0]:[ot.x+Kn+le[0],ot.y+le[1]-Vt],ts=[0,0];an&&(ts=sr,sr=[0,0]);const aa=ot.metrics.isDoubleResolution?2:1,or=(ot.metrics.left-Yt)*ot.scale-Kn+sr[0],Ji=(-ot.metrics.top-Yt)*ot.scale+sr[1],_i=or+Ke.w/aa*ot.scale/Xt,xr=Ji+Ke.h/aa*ot.scale/Xt,Lr=new ue(or,Ji),Gi=new ue(_i,Ji),ao=new ue(or,xr),ns=new ue(_i,xr);if(an){const Sa=new ue(-Kn,Kn- -17),dr=-Math.PI/2,sa=12-Kn,br=new ue(22-sa,-(ot.imageName?sa:0)),Ea=new ue(...ts);Lr._rotateAround(dr,Sa)._add(br)._add(Ea),Gi._rotateAround(dr,Sa)._add(br)._add(Ea),ao._rotateAround(dr,Sa)._add(br)._add(Ea),ns._rotateAround(dr,Sa)._add(br)._add(Ea)}if(gt){const Sa=Math.sin(gt),dr=Math.cos(gt),sa=[dr,-Sa,Sa,dr];Lr._matMult(sa),Gi._matMult(sa),ao._matMult(sa),ns._matMult(sa)}const so=new ue(0,0),Vl=new ue(0,0);Ot.push({tl:Lr,tr:Gi,bl:ao,br:ns,tex:Ke,writingMode:ae.writingMode,glyphOffset:Un,sectionIndex:ot.sectionIndex,isSDF:jt,pixelOffsetTL:so,pixelOffsetBR:Vl,minFontScaleX:0,minFontScaleY:0})}return Ot})(0,n,w,h,m,y,l,i.allowVerticalPlacement),K=i.textSizeData;let ie=null;K.kind==="source"?(ie=[ul*h.layout.get("text-size").evaluate(y,{})],ie[0]>ys&&vi(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):K.kind==="composite"&&(ie=[ul*G.compositeTextSizes[0].evaluate(y,{},H),ul*G.compositeTextSizes[1].evaluate(y,{},H)],(ie[0]>ys||ie[1]>ys)&&vi(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,W,ie,w,m,y,I,e,S.lineStartIndex,S.lineLength,j,H);for(const ye of D)O[ye]=i.text.placedSymbolArray.length-1;return 4*W.length}function pg(i){for(const e in i)return i[e];return null}function iv(i,e,n,l){const h=i.compareText;if(e in h){const m=h[e];for(let y=m.length-1;y>=0;y--)if(l.dist(m[y])<n)return!0}else h[e]=[];return h[e].push(l),!1}const A_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class t_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const m=A_[15&l];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new t_(w,y,m,e)}constructor(e,n=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=A_.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-w%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+w+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return n_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:w}=this,S=[0,m.length-1,0],I=[];for(;S.length;){const D=S.pop()||0,O=S.pop()||0,j=S.pop()||0;if(O-j<=w){for(let K=j;K<=O;K++){const ie=y[2*K],ye=y[2*K+1];ie>=e&&ie<=l&&ye>=n&&ye<=h&&I.push(m[K])}continue}const G=j+O>>1,H=y[2*G],W=y[2*G+1];H>=e&&H<=l&&W>=n&&W<=h&&I.push(m[G]),(D===0?e<=H:n<=W)&&(S.push(j),S.push(G-1),S.push(1-D)),(D===0?l>=H:h>=W)&&(S.push(G+1),S.push(O),S.push(1-D))}return I}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:m,nodeSize:y}=this,w=[0,h.length-1,0],S=[],I=l*l;for(;w.length;){const D=w.pop()||0,O=w.pop()||0,j=w.pop()||0;if(O-j<=y){for(let K=j;K<=O;K++)D_(m[2*K],m[2*K+1],e,n)<=I&&S.push(h[K]);continue}const G=j+O>>1,H=m[2*G],W=m[2*G+1];D_(H,W,e,n)<=I&&S.push(h[G]),(D===0?e-l<=H:n-l<=W)&&(w.push(j),w.push(G-1),w.push(1-D)),(D===0?e+l>=H:n+l>=W)&&(w.push(G+1),w.push(O),w.push(1-D))}return S}}function n_(i,e,n,l,h,m){if(h-l<=n)return;const y=l+h>>1;k_(i,e,y,l,h,m),n_(i,e,n,l,y-1,1-m),n_(i,e,n,y+1,h,1-m)}function k_(i,e,n,l,h,m){for(;h>l;){if(h-l>600){const I=h-l+1,D=n-l+1,O=Math.log(I),j=.5*Math.exp(2*O/3),G=.5*Math.sqrt(O*j*(I-j)/I)*(D-I/2<0?-1:1);k_(i,e,n,Math.max(l,Math.floor(n-D*j/I+G)),Math.min(h,Math.floor(n+(I-D)*j/I+G)),m)}const y=e[2*n+m];let w=l,S=h;for(cm(i,e,l,n),e[2*h+m]>y&&cm(i,e,l,h);w<S;){for(cm(i,e,w,S),w++,S--;e[2*w+m]<y;)w++;for(;e[2*S+m]>y;)S--}e[2*l+m]===y?cm(i,e,l,S):(S++,cm(i,e,S,h)),S<=n&&(l=S+1),n<=S&&(h=S-1)}}function cm(i,e,n,l){i_(i,n,l),i_(e,2*n,2*l),i_(e,2*n+1,2*l+1)}function i_(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function D_(i,e,n,l){const h=i-n,m=e-l;return h*h+m*m}var r_;L.cI=void 0,(r_=L.cI||(L.cI={})).create="create",r_.load="load",r_.fullLoad="fullLoad";let mg=null,hm=[];const a_=1e3/60,s_="loadTime",o_="fullLoadTime",rv={mark(i){performance.mark(i)},frame(i){const e=i;mg!=null&&hm.push(e-mg),mg=e},clearMetrics(){mg=null,hm=[],performance.clearMeasures(s_),performance.clearMeasures(o_);for(const i in L.cI)performance.clearMarks(L.cI[i])},getPerformanceMetrics(){performance.measure(s_,L.cI.create,L.cI.load),performance.measure(o_,L.cI.create,L.cI.fullLoad);const i=performance.getEntriesByName(s_)[0].duration,e=performance.getEntriesByName(o_)[0].duration,n=hm.length,l=1/(hm.reduce(((m,y)=>m+y),0)/n/1e3),h=hm.filter((m=>m>a_)).reduce(((m,y)=>m+(y-a_)/a_),0);return{loadTime:i,fullLoadTime:e,fps:l,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};L.$=Ie,L.A=rt,L.B=kc,L.C=ju,L.D=Kt,L.E=Fn,L.F=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},L.G=Di,L.H=qn,L.I=Vh,L.J=Ac,L.K=function(i){if(Ai==null){const e=i.navigator?i.navigator.userAgent:null;Ai=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ai},L.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ym((()=>this.process())),this.subscription=pl(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Ma(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((n,l)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10),m=e?pl(e.signal,"abort",(()=>{m?.unsubscribe(),delete this.resolveRejects[h];const S={id:h,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(S)}),Wn):null;this.resolveRejects[h]={resolve:S=>{m?.unsubscribe(),n(S)},reject:S=>{m?.unsubscribe(),l(S)}};const y=[],w=Object.assign(Object.assign({},i),{id:h,sourceMapId:this.mapId,origin:location.origin,data:kl(i.data,y)});this.target.postMessage(w,{transfer:y})}))}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const l=this.abortControllers[n];return delete this.abortControllers[n],void(l&&l.abort())}if(Ma(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return f(this,void 0,void 0,(function*(){if(e.type==="<response>"){const h=this.resolveRejects[i];return delete this.resolveRejects[i],h?void(e.error?h.reject(qu(e.error)):h.resolve(qu(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=qu(e.data),l=new AbortController;this.abortControllers[i]=l;try{const h=yield this.messageHandlers[e.type](e.sourceMapId,n,l);this.completeTask(i,null,h)}catch(h){this.completeTask(i,h)}}))}completeTask(i,e,n){const l=[];delete this.abortControllers[i];const h={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?kl(e):null,data:kl(n,l)};this.target.postMessage(h,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},L.M=Ve,L.N=function(){var i=new rt(16);return rt!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},L.O=function(i,e,n){var l,h,m,y,w,S,I,D,O,j,G,H,W=n[0],K=n[1],ie=n[2];return e===i?(i[12]=e[0]*W+e[4]*K+e[8]*ie+e[12],i[13]=e[1]*W+e[5]*K+e[9]*ie+e[13],i[14]=e[2]*W+e[6]*K+e[10]*ie+e[14],i[15]=e[3]*W+e[7]*K+e[11]*ie+e[15]):(h=e[1],m=e[2],y=e[3],w=e[4],S=e[5],I=e[6],D=e[7],O=e[8],j=e[9],G=e[10],H=e[11],i[0]=l=e[0],i[1]=h,i[2]=m,i[3]=y,i[4]=w,i[5]=S,i[6]=I,i[7]=D,i[8]=O,i[9]=j,i[10]=G,i[11]=H,i[12]=l*W+w*K+O*ie+e[12],i[13]=h*W+S*K+j*ie+e[13],i[14]=m*W+I*K+G*ie+e[14],i[15]=y*W+D*K+H*ie+e[15]),i},L.P=ue,L.Q=function(i,e,n){var l=n[0],h=n[1],m=n[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*h,i[5]=e[5]*h,i[6]=e[6]*h,i[7]=e[7]*h,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},L.R=vr,L.S=function(i,e,n){var l=e[0],h=e[1],m=e[2],y=e[3],w=e[4],S=e[5],I=e[6],D=e[7],O=e[8],j=e[9],G=e[10],H=e[11],W=e[12],K=e[13],ie=e[14],ye=e[15],ae=n[0],le=n[1],we=n[2],Me=n[3];return i[0]=ae*l+le*w+we*O+Me*W,i[1]=ae*h+le*S+we*j+Me*K,i[2]=ae*m+le*I+we*G+Me*ie,i[3]=ae*y+le*D+we*H+Me*ye,i[4]=(ae=n[4])*l+(le=n[5])*w+(we=n[6])*O+(Me=n[7])*W,i[5]=ae*h+le*S+we*j+Me*K,i[6]=ae*m+le*I+we*G+Me*ie,i[7]=ae*y+le*D+we*H+Me*ye,i[8]=(ae=n[8])*l+(le=n[9])*w+(we=n[10])*O+(Me=n[11])*W,i[9]=ae*h+le*S+we*j+Me*K,i[10]=ae*m+le*I+we*G+Me*ie,i[11]=ae*y+le*D+we*H+Me*ye,i[12]=(ae=n[12])*l+(le=n[13])*w+(we=n[14])*O+(Me=n[15])*W,i[13]=ae*h+le*S+we*j+Me*K,i[14]=ae*m+le*I+we*G+Me*ie,i[15]=ae*y+le*D+we*H+Me*ye,i},L.T=Ui,L.U=function(i,e){const n={};for(let l=0;l<e.length;l++){const h=e[l];h in i&&(n[h]=i[h])}return n},L.V=hl,L.W=Rn,L.X=Gh,L.Y=kd,L.Z=ve,L._=f,L.a=oe,L.a$=Xm,L.a0=Et,L.a1=Us,L.a2=vs,L.a3=Hm,L.a4=Uf,L.a5=Ht,L.a6=function(i,e,n){if(!i)return e||{};if(!e)return i||{};const l=Wm(i),h=Wm(e);(function(y,w){w.removeAll&&(y.add.clear(),y.update.clear(),y.remove.clear(),w.remove.clear());for(const S of w.remove)y.add.delete(S),y.update.delete(S);for(const[S,I]of w.update){const D=y.update.get(S);D&&(w.update.set(S,$m(D,I)),y.update.delete(S))}})(l,h);const m={};if((l.removeAll||h.removeAll)&&(m.removeAll=!0),m.remove=new Set([...l.remove,...h.remove]),m.add=new Map([...l.add,...h.add]),m.update=new Map([...l.update,...h.update]),m.remove.size&&m.add.size)for(const y of m.add.keys())m.remove.delete(y);return(function(y){const w={};return y.removeAll&&(w.removeAll=y.removeAll),y.remove&&(w.remove=Array.from(y.remove)),y.add&&(w.add=Array.from(y.add.values())),y.update&&(w.update=Array.from(y.update.values())),w})(m)},L.a7=function(i,e){if(i==null||i.type==null)return!0;if(i.type==="Feature")return Gf(i,e)!=null;if(i.type==="FeatureCollection"){const n=new Set;for(const l of i.features){const h=Gf(l,e);if(h==null||n.has(h))return!1;n.add(h)}return!0}return!1},L.a8=function(i,e){const n=new Map;if(!(i==null||i.type==null))if(i.type==="Feature")n.set(Gf(i,e),i);else for(const l of i.features)n.set(Gf(l,e),l);return n},L.a9=function(i,e,n){var l,h;if(e.removeAll)i.clear();else if(e.remove)for(const m of e.remove)i.delete(m);if(e.add)for(const m of e.add){const y=Gf(m,n);y!=null&&i.set(y,m)}if(e.update)for(const m of e.update){let y=i.get(m.id);if(!y)continue;const w=!!m.newGeometry,S=m.removeAllProperties||((l=m.removeProperties)===null||l===void 0?void 0:l.length)>0||((h=m.addOrUpdateProperties)===null||h===void 0?void 0:h.length)>0;if((w||S)&&(y=Object.assign({},y),i.set(m.id,y),w&&(y.geometry=m.newGeometry),S)){if(y.properties=m.removeAllProperties?{}:Object.assign({},y.properties||{}),m.removeProperties)for(const I of m.removeProperties)delete y.properties[I];if(m.addOrUpdateProperties)for(const{key:I,value:D}of m.addOrUpdateProperties)y.properties[I]=D}}},L.aB=function(i,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:h}){return i.kind==="source"?l/ul:i.kind==="composite"?Di.number(l/ul,h/ul,n):e},L.aC=function(i,e){var n=e[0],l=e[1],h=e[2],m=e[3],y=e[4],w=e[5],S=e[6],I=e[7],D=e[8],O=e[9],j=e[10],G=e[11],H=e[12],W=e[13],K=e[14],ie=e[15],ye=n*w-l*y,ae=n*S-h*y,le=n*I-m*y,we=l*S-h*w,Me=l*I-m*w,Ye=h*I-m*S,ct=D*W-O*H,it=D*K-j*H,gt=D*ie-G*H,Ot=O*K-j*W,yt=O*ie-G*W,ot=j*ie-G*K,Ke=ye*ot-ae*yt+le*Ot+we*gt-Me*it+Ye*ct;return Ke?(i[0]=(w*ot-S*yt+I*Ot)*(Ke=1/Ke),i[1]=(h*yt-l*ot-m*Ot)*Ke,i[2]=(W*Ye-K*Me+ie*we)*Ke,i[3]=(j*Me-O*Ye-G*we)*Ke,i[4]=(S*gt-y*ot-I*it)*Ke,i[5]=(n*ot-h*gt+m*it)*Ke,i[6]=(K*le-H*Ye-ie*ae)*Ke,i[7]=(D*Ye-j*le+G*ae)*Ke,i[8]=(y*yt-w*gt+I*ct)*Ke,i[9]=(l*gt-n*yt-m*ct)*Ke,i[10]=(H*Me-W*le+ie*ye)*Ke,i[11]=(O*le-D*Me-G*ye)*Ke,i[12]=(w*it-y*Ot-S*ct)*Ke,i[13]=(n*Ot-l*it+h*ct)*Ke,i[14]=(W*ae-H*we-K*ye)*Ke,i[15]=(D*we-O*ae+j*ye)*Ke,i):null},L.aD=Tt,L.aE=function(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)},L.aF=function(i){return i[0]=0,i[1]=0,i},L.aG=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},L.aH=Md,L.aI=Rt,L.aJ=function(i,e,n,l){const h=e.y-i.y,m=e.x-i.x,y=l.y-n.y,w=l.x-n.x,S=y*m-w*h;if(S===0)return null;const I=(w*(i.y-n.y)-y*(i.x-n.x))/S;return new ue(i.x+I*m,i.y+I*h)},L.aK=um,L.aL=Ch,L.aM=function(i){let e=1/0,n=1/0,l=-1/0,h=-1/0;for(const m of i)e=Math.min(e,m.x),n=Math.min(n,m.y),l=Math.max(l,m.x),h=Math.max(h,m.y);return[e,n,l,h]},L.aN=pi,L.aO=Pt,L.aP=function(i,e,n,l,h=!1){if(!n[0]&&!n[1])return[0,0];const m=h?l==="map"?-i.bearingInRadians:0:l==="viewport"?i.bearingInRadians:0;if(m){const y=Math.sin(m),w=Math.cos(m);n=[n[0]*w-n[1]*y,n[0]*y+n[1]*w]}return[h?n[0]:Pt(e,n[0],i.zoom),h?n[1]:Pt(e,n[1],i.zoom)]},L.aR=Xc,L.aS=Hn,L.aT=zf,L.aU=t_,L.aV=on,L.aW=Ls,L.aX=q,L.aY=mt,L.aZ=$e,L.a_=wr,L.aa=Kh,L.ab=jf,L.ac=fl,L.ad=25,L.ae=Dd,L.af=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const l of i){const h=window.document.createElement("source");ht(l)||(e.crossOrigin="Anonymous"),h.src=l,e.appendChild(h)}}))},L.ag=It,L.ah=function(){return yi++},L.ai=t,L.aj=rc,L.ak=Ya,L.al=zl,L.am=Rd,L.an=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,l,h,m)=>{const y=h||m;return e[l]=!y||y.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},L.ao=Mn,L.ap=85.051129,L.aq=ln,L.ar=function(i){return Math.pow(2,i)},L.as=Mt,L.at=Vf,L.au=function(i){return Math.log(i)/Math.LN2},L.av=function(i){var e=i[0],n=i[1];return e*e+n*n},L.aw=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((S=>S.canonical.z)));let n=1/0,l=-1/0,h=1/0,m=-1/0;const y=[];for(const S of i){const{x:I,y:D,z:O}=S.canonical,j=Math.pow(2,e-O),G=I*j,H=D*j;y.push({id:S,x:G,y:H}),G<n&&(n=G),G>l&&(l=G),H<h&&(h=H),H>m&&(m=H)}const w=new Set;for(const S of y)S.x!==n&&S.x!==l&&S.y!==h&&S.y!==m||w.add(S.id);return w},L.ax=function(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},L.ay=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,n){const l=i.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const h={value:e,timeout:void 0};if(n!==void 0&&(h.timeout=setTimeout((()=>{this.remove(i,h)}),n)),this.data[l].push(h),this.order.push(l),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const n=i.wrapped().key,l=e===void 0?0:this.data[n].indexOf(e),h=this.data[n][l];return this.data[n].splice(l,1),h.timeout&&clearTimeout(h.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(h.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const n in this.data)for(const l of this.data[n])i(l.value)||e.push(l);for(const n of e)this.remove(n.value.tileID,n)}},L.az=function(i,e){let n=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:m,maxZoom:y}=i,w=h?Mn(ca.interpolationFactor(h,e,m,y),0,1):0;i.kind==="camera"?l=Di.number(i.minSize,i.maxSize,w):n=w}return{uSizeT:n,uSize:l}},L.b=Vs,L.b$=class extends pa{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},L.b0=xn,L.b1=Ft,L.b2=function(i){var e=new rt(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},L.b3=function(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i},L.b4=function(i,e){var n=e[0],l=e[1],h=e[2],m=n*n+l*l+h*h;return m>0&&(m=1/Math.sqrt(m)),i[0]=e[0]*m,i[1]=e[1]*m,i[2]=e[2]*m,i},L.b5=dn,L.b6=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},L.b7=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},L.b8=_t,L.b9=function(i,e,n){const l=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return l===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/l},L.bA=function(){return new Float64Array(3)},L.bB=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i},L.bC=Je,L.bD=function(i,e,n){var l=n[0],h=n[1],m=n[2],y=n[3],w=e[0],S=e[1],I=e[2],D=h*I-m*S,O=m*w-l*I,j=l*S-h*w;return i[0]=w+y*(D+=D)+h*(j+=j)-m*(O+=O),i[1]=S+y*O+m*D-l*j,i[2]=I+y*j+l*O-h*D,i},L.bE=function(i,e,n){const l=(function(S){var I=S[3],D=S[4],O=S[5],j=S[6],G=S[7],H=S[8];return S[0]*(H*D-O*G)+S[1]*(-H*I+O*j)+S[2]*(G*I-D*j)})([i[0],i[1],i[2],e[0],e[1],e[2],n[0],n[1],n[2]]);if(l===0)return null;const h=dn([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),m=dn([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),y=dn([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),w=xn([],h,-i[3]);return Ft(w,w,xn([],m,-e[3])),Ft(w,w,xn([],y,-n[3])),xn(w,w,1/l),w},L.bF=Ff,L.bG=function(){return new Float64Array(4)},L.bH=function(i,e,n,l){var h=[],m=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],m[0]=h[0]*Math.cos(l)-h[1]*Math.sin(l),m[1]=h[0]*Math.sin(l)+h[1]*Math.cos(l),m[2]=h[2],i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},L.bI=function(i,e,n,l){var h=[],m=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],m[0]=h[0],m[1]=h[1]*Math.cos(l)-h[2]*Math.sin(l),m[2]=h[1]*Math.sin(l)+h[2]*Math.cos(l),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},L.bJ=function(i,e,n,l){var h=[],m=[];return h[0]=e[0]-n[0],h[1]=e[1]-n[1],h[2]=e[2]-n[2],m[0]=h[2]*Math.sin(l)+h[0]*Math.cos(l),m[1]=h[1],m[2]=h[2]*Math.cos(l)-h[0]*Math.sin(l),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},L.bK=function(i,e,n){var l=Math.sin(n),h=Math.cos(n),m=e[0],y=e[1],w=e[2],S=e[3],I=e[8],D=e[9],O=e[10],j=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*h-I*l,i[1]=y*h-D*l,i[2]=w*h-O*l,i[3]=S*h-j*l,i[8]=m*l+I*h,i[9]=y*l+D*h,i[10]=w*l+O*h,i[11]=S*l+j*h,i},L.bL=function(i,e){const n=Re(i,360),l=Re(e,360),h=l-n,m=l>n?h-360:h+360;return Math.abs(h)<Math.abs(m)?h:m},L.bM=function(i){return i[0]=0,i[1]=0,i[2]=0,i},L.bN=function(i,e,n,l){const h=Math.sqrt(i*i+e*e),m=Math.sqrt(n*n+l*l);i/=h,e/=h,n/=m,l/=m;const y=Math.acos(i*n+e*l);return-e*n+i*l>0?y:-y},L.bO=function(i,e){const n=Re(i,2*Math.PI),l=Re(e,2*Math.PI);return Math.min(Math.abs(n-l),Math.abs(n-l+2*Math.PI),Math.abs(n-l-2*Math.PI))},L.bP=function(){const i={},e=Ge.$version;for(const n in Ge.$root){const l=Ge.$root[n];if(l.required){let h=null;h=n==="version"?e:l.type==="array"?[]:{},h!=null&&(i[n]=h)}}return i},L.bQ=Le,L.bR=ps,L.bS=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let l=0;l<e.length;l++)if(!i(e[l],n[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const l in e)if(!i(e[l],n[l]))return!1;return!0}return e===n},L.bT=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=qi(i[n],e[i[n].ref]));return i},L.bU=function(i,e){if(i.type==="custom")return new $g(i,e);switch(i.type){case"background":return new Bf(i,e);case"circle":return new gp(i,e);case"color-relief":return new Cm(i,e);case"fill":return new Cf(i,e);case"fill-extrusion":return new Dr(i,e);case"heatmap":return new Tm(i,e);case"hillshade":return new Sm(i,e);case"line":return new nc(i,e);case"raster":return new $a(i,e);case"symbol":return new jh(i,e)}},L.bV=i=>i.type==="raster",L.bW=Se,L.bX=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!gn(i.version,e.version))return[{command:"setStyle",args:[e]}];gn(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),gn(i.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),gn(i.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),gn(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),gn(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),gn(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),gn(i.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),gn(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),gn(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),gn(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),gn(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),gn(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),gn(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),gn(i.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const l={},h=[];(function(y,w,S,I){let D;for(D in w=w||{},y=y||{})Object.prototype.hasOwnProperty.call(y,D)&&(Object.prototype.hasOwnProperty.call(w,D)||Xn(D,S,I));for(D in w)Object.prototype.hasOwnProperty.call(w,D)&&(Object.prototype.hasOwnProperty.call(y,D)?gn(y[D],w[D])||(y[D].type==="geojson"&&w[D].type==="geojson"&&ni(y,w,D)?xt(S,{command:"setGeoJSONSourceData",args:[D,w[D].data]}):Ci(D,w,S,I)):Zi(D,w,S))})(i.sources,e.sources,h,l);const m=[];i.layers&&i.layers.forEach((y=>{"source"in y&&l[y.source]?n.push({command:"removeLayer",args:[y.id]}):m.push(y)})),n=n.concat(h),(function(y,w,S){w=w||[];const I=(y=y||[]).map(Bo),D=w.map(Bo),O=y.reduce(Ca,{}),j=w.reduce(Ca,{}),G=I.slice(),H=Object.create(null);let W,K,ie,ye,ae;for(let le=0,we=0;le<I.length;le++)W=I[le],Object.prototype.hasOwnProperty.call(j,W)?we++:(xt(S,{command:"removeLayer",args:[W]}),G.splice(G.indexOf(W,we),1));for(let le=0,we=0;le<D.length;le++)W=D[D.length-1-le],G[G.length-1-le]!==W&&(Object.prototype.hasOwnProperty.call(O,W)?(xt(S,{command:"removeLayer",args:[W]}),G.splice(G.lastIndexOf(W,G.length-we),1)):we++,ye=G[G.length-le],xt(S,{command:"addLayer",args:[j[W],ye]}),G.splice(G.length-le,0,W),H[W]=!0);for(let le=0;le<D.length;le++)if(W=D[le],K=O[W],ie=j[W],!H[W]&&!gn(K,ie))if(gn(K.source,ie.source)&&gn(K["source-layer"],ie["source-layer"])&&gn(K.type,ie.type)){for(ae in Ni(K.layout,ie.layout,S,W,null,"setLayoutProperty"),Ni(K.paint,ie.paint,S,W,null,"setPaintProperty"),gn(K.filter,ie.filter)||xt(S,{command:"setFilter",args:[W,ie.filter]}),gn(K.minzoom,ie.minzoom)&&gn(K.maxzoom,ie.maxzoom)||xt(S,{command:"setLayerZoomRange",args:[W,ie.minzoom,ie.maxzoom]}),K)Object.prototype.hasOwnProperty.call(K,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?Ni(K[ae],ie[ae],S,W,ae.slice(6),"setPaintProperty"):gn(K[ae],ie[ae])||xt(S,{command:"setLayerProperty",args:[W,ae,ie[ae]]}));for(ae in ie)Object.prototype.hasOwnProperty.call(ie,ae)&&!Object.prototype.hasOwnProperty.call(K,ae)&&ae!=="layout"&&ae!=="paint"&&ae!=="filter"&&ae!=="metadata"&&ae!=="minzoom"&&ae!=="maxzoom"&&(ae.indexOf("paint.")===0?Ni(K[ae],ie[ae],S,W,ae.slice(6),"setPaintProperty"):gn(K[ae],ie[ae])||xt(S,{command:"setLayerProperty",args:[W,ae,ie[ae]]}))}else xt(S,{command:"removeLayer",args:[W]}),ye=G[G.lastIndexOf(W)+1],xt(S,{command:"addLayer",args:[ie,ye]})})(m,e.layers,n)}catch(l){console.warn("Unable to compute style diff:",l),n=[{command:"setStyle",args:[e]}]}return n},L.bY=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},L.bZ=Ln,L.b_=rn,L.ba=En,L.bb=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},L.bc=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},L.bd=Ri,L.be=Rr,L.bf=function(i,e,n,l,h){var m=1/Math.tan(e/2);if(i[0]=m/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0){var y=1/(l-h);i[10]=(h+l)*y,i[14]=2*h*l*y}else i[10]=-1,i[14]=-2*l;return i},L.bg=function(i){var e=new rt(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},L.bh=function(i,e,n){var l=Math.sin(n),h=Math.cos(n),m=e[0],y=e[1],w=e[2],S=e[3],I=e[4],D=e[5],O=e[6],j=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*h+I*l,i[1]=y*h+D*l,i[2]=w*h+O*l,i[3]=S*h+j*l,i[4]=I*h-m*l,i[5]=D*h-y*l,i[6]=O*h-w*l,i[7]=j*h-S*l,i},L.bi=function(i,e,n){var l=Math.sin(n),h=Math.cos(n),m=e[4],y=e[5],w=e[6],S=e[7],I=e[8],D=e[9],O=e[10],j=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*h+I*l,i[5]=y*h+D*l,i[6]=w*h+O*l,i[7]=S*h+j*l,i[8]=I*h-m*l,i[9]=D*h-y*l,i[10]=O*h-w*l,i[11]=j*h-S*l,i},L.bj=function(){const i=new Float32Array(16);return Mt(i),i},L.bk=function(){const i=new Float64Array(16);return Mt(i),i},L.bl=function(){return new Float64Array(16)},L.bm=function(i,e,n){const l=new Float64Array(4);return Je(l,i,e-90,n),l},L.bn=function(i,e,n,l){var h,m,y,w,S,I=e[0],D=e[1],O=e[2],j=e[3],G=n[0],H=n[1],W=n[2],K=n[3];return(m=I*G+D*H+O*W+j*K)<0&&(m=-m,G=-G,H=-H,W=-W,K=-K),1-m>vt?(h=Math.acos(m),y=Math.sin(h),w=Math.sin((1-l)*h)/y,S=Math.sin(l*h)/y):(w=1-l,S=l),i[0]=w*I+S*G,i[1]=w*D+S*H,i[2]=w*O+S*W,i[3]=w*j+S*K,i},L.bo=function(i){const e=new Float64Array(9);(function(m,y){var w=y[0],S=y[1],I=y[2],D=y[3],O=w+w,j=S+S,G=I+I,H=w*O,W=S*O,K=S*j,ie=I*O,ye=I*j,ae=I*G,le=D*O,we=D*j,Me=D*G;m[0]=1-K-ae,m[3]=W-Me,m[6]=ie+we,m[1]=W+Me,m[4]=1-H-ae,m[7]=ye-le,m[2]=ie-we,m[5]=ye+le,m[8]=1-H-K})(e,i);const n=wr(-Math.asin(Mn(e[2],-1,1)));let l,h;return Math.hypot(e[5],e[8])<.001?(l=0,h=-wr(Math.atan2(e[3],e[4]))):(l=wr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),h=wr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:l,pitch:n+90,bearing:h}},L.bp=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},L.bq=In,L.br=Js,L.bs=Gc,L.bt=Ta,L.bu=ma,L.bv=lt,L.bw=zt,L.bx=ci,L.by=function(i,e,n,l,h){return lt(l,h,Mn((i-e)/(n-e),0,1))},L.bz=Re,L.c=xe,L.c$=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},L.c0=hu,L.c1=class extends pa{constructor(i,e){super(i,e),this.current=Sh}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},L.c2=sl,L.c3=class extends pa{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},L.c4=class extends pa{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},L.c5=At,L.c6=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=n,i[2]=0,i[3]=-n,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},L.c7=function(i,e,n){var l=e[0],h=e[1],m=e[2];return i[0]=l*n[0]+h*n[3]+m*n[6],i[1]=l*n[1]+h*n[4]+m*n[7],i[2]=l*n[2]+h*n[5]+m*n[8],i},L.c8=function(i,e,n,l,h,m,y){var w=1/(e-n),S=1/(l-h),I=1/(m-y);return i[0]=-2*w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*S,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*I,i[11]=0,i[12]=(e+n)*w,i[13]=(h+l)*S,i[14]=(y+m)*I,i[15]=1,i},L.c9=class extends pa{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)e[4*n]=i[n].r,e[4*n+1]=i[n].g,e[4*n+2]=i[n].b,e[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,e)}}},L.cA=function(i,e){return te[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},L.cB=function(i,e){return je[e]&&"touches"in i},L.cC=function(i){return je[i]||te[i]},L.cD=function(i,e,n){var l=e[0],h=e[1];return i[0]=n[0]*l+n[4]*h+n[12],i[1]=n[1]*l+n[5]*h+n[13],i},L.cE=function(i,e){const{x:n,y:l}=jf.fromLngLat(e);return!(i<0||i>25||l<0||l>=1||n<0||n>=1)},L.cF=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},L.cG=class extends uu{},L.cH=rv,L.cJ=De,L.cK=function(i,e){xe.REGISTERED_PROTOCOLS[i]=e},L.cL=function(i){delete xe.REGISTERED_PROTOCOLS[i]},L.cM=function(i,e){const n={};for(let h=0;h<i.length;h++){const m=e&&e[i[h].id]||Ho(i[h]);e&&(e[i[h].id]=m);let y=n[m];y||(y=n[m]=[]),y.push(i[h])}const l=[];for(const h in n)l.push(n[h]);return l},L.cN=Bt,L.cO=Pd,L.cP=lm,L.cQ=Fp,L.cR=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=Ht/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,l=e._unevaluatedLayout._values,h={layoutIconSize:l["icon-size"].possiblyEvaluate(new qn(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new qn(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new qn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:I,maxZoom:D}=i.bucket.textSizeData;h.compositeTextSizes=[l["text-size"].possiblyEvaluate(new qn(I),i.canonical),l["text-size"].possiblyEvaluate(new qn(D),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:I,maxZoom:D}=i.bucket.iconSizeData;h.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new qn(I),i.canonical),l["icon-size"].possiblyEvaluate(new qn(D),i.canonical)]}const m=n.get("text-line-height")*pi,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",w=n.get("text-keep-upright"),S=n.get("text-size");for(const I of i.bucket.features){const D=n.get("text-font").evaluate(I,{},i.canonical).join(","),O=S.evaluate(I,{},i.canonical),j=h.layoutTextSize.evaluate(I,{},i.canonical),G=h.layoutIconSize.evaluate(I,{},i.canonical),H={horizontal:{},vertical:void 0},W=I.text;let K,ie=[0,0];if(W){const le=W.toString(),we=n.get("text-letter-spacing").evaluate(I,{},i.canonical)*pi,Me=Rc(le)?we:0,Ye=n.get("text-anchor").evaluate(I,{},i.canonical),ct=Nn(e,I,i.canonical);if(!ct){const yt=n.get("text-radial-offset").evaluate(I,{},i.canonical);ie=yt?hn(Ye,[yt*pi,ai]):n.get("text-offset").evaluate(I,{},i.canonical).map((ot=>ot*pi))}let it=y?"center":n.get("text-justify").evaluate(I,{},i.canonical);const gt=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(I,{},i.canonical)*pi:1/0,Ot=()=>{i.bucket.allowVerticalPlacement&&Rs(le)&&(H.vertical=mi(W,i.glyphMap,i.glyphPositions,i.imagePositions,D,gt,m,Ye,"left",Me,ie,L.aA.vertical,!0,j,O))};if(!y&&ct){const yt=new Set;if(it==="auto")for(let Ke=0;Ke<ct.values.length;Ke+=2)yt.add(Hn(ct.values[Ke]));else yt.add(it);let ot=!1;for(const Ke of yt)if(!H.horizontal[Ke])if(ot)H.horizontal[Ke]=H.horizontal[0];else{const Yt=mi(W,i.glyphMap,i.glyphPositions,i.imagePositions,D,gt,m,"center",Ke,Me,ie,L.aA.horizontal,!1,j,O);Yt&&(H.horizontal[Ke]=Yt,ot=Yt.positionedLines.length===1)}Ot()}else{it==="auto"&&(it=Hn(Ye));const yt=mi(W,i.glyphMap,i.glyphPositions,i.imagePositions,D,gt,m,Ye,it,Me,ie,L.aA.horizontal,!1,j,O);yt&&(H.horizontal[it]=yt),Ot(),Rs(le)&&y&&w&&(H.vertical=mi(W,i.glyphMap,i.glyphPositions,i.imagePositions,D,gt,m,Ye,it,Me,ie,L.aA.vertical,!1,j,O))}}let ye=!1;if(I.icon&&I.icon.name){const le=i.imageMap[I.icon.name];le&&(K=Uh(i.imagePositions[I.icon.name],n.get("icon-offset").evaluate(I,{},i.canonical),n.get("icon-anchor").evaluate(I,{},i.canonical)),ye=!!le.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=ye:i.bucket.sdfIcons!==ye&&vi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(le.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ae=pg(H.horizontal)||H.vertical;i.bucket.iconsInText=!!ae&&ae.iconsInText,(ae||K)&&gi(i.bucket,I,H,K,i.imageMap,h,j,G,ie,ye,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},L.cS=to,L.cT=Ei,L.cU=Nh,L.cV=function(i){const e=new Lf;return(function(n,l){for(const h in n.layers)l.writeMessage(3,Hd,n.layers[h])})(i,e),e.finish()},L.cW=function(i,e,n,l,h,m){let y=dg(i,e,n,h,0);return y=dg(y,e,l,m,1),y},L.cX=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,e)}clear(){this.map.clear()}},L.cY=di,L.cZ=Lf,L.c_=om,L.ca=class extends pa{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},L.cb=class extends Bc{},L.cc=Pf,L.cd=class extends rl{},L.ce=vp,L.cf=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},L.cg=pd,L.ch=function(i,e,n){var l=e[0],h=e[1],m=e[2],y=n[3]*l+n[7]*h+n[11]*m+n[15];return i[0]=(n[0]*l+n[4]*h+n[8]*m+n[12])/(y=y||1),i[1]=(n[1]*l+n[5]*h+n[9]*m+n[13])/y,i[2]=(n[2]*l+n[6]*h+n[10]*m+n[14])/y,i},L.ci=class extends ms{},L.cj=class extends Wu{},L.ck=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},L.cl=function(i,e){var n=i[0],l=i[1],h=i[2],m=i[3],y=i[4],w=i[5],S=i[6],I=i[7],D=i[8],O=i[9],j=i[10],G=i[11],H=i[12],W=i[13],K=i[14],ie=i[15],ye=e[0],ae=e[1],le=e[2],we=e[3],Me=e[4],Ye=e[5],ct=e[6],it=e[7],gt=e[8],Ot=e[9],yt=e[10],ot=e[11],Ke=e[12],Yt=e[13],jt=e[14],Xt=e[15];return Math.abs(n-ye)<=vt*Math.max(1,Math.abs(n),Math.abs(ye))&&Math.abs(l-ae)<=vt*Math.max(1,Math.abs(l),Math.abs(ae))&&Math.abs(h-le)<=vt*Math.max(1,Math.abs(h),Math.abs(le))&&Math.abs(m-we)<=vt*Math.max(1,Math.abs(m),Math.abs(we))&&Math.abs(y-Me)<=vt*Math.max(1,Math.abs(y),Math.abs(Me))&&Math.abs(w-Ye)<=vt*Math.max(1,Math.abs(w),Math.abs(Ye))&&Math.abs(S-ct)<=vt*Math.max(1,Math.abs(S),Math.abs(ct))&&Math.abs(I-it)<=vt*Math.max(1,Math.abs(I),Math.abs(it))&&Math.abs(D-gt)<=vt*Math.max(1,Math.abs(D),Math.abs(gt))&&Math.abs(O-Ot)<=vt*Math.max(1,Math.abs(O),Math.abs(Ot))&&Math.abs(j-yt)<=vt*Math.max(1,Math.abs(j),Math.abs(yt))&&Math.abs(G-ot)<=vt*Math.max(1,Math.abs(G),Math.abs(ot))&&Math.abs(H-Ke)<=vt*Math.max(1,Math.abs(H),Math.abs(Ke))&&Math.abs(W-Yt)<=vt*Math.max(1,Math.abs(W),Math.abs(Yt))&&Math.abs(K-jt)<=vt*Math.max(1,Math.abs(K),Math.abs(jt))&&Math.abs(ie-Xt)<=vt*Math.max(1,Math.abs(ie),Math.abs(Xt))},L.cm=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},L.cn=i=>i.type==="symbol",L.co=i=>i.type==="circle",L.cp=i=>i.type==="heatmap",L.cq=i=>i.type==="line",L.cr=i=>i.type==="fill",L.cs=i=>i.type==="fill-extrusion",L.ct=i=>i.type==="hillshade",L.cu=i=>i.type==="color-relief",L.cv=i=>i.type==="background",L.cw=i=>i.type==="custom",L.cx=Ct,L.cy=function(i,e,n){const l=$t(e.x-n.x,e.y-n.y),h=$t(i.x-n.x,i.y-n.y),m=Math.atan2(l[0]*h[1]-l[1]*h[0],(function(y,w){return y[0]*w[0]+y[1]*w[1]})(l,h));return wr(m)},L.cz=en,L.d=ht,L.d0=function(i,e,n,l,h){return f(this,void 0,void 0,(function*(){if(Et())try{return yield Us(i,e,n,l,h)}catch{}return(function(m,y,w,S,I){const D=m.width,O=m.height;rs&&zr||(rs=new OffscreenCanvas(D,O),zr=rs.getContext("2d",{willReadFrequently:!0})),rs.width=D,rs.height=O,zr.drawImage(m,0,0,D,O);const j=zr.getImageData(y,w,S,I);return zr.clearRect(0,0,D,O),j.data})(i,e,n,l,h)}))},L.d1=Em,L.d2=ge,L.d3=class{constructor(i,e){this.layers={[Kh]:this},this.name=Kh,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new Jg(this.features[i],this.extent)}},L.d4=Mc,L.d5=Ws,L.e=Ue,L.f=i=>f(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),L.g=He,L.h=i=>new Promise(((e,n)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=Dt}))},l.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(h):Dt})),L.i=Ma,L.j=(i,e)=>ut(Ue(i,{type:"json"}),e),L.k=Dn,L.l=pn,L.m=ut,L.n=(i,e)=>ut(Ue(i,{type:"arrayBuffer"}),e),L.o=function(i){return new Lf(i).readFields(Um,[])},L.p=Bp,L.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},L.r=kh,L.s=pl,L.t=cr,L.u=Ge,L.v=Uu,L.w=vi,L.x=ou,L.y=Gu,L.z=Pl})),U("worker",["./shared"],(function(L){class f{constructor(te,J){this.keyCache={},te&&this.replace(te,J)}replace(te,J){this._layerConfigs={},this._layers={},this.update(te,[],J)}update(te,J,oe){for(const xe of te){this._layerConfigs[xe.id]=xe;const He=this._layers[xe.id]=L.bU(xe,oe);He._featureFilter=L.ak(He.filter,oe),this.keyCache[xe.id]&&delete this.keyCache[xe.id]}for(const xe of J)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const ve=L.cM(Object.values(this._layerConfigs),this.keyCache);for(const xe of ve){const He=xe.map((Ut=>this._layers[Ut.id])),Ve=He[0];if(Ve.visibility==="none")continue;const De=Ve.source||"";let Le=this.familiesBySource[De];Le||(Le=this.familiesBySource[De]={});const ut=Ve.sourceLayer||L.aa;let ht=Le[ut];ht||(ht=Le[ut]=[]),ht.push(He)}}}class ue{constructor(te){const J={},oe=[];for(const Ve in te){const De=te[Ve],Le=J[Ve]={};for(const ut in De){const ht=De[+ut];if(!ht||ht.bitmap.width===0||ht.bitmap.height===0)continue;const Ut={x:0,y:0,w:ht.bitmap.width+2,h:ht.bitmap.height+2};oe.push(Ut),Le[ut]={rect:Ut,metrics:ht.metrics}}}const{w:ve,h:xe}=L.p(oe),He=new L.r({width:ve||1,height:xe||1});for(const Ve in te){const De=te[Ve];for(const Le in De){const ut=De[+Le];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const ht=J[Ve][Le].rect;L.r.copy(ut.bitmap,He,{x:0,y:0},{x:ht.x+1,y:ht.y+1},ut.bitmap)}}this.image=He,this.positions=J}}L.cN("GlyphAtlas",ue);class ge{constructor(te){this.tileID=new L.a2(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.uid=te.uid,this.zoom=te.zoom,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.collectResourceTiming,this.returnDependencies=!!te.returnDependencies,this.promoteId=te.promoteId,this.inFlightDependencies=[]}parse(te,J,oe,ve,xe){return L._(this,void 0,void 0,(function*(){this.status="parsing",this.data=te,this.collisionBoxArray=new L.ai;const He=new L.cO(Object.keys(te.layers).sort()),Ve=new L.cP(this.tileID,this.promoteId);Ve.bucketLayerIDs=[];const De={},Le={featureIndex:Ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:oe,subdivisionGranularity:xe},ut=J.familiesBySource[this.source];for(const ni in ut){const Ni=te.layers[ni];if(!Ni)continue;Ni.version===1&&L.w(`Vector tile source "${this.source}" layer "${ni}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bo=He.encode(ni),Ca=[];for(let It=0;It<Ni.length;It++){const mr=Ni.feature(It),Zr=Ve.getId(mr,ni);Ca.push({feature:mr,id:Zr,index:It,sourceLayerIndex:Bo})}for(const It of ut[ni]){const mr=It[0];mr.source!==this.source&&L.w(`layer.source = ${mr.source} does not equal this.source = ${this.source}`),mr.isHidden(this.zoom,!0)||(Te(It,this.zoom,oe),(De[mr.id]=mr.createBucket({index:Ve.bucketLayerIDs.length,layers:It,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bo,sourceID:this.source})).populate(Ca,Le,this.tileID.canonical),Ve.bucketLayerIDs.push(It.map((Zr=>Zr.id))))}}const ht=L.bZ(Le.glyphDependencies,(ni=>Object.keys(ni).map(Number)));this.inFlightDependencies.forEach((ni=>ni?.abort())),this.inFlightDependencies=[];let Ut=Promise.resolve({});if(Object.keys(ht).length){const ni=new AbortController;this.inFlightDependencies.push(ni),Ut=ve.sendAsync({type:"GG",data:{stacks:ht,source:this.source,tileID:this.tileID,type:"glyphs"}},ni)}const qt=Object.keys(Le.iconDependencies);let pn=Promise.resolve({});if(qt.length){const ni=new AbortController;this.inFlightDependencies.push(ni),pn=ve.sendAsync({type:"GI",data:{icons:qt,source:this.source,tileID:this.tileID,type:"icons"}},ni)}const Dn=Object.keys(Le.patternDependencies);let Fn=Promise.resolve({});if(Dn.length){const ni=new AbortController;this.inFlightDependencies.push(ni),Fn=ve.sendAsync({type:"GI",data:{icons:Dn,source:this.source,tileID:this.tileID,type:"patterns"}},ni)}const Ge=Le.dashDependencies;let Jn=Promise.resolve({});if(Object.keys(Ge).length){const ni=new AbortController;this.inFlightDependencies.push(ni),Jn=ve.sendAsync({type:"GDA",data:{dashes:Ge}},ni)}const[qi,gn,xt,Zi]=yield Promise.all([Ut,pn,Fn,Jn]),Xn=new ue(qi),Ci=new L.cQ(gn,xt);for(const ni in De){const Ni=De[ni];Ni instanceof L.aj?(Te(Ni.layers,this.zoom,oe),L.cR({bucket:Ni,glyphMap:qi,glyphPositions:Xn.positions,imageMap:gn,imagePositions:Ci.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Le.subdivisionGranularity})):Ni.hasDependencies&&(Ni instanceof L.cS||Ni instanceof L.cT||Ni instanceof L.cU)&&(Te(Ni.layers,this.zoom,oe),Ni.addFeatures(Le,this.tileID.canonical,Ci.patternPositions,Zi))}return this.status="done",{buckets:Object.values(De).filter((ni=>!ni.isEmpty())),featureIndex:Ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Xn.image,imageAtlas:Ci,dashPositions:Zi,glyphMap:this.returnDependencies?qi:null,iconMap:this.returnDependencies?gn:null,glyphPositions:this.returnDependencies?Xn.positions:null}}))}}function Te(je,te,J){const oe=new L.H(te);for(const ve of je)ve.recalculate(oe,J)}class ce{constructor(te,J,oe,ve,xe){this.type=te,this.properties=oe||{},this.extent=xe,this.pointsArray=J,this.id=ve}loadGeometry(){return this.pointsArray.map((te=>te.map((J=>new L.P(J.x,J.y)))))}}class Pe{constructor(te,J,oe){this.version=2,this._myFeatures=te,this.name=J,this.length=te.length,this.extent=oe}feature(te){return this._myFeatures[te]}}class Oe{constructor(){this.layers={}}addLayer(te){this.layers[te.name]=te}}function Fe(je){let te=L.cV(je);return te.byteOffset===0&&te.byteLength===te.buffer.byteLength||(te=new Uint8Array(te)),{vectorTile:je,rawData:te.buffer}}function at(je,te,J){const{extent:oe}=je,ve=Math.pow(2,J.z-te.z),xe=(J.x-te.x*ve)*oe,He=(J.y-te.y*ve)*oe,Ve=[];for(let De=0;De<je.length;De++){const Le=je.feature(De);let ut=Le.loadGeometry();for(const Ut of ut)for(const qt of Ut)qt.x=qt.x*ve-xe,qt.y=qt.y*ve-He;const ht=128;ut=L.cW(ut,Le.type,-ht,-ht,oe+ht,oe+ht),ut.length!==0&&Ve.push(new ce(Le.type,ut,Le.properties,Le.id,oe))}return new Pe(Ve,je.name,oe)}class Ie{constructor(te,J,oe){this.actor=te,this.layerIndex=J,this.availableImages=oe,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new L.cX(1e3)}loadVectorTile(te,J){return L._(this,void 0,void 0,(function*(){const oe=yield L.n(te.request,J);try{return{vectorTile:te.encoding!=="mlt"?new L.cY(new L.cZ(oe.data)):new L.c_(oe.data),rawData:oe.data,cacheControl:oe.cacheControl,expires:oe.expires}}catch(ve){const xe=new Uint8Array(oe.data);let He=`Unable to parse the tile at ${te.request.url}, `;throw He+=xe[0]===31&&xe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ve.message}`,new Error(He)}}))}loadTile(te){return L._(this,void 0,void 0,(function*(){const{uid:J,overzoomParameters:oe}=te;oe&&(te.request=oe.overzoomRequest);const ve=!!(te&&te.request&&te.request.collectResourceTiming)&&new L.c$(te.request),xe=new ge(te);this.loading[J]=xe;const He=new AbortController;xe.abort=He;try{const Ve=yield this.loadVectorTile(te,He);if(delete this.loading[J],!Ve)return null;if(oe){const Ut=this._getOverzoomTile(te,Ve.vectorTile);Ve.rawData=Ut.rawData,Ve.vectorTile=Ut.vectorTile}const De=Ve.rawData,Le={};Ve.expires&&(Le.expires=Ve.expires),Ve.cacheControl&&(Le.cacheControl=Ve.cacheControl);const ut={};if(ve){const Ut=ve.finish();Ut&&(ut.resourceTiming=JSON.parse(JSON.stringify(Ut)))}xe.vectorTile=Ve.vectorTile;const ht=xe.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.actor,te.subdivisionGranularity);this.loaded[J]=xe,this.fetching[J]={rawTileData:De,cacheControl:Le,resourceTiming:ut};try{const Ut=yield ht;return L.e({rawTileData:De.slice(0),encoding:te.encoding},Ut,Le,ut)}finally{delete this.fetching[J]}}catch(Ve){throw delete this.loading[J],xe.status="done",this.loaded[J]=xe,Ve}}))}_getOverzoomTile(te,J){const{tileID:oe,source:ve,overzoomParameters:xe}=te,{maxZoomTileID:He}=xe,Ve=`${He.key}_${oe.key}`,De=this.overzoomedTileResultCache.get(Ve);if(De)return De;const Le=new Oe,ut=this.layerIndex.familiesBySource[ve];for(const Ut in ut){const qt=J.layers[Ut];if(!qt)continue;const pn=at(qt,He,oe.canonical);pn.length>0&&Le.addLayer(pn)}const ht=Fe(Le);return this.overzoomedTileResultCache.set(Ve,ht),ht}reloadTile(te){return L._(this,void 0,void 0,(function*(){const J=te.uid;if(!this.loaded||!this.loaded[J])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const oe=this.loaded[J];if(oe.showCollisionBoxes=te.showCollisionBoxes,oe.status==="parsing"){const ve=yield oe.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor,te.subdivisionGranularity);let xe;if(this.fetching[J]){const{rawTileData:He,cacheControl:Ve,resourceTiming:De}=this.fetching[J];delete this.fetching[J],xe=L.e({rawTileData:He.slice(0),encoding:te.encoding},ve,Ve,De)}else xe=ve;return xe}if(oe.status==="done"&&oe.vectorTile)return oe.parse(oe.vectorTile,this.layerIndex,this.availableImages,this.actor,te.subdivisionGranularity)}))}abortTile(te){return L._(this,void 0,void 0,(function*(){const J=this.loading,oe=te.uid;J&&J[oe]&&J[oe].abort&&(J[oe].abort.abort(),delete J[oe])}))}removeTile(te){return L._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[te.uid]&&delete this.loaded[te.uid]}))}}class Et{constructor(){this.loaded={}}loadTile(te){return L._(this,void 0,void 0,(function*(){const{uid:J,encoding:oe,rawImageData:ve,redFactor:xe,greenFactor:He,blueFactor:Ve,baseShift:De}=te,Le=ve.width+2,ut=ve.height+2,ht=L.b(ve)?new L.R({width:Le,height:ut},yield L.d0(ve,-1,-1,Le,ut)):ve,Ut=new L.d1(J,ht,oe,xe,He,Ve,De);return this.loaded=this.loaded||{},this.loaded[J]=Ut,Ut}))}removeTile(te){const J=this.loaded,oe=te.uid;J&&J[oe]&&delete J[oe]}}var vt,rt,At=(function(){if(rt)return vt;function je(J,oe){if(J.length!==0){te(J[0],oe);for(var ve=1;ve<J.length;ve++)te(J[ve],!oe)}}function te(J,oe){for(var ve=0,xe=0,He=0,Ve=J.length,De=Ve-1;He<Ve;De=He++){var Le=(J[He][0]-J[De][0])*(J[De][1]+J[He][1]),ut=ve+Le;xe+=Math.abs(ve)>=Math.abs(Le)?ve-ut+Le:Le-ut+ve,ve=ut}ve+xe>=0!=!!oe&&J.reverse()}return rt=1,vt=function J(oe,ve){var xe,He=oe&&oe.type;if(He==="FeatureCollection")for(xe=0;xe<oe.features.length;xe++)J(oe.features[xe],ve);else if(He==="GeometryCollection")for(xe=0;xe<oe.geometries.length;xe++)J(oe.geometries[xe],ve);else if(He==="Feature")J(oe.geometry,ve);else if(He==="Polygon")je(oe.coordinates,ve);else if(He==="MultiPolygon")for(xe=0;xe<oe.coordinates.length;xe++)je(oe.coordinates[xe],ve);return oe}})(),Mt=L.d2(At);const Lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:je=>je},_t=Math.fround||(Gt=new Float32Array(1),je=>(Gt[0]=+je,Gt[0]));var Gt;class Ft{constructor(te){this.options=Object.assign(Object.create(Lt),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:J,minZoom:oe,maxZoom:ve}=this.options;J&&console.time("total time");const xe=`prepare ${te.length} points`;J&&console.time(xe),this.points=te;const He=[];for(let De=0;De<te.length;De++){const Le=te[De];if(!Le.geometry)continue;const[ut,ht]=Le.geometry.coordinates,Ut=_t(sn(ut)),qt=_t(En(ht));He.push(Ut,qt,1/0,De,-1,1),this.options.reduce&&He.push(0)}let Ve=this.trees[ve+1]=this._createTree(He);J&&console.timeEnd(xe);for(let De=ve;De>=oe;De--){const Le=+Date.now();Ve=this.trees[De]=this._createTree(this._cluster(Ve,De)),J&&console.log("z%d: %d clusters in %dms",De,Ve.numItems,+Date.now()-Le)}return J&&console.timeEnd("total time"),this}getClusters(te,J){let oe=((te[0]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,te[1]));let xe=te[2]===180?180:((te[2]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)oe=-180,xe=180;else if(oe>xe){const ht=this.getClusters([oe,ve,180,He],J),Ut=this.getClusters([-180,ve,xe,He],J);return ht.concat(Ut)}const Ve=this.trees[this._limitZoom(J)],De=Ve.range(sn(oe),En(He),sn(xe),En(ve)),Le=Ve.data,ut=[];for(const ht of De){const Ut=this.stride*ht;ut.push(Le[Ut+5]>1?xn(Le,Ut,this.clusterProps):this.points[Le[Ut+3]])}return ut}getChildren(te){const J=this._getOriginId(te),oe=this._getOriginZoom(te),ve="No cluster with the specified id.",xe=this.trees[oe];if(!xe)throw new Error(ve);const He=xe.data;if(J*this.stride>=He.length)throw new Error(ve);const Ve=this.options.radius/(this.options.extent*Math.pow(2,oe-1)),De=xe.within(He[J*this.stride],He[J*this.stride+1],Ve),Le=[];for(const ut of De){const ht=ut*this.stride;He[ht+4]===te&&Le.push(He[ht+5]>1?xn(He,ht,this.clusterProps):this.points[He[ht+3]])}if(Le.length===0)throw new Error(ve);return Le}getLeaves(te,J,oe){const ve=[];return this._appendLeaves(ve,te,J=J||10,oe=oe||0,0),ve}getTile(te,J,oe){const ve=this.trees[this._limitZoom(te)],xe=Math.pow(2,te),{extent:He,radius:Ve}=this.options,De=Ve/He,Le=(oe-De)/xe,ut=(oe+1+De)/xe,ht={features:[]};return this._addTileFeatures(ve.range((J-De)/xe,Le,(J+1+De)/xe,ut),ve.data,J,oe,xe,ht),J===0&&this._addTileFeatures(ve.range(1-De/xe,Le,1,ut),ve.data,xe,oe,xe,ht),J===xe-1&&this._addTileFeatures(ve.range(0,Le,De/xe,ut),ve.data,-1,oe,xe,ht),ht.features.length?ht:null}getClusterExpansionZoom(te){let J=this._getOriginZoom(te)-1;for(;J<=this.options.maxZoom;){const oe=this.getChildren(te);if(J++,oe.length!==1)break;te=oe[0].properties.cluster_id}return J}_appendLeaves(te,J,oe,ve,xe){const He=this.getChildren(J);for(const Ve of He){const De=Ve.properties;if(De&&De.cluster?xe+De.point_count<=ve?xe+=De.point_count:xe=this._appendLeaves(te,De.cluster_id,oe,ve,xe):xe<ve?xe++:te.push(Ve),te.length===oe)break}return xe}_createTree(te){const J=new L.aU(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let oe=0;oe<te.length;oe+=this.stride)J.add(te[oe],te[oe+1]);return J.finish(),J.data=te,J}_addTileFeatures(te,J,oe,ve,xe,He){for(const Ve of te){const De=Ve*this.stride,Le=J[De+5]>1;let ut,ht,Ut;if(Le)ut=dn(J,De,this.clusterProps),ht=J[De],Ut=J[De+1];else{const Dn=this.points[J[De+3]];ut=Dn.properties;const[Fn,Ge]=Dn.geometry.coordinates;ht=sn(Fn),Ut=En(Ge)}const qt={type:1,geometry:[[Math.round(this.options.extent*(ht*xe-oe)),Math.round(this.options.extent*(Ut*xe-ve))]],tags:ut};let pn;pn=Le||this.options.generateId?J[De+3]:this.points[J[De+3]].id,pn!==void 0&&(qt.id=pn),He.features.push(qt)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,J){const{radius:oe,extent:ve,reduce:xe,minPoints:He}=this.options,Ve=oe/(ve*Math.pow(2,J)),De=te.data,Le=[],ut=this.stride;for(let ht=0;ht<De.length;ht+=ut){if(De[ht+2]<=J)continue;De[ht+2]=J;const Ut=De[ht],qt=De[ht+1],pn=te.within(De[ht],De[ht+1],Ve),Dn=De[ht+5];let Fn=Dn;for(const Ge of pn){const Jn=Ge*ut;De[Jn+2]>J&&(Fn+=De[Jn+5])}if(Fn>Dn&&Fn>=He){let Ge,Jn=Ut*Dn,qi=qt*Dn,gn=-1;const xt=(ht/ut<<5)+(J+1)+this.points.length;for(const Zi of pn){const Xn=Zi*ut;if(De[Xn+2]<=J)continue;De[Xn+2]=J;const Ci=De[Xn+5];Jn+=De[Xn]*Ci,qi+=De[Xn+1]*Ci,De[Xn+4]=xt,xe&&(Ge||(Ge=this._map(De,ht,!0),gn=this.clusterProps.length,this.clusterProps.push(Ge)),xe(Ge,this._map(De,Xn)))}De[ht+4]=xt,Le.push(Jn/Fn,qi/Fn,1/0,xt,-1,Fn),xe&&Le.push(gn)}else{for(let Ge=0;Ge<ut;Ge++)Le.push(De[ht+Ge]);if(Fn>1)for(const Ge of pn){const Jn=Ge*ut;if(!(De[Jn+2]<=J)){De[Jn+2]=J;for(let qi=0;qi<ut;qi++)Le.push(De[Jn+qi])}}}}return Le}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,J,oe){if(te[J+5]>1){const He=this.clusterProps[te[J+6]];return oe?Object.assign({},He):He}const ve=this.points[te[J+3]].properties,xe=this.options.map(ve);return oe&&xe===ve?Object.assign({},xe):xe}}function xn(je,te,J){return{type:"Feature",id:je[te+3],properties:dn(je,te,J),geometry:{type:"Point",coordinates:[(oe=je[te],360*(oe-.5)),Rt(je[te+1])]}};var oe}function dn(je,te,J){const oe=je[te+5],ve=oe>=1e4?`${Math.round(oe/1e3)}k`:oe>=1e3?Math.round(oe/100)/10+"k":oe,xe=je[te+6],He=xe===-1?{}:Object.assign({},J[xe]);return Object.assign(He,{cluster:!0,cluster_id:je[te+3],point_count:oe,point_count_abbreviated:ve})}function sn(je){return je/360+.5}function En(je){const te=Math.sin(je*Math.PI/180),J=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return J<0?0:J>1?1:J}function Rt(je){const te=(180-360*je)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function fn(je,te,J,oe){let ve=oe;const xe=te+(J-te>>1);let He,Ve=J-te;const De=je[te],Le=je[te+1],ut=je[J],ht=je[J+1];for(let Ut=te+3;Ut<J;Ut+=3){const qt=Je(je[Ut],je[Ut+1],De,Le,ut,ht);if(qt>ve)He=Ut,ve=qt;else if(qt===ve){const pn=Math.abs(Ut-xe);pn<Ve&&(He=Ut,Ve=pn)}}ve>oe&&(He-te>3&&fn(je,te,He,oe),je[He+2]=ve,J-He>3&&fn(je,He,J,oe))}function Je(je,te,J,oe,ve,xe){let He=ve-J,Ve=xe-oe;if(He!==0||Ve!==0){const De=((je-J)*He+(te-oe)*Ve)/(He*He+Ve*Ve);De>1?(J=ve,oe=xe):De>0&&(J+=He*De,oe+=Ve*De)}return He=je-J,Ve=te-oe,He*He+Ve*Ve}function Tt(je,te,J,oe){const ve={id:je??null,type:te,geometry:J,tags:oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")$t(ve,J);else if(te==="Polygon")$t(ve,J[0]);else if(te==="MultiLineString")for(const xe of J)$t(ve,xe);else if(te==="MultiPolygon")for(const xe of J)$t(ve,xe[0]);return ve}function $t(je,te){for(let J=0;J<te.length;J+=3)je.minX=Math.min(je.minX,te[J]),je.minY=Math.min(je.minY,te[J+1]),je.maxX=Math.max(je.maxX,te[J]),je.maxY=Math.max(je.maxY,te[J+1])}function Ht(je,te,J,oe){if(!te.geometry)return;const ve=te.geometry.coordinates;if(ve&&ve.length===0)return;const xe=te.geometry.type,He=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let Ve=[],De=te.id;if(J.promoteId?De=te.properties[J.promoteId]:J.generateId&&(De=oe||0),xe==="Point")Pt(ve,Ve);else if(xe==="MultiPoint")for(const Le of ve)Pt(Le,Ve);else if(xe==="LineString")Re(ve,Ve,He,!1);else if(xe==="MultiLineString"){if(J.lineMetrics){for(const Le of ve)Ve=[],Re(Le,Ve,He,!1),je.push(Tt(De,"LineString",Ve,te.properties));return}lt(ve,Ve,He,!1)}else if(xe==="Polygon")lt(ve,Ve,He,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const Le of te.geometry.geometries)Ht(je,{id:De,geometry:Le,properties:te.properties},J,oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Le of ve){const ut=[];lt(Le,ut,He,!0),Ve.push(ut)}}je.push(Tt(De,xe,Ve,te.properties))}function Pt(je,te){te.push(zt(je[0]),Ct(je[1]),0)}function Re(je,te,J,oe){let ve,xe,He=0;for(let De=0;De<je.length;De++){const Le=zt(je[De][0]),ut=Ct(je[De][1]);te.push(Le,ut,0),De>0&&(He+=oe?(ve*ut-Le*xe)/2:Math.sqrt(Math.pow(Le-ve,2)+Math.pow(ut-xe,2))),ve=Le,xe=ut}const Ve=te.length-3;te[2]=1,fn(te,0,Ve,J),te[Ve+2]=1,te.size=Math.abs(He),te.start=0,te.end=te.size}function lt(je,te,J,oe){for(let ve=0;ve<je.length;ve++){const xe=[];Re(je[ve],xe,J,oe),te.push(xe)}}function zt(je){return je/360+.5}function Ct(je){const te=Math.sin(je*Math.PI/180),J=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return J<0?0:J>1?1:J}function en(je,te,J,oe,ve,xe,He,Ve){if(oe/=te,xe>=(J/=te)&&He<oe)return je;if(He<J||xe>=oe)return null;const De=[];for(const Le of je){const ut=Le.geometry;let ht=Le.type;const Ut=ve===0?Le.minX:Le.minY,qt=ve===0?Le.maxX:Le.maxY;if(Ut>=J&&qt<oe){De.push(Le);continue}if(qt<J||Ut>=oe)continue;let pn=[];if(ht==="Point"||ht==="MultiPoint")Mn(ut,pn,J,oe,ve);else if(ht==="LineString")Rn(ut,pn,J,oe,ve,!1,Ve.lineMetrics);else if(ht==="MultiLineString")yi(ut,pn,J,oe,ve,!1);else if(ht==="Polygon")yi(ut,pn,J,oe,ve,!0);else if(ht==="MultiPolygon")for(const Dn of ut){const Fn=[];yi(Dn,Fn,J,oe,ve,!0),Fn.length&&pn.push(Fn)}if(pn.length){if(Ve.lineMetrics&&ht==="LineString"){for(const Dn of pn)De.push(Tt(Le.id,ht,Dn,Le.tags));continue}ht!=="LineString"&&ht!=="MultiLineString"||(pn.length===1?(ht="LineString",pn=pn[0]):ht="MultiLineString"),ht!=="Point"&&ht!=="MultiPoint"||(ht=pn.length===3?"Point":"MultiPoint"),De.push(Tt(Le.id,ht,pn,Le.tags))}}return De.length?De:null}function Mn(je,te,J,oe,ve){for(let xe=0;xe<je.length;xe+=3){const He=je[xe+ve];He>=J&&He<=oe&&Ln(te,je[xe],je[xe+1],je[xe+2])}}function Rn(je,te,J,oe,ve,xe,He){let Ve=Ue(je);const De=ve===0?rn:Se;let Le,ut,ht=je.start;for(let Fn=0;Fn<je.length-3;Fn+=3){const Ge=je[Fn],Jn=je[Fn+1],qi=je[Fn+2],gn=je[Fn+3],xt=je[Fn+4],Zi=ve===0?Ge:Jn,Xn=ve===0?gn:xt;let Ci=!1;He&&(Le=Math.sqrt(Math.pow(Ge-gn,2)+Math.pow(Jn-xt,2))),Zi<J?Xn>J&&(ut=De(Ve,Ge,Jn,gn,xt,J),He&&(Ve.start=ht+Le*ut)):Zi>oe?Xn<oe&&(ut=De(Ve,Ge,Jn,gn,xt,oe),He&&(Ve.start=ht+Le*ut)):Ln(Ve,Ge,Jn,qi),Xn<J&&Zi>=J&&(ut=De(Ve,Ge,Jn,gn,xt,J),Ci=!0),Xn>oe&&Zi<=oe&&(ut=De(Ve,Ge,Jn,gn,xt,oe),Ci=!0),!xe&&Ci&&(He&&(Ve.end=ht+Le*ut),te.push(Ve),Ve=Ue(je)),He&&(ht+=Le)}let Ut=je.length-3;const qt=je[Ut],pn=je[Ut+1],Dn=ve===0?qt:pn;Dn>=J&&Dn<=oe&&Ln(Ve,qt,pn,je[Ut+2]),Ut=Ve.length-3,xe&&Ut>=3&&(Ve[Ut]!==Ve[0]||Ve[Ut+1]!==Ve[1])&&Ln(Ve,Ve[0],Ve[1],Ve[2]),Ve.length&&te.push(Ve)}function Ue(je){const te=[];return te.size=je.size,te.start=je.start,te.end=je.end,te}function yi(je,te,J,oe,ve,xe){for(const He of je)Rn(He,te,J,oe,ve,xe,!1)}function Ln(je,te,J,oe){je.push(te,J,oe)}function rn(je,te,J,oe,ve,xe){const He=(xe-te)/(oe-te);return Ln(je,xe,J+(ve-J)*He,1),He}function Se(je,te,J,oe,ve,xe){const He=(xe-J)/(ve-J);return Ln(je,te+(oe-te)*He,xe,1),He}function oa(je,te){const J=[];for(let oe=0;oe<je.length;oe++){const ve=je[oe],xe=ve.type;let He;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")He=vi(ve.geometry,te);else if(xe==="MultiLineString"||xe==="Polygon"){He=[];for(const Ve of ve.geometry)He.push(vi(Ve,te))}else if(xe==="MultiPolygon"){He=[];for(const Ve of ve.geometry){const De=[];for(const Le of Ve)De.push(vi(Le,te));He.push(De)}}J.push(Tt(ve.id,xe,He,ve.tags))}return J}function vi(je,te){const J=[];J.size=je.size,je.start!==void 0&&(J.start=je.start,J.end=je.end);for(let oe=0;oe<je.length;oe+=3)J.push(je[oe]+te,je[oe+1],je[oe+2]);return J}function er(je,te){if(je.transformed)return je;const J=1<<je.z,oe=je.x,ve=je.y;for(const xe of je.features){const He=xe.geometry,Ve=xe.type;if(xe.geometry=[],Ve===1)for(let De=0;De<He.length;De+=2)xe.geometry.push(Ma(He[De],He[De+1],te,J,oe,ve));else for(let De=0;De<He.length;De++){const Le=[];for(let ut=0;ut<He[De].length;ut+=2)Le.push(Ma(He[De][ut],He[De][ut+1],te,J,oe,ve));xe.geometry.push(Le)}}return je.transformed=!0,je}function Ma(je,te,J,oe,ve,xe){return[Math.round(J*(je*oe-ve)),Math.round(J*(te*oe-xe))]}function Ai(je,te,J,oe,ve){const xe=te===ve.maxZoom?0:ve.tolerance/((1<<te)*ve.extent),He={features:[],numPoints:0,numSimplified:0,numFeatures:je.length,source:null,x:J,y:oe,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ve of je)Vs(He,Ve,xe,ve);return He}function Vs(je,te,J,oe){const ve=te.geometry,xe=te.type,He=[];if(je.minX=Math.min(je.minX,te.minX),je.minY=Math.min(je.minY,te.minY),je.maxX=Math.max(je.maxX,te.maxX),je.maxY=Math.max(je.maxY,te.maxY),xe==="Point"||xe==="MultiPoint")for(let Ve=0;Ve<ve.length;Ve+=3)He.push(ve[Ve],ve[Ve+1]),je.numPoints++,je.numSimplified++;else if(xe==="LineString")Dt(He,ve,je,J,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let Ve=0;Ve<ve.length;Ve++)Dt(He,ve[Ve],je,J,xe==="Polygon",Ve===0);else if(xe==="MultiPolygon")for(let Ve=0;Ve<ve.length;Ve++){const De=ve[Ve];for(let Le=0;Le<De.length;Le++)Dt(He,De[Le],je,J,!0,Le===0)}if(He.length){let Ve=te.tags||null;if(xe==="LineString"&&oe.lineMetrics){Ve={};for(const Le in te.tags)Ve[Le]=te.tags[Le];Ve.mapbox_clip_start=ve.start/ve.size,Ve.mapbox_clip_end=ve.end/ve.size}const De={geometry:He,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:Ve};te.id!==null&&(De.id=te.id),je.features.push(De)}}function Dt(je,te,J,oe,ve,xe){const He=oe*oe;if(oe>0&&te.size<(ve?He:oe))return void(J.numPoints+=te.length/3);const Ve=[];for(let De=0;De<te.length;De+=3)(oe===0||te[De+2]>He)&&(J.numSimplified++,Ve.push(te[De],te[De+1])),J.numPoints++;ve&&(function(De,Le){let ut=0;for(let ht=0,Ut=De.length,qt=Ut-2;ht<Ut;qt=ht,ht+=2)ut+=(De[ht]-De[qt])*(De[ht+1]+De[qt+1]);if(ut>0===Le)for(let ht=0,Ut=De.length;ht<Ut/2;ht+=2){const qt=De[ht],pn=De[ht+1];De[ht]=De[Ut-2-ht],De[ht+1]=De[Ut-1-ht],De[Ut-2-ht]=qt,De[Ut-1-ht]=pn}})(Ve,xe),je.push(Ve)}const Us={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class rs{constructor(te,J){const oe=(J=this.options=(function(xe,He){for(const Ve in He)xe[Ve]=He[Ve];return xe})(Object.create(Us),J)).debug;if(oe&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let ve=(function(xe,He){const Ve=[];if(xe.type==="FeatureCollection")for(let De=0;De<xe.features.length;De++)Ht(Ve,xe.features[De],He,De);else Ht(Ve,xe.type==="Feature"?xe:{geometry:xe},He);return Ve})(te,J);this.tiles={},this.tileCoords=[],oe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ve=(function(xe,He){const Ve=He.buffer/He.extent;let De=xe;const Le=en(xe,1,-1-Ve,Ve,0,-1,2,He),ut=en(xe,1,1-Ve,2+Ve,0,-1,2,He);return(Le||ut)&&(De=en(xe,1,-Ve,1+Ve,0,-1,2,He)||[],Le&&(De=oa(Le,1).concat(De)),ut&&(De=De.concat(oa(ut,-1)))),De})(ve,J),ve.length&&this.splitTile(ve,0,0,0),oe&&(ve.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,J,oe,ve,xe,He,Ve){const De=[te,J,oe,ve],Le=this.options,ut=Le.debug;for(;De.length;){ve=De.pop(),oe=De.pop(),J=De.pop(),te=De.pop();const ht=1<<J,Ut=zr(J,oe,ve);let qt=this.tiles[Ut];if(!qt&&(ut>1&&console.time("creation"),qt=this.tiles[Ut]=Ai(te,J,oe,ve,Le),this.tileCoords.push({z:J,x:oe,y:ve}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,oe,ve,qt.numFeatures,qt.numPoints,qt.numSimplified),console.timeEnd("creation"));const Ci=`z${J}`;this.stats[Ci]=(this.stats[Ci]||0)+1,this.total++}if(qt.source=te,xe==null){if(J===Le.indexMaxZoom||qt.numPoints<=Le.indexMaxPoints)continue}else{if(J===Le.maxZoom||J===xe)continue;if(xe!=null){const Ci=xe-J;if(oe!==He>>Ci||ve!==Ve>>Ci)continue}}if(qt.source=null,te.length===0)continue;ut>1&&console.time("clipping");const pn=.5*Le.buffer/Le.extent,Dn=.5-pn,Fn=.5+pn,Ge=1+pn;let Jn=null,qi=null,gn=null,xt=null,Zi=en(te,ht,oe-pn,oe+Fn,0,qt.minX,qt.maxX,Le),Xn=en(te,ht,oe+Dn,oe+Ge,0,qt.minX,qt.maxX,Le);te=null,Zi&&(Jn=en(Zi,ht,ve-pn,ve+Fn,1,qt.minY,qt.maxY,Le),qi=en(Zi,ht,ve+Dn,ve+Ge,1,qt.minY,qt.maxY,Le),Zi=null),Xn&&(gn=en(Xn,ht,ve-pn,ve+Fn,1,qt.minY,qt.maxY,Le),xt=en(Xn,ht,ve+Dn,ve+Ge,1,qt.minY,qt.maxY,Le),Xn=null),ut>1&&console.timeEnd("clipping"),De.push(Jn||[],J+1,2*oe,2*ve),De.push(qi||[],J+1,2*oe,2*ve+1),De.push(gn||[],J+1,2*oe+1,2*ve),De.push(xt||[],J+1,2*oe+1,2*ve+1)}}getTile(te,J,oe){te=+te,J=+J,oe=+oe;const ve=this.options,{extent:xe,debug:He}=ve;if(te<0||te>24)return null;const Ve=1<<te,De=zr(te,J=J+Ve&Ve-1,oe);if(this.tiles[De])return er(this.tiles[De],xe);He>1&&console.log("drilling down to z%d-%d-%d",te,J,oe);let Le,ut=te,ht=J,Ut=oe;for(;!Le&&ut>0;)ut--,ht>>=1,Ut>>=1,Le=this.tiles[zr(ut,ht,Ut)];return Le&&Le.source?(He>1&&(console.log("found parent tile z%d-%d-%d",ut,ht,Ut),console.time("drilling down")),this.splitTile(Le.source,ut,ht,Ut,te,J,oe),He>1&&console.timeEnd("drilling down"),this.tiles[De]?er(this.tiles[De],xe):null):null}}function zr(je,te,J){return 32*((1<<je)*J+te)+je}class pl extends Ie{constructor(te,J,oe,ve=ln){super(te,J,oe),this._dataUpdateable=new Map,this._createGeoJSONIndex=ve}loadVectorTile(te,J){return L._(this,void 0,void 0,(function*(){const oe=te.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ve=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);return ve?Fe(new L.d3(ve.features,{version:2,extent:L.a5})):null}))}loadData(te){return L._(this,void 0,void 0,(function*(){var J;(J=this._pendingRequest)===null||J===void 0||J.abort();const oe=this._startPerformance(te);this._pendingRequest=new AbortController;try{(!this._pendingData||te.request||te.data||te.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(te,this._pendingRequest));const ve=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(ve,te),this.loaded={};const xe={};return this._finishPerformance(oe,te,xe),xe}catch(ve){if(delete this._pendingRequest,L.Z(ve))return{abandoned:!0};throw ve}}))}_startPerformance(te){var J;if(!((J=te?.request)===null||J===void 0)&&J.collectResourceTiming)return new L.c$(te.request)}_finishPerformance(te,J,oe){if(!te)return;const ve=te.finish();ve&&(oe.resourceTiming={},oe.resourceTiming[J.source]=JSON.parse(JSON.stringify(ve)))}getData(){return L._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(te){const J=this.loaded;return J&&J[te.uid]?super.reloadTile(te):this.loadTile(te)}loadAndProcessGeoJSON(te,J){return L._(this,void 0,void 0,(function*(){let oe;if(te.request?oe=yield this.loadGeoJSONFromUrl(te.request,te.promoteId,J):te.data?oe=this._loadGeoJSONFromObject(te.data,te.promoteId):te.dataDiff&&(oe=this._loadGeoJSONFromDiff(te.dataDiff,te.promoteId,te.source)),delete this._pendingRequest,typeof oe!="object")throw new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`);return Mt(oe,!0),te.filter&&(oe=this._filterGeoJSON(oe,te.filter)),oe}))}loadGeoJSONFromUrl(te,J,oe){return L._(this,void 0,void 0,(function*(){const ve=yield L.j(te,oe);return this._dataUpdateable=L.a7(ve.data,J)?L.a8(ve.data,J):void 0,ve.data}))}_loadGeoJSONFromObject(te,J){return this._dataUpdateable=L.a7(te,J)?L.a8(te,J):void 0,te}_loadGeoJSONFromDiff(te,J,oe){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${oe}`);L.a9(this._dataUpdateable,te,J);const ve=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(ve)}_filterGeoJSON(te,J){const oe=L.d4(J,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(oe.result==="error")throw new Error(oe.value.map((xe=>`${xe.key}: ${xe.message}`)).join(", "));const ve=te.features.filter((xe=>oe.value.evaluate({zoom:0},xe)));return this._toFeatureCollection(ve)}_toFeatureCollection(te){return{type:"FeatureCollection",features:te}}removeSource(te){return L._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(te){return this._geoJSONIndex.getClusterExpansionZoom(te.clusterId)}getClusterChildren(te){return this._geoJSONIndex.getChildren(te.clusterId)}getClusterLeaves(te){return this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset)}}function ln(je,te){return te.cluster?new Ft((function({superclusterOptions:J,clusterProperties:oe}){if(!oe||!J)return J;const ve={},xe={},He={accumulated:null,zoom:0},Ve={properties:null},De=Object.keys(oe);for(const Le of De){const[ut,ht]=oe[Le],Ut=L.d4(ht),qt=L.d4(typeof ut=="string"?[ut,["accumulated"],["get",Le]]:ut);ve[Le]=Ut.value,xe[Le]=qt.value}return J.map=Le=>{Ve.properties=Le;const ut={};for(const ht of De)ut[ht]=ve[ht].evaluate(He,Ve);return ut},J.reduce=(Le,ut)=>{Ve.properties=ut;for(const ht of De)He.accumulated=Le[ht],Le[ht]=xe[ht].evaluate(He,Ve)},J})(te)).load(je.features):(function(J,oe){return new rs(J,oe)})(je,te.geojsonVtOptions)}class wr{constructor(te){this.self=te,this.actor=new L.L(te),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(J,oe)=>{if(this.externalWorkerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.externalWorkerSourceTypes[J]=oe},this.self.addProtocol=L.cK,this.self.removeProtocol=L.cL,this.self.registerRTLTextPlugin=J=>{L.d5.setMethods(J)},this.actor.registerMessageHandler("LDT",((J,oe)=>this._getDEMWorkerSource(J,oe.source).loadTile(oe))),this.actor.registerMessageHandler("RDT",((J,oe)=>L._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(J,oe.source).removeTile(oe)})))),this.actor.registerMessageHandler("GCEZ",((J,oe)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(J,oe.type,oe.source).getClusterExpansionZoom(oe)})))),this.actor.registerMessageHandler("GCC",((J,oe)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(J,oe.type,oe.source).getClusterChildren(oe)})))),this.actor.registerMessageHandler("GCL",((J,oe)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(J,oe.type,oe.source).getClusterLeaves(oe)})))),this.actor.registerMessageHandler("LD",((J,oe)=>this._getWorkerSource(J,oe.type,oe.source).loadData(oe))),this.actor.registerMessageHandler("GD",((J,oe)=>this._getWorkerSource(J,oe.type,oe.source).getData())),this.actor.registerMessageHandler("LT",((J,oe)=>this._getWorkerSource(J,oe.type,oe.source).loadTile(oe))),this.actor.registerMessageHandler("RT",((J,oe)=>this._getWorkerSource(J,oe.type,oe.source).reloadTile(oe))),this.actor.registerMessageHandler("AT",((J,oe)=>this._getWorkerSource(J,oe.type,oe.source).abortTile(oe))),this.actor.registerMessageHandler("RMT",((J,oe)=>this._getWorkerSource(J,oe.type,oe.source).removeTile(oe))),this.actor.registerMessageHandler("RS",((J,oe)=>L._(this,void 0,void 0,(function*(){if(!this.workerSources[J]||!this.workerSources[J][oe.type]||!this.workerSources[J][oe.type][oe.source])return;const ve=this.workerSources[J][oe.type][oe.source];delete this.workerSources[J][oe.type][oe.source],ve.removeSource!==void 0&&ve.removeSource(oe)})))),this.actor.registerMessageHandler("RM",(J=>L._(this,void 0,void 0,(function*(){delete this.layerIndexes[J],delete this.availableImages[J],delete this.workerSources[J],delete this.demWorkerSources[J],this.globalStates.delete(J)})))),this.actor.registerMessageHandler("SR",((J,oe)=>L._(this,void 0,void 0,(function*(){this.referrer=oe})))),this.actor.registerMessageHandler("SRPS",((J,oe)=>this._syncRTLPluginState(J,oe))),this.actor.registerMessageHandler("IS",((J,oe)=>L._(this,void 0,void 0,(function*(){this.self.importScripts(oe)})))),this.actor.registerMessageHandler("SI",((J,oe)=>this._setImages(J,oe))),this.actor.registerMessageHandler("UL",((J,oe)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(J).update(oe.layers,oe.removedIds,this._getGlobalState(J))})))),this.actor.registerMessageHandler("UGS",((J,oe)=>L._(this,void 0,void 0,(function*(){const ve=this._getGlobalState(J);for(const xe in oe)ve[xe]=oe[xe]})))),this.actor.registerMessageHandler("SL",((J,oe)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(J).replace(oe,this._getGlobalState(J))}))))}_getGlobalState(te){let J=this.globalStates.get(te);return J||(J={},this.globalStates.set(te,J)),J}_setImages(te,J){return L._(this,void 0,void 0,(function*(){this.availableImages[te]=J;for(const oe in this.workerSources[te]){const ve=this.workerSources[te][oe];for(const xe in ve)ve[xe].availableImages=J}}))}_syncRTLPluginState(te,J){return L._(this,void 0,void 0,(function*(){return yield L.d5.syncState(J,this.self.importScripts)}))}_getAvailableImages(te){let J=this.availableImages[te];return J||(J=[]),J}_getLayerIndex(te){let J=this.layerIndexes[te];return J||(J=this.layerIndexes[te]=new f),J}_getWorkerSource(te,J,oe){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][J]||(this.workerSources[te][J]={}),!this.workerSources[te][J][oe]){const ve={sendAsync:(xe,He)=>(xe.targetMapId=te,this.actor.sendAsync(xe,He))};switch(J){case"vector":this.workerSources[te][J][oe]=new Ie(ve,this._getLayerIndex(te),this._getAvailableImages(te));break;case"geojson":this.workerSources[te][J][oe]=new pl(ve,this._getLayerIndex(te),this._getAvailableImages(te));break;default:this.workerSources[te][J][oe]=new this.externalWorkerSourceTypes[J](ve,this._getLayerIndex(te),this._getAvailableImages(te))}}return this.workerSources[te][J][oe]}_getDEMWorkerSource(te,J){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][J]||(this.demWorkerSources[te][J]=new Et),this.demWorkerSources[te][J]}}return L.i(self)&&(self.worker=new wr(self)),wr})),U("index",["exports","./shared"],(function(L,f){var ue="5.14.0";function ge(){var v=new f.A(4);return f.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}let Te,ce,Pe;const Oe={frame(v,t,a){const c=requestAnimationFrame((b=>{p(),t(b)})),{unsubscribe:p}=f.s(v.signal,"abort",(()=>{p(),cancelAnimationFrame(c),a(new f.a(v.signal.reason))}),!1)},frameAsync(v){return new Promise(((t,a)=>{this.frame(v,t,a)}))},getImageData(v,t=0){return this.getImageCanvasContext(v).getImageData(-t,-t,v.width+2*t,v.height+2*t)},getImageCanvasContext(v){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=v.width,t.height=v.height,a.drawImage(v,0,0,v.width,v.height),a},resolveURL:v=>(Te||(Te=document.createElement("a")),Te.href=v,Te.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return Pe!==void 0?Pe:!!matchMedia&&(ce==null&&(ce=matchMedia("(prefers-reduced-motion: reduce)")),ce.matches)},set prefersReducedMotion(v){Pe=v}},Fe=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(v){this._frozenAt=v}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function at(){return Fe.getCurrentTime()}class Ie{static testProp(t){if(!Ie.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in Ie.docStyle)return t[a];return t[0]}static create(t,a,c){const p=window.document.createElement(t);return a!==void 0&&(p.className=a),c&&c.appendChild(p),p}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){Ie.docStyle&&Ie.selectProp&&(Ie.userSelect=Ie.docStyle[Ie.selectProp],Ie.docStyle[Ie.selectProp]="none")}static enableDrag(){Ie.docStyle&&Ie.selectProp&&(Ie.docStyle[Ie.selectProp]=Ie.userSelect)}static setTransform(t,a){t.style[Ie.transformProp]=a}static addEventListener(t,a,c,p={}){t.addEventListener(a,c,"passive"in p?p:p.capture)}static removeEventListener(t,a,c,p={}){t.removeEventListener(a,c,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Ie.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ie.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Ie.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,c){const p=a.boundingClientRect;return new f.P((c.clientX-p.left)/a.x-t.clientLeft,(c.clientY-p.top)/a.y-t.clientTop)}static mousePos(t,a){const c=Ie.getScale(t);return Ie.getPoint(t,c,a)}static touchPos(t,a){const c=[],p=Ie.getScale(t);for(let b=0;b<a.length;b++)c.push(Ie.getPoint(t,p,a[b]));return c}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),c=a.querySelectorAll("script");for(const p of c)p.remove();return Ie.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const c=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!c.includes("javascript:")&&!c.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const c of a)Ie.removeAttributes(c),Ie.clean(c)}static removeAttributes(t){for(const{name:a,value:c}of t.attributes)Ie.isPossiblyDangerous(a,c)&&t.removeAttribute(a)}}Ie.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ie.selectProp=Ie.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ie.transformProp=Ie.testProp(["transform","WebkitTransform"]);const Et={supported:!1,testSupport:function(v){!At&&rt&&(Mt?Lt(v):vt=v)}};let vt,rt,At=!1,Mt=!1;function Lt(v){const t=v.createTexture();v.bindTexture(v.TEXTURE_2D,t);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,rt),v.isContextLost())return;Et.supported=!0}catch{}v.deleteTexture(t),At=!0}var _t;typeof document<"u"&&(rt=document.createElement("img"),rt.onload=()=>{vt&&Lt(vt),vt=null,Mt=!0},rt.onerror=()=>{At=!0,vt=null},rt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(v){let t,a,c,p;v.resetRequestQueue=()=>{t=[],a=0,c=0,p={}},v.addThrottleControl=A=>{const z=c++;return p[z]=A,z},v.removeThrottleControl=A=>{delete p[A],T()},v.getImage=(A,z,N=!0)=>new Promise(((Z,q)=>{Et.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),f.e(A,{type:"image"}),t.push({abortController:z,requestParameters:A,supportImageRefresh:N,state:"queued",onError:Q=>{q(Q)},onSuccess:Q=>{Z(Q)}}),T()}));const b=A=>f._(this,void 0,void 0,(function*(){A.state="running";const{requestParameters:z,supportImageRefresh:N,onError:Z,onSuccess:q,abortController:Q}=A,ne=N===!1&&!f.i(self)&&!f.g(z.url)&&(!z.headers||Object.keys(z.headers).reduce(((de,me)=>de&&me==="accept"),!0));a++;const he=ne?C(z,Q):f.m(z,Q);try{const de=yield he;delete A.abortController,A.state="completed",de.data instanceof HTMLImageElement||f.b(de.data)?q(de):de.data&&q({data:yield(pe=de.data,typeof createImageBitmap=="function"?f.f(pe):f.h(pe)),cacheControl:de.cacheControl,expires:de.expires})}catch(de){delete A.abortController,Z(de)}finally{a--,T()}var pe})),T=()=>{const A=(()=>{for(const z of Object.keys(p))if(p[z]())return!0;return!1})()?f.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:f.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let z=a;z<A&&t.length>0;z++){const N=t.shift();N.abortController.signal.aborted?z--:b(N)}},C=(A,z)=>new Promise(((N,Z)=>{const q=new Image,Q=A.url,ne=A.credentials;ne&&ne==="include"?q.crossOrigin="use-credentials":(ne&&ne==="same-origin"||!f.d(Q))&&(q.crossOrigin="anonymous"),z.signal.addEventListener("abort",(()=>{q.src="",Z(new f.a(z.signal.reason))})),q.fetchPriority="high",q.onload=()=>{q.onerror=q.onload=null,N({data:q})},q.onerror=()=>{q.onerror=q.onload=null,z.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},q.src=Q}))})(_t||(_t={})),_t.resetRequestQueue();class Gt{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function Ft(v){const t=[];if(typeof v=="string")t.push({id:"default",url:v});else if(v&&v.length>0){const a=[];for(const{id:c,url:p}of v){const b=`${c}${p}`;a.indexOf(b)===-1&&(a.push(b),t.push({id:c,url:p}))}}return t}function xn(v,t,a){try{const c=new URL(v);return c.pathname+=`${t}${a}`,c.toString()}catch{throw new Error(`Invalid sprite URL "${v}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function dn(v){const{userImage:t}=v;return!!(t&&t.render&&t.render())&&(v.data.replace(new Uint8Array(t.data.buffer)),!0)}class sn extends f.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new f.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new f.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:c}of this.requestors)c(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const c=a.spriteData;a.data=new f.R({width:c.width,height:c.height},c.context.getImageData(c.x,c.y,c.width,c.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let c=!0;const p=a.data||a.spriteData;return this._validateStretch(a.stretchX,p&&p.width)||(this.fire(new f.k(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(a.stretchY,p&&p.height)||(this.fire(new f.k(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(a.content,a)||(this.fire(new f.k(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,a){if(!t)return!0;let c=0;for(const p of t){if(p[0]<c||p[1]<p[0]||a<p[1])return!1;c=p[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const c=a.spriteData,p=c&&c.width||a.data.width,b=c&&c.height||a.data.height;return!(t[0]<0||p<t[0]||t[1]<0||b<t[1]||t[2]<0||p<t[2]||t[3]<0||b<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,c=!0){const p=this.getImage(t);if(c&&(p.data.width!==a.data.width||p.data.height!==a.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=p.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,c)=>{let p=!0;if(!this.isLoaded())for(const b of t)this.images[b]||(p=!1);this.isLoaded()||p?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const c of t){let p=this.getImage(c);p||(this.fire(new f.l("styleimagemissing",{id:c})),p=this.getImage(c)),p?a[c]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:f.w(`Image "${c}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],c=this.getImage(t);if(!c)return null;if(a&&a.position.version===c.version)return a.position;if(a)a.position.version=c.version;else{const p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},b=new f.I(p,c);this.patterns[t]={bin:p,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new f.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:a,h:c}=f.p(t),p=this.atlasImage;p.resize({width:a||1,height:c||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],C=T.x+1,A=T.y+1,z=this.getImage(b).data,N=z.width,Z=z.height;f.R.copy(z,p,{x:0,y:0},{x:C,y:A},{width:N,height:Z}),f.R.copy(z,p,{x:0,y:Z-1},{x:C,y:A-1},{width:N,height:1}),f.R.copy(z,p,{x:0,y:0},{x:C,y:A+Z},{width:N,height:1}),f.R.copy(z,p,{x:N-1,y:0},{x:C-1,y:A},{width:1,height:Z}),f.R.copy(z,p,{x:0,y:0},{x:C+N,y:A},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const c=this.getImage(a);c||f.w(`Image with ID: "${a}" was not found`),dn(c)&&this.updateImage(a,c)}}cloneImages(){const t={};for(const a in this.images){const c=this.images[a];t[a]=Object.assign(Object.assign({},c),{data:c.data?c.data.clone():null})}return t}}const En=1e20;function Rt(v,t,a,c,p,b,T,C,A){for(let z=t;z<t+c;z++)fn(v,a*b+z,b,p,T,C,A);for(let z=a;z<a+p;z++)fn(v,z*b+t,1,c,T,C,A)}function fn(v,t,a,c,p,b,T){b[0]=0,T[0]=-En,T[1]=En,p[0]=v[t];for(let C=1,A=0,z=0;C<c;C++){p[C]=v[t+C*a];const N=C*C;do{const Z=b[A];z=(p[C]-p[Z]+N-Z*Z)/(C-Z)/2}while(z<=T[A]&&--A>-1);A++,b[A]=C,T[A]=z,T[A+1]=En}for(let C=0,A=0;C<c;C++){for(;T[A+1]<C;)A++;const z=b[A],N=C-z;v[t+C*a]=p[z]+N*N}}const Je=f.v.layout_symbol["text-font"].default.join(",");class Tt{constructor(t,a,c){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=c}setURL(t){this.url=t}getGlyphs(t){return f._(this,void 0,void 0,(function*(){const a=[];for(const b in t)for(const T of t[b])a.push(this._getAndCacheGlyphsPromise(b,T));const c=yield Promise.all(a),p={};for(const{stack:b,id:T,glyph:C}of c)p[b]||(p[b]={}),p[b][T]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return p}))}_getAndCacheGlyphsPromise(t,a){return f._(this,void 0,void 0,(function*(){let c=this.entries[t];c||(c=this.entries[t]={glyphs:{},requests:{},ranges:{}});let p=c.glyphs[a];return p!==void 0?{stack:t,id:a,glyph:p}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(p=c.glyphs[a]=this._drawGlyph(c,t,a),{stack:t,id:a,glyph:p}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return f._(this,void 0,void 0,(function*(){const c=this.entries[t],p=Math.floor(a/256);if(c.ranges[p])return{stack:t,id:a,glyph:null};if(!c.requests[p]){const b=Tt.loadGlyphRange(t,p,this.url,this.requestManager);c.requests[p]=b}try{const b=yield c.requests[p];for(const T in b)c.glyphs[+T]=b[+T];return c.ranges[p]=!0,{stack:t,id:a,glyph:b[a]||null}}catch(b){const T=c.glyphs[a]=this._drawGlyph(c,t,a);return this._warnOnMissingGlyphRange(T,p,a,b),{stack:t,id:a,glyph:T}}}))}_warnOnMissingGlyphRange(t,a,c,p){const b=256*a,T=b+255,C=c.toString(16).padStart(4,"0").toUpperCase();f.w(`Unable to load glyph range ${a}, ${b}-${T}. Rendering codepoint U+${C} locally instead. ${p}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&f.q(t)}_drawGlyph(t,a,c){const p=a===Je&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(c),b=p?"ideographTinySDF":"tinySDF";t[b]||(t[b]=this._createTinySDF(p?this.localIdeographFontFamily:a));const T=t[b].draw(String.fromCodePoint(c));return{id:c,bitmap:new f.r({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const c=a.map((p=>/[-\w]+/.test(p)?p:`'${CSS.escape(p)}'`)).join(",");return new Tt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let c;for(const[p,b]of Object.entries(a))new RegExp(`\\b${p}\\b`,"i").test(t)&&(c=`${b}`);return c}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}Tt.loadGlyphRange=function(v,t,a,c){return f._(this,void 0,void 0,(function*(){const p=256*t,b=p+255,T=c.transformRequest(a.replace("{fontstack}",v).replace("{range}",`${p}-${b}`),"Glyphs"),C=yield f.n(T,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${t}, ${p}-${b}`);const A={};for(const z of f.o(C.data))A[z.id]=z;return A}))},Tt.TinySDF=class{constructor({fontSize:v=24,buffer:t=3,radius:a=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:b="normal",fontStyle:T="normal",lang:C=null}={}){this.buffer=t,this.cutoff=c,this.radius=a,this.lang=C;const A=this.size=v+4*t,z=this._createCanvas(A),N=this.ctx=z.getContext("2d",{willReadFrequently:!0});N.font=`${T} ${b} ${v}px ${p}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(v){const t=document.createElement("canvas");return t.width=t.height=v,t}draw(v){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:b}=this.ctx.measureText(v),T=Math.ceil(a),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-p))),A=Math.min(this.size-this.buffer,T+Math.ceil(c)),z=C+2*this.buffer,N=A+2*this.buffer,Z=Math.max(z*N,0),q=new Uint8ClampedArray(Z),Q={data:q,width:z,height:N,glyphWidth:C,glyphHeight:A,glyphTop:T,glyphLeft:0,glyphAdvance:t};if(C===0||A===0)return Q;const{ctx:ne,buffer:he,gridInner:pe,gridOuter:de}=this;this.lang&&(ne.lang=this.lang),ne.clearRect(he,he,C,A),ne.fillText(v,he,he+T);const me=ne.getImageData(he,he,C,A);de.fill(En,0,Z),pe.fill(0,0,Z);for(let Ee=0;Ee<A;Ee++)for(let _e=0;_e<C;_e++){const Ce=me.data[4*(Ee*C+_e)+3]/255;if(Ce===0)continue;const Ae=(Ee+he)*z+_e+he;if(Ce===1)de[Ae]=0,pe[Ae]=En;else{const be=.5-Ce;de[Ae]=be>0?be*be:0,pe[Ae]=be<0?be*be:0}}Rt(de,0,0,z,N,z,this.f,this.v,this.z),Rt(pe,he,he,C,A,z,this.f,this.v,this.z);for(let Ee=0;Ee<Z;Ee++){const _e=Math.sqrt(de[Ee])-Math.sqrt(pe[Ee]);q[Ee]=Math.round(255-255*(_e/this.radius+this.cutoff))}return Q}};class $t{constructor(){this.specification=f.u.light.position}possiblyEvaluate(t,a){return f.F(t.expression.evaluate(a))}interpolate(t,a,c){return{x:f.G.number(t.x,a.x,c),y:f.G.number(t.y,a.y,c),z:f.G.number(t.z,a.z,c)}}}let Ht;class Pt extends f.E{constructor(t){super(),Ht=Ht||new f.t({anchor:new f.D(f.u.light.anchor),position:new $t,color:new f.D(f.u.light.color),intensity:new f.D(f.u.light.intensity)}),this._transitionable=new f.x(Ht,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(f.y,t,a))for(const c in t){const p=t[c];c.endsWith(f.z)?this._transitionable.setTransition(c.slice(0,-f.z.length),p):this._transitionable.setValue(c,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c){return(!c||c.validate!==!1)&&f.B(this,t.call(f.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:f.u}))}}const Re=new f.t({"sky-color":new f.D(f.u.sky["sky-color"]),"horizon-color":new f.D(f.u.sky["horizon-color"]),"fog-color":new f.D(f.u.sky["fog-color"]),"fog-ground-blend":new f.D(f.u.sky["fog-ground-blend"]),"horizon-fog-blend":new f.D(f.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new f.D(f.u.sky["sky-horizon-blend"]),"atmosphere-blend":new f.D(f.u.sky["atmosphere-blend"])});class lt extends f.E{constructor(t){super(),this._transitionable=new f.x(Re,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new f.H(0))}setSky(t,a={}){if(!this._validate(f.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const c in t){const p=t[c];c.endsWith(f.z)?this._transitionable.setTransition(c.slice(0,-f.z.length),p):this._transitionable.setValue(c,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,c={}){return c?.validate!==!1&&f.B(this,t.call(f.C,f.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:f.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class zt{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const c=t.join(",")+String(a);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,a)),this.dashEntry[c]}getDashRanges(t,a,c){const p=[];let b=t.length%2==1?-t[t.length-1]*c:0,T=t[0]*c,C=!0;p.push({left:b,right:T,isDash:C,zeroLength:t[0]===0});let A=t[0];for(let z=1;z<t.length;z++){C=!C;const N=t[z];b=A*c,A+=N,T=A*c,p.push({left:b,right:T,isDash:C,zeroLength:N===0})}return p}addRoundDash(t,a,c){const p=a/2;for(let b=-c;b<=c;b++){const T=this.width*(this.nextRow+c+b);let C=0,A=t[C];for(let z=0;z<this.width;z++){z/A.right>1&&(A=t[++C]);const N=Math.abs(z-A.left),Z=Math.abs(z-A.right),q=Math.min(N,Z);let Q;const ne=b/c*(p+1);if(A.isDash){const he=p-Math.abs(ne);Q=Math.sqrt(q*q+he*he)}else Q=p-Math.sqrt(q*q+ne*ne);this.data[T+z]=Math.max(0,Math.min(255,Q+128))}}}addRegularDash(t){for(let C=t.length-1;C>=0;--C){const A=t[C],z=t[C+1];A.zeroLength?t.splice(C,1):z&&z.isDash===A.isDash&&(z.left=A.left,t.splice(C,1))}const a=t[0],c=t[t.length-1];a.isDash===c.isDash&&(a.left=c.left-this.width,c.right=a.right+this.width);const p=this.width*this.nextRow;let b=0,T=t[b];for(let C=0;C<this.width;C++){C/T.right>1&&(T=t[++b]);const A=Math.abs(C-T.left),z=Math.abs(C-T.right),N=Math.min(A,z);this.data[p+C]=Math.max(0,Math.min(255,(T.isDash?N:-N)+128))}}addDash(t,a){const c=a?7:0,p=2*c+1;if(this.nextRow+p>this.height)return f.w("LineAtlas out of space"),null;let b=0;for(let C=0;C<t.length;C++)b+=t[C];if(b!==0){const C=this.width/b,A=this.getDashRanges(t,this.width,C);a?this.addRoundDash(A,C,c):this.addRegularDash(A)}const T={y:this.nextRow+c,height:2*c,width:b};return this.nextRow+=p,this.dirty=!0,T}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Ct="maplibre_preloaded_worker_pool";class en{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<en.workerCount;)this.workers.push(new Worker(f.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ct]}numActive(){return Object.keys(this.active).length}}const Mn=Math.floor(Oe.hardwareConcurrency/2);let Rn,Ue;function yi(){return Rn||(Rn=new en),Rn}en.workerCount=f.K(globalThis)?Math.max(Math.min(Mn,3),1):1;class Ln{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const c=this.workerPool.acquire(a);for(let p=0;p<c.length;p++){const b=new f.L(c[p],a);b.name=`Worker ${p}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const c=[];for(const p of this.actors)c.push(p.sendAsync({type:t,data:a}));return Promise.all(c)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const c of this.actors)c.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function rn(){return Ue||(Ue=new Ln(yi(),f.M),Ue.registerMessageHandler("GR",((v,t,a)=>f.m(t,a)))),Ue}function Se(v,t){const a=f.N();return f.O(a,a,[1,1,0]),f.Q(a,a,[.5*v.width,.5*v.height,1]),v.calculatePosMatrix?f.S(a,a,v.calculatePosMatrix(t.toUnwrapped())):a}function oa(v,t,a,c,p,b,T){var C;const A=(function(q,Q,ne){if(q)for(const he of q){const pe=Q[he];if(pe&&pe.source===ne&&pe.type==="fill-extrusion")return!0}else for(const he in Q){const pe=Q[he];if(pe.source===ne&&pe.type==="fill-extrusion")return!0}return!1})((C=p?.layers)!==null&&C!==void 0?C:null,t,v.id),z=b.maxPitchScaleFactor(),N=v.tilesIn(c,z,A);N.sort(vi);const Z=[];for(const q of N)Z.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(t,a,v.getState(),q.queryGeometry,q.cameraQueryGeometry,q.scale,p,b,z,Se(b,q.tileID),T?(Q,ne)=>T(q.tileID,Q,ne):void 0)});return(function(q,Q){for(const ne in q)for(const he of q[ne])er(he,Q);return q})((function(q){const Q={},ne={};for(const he of q){const pe=he.queryResults,de=he.wrappedTileID,me=ne[de]=ne[de]||{};for(const Ee in pe){const _e=pe[Ee],Ce=me[Ee]=me[Ee]||{},Ae=Q[Ee]=Q[Ee]||[];for(const be of _e)Ce[be.featureIndex]||(Ce[be.featureIndex]=!0,Ae.push(be))}}return Q})(Z),v)}function vi(v,t){const a=v.tileID,c=t.tileID;return a.overscaledZ-c.overscaledZ||a.canonical.y-c.canonical.y||a.wrap-c.wrap||a.canonical.x-c.canonical.x}function er(v,t){const a=v.feature,c=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=c}function Ma(v,t,a){return f._(this,void 0,void 0,(function*(){let c=v;if(v.url?c=(yield f.j(t.transformRequest(v.url,"Source"),a)).data:yield Oe.frameAsync(a),!c)return null;const p=f.U(f.e(c,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in c&&c.vector_layers&&(p.vectorLayerIds=c.vector_layers.map((b=>b.id))),p}))}class Ai{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof f.V?new f.V(t.lng,t.lat):f.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof f.V?new f.V(t.lng,t.lat):f.V.convert(t),this}extend(t){const a=this._sw,c=this._ne;let p,b;if(t instanceof f.V)p=t,b=t;else{if(!(t instanceof Ai))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ai.convert(t)):this.extend(f.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(f.V.convert(t)):this;if(p=t._sw,b=t._ne,!p||!b)return this}return a||c?(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),c.lng=Math.max(b.lng,c.lng),c.lat=Math.max(b.lat,c.lat)):(this._sw=new f.V(p.lng,p.lat),this._ne=new f.V(b.lng,b.lat)),this}getCenter(){return new f.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new f.V(this.getWest(),this.getNorth())}getSouthEast(){return new f.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:c}=f.V.convert(t);let p=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}intersects(t){if(!((t=Ai.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=f.W(this.getWest(),-180,180),c=f.W(this.getEast(),-180,180),p=f.W(t.getWest(),-180,180),b=f.W(t.getEast(),-180,180),T=a>=c,C=p>=b;return!(!T||!C)||(T?b>=a||p<=c:C?c>=p||a<=b:p<=c&&b>=a)}static convert(t){return t instanceof Ai?t:t&&new Ai(t)}static fromLngLat(t,a=0){const c=360*a/40075017,p=c/Math.cos(Math.PI/180*t.lat);return new Ai(new f.V(t.lng-p,t.lat-c),new f.V(t.lng+p,t.lat+c))}adjustAntiMeridian(){const t=new f.V(this._sw.lng,this._sw.lat),a=new f.V(this._ne.lng,this._ne.lat);return new Ai(t,t.lng>a.lng?new f.V(a.lng+360,a.lat):a)}}class Vs{constructor(t,a,c){this.bounds=Ai.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),c=Math.floor(f.Y(this.bounds.getWest())*a),p=Math.floor(f.X(this.bounds.getNorth())*a),b=Math.ceil(f.Y(this.bounds.getEast())*a),T=Math.ceil(f.X(this.bounds.getSouth())*a);return t.x>=c&&t.x<b&&t.y>=p&&t.y<T}}class Dt extends f.E{constructor(t,a,c,p){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,f.e(this,f.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=f.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return f._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(f.e(this,t),t.bounds&&(this.tileBounds=new Vs(t.bounds,this.minzoom,this.maxzoom)),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,f.Z(t)||this.fire(new f.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return f.e({},this._options)}loadTile(t){return f._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};c.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((b,T)=>{t.reloadPromise={resolve:b,reject:T}}))}else t.actor=this.dispatcher.getActor(),p="LT";t.abortController=new AbortController;try{const b=yield t.actor.sendAsync({type:p,data:c},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,b)}catch(b){if(delete t.abortController,t.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,c=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(c,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const c=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(c.resolve).catch(c.reject)}}abortTile(t){return f._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Us extends f.E{constructor(t,a,c,p){super(),this.id=t,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=f.e({type:"raster"},a),f.e(this,f.U(a,["url","scheme","tileSize"]))}load(){return f._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(f.e(this,a),a.bounds&&(this.tileBounds=new Vs(a.bounds,this.minzoom,this.maxzoom)),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new f.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,f.Z(a)||this.fire(new f.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return f.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return f._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const c=yield _t.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(c&&c.data){this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&t.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const p=this.map.painter.context,b=p.gl,T=c.data;t.texture=this.map.painter.getTileTexture(T.width),t.texture?t.texture.update(T,{useMipmap:!0}):(t.texture=new f.T(p,T,b.RGBA,{useMipmap:!0}),t.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(c){if(delete t.abortController,t.aborted)t.state="unloaded";else if(c)throw t.state="errored",c}}))}abortTile(t){return f._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class rs extends Us{constructor(t,a,c,p){super(t,a,c,p),this.type="raster-dem",this.maxzoom=22,this._options=f.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return f._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),c=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const p=yield _t.getImage(c,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){const b=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const T=f.b(b)&&f.$()?b:yield this.readImageNow(b),C={type:this.type,uid:t.uid,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const A=yield t.actor.sendAsync({type:"LDT",data:C});t.dem=A,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}}))}readImageNow(t){return f._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&f.a0()){const a=t.width+2,c=t.height+2;try{return new f.R({width:a,height:c},yield f.a1(t,-1,-1,a,c))}catch{}}return Oe.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,c=Math.pow(2,a.z),p=(a.x-1+c)%c,b=a.x===0?t.wrap-1:t.wrap,T=(a.x+1+c)%c,C=a.x+1===c?t.wrap+1:t.wrap,A={};return A[new f.a2(t.overscaledZ,b,a.z,p,a.y).key]={backfilled:!1},A[new f.a2(t.overscaledZ,C,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(A[new f.a2(t.overscaledZ,b,a.z,p,a.y-1).key]={backfilled:!1},A[new f.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},A[new f.a2(t.overscaledZ,C,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<c&&(A[new f.a2(t.overscaledZ,b,a.z,p,a.y+1).key]={backfilled:!1},A[new f.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},A[new f.a2(t.overscaledZ,C,a.z,T,a.y+1).key]={backfilled:!1}),A}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function zr(v){return v.type==="GeometryCollection"?v.geometries.map((t=>t.coordinates)).flat(1/0):v.coordinates.flat(1/0)}function pl(v){const t=new Ai;let a;switch(v.type){case"FeatureCollection":a=v.features.map((c=>zr(c.geometry))).flat(1/0);break;case"Feature":a=zr(v.geometry);break;default:a=zr(v)}if(a.length==0)return t;for(let c=0;c<a.length-1;c+=2)t.extend([a[c],a[c+1]]);return t}class ln extends f.E{constructor(t,a,c,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=c.getActor(),this.setEventedParent(p),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=f.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&f.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=f.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:f.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:f.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(f.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||f.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return f._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const c=this._updateWorkerData();return a?c:this}updateData(t,a){this._pendingWorkerUpdate.diff=f.a6(this._pendingWorkerUpdate.diff,t);const c=this._updateWorkerData();return a?c:this}getData(){return f._(this,void 0,void 0,(function*(){const t=f.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return f._(this,void 0,void 0,(function*(){return pl(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,c){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:c}})}_updateWorkerData(){return f._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void f.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,c=f.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(c.request=this.map._requestManager.transformRequest(Oe.resolveURL(t),"Source"),c.request.collectResourceTiming=this._collectResourceTiming):c.data=t,this._pendingWorkerUpdate.data=void 0):a&&(c.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new f.l("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:c});if(this._isUpdatingWorker=!1,this._removed||p.abandoned)return void this.fire(new f.l("dataabort",{dataType:"source"}));a&&this._applyDiff(a);let b=null;p.resourceTiming&&p.resourceTiming[this.id]&&(b=p.resourceTiming[this.id].slice(0));const T={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&f.e(T,{resourceTiming:b}),this.fire(new f.l("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new f.l("data",Object.assign(Object.assign({},T),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(a)})))}catch(p){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new f.l("dataabort",{dataType:"source"}));this.fire(new f.k(p))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(t){const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){if(!f.a7(this._data.geojson,a))throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:f.a8(this._data.geojson,a)}}this._data.updateable&&f.a9(this._data.updateable,t,a)}_getShouldReloadTileOptions(t){if(this._options.cluster||!t||t.removeAll)return;const{add:a=[],update:c=[],remove:p=[]}=t||{},b=new Set([...c.map((T=>T.id)),...p]);for(const T of b.values())if(typeof T!="number"&&this.promoteId==null)return void f.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs. Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...c.map((T=>T.newGeometry)),...a.map((T=>T.geometry))].filter(Boolean).map((T=>pl(T))),prevIds:b}}shouldReloadTile(t,{nextBounds:a,prevIds:c}){if(!t.latestFeatureIndex)return t.state!=="unloaded";const p=t.latestFeatureIndex.loadVTLayers();for(let A=0;A<t.latestFeatureIndex.featureIndexArray.length;A++){const z=t.latestFeatureIndex.featureIndexArray.get(A),N=p[f.aa].feature(z.featureIndex),Z=t.latestFeatureIndex.getId(N,f.aa);if(c.has(Z))return!0}const{buffer:b,extent:T}=this.workerOptions.geojsonVtOptions,C=(function({x:A,y:z,z:N},Z=0){const q=f.a3((A-Z)/Math.pow(2,N)),Q=f.a4((z+1+Z)/Math.pow(2,N)),ne=f.a3((A+1+Z)/Math.pow(2,N)),he=f.a4((z-Z)/Math.pow(2,N));return new Ai([q,Q],[ne,he])})(t.tileID.canonical,b/T);for(const A of a)if(C.intersects(A))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return f._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const c={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const p=yield this.actor.sendAsync({type:a,data:c},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(p,this.map.painter,a==="RT")}))}abortTile(t){return f._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return f._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return f.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class wr extends f.E{constructor(t,a,c,p){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=c,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=a}load(t){return f._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new f.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield _t.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,f.Z(a)||this.fire(new f.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new f.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(f.ab.fromLngLat);var c;return this.tileID=(function(p){const b=f.ac.fromPoints(p),T=b.width(),C=b.height(),A=Math.max(T,C),z=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),N=Math.pow(2,z);return new f.ae(z,Math.floor((b.minX+b.maxX)/2*N),Math.floor((b.minY+b.maxY)/2*N))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((p=>this.tileID.getTilePoint(p)._round())),this.flippedWindingOrder=((c=this.tileCoords)[1].x-c[0].x)*(c[2].y-c[0].y)-(c[1].y-c[0].y)*(c[2].x-c[0].x)<0,this.fire(new f.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new f.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const p in this.tiles){const b=this.tiles[p];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,c=!0)}c&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return f._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:c,maxX:p,maxY:b}=f.ac.fromPoints(t),T={};for(let C=0;C<=f.ad;C++){const A=Math.pow(2,C),z=Math.floor(a*A),N=Math.floor(c*A),Z=Math.floor(p*A),q=Math.floor(b*A);T[C]={minTileX:z,minTileY:N,maxTileX:Z,maxTileY:q}}return T}}class je extends wr{constructor(t,a,c,p){super(t,a,c,p),this.roundZoom=!0,this.type="video",this.options=a}load(){return f._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield f.af(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new f.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new f.k(new f.ag(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new f.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let c=!1;for(const p in this.tiles){const b=this.tiles[p];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,c=!0)}c&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class te extends wr{constructor(t,a,c,p){super(t,a,c,p),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((b=>!Array.isArray(b)||b.length!==2||b.some((T=>typeof T!="number"))))||this.fire(new f.k(new f.ag(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new f.k(new f.ag(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new f.k(new f.ag(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new f.k(new f.ag(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new f.k(new f.ag(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return f._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new f.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,c=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new f.T(a,this.canvas,c.RGBA,{premultiply:!0}),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let p=!1;for(const b in this.tiles){const T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,p=!0)}p&&this.fire(new f.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const J={},oe=v=>{switch(v){case"geojson":return ln;case"image":return wr;case"raster":return Us;case"raster-dem":return rs;case"vector":return Dt;case"video":return je;case"canvas":return te}return J[v]},ve="RTLPluginLoaded";class xe extends f.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=rn()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return f._(this,arguments,void 0,(function*(a,c=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Oe.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!c)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return f._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new f.l(ve))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let He=null;function Ve(){return He||(He=new xe),He}var De,Le;(function(v){v[v.Base=0]="Base",v[v.Parent=1]="Parent"})(De||(De={})),(function(v){v[v.Departing=0]="Departing",v[v.Incoming=1]="Incoming"})(Le||(Le={}));class ut{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=f.ah(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:c,fadeEndTime:p}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=c,this.fadeEndTime=p}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=at(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(p,b){const T={};if(!b)return T;for(const C of p){const A=C.layerIds.map((z=>b.getLayer(z))).filter(Boolean);if(A.length!==0){C.layers=A,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map((z=>A.filter((N=>N.id===z))[0])));for(const z of A)T[z.id]=C}}return T})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const b=this.buckets[p];if(b instanceof f.aj){if(this.hasSymbolBuckets=!0,!c)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const b=this.buckets[p];if(b instanceof f.aj&&b.hasRTLText){this.hasRTLText=!0,Ve().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const b=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(p).queryRadius(b))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new f.ai}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new f.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new f.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,c,p,b,T,C,A,z,N,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:b,scale:T,tileSize:this.tileSize,pixelPosMatrix:N,transform:A,params:C,queryPadding:this.queryPadding*z,getElevation:Z},t,a,c):{}}querySourceFeatures(t,a){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),b=a&&a.sourceLayer?a.sourceLayer:"",T=p[f.aa]||p[b];if(!T)return;const C=f.ak(a?.filter,a?.globalState),{z:A,x:z,y:N}=this.tileID.canonical,Z={z:A,x:z,y:N};for(let q=0;q<T.length;q++){const Q=T.feature(q);if(C.needGeometry){const pe=f.al(Q,!0);if(!C.filter(new f.H(this.tileID.overscaledZ),pe,this.tileID.canonical))continue}else if(!C.filter(new f.H(this.tileID.overscaledZ),Q))continue;const ne=c.getId(Q,b),he=new f.am(Q,A,z,N,ne);he.tile=Z,t.push(he)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const c=f.an(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{const b=this.expirationTime-a;b?this.expirationTime=c+Math.max(b,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!a.style.hasLayer(p))continue;const b=this.buckets[p],T=b.layers[0].sourceLayer||f.aa,C=c[T],A=t[T];if(!C||!A||Object.keys(A).length===0)continue;b.update(A,C,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const z=a&&a.style&&a.style.getLayer(p);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(b)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<at()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=at()+t}setDependencies(t,a){const c={};for(const p of a)c[p]=!0;this.dependencies[t]=c}hasDependency(t,a){for(const c of t){const p=this.dependencies[c];if(p){for(const b of a)if(p[b])return!0}}return!1}}class ht{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,c){const p=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},f.e(this.stateChanges[t][p],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==p&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const b in this.state[t][p])c[b]||(this.deletedStates[t][p][b]=null)}else for(const b in c)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][b]===null&&delete this.deletedStates[t][p][b]}removeFeatureState(t,a,c){if(this.deletedStates[t]===null)return;const p=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&a!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][c]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(c in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][c]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,a){const c=String(a),p=f.e({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const b=this.deletedStates[t][a];if(b===null)return{};for(const T in b)delete p[T]}return p}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const b={};for(const T in this.stateChanges[p])this.state[p][T]||(this.state[p][T]={}),f.e(this.state[p][T],this.stateChanges[p][T]),b[T]=this.state[p][T];c[p]=b}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const b={};if(this.deletedStates[p]===null)for(const T in this.state[p])b[T]={},this.state[p][T]={};else for(const T in this.deletedStates[p]){if(this.deletedStates[p][T]===null)this.state[p][T]={};else for(const C of Object.keys(this.deletedStates[p][T]))delete this.state[p][T][C];b[T]=this.state[p][T]}c[p]=c[p]||{},f.e(c[p],b)}this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0&&t.setFeatureState(c,a)}}const Ut=89.25;function qt(v,t){const a=f.ao(t.lat,-f.ap,f.ap);return new f.P(f.Y(t.lng)*v,f.X(a)*v)}function pn(v,t){return new f.ab(t.x/v,t.y/v).toLngLat()}function Dn(v){return v.cameraToCenterDistance*Math.min(.85*Math.tan(f.aq(90-v.pitch)),Math.tan(f.aq(Ut-v.pitch)))}function Fn(v,t){const a=v.canonical,c=t/f.ar(a.z),p=a.x+Math.pow(2,a.z)*v.wrap,b=f.as(new Float64Array(16));return f.O(b,b,[p*c,a.y*c,0]),f.Q(b,b,[c/f.a5,c/f.a5,1]),b}function Ge(v,t,a,c,p){const b=f.ab.fromLngLat(v,t),T=p*f.at(1,v.lat),{x:C,y:A,z}=Jn(a,c);return new f.ab(b.x+T*-C,b.y+T*-A,b.z+T*-z)}function Jn(v,t){const a=f.aq(v),c=f.aq(t),p=Math.cos(-a),b=Math.sin(a);return{x:b*Math.sin(c),y:-b*Math.cos(c),z:p}}function qi(v,t,a){const c=t.intersectsFrustum(v);if(!a||c===0)return c;const p=t.intersectsPlane(a);return p===0?0:c===2&&p===2?2:1}function gn(v,t,a){let c=0;const p=(a-t)/10;for(let b=0;b<10;b++)c+=p*Math.pow(Math.cos(t+(b+.5)/10*(a-t)),v);return c}function xt(v,t){return function(a,c,p,b,T){const C=2*((v-1)/f.au(Math.cos(f.aq(Ut-T))/Math.cos(f.aq(Ut)))-1),A=Math.acos(p/b),z=2*gn(C-1,0,f.aq(T/2)),N=Math.min(f.aq(Ut),A+f.aq(T/2)),Z=gn(C-1,Math.min(N,A-f.aq(T/2)),N),q=Math.atan(c/p),Q=Math.hypot(c,p);let ne=a;return ne+=f.au(b/Q/Math.max(.5,Math.cos(f.aq(T/2)))),ne+=C*f.au(Math.cos(q))/2,ne-=f.au(Math.max(1,Z/z/t))/2,ne}}const Zi=xt(9.314,3);function Xn(v,t){const a=(t.roundZoom?Math.round:Math.floor)(v.zoom+f.au(v.tileSize/t.tileSize));return Math.max(0,a)}function Ci(v,t){const a=v.getCameraFrustum(),c=v.getClippingPlane(),p=v.screenPointToMercatorCoordinate(v.getCameraPoint()),b=f.ab.fromLngLat(v.center,v.elevation);p.z=b.z+Math.cos(v.pitchInRadians)*v.cameraToCenterDistance/v.worldSize;const T=v.getCoveringTilesDetailsProvider(),C=T.allowVariableZoom(v,t),A=Xn(v,t),z=t.minzoom||0,N=t.maxzoom!==void 0?t.maxzoom:v.maxZoom,Z=Math.min(Math.max(0,A),N),q=Math.pow(2,Z),Q=[q*p.x,q*p.y,0],ne=[q*b.x,q*b.y,0],he=Math.hypot(b.x-p.x,b.y-p.y),pe=Math.abs(b.z-p.z),de=Math.hypot(he,pe),me=Ce=>({zoom:0,x:0,y:0,wrap:Ce,fullyVisible:!1}),Ee=[],_e=[];if(v.renderWorldCopies&&T.allowWorldCopies())for(let Ce=1;Ce<=3;Ce++)Ee.push(me(-Ce)),Ee.push(me(Ce));for(Ee.push(me(0));Ee.length>0;){const Ce=Ee.pop(),Ae=Ce.x,be=Ce.y;let ze=Ce.fullyVisible;const $e={x:Ae,y:be,z:Ce.zoom},Ze=T.getTileBoundingVolume($e,Ce.wrap,v.elevation,t);if(!ze){const kt=qi(a,Ze,c);if(kt===0)continue;ze=kt===2}const We=T.distanceToTile2d(p.x,p.y,$e,Ze);let Qe=A;C&&(Qe=(t.calculateTileZoom||Zi)(v.zoom+f.au(v.tileSize/t.tileSize),We,pe,de,v.fov)),Qe=(t.roundZoom?Math.round:Math.floor)(Qe),Qe=Math.max(0,Qe);const mt=Math.min(Qe,N);if(Ce.wrap=T.getWrap(b,$e,Ce.wrap),Ce.zoom>=mt){if(Ce.zoom<z)continue;const kt=Z-Ce.zoom,dt=Q[0]-.5-(Ae<<kt),Wt=Q[1]-.5-(be<<kt),Sn=t.reparseOverscaled?Math.max(Ce.zoom,Qe):Ce.zoom;_e.push({tileID:new f.a2(Ce.zoom===N?Sn:Ce.zoom,Ce.wrap,Ce.zoom,Ae,be),distanceSq:f.av([ne[0]-.5-Ae,ne[1]-.5-be]),tileDistanceToCamera:Math.sqrt(dt*dt+Wt*Wt)})}else for(let kt=0;kt<4;kt++)Ee.push({zoom:Ce.zoom+1,x:(Ae<<1)+kt%2,y:(be<<1)+(kt>>1),wrap:Ce.wrap,fullyVisible:ze})}return _e.sort(((Ce,Ae)=>Ce.distanceSq-Ae.distanceSq)).map((Ce=>Ce.tileID))}const ni=f.ac.fromPoints([new f.P(0,0),new f.P(f.a5,f.a5)]);function Ni(v){return v==="raster"||v==="image"||v==="video"}function Bo(v,t,a,c,p,b,T){if(!t.hasData())return!1;const{tileID:C,fadingRole:A,fadingDirection:z,fadingParentID:N}=t;if(A===De.Base&&z===Le.Incoming&&N)return a[N.key]=N,!0;const Z=Math.max(C.overscaledZ-p,b);for(let q=C.overscaledZ-1;q>=Z;q--){const Q=C.scaledTo(q),ne=v.getLoadedTile(Q);if(ne)return t.setCrossFadeLogic({fadingRole:De.Base,fadingDirection:Le.Incoming,fadingParentID:ne.tileID,fadeEndTime:c+T}),ne.setCrossFadeLogic({fadingRole:De.Parent,fadingDirection:Le.Departing,fadeEndTime:c+T}),a[Q.key]=Q,!0}return!1}function Ca(v,t,a,c,p,b){if(!t.hasData())return!1;const T=t.tileID.children(p);let C=It(v,t,T,a,c,p,b);if(C)return!0;for(const A of T)It(v,t,A.children(p),a,c,p,b)&&(C=!0);return C}function It(v,t,a,c,p,b,T){if(a[0].overscaledZ>=b)return!1;let C=!1;for(const A of a){const z=v.getLoadedTile(A);if(!z)continue;const{fadingRole:N,fadingDirection:Z,fadingParentID:q}=z;N===De.Base&&Z===Le.Departing&&q||(z.setCrossFadeLogic({fadingRole:De.Base,fadingDirection:Le.Departing,fadingParentID:t.tileID,fadeEndTime:p+T}),t.setCrossFadeLogic({fadingRole:De.Parent,fadingDirection:Le.Incoming,fadeEndTime:p+T})),c[A.key]=A,C=!0}return C}function mr(v,t,a,c){const p=v.tileID;return!!v.selfFading||!v.hasData()&&!!t.has(p)&&(v.setSelfFadeLogic(a+c),!0)}function Zr(v,t){var a;v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let c=t.tileID.canonical.x-v.tileID.canonical.x;const p=t.tileID.canonical.y-v.tileID.canonical.y,b=Math.pow(2,v.tileID.canonical.z),T=t.tileID.key;c===0&&p===0||Math.abs(p)>1||(Math.abs(c)>1&&(Math.abs(c+b)===1?c+=b:Math.abs(c-b)===1&&(c-=b)),t.dem&&v.dem&&(v.dem.backfillBorder(t.dem,c,p),!((a=v.neighboringTiles)===null||a===void 0)&&a[T]&&(v.neighboringTiles[T].backfilled=!0)))}class Va{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const c in this._tiles){const p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+t),a[p.tileID.key]=p}this._tiles=a}setFeatureState(t,a){for(const c in this._tiles)this._tiles[c].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(f.ax).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var c;return(c=this.getTileById(t))===null||c===void 0?void 0:c.isRenderable(a)}getRenderableIds(t=0,a){const c=[];for(const p of this.getAllIds())this.isIdRenderable(p,a)&&c.push(this.getTileById(p));return a?c.sort(((p,b)=>{const T=p.tileID,C=b.tileID,A=new f.P(T.canonical.x,T.canonical.y)._rotate(-t),z=new f.P(C.canonical.x,C.canonical.y)._rotate(-t);return T.overscaledZ-C.overscaledZ||z.y-A.y||z.x-A.x})).map((p=>p.tileID.key)):c.map((p=>p.tileID)).sort(f.ax).map((p=>p.key))}}class li extends f.E{constructor(t,a,c){super(),this.id=t,this.dispatcher=c,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,b,T,C)=>{const A=new(oe(b.type))(p,b,T,C);if(A.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${A.id}`);return A})(t,a,c,this),this._inViewTiles=new Va,this._outOfViewCache=new f.ay(0,(p=>this._unloadTile(p))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new ht,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Va}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,c){return f._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,c)}catch(p){t.state="errored",p.status!==404?this._source.fire(new f.k(p,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new f.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const c=this.getLoadedTile(t.scaledTo(a));if(c)return this._inViewTiles.isIdRenderable(c.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const c of this._inViewTiles.getAllIds()){const p=this._inViewTiles.getTileById(c);a&&!this._source.shouldReloadTile(p,a)||(t?this._reloadTile(c,"expired"):p.state!=="errored"&&this._reloadTile(c,"reloading"))}}}_reloadTile(t,a){return f._(this,void 0,void 0,(function*(){const c=this._inViewTiles.getTileById(t);c&&(c.state!=="loading"&&(c.state=a),yield this._loadTile(c,t,a))}))}_tileLoaded(t,a,c){t.timeAdded=at(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(p,b){var T,C;const A=b.getRenderableIds();for(const z of A){if(!p.neighboringTiles||!p.neighboringTiles[z])continue;const N=b.getTileById(z);p.neighboringTiles[z].backfilled||Zr(p,N),!((C=(T=N.neighboringTiles)===null||T===void 0?void 0:T[p.tileID.key])===null||C===void 0)&&C.backfilled||Zr(N,p)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new f.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const c=this._getLoadedDescendents(a),p=new Set;for(const b of a){const T=c[b.key];if(!T?.length){p.add(b);continue}const C=b.overscaledZ+li.maxOverzooming,A=T.filter((Z=>Z.tileID.overscaledZ<=C));if(!A.length){p.add(b);continue}const z=Math.min(...A.map((Z=>Z.tileID.overscaledZ))),N=A.filter((Z=>Z.tileID.overscaledZ===z)).map((Z=>Z.tileID));for(const Z of N)t[Z.key]=Z;this._areDescendentsComplete(N,z,b.overscaledZ)||p.add(b)}return p}_getLoadedDescendents(t){var a;const c={};for(const p of this._inViewTiles.getAllTiles().filter((b=>b.hasData())))for(const b of t)p.tileID.isChildOf(b)&&(c[a=b.key]||(c[a]=[])).push(p);return c}_areDescendentsComplete(t,a,c){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-c)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(a*c*(this._maxTileCacheZoomLevels===null?f.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._outOfViewCache.setMaxSize(b)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let c;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((A=>new f.a2(A.canonical.z,A.wrap,A.canonical.z,A.canonical.x,A.canonical.y))):(c=Ci(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(c=c.filter((A=>this._source.hasTile(A))))):c=[],this.usedForTerrain&&(c=this._addTerrainIdealTiles(c));const p=c.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,p&&this.fire(new f.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=Xn(t,this._source),T=this._updateRetainedTiles(c,b),C=Ni(this._source.type);C&&this._rasterFadeDuration>0&&!a&&(function(A,z,N,Z,q,Q,ne){const he=at(),pe=f.aw(z);for(const de of z){const me=A.getTileById(de.key);me.fadingDirection!==Le.Departing&&me.fadeOpacity!==0||me.resetFadeLogic(),Bo(A,me,N,he,Z,q,ne)||Ca(A,me,N,he,Q,ne)||mr(me,pe,he,ne)||me.resetFadeLogic()}})(this._inViewTiles,c,T,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),C?this._cleanUpRasterTiles(T):this._cleanUpVectorTiles(T)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);t[a]?c.clearSymbolFadeHold():c.hasSymbolBuckets?c.holdingForSymbolFade()?c.symbolFadeFinished()&&this._removeTile(a):c.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const c of t)if(c.canonical.z>this._source.minzoom){const p=c.scaledTo(c.canonical.z-1);a.push(p);const b=c.scaledTo(Math.max(this._source.minzoom,Math.min(c.canonical.z,5)));a.push(b)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var c;const p=new Set;for(const z of t)this._addTile(z).hasData()||p.add(z);const b=t.reduce(((z,N)=>(z[N.key]=N,z)),{}),T=this._retainLoadedChildren(b,p),C={},A=Math.max(a-li.maxUnderzooming,this._source.minzoom);for(const z of T){let N=this._inViewTiles.getTileById(z.key),Z=N?.wasRequested();for(let q=z.overscaledZ-1;q>=A;--q){const Q=z.scaledTo(q);if(C[Q.key])break;if(C[Q.key]=!0,N=this.getTile(Q),!N&&Z&&(N=this._addTile(Q)),N){const ne=N.hasData();if((ne||!(!((c=this.map)===null||c===void 0)&&c.cancelPendingTileRequestsWhileZooming)||Z)&&(b[Q.key]=Q),Z=N.wasRequested(),ne)break}}}return b}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const c=a;return a||(a=new ut(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),c||this._source.fire(new f.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const c=a.getExpiryTimeout();c&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),c))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const c=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||c.state=="errored")&&t.some((p=>p.equals(c.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,c){const p=[],b=this.transform;if(!b)return p;const T=b.getCoveringTilesDetailsProvider().allowWorldCopies(),C=c?b.getCameraQueryGeometry(t):t,A=Q=>b.screenPointToMercatorCoordinate(Q,this.terrain),z=this.transformBbox(t,A,!T),N=this.transformBbox(C,A,!T),Z=this.getIds(),q=f.ac.fromPoints(N);for(let Q=0;Q<Z.length;Q++){const ne=this._inViewTiles.getTileById(Z[Q]);if(ne.holdingForSymbolFade())continue;const he=T?[ne.tileID]:[ne.tileID.unwrapTo(-1),ne.tileID.unwrapTo(0)],pe=Math.pow(2,b.zoom-ne.tileID.overscaledZ),de=a*ne.queryPadding*f.a5/ne.tileSize/pe;for(const me of he){const Ee=q.map((_e=>me.getTilePoint(new f.ab(_e.x,_e.y))));if(Ee.expandBy(de),Ee.intersects(ni)){const _e=z.map((Ae=>me.getTilePoint(Ae))),Ce=N.map((Ae=>me.getTilePoint(Ae)));p.push({tile:ne,tileID:T?me:me.unwrapTo(0),queryGeometry:_e,cameraQueryGeometry:Ce,scale:pe})}}}return p}transformBbox(t,a,c){let p=t.map(a);if(c){const b=f.ac.fromPoints(t);b.shrinkBy(.001*Math.min(b.width(),b.height()));const T=b.map(a);f.ac.fromPoints(p).covers(T)||(p=p.map((C=>C.x>.5?new f.ab(C.x-1,C.y,C.z):C)))}return p}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((c=>this._inViewTiles.getTileById(c).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!Ni(this._source.type)||!(function(t,a){if(a<=0)return!1;const c=at();for(const p of t.getAllTiles())if(p.fadeEndTime>=c)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,c){this._state.updateState(t=t||f.aa,a,c)}removeFeatureState(t,a,c){this._state.removeFeatureState(t=t||f.aa,a,c)}getFeatureState(t,a){return this._state.getState(t=t||f.aa,a)}setDependencies(t,a,c){const p=this._inViewTiles.getTileById(t);p&&p.setDependencies(a,c)}reloadTilesForDependencies(t,a){for(const c of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(c).hasDependency(t,a)&&this._reloadTile(c,"reloading");this._outOfViewCache.filter((c=>!c.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}li.maxUnderzooming=10,li.maxOverzooming=3;class St{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=f.ao(t,0,1);let a=1,c=this._distances[a];const p=t*this.paddedLength+this.padding;for(;c<p&&a<this._distances.length;)c=this._distances[++a];const b=a-1,T=this._distances[b],C=c-T,A=C>0?(p-T)/C:0;return this.points[b].mult(1-A).add(this.points[a].mult(A))}}function bn(v,t){let a=!0;return v==="always"||v!=="never"&&t!=="never"||(a=!1),a}class Tn{constructor(t,a,c){const p=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(a/c);for(let T=0;T<this.xCellCount*this.yCellCount;T++)p.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,c,p,b){this._forEachCell(a,c,p,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(b)}insertCircle(t,a,c,p){this._forEachCell(a-p,c-p,a+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(c),this.circles.push(p)}_insertBoxCell(t,a,c,p,b,T){this.boxCells[b].push(T)}_insertCircleCell(t,a,c,p,b,T){this.circleCells[b].push(T)}_query(t,a,c,p,b,T,C){if(c<0||t>this.width||p<0||a>this.height)return[];const A=[];if(t<=0&&a<=0&&this.width<=c&&this.height<=p){if(b)return[{key:null,x1:t,y1:a,x2:c,y2:p}];for(let z=0;z<this.boxKeys.length;z++)A.push({key:this.boxKeys[z],x1:this.bboxes[4*z],y1:this.bboxes[4*z+1],x2:this.bboxes[4*z+2],y2:this.bboxes[4*z+3]});for(let z=0;z<this.circleKeys.length;z++){const N=this.circles[3*z],Z=this.circles[3*z+1],q=this.circles[3*z+2];A.push({key:this.circleKeys[z],x1:N-q,y1:Z-q,x2:N+q,y2:Z+q})}}else this._forEachCell(t,a,c,p,this._queryCell,A,{hitTest:b,overlapMode:T,seenUids:{box:{},circle:{}}},C);return A}query(t,a,c,p){return this._query(t,a,c,p,!1,null)}hitTest(t,a,c,p,b,T){return this._query(t,a,c,p,!0,b,T).length>0}hitTestCircle(t,a,c,p,b){const T=t-c,C=t+c,A=a-c,z=a+c;if(C<0||T>this.width||z<0||A>this.height)return!1;const N=[];return this._forEachCell(T,A,C,z,this._queryCellCircle,N,{hitTest:!0,overlapMode:p,circle:{x:t,y:a,radius:c},seenUids:{box:{},circle:{}}},b),N.length>0}_queryCell(t,a,c,p,b,T,C,A){const{seenUids:z,hitTest:N,overlapMode:Z}=C,q=this.boxCells[b];if(q!==null){const ne=this.bboxes;for(const he of q)if(!z.box[he]){z.box[he]=!0;const pe=4*he,de=this.boxKeys[he];if(t<=ne[pe+2]&&a<=ne[pe+3]&&c>=ne[pe+0]&&p>=ne[pe+1]&&(!A||A(de))&&(!N||!bn(Z,de.overlapMode))&&(T.push({key:de,x1:ne[pe],y1:ne[pe+1],x2:ne[pe+2],y2:ne[pe+3]}),N))return!0}}const Q=this.circleCells[b];if(Q!==null){const ne=this.circles;for(const he of Q)if(!z.circle[he]){z.circle[he]=!0;const pe=3*he,de=this.circleKeys[he];if(this._circleAndRectCollide(ne[pe],ne[pe+1],ne[pe+2],t,a,c,p)&&(!A||A(de))&&(!N||!bn(Z,de.overlapMode))){const me=ne[pe],Ee=ne[pe+1],_e=ne[pe+2];if(T.push({key:de,x1:me-_e,y1:Ee-_e,x2:me+_e,y2:Ee+_e}),N)return!0}}}return!1}_queryCellCircle(t,a,c,p,b,T,C,A){const{circle:z,seenUids:N,overlapMode:Z}=C,q=this.boxCells[b];if(q!==null){const ne=this.bboxes;for(const he of q)if(!N.box[he]){N.box[he]=!0;const pe=4*he,de=this.boxKeys[he];if(this._circleAndRectCollide(z.x,z.y,z.radius,ne[pe+0],ne[pe+1],ne[pe+2],ne[pe+3])&&(!A||A(de))&&!bn(Z,de.overlapMode))return T.push(!0),!0}}const Q=this.circleCells[b];if(Q!==null){const ne=this.circles;for(const he of Q)if(!N.circle[he]){N.circle[he]=!0;const pe=3*he,de=this.circleKeys[he];if(this._circlesCollide(ne[pe],ne[pe+1],ne[pe+2],z.x,z.y,z.radius)&&(!A||A(de))&&!bn(Z,de.overlapMode))return T.push(!0),!0}}}_forEachCell(t,a,c,p,b,T,C,A){const z=this._convertToXCellCoord(t),N=this._convertToYCellCoord(a),Z=this._convertToXCellCoord(c),q=this._convertToYCellCoord(p);for(let Q=z;Q<=Z;Q++)for(let ne=N;ne<=q;ne++)if(b.call(this,t,a,c,p,this.xCellCount*ne+Q,T,C,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,c,p,b,T){const C=p-t,A=b-a,z=c+T;return z*z>C*C+A*A}_circleAndRectCollide(t,a,c,p,b,T,C){const A=(T-p)/2,z=Math.abs(t-(p+A));if(z>A+c)return!1;const N=(C-b)/2,Z=Math.abs(a-(b+N));if(Z>N+c)return!1;if(z<=A||Z<=N)return!0;const q=z-A,Q=Z-N;return q*q+Q*Q<=c*c}}function gr(v,t,a){const c=f.N();if(!v){const{vecSouth:Z,vecEast:q}=Ua(t),Q=ge();Q[0]=q[0],Q[1]=q[1],Q[2]=Z[0],Q[3]=Z[1],p=Q,(N=(T=(b=Q)[0])*(z=b[3])-(A=b[2])*(C=b[1]))&&(p[0]=z*(N=1/N),p[1]=-C*N,p[2]=-A*N,p[3]=T*N),c[0]=Q[0],c[1]=Q[1],c[4]=Q[2],c[5]=Q[3]}var p,b,T,C,A,z,N;return f.Q(c,c,[1/a,1/a,1]),c}function ws(v,t,a,c){if(v){const p=f.N();if(!t){const{vecSouth:b,vecEast:T}=Ua(a);p[0]=T[0],p[1]=T[1],p[4]=b[0],p[5]=b[1]}return f.Q(p,p,[c,c,1]),p}return a.pixelsToClipSpaceMatrix}function Ua(v){const t=Math.cos(v.rollInRadians),a=Math.sin(v.rollInRadians),c=Math.cos(v.pitchInRadians),p=Math.cos(v.bearingInRadians),b=Math.sin(v.bearingInRadians),T=f.aD();T[0]=-p*c*a-b*t,T[1]=-b*c*a+p*t;const C=f.aE(T);C<1e-9?f.aF(T):f.aG(T,T,1/C);const A=f.aD();A[0]=p*c*t-b*a,A[1]=b*c*t+p*a;const z=f.aE(A);return z<1e-9?f.aF(A):f.aG(A,A,1/z),{vecEast:A,vecSouth:T}}function yn(v,t,a,c){let p;c?(p=[v,t,c(v,t),1],f.aI(p,p,a)):(p=[v,t,0,1],ja(p,p,a));const b=p[3];return{point:new f.P(p[0]/b,p[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function as(v,t){return .5+v/t*.5}function ui(v,t){return v.x>=-t[0]&&v.x<=t[0]&&v.y>=-t[1]&&v.y<=t[1]}function js(v,t,a,c,p,b,T,C,A,z,N,Z,q){const Q=a?v.textSizeData:v.iconSizeData,ne=f.az(Q,t.transform.zoom),he=[256/t.width*2+1,256/t.height*2+1],pe=a?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;pe.clear();const de=v.lineVertexArray,me=a?v.text.placedSymbolArray:v.icon.placedSymbolArray,Ee=t.transform.width/t.transform.height;let _e=!1;for(let Ce=0;Ce<me.length;Ce++){const Ae=me.get(Ce);if(Ae.hidden||Ae.writingMode===f.aA.vertical&&!_e){Es(Ae.numGlyphs,pe);continue}_e=!1;const be=new f.P(Ae.anchorX,Ae.anchorY),ze={getElevation:q,pitchedLabelPlaneMatrix:c,lineVertexArray:de,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:be,unwrappedTileID:A,width:z,height:N,translation:Z},$e=Yr(Ae.anchorX,Ae.anchorY,ze);if(!ui($e.point,he)){Es(Ae.numGlyphs,pe);continue}const Ze=as(t.transform.cameraToCenterDistance,$e.signedDistanceFromCamera),We=f.aB(Q,ne,Ae),Qe=b?We*t.transform.getPitchedTextCorrection(Ae.anchorX,Ae.anchorY,A)/Ze:We*Ze,mt=xi({projectionContext:ze,pitchedLabelPlaneMatrixInverse:p,symbol:Ae,fontSize:Qe,flip:!1,keepUpright:T,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:pe,aspectRatio:Ee,rotateToLine:C});_e=mt.useVertical,(mt.notEnoughRoom||_e||mt.needsFlipping&&xi({projectionContext:ze,pitchedLabelPlaneMatrixInverse:p,symbol:Ae,fontSize:Qe,flip:!0,keepUpright:T,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:pe,aspectRatio:Ee,rotateToLine:C}).notEnoughRoom)&&Es(Ae.numGlyphs,pe)}a?v.text.dynamicLayoutVertexBuffer.updateData(pe):v.icon.dynamicLayoutVertexBuffer.updateData(pe)}function Ts(v,t,a,c,p,b,T,C){const A=b.glyphStartIndex+b.numGlyphs,z=b.lineStartIndex,N=b.lineStartIndex+b.lineLength,Z=t.getoffsetX(b.glyphStartIndex),q=t.getoffsetX(A-1),Q=Hr(v*Z,a,c,p,b.segment,z,N,C,T);if(!Q)return null;const ne=Hr(v*q,a,c,p,b.segment,z,N,C,T);return ne?C.projectionCache.anyProjectionOccluded?null:{first:Q,last:ne}:null}function Ia(v,t,a,c){return v===f.aA.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*c?{useVertical:!0}:(v===f.aA.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function xi(v){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:c,fontSize:p,flip:b,keepUpright:T,glyphOffsetArray:C,dynamicLayoutVertexArray:A,aspectRatio:z,rotateToLine:N}=v,Z=p/24,q=c.lineOffsetX*Z,Q=c.lineOffsetY*Z;let ne;if(c.numGlyphs>1){const he=c.glyphStartIndex+c.numGlyphs,pe=c.lineStartIndex,de=c.lineStartIndex+c.lineLength,me=Ts(Z,C,q,Q,b,c,N,t);if(!me)return{notEnoughRoom:!0};const Ee=Gs(me.first.point.x,me.first.point.y,t,a),_e=Gs(me.last.point.x,me.last.point.y,t,a);if(T&&!b){const Ce=Ia(c.writingMode,Ee,_e,z);if(Ce)return Ce}ne=[me.first];for(let Ce=c.glyphStartIndex+1;Ce<he-1;Ce++){const Ae=Hr(Z*C.getoffsetX(Ce),q,Q,b,c.segment,pe,de,t,N);if(!Ae)return{notEnoughRoom:!0};ne.push(Ae)}ne.push(me.last)}else{if(T&&!b){const pe=Vn(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,de=c.lineStartIndex+c.segment+1,me=new f.P(t.lineVertexArray.getx(de),t.lineVertexArray.gety(de)),Ee=Vn(me.x,me.y,t),_e=Ee.signedDistanceFromCamera>0?Ee.point:lo(t.tileAnchorPoint,me,pe,1,t),Ce=Gs(pe.x,pe.y,t,a),Ae=Gs(_e.x,_e.y,t,a),be=Ia(c.writingMode,Ce,Ae,z);if(be)return be}const he=Hr(Z*C.getoffsetX(c.glyphStartIndex),q,Q,b,c.segment,c.lineStartIndex,c.lineStartIndex+c.lineLength,t,N);if(!he||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ne=[he]}for(const he of ne)f.aH(A,he.point,he.angle);return{}}function lo(v,t,a,c,p){const b=v.add(v.sub(t)._unit()),T=Vn(b.x,b.y,p).point,C=a.sub(T);return a.add(C._mult(c/C.mag()))}function Tr(v,t,a){const c=t.projectionCache;if(c.projections[v])return c.projections[v];const p=new f.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),b=Vn(p.x,p.y,t);if(b.signedDistanceFromCamera>0)return c.projections[v]=b.point,c.anyProjectionOccluded=c.anyProjectionOccluded||b.isOccluded,b.point;const T=v-a.direction;return lo(a.distanceFromAnchor===0?t.tileAnchorPoint:new f.P(t.lineVertexArray.getx(T),t.lineVertexArray.gety(T)),p,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function Vn(v,t,a){const c=v+a.translation[0],p=t+a.translation[1];let b;return a.pitchWithMap?(b=yn(c,p,a.pitchedLabelPlaneMatrix,a.getElevation),b.isOccluded=!1):(b=a.transform.projectTileCoordinates(c,p,a.unwrappedTileID,a.getElevation),b.point.x=(.5*b.point.x+.5)*a.width,b.point.y=(.5*-b.point.y+.5)*a.height),b}function Gs(v,t,a,c){if(a.pitchWithMap){const p=[v,t,0,1];return f.aI(p,p,c),a.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],a.unwrappedTileID,a.getElevation).point}return{x:v/a.width*2-1,y:1-t/a.height*2}}function Yr(v,t,a){return a.transform.projectTileCoordinates(v,t,a.unwrappedTileID,a.getElevation)}function ss(v,t,a){return v._unit()._perp()._mult(t*a)}function Ss(v,t,a,c,p,b,T,C,A){if(C.projectionCache.offsets[v])return C.projectionCache.offsets[v];const z=a.add(t);if(v+A.direction<c||v+A.direction>=p)return C.projectionCache.offsets[v]=z,z;const N=Tr(v+A.direction,C,A),Z=ss(N.sub(a),T,A.direction),q=a.add(Z),Q=N.add(Z);return C.projectionCache.offsets[v]=f.aJ(b,z,q,Q)||z,C.projectionCache.offsets[v]}function Hr(v,t,a,c,p,b,T,C,A){const z=c?v-t:v+t;let N=z>0?1:-1,Z=0;c&&(N*=-1,Z=Math.PI),N<0&&(Z+=Math.PI);let q,Q=N>0?b+p:b+p+1;C.projectionCache.cachedAnchorPoint?q=C.projectionCache.cachedAnchorPoint:(q=Vn(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=q);let ne,he,pe=q,de=q,me=0,Ee=0;const _e=Math.abs(z),Ce=[];let Ae;for(;me+Ee<=_e;){if(Q+=N,Q<b||Q>=T)return null;me+=Ee,de=pe,he=ne;const $e={absOffsetX:_e,direction:N,distanceFromAnchor:me,previousVertex:de};if(pe=Tr(Q,C,$e),a===0)Ce.push(de),Ae=pe.sub(de);else{let Ze;const We=pe.sub(de);Ze=We.mag()===0?ss(Tr(Q+N,C,$e).sub(pe),a,N):ss(We,a,N),he||(he=de.add(Ze)),ne=Ss(Q,Ze,pe,b,T,he,a,C,$e),Ce.push(he),Ae=ne.sub(he)}Ee=Ae.mag()}const be=Ae._mult((_e-me)/Ee)._add(he||de),ze=Z+Math.atan2(pe.y-de.y,pe.x-de.x);return Ce.push(be),{point:be,angle:A?ze:0,path:Ce}}const Fo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Es(v,t){for(let a=0;a<v;a++){const c=t.length;t.resize(c+4),t.float32.set(Fo,3*c)}}function ja(v,t,a){const c=t[0],p=t[1];return v[0]=a[0]*c+a[4]*p+a[12],v[1]=a[1]*c+a[5]*p+a[13],v[3]=a[3]*c+a[7]*p+a[15],v}const Yn=100;class Du{constructor(t,a=new Tn(t.width+200,t.height+200,25),c=new Tn(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=c,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Yn,this.screenBottomBoundary=t.height+Yn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,c,p,b,T,C,A,z,N,Z,q){const Q=this.projectAndGetPerspectiveRatio(t.anchorPointX+A[0],t.anchorPointY+A[1],b,N,q),ne=c*Q.perspectiveRatio;let he;if(T||C)he=this._projectCollisionBox(t,ne,p,b,T,C,A,Q,N,Z,q);else{const Ae=Q.x+(Z?Z.x*ne:0),be=Q.y+(Z?Z.y*ne:0);he={allPointsOccluded:!1,box:[Ae+t.x1*ne,be+t.y1*ne,Ae+t.x2*ne,be+t.y2*ne]}}const[pe,de,me,Ee]=he.box,_e=T?he.allPointsOccluded:Q.isOccluded;let Ce=_e;return Ce||(Ce=Q.perspectiveRatio<this.perspectiveRatioCutoff),Ce||(Ce=!this.isInsideGrid(pe,de,me,Ee)),Ce||a!=="always"&&this.grid.hitTest(pe,de,me,Ee,a,z)?{box:[pe,de,me,Ee],placeable:!1,offscreen:!1,occluded:_e}:{box:[pe,de,me,Ee],placeable:!0,offscreen:this.isOffscreen(pe,de,me,Ee),occluded:_e}}placeCollisionCircles(t,a,c,p,b,T,C,A,z,N,Z,q,Q,ne){const he=[],pe=new f.P(a.anchorX,a.anchorY),de=this.getPerspectiveRatio(pe.x,pe.y,T,ne),me=(z?b*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,T)/de:b*de)/f.aN,Ee={getElevation:ne,pitchedLabelPlaneMatrix:C,lineVertexArray:c,pitchWithMap:z,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:pe,unwrappedTileID:T,width:this.transform.width,height:this.transform.height,translation:Q},_e=Ts(me,p,a.lineOffsetX*me,a.lineOffsetY*me,!1,a,!1,Ee);let Ce=!1,Ae=!1,be=!0;if(_e){const ze=.5*Z*de+q,$e=new f.P(-100,-100),Ze=new f.P(this.screenRightBoundary,this.screenBottomBoundary),We=new St,Qe=_e.first,mt=_e.last;let kt=[];for(let Sn=Qe.path.length-1;Sn>=1;Sn--)kt.push(Qe.path[Sn]);for(let Sn=1;Sn<mt.path.length;Sn++)kt.push(mt.path[Sn]);const dt=2.5*ze;if(z){const Sn=this.projectPathToScreenSpace(kt,Ee);kt=Sn.some((ti=>ti.signedDistanceFromCamera<=0))?[]:Sn.map((ti=>ti.point))}let Wt=[];if(kt.length>0){const Sn=kt[0].clone(),ti=kt[0].clone();for(let Si=1;Si<kt.length;Si++)Sn.x=Math.min(Sn.x,kt[Si].x),Sn.y=Math.min(Sn.y,kt[Si].y),ti.x=Math.max(ti.x,kt[Si].x),ti.y=Math.max(ti.y,kt[Si].y);Wt=Sn.x>=$e.x&&ti.x<=Ze.x&&Sn.y>=$e.y&&ti.y<=Ze.y?[kt]:ti.x<$e.x||Sn.x>Ze.x||ti.y<$e.y||Sn.y>Ze.y?[]:f.aK([kt],$e.x,$e.y,Ze.x,Ze.y)}for(const Sn of Wt){We.reset(Sn,.25*ze);let ti=0;ti=We.length<=.5*ze?1:Math.ceil(We.paddedLength/dt)+1;for(let Si=0;Si<ti;Si++){const ri=Si/Math.max(ti-1,1),Oi=We.lerp(ri),fi=Oi.x+Yn,Sr=Oi.y+Yn;he.push(fi,Sr,ze,0);const Pi=fi-ze,Er=Sr-ze,Qi=fi+ze,ir=Sr+ze;if(be=be&&this.isOffscreen(Pi,Er,Qi,ir),Ae=Ae||this.isInsideGrid(Pi,Er,Qi,ir),t!=="always"&&this.grid.hitTestCircle(fi,Sr,ze,t,N)&&(Ce=!0,!A))return{circles:[],offscreen:!1,collisionDetected:Ce}}}}return{circles:!A&&Ce||!Ae||de<this.perspectiveRatioCutoff?[]:he,offscreen:be,collisionDetected:Ce}}projectPathToScreenSpace(t,a){const c=(function(p,b){const T=f.N();return f.aC(T,b.pitchedLabelPlaneMatrix),p.map((C=>{const A=yn(C.x,C.y,T,b.getElevation),z=b.transform.projectTileCoordinates(A.point.x,A.point.y,b.unwrappedTileID,b.getElevation);return z.point.x=(.5*z.point.x+.5)*b.width,z.point.y=(.5*-z.point.y+.5)*b.height,z}))})(t,a);return(function(p){let b=0,T=0,C=0,A=0;for(let z=0;z<p.length;z++)p[z].isOccluded?(C=z+1,A=0):(A++,A>T&&(T=A,b=C));return p.slice(b,b+T)})(c)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],c=new f.ac;for(const Z of t){const q=new f.P(Z.x+Yn,Z.y+Yn);c.extend(q),a.push(q)}const{minX:p,minY:b,maxX:T,maxY:C}=c,A=this.grid.query(p,b,T,C).concat(this.ignoredGrid.query(p,b,T,C)),z={},N={};for(const Z of A){const q=Z.key;if(z[q.bucketInstanceId]===void 0&&(z[q.bucketInstanceId]={}),z[q.bucketInstanceId][q.featureIndex])continue;const Q=[new f.P(Z.x1,Z.y1),new f.P(Z.x2,Z.y1),new f.P(Z.x2,Z.y2),new f.P(Z.x1,Z.y2)];f.aL(a,Q)&&(z[q.bucketInstanceId][q.featureIndex]=!0,N[q.bucketInstanceId]===void 0&&(N[q.bucketInstanceId]=[]),N[q.bucketInstanceId].push(q.featureIndex))}return N}insertCollisionBox(t,a,c,p,b,T){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:b,collisionGroupID:T,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,c,p,b,T){const C=c?this.ignoredGrid:this.grid,A={bucketInstanceId:p,featureIndex:b,collisionGroupID:T,overlapMode:a};for(let z=0;z<t.length;z+=4)C.insertCircle(A,t[z],t[z+1],t[z+2])}projectAndGetPerspectiveRatio(t,a,c,p,b){if(b){let T;p?(T=[t,a,p(t,a),1],f.aI(T,T,b)):(T=[t,a,0,1],ja(T,T,b));const C=T[3];return{x:(T[0]/C+1)/2*this.transform.width+Yn,y:(-T[1]/C+1)/2*this.transform.height+Yn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}{const T=this.transform.projectTileCoordinates(t,a,c,p);return{x:(T.point.x+1)/2*this.transform.width+Yn,y:(1-T.point.y)/2*this.transform.height+Yn,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5,isOccluded:T.isOccluded,signedDistanceFromCamera:T.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,c,p){const b=this.transform.projectTileCoordinates(t,a,c,p);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(t,a,c,p){return c<Yn||t>=this.screenRightBoundary||p<Yn||a>this.screenBottomBoundary}isInsideGrid(t,a,c,p){return c>=0&&t<this.gridRightBoundary&&p>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=f.as([]);return f.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,c,p,b,T,C,A,z,N,Z){let q=1,Q=0,ne=0,he=1;const pe=t.anchorPointX+C[0],de=t.anchorPointY+C[1];if(T&&!b){const kt=this.projectAndGetPerspectiveRatio(pe+1,de,p,z,Z),dt=kt.x-A.x,Wt=Math.atan((kt.y-A.y)/dt)+(dt<0?Math.PI:0),Sn=Math.sin(Wt),ti=Math.cos(Wt);q=ti,Q=Sn,ne=-Sn,he=ti}else if(!T&&b){const kt=Ua(this.transform);q=kt.vecEast[0],Q=kt.vecEast[1],ne=kt.vecSouth[0],he=kt.vecSouth[1]}let me=A.x,Ee=A.y,_e=a;b&&(me=pe,Ee=de,_e=Math.pow(2,-(this.transform.zoom-c.overscaledZ)),_e*=this.transform.getPitchedTextCorrection(pe,de,p),N||(_e*=f.ao(.5+A.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),N&&(me+=q*N.x*_e+ne*N.y*_e,Ee+=Q*N.x*_e+he*N.y*_e);const Ce=t.x1*_e,Ae=t.x2*_e,be=(Ce+Ae)/2,ze=t.y1*_e,$e=t.y2*_e,Ze=(ze+$e)/2,We=[{offsetX:Ce,offsetY:ze},{offsetX:be,offsetY:ze},{offsetX:Ae,offsetY:ze},{offsetX:Ae,offsetY:Ze},{offsetX:Ae,offsetY:$e},{offsetX:be,offsetY:$e},{offsetX:Ce,offsetY:$e},{offsetX:Ce,offsetY:Ze}];let Qe=[];for(const{offsetX:kt,offsetY:dt}of We)Qe.push(new f.P(me+q*kt+ne*dt,Ee+Q*kt+he*dt));let mt=!1;if(b){const kt=Qe.map((dt=>this.projectAndGetPerspectiveRatio(dt.x,dt.y,p,z,Z)));mt=kt.some((dt=>!dt.isOccluded)),Qe=kt.map((dt=>new f.P(dt.x,dt.y)))}else mt=!0;return{box:f.aM(Qe),allPointsOccluded:!mt}}}class mc{constructor(t,a,c,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Ms{constructor(t,a,c,p,b){this.text=new mc(t?t.text:null,a,c,b),this.icon=new mc(t?t.icon:null,a,p,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class os{constructor(t,a,c){this.text=t,this.icon=a,this.skipFade=c}}class Ga{constructor(t,a,c,p,b){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=b}}class gc{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:c=>c.collisionGroupID===a}}return this.collisionGroups[t]}}function lr(v,t,a,c,p){const{horizontalAlign:b,verticalAlign:T}=f.aT(v);return new f.P(-(b-.5)*t+c[0]*p,-(T-.5)*a+c[1]*p)}class ql{constructor(t,a,c,p,b){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Du(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new gc(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(c,p)=>a.getElevation(t,c,p):null}getBucketParts(t,a,c,p){const b=c.getBucket(a),T=c.latestFeatureIndex;if(!b||!T||a.id!==b.layerIds[0])return;const C=c.collisionBoxArray,A=b.layers[0].layout,z=b.layers[0].paint,N=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),Z=c.tileSize/f.a5,q=c.tileID.toUnwrapped(),Q=A.get("text-rotation-alignment")==="map",ne=f.aO(c,1,this.transform.zoom),he=f.aP(this.collisionIndex.transform,c,z.get("text-translate"),z.get("text-translate-anchor")),pe=f.aP(this.collisionIndex.transform,c,z.get("icon-translate"),z.get("icon-translate-anchor")),de=gr(Q,this.transform,ne);this.retainedQueryData[b.bucketInstanceId]=new Ga(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,c.tileID);const me={bucket:b,layout:A,translationText:he,translationIcon:pe,unwrappedTileID:q,pitchedLabelPlaneMatrix:de,scale:N,textPixelRatio:Z,holdingForFade:c.holdingForSymbolFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:f.az(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(p)for(const Ee of b.sortKeyRanges){const{sortKey:_e,symbolInstanceStart:Ce,symbolInstanceEnd:Ae}=Ee;t.push({sortKey:_e,symbolInstanceStart:Ce,symbolInstanceEnd:Ae,parameters:me})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:me})}attemptAnchorPlacement(t,a,c,p,b,T,C,A,z,N,Z,q,Q,ne,he,pe,de,me,Ee,_e){const Ce=f.aQ[t.textAnchor],Ae=[t.textOffset0,t.textOffset1],be=lr(Ce,c,p,Ae,b),ze=this.collisionIndex.placeCollisionBox(a,q,A,z,N,C,T,pe,Z.predicate,Ee,be,_e);if((!me||this.collisionIndex.placeCollisionBox(me,q,A,z,N,C,T,de,Z.predicate,Ee,be,_e).placeable)&&ze.placeable){let $e;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID]&&this.prevPlacement.placements[Q.crossTileID].text&&($e=this.prevPlacement.variableOffsets[Q.crossTileID].anchor),Q.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Q.crossTileID]={textOffset:Ae,width:c,height:p,anchor:Ce,textBoxScale:b,prevAnchor:$e},this.markUsedJustification(ne,Ce,Q,he),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,he,Q),this.placedOrientations[Q.crossTileID]=he),{shift:be,placedGlyphBoxes:ze}}}placeLayerBucketPart(t,a,c){const{bucket:p,layout:b,translationText:T,translationIcon:C,unwrappedTileID:A,pitchedLabelPlaneMatrix:z,textPixelRatio:N,holdingForFade:Z,collisionBoxArray:q,partiallyEvaluatedTextSize:Q,collisionGroup:ne}=t.parameters,he=b.get("text-optional"),pe=b.get("icon-optional"),de=f.aR(b,"text-overlap","text-allow-overlap"),me=de==="always",Ee=f.aR(b,"icon-overlap","icon-allow-overlap"),_e=Ee==="always",Ce=b.get("text-rotation-alignment")==="map",Ae=b.get("text-pitch-alignment")==="map",be=b.get("icon-text-fit")!=="none",ze=b.get("symbol-z-order")==="viewport-y",$e=me&&(_e||!p.hasIconData()||pe),Ze=_e&&(me||!p.hasTextData()||he);!p.collisionArrays&&q&&p.deserializeCollisionBoxes(q);const We=this.retainedQueryData[p.bucketInstanceId].tileID,Qe=this._getTerrainElevationFunc(We),mt=this.transform.getFastPathSimpleProjectionMatrix(We),kt=(dt,Wt,Sn)=>{var ti,Si;if(a[dt.crossTileID])return;if(Z)return void(this.placements[dt.crossTileID]=new os(!1,!1,!1));let ri=!1,Oi=!1,fi=!0,Sr=null,Pi={box:null,placeable:!1,offscreen:null,occluded:!1},Er={placeable:!1},Qi=null,ir=null,ta=null,pa=0,Js=0,sl=0;Wt.textFeatureIndex?pa=Wt.textFeatureIndex:dt.useRuntimeCollisionCircles&&(pa=dt.featureIndex),Wt.verticalTextFeatureIndex&&(Js=Wt.verticalTextFeatureIndex);const hu=Wt.textBox;if(hu){const Mr=Ki=>{let Cr=f.aA.horizontal;if(p.allowVerticalPlacement&&!Ki&&this.prevPlacement){const Na=this.prevPlacement.placedOrientations[dt.crossTileID];Na&&(this.placedOrientations[dt.crossTileID]=Na,Cr=Na,this.markUsedOrientation(p,Cr,dt))}return Cr},Ur=(Ki,Cr)=>{if(p.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Wt.verticalTextBox){for(const Na of p.writingModes)if(Na===f.aA.vertical?(Pi=Cr(),Er=Pi):Pi=Ki(),Pi&&Pi.placeable)break}else Pi=Ki()},na=dt.textAnchorOffsetStartIndex,gs=dt.textAnchorOffsetEndIndex;if(gs===na){const Ki=(Cr,Na)=>{const Vi=this.collisionIndex.placeCollisionBox(Cr,de,N,We,A,Ae,Ce,T,ne.predicate,Qe,void 0,mt);return Vi&&Vi.placeable&&(this.markUsedOrientation(p,Na,dt),this.placedOrientations[dt.crossTileID]=Na),Vi};Ur((()=>Ki(hu,f.aA.horizontal)),(()=>{const Cr=Wt.verticalTextBox;return p.allowVerticalPlacement&&dt.numVerticalGlyphVertices>0&&Cr?Ki(Cr,f.aA.vertical):{box:null,offscreen:null}})),Mr(Pi&&Pi.placeable)}else{let Ki=f.aQ[(Si=(ti=this.prevPlacement)===null||ti===void 0?void 0:ti.variableOffsets[dt.crossTileID])===null||Si===void 0?void 0:Si.anchor];const Cr=(Vi,mf,Eh)=>{const Mh=Vi.x2-Vi.x1,gf=Vi.y2-Vi.y1,_s=dt.textBoxScale,zl=be&&Ee==="never"?mf:null;let ol=null,_f=de==="never"?1:2,du="never";Ki&&_f++;for(let Ch=0;Ch<_f;Ch++){for(let Ol=na;Ol<gs;Ol++){const Ih=p.textAnchorOffsets.get(Ol);if(Ki&&Ih.textAnchor!==Ki)continue;const Ah=this.attemptAnchorPlacement(Ih,Vi,Mh,gf,_s,Ce,Ae,N,We,A,ne,du,dt,p,Eh,T,C,zl,Qe);if(Ah&&(ol=Ah.placedGlyphBoxes,ol&&ol.placeable))return ri=!0,Sr=Ah.shift,ol}Ki?Ki=null:du=de}return c&&!ol&&(ol={box:this.collisionIndex.placeCollisionBox(hu,"always",N,We,A,Ae,Ce,T,ne.predicate,Qe,void 0,mt).box,offscreen:!1,placeable:!1,occluded:!1}),ol};Ur((()=>Cr(hu,Wt.iconBox,f.aA.horizontal)),(()=>{const Vi=Wt.verticalTextBox;return p.allowVerticalPlacement&&(!Pi||!Pi.placeable)&&dt.numVerticalGlyphVertices>0&&Vi?Cr(Vi,Wt.verticalIconBox,f.aA.vertical):{box:null,occluded:!0,offscreen:null}})),Pi&&(ri=Pi.placeable,fi=Pi.offscreen);const Na=Mr(Pi&&Pi.placeable);if(!ri&&this.prevPlacement){const Vi=this.prevPlacement.variableOffsets[dt.crossTileID];Vi&&(this.variableOffsets[dt.crossTileID]=Vi,this.markUsedJustification(p,Vi.anchor,dt,Na))}}}if(Qi=Pi,ri=Qi&&Qi.placeable,fi=Qi&&Qi.offscreen,dt.useRuntimeCollisionCircles&&dt.centerJustifiedTextSymbolIndex>=0){const Mr=p.text.placedSymbolArray.get(dt.centerJustifiedTextSymbolIndex),Ur=f.aB(p.textSizeData,Q,Mr),na=b.get("text-padding");ir=this.collisionIndex.placeCollisionCircles(de,Mr,p.lineVertexArray,p.glyphOffsetArray,Ur,A,z,c,Ae,ne.predicate,dt.collisionCircleDiameter,na,T,Qe),ir.circles.length&&ir.collisionDetected&&!c&&f.w("Collisions detected, but collision boxes are not shown"),ri=me||ir.circles.length>0&&!ir.collisionDetected,fi=fi&&ir.offscreen}if(Wt.iconFeatureIndex&&(sl=Wt.iconFeatureIndex),Wt.iconBox){const Mr=Ur=>this.collisionIndex.placeCollisionBox(Ur,Ee,N,We,A,Ae,Ce,C,ne.predicate,Qe,be&&Sr?Sr:void 0,mt);Er&&Er.placeable&&Wt.verticalIconBox?(ta=Mr(Wt.verticalIconBox),Oi=ta.placeable):(ta=Mr(Wt.iconBox),Oi=ta.placeable),fi=fi&&ta.offscreen}const Sh=he||dt.numHorizontalGlyphVertices===0&&dt.numVerticalGlyphVertices===0,fu=pe||dt.numIconVertices===0;Sh||fu?fu?Sh||(Oi=Oi&&ri):ri=Oi&&ri:Oi=ri=Oi&&ri;const Wa=Oi&&ta.placeable;if(ri&&Qi.placeable&&this.collisionIndex.insertCollisionBox(Qi.box,de,b.get("text-ignore-placement"),p.bucketInstanceId,Er&&Er.placeable&&Js?Js:pa,ne.ID),Wa&&this.collisionIndex.insertCollisionBox(ta.box,Ee,b.get("icon-ignore-placement"),p.bucketInstanceId,sl,ne.ID),ir&&ri&&this.collisionIndex.insertCollisionCircles(ir.circles,de,b.get("text-ignore-placement"),p.bucketInstanceId,pa,ne.ID),c&&this.storeCollisionData(p.bucketInstanceId,Sn,Wt,Qi,ta,ir),dt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[dt.crossTileID]=new os((ri||$e)&&!Qi?.occluded,(Oi||Ze)&&!ta?.occluded,fi||p.justReloaded),a[dt.crossTileID]=!0};if(ze){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const dt=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Wt=dt.length-1;Wt>=0;--Wt){const Sn=dt[Wt];kt(p.symbolInstances.get(Sn),p.collisionArrays[Sn],Sn)}}else for(let dt=t.symbolInstanceStart;dt<t.symbolInstanceEnd;dt++)kt(p.symbolInstances.get(dt),p.collisionArrays[dt],dt);p.justReloaded=!1}storeCollisionData(t,a,c,p,b,T){if(c.textBox||c.iconBox){let C,A;this.collisionBoxArrays.has(t)?C=this.collisionBoxArrays.get(t):(C=new Map,this.collisionBoxArrays.set(t,C)),C.has(a)?A=C.get(a):(A={text:null,icon:null},C.set(a,A)),c.textBox&&(A.text=p.box),c.iconBox&&(A.icon=b.box)}if(T){let C=this.collisionCircleArrays[t];C===void 0&&(C=this.collisionCircleArrays[t]=[]);for(let A=0;A<T.circles.length;A+=4)C.push(T.circles[A+0]-Yn),C.push(T.circles[A+1]-Yn),C.push(T.circles[A+2]),C.push(T.collisionDetected?1:0)}}markUsedJustification(t,a,c,p){let b;b=p===f.aA.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[f.aS(a)];const T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const C of T)C>=0&&(t.text.placedSymbolArray.get(C).crossTileID=b>=0&&C!==b?0:c.crossTileID)}markUsedOrientation(t,a,c){const p=a===f.aA.horizontal||a===f.aA.horizontalOnly?a:0,b=a===f.aA.vertical?a:0,T=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const C of T)t.text.placedSymbolArray.get(C).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let c=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const p=a?a.symbolFadeChange(t):1,b=a?a.opacities:{},T=a?a.variableOffsets:{},C=a?a.placedOrientations:{};for(const A in this.placements){const z=this.placements[A],N=b[A];N?(this.opacities[A]=new Ms(N,p,z.text,z.icon),c=c||z.text!==N.text.placed||z.icon!==N.icon.placed):(this.opacities[A]=new Ms(null,p,z.text,z.icon,z.skipFade),c=c||z.text||z.icon)}for(const A in b){const z=b[A];if(!this.opacities[A]){const N=new Ms(z,p,!1,!1);N.isHidden()||(this.opacities[A]=N,c=c||z.text.placed||z.icon.placed)}}for(const A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(const A in C)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=C[A]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const c={};for(const p of a){const b=p.getBucket(t);b&&p.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,p.tileID,c,p.collisionBoxArray)}}updateBucketOpacities(t,a,c,p){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const b=t.layers[0],T=b.layout,C=new Ms(null,0,!1,!1,!0),A=T.get("text-allow-overlap"),z=T.get("icon-allow-overlap"),N=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Z=T.get("text-rotation-alignment")==="map",q=T.get("text-pitch-alignment")==="map",Q=T.get("icon-text-fit")!=="none",ne=new Ms(null,0,A&&(z||!t.hasIconData()||T.get("icon-optional")),z&&(A||!t.hasTextData()||T.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const he=(de,me,Ee)=>{for(let _e=0;_e<me/4;_e++)de.opacityVertexArray.emplaceBack(Ee);de.hasVisibleVertices=de.hasVisibleVertices||Ee!==qs},pe=this.collisionBoxArrays.get(t.bucketInstanceId);for(let de=0;de<t.symbolInstances.length;de++){const me=t.symbolInstances.get(de),{numHorizontalGlyphVertices:Ee,numVerticalGlyphVertices:_e,crossTileID:Ce}=me;let Ae=this.opacities[Ce];c[Ce]?Ae=C:Ae||(Ae=ne,this.opacities[Ce]=Ae),c[Ce]=!0;const be=me.numIconVertices>0,ze=this.placedOrientations[me.crossTileID],$e=ze===f.aA.vertical,Ze=ze===f.aA.horizontal||ze===f.aA.horizontalOnly;if(Ee>0||_e>0){const Qe=Ru(Ae.text);he(t.text,Ee,$e?qs:Qe),he(t.text,_e,Ze?qs:Qe);const mt=Ae.text.isHidden();[me.rightJustifiedTextSymbolIndex,me.centerJustifiedTextSymbolIndex,me.leftJustifiedTextSymbolIndex].forEach((Wt=>{Wt>=0&&(t.text.placedSymbolArray.get(Wt).hidden=mt||$e?1:0)})),me.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(me.verticalPlacedTextSymbolIndex).hidden=mt||Ze?1:0);const kt=this.variableOffsets[me.crossTileID];kt&&this.markUsedJustification(t,kt.anchor,me,ze);const dt=this.placedOrientations[me.crossTileID];dt&&(this.markUsedJustification(t,"left",me,dt),this.markUsedOrientation(t,dt,me))}if(be){const Qe=Ru(Ae.icon),mt=!(Q&&me.verticalPlacedIconSymbolIndex&&$e);me.placedIconSymbolIndex>=0&&(he(t.icon,me.numIconVertices,mt?Qe:qs),t.icon.placedSymbolArray.get(me.placedIconSymbolIndex).hidden=Ae.icon.isHidden()),me.verticalPlacedIconSymbolIndex>=0&&(he(t.icon,me.numVerticalIconVertices,mt?qs:Qe),t.icon.placedSymbolArray.get(me.verticalPlacedIconSymbolIndex).hidden=Ae.icon.isHidden())}const We=pe&&pe.has(de)?pe.get(de):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Qe=t.collisionArrays[de];if(Qe){let mt=new f.P(0,0);if(Qe.textBox||Qe.verticalTextBox){let kt=!0;if(N){const dt=this.variableOffsets[Ce];dt?(mt=lr(dt.anchor,dt.width,dt.height,dt.textOffset,dt.textBoxScale),Z&&mt._rotate(q?-this.transform.bearingInRadians:this.transform.bearingInRadians)):kt=!1}if(Qe.textBox||Qe.verticalTextBox){let dt;Qe.textBox&&(dt=$e),Qe.verticalTextBox&&(dt=Ze),Pu(t.textCollisionBox.collisionVertexArray,Ae.text.placed,!kt||dt,We.text,mt.x,mt.y)}}if(Qe.iconBox||Qe.verticalIconBox){const kt=!!(!Ze&&Qe.verticalIconBox);let dt;Qe.iconBox&&(dt=kt),Qe.verticalIconBox&&(dt=!kt),Pu(t.iconCollisionBox.collisionVertexArray,Ae.icon.placed,dt,We.icon,Q?mt.x:0,Q?mt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const c=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function Pu(v,t,a,c,p,b){c&&c.length!==0||(c=[0,0,0,0]);const T=c[0]-Yn,C=c[1]-Yn,A=c[2]-Yn,z=c[3]-Yn;v.emplaceBack(t?1:0,a?1:0,p||0,b||0,T,C),v.emplaceBack(t?1:0,a?1:0,p||0,b||0,A,C),v.emplaceBack(t?1:0,a?1:0,p||0,b||0,A,z),v.emplaceBack(t?1:0,a?1:0,p||0,b||0,T,z)}const Zl=Math.pow(2,25),uo=Math.pow(2,24),_c=Math.pow(2,17),Cs=Math.pow(2,16),Is=Math.pow(2,9),ih=Math.pow(2,8),co=Math.pow(2,1);function Ru(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const t=v.placed?1:0,a=Math.floor(127*v.opacity);return a*Zl+t*uo+a*_c+t*Cs+a*Is+t*ih+a*co+t}const qs=0;class ei{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,c,p,b){const T=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(T,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort(((C,A)=>C.sortKey-A.sortKey)));this._currentPartIndex<T.length;)if(a.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1}}class qa{constructor(t,a,c,p,b,T,C,A){this.placement=new ql(t,a,T,C,A),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,a,c){const p=at(),b=()=>!this._forceFullPlacement&&at()-p>2;for(;this._currentPlacementIndex>=0;){const T=a[t[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=C)&&(!T.maxzoom||T.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new ei(T)),this._inProgressLayer.continuePlacement(c[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const In=512/f.a5/2;class Aa{constructor(t,a,c){this.tileID=t,this.bucketInstanceId=c,this._symbolsByKey={};const p=new Map;for(let b=0;b<a.length;b++){const T=a.get(b),C=T.key,A=p.get(C);A?A.push(T):p.set(C,[T])}for(const[b,T]of p){const C={positions:T.map((A=>({x:Math.floor(A.anchorX*In),y:Math.floor(A.anchorY*In)}))),crossTileIDs:T.map((A=>A.crossTileID))};if(C.positions.length>128){const A=new f.aU(C.positions.length,16,Uint16Array);for(const{x:z,y:N}of C.positions)A.add(z,N);A.finish(),delete C.positions,C.index=A}this._symbolsByKey[b]=C}}getScaledCoordinates(t,a){const{x:c,y:p,z:b}=this.tileID.canonical,{x:T,y:C,z:A}=a.canonical,z=In/Math.pow(2,A-b),N=(C*f.a5+t.anchorY)*z,Z=p*f.a5*In;return{x:Math.floor((T*f.a5+t.anchorX)*z-c*f.a5*In),y:Math.floor(N-Z)}}findMatches(t,a,c){const p=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let b=0;b<t.length;b++){const T=t.get(b);if(T.crossTileID)continue;const C=this._symbolsByKey[T.key];if(!C)continue;const A=this.getScaledCoordinates(T,a);if(C.index){const z=C.index.range(A.x-p,A.y-p,A.x+p,A.y+p).sort();for(const N of z){const Z=C.crossTileIDs[N];if(!c[Z]){c[Z]=!0,T.crossTileID=Z;break}}}else if(C.positions)for(let z=0;z<C.positions.length;z++){const N=C.positions[z],Z=C.crossTileIDs[z];if(Math.abs(N.x-A.x)<=p&&Math.abs(N.y-A.y)<=p&&!c[Z]){c[Z]=!0,T.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class ga{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const c in this.indexes){const p=this.indexes[c],b={};for(const T in p){const C=p[T];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+a),b[C.tileID.key]=C}this.indexes[c]=b}this.lng=t}addBucket(t,a,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>t.overscaledZ)for(const C in T){const A=T[C];A.tileID.isChildOf(t)&&A.findMatches(a.symbolInstances,t,p)}else{const C=T[t.scaledTo(Number(b)).key];C&&C.findMatches(a.symbolInstances,t,p)}}for(let b=0;b<a.symbolInstances.length;b++){const T=a.symbolInstances.get(b);T.crossTileID||(T.crossTileID=c.generate(),p[T.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Aa(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const c of a.getCrossTileIDsLists())for(const p of c)delete this.usedCrossTileIDs[t][p]}removeStaleBuckets(t){let a=!1;for(const c in this.indexes){const p=this.indexes[c];for(const b in p)t[p[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[b]),delete p[b],a=!0)}return a}}class Yi{constructor(){this.layerIndexes={},this.crossTileIDs=new ga,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,c){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new Xr);let b=!1;const T={};p.handleWrapJump(c);for(const C of a){const A=C.getBucket(t);A&&t.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(C.tileID,A,this.crossTileIDs)&&(b=!0),T[A.bucketInstanceId]=!0)}return p.removeStaleBuckets(T)&&(b=!0),b}pruneUnusedLayers(t){const a={};t.forEach((c=>{a[c]=!0}));for(const c in this.layerIndexes)a[c]||delete this.layerIndexes[c]}}var tr="void main() {fragColor=vec4(1.0);}";const ki={prelude:mn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:mn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:mn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:mn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:mn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:mn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:mn(tr,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:mn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:mn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:mn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:mn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:mn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:mn(tr,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:mn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:mn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:mn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:mn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:mn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:mn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:mn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:mn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:mn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:mn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:mn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:mn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:mn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:mn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:mn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:mn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:mn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:mn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:mn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:mn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:mn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:mn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function mn(v,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/in ([\w]+) ([\w]+)/g),p=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=b?b.concat(p):p,C={};return{fragmentSource:v=v.replace(a,((A,z,N,Z,q)=>(C[q]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${q}
in ${N} ${Z} ${q};
#else
uniform ${N} ${Z} u_${q};
#endif
`:`
#ifdef HAS_UNIFORM_u_${q}
    ${N} ${Z} ${q} = u_${q};
#endif
`))),vertexSource:t=t.replace(a,((A,z,N,Z,q)=>{const Q=Z==="float"?"vec2":"vec4",ne=q.match(/color/)?"color":Q;return C[q]?z==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${N} ${Q} a_${q};
out ${N} ${Z} ${q};
#else
uniform ${N} ${Z} u_${q};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = a_${q};
#else
    ${N} ${Z} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${q} = unpack_mix_${ne}(a_${q}, u_${q}_t);
#else
    ${N} ${Z} ${q} = u_${q};
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_${q}
uniform lowp float u_${q}_t;
in ${N} ${Q} a_${q};
#else
uniform ${N} ${Z} u_${q};
#endif
`:ne==="vec4"?`
#ifndef HAS_UNIFORM_u_${q}
    ${N} ${Z} ${q} = a_${q};
#else
    ${N} ${Z} ${q} = u_${q};
#endif
`:`
#ifndef HAS_UNIFORM_u_${q}
    ${N} ${Z} ${q} = unpack_mix_${ne}(a_${q}, u_${q}_t);
#else
    ${N} ${Z} ${q} = u_${q};
#endif
`})),staticAttributes:c,staticUniforms:T}}class Qn{constructor(t,a,c){this.vertexBuffer=t,this.indexBuffer=a,this.segments=c}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Za=f.aV([{name:"a_pos",type:"Int16",components:2}]);const Li="#define PROJECTION_MERCATOR",An="mercator";class ci{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return An}get shaderDefine(){return Li}get shaderPreludeCode(){return ki.projectionMercator}get vertexShaderPreludeCode(){return ki.projectionMercator.vertexSource}get subdivisionGranularity(){return f.aW.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,c,p,b){if(this._cachedMesh)return this._cachedMesh;const T=new f.aX;T.emplaceBack(0,0),T.emplaceBack(f.a5,0),T.emplaceBack(0,f.a5),T.emplaceBack(f.a5,f.a5);const C=t.createVertexBuffer(T,Za.members),A=f.aY.simpleSegment(0,0,4,2),z=new f.aZ;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3);const N=t.createIndexBuffer(z);return this._cachedMesh=new Qn(C,N,A),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class la{constructor(t=0,a=0,c=0,p=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=c,this.right=p}interpolate(t,a,c){return a.top!=null&&t.top!=null&&(this.top=f.G.number(t.top,a.top,c)),a.bottom!=null&&t.bottom!=null&&(this.bottom=f.G.number(t.bottom,a.bottom,c)),a.left!=null&&t.left!=null&&(this.left=f.G.number(t.left,a.left,c)),a.right!=null&&t.right!=null&&(this.right=f.G.number(t.right,a.right,c)),this}getCenter(t,a){const c=f.ao((this.left+t-this.right)/2,0,t),p=f.ao((this.top+a-this.bottom)/2,0,a);return new f.P(c,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new la(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ls(v,t){if(!v.renderWorldCopies||v.lngRange)return;const a=t.lng-v.center.lng;t.lng+=a>180?-360:a<-180?360:0}function si(v){return Math.max(0,Math.floor(v))}class Zs{constructor(t,a){var c;this.applyConstrain=(p,b)=>this._constrainOverride!==null?this._constrainOverride(p,b):this._callbacks.defaultConstrain(p,b),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(c=a?.constrainOverride)!==null&&c!==void 0?c:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new f.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=si(this._zoom),this._scale=f.ar(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new la,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,c){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=si(this._zoom),this._scale=f.ar(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new la(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!c&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new f.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=f.W(t,-180,180)*Math.PI/180;var c,p,b,T,C,A,z,N,Z;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=ge(),c=this._rotationMatrix,b=-this._bearingInRadians,T=(p=this._rotationMatrix)[0],C=p[1],A=p[2],z=p[3],N=Math.sin(b),Z=Math.cos(b),c[0]=T*Z+A*N,c[1]=C*Z+z*N,c[2]=T*-N+A*Z,c[3]=C*-N+z*Z)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=f.ao(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return f.a_(this._fovInRadians)}setFov(t){t=f.ao(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=f.aq(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=f.ar(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,c){this._unmodified=!1,this._edgeInsets.interpolate(t,a,c),this.constrainInternal(),this._calcMatrices()}resize(t,a,c=!0){this._width=t,this._height=a,c&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ai([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-f.ap,f.ap])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:c,minY:p,maxX:b,maxY:T}=f.ac.fromPoints(a).extend(t);return[new f.P(c,p),new f.P(b,p),new f.P(b,T),new f.P(c,T),new f.P(c,p)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:c}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(c),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=f.as(new Float64Array(16));f.Q(t,t,[this._width/2,-this._height/2,1]),f.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=f.as(new Float64Array(16)),f.Q(t,t,[1,-1,1]),f.O(t,t,[-1,-1,0]),f.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,c,p){const b=c!==void 0?c:this.bearing,T=p=p!==void 0?p:this.pitch,{distanceToCenter:C,clampedElevation:A}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,T),{x:z,y:N}=Jn(T,b),Z=f.ab.fromLngLat(t,a);let q,Q,ne=f.a$(1,Z.y),he=0;do{if(he+=1,he>10)break;Q=C/ne,q=new f.ab(Z.x+z*Q,Z.y+N*Q),ne=1/q.meterInMercatorCoordinateUnits()}while(Math.abs(C-Q*ne)>1e-12);return{center:q.toLngLat(),elevation:A,zoom:f.au(this.height/2/Math.tan(this.fovInRadians/2)/Q/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,c=f.at(1,this.center.lat)*this.worldSize,p=f.ab.fromLngLat(this.center,this.elevation),b=p.x/a,T=p.y/a,C=p.z/a,A=this.pitch,z=this.bearing,{x:N,y:Z,z:q}=Jn(A,z),Q=this.cameraToCenterDistance,ne=b+Q*-N,he=T+Q*-Z,pe=C+Q*q,{distanceToCenter:de,clampedElevation:me}=this._distanceToCenterFromAltElevationPitch(pe/c,t,A),Ee=de*c,_e=new f.ab((ne+N*Ee)*a,(he+Z*Ee)*a,0).toLngLat(),Ce=f.at(1,_e.lat),Ae=f.au(this.height/2/Math.tan(this.fovInRadians/2)/de/Ce/this.tileSize);this._elevation=me,this._center=_e,this.setZoom(Ae)}_distanceToCenterFromAltElevationPitch(t,a,c){const p=-Math.cos(f.aq(c)),b=t-a;let T,C=a;return p*b>=0||Math.abs(p)<.1?(T=1e4,C=t+T*p):T=-b/p,{distanceToCenter:T,clampedElevation:C}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new f.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=f.at(1,this.center.lat)*this.worldSize;return Ge(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/f.a5,1/a/f.a5]}}class bi{constructor(t,a){this.min=t,this.max=a,this.center=f.b0([],f.b1([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],c=f.b2(this.min),p=f.b2(this.max);for(let b=0;b<a.length;b++)c[b]=a[b]?this.min[b]:this.center[b],p[b]=a[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new bi(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let c=0;c<t.planes.length;c++){const p=this.intersectsPlane(t.planes[c]);if(p===0)return 0;p===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],c=t[3];for(let p=0;p<3;p++)t[p]>0?(a+=t[p]*this.min[p],c+=t[p]*this.max[p]):(c+=t[p]*this.min[p],a+=t[p]*this.max[p]);return a>=0?2:c<0?0:1}}class ho{distanceToTile2d(t,a,c,p){const b=p.distanceX([t,a]),T=p.distanceY([t,a]);return Math.hypot(b,T)}getWrap(t,a,c){return c}getTileBoundingVolume(t,a,c,p){var b,T;let C=0,A=0;if(p?.terrain){const N=new f.a2(t.z,a,t.z,t.x,t.y),Z=p.terrain.getMinMaxElevation(N);C=(b=Z.minElevation)!==null&&b!==void 0?b:Math.min(0,c),A=(T=Z.maxElevation)!==null&&T!==void 0?T:Math.max(0,c)}const z=1<<t.z;return new bi([a+t.x/z,t.y/z,C],[a+(t.x+1)/z,(t.y+1)/z,A])}allowVariableZoom(t,a){const c=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,p=f.ao(78.5-c/2,0,60);return!!a.terrain||t.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class Or{constructor(t,a,c){this.points=t,this.planes=a,this.aabb=c}static fromInvProjectionMatrix(t,a=1,c=0,p,b){const T=b?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],C=Math.pow(2,c),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((q=>(function(Q,ne,he,pe){const de=f.aI([],Q,ne),me=1/de[3]/he*pe;return f.b7(de,de,[me,me,1/de[3],me])})(q,t,a,C)));p&&(function(q,Q,ne,he){const pe=he?4:0,de=he?0:4;let me=0;const Ee=[],_e=[];for(let be=0;be<4;be++){const ze=f.b3([],q[be+de],q[be+pe]),$e=f.b8(ze);f.b0(ze,ze,1/$e),Ee.push($e),_e.push(ze)}for(let be=0;be<4;be++){const ze=f.b9(q[be+pe],_e[be],ne);me=ze!==null&&ze>=0?Math.max(me,ze):Math.max(me,Ee[be])}const Ce=(function(be,ze){const $e=f.b3([],be[ze[0]],be[ze[1]]),Ze=f.b3([],be[ze[2]],be[ze[1]]),We=[0,0,0,0];return f.b4(We,f.b5([],$e,Ze)),We[3]=-f.b6(We,be[ze[0]]),We})(q,Q),Ae=(function(be,ze){const $e=f.ba(be),Ze=f.bb([],be,1/$e),We=f.b3([],ze,f.b0([],Ze,f.b6(ze,Ze))),Qe=f.ba(We);if(Qe>0){const mt=Math.sqrt(1-Ze[3]*Ze[3]),kt=f.b0([],Ze,-Ze[3]),dt=f.b1([],kt,f.b0([],We,mt/Qe));return f.bc(ze,dt)}return null})(ne,Ce);if(Ae!==null){const be=Ae/f.b6(_e[0],Ce);me=Math.min(me,be)}for(let be=0;be<4;be++){const ze=Math.min(me,Ee[be]);q[be+de]=[q[be+pe][0]+_e[be][0]*ze,q[be+pe][1]+_e[be][1]*ze,q[be+pe][2]+_e[be][2]*ze,1]}})(A,T[0],p,b);const z=T.map((q=>{const Q=f.b3([],A[q[0]],A[q[1]]),ne=f.b3([],A[q[2]],A[q[1]]),he=f.b4([],f.b5([],Q,ne)),pe=-f.b6(he,A[q[1]]);return he.concat(pe)})),N=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],Z=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const q of A)for(let Q=0;Q<3;Q++)N[Q]=Math.min(N[Q],q[Q]),Z[Q]=Math.max(Z[Q],q[Q]);return new Or(A,z,new bi(N,Z))}}class nr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,c)=>{c=f.ao(+c,this.minZoom,this.maxZoom);const p={center:new f.V(a.lng,a.lat),zoom:c};let b=this._helper._lngRange;if(!this._helper._renderWorldCopies&&b===null){const _e=179.9999999999;b=[-_e,_e]}const T=this.tileSize*f.ar(p.zoom);let C=0,A=T,z=0,N=T,Z=0,q=0;const{x:Q,y:ne}=this.size;if(this._helper._latRange){const _e=this._helper._latRange;C=f.X(_e[1])*T,A=f.X(_e[0])*T,A-C<ne&&(Z=ne/(A-C))}b&&(z=f.W(f.Y(b[0])*T,0,T),N=f.W(f.Y(b[1])*T,0,T),N<z&&(N+=T),N-z<Q&&(q=Q/(N-z)));const{x:he,y:pe}=qt(T,a);let de,me;const Ee=Math.max(q||0,Z||0);if(Ee){const _e=new f.P(q?(N+z)/2:he,Z?(A+C)/2:pe);return p.center=pn(T,_e).wrap(),p.zoom+=f.au(Ee),p}if(this._helper._latRange){const _e=ne/2;pe-_e<C&&(me=C+_e),pe+_e>A&&(me=A-_e)}if(b){const _e=(z+N)/2;let Ce=he;this._helper._renderWorldCopies&&(Ce=f.W(he,_e-T/2,_e+T/2));const Ae=Q/2;Ce-Ae<z&&(de=z+Ae),Ce+Ae>N&&(de=N-Ae)}if(de!==void 0||me!==void 0){const _e=new f.P(de??he,me??pe);p.center=pn(T,_e).wrap()}return p},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new Zs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new ho}clone(){const t=new nr;return t.apply(this),t}apply(t,a,c){this._helper.apply(t,a,c)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new f.bd(0,t)];if(this._helper._renderWorldCopies){const c=this.screenPointToMercatorCoordinate(new f.P(0,0)),p=this.screenPointToMercatorCoordinate(new f.P(this._helper._width,0)),b=this.screenPointToMercatorCoordinate(new f.P(this._helper._width,this._helper._height)),T=this.screenPointToMercatorCoordinate(new f.P(0,this._helper._height)),C=Math.floor(Math.min(c.x,p.x,b.x,T.x)),A=Math.floor(Math.max(c.x,p.x,b.x,T.x)),z=1;for(let N=C-z;N<=A+z;N++)N!==0&&a.push(new f.bd(N,t))}return a}getCameraFrustum(){return Or.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),c=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(c)}setLocationAtPoint(t,a){const c=f.at(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(a,c),b=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,c),T=f.ab.fromLngLat(t),C=new f.ab(T.x-(p.x-b.x),T.y-(p.y-b.y));this.setCenter(C?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(f.ab.fromLngLat(t),a.getElevationForLngLat(t),this._pixelMatrix3D):this.coordinatePoint(f.ab.fromLngLat(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c!=null)return c}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const c=a||0,p=[t.x,t.y,0,1],b=[t.x,t.y,1,1];f.aI(p,p,this._pixelMatrixInverse),f.aI(b,b,this._pixelMatrixInverse);const T=p[3],C=b[3],A=p[1]/T,z=b[1]/C,N=p[2]/T,Z=b[2]/C,q=N===Z?0:(c-N)/(Z-N);return new f.ab(f.G.number(p[0]/T,b[0]/C,q)/this.worldSize,f.G.number(A,z,q)/this.worldSize,c)}coordinatePoint(t,a=0,c=this._pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,a,1];return f.aI(p,p,c),new f.P(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this._helper._height/2-Dn(this));return new Ai().extend(this.screenPointToLocation(new f.P(0,t))).extend(this.screenPointToLocation(new f.P(this._helper._width,t))).extend(this.screenPointToLocation(new f.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new f.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-Dn(this)}calculatePosMatrix(t,a=!1,c){var p;const b=(p=t.key)!==null&&p!==void 0?p:f.be(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),T=a?this._alignedPosMatrixCache:this._posMatrixCache;if(T.has(b)){const z=T.get(b);return c?z.f32:z.f64}const C=Fn(t,this.worldSize);f.S(C,a?this._alignedProjMatrix:this._viewProjMatrix,C);const A={f64:C,f32:new Float32Array(C)};return T.set(b,A),c?A.f32:A.f64}calculateFogMatrix(t){const a=t.key,c=this._fogMatrixCacheF32;if(c.has(a))return c.get(a);const p=Fn(t,this.worldSize);return f.S(p,this._fogMatrix,p),c.set(a,new Float32Array(p)),c.get(a)}calculateCenterFromCameraLngLatAlt(t,a,c,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,p)}_calculateNearFarZIfNeeded(t,a,c){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),b=t-p*this._helper._pixelPerMeter/Math.cos(a),T=p<0?b:t,C=Math.PI/2+this.pitchInRadians,A=f.aq(this.fov)*(Math.abs(Math.cos(f.aq(this.roll)))*this.height+Math.abs(Math.sin(f.aq(this.roll)))*this.width)/this.height*(.5+c.y/this.height),z=Math.sin(A)*T/Math.sin(f.ao(Math.PI-C-A,.01,Math.PI-.01)),N=Dn(this),Z=Math.atan(N/this._helper.cameraToCenterDistance),q=f.aq(.75),Q=Z>q?2*Z*(.5+c.y/(2*N)):q,ne=Math.sin(Q)*T/Math.sin(f.ao(Math.PI-C-Q,.01,Math.PI-.01)),he=Math.min(z,ne);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*he+T),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=qt(this.worldSize,this.center),c=a.x,p=a.y;this._helper._pixelPerMeter=f.at(1,this.center.lat)*this.worldSize;const b=f.aq(Math.min(this.pitch,Ut)),T=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(b));let C;this._calculateNearFarZIfNeeded(T,b,t),C=new Float64Array(16),f.bf(C,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),f.aC(this._invProjMatrix,C),C[8]=2*-t.x/this._helper._width,C[9]=2*t.y/this._helper._height,this._projectionMatrix=f.bg(C),f.Q(C,C,[1,-1,1]),f.O(C,C,[0,0,-this._helper.cameraToCenterDistance]),f.bh(C,C,-this.rollInRadians),f.bi(C,C,this.pitchInRadians),f.bh(C,C,-this.bearingInRadians),f.O(C,C,[-c,-p,0]),this._mercatorMatrix=f.Q([],C,[this.worldSize,this.worldSize,this.worldSize]),f.Q(C,C,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=f.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,C),f.O(C,C,[0,0,-this.elevation]),this._viewProjMatrix=C,this._invViewProjMatrix=f.aC([],C);const A=[0,0,-1,1];f.aI(A,A,this._invViewProjMatrix),this._cameraPosition=[A[0]/A[3],A[1]/A[3],A[2]/A[3]],this._fogMatrix=new Float64Array(16),f.bf(this._fogMatrix,this.fovInRadians,this.width/this.height,T,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,f.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),f.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),f.bh(this._fogMatrix,this._fogMatrix,-this.rollInRadians),f.bi(this._fogMatrix,this._fogMatrix,this.pitchInRadians),f.bh(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),f.O(this._fogMatrix,this._fogMatrix,[-c,-p,0]),f.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),f.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=f.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,C);const z=this._helper._width%2/2,N=this._helper._height%2/2,Z=Math.cos(this.bearingInRadians),q=Math.sin(-this.bearingInRadians),Q=c-Math.round(c)+Z*z+q*N,ne=p-Math.round(p)+Z*N+q*z,he=new Float64Array(C);if(f.O(he,he,[Q>.5?Q-1:Q,ne>.5?ne-1:ne,0]),this._alignedProjMatrix=he,C=f.aC(new Float64Array(16),this._pixelMatrix),!C)throw new Error("failed to invert matrix");this._pixelMatrixInverse=C,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new f.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return f.aI(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=f.at(1,this.center.lat)*this.worldSize;return Ge(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const c=f.ab.fromLngLat(t),p=[c.x*this.worldSize,c.y*this.worldSize,a,1];return f.aI(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(t){const{overscaledTileID:a,aligned:c,applyTerrainMatrix:p}=t,b=this._helper.getMercatorTileCoordinates(a),T=a?this.calculatePosMatrix(a,c,!0):null;let C;return C=a&&a.terrainRttPosMatrix32f&&p?a.terrainRttPosMatrix32f:T||f.bj(),{mainMatrix:C,tileMercatorCoords:b,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:C}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,c){return 1}transformLightDirection(t){return f.b2(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,c,p){const b=this.calculatePosMatrix(c);let T;p?(T=[t,a,p(t,a),1],f.aI(T,T,b)):(T=[t,a,0,1],ja(T,T,b));const C=T[3];return{point:new f.P(T[0]/C,T[1]/C),signedDistanceFromCamera:C,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const c=f.ab.fromLngLat(t,a),p=c.meterInMercatorCoordinateUnits(),b=f.bk();return f.O(b,b,[c.x,c.y,c.z]),f.bh(b,b,Math.PI),f.bi(b,b,Math.PI/2),f.Q(b,b,[-p,p,p]),b}getProjectionDataForCustomLayer(t=!0){const a=new f.a2(0,0,0,0,0),c=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),p=Fn(a,this.worldSize);f.S(p,this._viewProjMatrix,p),c.tileMercatorCoords=[0,0,1,1];const b=[f.a5,f.a5,this.worldSize/this._helper.pixelsPerMeter],T=f.bl();return f.Q(T,p,b),c.fallbackMatrix=T,c.mainMatrix=T,c}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function $r(){f.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Yl(v){if(v.useSlerp)if(v.k<1){const t=f.bm(v.startEulerAngles.roll,v.startEulerAngles.pitch,v.startEulerAngles.bearing),a=f.bm(v.endEulerAngles.roll,v.endEulerAngles.pitch,v.endEulerAngles.bearing),c=new Float64Array(4);f.bn(c,t,a,v.k);const p=f.bo(c);v.tr.setRoll(p.roll),v.tr.setPitch(p.pitch),v.tr.setBearing(p.bearing)}else v.tr.setRoll(v.endEulerAngles.roll),v.tr.setPitch(v.endEulerAngles.pitch),v.tr.setBearing(v.endEulerAngles.bearing);else v.tr.setRoll(f.G.number(v.startEulerAngles.roll,v.endEulerAngles.roll,v.k)),v.tr.setPitch(f.G.number(v.startEulerAngles.pitch,v.endEulerAngles.pitch,v.k)),v.tr.setBearing(f.G.number(v.startEulerAngles.bearing,v.endEulerAngles.bearing,v.k))}function fo(v,t,a,c,p){const b=p.padding,T=qt(p.worldSize,a.getNorthWest()),C=qt(p.worldSize,a.getNorthEast()),A=qt(p.worldSize,a.getSouthEast()),z=qt(p.worldSize,a.getSouthWest()),N=f.aq(-c),Z=T.rotate(N),q=C.rotate(N),Q=A.rotate(N),ne=z.rotate(N),he=new f.P(Math.max(Z.x,q.x,ne.x,Q.x),Math.max(Z.y,q.y,ne.y,Q.y)),pe=new f.P(Math.min(Z.x,q.x,ne.x,Q.x),Math.min(Z.y,q.y,ne.y,Q.y)),de=he.sub(pe),me=(p.width-(b.left+b.right+t.left+t.right))/de.x,Ee=(p.height-(b.top+b.bottom+t.top+t.bottom))/de.y;if(Ee<0||me<0)return void $r();const _e=Math.min(f.au(p.scale*Math.min(me,Ee)),v.maxZoom),Ce=f.P.convert(v.offset),Ae=new f.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(f.aq(c)),be=Ce.add(Ae).mult(p.scale/f.ar(_e));return{center:pn(p.worldSize,T.add(A).div(2).sub(be)),zoom:_e,bearing:c}}class ua{get useGlobeControls(){return!1}handlePanInertia(t,a){const c=t.mag(),p=Math.abs(Dn(a));return{easingOffset:t.mult(Math.min(.75*p/c,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,c){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(c,t.around)}cameraForBoxAndBearing(t,a,c,p,b){return fo(t,a,c,p,b)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(f.V.convert(a.center))}handleEaseTo(t,a){const c=t.zoom,p=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},T={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},C=a.zoom!==void 0,A=!t.isPaddingEqual(a.padding);let z=!1;const N=C?+a.zoom:t.zoom;let Z=t.centerPoint.add(a.offsetAsPoint);const q=t.screenPointToLocation(Z),{center:Q,zoom:ne}=t.applyConstrain(f.V.convert(a.center||q),N??c);ls(t,Q);const he=qt(t.worldSize,q),pe=qt(t.worldSize,Q).sub(he),de=f.ar(ne-c);return z=ne!==c,{easeFunc:me=>{if(z&&t.setZoom(f.G.number(c,ne,me)),f.bp(b,T)||Yl({startEulerAngles:b,endEulerAngles:T,tr:t,k:me,useSlerp:b.roll!=T.roll}),A&&(t.interpolatePadding(p,a.padding,me),Z=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const Ee=f.ar(t.zoom-c),_e=ne>c?Math.min(2,de):Math.max(.5,de),Ce=Math.pow(_e,1-me),Ae=pn(t.worldSize,he.add(pe.mult(me*Ce)).mult(Ee));t.setLocationAtPoint(t.renderWorldCopies?Ae.wrap():Ae,Z)}},isZooming:z,elevationCenter:Q}}handleFlyTo(t,a){const c=a.zoom!==void 0,p=t.zoom,b=t.applyConstrain(f.V.convert(a.center||a.locationAtOffset),c?+a.zoom:p),T=b.center,C=b.zoom;ls(t,T);const A=qt(t.worldSize,a.locationAtOffset),z=qt(t.worldSize,T).sub(A),N=z.mag(),Z=f.ar(C-p);let q;if(a.minZoom!==void 0){const Q=Math.min(+a.minZoom,p,C),ne=t.applyConstrain(T,Q).zoom;q=f.ar(ne-p)}return{easeFunc:(Q,ne,he,pe)=>{t.setZoom(Q===1?C:p+f.au(ne));const de=Q===1?T:pn(t.worldSize,A.add(z.mult(he)).mult(ne));t.setLocationAtPoint(t.renderWorldCopies?de.wrap():de,pe)},scaleOfZoom:Z,targetCenter:T,scaleOfMinZoom:q,pixelPathLength:N}}}class $n{constructor(t,a,c){this.blendFunction=t,this.blendColor=a,this.mask=c}}$n.Replace=[1,0],$n.disabled=new $n($n.Replace,f.bq.transparent,[!1,!1,!1,!1]),$n.unblended=new $n($n.Replace,f.bq.transparent,[!0,!0,!0,!0]),$n.alphaBlended=new $n([1,771],f.bq.transparent,[!0,!0,!0,!0]);const po=2305;class vn{constructor(t,a,c){this.enable=t,this.mode=a,this.frontFace=c}}vn.disabled=new vn(!1,1029,po),vn.backCCW=new vn(!0,1029,po),vn.frontCCW=new vn(!0,1028,po);class _n{constructor(t,a,c){this.func=t,this.mask=a,this.range=c}}_n.ReadOnly=!1,_n.ReadWrite=!0,_n.disabled=new _n(519,_n.ReadOnly,[0,1]);const Vo=7680;class Pn{constructor(t,a,c,p,b,T){this.test=t,this.ref=a,this.mask=c,this.fail=p,this.depthFail=b,this.pass=T}}Pn.disabled=new Pn({func:519,mask:0},0,0,Vo,Vo,Vo);const ml=new WeakMap;function Nr(v){var t;if(ml.has(v))return ml.get(v);{const a=(t=v.getParameter(v.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return ml.set(v,a),a}}class mo{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,c=a.gl;this._texFormat=c.RGBA,this._texType=c.UNSIGNED_BYTE;const p=new f.aX;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const b=new f.aZ;b.emplaceBack(0,1,2),this._fullscreenTriangle=new Qn(a.createVertexBuffer(p,Za.members),a.createIndexBuffer(b),f.aY.simpleSegment(0,0,p.length,b.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(c.TEXTURE1);const T=c.createTexture();c.bindTexture(c.TEXTURE_2D,T),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST),c.texImage2D(c.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(T),Nr(c)&&(this._pbo=c.createBuffer(),c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.bufferData(c.PIXEL_PACK_BUFFER,4,c.STREAM_READ),c.bindBuffer(c.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const c=this._updateCount;return this._readbackQueue?c>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():c>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const c=this._cachedRenderContext.context,p=c.gl;if(this._bindFramebuffer(),c.viewport.set([0,0,this._texWidth,this._texHeight]),c.clear({color:f.bq.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(c,p.TRIANGLES,_n.disabled,Pn.disabled,$n.unblended,vn.disabled,((b,T)=>({u_input:b,u_output_expected:T}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Nr(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const b=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:b}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Nr(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return f.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=mo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const Br=f.a5/128;function yc(v,t){const a=v.granularity!==void 0?Math.max(v.granularity,1):1,c=a+(v.generateBorders?2:0),p=a+(v.extendToNorthPole||v.generateBorders?1:0)+(v.extendToSouthPole||v.generateBorders?1:0),b=c+1,T=p+1,C=v.generateBorders?-1:0,A=v.generateBorders||v.extendToNorthPole?-1:0,z=a+(v.generateBorders?1:0),N=a+(v.generateBorders||v.extendToSouthPole?1:0),Z=b*T,q=c*p*6,Q=b*T>65536;if(Q&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ne=Q||t==="32bit",he=new Int16Array(2*Z);let pe=0;for(let Ee=A;Ee<=N;Ee++)for(let _e=C;_e<=z;_e++){let Ce=_e/a*f.a5;_e===-1&&(Ce=-Br),_e===a+1&&(Ce=f.a5+Br);let Ae=Ee/a*f.a5;Ee===-1&&(Ae=v.extendToNorthPole?f.bs:-Br),Ee===a+1&&(Ae=v.extendToSouthPole?f.bt:f.a5+Br),he[pe++]=Ce,he[pe++]=Ae}const de=ne?new Uint32Array(q):new Uint16Array(q);let me=0;for(let Ee=0;Ee<p;Ee++)for(let _e=0;_e<c;_e++){const Ce=_e+1+Ee*b,Ae=_e+(Ee+1)*b,be=_e+1+(Ee+1)*b;de[me++]=_e+Ee*b,de[me++]=Ae,de[me++]=Ce,de[me++]=Ce,de[me++]=Ae,de[me++]=be}return{vertices:he.buffer.slice(0),indices:de.buffer.slice(0),uses32bitIndices:ne}}const Hl=new f.aW({fill:new f.bu(128,2),line:new f.bu(512,0),tile:new f.bu(128,32),stencil:new f.bu(128,1),circle:3});class vc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ki.projectionGlobe}get vertexShaderPreludeCode(){return ki.projectionMercator.vertexSource}get subdivisionGranularity(){return Hl}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new mo(t));const a=f.X(this._errorQueryLatitudeDegrees),c=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(a,c),b=at();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=b);const T=Math.min(Math.max((b-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=f.bv(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,f.bw(T))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,c,p,b){const T=(b==="stencil"?Hl.stencil:Hl.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:T,generateBorders:c,extendToNorthPole:a.y===0&&p,extendToSouthPole:a.y===(1<<a.z)-1&&p})}_getMesh(t,a){const c=this._getMeshKey(a);if(c in this._tileMeshCache)return this._tileMeshCache[c];const p=(function(b,T){const C=yc(T,"16bit"),A=f.aX.deserialize({arrayBuffer:C.vertices,length:C.vertices.byteLength/2/2}),z=f.aZ.deserialize({arrayBuffer:C.indices,length:C.indices.byteLength/2/3});return new Qn(b.createVertexBuffer(A,Za.members),b.createIndexBuffer(z),f.aY.simpleSegment(0,0,A.length,z.length))})(t,a);return this._tileMeshCache[c]=p,p}recalculate(t){}hasTransition(){const t=at();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const af=new f.t({type:new f.D(f.u.projection.type)});class xc extends f.E{constructor(t){super(),this._transitionable=new f.x(af,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new f.H(0)),this._mercatorProjection=new ci,this._verticalPerspectiveProjection=new vc}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof f.bx){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,c,p,b){return this.currentProjection.getMeshFromTileID(t,a,c,p,b)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function ca(v){const t=ka(v.worldSize,v.center.lat);return 2*Math.PI*t}function As(v,t,a,c,p){const b=1/(1<<p),T=t/f.a5*b+c*b,C=f.bz((v/f.a5*b+a*b)*Math.PI*2+Math.PI,2*Math.PI),A=2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI,z=Math.cos(A),N=new Float64Array(3);return N[0]=Math.sin(C)*z,N[1]=Math.sin(A),N[2]=Math.cos(C)*z,N}function Di(v){return(function(t,a){const c=Math.cos(a),p=new Float64Array(3);return p[0]=Math.sin(t)*c,p[1]=Math.sin(a),p[2]=Math.cos(t)*c,p})(v.lng*Math.PI/180,v.lat*Math.PI/180)}function ka(v,t){return v/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Fr(v){const t=Math.asin(v[1])/Math.PI*180,a=Math.sqrt(v[0]*v[0]+v[2]*v[2]);if(a>1e-6){const c=v[0]/a,p=Math.acos(v[2]/a),b=(c>0?p:-p)/Math.PI*180;return new f.V(f.W(b,-180,180),t)}return new f.V(0,t)}function Xl(v){return Math.cos(v*Math.PI/180)}function zi(v,t){const a=Xl(v),c=Xl(t);return f.au(c/a)}function rh(v,t){const a=v.rotate(t.bearingInRadians),c=t.zoom+zi(t.center.lat,0),p=f.bv(1/Xl(t.center.lat),1/Xl(Math.min(Math.abs(t.center.lat),60)),f.by(c,7,3,0,1)),b=360/ca({worldSize:t.worldSize,center:{lat:t.center.lat}});return new f.V(t.center.lng-a.x*b*p,f.ao(t.center.lat+a.y*b,-f.ap,f.ap))}function gl(v){const t=.5*v,a=Math.sin(t),c=Math.cos(t);return Math.log(a+c)-Math.log(c-a)}function bc(v,t,a,c){const p=v.lat+a*c;if(Math.abs(a)>1){const b=(Math.sign(v.lat+a)!==Math.sign(v.lat)?-Math.abs(v.lat):Math.abs(v.lat))*Math.PI/180,T=Math.abs(v.lat+a)*Math.PI/180,C=gl(b+c*(T-b)),A=gl(b),z=gl(T);return new f.V(v.lng+t*((C-A)/(z-A)),p)}return new f.V(v.lng+t*c,p)}class wc{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,c,p){const b=`${t.z}_${t.x}_${t.y}_${p?.terrain?"t":""}`,T=this._cache.get(b);if(T)return T;const C=this._cachePrevious.get(b);if(C)return this._cache.set(b,C),C;const A=this._boundingVolumeFactory(t,a,c,p);return this._cache.set(b,A),this._hadAnyChanges=!0,A}}class Uo{constructor(t,a,c,p){this.min=c,this.max=p,this.points=t,this.planes=a}static fromAabb(t,a){const c=[];for(let p=0;p<8;p++)c.push([1&~p?t[0]:a[0],(p>>1&1)==1?a[1]:t[1],(p>>2&1)==1?a[2]:t[2]]);return new Uo(c,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,c){const p=f.bC([],c[0],c[1],c[2]),b=f.bD([],[a[0],0,0],p),T=f.bD([],[0,a[1],0],p),C=f.bD([],[0,0,a[2]],p),A=[...t],z=[...t];for(let Z=0;Z<8;Z++)for(let q=0;q<3;q++){const Q=t[q]+b[q]*(1&~Z?-1:1)+T[q]*((Z>>1&1)==1?1:-1)+C[q]*((Z>>2&1)==1?1:-1);A[q]=Math.min(A[q],Q),z[q]=Math.max(z[q],Q)}const N=[];for(let Z=0;Z<8;Z++){const q=[...t];f.b1(q,q,f.b0([],b,1&~Z?-1:1)),f.b1(q,q,f.b0([],T,(Z>>1&1)==1?1:-1)),f.b1(q,q,f.b0([],C,(Z>>2&1)==1?1:-1)),N.push(q)}return new Uo(N,[[...b,-f.b6(b,N[0])],[...T,-f.b6(T,N[0])],[...C,-f.b6(C,N[0])],[-b[0],-b[1],-b[2],-f.b6(b,N[7])],[-T[0],-T[1],-T[2],-f.b6(T,N[7])],[-C[0],-C[1],-C[2],-f.b6(C,N[7])]],A,z)}intersectsFrustum(t){let a=!0;const c=this.points.length,p=this.planes.length,b=t.planes.length,T=t.points.length;for(let C=0;C<b;C++){const A=t.planes[C];let z=0;for(let N=0;N<c;N++){const Z=this.points[N];A[0]*Z[0]+A[1]*Z[1]+A[2]*Z[2]+A[3]>=0&&z++}if(z===0)return 0;z<c&&(a=!1)}if(a)return 2;for(let C=0;C<p;C++){const A=this.planes[C];let z=0;for(let N=0;N<T;N++){const Z=t.points[N];A[0]*Z[0]+A[1]*Z[1]+A[2]*Z[2]+A[3]>=0&&z++}if(z===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let c=0;for(let p=0;p<a;p++){const b=this.points[p];t[0]*b[0]+t[1]*b[1]+t[2]*b[2]+t[3]>=0&&c++}return c===a?2:c===0?0:1}}function _a(v,t,a){const c=v-t;return c<0?-c:Math.max(0,c-a)}function jo(v,t,a,c,p){const b=v-a;let T;return T=b<0?Math.min(-b,1+b-p):b>1?Math.min(Math.max(b-p,0),1-b):0,Math.max(T,_a(t,c,p))}class ha{constructor(){this._boundingVolumeCache=new wc(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,c,p){const b=1<<c.z,T=1/b,C=c.x/b,A=c.y/b;let z=2;return z=Math.min(z,jo(t,a,C,A,T)),z=Math.min(z,jo(t,a,C+.5,-A-T,T)),z=Math.min(z,jo(t,a,C+.5,2-A-T,T)),z}getWrap(t,a,c){const p=1<<a.z,b=1/p,T=a.x/p,C=_a(t.x,T,b),A=_a(t.x,T-1,b),z=_a(t.x,T+1,b),N=Math.min(C,A,z);return N===z?1:N===A?-1:0}allowVariableZoom(t,a){return Xn(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,c,p){return this._boundingVolumeCache.getTileBoundingVolume(t,a,c,p)}_computeTileBoundingVolume(t,a,c,p){var b,T;let C=0,A=0;if(p?.terrain){const z=new f.a2(t.z,a,t.z,t.x,t.y),N=p.terrain.getMinMaxElevation(z);C=(b=N.minElevation)!==null&&b!==void 0?b:Math.min(0,c),A=(T=N.maxElevation)!==null&&T!==void 0?T:Math.max(0,c)}if(C/=f.bF,A/=f.bF,C+=1,A+=1,t.z<=0)return Uo.fromAabb([-A,-A,-A],[A,A,A]);if(t.z===1)return Uo.fromAabb([t.x===0?-A:0,t.y===0?0:-A,-A],[t.x===0?0:A,t.y===0?A:0,A]);{const z=[As(0,0,t.x,t.y,t.z),As(f.a5,0,t.x,t.y,t.z),As(f.a5,f.a5,t.x,t.y,t.z),As(0,f.a5,t.x,t.y,t.z)],N=[];for(const We of z)N.push(f.b0([],We,A));if(A!==C)for(const We of z)N.push(f.b0([],We,C));t.y===0&&N.push([0,1,0]),t.y===(1<<t.z)-1&&N.push([0,-1,0]);const Z=[1,1,1],q=[-1,-1,-1];for(const We of N)for(let Qe=0;Qe<3;Qe++)Z[Qe]=Math.min(Z[Qe],We[Qe]),q[Qe]=Math.max(q[Qe],We[Qe]);const Q=As(f.a5/2,f.a5/2,t.x,t.y,t.z),ne=f.b5([],[0,1,0],Q);f.b4(ne,ne);const he=f.b5([],Q,ne);f.b4(he,he);const pe=f.b5([],z[2],z[1]);f.b4(pe,pe);const de=f.b5([],z[0],z[3]);f.b4(de,de),N.push(f.b0([],Q,A)),t.y>=(1<<t.z)/2&&N.push(f.b0([],As(f.a5/2,0,t.x,t.y,t.z),A)),t.y<(1<<t.z)/2&&N.push(f.b0([],As(f.a5/2,f.a5,t.x,t.y,t.z),A));const me=Ys(Q,N),Ee=Ys(he,N),_e=[-Q[0],-Q[1],-Q[2],me.max],Ce=[Q[0],Q[1],Q[2],-me.min],Ae=[-he[0],-he[1],-he[2],Ee.max],be=[he[0],he[1],he[2],-Ee.min],ze=[...pe,0],$e=[...de,0],Ze=[];return t.y===0?Ze.push(f.bE($e,ze,_e),f.bE($e,ze,Ce)):Ze.push(f.bE(Ae,ze,_e),f.bE(Ae,ze,Ce),f.bE(Ae,$e,_e),f.bE(Ae,$e,Ce)),t.y===(1<<t.z)-1?Ze.push(f.bE($e,ze,_e),f.bE($e,ze,Ce)):Ze.push(f.bE(be,ze,_e),f.bE(be,ze,Ce),f.bE(be,$e,_e),f.bE(be,$e,Ce)),new Uo(Ze,[_e,Ce,Ae,be,ze,$e],Z,q)}}}function Ys(v,t){let a=1/0,c=-1/0;for(const p of t){const b=f.b6(v,p);a=Math.min(a,b),c=Math.max(c,b)}return{min:a,max:c}}class _l{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=f.bG(),this._projectionMatrix=f.bk(),this._globeViewProjMatrix32f=f.bj(),this._globeViewProjMatrixNoCorrection=f.bk(),this._globeViewProjMatrixNoCorrectionInverted=f.bk(),this._globeProjMatrixInverted=f.bk(),this._cameraPosition=f.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,c)=>{const p=f.ao(a.lat,-f.ap,f.ap),b=f.ao(+c,this.minZoom+zi(0,p),this.maxZoom);return{center:new f.V(a.lng,p),zoom:b}},this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new Zs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._coveringTilesDetailsProvider=new ha}clone(){const t=new _l;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=f.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:c}=t,p=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:c?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,c=this.cameraToCenterDistance/t,p=Math.sin(a)*c,b=Math.cos(a)*c+1,T=1/Math.sqrt(p*p+b*b)*1;let C=-p,A=b;const z=Math.sqrt(C*C+A*A);C/=z,A/=z;const N=[0,C,A];f.bH(N,N,[0,0,0],-this.bearingInRadians),f.bI(N,N,[0,0,0],-1*this.center.lat*Math.PI/180),f.bJ(N,N,[0,0,0],this.center.lng*Math.PI/180);const Z=1/f.b8(N);return f.b0(N,N,Z),[...N,-T*Z]}isLocationOccluded(t){return!this.isSurfacePointVisible(Di(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,c=this._helper._center.lat*Math.PI/180,p=Math.cos(c),b=[Math.sin(a)*p,Math.sin(c),Math.cos(a)*p],T=[b[2],0,-b[0]],C=[0,0,0];f.b5(C,T,b),f.b4(T,T),f.b4(C,C);const A=[0,0,0];return f.b4(A,[T[0]*t[0]+C[0]*t[1]+b[0]*t[2],T[1]*t[0]+C[1]*t[1]+b[1]*t[2],T[2]*t[0]+C[2]*t[1]+b[2]*t[2]]),A}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,c){const p=(function(C,A,z){const N=1/(1<<z.z);return new f.ab(C/f.a5*N+z.x*N,A/f.a5*N+z.y*N)})(t,a,c.canonical),b=(T=p.y,[f.bz(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI]);var T;return this.getCircleRadiusCorrection()/Math.cos(b[1])}projectTileCoordinates(t,a,c,p){const b=c.canonical,T=As(t,a,b.x,b.y,b.z),C=1+(p?p(t,a):0)/f.bF,A=[T[0]*C,T[1]*C,T[2]*C,1];f.aI(A,A,this._globeViewProjMatrixNoCorrection);const z=this._cachedClippingPlane,N=z[0]*T[0]+z[1]*T[1]+z[2]*T[2]+z[3]<0;return{point:new f.P(A[0]/A[3],A[1]/A[3]),signedDistanceFromCamera:A[3],isOccluded:N}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=ka(this.worldSize,this.center.lat),a=f.bl(),c=f.bl();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),f.bf(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;a[8]=2*-p.x/this._helper._width,a[9]=2*p.y/this._helper._height,this._projectionMatrix=f.bg(a),this._globeProjMatrixInverted=f.bl(),f.aC(this._globeProjMatrixInverted,a),f.O(a,a,[0,0,-this.cameraToCenterDistance]),f.bh(a,a,this.rollInRadians),f.bi(a,a,-this.pitchInRadians),f.bh(a,a,this.bearingInRadians),f.O(a,a,[0,0,-t]);const b=f.bA();b[0]=t,b[1]=t,b[2]=t,f.bi(c,a,this.center.lat*Math.PI/180),f.bK(c,c,-this.center.lng*Math.PI/180),f.Q(c,c,b),this._globeViewProjMatrixNoCorrection=c,f.bi(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),f.bK(a,a,-this.center.lng*Math.PI/180),f.Q(a,a,b),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=f.bl(),f.aC(this._globeViewProjMatrixNoCorrectionInverted,c);const T=f.bA();this._cameraPosition=f.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,f.bH(this._cameraPosition,this._cameraPosition,T,-this.rollInRadians),f.bI(this._cameraPosition,this._cameraPosition,T,this.pitchInRadians),f.bH(this._cameraPosition,this._cameraPosition,T,-this.bearingInRadians),f.b1(this._cameraPosition,this._cameraPosition,[0,0,1]),f.bI(this._cameraPosition,this._cameraPosition,T,-this.center.lat*Math.PI/180),f.bJ(this._cameraPosition,this._cameraPosition,T,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const C=f.bg(this._globeViewProjMatrixNoCorrectionInverted);f.Q(C,C,[1,1,-1]),this._cachedFrustum=Or.fromInvProjectionMatrix(C,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){f.w("calculateFogMatrix is not supported on globe projection.");const a=f.bl();return f.as(a),a}getVisibleUnwrappedCoordinates(t){return[new f.bd(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&f.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const c=Di(t);f.b0(c,c,1+a/f.bF);const p=f.bG();return f.aI(p,[c[0],c[1],c[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,c=[new f.P(0,0),new f.P(t,0),new f.P(this.width,0),new f.P(this.width,a),new f.P(this.width,this.height),new f.P(t,this.height),new f.P(0,this.height),new f.P(0,a)],p=[];for(const Z of c)p.push(this.unprojectScreenPoint(Z));let b=0,T=0,C=0,A=0;const z=this.center;for(const Z of p){const q=f.bL(z.lng,Z.lng),Q=f.bL(z.lat,Z.lat);q<T&&(T=q),q>b&&(b=q),Q<A&&(A=Q),Q>C&&(C=Q)}const N=[z.lng+T,z.lat+A,z.lng+b,z.lat+C];return this.isSurfacePointOnScreen([0,1,0])&&(N[3]=90,N[0]=-180,N[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(N[1]=-90,N[0]=-180,N[2]=180),new Ai(N)}calculateCenterFromCameraLngLatAlt(t,a,c,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,p)}setLocationAtPoint(t,a){const c=Di(this.unprojectScreenPoint(a)),p=Di(t),b=f.bA();f.bM(b);const T=f.bA();f.bJ(T,c,b,-this.center.lng*Math.PI/180),f.bI(T,T,b,this.center.lat*Math.PI/180);const C=p[0]*p[0]+p[2]*p[2],A=T[0]*T[0];if(C<A)return;const z=Math.sqrt(C-A),N=-z,Z=f.bN(p[0],p[2],T[0],z),q=f.bN(p[0],p[2],T[0],N),Q=f.bA();f.bJ(Q,p,b,-Z);const ne=f.bN(Q[1],Q[2],T[1],T[2]),he=f.bA();f.bJ(he,p,b,-q);const pe=f.bN(he[1],he[2],T[1],T[2]),de=.5*Math.PI,me=ne>=-de&&ne<=de,Ee=pe>=-de&&pe<=de;let _e,Ce;if(me&&Ee){const $e=this.center.lng*Math.PI/180,Ze=this.center.lat*Math.PI/180;f.bO(Z,$e)+f.bO(ne,Ze)<f.bO(q,$e)+f.bO(pe,Ze)?(_e=Z,Ce=ne):(_e=q,Ce=pe)}else if(me)_e=Z,Ce=ne;else{if(!Ee)return;_e=q,Ce=pe}const Ae=_e/Math.PI*180,be=Ce/Math.PI*180,ze=this.center.lat;this.setCenter(new f.V(Ae,f.ao(be,-90,90))),this.setZoom(this.zoom+zi(ze,this.center.lat))}locationToScreenPoint(t,a){const c=Di(t);if(a){const p=a.getElevationForLngLatZoom(t,this._helper._tileZoom);f.b0(c,c,1+p/f.bF)}return this._projectSurfacePointToScreen(c)}_projectSurfacePointToScreen(t){const a=f.bG();return f.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new f.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const c=a.pointCoordinate(t);if(c)return c}return f.ab.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var c;return(c=this.screenPointToMercatorCoordinate(t,a))===null||c===void 0?void 0:c.toLngLat()}isPointOnMapSurface(t,a){const c=this._cameraPosition,p=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(c,p)}getRayDirectionFromPixel(t){const a=f.bG();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,f.aI(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const c=f.bA();c[0]=a[0]-this._cameraPosition[0],c[1]=a[1]-this._cameraPosition[1],c[2]=a[2]-this._cameraPosition[2];const p=f.bA();return f.b4(p,c),p}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=f.bG();return f.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const c=f.b6(t,a),p=f.bA(),b=f.bA();f.b0(b,a,c),f.b3(p,t,b);const T=1-f.b6(p,p);if(T<0)return null;const C=f.b6(t,t)-1,A=-c+(c<0?1:-1)*Math.sqrt(T),z=C/A,N=A;return{tMin:Math.min(z,N),tMax:Math.max(z,N)}}unprojectScreenPoint(t){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(t),p=this.rayPlanetIntersection(a,c);if(p){const N=f.bA();f.b1(N,a,[c[0]*p.tMin,c[1]*p.tMin,c[2]*p.tMin]);const Z=f.bA();return f.b4(Z,N),Fr(Z)}const b=this._cachedClippingPlane,T=b[0]*c[0]+b[1]*c[1]+b[2]*c[2],C=-f.bc(b,a)/T,A=f.bA();if(C>0)f.b1(A,a,[c[0]*C,c[1]*C,c[2]*C]);else{const N=f.bA();f.b1(N,a,[2*c[0],2*c[1],2*c[2]]);const Z=f.bc(this._cachedClippingPlane,N);f.b3(A,N,[this._cachedClippingPlane[0]*Z,this._cachedClippingPlane[1]*Z,this._cachedClippingPlane[2]*Z])}const z=(function(N){const Z=f.bA();return Z[0]=N[0]*-N[3],Z[1]=N[1]*-N[3],Z[2]=N[2]*-N[3],{center:Z,radius:Math.sqrt(1-N[3]*N[3])}})(b);return Fr((function(N,Z,q){const Q=f.bA();f.b3(Q,q,N);const ne=f.bA();return f.bB(ne,N,Q,Z/f.ba(Q)),ne})(z.center,z.radius,A))}getMatrixForModel(t,a){const c=f.V.convert(t),p=1/f.bF,b=f.bk();return f.bK(b,b,c.lng/180*Math.PI),f.bi(b,b,-c.lat/180*Math.PI),f.O(b,b,[0,0,1+a/f.bF]),f.bi(b,b,.5*Math.PI),f.Q(b,b,[p,p,p]),b}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new f.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class Go{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,c){return this._helper.interpolatePadding(t,a,c)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,c=!0){this._helper.resize(t,a,c)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,c)=>this.currentTransform.defaultConstrain(a,c),this.applyConstrain=(a,c)=>this._helper.applyConstrain(a,c),this._helper=new Zs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,c)=>this.defaultConstrain(a,c)},t),this._globeness=1,this._mercatorTransform=new nr,this._verticalPerspectiveTransform=new _l}clone(){const t=new Go;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),c=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?c.mainMatrix:a.mainMatrix,clippingPlane:c.clippingPlane,tileMercatorCoords:c.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return f.bv(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return f.bv(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,c){const p=this._mercatorTransform.getPitchedTextCorrection(t,a,c),b=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,c);return f.bv(p,b,this._globeness)}projectTileCoordinates(t,a,c,p){return this.currentTransform.projectTileCoordinates(t,a,c,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,c,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,c,p)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const c=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return c.fallbackMatrix=a.mainMatrix,c}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Bi{get useGlobeControls(){return!0}handlePanInertia(t,a){const c=rh(t,a);return Math.abs(c.lng-a.center.lng)>180&&(c.lng=a.center.lng+179.5*Math.sign(c.lng-a.center.lng)),{easingCenter:c,easingOffset:new f.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const c=t.around,p=a.screenPointToLocation(c);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const b=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const T=a.zoom-b;if(T===0)return;const C=f.bL(a.center.lng,p.lng),A=C/(Math.abs(C/180)+1),z=f.bL(a.center.lat,p.lat),N=a.getRayDirectionFromPixel(c),Z=a.cameraPosition,q=-1*f.b6(Z,N),Q=f.bA();f.b1(Q,Z,[N[0]*q,N[1]*q,N[2]*q]);const ne=f.b8(Q)-1,he=Math.exp(.5*-Math.max(ne-.3,0)),pe=ka(a.worldSize,a.center.lat)/Math.min(a.width,a.height),de=f.by(pe,.9,.5,1,.25),me=(1-f.ar(-T))*Math.min(he,de),Ee=a.center.lat,_e=a.zoom,Ce=new f.V(a.center.lng+A*me,f.ao(a.center.lat+z*me,-f.ap,f.ap));a.setLocationAtPoint(p,c);const Ae=a.center,be=f.by(Math.abs(C),45,85,0,1),ze=f.by(pe,.75,.35,0,1),$e=Math.pow(Math.max(be,ze),.25),Ze=f.bL(Ae.lng,Ce.lng),We=f.bL(Ae.lat,Ce.lat);a.setCenter(new f.V(Ae.lng+Ze*$e,Ae.lat+We*$e).wrap()),a.setZoom(_e+zi(Ee,a.center.lat))}handleMapControlsPan(t,a,c){if(!t.panDelta)return;const p=a.center.lat,b=a.zoom;a.setCenter(rh(t.panDelta,a).wrap()),a.setZoom(b+zi(p,a.center.lat))}cameraForBoxAndBearing(t,a,c,p,b){const T=fo(t,a,c,p,b),C=a.left/b.width*2-1,A=(b.width-a.right)/b.width*2-1,z=a.top/b.height*-2+1,N=(b.height-a.bottom)/b.height*-2+1,Z=f.bL(c.getWest(),c.getEast())<0,q=Z?c.getEast():c.getWest(),Q=Z?c.getWest():c.getEast(),ne=Math.max(c.getNorth(),c.getSouth()),he=Math.min(c.getNorth(),c.getSouth()),pe=q+.5*f.bL(q,Q),de=ne+.5*f.bL(ne,he),me=b.clone();me.setCenter(T.center),me.setBearing(T.bearing),me.setPitch(0),me.setRoll(0),me.setZoom(T.zoom);const Ee=me.modelViewProjectionMatrix,_e=[Di(c.getNorthWest()),Di(c.getNorthEast()),Di(c.getSouthWest()),Di(c.getSouthEast()),Di(new f.V(Q,de)),Di(new f.V(q,de)),Di(new f.V(pe,ne)),Di(new f.V(pe,he))],Ce=Di(T.center);let Ae=Number.POSITIVE_INFINITY;for(const be of _e)C<0&&(Ae=Bi.getLesserNonNegativeNonNull(Ae,Bi.solveVectorScale(be,Ce,Ee,"x",C))),A>0&&(Ae=Bi.getLesserNonNegativeNonNull(Ae,Bi.solveVectorScale(be,Ce,Ee,"x",A))),z>0&&(Ae=Bi.getLesserNonNegativeNonNull(Ae,Bi.solveVectorScale(be,Ce,Ee,"y",z))),N<0&&(Ae=Bi.getLesserNonNegativeNonNull(Ae,Bi.solveVectorScale(be,Ce,Ee,"y",N)));if(Number.isFinite(Ae)&&Ae!==0)return T.zoom=me.zoom+f.au(Ae),T;$r()}handleJumpToCenterZoom(t,a){const c=t.center.lat,p=t.applyConstrain(a.center?f.V.convert(a.center):t.center,t.zoom).center;t.setCenter(p.wrap());const b=a.zoom!==void 0?+a.zoom:t.zoom+zi(c,p.lat);t.zoom!==b&&t.setZoom(b)}handleEaseTo(t,a){const c=t.zoom,p=t.center,b=t.padding,T={roll:t.roll,pitch:t.pitch,bearing:t.bearing},C={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},A=a.zoom!==void 0,z=!t.isPaddingEqual(a.padding);let N=!1;const Z=a.center?f.V.convert(a.center):p,q=t.applyConstrain(Z,c).center;ls(t,q);const Q=t.clone();Q.setCenter(q),Q.setZoom(A?+a.zoom:c+zi(p.lat,Z.lat)),Q.setBearing(a.bearing);const ne=new f.P(f.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),f.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));Q.setLocationAtPoint(q,ne);const he=(a.offset&&a.offsetAsPoint.mag())>0?Q.center:q,pe=A?+a.zoom:c+zi(p.lat,he.lat),de=c+zi(p.lat,0),me=pe+zi(he.lat,0),Ee=f.bL(p.lng,he.lng),_e=f.bL(p.lat,he.lat),Ce=f.ar(me-de);return N=pe!==c,{easeFunc:Ae=>{if(f.bp(T,C)||Yl({startEulerAngles:T,endEulerAngles:C,tr:t,k:Ae,useSlerp:T.roll!=C.roll}),z&&t.interpolatePadding(b,a.padding,Ae),a.around)f.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const be=me>de?Math.min(2,Ce):Math.max(.5,Ce),ze=Math.pow(be,1-Ae),$e=bc(p,Ee,_e,Ae*ze);t.setCenter($e.wrap())}if(N){const be=f.G.number(de,me,Ae)+zi(0,t.center.lat);t.setZoom(be)}},isZooming:N,elevationCenter:he}}handleFlyTo(t,a){const c=a.zoom!==void 0,p=t.center,b=t.zoom,T=t.padding,C=!t.isPaddingEqual(a.padding),A=t.applyConstrain(f.V.convert(a.center||a.locationAtOffset),b).center,z=c?+a.zoom:t.zoom+zi(t.center.lat,A.lat),N=t.clone();N.setCenter(A),N.setZoom(z),N.setBearing(a.bearing);const Z=new f.P(f.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),f.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));N.setLocationAtPoint(A,Z);const q=N.center;ls(t,q);const Q=(function(_e,Ce,Ae){const be=Di(Ce),ze=Di(Ae),$e=f.b6(be,ze),Ze=Math.acos($e),We=ca(_e);return Ze/(2*Math.PI)*We})(t,p,q),ne=b+zi(p.lat,0),he=z+zi(q.lat,0),pe=f.ar(he-ne);let de;if(typeof a.minZoom=="number"){const _e=+a.minZoom+zi(q.lat,0),Ce=Math.min(_e,ne,he)+zi(0,q.lat),Ae=t.applyConstrain(q,Ce).zoom+zi(q.lat,0);de=f.ar(Ae-ne)}const me=f.bL(p.lng,q.lng),Ee=f.bL(p.lat,q.lat);return{easeFunc:(_e,Ce,Ae,be)=>{const ze=bc(p,me,Ee,Ae);C&&t.interpolatePadding(T,a.padding,_e);const $e=_e===1?q:ze;t.setCenter($e.wrap());const Ze=ne+f.au(Ce);t.setZoom(_e===1?z:Ze+zi(0,$e.lat))},scaleOfZoom:pe,targetCenter:q,scaleOfMinZoom:de,pixelPathLength:Q}}static solveVectorScale(t,a,c,p,b){const T=p==="x"?[c[0],c[4],c[8],c[12]]:[c[1],c[5],c[9],c[13]],C=[c[3],c[7],c[11],c[15]],A=t[0]*T[0]+t[1]*T[1]+t[2]*T[2],z=t[0]*C[0]+t[1]*C[1]+t[2]*C[2],N=a[0]*T[0]+a[1]*T[1]+a[2]*T[2],Z=a[0]*C[0]+a[1]*C[1]+a[2]*C[2];return N+b*z===A+b*Z||C[3]*(A-N)+T[3]*(Z-z)+A*Z==N*z?null:(N+T[3]-b*Z-b*C[3])/(N-A-b*Z+b*z)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class qo{constructor(t){this._globe=t,this._mercatorCameraHelper=new ua,this._verticalPerspectiveCameraHelper=new Bi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,c){this.currentHelper.handleMapControlsPan(t,a,c)}cameraForBoxAndBearing(t,a,c,p,b){return this.currentHelper.cameraForBoxAndBearing(t,a,c,p,b)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const go=(v,t)=>f.B(v,t&&t.filter((a=>a.identifier!=="source.canvas"))),yl=f.bP();class _o extends f.E{constructor(t,a={}){var c,p;super(),this._rtlPluginLoaded=()=>{for(const T in this.tileManagers){const C=this.tileManagers[T].getSource().type;C!=="vector"&&C!=="geojson"||this.tileManagers[T].reload()}},this.map=t,this.dispatcher=new Ln(yi(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((T,C)=>this.getGlyphs(T,C))),this.dispatcher.registerMessageHandler("GI",((T,C)=>this.getImages(T,C))),this.dispatcher.registerMessageHandler("GDA",((T,C)=>this.getDashes(T,C))),this.imageManager=new sn,this.imageManager.setEventedParent(this);const b=((c=t._container)===null||c===void 0?void 0:c.lang)||typeof document<"u"&&((p=document.documentElement)===null||p===void 0?void 0:p.lang)||void 0;this.glyphManager=new Tt(t._requestManager,a.localIdeographFontFamily,b),this.lineAtlas=new zt(256,512),this.crossTileSymbolIndex=new Yi,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",f.bQ()),Ve().on(ve,this._rtlPluginLoaded),this.on("data",(T=>{if(T.dataType!=="source"||T.sourceDataType!=="metadata")return;const C=this.tileManagers[T.sourceId];if(!C)return;const A=C.getSource();if(A&&A.vectorLayerIds)for(const z in this._layers){const N=this._layers[z];N.source===A.id&&this._validateLayer(N)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new f.bR,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var c,p,b;this._checkLoaded();const T=a===null?(b=(p=(c=this.stylesheet.state)===null||c===void 0?void 0:c[t])===null||p===void 0?void 0:p.default)!==null&&b!==void 0?b:null:a;if(f.bS(T,this._globalState[t]))return this;this._globalState[t]=T,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const c in t)!f.bS(this._globalState[c],t[c].default)&&(a.push(c),this._globalState[c]=t[c].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,c={};for(const p of t){c[p]=this._globalState[p];for(const b in this._layers){const T=this._layers[b],C=T.getLayoutAffectingGlobalStateRefs(),A=T.getPaintAffectingGlobalStateRefs();if(C.has(p)&&a.add(T.source),A.has(p))for(const{name:z,value:N}of A.get(p))this._updatePaintProperty(T,z,N)}}this.dispatcher.broadcast("UGS",c);for(const p in this.tileManagers)a.has(p)&&(this._reloadSource(p),this._changed=!0)}loadURL(t,a={},c){this.fire(new f.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const p=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;f.j(p,this._loadStyleRequest).then((T=>{this._loadStyleRequest=null,this._load(T.data,a,c)})).catch((T=>{this._loadStyleRequest=null,T&&!b.signal.aborted&&this.fire(new f.k(T))}))}loadJSON(t,a={},c){this.fire(new f.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Oe.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,c)})).catch((()=>{}))}loadEmpty(){this.fire(new f.l("dataloading",{dataType:"style"})),this._load(yl,{validate:!1})}_load(t,a,c){var p,b;let T=a.transformStyle?a.transformStyle(c,t):t;if(!a.validate||!go(this,f.C(T))){T=Object.assign({},T),this._loaded=!0,this.stylesheet=T;for(const C in T.sources)this.addSource(C,T.sources[C],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new Pt(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new lt(this.stylesheet.sky),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new f.l("data",{dataType:"style"})),this.fire(new f.l("style.load"))}}_createLayers(){var t,a,c;const p=f.bT(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",p),this._order=p.map((b=>b.id)),this._layers={},this._serializedLayers=null;for(const b of p){const T=f.bU(b,this._globalState);if(T.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=T,f.bV(T)&&this.tileManagers[T.source]){const C=(c=(a=b.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&c!==void 0?c:T.paint.get("raster-fade-duration");this.tileManagers[T.source].setRasterFadeDuration(C)}}}_loadSprite(t,a=!1,c=void 0){this.imageManager.setLoaded(!1);const p=new AbortController;let b;this._spriteRequest=p,(function(T,C,A,z){return f._(this,void 0,void 0,(function*(){const N=Ft(T),Z=A>1?"@2x":"",q={},Q={};for(const{id:ne,url:he}of N){const pe=C.transformRequest(xn(he,Z,".json"),"SpriteJSON");q[ne]=f.j(pe,z);const de=C.transformRequest(xn(he,Z,".png"),"SpriteImage");Q[ne]=_t.getImage(de,z)}return yield Promise.all([...Object.values(q),...Object.values(Q)]),(function(ne,he){return f._(this,void 0,void 0,(function*(){const pe={};for(const de in ne){pe[de]={};const me=Oe.getImageCanvasContext((yield he[de]).data),Ee=(yield ne[de]).data;for(const _e in Ee){const{width:Ce,height:Ae,x:be,y:ze,sdf:$e,pixelRatio:Ze,stretchX:We,stretchY:Qe,content:mt,textFitWidth:kt,textFitHeight:dt}=Ee[_e];pe[de][_e]={data:null,pixelRatio:Ze,sdf:$e,stretchX:We,stretchY:Qe,content:mt,textFitWidth:kt,textFitHeight:dt,spriteData:{width:Ce,height:Ae,x:be,y:ze,context:me}}}}return pe}))})(q,Q)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((T=>{if(this._spriteRequest=null,T)for(const C in T){this._spritesImagesIds[C]=[];const A=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter((z=>!(z in T))):[];for(const z of A)this.imageManager.removeImage(z),this._changedImages[z]=!0;for(const z in T[C]){const N=C==="default"?z:`${C}:${z}`;this._spritesImagesIds[C].push(N),N in this.imageManager.images?this.imageManager.updateImage(N,T[C][z],!1):this.imageManager.addImage(N,T[C][z]),a&&(this._changedImages[N]=!0)}}})).catch((T=>{this._spriteRequest=null,b=T,p.signal.aborted||this.fire(new f.k(b))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"})),c&&c(b)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const c=t.sourceLayer;if(!c)return;const p=a.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(c)===-1)&&this.fire(new f.k(new Error(`Source layer "${c}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const c=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?f.bW(c):c);const p=[];for(const b of t)if(c[b]){const T=a?f.bW(c[b]):c[b];p.push(T)}return p}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const c of a){const p=this._layers[c];p.type!=="custom"&&(t[c]=p.serialize())}return t}hasTransitions(){var t,a,c;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((c=this.projection)===null||c===void 0)&&c.hasTransition())return!0;for(const p in this.tileManagers)if(this.tileManagers[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const p=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(p.length||b.length)&&this._updateWorkerLayers(p,b);for(const T in this._updatedSources){const C=this._updatedSources[T];if(C==="reload")this._reloadSource(T);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const c={};for(const p in this.tileManagers){const b=this.tileManagers[p];c[p]=b.used,b.used=!1}for(const p of this._order){const b=this._layers[p];b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)&&b.source&&(this.tileManagers[b.source].used=!0)}for(const p in c){const b=this.tileManagers[p];!!c[p]!=!!b.used&&b.fire(new f.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new f.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var c;this._checkLoaded();const p=this.serialize();if(t=a.transformStyle?a.transformStyle(p,t):t,((c=a.validate)===null||c===void 0||c)&&go(this,f.C(t)))return!1;(t=f.bW(t)).layers=f.bT(t.layers);const b=f.bX(p,t),T=this._getOperationsToPerform(b);if(T.unimplemented.length>0)throw new Error(`Unimplemented: ${T.unimplemented.join(", ")}.`);if(T.operations.length===0)return!1;for(const C of T.operations)C();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],c=[];for(const p of t)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,p.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,p.args)));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,p.args)));break;case"setTransition":a.push((()=>{}));break;default:c.push(p.command)}return{operations:a,unimplemented:c}}addImage(t,a){if(this.getImage(t))return this.fire(new f.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new f.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,c={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(f.C.source,`sources.${t}`,a,null,c))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const p=this.tileManagers[t]=new li(t,a,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:t}))),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new f.k(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new f.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.tileManagers[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,c={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new f.k(new Error(`Layer "${p}" already exists on this map.`)));let b;if(t.type==="custom"){if(go(this,f.bY(t)))return;b=f.bU(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(p,t.source),t=f.bW(t),t=f.e(t,{source:p})),this._validate(f.C.layer,`layers.${p}`,t,{arrayIndex:-1},c))return;b=f.bU(t,this._globalState),this._validateLayer(b),b.setEventedParent(this,{layer:{id:p}})}const T=a?this._order.indexOf(a):this._order.length;if(a&&T===-1)this.fire(new f.k(new Error(`Cannot add layer "${p}" before non-existing layer "${a}".`)));else{if(this._order.splice(T,0,p),this._layerOrderChanged=!0,this._layers[p]=b,this._removedLayers[p]&&b.source&&b.type!=="custom"){const C=this._removedLayers[p];delete this._removedLayers[p],C.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.tileManagers[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new f.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const c=this._order.indexOf(t);this._order.splice(c,1);const p=a?this._order.indexOf(a):this._order.length;a&&p===-1?this.fire(new f.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new f.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,c){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===a&&p.maxzoom===c||(a!=null&&(p.minzoom=a),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new f.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,c={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!f.bS(p.filter,a))return a==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(f.C.filter,`layers.${p.id}.filter`,a,null,c)||(p.setFilter(f.bW(a)),this._updateLayer(p)))}else this.fire(new f.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return f.bW(this.getLayer(t).filter)}setLayoutProperty(t,a,c,p={}){this._checkLoaded();const b=this.getLayer(t);b?f.bS(b.getLayoutProperty(a),c)||(b.setLayoutProperty(a,c,p),this._updateLayer(b)):this.fire(new f.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const c=this.getLayer(t);if(c)return c.getLayoutProperty(a);this.fire(new f.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,c,p={}){this._checkLoaded();const b=this.getLayer(t);b?f.bS(b.getPaintProperty(a),c)||this._updatePaintProperty(b,a,c,p):this.fire(new f.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,c,p={}){t.setPaintProperty(a,c,p)&&this._updateLayer(t),f.bV(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(c),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const c=t.source,p=t.sourceLayer,b=this.tileManagers[c];if(b===void 0)return void this.fire(new f.k(new Error(`The source '${c}' does not exist in the map's style.`)));const T=b.getSource().type;T==="geojson"&&p?this.fire(new f.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||p?(t.id===void 0&&this.fire(new f.k(new Error("The feature id parameter must be provided."))),b.setFeatureState(p,t.id,a)):this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const c=t.source,p=this.tileManagers[c];if(p===void 0)return void this.fire(new f.k(new Error(`The source '${c}' does not exist in the map's style.`)));const b=p.getSource().type,T=b==="vector"?t.sourceLayer:void 0;b!=="vector"||T?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new f.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(T,t.id,a):this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,c=t.sourceLayer,p=this.tileManagers[a];if(p!==void 0)return p.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new f.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(c,t.id)):void this.fire(new f.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new f.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return f.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=f.bZ(this.tileManagers,(b=>b.serialize())),a=this._serializeByIds(this._order,!0),c=this.map.getTerrain()||void 0,p=this.stylesheet;return f.b_({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:t,layers:a,terrain:c},(b=>b!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=T=>this._layers[T].type==="fill-extrusion",c={},p=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(a(C)){c[C]=T;for(const A of t){const z=A[C];if(z)for(const N of z)p.push(N)}}}p.sort(((T,C)=>C.intersectionZ-T.intersectionZ));const b=[];for(let T=this._order.length-1;T>=0;T--){const C=this._order[T];if(a(C))for(let A=p.length-1;A>=0;A--){const z=p[A].feature;if(c[z.layer.id]<T)break;b.push(z),p.pop()}else for(const A of t){const z=A[C];if(z)for(const N of z)b.push(N.feature)}}return b}queryRenderedFeatures(t,a,c){a&&a.filter&&this._validate(f.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const p={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new f.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const z of a.layers){const N=this._layers[z];if(!N)return this.fire(new f.k(new Error(`The layer '${z}' does not exist in the map's style and cannot be queried for features.`))),[];p[N.source]=!0}}const b=[];a.availableImages=this._availableImages;const T=this._serializedAllLayers(),C=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,A=Object.assign(Object.assign({},a),{layers:C,globalState:this._globalState});for(const z in this.tileManagers)a.layers&&!p[z]||b.push(oa(this.tileManagers[z],this._layers,T,t,A,c,this.map.terrain?(N,Z,q)=>this.map.terrain.getElevation(N,Z,q):void 0));return this.placement&&b.push((function(z,N,Z,q,Q,ne,he){const pe={},de=ne.queryRenderedSymbols(q),me=[];for(const Ee of Object.keys(de).map(Number))me.push(he[Ee]);me.sort(vi);for(const Ee of me){const _e=Ee.featureIndex.lookupSymbolFeatures(de[Ee.bucketInstanceId],N,Ee.bucketIndex,Ee.sourceLayerIndex,{filterSpec:Q.filter,globalState:Q.globalState},Q.layers,Q.availableImages,z);for(const Ce in _e){const Ae=pe[Ce]=pe[Ce]||[],be=_e[Ce];be.sort(((ze,$e)=>{const Ze=Ee.featureSortOrder;if(Ze){const We=Ze.indexOf(ze.featureIndex);return Ze.indexOf($e.featureIndex)-We}return $e.featureIndex-ze.featureIndex}));for(const ze of be)Ae.push(ze)}}return(function(Ee,_e,Ce){for(const Ae in Ee)for(const be of Ee[Ae])er(be,Ce[_e[Ae].source]);return Ee})(pe,z,Z)})(this._layers,T,this.tileManagers,t,A,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,a){a?.filter&&this._validate(f.C.filter,"querySourceFeatures.filter",a.filter,null,a);const c=this.tileManagers[t];return c?(function(p,b){const T=p.getRenderableIds().map((z=>p.getTileByID(z))),C=[],A={};for(let z=0;z<T.length;z++){const N=T[z],Z=N.tileID.canonical.key;A[Z]||(A[Z]=!0,N.querySourceFeatures(C,b))}return C})(c,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const c=this.light.getLight();let p=!1;for(const T in t)if(!f.bS(t[T],c[T])){p=!0;break}if(!p)return;const b={now:at(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(b)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const c=this.getSky();let p=!1;if(!t&&!c)return;if(t&&!c)p=!0;else if(!t&&c)p=!0;else for(const T in t)if(!f.bS(t[T],c[T])){p=!0;break}if(!p)return;const b={now:at(),transition:f.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(b)}_setProjectionInternal(t){const a=(function(c,p){const b={constrainOverride:p};if(Array.isArray(c)){const T=new xc({type:c});return{projection:T,transform:new Go(b),cameraHelper:new qo(T)}}switch(c){case"mercator":return{projection:new ci,transform:new nr(b),cameraHelper:new ua};case"globe":{const T=new xc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:T,transform:new Go(b),cameraHelper:new qo(T)}}case"vertical-perspective":return{projection:new vc,transform:new _l(b),cameraHelper:new Bi};default:return f.w(`Unknown projection name: ${c}. Falling back to mercator projection.`),{projection:new ci,transform:new nr(b),cameraHelper:new ua}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const c in this.tileManagers)this.tileManagers[c].reload()}_validate(t,a,c,p,b={}){return(!b||b.validate!==!1)&&go(this,t.call(f.C,f.e({key:a,style:this.serialize(),value:c,styleSpec:f.u},p)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ve().off(ve,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const c=this.tileManagers[a];c.setEventedParent(null),c.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,c,p,b=!1){let T=!1,C=!1;const A={};for(const z of this._order){const N=this._layers[z];if(N.type!=="symbol")continue;if(!A[N.source]){const q=this.tileManagers[N.source];A[N.source]=q.getRenderableIds(!0).map((Q=>q.getTileByID(Q))).sort(((Q,ne)=>ne.tileID.overscaledZ-Q.tileID.overscaledZ||(Q.tileID.isLessThan(ne.tileID)?-1:1)))}const Z=this.crossTileSymbolIndex.addLayer(N,A[N.source],t.center.lng);T=T||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(at(),t.zoom))&&(this.pauseablePlacement=new qa(t,this.map.terrain,this._order,b,a,c,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(at()),C=!0),T&&this.pauseablePlacement.placement.setStale()),C||T)for(const z of this._order){const N=this._layers[z];N.type==="symbol"&&this.placement.updateLayerOpacities(N,A[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(at())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return f._(this,void 0,void 0,(function*(){const c=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const p=this.tileManagers[a.source];return p&&p.setDependencies(a.tileID.key,a.type,a.icons),c}))}getGlyphs(t,a){return f._(this,void 0,void 0,(function*(){const c=yield this.glyphManager.getGlyphs(a.stacks),p=this.tileManagers[a.source];return p&&p.setDependencies(a.tileID.key,a.type,[""]),c}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(f.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return f._(this,void 0,void 0,(function*(){const c={};for(const[p,b]of Object.entries(a.dashes))c[p]=this.lineAtlas.getDash(b.dasharray,b.round);return c}))}addSprite(t,a,c={},p){this._checkLoaded();const b=[{id:t,url:a}],T=[...Ft(this.stylesheet.sprite),...b];this._validate(f.C.sprite,"sprite",T,null,c)||(this.stylesheet.sprite=T,this._loadSprite(b,!0,p))}removeSprite(t){this._checkLoaded();const a=Ft(this.stylesheet.sprite);if(a.find((c=>c.id===t))){if(this._spritesImagesIds[t])for(const c of this._spritesImagesIds[t])this.imageManager.removeImage(c),this._changedImages[c]=!0;a.splice(a.findIndex((c=>c.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new f.l("data",{dataType:"style"}))}else this.fire(new f.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return Ft(this.stylesheet.sprite)}setSprite(t,a={},c){this._checkLoaded(),t&&this._validate(f.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,c):(this._unloadSprite(),c&&c(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var ah=f.aV([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class $l{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,c,p,b,T,C,A,z){this.context=t;let N=this.boundPaintVertexBuffers.length!==p.length;for(let Z=0;!N&&Z<p.length;Z++)this.boundPaintVertexBuffers[Z]!==p[Z]&&(N=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==c||N||this.boundIndexBuffer!==b||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==z?this.freshBind(a,c,p,b,T,C,A,z):(t.bindVertexArray.set(this.vao),C&&C.bind(),b&&b.dynamicDraw&&b.bind(),A&&A.bind(),z&&z.bind())}freshBind(t,a,c,p,b,T,C,A){const z=t.numAttributes,N=this.context,Z=N.gl;this.vao&&this.destroy(),this.vao=N.createVertexArray(),N.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=A,a.enableAttributes(Z,t);for(const q of c)q.enableAttributes(Z,t);T&&T.enableAttributes(Z,t),C&&C.enableAttributes(Z,t),A&&A.enableAttributes(Z,t),a.bind(),a.setVertexAttribPointers(Z,t,b);for(const q of c)q.bind(),q.setVertexAttribPointers(Z,t,b);T&&(T.bind(),T.setVertexAttribPointers(Z,t,b)),p&&p.bind(),C&&(C.bind(),C.setVertexAttribPointers(Z,t,b)),A&&(A.bind(),A.setVertexAttribPointers(Z,t,b)),N.currentNumAttributes=z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const sh=(v,t,a,c,p)=>({u_texture:0,u_ele_delta:v,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):f.bq.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:a?a.calculateFogBlendOpacity(c):0,u_horizon_color:a?a.properties.get("horizon-color"):f.bq.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),us={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Lu(v){const t=[];for(let a=0;a<v.length;a++){if(v[a]===null)continue;const c=v[a].split(" ");t.push(c.pop())}return t}class oh{constructor(t,a,c,p,b,T,C,A,z=[]){const N=t.gl;this.program=N.createProgram();const Z=Lu(a.staticAttributes),q=c?c.getBinderAttributes():[],Q=Z.concat(q),ne=ki.prelude.staticUniforms?Lu(ki.prelude.staticUniforms):[],he=C.staticUniforms?Lu(C.staticUniforms):[],pe=a.staticUniforms?Lu(a.staticUniforms):[],de=c?c.getBinderUniforms():[],me=ne.concat(he).concat(pe).concat(de),Ee=[];for(const Ze of me)Ee.indexOf(Ze)<0&&Ee.push(Ze);const _e=c?c.defines():[];Nr(N)&&_e.unshift("#version 300 es"),b&&_e.push("#define OVERDRAW_INSPECTOR;"),T&&_e.push("#define TERRAIN3D;"),A&&_e.push(A),z&&_e.push(...z);let Ce=_e.concat(ki.prelude.fragmentSource,C.fragmentSource,a.fragmentSource).join(`
`),Ae=_e.concat(ki.prelude.vertexSource,C.vertexSource,a.vertexSource).join(`
`);Nr(N)||(Ce=(function(Ze){return Ze.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Ce),Ae=(function(Ze){return Ze.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Ae));const be=N.createShader(N.FRAGMENT_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);if(N.shaderSource(be,Ce),N.compileShader(be),!N.getShaderParameter(be,N.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${N.getShaderInfoLog(be)}`);N.attachShader(this.program,be);const ze=N.createShader(N.VERTEX_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);if(N.shaderSource(ze,Ae),N.compileShader(ze),!N.getShaderParameter(ze,N.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${N.getShaderInfoLog(ze)}`);N.attachShader(this.program,ze),this.attributes={};const $e={};this.numAttributes=Q.length;for(let Ze=0;Ze<this.numAttributes;Ze++)Q[Ze]&&(N.bindAttribLocation(this.program,Ze,Q[Ze]),this.attributes[Q[Ze]]=Ze);if(N.linkProgram(this.program),!N.getProgramParameter(this.program,N.LINK_STATUS))throw new Error(`Program failed to link: ${N.getProgramInfoLog(this.program)}`);N.deleteShader(ze),N.deleteShader(be);for(let Ze=0;Ze<Ee.length;Ze++){const We=Ee[Ze];if(We&&!$e[We]){const Qe=N.getUniformLocation(this.program,We);Qe&&($e[We]=Qe)}}this.fixedUniforms=p(t,$e),this.terrainUniforms=((Ze,We)=>({u_depth:new f.b$(Ze,We.u_depth),u_terrain:new f.b$(Ze,We.u_terrain),u_terrain_dim:new f.br(Ze,We.u_terrain_dim),u_terrain_matrix:new f.c1(Ze,We.u_terrain_matrix),u_terrain_unpack:new f.c2(Ze,We.u_terrain_unpack),u_terrain_exaggeration:new f.br(Ze,We.u_terrain_exaggeration)}))(t,$e),this.projectionUniforms=((Ze,We)=>({u_projection_matrix:new f.c1(Ze,We.u_projection_matrix),u_projection_tile_mercator_coords:new f.c2(Ze,We.u_projection_tile_mercator_coords),u_projection_clipping_plane:new f.c2(Ze,We.u_projection_clipping_plane),u_projection_transition:new f.br(Ze,We.u_projection_transition),u_projection_fallback_matrix:new f.c1(Ze,We.u_projection_fallback_matrix)}))(t,$e),this.binderUniforms=c?c.getUniforms(t,$e):[]}draw(t,a,c,p,b,T,C,A,z,N,Z,q,Q,ne,he,pe,de,me,Ee){const _e=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(p),t.setColorMode(b),t.setCullFace(T),A){t.activeTexture.set(_e.TEXTURE2),_e.bindTexture(_e.TEXTURE_2D,A.depthTexture),t.activeTexture.set(_e.TEXTURE3),_e.bindTexture(_e.TEXTURE_2D,A.texture);for(const Ae in this.terrainUniforms)this.terrainUniforms[Ae].set(A[Ae])}if(z)for(const Ae in z)this.projectionUniforms[us[Ae]].set(z[Ae]);if(C)for(const Ae in this.fixedUniforms)this.fixedUniforms[Ae].set(C[Ae]);pe&&pe.setUniforms(t,this.binderUniforms,ne,{zoom:he});let Ce=0;switch(a){case _e.LINES:Ce=2;break;case _e.TRIANGLES:Ce=3;break;case _e.LINE_STRIP:Ce=1}for(const Ae of Q.get()){const be=Ae.vaos||(Ae.vaos={});(be[N]||(be[N]=new $l)).bind(t,this,Z,pe?pe.getPaintVertexBuffers():[],q,Ae.vertexOffset,de,me,Ee),_e.drawElements(a,Ae.primitiveLength*Ce,_e.UNSIGNED_SHORT,Ae.primitiveOffset*Ce*2)}}}function Tc(v,t,a){const c=1/f.aO(a,1,t.transform.tileZoom),p=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,t.transform.tileZoom)/p,T=b*(a.tileID.canonical.x+a.tileID.wrap*p),C=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[c,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[T>>16,C>>16],u_pixel_coord_lower:[65535&T,65535&C]}}const zu=(v,t,a,c)=>{const p=v.style.light,b=p.properties.get("position"),T=[b.x,b.y,b.z],C=f.c5();p.properties.get("anchor")==="viewport"&&f.c6(C,v.transform.bearingInRadians),f.c7(T,T,C);const A=v.transform.transformLightDirection(T),z=p.properties.get("color");return{u_lightpos:T,u_lightpos_globe:A,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[z.r,z.g,z.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:c}},Wl=(v,t,a,c,p,b,T)=>f.e(zu(v,t,a,c),Tc(b,v,T),{u_height_factor:-Math.pow(2,p.overscaledZ)/T.tileSize/8}),Zo=(v,t,a,c)=>f.e(Tc(t,v,a),{u_fill_translate:c}),vl=(v,t)=>({u_world:v,u_fill_translate:t}),lh=(v,t,a,c,p)=>f.e(Zo(v,t,a,p),{u_world:c}),Ql=(v,t,a,c,p)=>{const b=v.transform;let T,C,A=0;if(a.paint.get("circle-pitch-alignment")==="map"){const z=f.aO(t,1,b.zoom);T=!0,C=[z,z],A=z/(f.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*p}else T=!1,C=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+T,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:C,u_globe_extrude_scale:A,u_translate:c}},yo=v=>({u_pixel_extrude_scale:[1/v.width,1/v.height]}),Sc=v=>({u_viewport_size:[v.width,v.height]}),Kl=(v,t=1)=>({u_color:v,u_overlay:0,u_overlay_scale:t}),Hs=(v,t,a,c)=>{const p=f.aO(v,1,t)/(f.a5*Math.pow(2,v.tileID.overscaledZ))*2*Math.PI*c;return{u_extrude_scale:f.aO(v,1,t),u_intensity:a,u_globe_extrude_scale:p}},Ou=(v,t,a,c)=>{const p=f.N();f.c8(p,0,v.width,v.height,0,0,1);const b=v.context.gl;return{u_matrix:p,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:a,u_color_ramp:c,u_opacity:t.paint.get("heatmap-opacity")}},xl=(v,t,a)=>{const c=a.paint.get("hillshade-accent-color");let p;switch(a.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const b=a.getIlluminationProperties();for(let T=0;T<b.directionRadians.length;T++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(b.directionRadians[T]+=v.transform.bearingInRadians);return{u_image:0,u_latrange:ch(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:b.altitudeRadians,u_azimuths:b.directionRadians,u_accent:c,u_method:p,u_highlights:b.highlightColor,u_shadows:b.shadowColor}},uh=(v,t)=>{const a=t.stride,c=f.N();return f.c8(c,0,f.a5,-f.a5,0,0,1),f.O(c,c,[0,-f.a5,0]),{u_matrix:c,u_image:1,u_dimension:[a,a],u_zoom:v.overscaledZ,u_unpack:t.getUnpackVector()}};function ch(v,t){const a=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new f.ab(0,c/a).toLngLat().lat,new f.ab(0,(c+1)/a).toLngLat().lat]}const Nu=(v,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:v.paint.get("color-relief-opacity")}),Jl=(v,t,a,c)=>{const p=v.transform;return{u_translation:eu(v,t,a),u_ratio:c/f.aO(t,1,p.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Ec=(v,t,a,c,p)=>f.e(Jl(v,t,a,c),{u_image:0,u_image_height:p}),Bu=(v,t,a,c,p)=>{const b=v.transform,T=Vr(t,b);return{u_translation:eu(v,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:c/f.aO(t,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[T,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},ya=(v,t,a,c,p)=>{const b=Vr(t,v.transform);return f.e(Jl(v,t,a,c),{u_tileratio:b,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image:0,u_mix:p.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})},vo=(v,t,a,c,p,b)=>{const T=Vr(t,v.transform);return f.e(Jl(v,t,a,c),{u_image:0,u_image_height:b,u_tileratio:T,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image_dash:1,u_mix:p.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})};function Vr(v,t){return 1/f.aO(v,1,t.tileZoom)}function eu(v,t,a){return f.aP(v.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const tu=(v,t,a,c,p)=>{return{u_tl_parent:v,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(T=c.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=c.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:fa(c.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var b,T};function fa(v){v*=Math.PI/180;const t=Math.sin(v),a=Math.cos(v);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const va=(v,t,a,c,p,b,T,C,A,z,N,Z,q)=>{const Q=T.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_pitch:Q.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:Q.width/Q.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_label_plane_matrix:C,u_coord_matrix:A,u_is_text:+N,u_pitch_with_map:+c,u_is_along_line:p,u_is_variable_anchor:b,u_texsize:Z,u_texture:0,u_translation:z,u_pitched_scale:q}},_=(v,t,a,c,p,b,T,C,A,z,N,Z,q,Q)=>{const ne=T.transform;return f.e(va(v,t,a,c,p,b,T,C,A,z,N,Z,Q),{u_gamma_scale:c?Math.cos(ne.pitch*Math.PI/180)*ne.cameraToCenterDistance:1,u_device_pixel_ratio:T.pixelRatio,u_is_halo:1})},o=(v,t,a,c,p,b,T,C,A,z,N,Z,q)=>f.e(_(v,t,a,c,p,b,T,C,A,z,!0,N,0,q),{u_texsize_icon:Z,u_texture_icon:1}),u=(v,t)=>({u_opacity:v,u_color:t}),g=(v,t,a,c,p)=>f.e((function(b,T,C,A){const z=C.imageManager.getPattern(b.from.toString()),N=C.imageManager.getPattern(b.to.toString()),{width:Z,height:q}=C.imageManager.getPixelSize(),Q=Math.pow(2,A.tileID.overscaledZ),ne=A.tileSize*Math.pow(2,C.transform.tileZoom)/Q,he=ne*(A.tileID.canonical.x+A.tileID.wrap*Q),pe=ne*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:z.tl,u_pattern_br_a:z.br,u_pattern_tl_b:N.tl,u_pattern_br_b:N.br,u_texsize:[Z,q],u_mix:T.t,u_pattern_size_a:z.displaySize,u_pattern_size_b:N.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/f.aO(A,1,C.transform.tileZoom),u_pixel_coord_upper:[he>>16,pe>>16],u_pixel_coord_lower:[65535&he,65535&pe]}})(a,p,t,c),{u_opacity:v}),E=(v,t)=>{},P={fillExtrusion:(v,t)=>({u_lightpos:new f.c3(v,t.u_lightpos),u_lightpos_globe:new f.c3(v,t.u_lightpos_globe),u_lightintensity:new f.br(v,t.u_lightintensity),u_lightcolor:new f.c3(v,t.u_lightcolor),u_vertical_gradient:new f.br(v,t.u_vertical_gradient),u_opacity:new f.br(v,t.u_opacity),u_fill_translate:new f.c4(v,t.u_fill_translate)}),fillExtrusionPattern:(v,t)=>({u_lightpos:new f.c3(v,t.u_lightpos),u_lightpos_globe:new f.c3(v,t.u_lightpos_globe),u_lightintensity:new f.br(v,t.u_lightintensity),u_lightcolor:new f.c3(v,t.u_lightcolor),u_vertical_gradient:new f.br(v,t.u_vertical_gradient),u_height_factor:new f.br(v,t.u_height_factor),u_opacity:new f.br(v,t.u_opacity),u_fill_translate:new f.c4(v,t.u_fill_translate),u_image:new f.b$(v,t.u_image),u_texsize:new f.c4(v,t.u_texsize),u_pixel_coord_upper:new f.c4(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c4(v,t.u_pixel_coord_lower),u_scale:new f.c3(v,t.u_scale),u_fade:new f.br(v,t.u_fade)}),fill:(v,t)=>({u_fill_translate:new f.c4(v,t.u_fill_translate)}),fillPattern:(v,t)=>({u_image:new f.b$(v,t.u_image),u_texsize:new f.c4(v,t.u_texsize),u_pixel_coord_upper:new f.c4(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c4(v,t.u_pixel_coord_lower),u_scale:new f.c3(v,t.u_scale),u_fade:new f.br(v,t.u_fade),u_fill_translate:new f.c4(v,t.u_fill_translate)}),fillOutline:(v,t)=>({u_world:new f.c4(v,t.u_world),u_fill_translate:new f.c4(v,t.u_fill_translate)}),fillOutlinePattern:(v,t)=>({u_world:new f.c4(v,t.u_world),u_image:new f.b$(v,t.u_image),u_texsize:new f.c4(v,t.u_texsize),u_pixel_coord_upper:new f.c4(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c4(v,t.u_pixel_coord_lower),u_scale:new f.c3(v,t.u_scale),u_fade:new f.br(v,t.u_fade),u_fill_translate:new f.c4(v,t.u_fill_translate)}),circle:(v,t)=>({u_camera_to_center_distance:new f.br(v,t.u_camera_to_center_distance),u_scale_with_map:new f.b$(v,t.u_scale_with_map),u_pitch_with_map:new f.b$(v,t.u_pitch_with_map),u_extrude_scale:new f.c4(v,t.u_extrude_scale),u_device_pixel_ratio:new f.br(v,t.u_device_pixel_ratio),u_globe_extrude_scale:new f.br(v,t.u_globe_extrude_scale),u_translate:new f.c4(v,t.u_translate)}),collisionBox:(v,t)=>({u_pixel_extrude_scale:new f.c4(v,t.u_pixel_extrude_scale)}),collisionCircle:(v,t)=>({u_viewport_size:new f.c4(v,t.u_viewport_size)}),debug:(v,t)=>({u_color:new f.c0(v,t.u_color),u_overlay:new f.b$(v,t.u_overlay),u_overlay_scale:new f.br(v,t.u_overlay_scale)}),depth:E,clippingMask:E,heatmap:(v,t)=>({u_extrude_scale:new f.br(v,t.u_extrude_scale),u_intensity:new f.br(v,t.u_intensity),u_globe_extrude_scale:new f.br(v,t.u_globe_extrude_scale)}),heatmapTexture:(v,t)=>({u_matrix:new f.c1(v,t.u_matrix),u_world:new f.c4(v,t.u_world),u_image:new f.b$(v,t.u_image),u_color_ramp:new f.b$(v,t.u_color_ramp),u_opacity:new f.br(v,t.u_opacity)}),hillshade:(v,t)=>({u_image:new f.b$(v,t.u_image),u_latrange:new f.c4(v,t.u_latrange),u_exaggeration:new f.br(v,t.u_exaggeration),u_altitudes:new f.ca(v,t.u_altitudes),u_azimuths:new f.ca(v,t.u_azimuths),u_accent:new f.c0(v,t.u_accent),u_method:new f.b$(v,t.u_method),u_shadows:new f.c9(v,t.u_shadows),u_highlights:new f.c9(v,t.u_highlights)}),hillshadePrepare:(v,t)=>({u_matrix:new f.c1(v,t.u_matrix),u_image:new f.b$(v,t.u_image),u_dimension:new f.c4(v,t.u_dimension),u_zoom:new f.br(v,t.u_zoom),u_unpack:new f.c2(v,t.u_unpack)}),colorRelief:(v,t)=>({u_image:new f.b$(v,t.u_image),u_unpack:new f.c2(v,t.u_unpack),u_dimension:new f.c4(v,t.u_dimension),u_elevation_stops:new f.b$(v,t.u_elevation_stops),u_color_stops:new f.b$(v,t.u_color_stops),u_color_ramp_size:new f.b$(v,t.u_color_ramp_size),u_opacity:new f.br(v,t.u_opacity)}),line:(v,t)=>({u_translation:new f.c4(v,t.u_translation),u_ratio:new f.br(v,t.u_ratio),u_device_pixel_ratio:new f.br(v,t.u_device_pixel_ratio),u_units_to_pixels:new f.c4(v,t.u_units_to_pixels)}),lineGradient:(v,t)=>({u_translation:new f.c4(v,t.u_translation),u_ratio:new f.br(v,t.u_ratio),u_device_pixel_ratio:new f.br(v,t.u_device_pixel_ratio),u_units_to_pixels:new f.c4(v,t.u_units_to_pixels),u_image:new f.b$(v,t.u_image),u_image_height:new f.br(v,t.u_image_height)}),linePattern:(v,t)=>({u_translation:new f.c4(v,t.u_translation),u_texsize:new f.c4(v,t.u_texsize),u_ratio:new f.br(v,t.u_ratio),u_device_pixel_ratio:new f.br(v,t.u_device_pixel_ratio),u_image:new f.b$(v,t.u_image),u_units_to_pixels:new f.c4(v,t.u_units_to_pixels),u_scale:new f.c3(v,t.u_scale),u_fade:new f.br(v,t.u_fade)}),lineSDF:(v,t)=>({u_translation:new f.c4(v,t.u_translation),u_ratio:new f.br(v,t.u_ratio),u_device_pixel_ratio:new f.br(v,t.u_device_pixel_ratio),u_units_to_pixels:new f.c4(v,t.u_units_to_pixels),u_image:new f.b$(v,t.u_image),u_mix:new f.br(v,t.u_mix),u_tileratio:new f.br(v,t.u_tileratio),u_crossfade_from:new f.br(v,t.u_crossfade_from),u_crossfade_to:new f.br(v,t.u_crossfade_to),u_lineatlas_width:new f.br(v,t.u_lineatlas_width),u_lineatlas_height:new f.br(v,t.u_lineatlas_height)}),lineGradientSDF:(v,t)=>({u_translation:new f.c4(v,t.u_translation),u_ratio:new f.br(v,t.u_ratio),u_device_pixel_ratio:new f.br(v,t.u_device_pixel_ratio),u_units_to_pixels:new f.c4(v,t.u_units_to_pixels),u_image:new f.b$(v,t.u_image),u_image_height:new f.br(v,t.u_image_height),u_tileratio:new f.br(v,t.u_tileratio),u_crossfade_from:new f.br(v,t.u_crossfade_from),u_crossfade_to:new f.br(v,t.u_crossfade_to),u_image_dash:new f.b$(v,t.u_image_dash),u_mix:new f.br(v,t.u_mix),u_lineatlas_width:new f.br(v,t.u_lineatlas_width),u_lineatlas_height:new f.br(v,t.u_lineatlas_height)}),raster:(v,t)=>({u_tl_parent:new f.c4(v,t.u_tl_parent),u_scale_parent:new f.br(v,t.u_scale_parent),u_buffer_scale:new f.br(v,t.u_buffer_scale),u_fade_t:new f.br(v,t.u_fade_t),u_opacity:new f.br(v,t.u_opacity),u_image0:new f.b$(v,t.u_image0),u_image1:new f.b$(v,t.u_image1),u_brightness_low:new f.br(v,t.u_brightness_low),u_brightness_high:new f.br(v,t.u_brightness_high),u_saturation_factor:new f.br(v,t.u_saturation_factor),u_contrast_factor:new f.br(v,t.u_contrast_factor),u_spin_weights:new f.c3(v,t.u_spin_weights),u_coords_top:new f.c2(v,t.u_coords_top),u_coords_bottom:new f.c2(v,t.u_coords_bottom)}),symbolIcon:(v,t)=>({u_is_size_zoom_constant:new f.b$(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.b$(v,t.u_is_size_feature_constant),u_size_t:new f.br(v,t.u_size_t),u_size:new f.br(v,t.u_size),u_camera_to_center_distance:new f.br(v,t.u_camera_to_center_distance),u_pitch:new f.br(v,t.u_pitch),u_rotate_symbol:new f.b$(v,t.u_rotate_symbol),u_aspect_ratio:new f.br(v,t.u_aspect_ratio),u_fade_change:new f.br(v,t.u_fade_change),u_label_plane_matrix:new f.c1(v,t.u_label_plane_matrix),u_coord_matrix:new f.c1(v,t.u_coord_matrix),u_is_text:new f.b$(v,t.u_is_text),u_pitch_with_map:new f.b$(v,t.u_pitch_with_map),u_is_along_line:new f.b$(v,t.u_is_along_line),u_is_variable_anchor:new f.b$(v,t.u_is_variable_anchor),u_texsize:new f.c4(v,t.u_texsize),u_texture:new f.b$(v,t.u_texture),u_translation:new f.c4(v,t.u_translation),u_pitched_scale:new f.br(v,t.u_pitched_scale)}),symbolSDF:(v,t)=>({u_is_size_zoom_constant:new f.b$(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.b$(v,t.u_is_size_feature_constant),u_size_t:new f.br(v,t.u_size_t),u_size:new f.br(v,t.u_size),u_camera_to_center_distance:new f.br(v,t.u_camera_to_center_distance),u_pitch:new f.br(v,t.u_pitch),u_rotate_symbol:new f.b$(v,t.u_rotate_symbol),u_aspect_ratio:new f.br(v,t.u_aspect_ratio),u_fade_change:new f.br(v,t.u_fade_change),u_label_plane_matrix:new f.c1(v,t.u_label_plane_matrix),u_coord_matrix:new f.c1(v,t.u_coord_matrix),u_is_text:new f.b$(v,t.u_is_text),u_pitch_with_map:new f.b$(v,t.u_pitch_with_map),u_is_along_line:new f.b$(v,t.u_is_along_line),u_is_variable_anchor:new f.b$(v,t.u_is_variable_anchor),u_texsize:new f.c4(v,t.u_texsize),u_texture:new f.b$(v,t.u_texture),u_gamma_scale:new f.br(v,t.u_gamma_scale),u_device_pixel_ratio:new f.br(v,t.u_device_pixel_ratio),u_is_halo:new f.b$(v,t.u_is_halo),u_translation:new f.c4(v,t.u_translation),u_pitched_scale:new f.br(v,t.u_pitched_scale)}),symbolTextAndIcon:(v,t)=>({u_is_size_zoom_constant:new f.b$(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new f.b$(v,t.u_is_size_feature_constant),u_size_t:new f.br(v,t.u_size_t),u_size:new f.br(v,t.u_size),u_camera_to_center_distance:new f.br(v,t.u_camera_to_center_distance),u_pitch:new f.br(v,t.u_pitch),u_rotate_symbol:new f.b$(v,t.u_rotate_symbol),u_aspect_ratio:new f.br(v,t.u_aspect_ratio),u_fade_change:new f.br(v,t.u_fade_change),u_label_plane_matrix:new f.c1(v,t.u_label_plane_matrix),u_coord_matrix:new f.c1(v,t.u_coord_matrix),u_is_text:new f.b$(v,t.u_is_text),u_pitch_with_map:new f.b$(v,t.u_pitch_with_map),u_is_along_line:new f.b$(v,t.u_is_along_line),u_is_variable_anchor:new f.b$(v,t.u_is_variable_anchor),u_texsize:new f.c4(v,t.u_texsize),u_texsize_icon:new f.c4(v,t.u_texsize_icon),u_texture:new f.b$(v,t.u_texture),u_texture_icon:new f.b$(v,t.u_texture_icon),u_gamma_scale:new f.br(v,t.u_gamma_scale),u_device_pixel_ratio:new f.br(v,t.u_device_pixel_ratio),u_is_halo:new f.b$(v,t.u_is_halo),u_translation:new f.c4(v,t.u_translation),u_pitched_scale:new f.br(v,t.u_pitched_scale)}),background:(v,t)=>({u_opacity:new f.br(v,t.u_opacity),u_color:new f.c0(v,t.u_color)}),backgroundPattern:(v,t)=>({u_opacity:new f.br(v,t.u_opacity),u_image:new f.b$(v,t.u_image),u_pattern_tl_a:new f.c4(v,t.u_pattern_tl_a),u_pattern_br_a:new f.c4(v,t.u_pattern_br_a),u_pattern_tl_b:new f.c4(v,t.u_pattern_tl_b),u_pattern_br_b:new f.c4(v,t.u_pattern_br_b),u_texsize:new f.c4(v,t.u_texsize),u_mix:new f.br(v,t.u_mix),u_pattern_size_a:new f.c4(v,t.u_pattern_size_a),u_pattern_size_b:new f.c4(v,t.u_pattern_size_b),u_scale_a:new f.br(v,t.u_scale_a),u_scale_b:new f.br(v,t.u_scale_b),u_pixel_coord_upper:new f.c4(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new f.c4(v,t.u_pixel_coord_lower),u_tile_units_to_pixels:new f.br(v,t.u_tile_units_to_pixels)}),terrain:(v,t)=>({u_texture:new f.b$(v,t.u_texture),u_ele_delta:new f.br(v,t.u_ele_delta),u_fog_matrix:new f.c1(v,t.u_fog_matrix),u_fog_color:new f.c0(v,t.u_fog_color),u_fog_ground_blend:new f.br(v,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new f.br(v,t.u_fog_ground_blend_opacity),u_horizon_color:new f.c0(v,t.u_horizon_color),u_horizon_fog_blend:new f.br(v,t.u_horizon_fog_blend),u_is_globe_mode:new f.br(v,t.u_is_globe_mode)}),terrainDepth:(v,t)=>({u_ele_delta:new f.br(v,t.u_ele_delta)}),terrainCoords:(v,t)=>({u_texture:new f.b$(v,t.u_texture),u_terrain_coords_id:new f.br(v,t.u_terrain_coords_id),u_ele_delta:new f.br(v,t.u_ele_delta)}),projectionErrorMeasurement:(v,t)=>({u_input:new f.br(v,t.u_input),u_output_expected:new f.br(v,t.u_output_expected)}),atmosphere:(v,t)=>({u_sun_pos:new f.c3(v,t.u_sun_pos),u_atmosphere_blend:new f.br(v,t.u_atmosphere_blend),u_globe_position:new f.c3(v,t.u_globe_position),u_globe_radius:new f.br(v,t.u_globe_radius),u_inv_proj_matrix:new f.c1(v,t.u_inv_proj_matrix)}),sky:(v,t)=>({u_sky_color:new f.c0(v,t.u_sky_color),u_horizon_color:new f.c0(v,t.u_horizon_color),u_horizon:new f.c4(v,t.u_horizon),u_horizon_normal:new f.c4(v,t.u_horizon_normal),u_sky_horizon_blend:new f.br(v,t.u_sky_horizon_blend),u_sky_blend:new f.br(v,t.u_sky_blend)})};class V{constructor(t,a,c){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const $={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class re{constructor(t,a,c,p){this.length=a.length,this.attributes=c,this.itemSize=a.bytesPerElement,this.dynamicDraw=p,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let c=0;c<this.attributes.length;c++){const p=a.attributes[this.attributes[c].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,a,c){for(let p=0;p<this.attributes.length;p++){const b=this.attributes[p],T=a.attributes[b.name];T!==void 0&&t.vertexAttribPointer(T,b.components,t[$[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class fe{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Be extends fe{getDefault(){return f.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Xe extends fe{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class bt extends fe{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Zt extends fe{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Qt extends fe{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class un extends fe{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class zn extends fe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Cn extends fe{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class oi extends fe{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class ur extends fe{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class hi extends fe{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Wr extends fe{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class _r extends fe{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class ks extends fe{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class xo extends fe{getDefault(){return f.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class bo extends fe{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class bl extends fe{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Xs extends fe{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Da extends fe{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class nu extends fe{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class wo extends fe{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class kn extends fe{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hh extends fe{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class cs extends fe{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fh extends fe{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class hs extends fe{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class sd extends fe{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class dh extends fe{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const c=this.gl;Nr(c)?c.bindVertexArray(t):(a=c.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class wl extends fe{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class sf extends fe{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ph extends fe{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Tl extends fe{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class Mc extends Tl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Pa extends Tl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Sl extends Tl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const El="Framebuffer is not complete";class iu{constructor(t,a,c,p,b){this.context=t,this.width=a,this.height=c;const T=t.gl,C=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new Mc(t,C),p)this.depthAttachment=b?new Sl(t,C):new Pa(t,C);else if(b)throw new Error("Stencil cannot be set without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error(El)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class Ml{constructor(t){var a,c;if(this.gl=t,this.clearColor=new Be(this),this.clearDepth=new Xe(this),this.clearStencil=new bt(this),this.colorMask=new Zt(this),this.depthMask=new Qt(this),this.stencilMask=new un(this),this.stencilFunc=new zn(this),this.stencilOp=new Cn(this),this.stencilTest=new oi(this),this.depthRange=new ur(this),this.depthTest=new hi(this),this.depthFunc=new Wr(this),this.blend=new _r(this),this.blendFunc=new ks(this),this.blendColor=new xo(this),this.blendEquation=new bo(this),this.cullFace=new bl(this),this.cullFaceSide=new Xs(this),this.frontFace=new Da(this),this.program=new nu(this),this.activeTexture=new wo(this),this.viewport=new kn(this),this.bindFramebuffer=new hh(this),this.bindRenderbuffer=new cs(this),this.bindTexture=new fh(this),this.bindVertexBuffer=new hs(this),this.bindElementBuffer=new sd(this),this.bindVertexArray=new dh(this),this.pixelStoreUnpack=new wl(this),this.pixelStoreUnpackPremultiplyAlpha=new sf(this),this.pixelStoreUnpackFlipY=new ph(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Nr(t)){this.HALF_FLOAT=t.HALF_FLOAT;const p=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:p?.RGBA16F_EXT,this.RGB16F=(c=t.RGB16F)!==null&&c!==void 0?c:p?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const p=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new V(this,t,a)}createVertexBuffer(t,a,c){return new re(this,t,a,c)}createRenderbuffer(t,a,c){const p=this.gl,b=p.createRenderbuffer();return this.bindRenderbuffer.set(b),p.renderbufferStorage(p.RENDERBUFFER,t,a,c),this.bindRenderbuffer.set(null),b}createFramebuffer(t,a,c,p){return new iu(this,t,a,c,p)}clear({color:t,depth:a,stencil:c}){const p=this.gl;let b=0;t&&(b|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(b|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),c!==void 0&&(b|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),p.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){f.bS(t.blendFunction,$n.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Nr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Nr(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let Qr;function Kr(v,t,a,c,p){const b=v.context,T=v.transform,C=b.gl,A=v.useProgram("collisionBox"),z=[];let N=0,Z=0;for(let de=0;de<c.length;de++){const me=c[de],Ee=t.getTile(me).getBucket(a);if(!Ee)continue;const _e=p?Ee.textCollisionBox:Ee.iconCollisionBox,Ce=Ee.collisionCircleArray;Ce.length>0&&(z.push({circleArray:Ce,circleOffset:Z,coord:me}),N+=Ce.length/4,Z=N),_e&&A.draw(b,C.LINES,_n.disabled,Pn.disabled,v.colorModeForRenderPass(),vn.disabled,yo(v.transform),v.style.map.terrain&&v.style.map.terrain.getTerrainData(me),T.getProjectionData({overscaledTileID:me,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,null,v.transform.zoom,null,null,_e.collisionVertexBuffer)}if(!p||!z.length)return;const q=v.useProgram("collisionCircle"),Q=new f.cb;Q.resize(4*N),Q._trim();let ne=0;for(const de of z)for(let me=0;me<de.circleArray.length/4;me++){const Ee=4*me,_e=de.circleArray[Ee+0],Ce=de.circleArray[Ee+1],Ae=de.circleArray[Ee+2],be=de.circleArray[Ee+3];Q.emplace(ne++,_e,Ce,Ae,be,0),Q.emplace(ne++,_e,Ce,Ae,be,1),Q.emplace(ne++,_e,Ce,Ae,be,2),Q.emplace(ne++,_e,Ce,Ae,be,3)}(!Qr||Qr.length<2*N)&&(Qr=(function(de){const me=2*de,Ee=new f.cd;Ee.resize(me),Ee._trim();for(let _e=0;_e<me;_e++){const Ce=6*_e;Ee.uint16[Ce+0]=4*_e+0,Ee.uint16[Ce+1]=4*_e+1,Ee.uint16[Ce+2]=4*_e+2,Ee.uint16[Ce+3]=4*_e+2,Ee.uint16[Ce+4]=4*_e+3,Ee.uint16[Ce+5]=4*_e+0}return Ee})(N));const he=b.createIndexBuffer(Qr,!0),pe=b.createVertexBuffer(Q,f.cc.members,!0);for(const de of z){const me=Sc(v.transform);q.draw(b,C.TRIANGLES,_n.disabled,Pn.disabled,v.colorModeForRenderPass(),vn.disabled,me,v.style.map.terrain&&v.style.map.terrain.getTerrainData(de.coord),null,a.id,pe,he,f.aY.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,v.transform.zoom,null,null,null)}pe.destroy(),he.destroy()}const To=f.as(new Float32Array(16));function So(v,t,a,c,p,b){const{horizontalAlign:T,verticalAlign:C}=f.aT(v);return new f.P((-(T-.5)*t/p+c[0])*b,(-(C-.5)*a/p+c[1])*b)}function Ya(v,t,a,c,p,b){const T=t.tileAnchorPoint.add(new f.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let C=c.mult(b);a||(C=C.rotate(-p));const A=T.add(C);return yn(A.x,A.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const C=Vn(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(v),A=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return v.add(c.rotate(A))}return v.add(c)}function Yo(v,t,a,c,p,b,T,C,A,z,N,Z){const q=v.text.placedSymbolArray,Q=v.text.dynamicLayoutVertexArray,ne=v.icon.dynamicLayoutVertexArray,he={};Q.clear();for(let pe=0;pe<q.length;pe++){const de=q.get(pe),me=de.hidden||!de.crossTileID||v.allowVerticalPlacement&&!de.placedOrientation?null:c[de.crossTileID];if(me){const Ee=new f.P(de.anchorX,de.anchorY),_e={getElevation:Z,width:p.width,height:p.height,pitchedLabelPlaneMatrix:b,pitchWithMap:a,transform:p,tileAnchorPoint:Ee,translation:z,unwrappedTileID:N},Ce=a?Yr(Ee.x,Ee.y,_e):Vn(Ee.x,Ee.y,_e),Ae=as(p.cameraToCenterDistance,Ce.signedDistanceFromCamera);let be=f.aB(v.textSizeData,C,de)*Ae/f.aN;a&&(be*=v.tilePixelRatio/T);const{width:ze,height:$e,anchor:Ze,textOffset:We,textBoxScale:Qe}=me,mt=So(Ze,ze,$e,We,Qe,be),kt=p.getPitchedTextCorrection(Ee.x+z[0],Ee.y+z[1],N),dt=Ya(Ce.point,_e,t,mt,-p.bearingInRadians,kt),Wt=v.allowVerticalPlacement&&de.placedOrientation===f.aA.vertical?Math.PI/2:0;for(let Sn=0;Sn<de.numGlyphs;Sn++)f.aH(Q,dt,Wt);A&&de.associatedIconIndex>=0&&(he[de.associatedIconIndex]={shiftedAnchor:dt,angle:Wt})}else Es(de.numGlyphs,Q)}if(A){ne.clear();const pe=v.icon.placedSymbolArray;for(let de=0;de<pe.length;de++){const me=pe.get(de);if(me.hidden)Es(me.numGlyphs,ne);else{const Ee=he[de];if(Ee)for(let _e=0;_e<me.numGlyphs;_e++)f.aH(ne,Ee.shiftedAnchor,Ee.angle);else Es(me.numGlyphs,ne)}}v.icon.dynamicLayoutVertexBuffer.updateData(ne)}v.text.dynamicLayoutVertexBuffer.updateData(Q)}function of(v,t,a){return a.iconsInText&&t?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function ru(v,t,a,c,p,b,T,C,A,z,N,Z,q){const Q=v.context,ne=Q.gl,he=v.transform,pe=C==="map",de=A==="map",me=C!=="viewport"&&a.layout.get("symbol-placement")!=="point",Ee=pe&&!de&&!me,_e=!a.layout.get("symbol-sort-key").isConstant();let Ce=!1;const Ae=v.getDepthModeForSublayer(0,_n.ReadOnly),be=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ze=[],$e=he.getCircleRadiusCorrection();for(const Ze of c){const We=t.getTile(Ze),Qe=We.getBucket(a);if(!Qe)continue;const mt=p?Qe.text:Qe.icon;if(!mt||!mt.segments.get().length||!mt.hasVisibleVertices)continue;const kt=mt.programConfigurations.get(a.id),dt=p||Qe.sdfIcons,Wt=p?Qe.textSizeData:Qe.iconSizeData,Sn=de||he.pitch!==0,ti=v.useProgram(of(dt,p,Qe),kt),Si=f.az(Wt,he.zoom),ri=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ze);let Oi,fi,Sr,Pi,Er=[0,0],Qi=null;if(p)fi=We.glyphAtlasTexture,Sr=ne.LINEAR,Oi=We.glyphAtlasTexture.size,Qe.iconsInText&&(Er=We.imageAtlasTexture.size,Qi=We.imageAtlasTexture,Pi=Sn||v.options.rotating||v.options.zooming||Wt.kind==="composite"||Wt.kind==="camera"?ne.LINEAR:ne.NEAREST);else{const Ki=a.layout.get("icon-size").constantOr(0)!==1||Qe.iconsNeedLinear;fi=We.imageAtlasTexture,Sr=dt||v.options.rotating||v.options.zooming||Ki||Sn?ne.LINEAR:ne.NEAREST,Oi=We.imageAtlasTexture.size}const ir=f.aO(We,1,v.transform.zoom),ta=gr(pe,v.transform,ir),pa=f.N();f.aC(pa,ta);const Js=ws(de,pe,v.transform,ir),sl=f.aP(he,We,b,T),hu=he.getProjectionData({overscaledTileID:Ze,applyGlobeMatrix:!q,applyTerrainMatrix:!0}),Sh=be&&Qe.hasTextData(),fu=a.layout.get("icon-text-fit")!=="none"&&Sh&&Qe.hasIconData();if(me){const Ki=v.style.map.terrain?(Na,Vi)=>v.style.map.terrain.getElevation(Ze,Na,Vi):null,Cr=a.layout.get("text-rotation-alignment")==="map";js(Qe,v,p,ta,pa,de,z,Cr,Ze.toUnwrapped(),he.width,he.height,sl,Ki)}const Wa=p&&be||fu,Mr=me||Wa?To:de?ta:v.transform.clipSpaceToPixelsMatrix,Ur=dt&&a.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let na;na=dt?Qe.iconsInText?o(Wt.kind,Si,Ee,de,me,Wa,v,Mr,Js,sl,Oi,Er,$e):_(Wt.kind,Si,Ee,de,me,Wa,v,Mr,Js,sl,p,Oi,0,$e):va(Wt.kind,Si,Ee,de,me,Wa,v,Mr,Js,sl,p,Oi,$e);const gs={program:ti,buffers:mt,uniformValues:na,projectionData:hu,atlasTexture:fi,atlasTextureIcon:Qi,atlasInterpolation:Sr,atlasInterpolationIcon:Pi,isSDF:dt,hasHalo:Ur};if(_e&&Qe.canOverlap){Ce=!0;const Ki=mt.segments.get();for(const Cr of Ki)ze.push({segments:new f.aY([Cr]),sortKey:Cr.sortKey,state:gs,terrainData:ri})}else ze.push({segments:mt.segments,sortKey:0,state:gs,terrainData:ri})}Ce&&ze.sort(((Ze,We)=>Ze.sortKey-We.sortKey));for(const Ze of ze){const We=Ze.state;if(Q.activeTexture.set(ne.TEXTURE0),We.atlasTexture.bind(We.atlasInterpolation,ne.CLAMP_TO_EDGE),We.atlasTextureIcon&&(Q.activeTexture.set(ne.TEXTURE1),We.atlasTextureIcon&&We.atlasTextureIcon.bind(We.atlasInterpolationIcon,ne.CLAMP_TO_EDGE)),We.isSDF){const Qe=We.uniformValues;We.hasHalo&&(Qe.u_is_halo=1,Fu(We.buffers,Ze.segments,a,v,We.program,Ae,N,Z,Qe,We.projectionData,Ze.terrainData)),Qe.u_is_halo=0}Fu(We.buffers,Ze.segments,a,v,We.program,Ae,N,Z,We.uniformValues,We.projectionData,Ze.terrainData)}}function Fu(v,t,a,c,p,b,T,C,A,z,N){const Z=c.context;p.draw(Z,Z.gl.TRIANGLES,b,T,C,vn.backCCW,A,N,z,a.id,v.layoutVertexBuffer,v.indexBuffer,t,a.paint,c.transform.zoom,v.programConfigurations.get(a.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function lf(v,t,a,c,p){const b=v.context,T=b.gl,C=Pn.disabled,A=new $n([T.ONE,T.ONE],f.bq.transparent,[!0,!0,!0,!0]),z=t.getBucket(a);if(!z)return;const N=c.key;let Z=a.heatmapFbos.get(N);Z||(Z=wi(b,t.tileSize,t.tileSize),a.heatmapFbos.set(N,Z)),b.bindFramebuffer.set(Z.framebuffer),b.viewport.set([0,0,t.tileSize,t.tileSize]),b.clear({color:f.bq.transparent});const q=z.programConfigurations.get(a.id),Q=v.useProgram("heatmap",q,!p),ne=v.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),he=v.style.map.terrain.getTerrainData(c);Q.draw(b,T.TRIANGLES,_n.disabled,C,A,vn.disabled,Hs(t,v.transform.zoom,a.paint.get("heatmap-intensity"),1),he,ne,a.id,z.layoutVertexBuffer,z.indexBuffer,z.segments,a.paint,v.transform.zoom,q)}function Jr(v,t,a,c,p){const b=v.context,T=b.gl,C=v.transform;b.setColorMode(v.colorModeForRenderPass());const A=jn(b,t),z=a.key,N=t.heatmapFbos.get(z);if(!N)return;b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,N.colorAttachment.get()),b.activeTexture.set(T.TEXTURE1),A.bind(T.LINEAR,T.CLAMP_TO_EDGE);const Z=C.getProjectionData({overscaledTileID:a,applyTerrainMatrix:p,applyGlobeMatrix:!c});v.useProgram("heatmapTexture").draw(b,T.TRIANGLES,_n.disabled,Pn.disabled,v.colorModeForRenderPass(),vn.disabled,Ou(v,t,0,1),null,Z,t.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,t.paint,C.zoom),N.destroy(),t.heatmapFbos.delete(z)}function wi(v,t,a){var c,p;const b=v.gl,T=b.createTexture();b.bindTexture(b.TEXTURE_2D,T),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const C=(c=v.HALF_FLOAT)!==null&&c!==void 0?c:b.UNSIGNED_BYTE,A=(p=v.RGBA16F)!==null&&p!==void 0?p:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,A,t,a,0,b.RGBA,C,null);const z=v.createFramebuffer(t,a,!1,!1);return z.colorAttachment.set(T),z}function jn(v,t){return t.colorRampTexture||(t.colorRampTexture=new f.T(v,t.colorRamp,v.gl.RGBA)),t.colorRampTexture}function Ho(v,t,a,c,p,b,T,C){let A=256;if(p.stepInterpolant){const z=t.getSource().maxzoom,N=T.canonical.z===z?Math.ceil(1<<v.transform.maxZoom-T.canonical.z):1;A=f.ao(f.cf(b.maxLineLength/f.a5*1024*N),256,a.maxTextureSize)}return C.gradient=f.cg({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:A,image:C.gradient||void 0,clips:b.lineClipsArray}),C.texture?C.texture.update(C.gradient):C.texture=new f.T(a,C.gradient,c.RGBA),C.version=p.gradientVersion,C.texture}function fs(v,t,a,c,p){v.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),c.updatePaintBuffers(p)}function Hi(v,t,a,c,p,b){(p||v.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),v.lineAtlas.bind(t)),c.updatePaintBuffers(b)}function Ha(v,t,a,c,p,b,T){const C=b.gradients[p.id];let A=C.texture;p.gradientVersion!==C.version&&(A=Ho(v,t,a,c,p,b,T,C)),a.activeTexture.set(c.TEXTURE0),A.bind(p.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE)}function ds(v,t,a,c,p,b,T,C,A){const z=b.gradients[p.id];let N=z.texture;p.gradientVersion!==z.version&&(N=Ho(v,t,a,c,p,b,T,z)),a.activeTexture.set(c.TEXTURE0),N.bind(p.stepInterpolant?c.NEAREST:c.LINEAR,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),v.lineAtlas.bind(a),C.updatePaintBuffers(A)}function Cc(v,t,a,c,p){if(!a||!c||!c.imageAtlas)return;const b=c.imageAtlas.patternPositions;let T=b[a.to.toString()],C=b[a.from.toString()];if(!T&&C&&(T=C),!C&&T&&(C=T),!T||!C){const A=p.getPaintProperty(t);T=b[A],C=b[A]}T&&C&&v.setConstantPatternPositions(T,C)}function Eo(v,t,a,c,p,b,T,C){const A=v.context.gl,z="fill-pattern",N=a.paint.get(z),Z=N&&N.constantOr(1),q=a.getCrossfadeParameters();let Q,ne,he,pe,de;const me=v.transform,Ee=a.paint.get("fill-translate"),_e=a.paint.get("fill-translate-anchor");T?(ne=Z&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Q=A.LINES):(ne=Z?"fillPattern":"fill",Q=A.TRIANGLES);const Ce=N.constantOr(null);for(const Ae of c){const be=t.getTile(Ae);if(Z&&!be.patternsLoaded())continue;const ze=be.getBucket(a);if(!ze)continue;const $e=ze.programConfigurations.get(a.id),Ze=v.useProgram(ne,$e),We=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ae);Z&&(v.context.activeTexture.set(A.TEXTURE0),be.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),$e.updatePaintBuffers(q)),Cc($e,z,Ce,be,a);const Qe=me.getProjectionData({overscaledTileID:Ae,applyGlobeMatrix:!C,applyTerrainMatrix:!0}),mt=f.aP(me,be,Ee,_e);if(T){pe=ze.indexBuffer2,de=ze.segments2;const dt=[A.drawingBufferWidth,A.drawingBufferHeight];he=ne==="fillOutlinePattern"&&Z?lh(v,q,be,dt,mt):vl(dt,mt)}else pe=ze.indexBuffer,de=ze.segments,he=Z?Zo(v,q,be,mt):{u_fill_translate:mt};const kt=v.stencilModeForClipping(Ae);Ze.draw(v.context,Q,p,kt,b,vn.backCCW,he,We,Qe,a.id,ze.layoutVertexBuffer,pe,de,a.paint,v.transform.zoom,$e)}}function Mo(v,t,a,c,p,b,T,C){const A=v.context,z=A.gl,N="fill-extrusion-pattern",Z=a.paint.get(N),q=Z.constantOr(1),Q=a.getCrossfadeParameters(),ne=a.paint.get("fill-extrusion-opacity"),he=Z.constantOr(null),pe=v.transform;for(const de of c){const me=t.getTile(de),Ee=me.getBucket(a);if(!Ee)continue;const _e=v.style.map.terrain&&v.style.map.terrain.getTerrainData(de),Ce=Ee.programConfigurations.get(a.id),Ae=v.useProgram(q?"fillExtrusionPattern":"fillExtrusion",Ce);q&&(v.context.activeTexture.set(z.TEXTURE0),me.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Ce.updatePaintBuffers(Q));const be=pe.getProjectionData({overscaledTileID:de,applyGlobeMatrix:!C,applyTerrainMatrix:!0});Cc(Ce,N,he,me,a);const ze=f.aP(pe,me,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),$e=a.paint.get("fill-extrusion-vertical-gradient"),Ze=q?Wl(v,$e,ne,ze,de,Q,me):zu(v,$e,ne,ze);Ae.draw(A,A.gl.TRIANGLES,p,b,T,vn.backCCW,Ze,_e,be,a.id,Ee.layoutVertexBuffer,Ee.indexBuffer,Ee.segments,a.paint,v.transform.zoom,Ce,v.style.map.terrain&&Ee.centroidVertexBuffer)}}function Co(v,t,a,c,p,b,T,C,A){var z;const N=v.style.projection,Z=v.context,q=v.transform,Q=Z.gl,ne=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],he=v.useProgram("hillshade",null,!1,ne),pe=!v.options.moving;for(const de of c){const me=t.getTile(de),Ee=me.fbo;if(!Ee)continue;const _e=N.getMeshFromTileID(Z,de.canonical,C,!0,"raster"),Ce=(z=v.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(de);Z.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_2D,Ee.colorAttachment.get());const Ae=q.getProjectionData({overscaledTileID:de,aligned:pe,applyGlobeMatrix:!A,applyTerrainMatrix:!0});he.draw(Z,Q.TRIANGLES,b,p[de.overscaledZ],T,vn.backCCW,xl(v,me,a),Ce,Ae,a.id,_e.vertexBuffer,_e.indexBuffer,_e.segments)}}function Xo(v,t,a,c,p,b,T,C,A){var z;const N=v.style.projection,Z=v.context,q=v.transform,Q=Z.gl,ne=v.useProgram("colorRelief"),he=!v.options.moving;let pe=!0,de=0;for(const me of c){const Ee=t.getTile(me),_e=Ee.dem;if(pe){const Ze=Q.getParameter(Q.MAX_TEXTURE_SIZE),{elevationTexture:We,colorTexture:Qe}=a.getColorRampTextures(Z,Ze,_e.getUnpackVector());Z.activeTexture.set(Q.TEXTURE1),We.bind(Q.NEAREST,Q.CLAMP_TO_EDGE),Z.activeTexture.set(Q.TEXTURE4),Qe.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),pe=!1,de=We.size[0]}if(!_e||!_e.data)continue;const Ce=_e.stride,Ae=_e.getPixels();if(Z.activeTexture.set(Q.TEXTURE0),Z.pixelStoreUnpackPremultiplyAlpha.set(!1),Ee.demTexture=Ee.demTexture||v.getTileTexture(Ce),Ee.demTexture){const Ze=Ee.demTexture;Ze.update(Ae,{premultiply:!1}),Ze.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)}else Ee.demTexture=new f.T(Z,Ae,Q.RGBA,{premultiply:!1}),Ee.demTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const be=N.getMeshFromTileID(Z,me.canonical,C,!0,"raster"),ze=(z=v.style.map.terrain)===null||z===void 0?void 0:z.getTerrainData(me),$e=q.getProjectionData({overscaledTileID:me,aligned:he,applyGlobeMatrix:!A,applyTerrainMatrix:!0});ne.draw(Z,Q.TRIANGLES,b,p[me.overscaledZ],T,vn.backCCW,Nu(a,Ee.dem,de),ze,$e,a.id,be.vertexBuffer,be.indexBuffer,be.segments)}}const $o=[new f.P(0,0),new f.P(f.a5,0),new f.P(f.a5,f.a5),new f.P(0,f.a5)];function Ds(v,t,a,c,p,b,T,C,A=!1,z=!1){const N=c[c.length-1].overscaledZ,Z=v.context,q=Z.gl,Q=v.useProgram("raster"),ne=v.transform,he=v.style.projection,pe=v.colorModeForRenderPass(),de=!v.options.moving,me=a.paint.get("raster-opacity"),Ee=a.paint.get("raster-resampling"),_e=a.paint.get("raster-fade-duration"),Ce=!!v.style.map.terrain;for(const Ae of c){const be=v.getDepthModeForSublayer(Ae.overscaledZ-N,me===1?_n.ReadWrite:_n.ReadOnly,q.LESS),ze=t.getTile(Ae),$e=Ee==="nearest"?q.NEAREST:q.LINEAR;Z.activeTexture.set(q.TEXTURE0),ze.texture.bind($e,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(q.TEXTURE1);const{parentTile:Ze,parentScaleBy:We,parentTopLeft:Qe,fadeValues:mt}=Io(ze,t,_e,Ce);ze.fadeOpacity=mt.tileOpacity,Ze?(Ze.fadeOpacity=mt.parentTileOpacity,Ze.texture.bind($e,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST)):ze.texture.bind($e,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),ze.texture.useMipmap&&Z.extTextureFilterAnisotropic&&v.transform.pitch>20&&q.texParameterf(q.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax);const kt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Ae),dt=ne.getProjectionData({overscaledTileID:Ae,aligned:de,applyGlobeMatrix:!z,applyTerrainMatrix:!0}),Wt=tu(Qe,We,mt.fadeMix,a,C),Sn=he.getMeshFromTileID(Z,Ae.canonical,b,T,"raster");Q.draw(Z,q.TRIANGLES,be,p?p[Ae.overscaledZ]:Pn.disabled,pe,A?vn.frontCCW:vn.backCCW,Wt,kt,dt,a.id,Sn.vertexBuffer,Sn.indexBuffer,Sn.segments)}}function Io(v,t,a,c){const p={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||c)return p;if(v.fadingParentID){const b=t.getLoadedTile(v.fadingParentID);if(!b)return p;const T=Math.pow(2,b.tileID.overscaledZ-v.tileID.overscaledZ),C=[v.tileID.canonical.x*T%1,v.tileID.canonical.y*T%1],A=(function(z,N,Z){const q=at(),Q=(q-N.timeAdded)/Z,ne=z.fadingDirection===Le.Incoming,he=f.ao((q-z.timeAdded)/Z,0,1),pe=f.ao(1-Q,0,1),de=ne?he:pe;return{tileOpacity:de,parentTileOpacity:ne?pe:he,fadeMix:{opacity:1,mix:1-de}}})(v,b,a);return{parentTile:b,parentScaleBy:T,parentTopLeft:C,fadeValues:A}}if(v.selfFading){const b=(function(T,C){const A=(at()-T.timeAdded)/C,z=f.ao(A,0,1);return{tileOpacity:z,fadeMix:{opacity:z,mix:0}}})(v,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:b}}return p}const Wo=new f.bq(1,0,0,1),Ao=new f.bq(0,1,0,1),mh=new f.bq(0,0,1,1),gh=new f.bq(1,0,1,1),Ps=new f.bq(0,1,1,1);function Vu(v,t,a,c){yr(v,0,t+a/2,v.transform.width,a,c)}function Qo(v,t,a,c){yr(v,t-a/2,0,a,v.transform.height,c)}function yr(v,t,a,c,p,b){const T=v.context,C=T.gl;C.enable(C.SCISSOR_TEST),C.scissor(t*v.pixelRatio,a*v.pixelRatio,c*v.pixelRatio,p*v.pixelRatio),T.clear({color:b}),C.disable(C.SCISSOR_TEST)}function Ic(v,t,a){const c=v.context,p=c.gl,b=v.useProgram("debug"),T=_n.disabled,C=Pn.disabled,A=v.colorModeForRenderPass(),z="$debug",N=v.style.map.terrain&&v.style.map.terrain.getTerrainData(a);c.activeTexture.set(p.TEXTURE0);const Z=t.getTileByID(a.key).latestRawTileData,q=Math.floor((Z&&Z.byteLength||0)/1024),Q=t.getTile(a).tileSize,ne=512/Math.min(Q,512)*(a.overscaledZ/v.transform.zoom)*.5;let he=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(he+=` => ${a.overscaledZ}`),(function(de,me){de.initDebugOverlayCanvas();const Ee=de.debugOverlayCanvas,_e=de.context.gl,Ce=de.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,Ee.width,Ee.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(me,5,5),Ce.strokeText(me,5,5),de.debugOverlayTexture.update(Ee),de.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)})(v,`${he} ${q}kB`);const pe=v.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(c,p.TRIANGLES,T,C,$n.alphaBlended,vn.disabled,Kl(f.bq.transparent,ne),null,pe,z,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),b.draw(c,p.LINE_STRIP,T,C,A,vn.disabled,Kl(f.bq.red),N,pe,z,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function _h(v,t,a,c){const{isRenderingGlobe:p}=c,b=v.context,T=b.gl,C=v.transform,A=v.colorModeForRenderPass(),z=v.getDepthModeFor3D(),N=v.useProgram("terrain");b.bindFramebuffer.set(null),b.viewport.set([0,0,v.width,v.height]);for(const Z of a){const q=t.getTerrainMesh(Z.tileID),Q=v.renderToTexture.getTexture(Z),ne=t.getTerrainData(Z.tileID);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,Q.texture);const he=t.getMeshFrameDelta(C.zoom),pe=C.calculateFogMatrix(Z.tileID.toUnwrapped()),de=sh(he,pe,v.style.sky,C.pitch,p),me=C.getProjectionData({overscaledTileID:Z.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});N.draw(b,T.TRIANGLES,z,Pn.disabled,A,vn.backCCW,de,ne,me,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}}function uf(v,t){if(!t.mesh){const a=new f.aX;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const c=new f.aZ;c.emplaceBack(0,1,2),c.emplaceBack(0,2,3),t.mesh=new Qn(v.createVertexBuffer(a,Za.members),v.createIndexBuffer(c),f.aY.simpleSegment(0,0,a.length,c.length))}return t.mesh}class od{constructor(t,a){this.context=new Ml(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:f.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=li.maxOverzooming+li.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Yi}resize(t,a,c){if(this.width=Math.floor(t*c),this.height=Math.floor(a*c),this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,a=new f.aX;a.emplaceBack(0,0),a.emplaceBack(f.a5,0),a.emplaceBack(0,f.a5),a.emplaceBack(f.a5,f.a5),this.tileExtentBuffer=t.createVertexBuffer(a,Za.members),this.tileExtentSegments=f.aY.simpleSegment(0,0,4,2);const c=new f.aX;c.emplaceBack(0,0),c.emplaceBack(f.a5,0),c.emplaceBack(0,f.a5),c.emplaceBack(f.a5,f.a5),this.debugBuffer=t.createVertexBuffer(c,Za.members),this.debugSegments=f.aY.simpleSegment(0,0,4,5);const p=new f.ci;p.emplaceBack(0,0,0,0),p.emplaceBack(f.a5,0,f.a5,0),p.emplaceBack(0,f.a5,0,f.a5),p.emplaceBack(f.a5,f.a5,f.a5,f.a5),this.rasterBoundsBuffer=t.createVertexBuffer(p,ah.members),this.rasterBoundsSegments=f.aY.simpleSegment(0,0,4,2);const b=new f.aX;b.emplaceBack(0,0),b.emplaceBack(f.a5,0),b.emplaceBack(0,f.a5),b.emplaceBack(f.a5,f.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(b,Za.members),this.rasterBoundsSegmentsPosOnly=f.aY.simpleSegment(0,0,4,5);const T=new f.aX;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(T,Za.members),this.viewportSegments=f.aY.simpleSegment(0,0,4,2);const C=new f.cj;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(C);const A=new f.aZ;A.emplaceBack(1,0,2),A.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(A);const z=this.context.gl;this.stencilClearMode=new Pn({func:z.ALWAYS,mask:0},0,255,z.ZERO,z.ZERO,z.ZERO),this.tileExtentMesh=new Qn(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=f.N();f.c8(c,0,this.width,this.height,0,0,1),f.Q(c,c,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const p={mainMatrix:c,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:c};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,_n.disabled,this.stencilClearMode,$n.disabled,vn.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,c){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const p=this.context;p.setColorMode($n.disabled),p.setDepthMode(_n.disabled);const b={};for(const T of a)b[T.key]=this.nextStencilID++;this._renderTileMasks(b,a,c,!0),this._renderTileMasks(b,a,c,!1),this._tileClippingMaskIDs=b}_renderTileMasks(t,a,c,p){const b=this.context,T=b.gl,C=this.style.projection,A=this.transform,z=this.useProgram("clippingMask");for(const N of a){const Z=t[N.key],q=this.style.map.terrain&&this.style.map.terrain.getTerrainData(N),Q=C.getMeshFromTileID(this.context,N.canonical,p,!0,"stencil"),ne=A.getProjectionData({overscaledTileID:N,applyGlobeMatrix:!c,applyTerrainMatrix:!0});z.draw(b,T.TRIANGLES,_n.disabled,new Pn({func:T.ALWAYS,mask:0},Z,255,T.KEEP,T.KEEP,T.REPLACE),$n.disabled,c?vn.disabled:vn.backCCW,null,q,ne,"$clipping",Q.vertexBuffer,Q.indexBuffer,Q.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,c=this.style.projection,p=this.transform,b=this.useProgram("depth"),T=this.getDepthModeFor3D(),C=Ci(p,{tileSize:p.tileSize});for(const A of C){const z=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A),N=c.getMeshFromTileID(this.context,A.canonical,!0,!0,"raster"),Z=p.getProjectionData({overscaledTileID:A,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(t,a.TRIANGLES,T,Pn.disabled,$n.disabled,vn.backCCW,null,z,Z,"$clipping",N.vertexBuffer,N.indexBuffer,N.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Pn({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new Pn({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,c=t.sort(((T,C)=>C.overscaledZ-T.overscaledZ)),p=c[c.length-1].overscaledZ,b=c[0].overscaledZ-p+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let C=0;C<b;C++)T[C+p]=new Pn({func:a.GEQUAL,mask:255},C+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[T,c]}return[{[p]:Pn.disabled},c]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,c=t.sort(((T,C)=>C.overscaledZ-T.overscaledZ)),p=c[c.length-1].overscaledZ,b=c[0].overscaledZ-p+1;if(this.clearStencil(),b>1){const T={},C={};for(let A=0;A<b;A++)T[A+p]=new Pn({func:a.GREATER,mask:255},b+1+A,255,a.KEEP,a.KEEP,a.REPLACE),C[A+p]=new Pn({func:a.GREATER,mask:255},1+A,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*b+1,[T,C,c]}return this.nextStencilID=3,[{[p]:new Pn({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[p]:new Pn({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new $n([t.CONSTANT_COLOR,t.ONE],new f.bq(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?$n.unblended:$n.alphaBlended}getDepthModeForSublayer(t,a,c){if(!this.opaquePassEnabledForLayer())return _n.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new _n(c||this.context.gl.LEQUAL,a,[p,p])}getDepthModeFor3D(){return new _n(this.context.gl.LEQUAL,_n.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var c,p;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(at()),this.imageManager.beginFrame();const b=this.style._order,T=this.style.tileManagers,C={},A={},z={},N={isRenderingToTexture:!1,isRenderingGlobe:((c=t.projection)===null||c===void 0?void 0:c.transitionState)>0};for(const q in T){const Q=T[q];Q.used&&Q.prepare(this.context),C[q]=Q.getVisibleCoordinates(!1),A[q]=C[q].slice().reverse(),z[q]=Q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let q=0;q<b.length;q++)if(this.style._layers[b[q]].is3D()){this.opaquePassCutoff=q;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const q of b){const Q=this.style._layers[q];if(!Q.hasOffscreenPass()||Q.isHidden(this.transform.zoom))continue;const ne=A[Q.source];(Q.type==="custom"||ne.length)&&this.renderLayer(this,T[Q.source],Q,ne,N)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:q=>this.useProgram(q)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?f.bq.black:f.bq.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(q,Q){const ne=q.context,he=ne.gl,pe=((Ae,be,ze)=>{const $e=Math.cos(be.rollInRadians),Ze=Math.sin(be.rollInRadians),We=Dn(be),Qe=be.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Ae.properties.get("sky-color"),u_horizon_color:Ae.properties.get("horizon-color"),u_horizon:[(be.width/2-We*Ze)*ze,(be.height/2+We*$e)*ze],u_horizon_normal:[-Ze,$e],u_sky_horizon_blend:Ae.properties.get("sky-horizon-blend")*be.height/2*ze,u_sky_blend:Qe}})(Q,q.style.map.transform,q.pixelRatio),de=new _n(he.LEQUAL,_n.ReadWrite,[0,1]),me=Pn.disabled,Ee=q.colorModeForRenderPass(),_e=q.useProgram("sky"),Ce=uf(ne,Q);_e.draw(ne,he.TRIANGLES,de,me,Ee,vn.disabled,pe,null,void 0,"sky",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const q=this.style._layers[b[this.currentLayer]],Q=T[q.source],ne=C[q.source];this._renderTileClippingMasks(q,ne,!1),this.renderLayer(this,Q,q,ne,N)}this.renderPass="translucent";let Z=!1;for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const q=this.style._layers[b[this.currentLayer]],Q=T[q.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(q,N))continue;this.opaquePassEnabledForLayer()||Z||(Z=!0,N.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ne=(q.type==="symbol"?z:A)[q.source];this._renderTileClippingMasks(q,C[q.source],!!this.renderToTexture),this.renderLayer(this,Q,q,ne,N)}if(N.isRenderingGlobe&&(function(q,Q,ne){const he=q.context,pe=he.gl,de=q.useProgram("atmosphere"),me=new _n(pe.LEQUAL,_n.ReadOnly,[0,1]),Ee=q.transform,_e=(function(Qe,mt){const kt=Qe.properties.get("position"),dt=[-kt.x,-kt.y,-kt.z],Wt=f.as(new Float64Array(16));return Qe.properties.get("anchor")==="map"&&(f.bh(Wt,Wt,mt.rollInRadians),f.bi(Wt,Wt,-mt.pitchInRadians),f.bh(Wt,Wt,mt.bearingInRadians),f.bi(Wt,Wt,mt.center.lat*Math.PI/180),f.bK(Wt,Wt,-mt.center.lng*Math.PI/180)),f.ch(dt,dt,Wt),dt})(ne,q.transform),Ce=Ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Ae=Q.properties.get("atmosphere-blend")*Ce.projectionTransition;if(Ae===0)return;const be=ka(Ee.worldSize,Ee.center.lat),ze=Ee.inverseProjectionMatrix,$e=new Float64Array(4);$e[3]=1,f.aI($e,$e,Ee.modelViewProjectionMatrix),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1,f.aI($e,$e,ze),$e[0]/=$e[3],$e[1]/=$e[3],$e[2]/=$e[3],$e[3]=1;const Ze=((Qe,mt,kt,dt,Wt)=>({u_sun_pos:Qe,u_atmosphere_blend:mt,u_globe_position:kt,u_globe_radius:dt,u_inv_proj_matrix:Wt}))(_e,Ae,[$e[0],$e[1],$e[2]],be,ze),We=uf(he,Q);de.draw(he,pe.TRIANGLES,me,Pn.disabled,$n.alphaBlended,vn.disabled,Ze,null,null,"atmosphere",We.vertexBuffer,We.indexBuffer,We.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const q=(function(Q,ne){let he=null;const pe=Object.values(Q._layers).flatMap((_e=>_e.source&&!_e.isHidden(ne)?[Q.tileManagers[_e.source]]:[])),de=pe.filter((_e=>_e.getSource().type==="vector")),me=pe.filter((_e=>_e.getSource().type!=="vector")),Ee=_e=>{(!he||he.getSource().maxzoom<_e.getSource().maxzoom)&&(he=_e)};return de.forEach((_e=>Ee(_e))),he||me.forEach((_e=>Ee(_e))),he})(this.style,this.transform.zoom);q&&(function(Q,ne,he){for(let pe=0;pe<he.length;pe++)Ic(Q,ne,he[pe])})(this,q,q.getVisibleCoordinates())}this.options.showPadding&&(function(q){const Q=q.transform.padding;Vu(q,q.transform.height-(Q.top||0),3,Wo),Vu(q,Q.bottom||0,3,Ao),Qo(q,Q.left||0,3,mh),Qo(q,q.transform.width-(Q.right||0),3,gh);const ne=q.transform.centerPoint;(function(he,pe,de,me){yr(he,pe-1,de-10,2,20,me),yr(he,pe-10,de-1,20,2,me)})(q,ne.x,q.transform.height-ne.y,Ps)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,c=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=t?!f.ck(a,c):!f.cl(a,c)),p||(p=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(f.cm(a,c),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(b,T){const C=b.context,A=C.gl,z=b.transform,N=$n.unblended,Z=new _n(A.LEQUAL,_n.ReadWrite,[0,1]),q=T.tileManager.getRenderableTiles(),Q=b.useProgram("terrainDepth");C.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),C.clear({color:f.bq.transparent,depth:1});for(const ne of q){const he=T.getTerrainMesh(ne.tileID),pe=T.getTerrainData(ne.tileID),de=z.getProjectionData({overscaledTileID:ne.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),me={u_ele_delta:T.getMeshFrameDelta(z.zoom)};Q.draw(C,A.TRIANGLES,Z,Pn.disabled,N,vn.backCCW,me,pe,de,"terrain",he.vertexBuffer,he.indexBuffer,he.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain),(function(b,T){const C=b.context,A=C.gl,z=b.transform,N=$n.unblended,Z=new _n(A.LEQUAL,_n.ReadWrite,[0,1]),q=T.getCoordsTexture(),Q=T.tileManager.getRenderableTiles(),ne=b.useProgram("terrainCoords");C.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),C.clear({color:f.bq.transparent,depth:1}),T.coordsIndex=[];for(const he of Q){const pe=T.getTerrainMesh(he.tileID),de=T.getTerrainData(he.tileID);C.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,q.texture);const me={u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(z.zoom)},Ee=z.getProjectionData({overscaledTileID:he.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ne.draw(C,A.TRIANGLES,Z,Pn.disabled,N,vn.backCCW,me,de,Ee,"terrain",pe.vertexBuffer,pe.indexBuffer,pe.segments),T.coordsIndex.push(he.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain))}renderLayer(t,a,c,p,b){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(p||[]).length)&&(this.id=c.id,f.cn(c)?(function(T,C,A,z,N,Z){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:q}=Z,Q=Pn.disabled,ne=T.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(he,pe,de,me,Ee,_e,Ce,Ae,be){const ze=pe.transform,$e=pe.style.map.terrain,Ze=Ee==="map",We=_e==="map";for(const Qe of he){const mt=me.getTile(Qe),kt=mt.getBucket(de);if(!kt||!kt.text||!kt.text.segments.get().length)continue;const dt=f.az(kt.textSizeData,ze.zoom),Wt=f.aO(mt,1,pe.transform.zoom),Sn=gr(Ze,pe.transform,Wt),ti=de.layout.get("icon-text-fit")!=="none"&&kt.hasIconData();if(dt){const Si=Math.pow(2,ze.zoom-mt.tileID.overscaledZ),ri=$e?(Oi,fi)=>$e.getElevation(Qe,Oi,fi):null;Yo(kt,Ze,We,be,ze,Sn,Si,dt,ti,f.aP(ze,mt,Ce,Ae),Qe.toUnwrapped(),ri)}}})(z,T,A,C,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),N),A.paint.get("icon-opacity").constantOr(1)!==0&&ru(T,C,A,z,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),Q,ne,q),A.paint.get("text-opacity").constantOr(1)!==0&&ru(T,C,A,z,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),Q,ne,q),C.map.showCollisionBoxes&&(Kr(T,C,A,z,!0),Kr(T,C,A,z,!1))})(t,a,c,p,this.style.placement.variableOffsets,b):f.co(c)?(function(T,C,A,z,N){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=N,q=A.paint.get("circle-opacity"),Q=A.paint.get("circle-stroke-width"),ne=A.paint.get("circle-stroke-opacity"),he=!A.layout.get("circle-sort-key").isConstant();if(q.constantOr(1)===0&&(Q.constantOr(1)===0||ne.constantOr(1)===0))return;const pe=T.context,de=pe.gl,me=T.transform,Ee=T.getDepthModeForSublayer(0,_n.ReadOnly),_e=Pn.disabled,Ce=T.colorModeForRenderPass(),Ae=[],be=me.getCircleRadiusCorrection();for(let ze=0;ze<z.length;ze++){const $e=z[ze],Ze=C.getTile($e),We=Ze.getBucket(A);if(!We)continue;const Qe=A.paint.get("circle-translate"),mt=A.paint.get("circle-translate-anchor"),kt=f.aP(me,Ze,Qe,mt),dt=We.programConfigurations.get(A.id),Wt=T.useProgram("circle",dt),Sn=We.layoutVertexBuffer,ti=We.indexBuffer,Si=T.style.map.terrain&&T.style.map.terrain.getTerrainData($e),ri={programConfiguration:dt,program:Wt,layoutVertexBuffer:Sn,indexBuffer:ti,uniformValues:Ql(T,Ze,A,kt,be),terrainData:Si,projectionData:me.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!Z,applyTerrainMatrix:!0})};if(he){const Oi=We.segments.get();for(const fi of Oi)Ae.push({segments:new f.aY([fi]),sortKey:fi.sortKey,state:ri})}else Ae.push({segments:We.segments,sortKey:0,state:ri})}he&&Ae.sort(((ze,$e)=>ze.sortKey-$e.sortKey));for(const ze of Ae){const{programConfiguration:$e,program:Ze,layoutVertexBuffer:We,indexBuffer:Qe,uniformValues:mt,terrainData:kt,projectionData:dt}=ze.state;Ze.draw(pe,de.TRIANGLES,Ee,_e,Ce,vn.backCCW,mt,kt,dt,A.id,We,Qe,ze.segments,A.paint,T.transform.zoom,$e)}})(t,a,c,p,b):f.cp(c)?(function(T,C,A,z,N){if(A.paint.get("heatmap-opacity")===0)return;const Z=T.context,{isRenderingToTexture:q,isRenderingGlobe:Q}=N;if(T.style.map.terrain){for(const ne of z){const he=C.getTile(ne);C.hasRenderableParent(ne)||(T.renderPass==="offscreen"?lf(T,he,A,ne,Q):T.renderPass==="translucent"&&Jr(T,A,ne,q,Q))}Z.viewport.set([0,0,T.width,T.height])}else T.renderPass==="offscreen"?(function(ne,he,pe,de){const me=ne.context,Ee=me.gl,_e=ne.transform,Ce=Pn.disabled,Ae=new $n([Ee.ONE,Ee.ONE],f.bq.transparent,[!0,!0,!0,!0]);(function(be,ze,$e){const Ze=be.gl;be.activeTexture.set(Ze.TEXTURE1),be.viewport.set([0,0,ze.width/4,ze.height/4]);let We=$e.heatmapFbos.get(f.ce);We?(Ze.bindTexture(Ze.TEXTURE_2D,We.colorAttachment.get()),be.bindFramebuffer.set(We.framebuffer)):(We=wi(be,ze.width/4,ze.height/4),$e.heatmapFbos.set(f.ce,We))})(me,ne,pe),me.clear({color:f.bq.transparent});for(let be=0;be<de.length;be++){const ze=de[be];if(he.hasRenderableParent(ze))continue;const $e=he.getTile(ze),Ze=$e.getBucket(pe);if(!Ze)continue;const We=Ze.programConfigurations.get(pe.id),Qe=ne.useProgram("heatmap",We),mt=_e.getProjectionData({overscaledTileID:ze,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),kt=_e.getCircleRadiusCorrection();Qe.draw(me,Ee.TRIANGLES,_n.disabled,Ce,Ae,vn.backCCW,Hs($e,_e.zoom,pe.paint.get("heatmap-intensity"),kt),null,mt,pe.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,pe.paint,_e.zoom,We)}me.viewport.set([0,0,ne.width,ne.height])})(T,C,A,z):T.renderPass==="translucent"&&(function(ne,he){const pe=ne.context,de=pe.gl;pe.setColorMode(ne.colorModeForRenderPass());const me=he.heatmapFbos.get(f.ce);me&&(pe.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_2D,me.colorAttachment.get()),pe.activeTexture.set(de.TEXTURE1),jn(pe,he).bind(de.LINEAR,de.CLAMP_TO_EDGE),ne.useProgram("heatmapTexture").draw(pe,de.TRIANGLES,_n.disabled,Pn.disabled,ne.colorModeForRenderPass(),vn.disabled,Ou(ne,he,0,1),null,null,he.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments,he.paint,ne.transform.zoom))})(T,A)})(t,a,c,p,b):f.cq(c)?(function(T,C,A,z,N){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=N,q=A.paint.get("line-opacity"),Q=A.paint.get("line-width");if(q.constantOr(1)===0||Q.constantOr(1)===0)return;const ne=T.getDepthModeForSublayer(0,_n.ReadOnly),he=T.colorModeForRenderPass(),pe=A.paint.get("line-dasharray"),de=pe.constantOr(1),me=A.paint.get("line-pattern"),Ee=me.constantOr(1),_e=A.paint.get("line-gradient"),Ce=A.getCrossfadeParameters();let Ae;Ae=Ee?"linePattern":de&&_e?"lineGradientSDF":de?"lineSDF":_e?"lineGradient":"line";const be=T.context,ze=be.gl,$e=T.transform;let Ze=!0;for(const We of z){const Qe=C.getTile(We);if(Ee&&!Qe.patternsLoaded())continue;const mt=Qe.getBucket(A);if(!mt)continue;const kt=mt.programConfigurations.get(A.id),dt=T.context.program.get(),Wt=T.useProgram(Ae,kt),Sn=Ze||Wt.program!==dt,ti=T.style.map.terrain&&T.style.map.terrain.getTerrainData(We),Si=me.constantOr(null),ri=pe&&pe.constantOr(null);if(Si&&Qe.imageAtlas){const Er=Qe.imageAtlas,Qi=Er.patternPositions[Si.to.toString()],ir=Er.patternPositions[Si.from.toString()];Qi&&ir&&kt.setConstantPatternPositions(Qi,ir)}else if(ri){const Er=A.layout.get("line-cap")==="round",Qi=T.lineAtlas.getDash(ri.to,Er),ir=T.lineAtlas.getDash(ri.from,Er);kt.setConstantDashPositions(Qi,ir)}const Oi=$e.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!Z,applyTerrainMatrix:!0}),fi=$e.getPixelScale();let Sr;Ee?(Sr=Bu(T,Qe,A,fi,Ce),fs(be,ze,Qe,kt,Ce)):de&&_e?(Sr=vo(T,Qe,A,fi,Ce,mt.lineClipsArray.length),ds(T,C,be,ze,A,mt,We,kt,Ce)):de?(Sr=ya(T,Qe,A,fi,Ce),Hi(T,be,ze,kt,Sn,Ce)):_e?(Sr=Ec(T,Qe,A,fi,mt.lineClipsArray.length),Ha(T,C,be,ze,A,mt,We)):Sr=Jl(T,Qe,A,fi);const Pi=T.stencilModeForClipping(We);Wt.draw(be,ze.TRIANGLES,ne,Pi,he,vn.disabled,Sr,ti,Oi,A.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,A.paint,T.transform.zoom,kt,mt.layoutVertexBuffer2),Ze=!1}})(t,a,c,p,b):f.cr(c)?(function(T,C,A,z,N){const Z=A.paint.get("fill-color"),q=A.paint.get("fill-opacity");if(q.constantOr(1)===0)return;const{isRenderingToTexture:Q}=N,ne=T.colorModeForRenderPass(),he=A.paint.get("fill-pattern"),pe=T.opaquePassEnabledForLayer()&&!he.constantOr(1)&&Z.constantOr(f.bq.transparent).a===1&&q.constantOr(0)===1?"opaque":"translucent";if(T.renderPass===pe){const de=T.getDepthModeForSublayer(1,T.renderPass==="opaque"?_n.ReadWrite:_n.ReadOnly);Eo(T,C,A,z,de,ne,!1,Q)}if(T.renderPass==="translucent"&&A.paint.get("fill-antialias")){const de=T.getDepthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,_n.ReadOnly);Eo(T,C,A,z,de,ne,!0,Q)}})(t,a,c,p,b):f.cs(c)?(function(T,C,A,z,N){const Z=A.paint.get("fill-extrusion-opacity");if(Z===0)return;const{isRenderingToTexture:q}=N;if(T.renderPass==="translucent"){const Q=new _n(T.context.gl.LEQUAL,_n.ReadWrite,T.depthRangeFor3D);if(Z!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))Mo(T,C,A,z,Q,Pn.disabled,$n.disabled,q),Mo(T,C,A,z,Q,T.stencilModeFor3D(),T.colorModeForRenderPass(),q);else{const ne=T.colorModeForRenderPass();Mo(T,C,A,z,Q,Pn.disabled,ne,q)}}})(t,a,c,p,b):f.ct(c)?(function(T,C,A,z,N){if(T.renderPass!=="offscreen"&&T.renderPass!=="translucent")return;const{isRenderingToTexture:Z}=N,q=T.context,Q=T.style.projection.useSubdivision,ne=T.getDepthModeForSublayer(0,_n.ReadOnly),he=T.colorModeForRenderPass();if(T.renderPass==="offscreen")(function(pe,de,me,Ee,_e,Ce,Ae){const be=pe.context,ze=be.gl;for(const $e of me){const Ze=de.getTile($e),We=Ze.dem;if(!We||!We.data||!Ze.needsHillshadePrepare)continue;const Qe=We.dim,mt=We.stride,kt=We.getPixels();if(be.activeTexture.set(ze.TEXTURE1),be.pixelStoreUnpackPremultiplyAlpha.set(!1),Ze.demTexture=Ze.demTexture||pe.getTileTexture(mt),Ze.demTexture){const Wt=Ze.demTexture;Wt.update(kt,{premultiply:!1}),Wt.bind(ze.NEAREST,ze.CLAMP_TO_EDGE)}else Ze.demTexture=new f.T(be,kt,ze.RGBA,{premultiply:!1}),Ze.demTexture.bind(ze.NEAREST,ze.CLAMP_TO_EDGE);be.activeTexture.set(ze.TEXTURE0);let dt=Ze.fbo;if(!dt){const Wt=new f.T(be,{width:Qe,height:Qe,data:null},ze.RGBA);Wt.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),dt=Ze.fbo=be.createFramebuffer(Qe,Qe,!0,!1),dt.colorAttachment.set(Wt.texture)}be.bindFramebuffer.set(dt.framebuffer),be.viewport.set([0,0,Qe,Qe]),pe.useProgram("hillshadePrepare").draw(be,ze.TRIANGLES,_e,Ce,Ae,vn.disabled,uh(Ze.tileID,We),null,null,Ee.id,pe.rasterBoundsBuffer,pe.quadTriangleIndexBuffer,pe.rasterBoundsSegments),Ze.needsHillshadePrepare=!1}})(T,C,z,A,ne,Pn.disabled,he),q.viewport.set([0,0,T.width,T.height]);else if(T.renderPass==="translucent")if(Q){const[pe,de,me]=T.stencilConfigForOverlapTwoPass(z);Co(T,C,A,me,pe,ne,he,!1,Z),Co(T,C,A,me,de,ne,he,!0,Z)}else{const[pe,de]=T.getStencilConfigForOverlapAndUpdateStencilID(z);Co(T,C,A,de,pe,ne,he,!1,Z)}})(t,a,c,p,b):f.cu(c)?(function(T,C,A,z,N){if(T.renderPass!=="translucent"||!z.length)return;const{isRenderingToTexture:Z}=N,q=T.style.projection.useSubdivision,Q=T.getDepthModeForSublayer(0,_n.ReadOnly),ne=T.colorModeForRenderPass();if(q){const[he,pe,de]=T.stencilConfigForOverlapTwoPass(z);Xo(T,C,A,de,he,Q,ne,!1,Z),Xo(T,C,A,de,pe,Q,ne,!0,Z)}else{const[he,pe]=T.getStencilConfigForOverlapAndUpdateStencilID(z);Xo(T,C,A,pe,he,Q,ne,!1,Z)}})(t,a,c,p,b):f.bV(c)?(function(T,C,A,z,N){if(T.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!z.length)return;const{isRenderingToTexture:Z}=N,q=C.getSource(),Q=T.style.projection.useSubdivision;if(q instanceof wr)Ds(T,C,A,z,null,!1,!1,q.tileCoords,q.flippedWindingOrder,Z);else if(Q){const[ne,he,pe]=T.stencilConfigForOverlapTwoPass(z);Ds(T,C,A,pe,ne,!1,!0,$o,!1,Z),Ds(T,C,A,pe,he,!0,!0,$o,!1,Z)}else{const[ne,he]=T.getStencilConfigForOverlapAndUpdateStencilID(z);Ds(T,C,A,he,ne,!1,!0,$o,!1,Z)}})(t,a,c,p,b):f.cv(c)?(function(T,C,A,z,N){const Z=A.paint.get("background-color"),q=A.paint.get("background-opacity");if(q===0)return;const{isRenderingToTexture:Q}=N,ne=T.context,he=ne.gl,pe=T.style.projection,de=T.transform,me=de.tileSize,Ee=A.paint.get("background-pattern");if(T.isPatternMissing(Ee))return;const _e=!Ee&&Z.a===1&&q===1&&T.opaquePassEnabledForLayer()?"opaque":"translucent";if(T.renderPass!==_e)return;const Ce=Pn.disabled,Ae=T.getDepthModeForSublayer(0,_e==="opaque"?_n.ReadWrite:_n.ReadOnly),be=T.colorModeForRenderPass(),ze=T.useProgram(Ee?"backgroundPattern":"background"),$e=z||Ci(de,{tileSize:me,terrain:T.style.map.terrain});Ee&&(ne.activeTexture.set(he.TEXTURE0),T.imageManager.bind(T.context));const Ze=A.getCrossfadeParameters();for(const We of $e){const Qe=de.getProjectionData({overscaledTileID:We,applyGlobeMatrix:!Q,applyTerrainMatrix:!0}),mt=Ee?g(q,T,Ee,{tileID:We,tileSize:me},Ze):u(q,Z),kt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(We),dt=pe.getMeshFromTileID(ne,We.canonical,!1,!0,"raster");ze.draw(ne,he.TRIANGLES,Ae,Ce,be,vn.backCCW,mt,kt,Qe,A.id,dt.vertexBuffer,dt.indexBuffer,dt.segments)}})(t,0,c,p,b):f.cw(c)&&(function(T,C,A,z){const{isRenderingGlobe:N}=z,Z=T.context,q=A.implementation,Q=T.style.projection,ne=T.transform,he=ne.getProjectionDataForCustomLayer(N),pe={farZ:ne.farZ,nearZ:ne.nearZ,fov:ne.fov*Math.PI/180,modelViewProjectionMatrix:ne.modelViewProjectionMatrix,projectionMatrix:ne.projectionMatrix,shaderData:{variantName:Q.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Q.shaderPreludeCode.vertexSource}`,define:Q.shaderDefine},defaultProjectionData:he},de=q.renderingMode?q.renderingMode:"2d";if(T.renderPass==="offscreen"){const me=q.prerender;me&&(T.setCustomLayerDefaults(),Z.setColorMode(T.colorModeForRenderPass()),me.call(q,Z.gl,pe),Z.setDirty(),T.setBaseState())}else if(T.renderPass==="translucent"){T.setCustomLayerDefaults(),Z.setColorMode(T.colorModeForRenderPass()),Z.setStencilMode(Pn.disabled);const me=de==="3d"?T.getDepthModeFor3D():T.getDepthModeForSublayer(0,_n.ReadOnly);Z.setDepthMode(me),q.render(Z.gl,pe),Z.setDirty(),T.setBaseState(),Z.bindFramebuffer.set(null)}})(t,0,c,b))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!a||!c}useProgram(t,a,c=!1,p=[]){this.cache=this.cache||{};const b=!!this.style.map.terrain,T=this.style.projection,C=c?ki.projectionMercator:T.shaderPreludeCode,A=c?Li:T.shaderDefine,z=t+(a?a.cacheKey:"")+`/${c?An:T.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(b?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[z]||(this.cache[z]=new oh(this.context,ki[t],a,P[t],this._showOverdrawInspector,b,C,A,p)),this.cache[z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new f.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const c in this._tileTextures){const p=this._tileTextures[c];if(p)for(const b of p)b.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const c in this.cache){const p=this.cache[c];p&&p.program&&this.context.gl.deleteProgram(p.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function cf(v,t){let a,c=!1,p=null,b=null;const T=()=>{p=null,c&&(v.apply(b,a),p=setTimeout(T,t),c=!1)};return(...C)=>(c=!0,b=this,a=C,p||T(),p)}class Xi{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let c;return a.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(c=p)})),(c&&c[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:c,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const c=a.join("/");let p=c;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${c}`);let b=window.location.hash.replace(p,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let T=window.location.href.replace(/(#.+)?$/,b);T=T.replace("&&","&"),window.history.replaceState(window.history.state,null,T)},this._updateHash=cf(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,p),T=Math.round(a.lng*b)/b,C=Math.round(a.lat*b)/b,A=this._map.getBearing(),z=this._map.getPitch();let N="";if(N+=t?`/${T}/${C}/${c}`:`${c}/${C}/${T}`,(A||z)&&(N+="/"+Math.round(10*A)/10),z&&(N+=`/${Math.round(z)}`),this._hashName){const Z=this._hashName;let q=!1;const Q=window.location.hash.slice(1).split("&").map((ne=>{const he=ne.split("=")[0];return he===Z?(q=!0,`${he}=${N}`):ne})).filter((ne=>ne));return q||Q.push(`${Z}=${N}`),`#${Q.join("&")}`}return`#${N}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new f.V(+t[2],+t[1])}catch{return!1}const a=+t[0],c=+(t[3]||0),p=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&c>=-180&&c<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const Cl={linearity:.3,easing:f.cx(0,0,.3,1)},xa=f.e({deceleration:2500,maxSpeed:1400},Cl),Ra=f.e({deceleration:20,maxSpeed:1400},Cl),yh=f.e({deceleration:1e3,maxSpeed:360},Cl),ba=f.e({deceleration:1e3,maxSpeed:90},Cl),Uu=f.e({deceleration:1e3,maxSpeed:360},Cl);class ju{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:at(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=at();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new f.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,a.roll+=b.rollDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(a.pan.mag()){const b=Ac(a.pan.mag(),c,f.e({},xa,t||{})),T=a.pan.mult(b.amount/a.pan.mag()),C=this._map.cameraHelper.handlePanInertia(T,this._map.transform);p.center=C.easingCenter,p.offset=C.easingOffset,Gu(p,b)}if(a.zoom){const b=Ac(a.zoom,c,Ra);p.zoom=this._map.transform.zoom+b.amount,Gu(p,b)}if(a.bearing){const b=Ac(a.bearing,c,yh);p.bearing=this._map.transform.bearing+f.ao(b.amount,-179,179),Gu(p,b)}if(a.pitch){const b=Ac(a.pitch,c,ba);p.pitch=this._map.transform.pitch+b.amount,Gu(p,b)}if(a.roll){const b=Ac(a.roll,c,Uu);p.roll=this._map.transform.roll+f.ao(b.amount,-179,179),Gu(p,b)}if(p.zoom||p.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;p.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),f.e(p,{noMoveStart:!0})}}function Gu(v,t){(!v.duration||v.duration<t.duration)&&(v.duration=t.duration,v.easing=t.easing)}function Ac(v,t,a){const{maxSpeed:c,linearity:p,deceleration:b}=a,T=f.ao(v*p/(t/1e3),-c,c),C=Math.abs(T)/(b*p);return{easing:a.easing,duration:1e3*C,amount:T*(C/2)}}class Xa extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c,p={}){c=c instanceof MouseEvent?c:new MouseEvent(t,c);const b=Ie.mousePos(a.getCanvas(),c),T=a.unproject(b);super(t,f.e({point:b,lngLat:T,originalEvent:c},p)),this._defaultPrevented=!1,this.target=a}}class $s extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){const p=t==="touchend"?c.changedTouches:c.touches,b=Ie.touchPos(a.getCanvasContainer(),p),T=b.map((A=>a.unproject(A))),C=b.reduce(((A,z,N,Z)=>A.add(z.div(Z.length))),new f.P(0,0));super(t,{points:b,point:C,lngLats:T,lngLat:a.unproject(C),originalEvent:c}),this._defaultPrevented=!1}}class kc extends f.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}}class Il{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new kc(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Xa(t.type,this._map,t))}mouseup(t){this._map.fire(new Xa(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Xa(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Xa(t.type,this._map,t))}mouseover(t){this._map.fire(new Xa(t.type,this._map,t))}mouseout(t){this._map.fire(new Xa(t.type,this._map,t))}touchstart(t){return this._firePreventable(new $s(t.type,this._map,t))}touchmove(t){this._map.fire(new $s(t.type,this._map,t))}touchend(t){this._map.fire(new $s(t.type,this._map,t))}touchcancel(t){this._map.fire(new $s(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ko{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Xa(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Xa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Xa(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bt{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(f.P.convert(t),this._map.terrain)}}class Dc{constructor(t,a){this._map=t,this._tr=new Bt(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ie.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const c=a;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=c,this._box||(this._box=Ie.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(p.x,c.x),T=Math.max(p.x,c.x),C=Math.min(p.y,c.y),A=Math.max(p.y,c.y);Ie.setTransform(this._box,`translate(${b}px,${C}px)`),this._box.style.width=T-b+"px",this._box.style.height=A-C+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const c=this._startPos,p=a;if(this.reset(),Ie.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new f.l("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(c,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Ie.remove(this._box),this._box=null),Ie.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new f.l(t,{originalEvent:a}))}}function Al(v,t){if(v.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${t.length}`);const a={};for(let c=0;c<v.length;c++)a[v[c].identifier]=t[c];return a}class Pc{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=(function(p){const b=new f.P(0,0);for(const T of p)b._add(T);return b.div(p.length)})(a),this.touches=Al(c,a)))}touchmove(t,a,c){if(this.aborted||!this.centroid)return;const p=Al(c,a);for(const b in this.touches){const T=p[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,a,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class kl{constructor(t){this.singleTap=new Pc(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,c){this.singleTap.touchstart(t,a,c)}touchmove(t,a,c){this.singleTap.touchmove(t,a,c)}touchend(t,a,c){const p=this.singleTap.touchend(t,a,c);if(p){const b=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(p)<30;if(b&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class qu{constructor(t){this._tr=new Bt(t),this._zoomIn=new kl({numTouches:1,numTaps:2}),this._zoomOut=new kl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,c){this._zoomIn.touchstart(t,a,c),this._zoomOut.touchstart(t,a,c)}touchmove(t,a,c){this._zoomIn.touchmove(t,a,c),this._zoomOut.touchmove(t,a,c)}touchend(t,a,c){const p=this._zoomIn.touchend(t,a,c),b=this._zoomOut.touchend(t,a,c),T=this._tr;return p?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(p)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ps{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const c=this._lastPoint;if(!c)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const p=Array.isArray(a)?a[0]:a;return!this._moved&&p.dist(c)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(c,p))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Ie.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const au=0,vh=2,hf={[au]:1,[vh]:2};class Rs{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=Ie.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,c){const p=hf[c];return a.buttons===void 0||(a.buttons&p)!==p})(t,this._eventButton)}isValidEndEvent(t){return Ie.mouseButton(t)===this._eventButton}}class Rc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Lc{constructor(t=new Rs({checkCorrectEvent:()=>!0}),a=new Rc){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,c){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?c(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Dl=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=t=>{t.preventDefault()}};class xh{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new f.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,c){return this._calculateTransform(t,a,c)}touchmove(t,a,c){if(this._active){if(!this._shouldBePrevented(c.length))return t.preventDefault(),this._calculateTransform(t,a,c);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,c){this._calculateTransform(t,a,c),this._active&&this._shouldBePrevented(c.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,c){c.length>0&&(this._active=!0);const p=Al(c,a),b=new f.P(0,0),T=new f.P(0,0);let C=0;for(const z in p){const N=p[z],Z=this._touches[z];Z&&(b._add(N),T._add(N.sub(Z)),C++,p[z]=N)}if(this._touches=p,this._shouldBePrevented(C)||!T.mag())return;const A=T.div(C);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(C),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,c){if(!this._firstTwoTouches)return;t.preventDefault();const[p,b]=this._firstTwoTouches,T=Do(c,a,p),C=Do(c,a,b);if(!T||!C)return;const A=this._aroundCenter?null:T.add(C).div(2);return this._move([T,C],A,t)}touchend(t,a,c){if(!this._firstTwoTouches)return;const[p,b]=this._firstTwoTouches,T=Do(c,a,p),C=Do(c,a,b);T&&C||(this._active&&Ie.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Do(v,t,a){for(let c=0;c<v.length;c++)if(v[c].identifier===a)return t[c]}function bh(v,t){return Math.log(v/t)/Math.LN2}class Ko extends zc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(bh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bh(this._distance,c),pinchAround:a}}}function wh(v,t){return 180*v.angleWith(t)/Math.PI}class Ws extends zc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,c){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:wh(this._vector,p),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,c=wh(t,this._startVector);return Math.abs(c)<a}}function qn(v){return Math.abs(v.y)>Math.abs(v.x)}class Jo extends zc{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,c){super.touchstart(t,a,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,qn(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,c){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),b=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,b,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,c){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,b=a.mag()>=2;if(!p&&!b)return;if(!p||!b)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const T=t.y>0==a.y>0;return qn(t)&&qn(a)&&T}}const Pl={panStep:100,bearingStep:15,pitchStep:10};class su{constructor(t){this._tr=new Bt(t);const a=Pl;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,c=0,p=0,b=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:C=>{const A=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Oc,zoom:a?Math.round(A.zoom)+a*(t.shiftKey?2:1):A.zoom,bearing:A.bearing+c*this._bearingStep,pitch:A.pitch+p*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:A.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Oc(v){return v*(2-v)}const ou=4.000244140625,Zu=1/450;class Th{constructor(t,a){this._onTimeout=c=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)},this._map=t,this._tr=new Bt(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Zu}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=at(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,a!==0&&a%ou==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Ie.mousePos(this._map.getCanvas(),t),c=this._tr;this._aroundPoint=this._aroundCenter?c.transform.locationToScreenPoint(f.V.convert(c.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const C=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=C),typeof this._targetZoom=="number"&&(this._targetZoom+=C)}if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>ou?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&A!==0&&(A=1/A);const z=typeof this._targetZoom!="number"?t.scale:f.ar(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),f.au(z*A)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,c=this._startZoom,p=this._easing;let b,T=!1;if(this._type==="wheel"&&c&&p){const C=at()-this._lastWheelEventTime,A=Math.min((C+5)/200,1),z=p(A);b=f.G.number(c,a,z),A<1?this._frameId||(this._frameId=!0):T=!0}else b=a,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=b,{noInertia:!0,needsRenderFrame:!T,zoomDelta:b-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=f.cz;if(this._prevEase){const c=this._prevEase,p=(at()-c.start)/c.duration,b=c.easing(p+.01)-c.easing(p),T=.27/Math.sqrt(b*b+1e-4)*.01,C=Math.sqrt(.0729-T*T);a=f.cx(T,C,.25,1)}return this._prevEase={start:at(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ff{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class La{constructor(t){this._tr=new Bt(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lu{constructor(){this._tap=new kl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,c){if(!this._swipePoint)if(this._tapTime){const p=a[0],b=t.timeStamp-this._tapTime<500,T=this._tapPoint.dist(p)<30;b&&T?c.length>0&&(this._swipePoint=p,this._swipeTouch=c[0].identifier):this.reset()}else this._tap.touchstart(t,a,c)}touchmove(t,a,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const p=a[0],b=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,a,c)}touchend(t,a,c){if(this._tapTime)this._swipePoint&&c.length===0&&this.reset();else{const p=this._tap.touchend(t,a,c);p&&(this._tapTime=t.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Kt{constructor(t,a,c){this._el=t,this._mousePan=a,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class cn{constructor(t,a,c,p){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=c,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Rl{constructor(t,a,c,p){this._el=t,this._touchZoom=a,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class za{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Ie.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const c=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=a,this._container.appendChild(p);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=c,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Ie.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new f.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const ea=v=>v.zoom||v.drag||v.roll||v.pitch||v.rotate;class cr extends f.l{}function Oa(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta||v.rollDelta}class df{constructor(t,a){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,b)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=p.type==="renderFrame"?void 0:p,C={needsRenderFrame:!1},A={},z={};for(const{handlerName:q,handler:Q,allowed:ne}of this._handlers){if(!Q.isEnabled())continue;let he;if(this._blockedByActive(z,ne,q))Q.reset();else if(Q[b||p.type]){if(f.cA(p,b||p.type)){const pe=Ie.mousePos(this._map.getCanvas(),p);he=Q[b||p.type](p,pe)}else if(f.cB(p,b||p.type)){const pe=this._getMapTouches(p.touches),de=Ie.touchPos(this._map.getCanvas(),pe);he=Q[b||p.type](p,de,pe)}else f.cC(b||p.type)||(he=Q[b||p.type](p));this.mergeHandlerResult(C,A,he,q,T),he&&he.needsRenderFrame&&this._triggerRenderFrame()}(he||Q.isActive())&&(z[q]=Q)}const N={};for(const q in this._previousActiveHandlers)z[q]||(N[q]=T);this._previousActiveHandlers=z,(Object.keys(N).length||Oa(C))&&(this._changes.push([C,A,N]),this._triggerRenderFrame()),(Object.keys(z).length||Oa(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=C;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ju(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,b,T]of this._listeners)Ie.addEventListener(p,b,p===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[t,a,c]of this._listeners)Ie.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const a=this._map,c=a.getCanvasContainer();this._add("mapEvent",new Il(a,t));const p=a.boxZoom=new Dc(a,t);this._add("boxZoom",p),t.interactive&&t.boxZoom&&p.enable();const b=a.cooperativeGestures=new za(a,t.cooperativeGestures);this._add("cooperativeGestures",b),t.cooperativeGestures&&b.enable();const T=new qu(a),C=new La(a);a.doubleClickZoom=new ff(C,T),this._add("tapZoom",T),this._add("clickZoom",C),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const A=new lu;this._add("tapDragZoom",A);const z=a.touchPitch=new Jo(a);this._add("touchPitch",z),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const N=()=>a.project(a.getCenter()),Z=(function({enable:_e,clickTolerance:Ce,aroundCenter:Ae=!0,minPixelCenterThreshold:be=100,rotateDegreesPerPixelMoved:ze=.8},$e){const Ze=new Rs({checkCorrectEvent:We=>Ie.mouseButton(We)===0&&We.ctrlKey||Ie.mouseButton(We)===2&&!We.ctrlKey});return new ps({clickTolerance:Ce,move:(We,Qe)=>{const mt=$e();if(Ae&&Math.abs(mt.y-We.y)>be)return{bearingDelta:f.cy(new f.P(We.x,Qe.y),Qe,mt)};let kt=(Qe.x-We.x)*ze;return Ae&&Qe.y<mt.y&&(kt=-kt),{bearingDelta:kt}},moveStateManager:Ze,enable:_e,assignEvents:Dl})})(t,N),q=(function({enable:_e,clickTolerance:Ce,pitchDegreesPerPixelMoved:Ae=-.5}){const be=new Rs({checkCorrectEvent:ze=>Ie.mouseButton(ze)===0&&ze.ctrlKey||Ie.mouseButton(ze)===2});return new ps({clickTolerance:Ce,move:(ze,$e)=>({pitchDelta:($e.y-ze.y)*Ae}),moveStateManager:be,enable:_e,assignEvents:Dl})})(t),Q=(function({enable:_e,clickTolerance:Ce,rollDegreesPerPixelMoved:Ae=.3},be){const ze=new Rs({checkCorrectEvent:$e=>Ie.mouseButton($e)===2&&$e.ctrlKey});return new ps({clickTolerance:Ce,move:($e,Ze)=>{const We=be();let Qe=(Ze.x-$e.x)*Ae;return Ze.y<We.y&&(Qe=-Qe),{rollDelta:Qe}},moveStateManager:ze,enable:_e,assignEvents:Dl})})(t,N);a.dragRotate=new cn(t,Z,q,Q),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",q,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Q,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const ne=(function({enable:_e,clickTolerance:Ce}){const Ae=new Rs({checkCorrectEvent:be=>Ie.mouseButton(be)===0&&!be.ctrlKey});return new ps({clickTolerance:Ce,move:(be,ze)=>({around:ze,panDelta:ze.sub(be)}),activateOnStart:!0,moveStateManager:Ae,enable:_e,assignEvents:Dl})})(t),he=new xh(t,a);a.dragPan=new Kt(c,ne,he),this._add("mousePan",ne),this._add("touchPan",he,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const pe=new Ws,de=new Ko;a.touchZoomRotate=new Rl(c,de,pe,A),this._add("touchRotate",pe,["touchPan","touchZoom"]),this._add("touchZoom",de,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new ko(a));const me=a.scrollZoom=new Th(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",me,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const Ee=a.keyboard=new su(a);this._add("keyboard",Ee),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,c){this._handlers.push({handlerName:t,handler:a,allowed:c}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ea(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,c){for(const p in t)if(p!==c&&(!a||a.indexOf(p)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const c of t)this._el.contains(c.target)&&a.push(c);return a}mergeHandlerResult(t,a,c,p,b){if(!c)return;f.e(t,c);const T={handlerName:p,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(a.zoom=T),c.panDelta!==void 0&&(a.drag=T),c.rollDelta!==void 0&&(a.roll=T),c.pitchDelta!==void 0&&(a.pitch=T),c.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const t={},a={},c={};for(const[p,b,T]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new f.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(t.rollDelta=(t.rollDelta||0)+p.rollDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),f.e(a,b),f.e(c,T);this._updateMapTransform(t,a,c),this._changes=[]}_updateMapTransform(t,a,c){const p=this._map,b=p._getTransformForUpdate(),T=p.terrain;if(!(Oa(t)||T&&this._terrainMovement))return this._fireEvents(a,c,!0);p._stop(!0);let{panDelta:C,zoomDelta:A,bearingDelta:z,pitchDelta:N,rollDelta:Z,around:q,pinchAround:Q}=t;Q!==void 0&&(q=Q),q=q||p.transform.centerPoint,T&&!b.isPointOnMapSurface(q)&&(q=b.centerPoint);const ne={panDelta:C,zoomDelta:A,rollDelta:Z,pitchDelta:N,bearingDelta:z,around:q};this._map.cameraHelper.useGlobeControls&&!b.isPointOnMapSurface(q)&&(q=b.centerPoint);const he=q.distSqr(b.centerPoint)<.01?b.center:b.screenPointToLocation(C?q.sub(C):q);this._handleMapControls({terrain:T,tr:b,deltasForHelper:ne,preZoomAroundLoc:he,combinedEventsInProgress:a,panDelta:C}),p._applyUpdatedTransform(b),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,c,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:c,preZoomAroundLoc:p,combinedEventsInProgress:b,panDelta:T}){const C=this._map.cameraHelper;if(C.handleMapControlsRollPitchBearingZoom(c,a),t)return C.useGlobeControls?(this._terrainMovement||!b.drag&&!b.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void C.handleMapControlsPan(c,a,p)):this._terrainMovement||!b.drag&&!b.zoom?void(b.drag&&this._terrainMovement&&T?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(T))):C.handleMapControlsPan(c,a,p)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void C.handleMapControlsPan(c,a,p));C.handleMapControlsPan(c,a,p)}_fireEvents(t,a,c){const p=ea(this._eventsInProgress),b=ea(t),T={};for(const Z in t){const{originalEvent:q}=t[Z];this._eventsInProgress[Z]||(T[`${Z}start`]=q),this._eventsInProgress[Z]=t[Z]}!p&&b&&this._fireEvent("movestart",b.originalEvent);for(const Z in T)this._fireEvent(Z,T[Z]);b&&this._fireEvent("move",b.originalEvent);for(const Z in t){const{originalEvent:q}=t[Z];this._fireEvent(Z,q)}const C={};let A;for(const Z in this._eventsInProgress){const{handlerName:q,originalEvent:Q}=this._eventsInProgress[Z];this._handlersById[q].isActive()||(delete this._eventsInProgress[Z],A=a[q]||Q,C[`${Z}end`]=A)}for(const Z in C)this._fireEvent(Z,C[Z]);const z=ea(this._eventsInProgress),N=(p||b)&&!z;if(N&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Z=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&Z.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(Z)}if(c&&N){this._updatingCamera=!0;const Z=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=Q=>Q!==0&&-this._bearingSnap<Q&&Q<this._bearingSnap;!Z||!Z.essential&&Oe.prefersReducedMotion?(this._map.fire(new f.l("moveend",{originalEvent:A})),q(this._map.getBearing())&&this._map.resetNorth()):(q(Z.bearing||this._map.getBearing())&&(Z.bearing=0),Z.freezeElevation=!0,this._map.easeTo(Z,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new f.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new cr("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ll extends f.E{constructor(t,a,c){super(),this._renderFrameCallback=()=>{const p=Math.min((at()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=c.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new f.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,c){return t=f.P.convert(t).mult(-1),this.panTo(this.transform.center,f.e({offset:t},a),c)}panTo(t,a,c){return this.easeTo(f.e({center:t},a),c)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,c){return this.easeTo(f.e({zoom:t},a),c)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new f.l("movestart",a)).fire(new f.l("move",a)).fire(new f.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,c){return this.easeTo(f.e({bearing:t},a),c)}resetNorth(t,a){return this.rotateTo(0,f.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(f.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=Ai.convert(t).adjustAntiMeridian();const c=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,a)}_cameraForBoxAndBearing(t,a,c,p){const b={top:0,bottom:0,right:0,left:0};if(typeof(p=f.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const z=p.padding;p.padding={top:z,bottom:z,right:z,left:z}}const T=f.e(b,p.padding);p.padding=T;const C=this.transform,A=new Ai(t,a);return this.cameraHelper.cameraForBoxAndBearing(p,T,A,c,C)}fitBounds(t,a,c){return this._fitInternal(this.cameraForBounds(t,a),a,c)}fitScreenCoordinates(t,a,c,p,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(f.P.convert(t)),this.transform.screenPointToLocation(f.P.convert(a)),c,p),p,b)}_fitInternal(t,a,c){return t?(delete(a=f.e(t,a)).padding,a.linear?this.easeTo(a,c):this.flyTo(a,c)):this}jumpTo(t,a){this.stop();const c=this._getTransformForUpdate();let p=!1,b=!1,T=!1;const C=c.zoom;this.cameraHelper.handleJumpToCenterZoom(c,t);const A=c.zoom!==C;return"elevation"in t&&c.elevation!==+t.elevation&&c.setElevation(+t.elevation),"bearing"in t&&c.bearing!==+t.bearing&&(p=!0,c.setBearing(+t.bearing)),"pitch"in t&&c.pitch!==+t.pitch&&(b=!0,c.setPitch(+t.pitch)),"roll"in t&&c.roll!==+t.roll&&(T=!0,c.setRoll(+t.roll)),t.padding==null||c.isPaddingEqual(t.padding)||c.setPadding(t.padding),this._applyUpdatedTransform(c),this.fire(new f.l("movestart",a)).fire(new f.l("move",a)),A&&this.fire(new f.l("zoomstart",a)).fire(new f.l("zoom",a)).fire(new f.l("zoomend",a)),p&&this.fire(new f.l("rotatestart",a)).fire(new f.l("rotate",a)).fire(new f.l("rotateend",a)),b&&this.fire(new f.l("pitchstart",a)).fire(new f.l("pitch",a)).fire(new f.l("pitchend",a)),T&&this.fire(new f.l("rollstart",a)).fire(new f.l("roll",a)).fire(new f.l("rollend",a)),this.fire(new f.l("moveend",a))}calculateCameraOptionsFromTo(t,a,c,p=0){const b=f.ab.fromLngLat(t,a),T=f.ab.fromLngLat(c,p),C=T.x-b.x,A=T.y-b.y,z=T.z-b.z,N=Math.hypot(C,A,z);if(N===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(C,A),q=f.au(this.transform.cameraToCenterDistance/N/this.transform.tileSize),Q=180*Math.atan2(C,-A)/Math.PI;let ne=180*Math.acos(Z/N)/Math.PI;return ne=z<0?90-ne:90+ne,{center:T.toLngLat(),elevation:p,zoom:q,pitch:ne,bearing:Q}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,c,p,b){const T=this.transform.calculateCenterFromCameraLngLatAlt(t,a,c,p);return{center:T.center,elevation:T.elevation,zoom:T.zoom,bearing:c,pitch:p,roll:b}}easeTo(t,a){this._stop(!1,t.easeId),((t=f.e({offset:[0,0],duration:500,easing:f.cz},t)).animate===!1||!t.essential&&Oe.prefersReducedMotion)&&(t.duration=0);const c=this._getTransformForUpdate(),p=this.getBearing(),b=c.pitch,T=c.roll,C="bearing"in t?this._normalizeBearing(t.bearing,p):p,A="pitch"in t?+t.pitch:b,z="roll"in t?this._normalizeBearing(t.roll,T):T,N="padding"in t?t.padding:c.padding,Z=f.P.convert(t.offset);let q,Q;t.around&&(q=f.V.convert(t.around),Q=c.locationToScreenPoint(q));const ne={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},he=this.cameraHelper.handleEaseTo(c,{bearing:C,pitch:A,roll:z,padding:N,around:q,aroundPoint:Q,offsetAsPoint:Z,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||p!==C,this._pitching=this._pitching||A!==b,this._rolling=this._rolling||z!==T,this._padding=!c.isPaddingEqual(N),this._zooming=this._zooming||he.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,ne),this.terrain&&this._prepareElevation(he.elevationCenter),this._ease((pe=>{he.easeFunc(pe),this.terrain&&!t.freezeElevation&&this._updateElevation(pe),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(pe=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,pe)}),t),this}_prepareEase(t,a,c={}){this._moving=!0,a||c.moving||this.fire(new f.l("movestart",t)),this._zooming&&!c.zooming&&this.fire(new f.l("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new f.l("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new f.l("pitchstart",t)),this._rolling&&!c.rolling&&this.fire(new f.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const c=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(c-(a-(c*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(f.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),c=t.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(c<p){const b=this.calculateCameraOptionsFromTo(a,p,t.center,t.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&a.push((p=>this.transformCameraUpdate(p))),!a.length)return;const c=t.clone();for(const p of a){const b=c.clone(),{center:T,zoom:C,roll:A,pitch:z,bearing:N,elevation:Z}=p(b);T&&b.setCenter(T),Z!==void 0&&b.setElevation(Z),C!==void 0&&b.setZoom(C),A!==void 0&&b.setRoll(A),z!==void 0&&b.setPitch(z),N!==void 0&&b.setBearing(N),c.apply(b)}this.transform.apply(c)}_fireMoveEvents(t){this.fire(new f.l("move",t)),this._zooming&&this.fire(new f.l("zoom",t)),this._rotating&&this.fire(new f.l("rotate",t)),this._pitching&&this.fire(new f.l("pitch",t)),this._rolling&&this.fire(new f.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const c=this._zooming,p=this._rotating,b=this._pitching,T=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,c&&this.fire(new f.l("zoomend",t)),p&&this.fire(new f.l("rotateend",t)),b&&this.fire(new f.l("pitchend",t)),T&&this.fire(new f.l("rollend",t)),this.fire(new f.l("moveend",t))}flyTo(t,a){if(!t.essential&&Oe.prefersReducedMotion){const Qe=f.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(Qe,a)}this.stop(),t=f.e({offset:[0,0],speed:1.2,curve:1.42,easing:f.cz},t);const c=this._getTransformForUpdate(),p=c.bearing,b=c.pitch,T=c.roll,C=c.padding,A="bearing"in t?this._normalizeBearing(t.bearing,p):p,z="pitch"in t?+t.pitch:b,N="roll"in t?this._normalizeBearing(t.roll,T):T,Z="padding"in t?t.padding:c.padding,q=f.P.convert(t.offset);let Q=c.centerPoint.add(q);const ne=c.screenPointToLocation(Q),he=this.cameraHelper.handleFlyTo(c,{bearing:A,pitch:z,roll:N,padding:Z,locationAtOffset:ne,offsetAsPoint:q,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let pe=t.curve;const de=Math.max(c.width,c.height),me=de/he.scaleOfZoom,Ee=he.pixelPathLength;typeof he.scaleOfMinZoom=="number"&&(pe=Math.sqrt(de/he.scaleOfMinZoom/Ee*2));const _e=pe*pe;function Ce(Qe){const mt=(me*me-de*de+(Qe?-1:1)*_e*_e*Ee*Ee)/(2*(Qe?me:de)*_e*Ee);return Math.log(Math.sqrt(mt*mt+1)-mt)}function Ae(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function be(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const ze=Ce(!1);let $e=function(Qe){return be(ze)/be(ze+pe*Qe)},Ze=function(Qe){return de*((be(ze)*(Ae(mt=ze+pe*Qe)/be(mt))-Ae(ze))/_e)/Ee;var mt},We=(Ce(!0)-ze)/pe;if(Math.abs(Ee)<2e-6||!isFinite(We)){if(Math.abs(de-me)<1e-6)return this.easeTo(t,a);const Qe=me<de?-1:1;We=Math.abs(Math.log(me/de))/pe,Ze=()=>0,$e=mt=>Math.exp(Qe*pe*mt)}return t.duration="duration"in t?+t.duration:1e3*We/("screenSpeed"in t?+t.screenSpeed/pe:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==A,this._pitching=z!==b,this._rolling=N!==T,this._padding=!c.isPaddingEqual(Z),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(he.targetCenter),this._ease((Qe=>{const mt=Qe*We,kt=1/$e(mt),dt=Ze(mt);this._rotating&&c.setBearing(f.G.number(p,A,Qe)),this._pitching&&c.setPitch(f.G.number(b,z,Qe)),this._rolling&&c.setRoll(f.G.number(T,N,Qe)),this._padding&&(c.interpolatePadding(C,Z,Qe),Q=c.centerPoint.add(q)),he.easeFunc(Qe,kt,dt,Q),this.terrain&&!t.freezeElevation&&this._updateElevation(Qe),this._applyUpdatedTransform(c),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var c;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,a)}return t||(c=this.handlers)===null||c===void 0||c.stop(!1),this}_ease(t,a,c){c.animate===!1||c.duration===0?(t(1),a()):(this._easeStart=at(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=f.W(t,-180,180);const c=Math.abs(t-a);return Math.abs(t-360-a)<c&&(t-=360),Math.abs(t+360-a)<c&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(f.V.convert(t)):null}}const $a={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class hr{constructor(t=$a){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Ie.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Ie.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ie.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ie.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const c=this._map._getUIString(`AttributionControl.${a}`);t.title=c,t.setAttribute("aria-label",c)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const a=this._map.style.tileManagers;for(const p in a){const b=a[p];if(b.used||b.usedForTerrain){const T=b.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t=t.filter((p=>String(p).trim())),t.sort(((p,b)=>p.length-b.length)),t=t.filter(((p,b)=>{for(let T=b+1;T<t.length;T++)if(t[T].indexOf(p)>=0)return!1;return!0}));const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=Ie.sanitize(c),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class el{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const c=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Ie.create("div","maplibregl-ctrl");const a=Ie.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ie.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class ii{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,c=a?this._queue.concat(a):this._queue;for(const p of c)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const c of a)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var on=f.aV([{name:"a_pos3d",type:"Int16",components:3}]);class Ti extends f.E{constructor(t){super(),this._lastTilesetChange=at(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const c={};for(const p of Ci(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))c[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),f.c8(p.terrainRttPosMatrix32f,0,f.a5,f.a5,0,0,1),this._tiles[p.key]=new ut(p,this.tileSize),this._lastTilesetChange=at());for(const p in this._tiles)c[p]||delete this._tiles[p]}freeRtt(t){for(const a in this._tiles){const c=this._tiles[a];(!t||c.tileID.equals(t)||c.tileID.isChildOf(t)||t.isChildOf(c.tileID))&&(c.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID,b=t.clone(),T=f.bl();if(p.canonical.equals(t.canonical))f.c8(T,0,f.a5,f.a5,0,0,1);else if(p.canonical.isChildOf(t.canonical)){const C=p.canonical.z-t.canonical.z,A=p.canonical.x-(p.canonical.x>>C<<C),z=p.canonical.y-(p.canonical.y>>C<<C),N=f.a5>>C;f.c8(T,0,N,N,0,0,1),f.O(T,T,[-A*N,-z*N,0])}else{if(!t.canonical.isChildOf(p.canonical))continue;{const C=t.canonical.z-p.canonical.z,A=t.canonical.x-(t.canonical.x>>C<<C),z=t.canonical.y-(t.canonical.y>>C<<C),N=f.a5>>C;f.c8(T,0,f.a5,f.a5,0,0,1),f.O(T,T,[A*N,z*N,0]),f.Q(T,T,[1/2**C,1/2**C,0])}}b.terrainRttPosMatrix32f=new Float32Array(T),a[c]=b}return a}_getTerrainCoordsForTileRanges(t,a){const c={};for(const p of this._renderableTilesKeys){const b=this._tiles[p].tileID;if(!this._isWithinTileRanges(b,a))continue;const T=t.clone(),C=f.bl();if(b.canonical.z===t.canonical.z){const A=t.canonical.x-b.canonical.x,z=t.canonical.y-b.canonical.y;f.c8(C,0,f.a5,f.a5,0,0,1),f.O(C,C,[A*f.a5,z*f.a5,0])}else if(b.canonical.z>t.canonical.z){const A=b.canonical.z-t.canonical.z,z=b.canonical.x-(b.canonical.x>>A<<A),N=b.canonical.y-(b.canonical.y>>A<<A),Z=t.canonical.x-(b.canonical.x>>A),q=t.canonical.y-(b.canonical.y>>A),Q=f.a5>>A;f.c8(C,0,Q,Q,0,0,1),f.O(C,C,[-z*Q+Z*f.a5,-N*Q+q*f.a5,0])}else{const A=t.canonical.z-b.canonical.z,z=t.canonical.x-(t.canonical.x>>A<<A),N=t.canonical.y-(t.canonical.y>>A<<A),Z=(t.canonical.x>>A)-b.canonical.x,q=(t.canonical.y>>A)-b.canonical.y,Q=f.a5<<A;f.c8(C,0,Q,Q,0,0,1),f.O(C,C,[z*f.a5+Z*Q,N*f.a5+q*Q,0])}T.terrainRttPosMatrix32f=new Float32Array(C),c[p]=T}return c}getSourceTile(t,a){const c=this.tileManager._source;let p=t.overscaledZ-this.deltaZoom;if(p>c.maxzoom&&(p=c.maxzoom),p<c.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let b=this.findTileInCaches(this._sourceTileCache[t.key]);if(!b?.dem&&a)for(;p>=c.minzoom&&!b?.dem;)b=this.findTileInCaches(t.scaledTo(p--).key);return b}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class $i{constructor(t,a,c){this._meshCache={},this.painter=t,this.tileManager=new Ti(a),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,c,p=f.a5){var b;if(!(a>=0&&a<p&&c>=0&&c<p))return 0;const T=this.getTerrainData(t),C=(b=T.tile)===null||b===void 0?void 0:b.dem;if(!C)return 0;const A=f.cD([],[a/p*f.a5,c/p*f.a5],T.u_terrain_matrix),z=[A[0]*C.dim,A[1]*C.dim],N=Math.floor(z[0]),Z=Math.floor(z[1]),q=z[0]-N,Q=z[1]-Z;return C.get(N,Z)*(1-q)*(1-Q)+C.get(N+1,Z)*q*(1-Q)+C.get(N,Z+1)*(1-q)*Q+C.get(N+1,Z+1)*q*Q}getElevationForLngLatZoom(t,a){if(!f.cE(a,t.wrap()))return 0;const{tileID:c,mercatorX:p,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(c,p%f.a5,b%f.a5,f.a5)}getElevationForLngLat(t){return this.getElevationForLngLatZoom(t,this.tileManager.maxzoom)}getElevation(t,a,c,p=f.a5){return this.getDEMElevation(t,a,c,p)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.painter.context,b=new f.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new f.T(p,b,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new f.T(p,new f.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=f.as([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const p=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new f.T(p,a.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),a.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const c=a&&a+a.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const p=this.tileManager.getSource().maxzoom;let b=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?b=t.canonical.z-p:f.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=t.canonical.x-(t.canonical.x>>b<<b),C=t.canonical.y-(t.canonical.y>>b<<b),A=f.cF(new Float64Array(16),[1/(f.a5<<b),1/(f.a5<<b),0]);f.O(A,A,[T*f.a5,C*f.a5,0]),this._demMatrixCache[t.key]={matrix:A,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,c=a.width/devicePixelRatio,p=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new f.T(a.context,{width:c,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new f.T(a.context,{width:c,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(c,p,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,c,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,T=0;b<this._coordsTextureSize;b++)for(let C=0;C<this._coordsTextureSize;C++,T+=4)a[T+0]=255&C,a[T+1]=255&b,a[T+2]=C>>8<<4|b>>8,a[T+3]=0;const c=new f.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),p=new f.T(t,c,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),c=this.painter.context,p=c.gl,b=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),T=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);c.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(b,C-T-1,1,1,p.RGBA,p.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null);const A=a[0]+(a[2]>>4<<8),z=a[1]+((15&a[2])<<8),N=this.coordsIndex[255-a[3]],Z=N&&this.tileManager.getTileByID(N);if(!Z)return null;const q=this._coordsTextureSize,Q=(1<<Z.tileID.canonical.z)*q;return new f.ab((Z.tileID.canonical.x*q+A)/Q+Z.tileID.wrap,(Z.tileID.canonical.y*q+z)/Q,this.getElevation(Z.tileID,A,z,q))}depthAtPoint(t){const a=new Uint8Array(4),c=this.painter.context,p=c.gl;return c.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,a),c.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const c=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,p=c&&t.canonical.y===0,b=c&&t.canonical.y===(1<<t.canonical.z)-1,T=`m_${p?"n":""}_${b?"s":""}`;if(this._meshCache[T])return this._meshCache[T];const C=this.painter.context,A=new f.cG,z=new f.aZ,N=this.meshSize,Z=f.a5/N,q=N*N;for(let be=0;be<=N;be++)for(let ze=0;ze<=N;ze++)A.emplaceBack(ze*Z,be*Z,0);for(let be=0;be<q;be+=N+1)for(let ze=0;ze<N;ze++)z.emplaceBack(ze+be,N+ze+be+1,N+ze+be+2),z.emplaceBack(ze+be,N+ze+be+2,ze+be+1);const Q=A.length,ne=Q+(N+1),he=(N+1)*N,pe=p?f.bs:0,de=p?0:1,me=b?f.bt:f.a5,Ee=b?0:1;for(let be=0;be<=N;be++)A.emplaceBack(be*Z,pe,de);for(let be=0;be<=N;be++)A.emplaceBack(be*Z,me,Ee);for(let be=0;be<N;be++)z.emplaceBack(he+be,ne+be,ne+be+1),z.emplaceBack(he+be,ne+be+1,he+be+1),z.emplaceBack(0+be,Q+be+1,Q+be),z.emplaceBack(0+be,0+be+1,Q+be+1);const _e=A.length,Ce=_e+2*(N+1);for(const be of[0,1])for(let ze=0;ze<=N;ze++)for(const $e of[0,1])A.emplaceBack(be*f.a5,ze*Z,$e);for(let be=0;be<2*N;be+=2)z.emplaceBack(_e+be,_e+be+1,_e+be+3),z.emplaceBack(_e+be,_e+be+3,_e+be+2),z.emplaceBack(Ce+be,Ce+be+3,Ce+be+1),z.emplaceBack(Ce+be,Ce+be+2,Ce+be+3);const Ae=new Qn(C.createVertexBuffer(A,on.members),C.createIndexBuffer(z),f.aY.simpleSegment(0,0,A.length,z.length));return this._meshCache[T]=Ae,Ae}getMeshFrameDelta(t){return 2*Math.PI*f.bF/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var c;if(!f.cE(a,t.wrap()))return 0;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(c=this.getMinMaxElevation(p).minElevation)!==null&&c!==void 0?c:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return a&&a.dem&&(c.minElevation=a.dem.min*this.exaggeration,c.maxElevation=a.dem.max*this.exaggeration),c}_getOverscaledTileIDFromLngLatZoom(t,a){const c=f.ab.fromLngLat(t.wrap()),p=(1<<a)*f.a5,b=c.x*p,T=c.y*p,C=Math.floor(b/f.a5),A=Math.floor(T/f.a5);return{tileID:new f.a2(a,0,a,C,A),mercatorX:b,mercatorY:T}}}class uu{constructor(t,a,c){this._context=t,this._size=a,this._tileSize=c,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),c=new f.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return c.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(c.texture),{id:t,fbo:a,texture:c,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const ms={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class tl{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new uu(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((c=>!t._layers[c].isHidden(a))),this._coordsAscending={};for(const c in t.tileManagers){this._coordsAscending[c]={};const p=t.tileManagers[c].getVisibleCoordinates(),b=t.tileManagers[c].getSource(),T=b instanceof wr?b.terrainTileRanges:null;for(const C of p){const A=this.terrain.tileManager.getTerrainCoords(C,T);for(const z in A)this._coordsAscending[c][z]||(this._coordsAscending[c][z]=[]),this._coordsAscending[c][z].push(A[z])}}this._coordsAscendingStr={};for(const c of t._order){const p=t._layers[c],b=p.source;if(ms[p.type]&&!this._coordsAscendingStr[b]){this._coordsAscendingStr[b]={};for(const T in this._coordsAscending[b])this._coordsAscendingStr[b][T]=this._coordsAscending[b][T].map((C=>C.key)).sort().join()}}for(const c of this._renderableTiles)for(const p in this._coordsAscendingStr){const b=this._coordsAscendingStr[p][c.tileID.key];b&&b!==c.rttCoords[p]&&(c.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const c=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),p=t.type,b=this.painter,T=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ms[p]&&(this._prevType&&ms[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(t.id),!T))return!0;if(ms[this._prevType]||ms[p]&&T){this._prevType=p;const C=this._stacks.length-1,A=this._stacks[C]||[];for(const z of this._renderableTiles){if(this.pool.isFull()&&(_h(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(z),z.rtt[C]){const Z=this.pool.getObjectForId(z.rtt[C].id);if(Z.stamp===z.rtt[C].stamp){this.pool.useObject(Z);continue}}const N=this.pool.getOrCreateFreeObject();this.pool.useObject(N),this.pool.stampObject(N),z.rtt[C]={id:N.id,stamp:N.stamp},b.context.bindFramebuffer.set(N.fbo.framebuffer),b.context.clear({color:f.bq.transparent,stencil:0}),b.currentStencilSource=void 0;for(let Z=0;Z<A.length;Z++){const q=b.style._layers[A[Z]],Q=q.source?this._coordsAscending[q.source][z.tileID.key]:[z.tileID];b.context.viewport.set([0,0,N.fbo.width,N.fbo.height]),b._renderTileClippingMasks(q,Q,!0),b.renderLayer(b,b.style.tileManagers[q.source],q,Q,c),q.source&&(z.rttCoords[q.source]=this._coordsAscendingStr[q.source][z.tileID.key])}}return _h(this.painter,this.terrain,this._rttTiles,c),this._rttTiles=[],this.pool.freeAllObjects(),ms[p]}return!1}}const Yu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},nl=ue,il={hash:!1,interactive:!0,bearingSnap:7,attributionControl:$a,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:f.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},pf={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Wi{constructor(t,a,c=!1){this.mousedown=b=>{this.startMove(b,Ie.mousePos(this.element,b)),Ie.addEventListener(window,"mousemove",this.mousemove),Ie.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.move(b,Ie.mousePos(this.element,b))},this.mouseup=b=>{this._rotatePitchHandler.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ie.touchPos(this.element,b.targetTouches)[0],this.startMove(b,this._startPos),Ie.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ie.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=Ie.touchPos(this.element,b.targetTouches)[0],this.move(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const p=new Lc;this._rotatePitchHandler=new ps({clickTolerance:3,move:(b,T)=>{const C=a.getBoundingClientRect(),A=new f.P((C.bottom-C.top)/2,(C.right-C.left)/2);return{bearingDelta:f.cy(new f.P(b.x,T.y),T,A),pitchDelta:c?-.5*(T.y-b.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=t,Ie.addEventListener(a,"mousedown",this.mousedown),Ie.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),Ie.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),Ie.disableDrag()}move(t,a){const c=this.map,{bearingDelta:p,pitchDelta:b}=this._rotatePitchHandler.dragMove(t,a)||{};p&&c.setBearing(c.getBearing()+p),b&&c.setPitch(c.getPitch()+b)}off(){const t=this.element;Ie.removeEventListener(t,"mousedown",this.mousedown),Ie.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ie.removeEventListener(window,"touchend",this.touchend),Ie.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Ie.enableDrag(),Ie.removeEventListener(window,"mousemove",this.mousemove),Ie.removeEventListener(window,"mouseup",this.mouseup),Ie.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ie.removeEventListener(window,"touchend",this.touchend)}}let Qs;function Hu(v,t,a,c=!1){if(c||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return v?.wrap();const p=new f.V(v.lng,v.lat);if(v=new f.V(v.lng,v.lat),t){const b=new f.V(v.lng-360,v.lat),T=new f.V(v.lng+360,v.lat),C=a.locationToScreenPoint(v).distSqr(t);a.locationToScreenPoint(b).distSqr(t)<C?v=b:a.locationToScreenPoint(T).distSqr(t)<C&&(v=T)}for(;Math.abs(v.lng-a.center.lng)>180;){const b=a.locationToScreenPoint(v);if(b.x>=0&&b.y>=0&&b.x<=a.width&&b.y<=a.height)break;v.lng>a.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(v))?v:p}const Xu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Nc(v,t,a){const c=v.classList;for(const p in Xu)c.remove(`maplibregl-${a}-anchor-${p}`);c.add(`maplibregl-${a}-anchor-${t}`)}class Bc extends f.E{constructor(t){if(super(),this._onKeyPress=a=>{const c=a.code,p=a.charCode||a.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=a=>{const c=a.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=Hu(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),Ie.setTransform(this._element,`${Xu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${p}`),Oe.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new f.l("dragstart"))),this.fire(new f.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new f.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=f.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ie.create("div");const a=Ie.createNS("http://www.w3.org/2000/svg","svg"),c=41,p=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${c}px`),a.setAttributeNS(null,"width",`${p}px`),a.setAttributeNS(null,"viewBox",`0 0 ${p} ${c}`);const b=Ie.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const T=Ie.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const C=Ie.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const de of A){const me=Ie.createNS("http://www.w3.org/2000/svg","ellipse");me.setAttributeNS(null,"opacity","0.04"),me.setAttributeNS(null,"cx","10.5"),me.setAttributeNS(null,"cy","5.80029008"),me.setAttributeNS(null,"rx",de.rx),me.setAttributeNS(null,"ry",de.ry),C.appendChild(me)}const z=Ie.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill",this._color);const N=Ie.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),z.appendChild(N);const Z=Ie.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const q=Ie.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(q);const Q=Ie.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Q.setAttributeNS(null,"fill","#FFFFFF");const ne=Ie.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"transform","translate(8.0, 8.0)");const he=Ie.createNS("http://www.w3.org/2000/svg","circle");he.setAttributeNS(null,"fill","#000000"),he.setAttributeNS(null,"opacity","0.25"),he.setAttributeNS(null,"cx","5.5"),he.setAttributeNS(null,"cy","5.5"),he.setAttributeNS(null,"r","5.4999962");const pe=Ie.createNS("http://www.w3.org/2000/svg","circle");pe.setAttributeNS(null,"fill","#FFFFFF"),pe.setAttributeNS(null,"cx","5.5"),pe.setAttributeNS(null,"cy","5.5"),pe.setAttributeNS(null,"r","5.4999962"),ne.appendChild(he),ne.appendChild(pe),T.appendChild(C),T.appendChild(z),T.appendChild(Z),T.appendChild(Q),T.appendChild(ne),a.appendChild(T),a.setAttributeNS(null,"height",c*this._scale+"px"),a.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(a),this._offset=f.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),Nc(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ie.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=f.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,c;const p=(a=this._map)===null||a===void 0?void 0:a.terrain,b=this._map.transform.isLocationOccluded(this._lngLat);if(!p||b){const Q=b?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Q&&(this._element.style.opacity=Q))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const T=this._map,C=T.terrain.depthAtPoint(this._pos),A=T.terrain.getElevationForLngLat(this._lngLat);if(T.transform.lngLatToCameraDepth(this._lngLat,A)-C<.006)return void(this._element.style.opacity=this._opacity);const z=-this._offset.y/T.transform.pixelsPerMeter,N=Math.sin(T.getPitch()*Math.PI/180)*z,Z=T.terrain.depthAtPoint(new f.P(this._pos.x,this._pos.y-this._offset.y)),q=T.transform.lngLatToCameraDepth(this._lngLat,A+N)-Z>.006;!((c=this._popup)===null||c===void 0)&&c.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=f.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Fc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let rl=0,al=!1;const da={maxWidth:100,unit:"metric"};function Fi(v,t,a){const c=a&&a.maxWidth||100,p=v._container.clientHeight/2,b=v._container.clientWidth/2,T=v.unproject([b-c/2,p]),C=v.unproject([b+c/2,p]),A=Math.round(v.project(C).x-v.project(T).x),z=Math.min(c,A,v._container.clientWidth),N=T.distanceTo(C);if(a&&a.unit==="imperial"){const Z=3.2808*N;Z>5280?Po(t,z,Z/5280,v._getUIString("ScaleControl.Miles")):Po(t,z,Z,v._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?Po(t,z,N/1852,v._getUIString("ScaleControl.NauticalMiles")):N>=1e3?Po(t,z,N/1e3,v._getUIString("ScaleControl.Kilometers")):Po(t,z,N,v._getUIString("ScaleControl.Meters"))}function Po(v,t,a,c){const p=(function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let C=b/T;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:(function(A){const z=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*z)/z})(C),T*C})(a);v.style.width=t*(p/a)+"px",v.innerHTML=`${p}&nbsp;${c}`}const cu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},$u=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wu(v){if(v){if(typeof v=="number"){const t=Math.round(Math.abs(v)/Math.SQRT2);return{center:new f.P(0,0),top:new f.P(0,v),"top-left":new f.P(t,t),"top-right":new f.P(-t,t),bottom:new f.P(0,-v),"bottom-left":new f.P(t,-t),"bottom-right":new f.P(-t,-t),left:new f.P(v,0),right:new f.P(-v,0)}}if(v instanceof f.P||Array.isArray(v)){const t=f.P.convert(v);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:f.P.convert(v.center||[0,0]),top:f.P.convert(v.top||[0,0]),"top-left":f.P.convert(v["top-left"]||[0,0]),"top-right":f.P.convert(v["top-right"]||[0,0]),bottom:f.P.convert(v.bottom||[0,0]),"bottom-left":f.P.convert(v["bottom-left"]||[0,0]),"bottom-right":f.P.convert(v["bottom-right"]||[0,0]),left:f.P.convert(v.left||[0,0]),right:f.P.convert(v.right||[0,0])}}return Wu(new f.P(0,0))}const Ks=ue;L.AJAXError=f.cJ,L.Event=f.l,L.Evented=f.E,L.LngLat=f.V,L.MercatorCoordinate=f.ab,L.Point=f.P,L.addProtocol=f.cK,L.config=f.c,L.removeProtocol=f.cL,L.AttributionControl=hr,L.BoxZoomHandler=Dc,L.CanvasSource=te,L.CooperativeGesturesHandler=za,L.DoubleClickZoomHandler=ff,L.DragPanHandler=Kt,L.DragRotateHandler=cn,L.EdgeInsets=la,L.FullscreenControl=class extends f.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:f.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Ie.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=Ie.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Ie.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new f.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new f.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},L.GeoJSONSource=ln,L.GeolocateControl=class extends f.E{constructor(v){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new f.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new f.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new f.V(t.coords.longitude,t.coords.latitude),c=t.coords.accuracy,p=this._map.getBearing(),b=f.e({bearing:p},this.options.fitBoundsOptions),T=Ai.fromLngLat(a,c);this._map.fitBounds(T,b,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new f.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&al)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new f.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Ie.create("button","maplibregl-ctrl-geolocate",this._container),Ie.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){f.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ie.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Bc({element:this._dotElement}),this._circleElement=Ie.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const c=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new f.l("trackuserlocationend")),this.fire(new f.l("userlocationlostfocus")))}))}},this.options=f.e({},Fc,v)}onAdd(v){return this._map=v,this._container=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return f._(this,arguments,void 0,(function*(t=!1){if(Qs!==void 0&&!t)return Qs;if(window.navigator.permissions===void 0)return Qs=!!window.navigator.geolocation,Qs;try{Qs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Qs=!!window.navigator.geolocation}return Qs}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ie.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,rl=0,al=!1}_isOutOfMapMaxBounds(v){const t=this._map.getMaxBounds(),a=v.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const v=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&v))return;const t=this._map.project(v),a=this._map.unproject([t.x+100,t.y]),c=v.distanceTo(a)/100,p=2*this._accuracy/c;this._circleElement.style.width=`${p.toFixed(2)}px`,this._circleElement.style.height=`${p.toFixed(2)}px`}trigger(){if(!this._setup)return f.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new f.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":rl--,al=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new f.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new f.l("trackuserlocationstart")),this.fire(new f.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),rl++,rl>1?(v={maximumAge:6e5,timeout:0},al=!0):(v=this.options.positionOptions,al=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},L.GlobeControl=class{constructor(){this._toggleProjection=()=>{var v;const t=(v=this._map.getProjection())===null||v===void 0?void 0:v.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var v;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((v=this._map.getProjection())===null||v===void 0?void 0:v.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(v){return this._map=v,this._container=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Ie.create("button","maplibregl-ctrl-globe",this._container),Ie.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Ie.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},L.Hash=Xi,L.ImageSource=wr,L.KeyboardHandler=su,L.LngLatBounds=Ai,L.LogoControl=el,L.Map=class extends Ll{constructor(v){var t,a;f.cH.mark(f.cI.create);const c=Object.assign(Object.assign(Object.assign({},il),v),{canvasContextAttributes:Object.assign(Object.assign({},il.canvasContextAttributes),v.canvasContextAttributes)});if(c.minZoom!=null&&c.maxZoom!=null&&c.minZoom>c.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(c.minPitch!=null&&c.maxPitch!=null&&c.minPitch>c.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(c.minPitch!=null&&c.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(c.maxPitch!=null&&c.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new nr,b=new ua;if(c.minZoom!==void 0&&p.setMinZoom(c.minZoom),c.maxZoom!==void 0&&p.setMaxZoom(c.maxZoom),c.minPitch!==void 0&&p.setMinPitch(c.minPitch),c.maxPitch!==void 0&&p.setMaxPitch(c.maxPitch),c.renderWorldCopies!==void 0&&p.setRenderWorldCopies(c.renderWorldCopies),c.transformConstrain!==null&&p.setConstrainOverride(c.transformConstrain),super(p,b,{bearingSnap:c.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new ii,this._controls=[],this._mapId=f.ah(),this._lostContextStyle={style:null,images:null},this._contextLost=C=>{C.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const A of Object.values(this.style._layers))if(A.type==="custom"&&console.warn(`Custom layer with id '${A.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),A._listeners)for(const[z]of Object.entries(A._listeners))console.warn(`Custom layer with id '${A.id}' had event listeners for event '${z}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new f.l("webglcontextlost",{originalEvent:C}))},this._contextRestored=C=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new f.l("webglcontextrestored",{originalEvent:C}))},this._onMapScroll=C=>{if(C.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=c.interactive,this._maxTileCacheSize=c.maxTileCacheSize,this._maxTileCacheZoomLevels=c.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},c.canvasContextAttributes),this._trackResize=c.trackResize===!0,this._bearingSnap=c.bearingSnap,this._centerClampedToGround=c.centerClampedToGround,this._refreshExpiredTiles=c.refreshExpiredTiles===!0,this._fadeDuration=c.fadeDuration,this._crossSourceCollisions=c.crossSourceCollisions===!0,this._collectResourceTiming=c.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Yu),c.locale),this._clickTolerance=c.clickTolerance,this._overridePixelRatio=c.pixelRatio,this._maxCanvasSize=c.maxCanvasSize,this._zoomLevelsToOverscale=c.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=c.transformCameraUpdate,this.transformConstrain=c.transformConstrain,this.cancelPendingTileRequestsWhileZooming=c.cancelPendingTileRequestsWhileZooming===!0,c.reduceMotion!==void 0&&(Oe.prefersReducedMotion=c.reduceMotion),this._imageQueueHandle=_t.addThrottleControl((()=>this.isMoving())),this._requestManager=new Gt(c.transformRequest),typeof c.container=="string"){if(this._container=document.getElementById(c.container),!this._container)throw new Error(`Container '${c.container}' not found.`)}else{if(!(c.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=c.container}if(c.maxBounds&&this.setMaxBounds(c.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let C=!1;const A=cf((z=>{this._trackResize&&!this._removed&&(this.resize(z),this.redraw())}),50);this._resizeObserver=new ResizeObserver((z=>{C?A(z):C=!0})),this._resizeObserver.observe(this._container)}this.handlers=new df(this,c),this._hash=c.hash&&new Xi(typeof c.hash=="string"&&c.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:c.center,elevation:c.elevation,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,roll:c.roll}),c.bounds&&(this.resize(),this.fitBounds(c.bounds,f.e({},c.fitBoundsOptions,{duration:0}))));const T=typeof c.style=="string"||((a=(t=c.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,T),this._localIdeographFontFamily=c.localIdeographFontFamily,this._validateStyle=c.validateStyle,c.style&&this.setStyle(c.style,{localIdeographFontFamily:c.localIdeographFontFamily}),c.attributionControl&&this.addControl(new hr(typeof c.attributionControl=="boolean"?void 0:c.attributionControl)),c.maplibreLogo&&this.addControl(new el,c.logoPosition),this.on("style.load",(()=>{if(T||this._resizeTransform(),this.transform.unmodified){const C=f.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(C)}})),this.on("data",(C=>{this._update(C.dataType==="style"),this.fire(new f.l(`${C.dataType}data`,C))})),this.on("dataloading",(C=>{this.fire(new f.l(`${C.dataType}dataloading`,C))})),this.on("dataabort",(C=>{this.fire(new f.l("sourcedataabort",C))}))}_getMapId(){return this._mapId}setGlobalStateProperty(v,t){return this.style.setGlobalStateProperty(v,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(v,t){if(t===void 0&&(t=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new f.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=v.onAdd(this);this._controls.push(v);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(a,c.firstChild):c.appendChild(a),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new f.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(v);return t>-1&&this._controls.splice(t,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}coveringTiles(v){return Ci(this.transform,v)}calculateCameraOptionsFromTo(v,t,a,c){return c==null&&this.terrain&&(c=this.terrain.getElevationForLngLat(a)),super.calculateCameraOptionsFromTo(v,t,a,c)}resize(v,t=!0){const[a,c]=this._containerDimensions(),p=this._getClampedPixelRatio(a,c);if(this._resizeCanvas(a,c,p),this.painter.resize(a,c,p),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const C=this._getClampedPixelRatio(a,c);this._resizeCanvas(a,c,C),this.painter.resize(a,c,C)}this._resizeTransform(t);const b=!this._moving;return b&&(this.stop(),this.fire(new f.l("movestart",v)).fire(new f.l("move",v))),this.fire(new f.l("resize",v)),b&&this.fire(new f.l("moveend",v)),this}_resizeTransform(v=!0){var t;const[a,c]=this._containerDimensions();this.transform.resize(a,c,v),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,c,v)}_getClampedPixelRatio(v,t){const{0:a,1:c}=this._maxCanvasSize,p=this.getPixelRatio(),b=v*p,T=t*p;return Math.min(b>a?a/b:1,T>c?c/T:1)*p}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Ai.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.setMinZoom(v),this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.setMaxZoom(v),this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.setMinPitch(v),this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(v>=this.transform.minPitch)return this.transform.setMaxPitch(v),this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.setRenderWorldCopies(v),this._update()}setTransformConstrain(v){return this.transform.setConstrainOverride(v),this._update()}project(v){return this.transform.locationToScreenPoint(f.V.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.screenPointToLocation(f.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,t,a){if(v==="mouseenter"||v==="mouseover"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:b=>{const T=t.filter((A=>this.getLayer(A))),C=T.length!==0?this.queryRenderedFeatures(b.point,{layers:T}):[];C.length?c||(c=!0,a.call(this,new Xa(v,this,b.originalEvent,{features:C}))):c=!1},mouseout:()=>{c=!1}}}}if(v==="mouseleave"||v==="mouseout"){let c=!1;return{layers:t,listener:a,delegates:{mousemove:T=>{const C=t.filter((A=>this.getLayer(A)));(C.length!==0?this.queryRenderedFeatures(T.point,{layers:C}):[]).length?c=!0:c&&(c=!1,a.call(this,new Xa(v,this,T.originalEvent)))},mouseout:T=>{c&&(c=!1,a.call(this,new Xa(v,this,T.originalEvent)))}}}}{const c=p=>{const b=t.filter((C=>this.getLayer(C))),T=b.length!==0?this.queryRenderedFeatures(p.point,{layers:b}):[];T.length&&(p.features=T,a.call(this,p),delete p.features)};return{layers:t,listener:a,delegates:{[v]:c}}}}_saveDelegatedListener(v,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(t)}_removeDelegatedListener(v,t,a){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const c=this._delegatedListeners[v];for(let p=0;p<c.length;p++){const b=c[p];if(b.listener===a&&b.layers.length===t.length&&b.layers.every((T=>t.includes(T)))){for(const T in b.delegates)this.off(T,b.delegates[T]);return void c.splice(p,1)}}}on(v,t,a){if(a===void 0)return super.on(v,t);const c=typeof t=="string"?[t]:t,p=this._createDelegatedListener(v,c,a);this._saveDelegatedListener(v,p);for(const b in p.delegates)this.on(b,p.delegates[b]);return{unsubscribe:()=>{this._removeDelegatedListener(v,c,a)}}}once(v,t,a){if(a===void 0)return super.once(v,t);const c=typeof t=="string"?[t]:t,p=this._createDelegatedListener(v,c,a);for(const b in p.delegates){const T=p.delegates[b];p.delegates[b]=(...C)=>{this._removeDelegatedListener(v,c,a),T(...C)}}this._saveDelegatedListener(v,p);for(const b in p.delegates)this.once(b,p.delegates[b]);return this}off(v,t,a){return a===void 0?super.off(v,t):(this._removeDelegatedListener(v,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(v,t){if(!this.style)return[];let a;const c=v instanceof f.P||Array.isArray(v),p=c?v:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(c?{}:v)||{},p instanceof f.P||typeof p[0]=="number")a=[f.P.convert(p)];else{const b=f.P.convert(p[0]),T=f.P.convert(p[1]);a=[b,new f.P(T.x,b.y),T,new f.P(b.x,T.y),b]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(v,t){return this.style.querySourceFeatures(v,t)}setStyle(v,t){return(t=f.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(v,t))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const t=this._locale[v];if(t==null)throw new Error(`Missing UI string '${v}'`);return t}_updateStyle(v,t){var a,c;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(v,t)));const p=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new _o(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,t,p):this.style.loadJSON(v,t,p),this):((c=(a=this.style)===null||a===void 0?void 0:a.projection)===null||c===void 0||c.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new _o(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,t){if(typeof v=="string"){const a=this._requestManager.transformRequest(v,"Style");f.j(a,new AbortController).then((c=>{this._updateDiff(c.data,t)})).catch((c=>{c&&this.fire(new f.k(c))}))}else typeof v=="object"&&this._updateDiff(v,t)}_updateDiff(v,t){try{this.style.setState(v,t)&&this._update(!0)}catch(a){f.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(v,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():f.w("There is no style added to the map.")}addSource(v,t){return this._lazyInitEmptyStyle(),this.style.addSource(v,t),this._update(!0)}isSourceLoaded(v){const t=this.style&&this.style.tileManagers[v];if(t!==void 0)return t.loaded();this.fire(new f.k(new Error(`There is no tile manager with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const t=this.style.tileManagers[v.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const c=this.style._layers[a];c.type==="hillshade"&&c.source===v.source&&f.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),c.type==="color-relief"&&c.source===v.source&&f.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new $i(this.painter,t,v),this.painter.renderToTexture=new tl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var c;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==v.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((c=a.source)===null||c===void 0?void 0:c.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new f.l("terrain",{terrain:v})),this}getTerrain(){var v,t;return(t=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const v=this.style&&this.style.tileManagers;for(const t of Object.values(v))if(!t.areTilesLoaded())return!1;return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}setSourceTileLodParams(v,t,a){if(a){const c=this.getSource(a);if(!c)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);c.calculateTileZoom=xt(Math.max(1,v),Math.max(1,t))}else for(const c in this.style.tileManagers)this.style.tileManagers[c].getSource().calculateTileZoom=xt(Math.max(1,v),Math.max(1,t));return this._update(!0),this}refreshTiles(v,t){const a=this.style.tileManagers[v];if(!a)throw new Error(`There is no tile manager with ID "${v}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((c=>new f.ae(c.z,c.x,c.y))))}addImage(v,t,a={}){const{pixelRatio:c=1,sdf:p=!1,stretchX:b,stretchY:T,content:C,textFitWidth:A,textFitHeight:z}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||f.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new f.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:N,height:Z,data:q}=t,Q=t;return this.style.addImage(v,{data:new f.R({width:N,height:Z},new Uint8Array(q)),pixelRatio:c,stretchX:b,stretchY:T,content:C,textFitWidth:A,textFitHeight:z,sdf:p,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,v),this}}{const{width:N,height:Z,data:q}=Oe.getImageData(t);this.style.addImage(v,{data:new f.R({width:N,height:Z},q),pixelRatio:c,stretchX:b,stretchY:T,content:C,textFitWidth:A,textFitHeight:z,sdf:p,version:0})}}updateImage(v,t){const a=this.style.getImage(v);if(!a)return this.fire(new f.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||f.b(t)?Oe.getImageData(t):t,{width:p,height:b,data:T}=c;if(p===void 0||b===void 0)return this.fire(new f.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==a.data.width||b!==a.data.height)return this.fire(new f.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(t instanceof HTMLImageElement||f.b(t));return a.data.replace(T,C),this.style.updateImage(v,a),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new f.k(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return _t.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,t){return this._lazyInitEmptyStyle(),this.style.addLayer(v,t),this._update(!0)}moveLayer(v,t){return this.style.moveLayer(v,t),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,t,a){return this.style.setLayerZoomRange(v,t,a),this._update(!0)}setFilter(v,t,a={}){return this.style.setFilter(v,t,a),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,t,a,c={}){return this.style.setPaintProperty(v,t,a,c),this._update(!0)}getPaintProperty(v,t){return this.style.getPaintProperty(v,t)}setLayoutProperty(v,t,a,c={}){return this.style.setLayoutProperty(v,t,a,c),this._update(!0)}getLayoutProperty(v,t){return this.style.getLayoutProperty(v,t)}setGlyphs(v,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,t,a,(c=>{c||this._update(!0)})),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,t,(a=>{a||this._update(!0)})),this}setLight(v,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(v,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(v,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,t){return this.style.setFeatureState(v,t),this._update()}removeFeatureState(v,t){return this.style.removeFeatureState(v,t),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,t=0;return this._container&&(v=this._container.clientWidth||400,t=this._container.clientHeight||300),[v,t]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const t=this._canvasContainer=Ie.create("div","maplibregl-canvas-container",v);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Ie.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),c=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],c);const p=this._controlContainer=Ie.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((T=>{b[T]=Ie.create("div",`maplibregl-ctrl-${T} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,t,a){this._canvas.width=Math.floor(a*v),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const v=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(c=>{t={requestedAttributes:v},c&&(t.statusMessage=c.statusMessage,t.type=c.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,v):this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v),!a){const c="Failed to initialize WebGL";throw t?(t.message=c,new Error(JSON.stringify(t))):new Error(c)}this.painter=new od(a,this.transform),Et.testSupport(a)}migrateProjection(v,t){super.migrateProjection(v,t),this.painter.transform=v,this.fire(new f.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){var t,a,c,p,b;const T=this._idleTriggered?this._fadeDuration:0,C=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let A=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Z=this.transform.zoom,q=at();this.style.zoomHistory.update(Z,q);const Q=new f.H(Z,{now:q,fadeDuration:T,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ne=Q.crossFadingFactor();ne===1&&ne===this._crossFadingFactor||(A=!0,this._crossFadingFactor=ne),this.style.update(Q)}const z=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==C;(c=this.style.projection)===null||c===void 0||c.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(b=this.style.projection)===null||b===void 0?void 0:b.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||z)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,z),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,showPadding:this.showPadding}),this.fire(new f.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,f.cH.mark(f.cI.load),this.fire(new f.l("load"))),this.style&&(this.style.hasTransitions()||A)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const N=this._sourcesDirty||this._styleDirty||this._placementDirty;return N||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new f.l("idle")),!this._loaded||this._fullyLoaded||N||(this._fullyLoaded=!0,f.cH.mark(f.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),_t.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ie.remove(this._canvasContainer),Ie.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),f.cH.clearMetrics(),this._removed=!0,this.fire(new f.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Oe.frame(this._frameRequest,(v=>{f.cH.frame(v),this._frameRequest=null;try{this._render(v)}catch(t){if(!f.Z(t)&&!(function(a){return a.message===El})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return nl}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),this.style.setProjection(v),this._update(!0)}},L.MapMouseEvent=Xa,L.MapTouchEvent=$s,L.MapWheelEvent=kc,L.Marker=Bc,L.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),c=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const c=this._map._getUIString(`NavigationControl.${a}`);t.title=c,t.setAttribute("aria-label",c)},this.options=f.e({},pf,v),this._container=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),Ie.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),Ie.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=Ie.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wi(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ie.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,t){const a=Ie.create("button",v,this._container);return a.type="button",a.addEventListener("click",t),a}},L.Popup=class extends f.E{constructor(v){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Ie.remove(this._content),this._container&&(Ie.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new f.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Ie.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Ie.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Hu(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let c=this.options.anchor;const p=Wu(this.options.offset);if(!c){const T=this._container.offsetWidth,C=this._container.offsetHeight;let A;A=a.y+p.bottom.y<C?["top"]:a.y>this._map.transform.height-C?["bottom"]:[],a.x<T/2?A.push("left"):a.x>this._map.transform.width-T/2&&A.push("right"),c=A.length===0?"bottom":A.join("-")}let b=a.add(p[c]);this.options.subpixelPositioning||(b=b.round()),Ie.setTransform(this._container,`${Xu[c]} translate(${b.x}px,${b.y}px)`),Nc(this._container,c,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=f.e(Object.create(cu),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new f.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=f.V.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const t=document.createDocumentFragment(),a=document.createElement("body");let c;for(a.innerHTML=v;c=a.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ie.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ie.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector($u);v&&v.focus()}},L.RasterDEMTileSource=rs,L.RasterTileSource=Us,L.ScaleControl=class{constructor(v){this._onMove=()=>{Fi(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Fi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},da),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ie.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},L.ScrollZoomHandler=Th,L.Style=_o,L.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=Ie.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ie.create("button","maplibregl-ctrl-terrain",this._container),Ie.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ie.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},L.TwoFingersTouchPitchHandler=Jo,L.TwoFingersTouchRotateHandler=Ws,L.TwoFingersTouchZoomHandler=Ko,L.TwoFingersTouchZoomRotateHandler=Rl,L.VectorTileSource=Dt,L.VideoSource=je,L.addSourceType=(v,t)=>f._(void 0,void 0,void 0,(function*(){if(oe(v))throw new Error(`A source type called "${v}" already exists.`);((a,c)=>{J[a]=c})(v,t)})),L.clearPrewarmedResources=function(){const v=Rn;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Ct),Rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},L.createTileMesh=yc,L.getMaxParallelImageRequests=function(){return f.c.MAX_PARALLEL_IMAGE_REQUESTS},L.getRTLTextPluginStatus=function(){return Ve().getRTLTextPluginStatus()},L.getVersion=function(){return Ks},L.getWorkerCount=function(){return en.workerCount},L.getWorkerUrl=function(){return f.c.WORKER_URL},L.importScriptInWorkers=function(v){return rn().broadcast("IS",v)},L.isTimeFrozen=function(){return Fe.isFrozen()},L.now=at,L.prewarm=function(){yi().acquire(Ct)},L.restoreNow=function(){Fe.restoreNow()},L.setMaxParallelImageRequests=function(v){f.c.MAX_PARALLEL_IMAGE_REQUESTS=v},L.setNow=function(v){Fe.setNow(v)},L.setRTLTextPlugin=function(v,t){return Ve().setRTLTextPlugin(v,t)},L.setWorkerCount=function(v){en.workerCount=v},L.setWorkerUrl=function(v){f.c.WORKER_URL=v}}));var ee=Y;return ee}))})(Sg)),Sg.exports}var _m=Cv();const Iv=Dy(_m),Av=gv({__proto__:null,default:Iv},[_m]);var Fs=63710088e-1,Ly={centimeters:Fs*100,centimetres:Fs*100,degrees:360/(2*Math.PI),feet:Fs*3.28084,inches:Fs*39.37,kilometers:Fs/1e3,kilometres:Fs/1e3,meters:Fs,metres:Fs,miles:Fs/1609.344,millimeters:Fs*1e3,millimetres:Fs*1e3,nauticalmiles:Fs/1852,radians:1,yards:Fs*1.0936};function sp(R,B,Y={}){const F={type:"Feature"};return(Y.id===0||Y.id)&&(F.id=Y.id),Y.bbox&&(F.bbox=Y.bbox),F.properties=B||{},F.geometry=R,F}function id(R,B,Y={}){if(!R)throw new Error("coordinates is required");if(!Array.isArray(R))throw new Error("coordinates must be an Array");if(R.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Q_(R[0])||!Q_(R[1]))throw new Error("coordinates must contain numbers");return sp({type:"Point",coordinates:R},B,Y)}function tp(R,B,Y={}){for(const U of R){if(U.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(U[U.length-1].length!==U[0].length)throw new Error("First and last Position are not equivalent.");for(let ee=0;ee<U[U.length-1].length;ee++)if(U[U.length-1][ee]!==U[0][ee])throw new Error("First and last Position are not equivalent.")}return sp({type:"Polygon",coordinates:R},B,Y)}function zy(R,B,Y={}){if(R.length<2)throw new Error("coordinates must be an array of two or more positions");return sp({type:"LineString",coordinates:R},B,Y)}function Ig(R,B={}){const Y={type:"FeatureCollection"};return B.id&&(Y.id=B.id),B.bbox&&(Y.bbox=B.bbox),Y.features=R,Y}function kv(R,B,Y={}){return sp({type:"MultiLineString",coordinates:R},B,Y)}function Dv(R,B,Y={}){return sp({type:"MultiPolygon",coordinates:R},B,Y)}function Oy(R,B="kilometers"){const Y=Ly[B];if(!Y)throw new Error(B+" units is invalid");return R*Y}function Ny(R,B="kilometers"){const Y=Ly[B];if(!Y)throw new Error(B+" units is invalid");return R/Y}function W_(R){return R%(2*Math.PI)*180/Math.PI}function nd(R){return R%360*Math.PI/180}function Q_(R){return!isNaN(R)&&R!==null&&!Array.isArray(R)}function ym(R){if(!R)throw new Error("coord is required");if(!Array.isArray(R)){if(R.type==="Feature"&&R.geometry!==null&&R.geometry.type==="Point")return[...R.geometry.coordinates];if(R.type==="Point")return[...R.coordinates]}if(Array.isArray(R)&&R.length>=2&&!Array.isArray(R[0])&&!Array.isArray(R[1]))return[...R];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Pv(R){if(Array.isArray(R))return R;if(R.type==="Feature"){if(R.geometry!==null)return R.geometry.coordinates}else if(R.coordinates)return R.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function zg(R){return R.type==="Feature"?R.geometry:R}function Rv(R,B,Y,F={}){const U=ym(R),ee=nd(U[0]),L=nd(U[1]),f=nd(Y),ue=Ny(B,F.units),ge=Math.asin(Math.sin(L)*Math.cos(ue)+Math.cos(L)*Math.sin(ue)*Math.cos(f)),Te=ee+Math.atan2(Math.sin(f)*Math.sin(ue)*Math.cos(L),Math.cos(ue)-Math.sin(L)*Math.sin(ge)),ce=W_(Te),Pe=W_(ge);return U[2]!==void 0?id([ce,Pe,U[2]],F.properties):id([ce,Pe],F.properties)}function Lv(R,B,Y={}){var F=ym(R),U=ym(B),ee=nd(U[1]-F[1]),L=nd(U[0]-F[0]),f=nd(F[1]),ue=nd(U[1]),ge=Math.pow(Math.sin(ee/2),2)+Math.pow(Math.sin(L/2),2)*Math.cos(f)*Math.cos(ue);return Oy(2*Math.atan2(Math.sqrt(ge),Math.sqrt(1-ge)),Y.units)}function By(R,B,Y){if(R!==null)for(var F,U,ee,L,f,ue,ge,Te=0,ce=0,Pe,Oe=R.type,Fe=Oe==="FeatureCollection",at=Oe==="Feature",Ie=Fe?R.features.length:1,Et=0;Et<Ie;Et++){ge=Fe?R.features[Et].geometry:at?R.geometry:R,Pe=ge?ge.type==="GeometryCollection":!1,f=Pe?ge.geometries.length:1;for(var vt=0;vt<f;vt++){var rt=0,At=0;if(L=Pe?ge.geometries[vt]:ge,L!==null){ue=L.coordinates;var Mt=L.type;switch(Te=0,Mt){case null:break;case"Point":if(B(ue,ce,Et,rt,At)===!1)return!1;ce++,rt++;break;case"LineString":case"MultiPoint":for(F=0;F<ue.length;F++){if(B(ue[F],ce,Et,rt,At)===!1)return!1;ce++,Mt==="MultiPoint"&&rt++}Mt==="LineString"&&rt++;break;case"Polygon":case"MultiLineString":for(F=0;F<ue.length;F++){for(U=0;U<ue[F].length-Te;U++){if(B(ue[F][U],ce,Et,rt,At)===!1)return!1;ce++}Mt==="MultiLineString"&&rt++,Mt==="Polygon"&&At++}Mt==="Polygon"&&rt++;break;case"MultiPolygon":for(F=0;F<ue.length;F++){for(At=0,U=0;U<ue[F].length;U++){for(ee=0;ee<ue[F][U].length-Te;ee++){if(B(ue[F][U][ee],ce,Et,rt,At)===!1)return!1;ce++}At++}rt++}break;case"GeometryCollection":for(F=0;F<L.geometries.length;F++)if(By(L.geometries[F],B)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function K_(R,B){if(R.type==="Feature")B(R,0);else if(R.type==="FeatureCollection")for(var Y=0;Y<R.features.length&&B(R.features[Y],Y)!==!1;Y++);}function I_(R,B){var Y,F,U,ee,L,f,ue,ge,Te,ce,Pe=0,Oe=R.type==="FeatureCollection",Fe=R.type==="Feature",at=Oe?R.features.length:1;for(Y=0;Y<at;Y++){for(f=Oe?R.features[Y].geometry:Fe?R.geometry:R,ge=Oe?R.features[Y].properties:Fe?R.properties:{},Te=Oe?R.features[Y].bbox:Fe?R.bbox:void 0,ce=Oe?R.features[Y].id:Fe?R.id:void 0,ue=f?f.type==="GeometryCollection":!1,L=ue?f.geometries.length:1,U=0;U<L;U++){if(ee=ue?f.geometries[U]:f,ee===null){if(B(null,Pe,ge,Te,ce)===!1)return!1;continue}switch(ee.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(B(ee,Pe,ge,Te,ce)===!1)return!1;break}case"GeometryCollection":{for(F=0;F<ee.geometries.length;F++)if(B(ee.geometries[F],Pe,ge,Te,ce)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}Pe++}}function zv(R,B,Y){var F=Y;return I_(R,function(U,ee,L,f,ue){F=B(F,U,ee,L,f,ue)}),F}function J_(R){return zv(R,(B,Y)=>B+Ov(Y),0)}function Ov(R){let B=0,Y;switch(R.type){case"Polygon":return ey(R.coordinates);case"MultiPolygon":for(Y=0;Y<R.coordinates.length;Y++)B+=ey(R.coordinates[Y]);return B;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function ey(R){let B=0;if(R&&R.length>0){B+=Math.abs(ty(R[0]));for(let Y=1;Y<R.length;Y++)B-=Math.abs(ty(R[Y]))}return B}var Nv=Fs*Fs/2,g_=Math.PI/180;function ty(R){const B=R.length-1;if(B<=2)return 0;let Y=0,F=0;for(;F<B;){const U=R[F],ee=R[F+1===B?0:F+1],L=R[F+2>=B?(F+2)%B:F+2],f=U[0]*g_,ue=ee[1]*g_,ge=L[0]*g_;Y+=(ge-f)*Math.sin(ue),F++}return Y*Nv}function Bv(R,B={}){if(R.bbox!=null&&B.recompute!==!0)return R.bbox;const Y=[1/0,1/0,-1/0,-1/0];return By(R,F=>{Y[0]>F[0]&&(Y[0]=F[0]),Y[1]>F[1]&&(Y[1]=F[1]),Y[2]<F[0]&&(Y[2]=F[0]),Y[3]<F[1]&&(Y[3]=F[1])}),Y}const th=11102230246251565e-32,Bs=134217729,Fv=(3+8*th)*th;function __(R,B,Y,F,U){let ee,L,f,ue,ge=B[0],Te=F[0],ce=0,Pe=0;Te>ge==Te>-ge?(ee=ge,ge=B[++ce]):(ee=Te,Te=F[++Pe]);let Oe=0;if(ce<R&&Pe<Y)for(Te>ge==Te>-ge?(L=ge+ee,f=ee-(L-ge),ge=B[++ce]):(L=Te+ee,f=ee-(L-Te),Te=F[++Pe]),ee=L,f!==0&&(U[Oe++]=f);ce<R&&Pe<Y;)Te>ge==Te>-ge?(L=ee+ge,ue=L-ee,f=ee-(L-ue)+(ge-ue),ge=B[++ce]):(L=ee+Te,ue=L-ee,f=ee-(L-ue)+(Te-ue),Te=F[++Pe]),ee=L,f!==0&&(U[Oe++]=f);for(;ce<R;)L=ee+ge,ue=L-ee,f=ee-(L-ue)+(ge-ue),ge=B[++ce],ee=L,f!==0&&(U[Oe++]=f);for(;Pe<Y;)L=ee+Te,ue=L-ee,f=ee-(L-ue)+(Te-ue),Te=F[++Pe],ee=L,f!==0&&(U[Oe++]=f);return(ee!==0||Oe===0)&&(U[Oe++]=ee),Oe}function Vv(R,B){let Y=B[0];for(let F=1;F<R;F++)Y+=B[F];return Y}function xm(R){return new Float64Array(R)}const Uv=(3+16*th)*th,jv=(2+12*th)*th,Gv=(9+64*th)*th*th,ep=xm(4),ny=xm(8),iy=xm(12),ry=xm(16),oo=xm(4);function qv(R,B,Y,F,U,ee,L){let f,ue,ge,Te,ce,Pe,Oe,Fe,at,Ie,Et,vt,rt,At,Mt,Lt,_t,Gt;const Ft=R-U,xn=Y-U,dn=B-ee,sn=F-ee;At=Ft*sn,Pe=Bs*Ft,Oe=Pe-(Pe-Ft),Fe=Ft-Oe,Pe=Bs*sn,at=Pe-(Pe-sn),Ie=sn-at,Mt=Fe*Ie-(At-Oe*at-Fe*at-Oe*Ie),Lt=dn*xn,Pe=Bs*dn,Oe=Pe-(Pe-dn),Fe=dn-Oe,Pe=Bs*xn,at=Pe-(Pe-xn),Ie=xn-at,_t=Fe*Ie-(Lt-Oe*at-Fe*at-Oe*Ie),Et=Mt-_t,ce=Mt-Et,ep[0]=Mt-(Et+ce)+(ce-_t),vt=At+Et,ce=vt-At,rt=At-(vt-ce)+(Et-ce),Et=rt-Lt,ce=rt-Et,ep[1]=rt-(Et+ce)+(ce-Lt),Gt=vt+Et,ce=Gt-vt,ep[2]=vt-(Gt-ce)+(Et-ce),ep[3]=Gt;let En=Vv(4,ep),Rt=jv*L;if(En>=Rt||-En>=Rt||(ce=R-Ft,f=R-(Ft+ce)+(ce-U),ce=Y-xn,ge=Y-(xn+ce)+(ce-U),ce=B-dn,ue=B-(dn+ce)+(ce-ee),ce=F-sn,Te=F-(sn+ce)+(ce-ee),f===0&&ue===0&&ge===0&&Te===0)||(Rt=Gv*L+Fv*Math.abs(En),En+=Ft*Te+sn*f-(dn*ge+xn*ue),En>=Rt||-En>=Rt))return En;At=f*sn,Pe=Bs*f,Oe=Pe-(Pe-f),Fe=f-Oe,Pe=Bs*sn,at=Pe-(Pe-sn),Ie=sn-at,Mt=Fe*Ie-(At-Oe*at-Fe*at-Oe*Ie),Lt=ue*xn,Pe=Bs*ue,Oe=Pe-(Pe-ue),Fe=ue-Oe,Pe=Bs*xn,at=Pe-(Pe-xn),Ie=xn-at,_t=Fe*Ie-(Lt-Oe*at-Fe*at-Oe*Ie),Et=Mt-_t,ce=Mt-Et,oo[0]=Mt-(Et+ce)+(ce-_t),vt=At+Et,ce=vt-At,rt=At-(vt-ce)+(Et-ce),Et=rt-Lt,ce=rt-Et,oo[1]=rt-(Et+ce)+(ce-Lt),Gt=vt+Et,ce=Gt-vt,oo[2]=vt-(Gt-ce)+(Et-ce),oo[3]=Gt;const fn=__(4,ep,4,oo,ny);At=Ft*Te,Pe=Bs*Ft,Oe=Pe-(Pe-Ft),Fe=Ft-Oe,Pe=Bs*Te,at=Pe-(Pe-Te),Ie=Te-at,Mt=Fe*Ie-(At-Oe*at-Fe*at-Oe*Ie),Lt=dn*ge,Pe=Bs*dn,Oe=Pe-(Pe-dn),Fe=dn-Oe,Pe=Bs*ge,at=Pe-(Pe-ge),Ie=ge-at,_t=Fe*Ie-(Lt-Oe*at-Fe*at-Oe*Ie),Et=Mt-_t,ce=Mt-Et,oo[0]=Mt-(Et+ce)+(ce-_t),vt=At+Et,ce=vt-At,rt=At-(vt-ce)+(Et-ce),Et=rt-Lt,ce=rt-Et,oo[1]=rt-(Et+ce)+(ce-Lt),Gt=vt+Et,ce=Gt-vt,oo[2]=vt-(Gt-ce)+(Et-ce),oo[3]=Gt;const Je=__(fn,ny,4,oo,iy);At=f*Te,Pe=Bs*f,Oe=Pe-(Pe-f),Fe=f-Oe,Pe=Bs*Te,at=Pe-(Pe-Te),Ie=Te-at,Mt=Fe*Ie-(At-Oe*at-Fe*at-Oe*Ie),Lt=ue*ge,Pe=Bs*ue,Oe=Pe-(Pe-ue),Fe=ue-Oe,Pe=Bs*ge,at=Pe-(Pe-ge),Ie=ge-at,_t=Fe*Ie-(Lt-Oe*at-Fe*at-Oe*Ie),Et=Mt-_t,ce=Mt-Et,oo[0]=Mt-(Et+ce)+(ce-_t),vt=At+Et,ce=vt-At,rt=At-(vt-ce)+(Et-ce),Et=rt-Lt,ce=rt-Et,oo[1]=rt-(Et+ce)+(ce-Lt),Gt=vt+Et,ce=Gt-vt,oo[2]=vt-(Gt-ce)+(Et-ce),oo[3]=Gt;const Tt=__(Je,iy,4,oo,ry);return ry[Tt-1]}function Zv(R,B,Y,F,U,ee){const L=(B-ee)*(Y-U),f=(R-U)*(F-ee),ue=L-f,ge=Math.abs(L+f);return Math.abs(ue)>=Uv*ge?ue:-qv(R,B,Y,F,U,ee,ge)}function Yv(R,B){var Y,F,U=0,ee,L,f,ue,ge,Te,ce,Pe=R[0],Oe=R[1],Fe=B.length;for(Y=0;Y<Fe;Y++){F=0;var at=B[Y],Ie=at.length-1;if(Te=at[0],Te[0]!==at[Ie][0]&&Te[1]!==at[Ie][1])throw new Error("First and last coordinates in a ring must be the same");for(L=Te[0]-Pe,f=Te[1]-Oe,F;F<Ie;F++){if(ce=at[F+1],ue=ce[0]-Pe,ge=ce[1]-Oe,f===0&&ge===0){if(ue<=0&&L>=0||L<=0&&ue>=0)return 0}else if(ge>=0&&f<=0||ge<=0&&f>=0){if(ee=Zv(L,ue,f,ge,0,0),ee===0)return 0;(ee>0&&ge>0&&f<=0||ee<0&&ge<=0&&f>0)&&U++}Te=ce,f=ge,L=ue}}return U%2!==0}function _g(R,B,Y={}){if(!R)throw new Error("point is required");if(!B)throw new Error("polygon is required");const F=ym(R),U=zg(B),ee=U.type,L=B.bbox;let f=U.coordinates;if(L&&Hv(F,L)===!1)return!1;ee==="Polygon"&&(f=[f]);let ue=!1;for(var ge=0;ge<f.length;++ge){const Te=Yv(F,f[ge]);if(Te===0)return!Y.ignoreBoundary;Te&&(ue=!0)}return ue}function Hv(R,B){return B[0]<=R[0]&&B[1]<=R[1]&&B[2]>=R[0]&&B[3]>=R[1]}function y_(R,B,Y={}){const F=ym(R),U=Pv(B);for(let ee=0;ee<U.length-1;ee++){let L=!1;if(Y.ignoreEndVertices&&(ee===0&&(L="start"),ee===U.length-2&&(L="end"),ee===0&&ee+1===U.length-1&&(L="both")),Xv(U[ee],U[ee+1],F,L,typeof Y.epsilon>"u"?null:Y.epsilon))return!0}return!1}function Xv(R,B,Y,F,U){const ee=Y[0],L=Y[1],f=R[0],ue=R[1],ge=B[0],Te=B[1],ce=Y[0]-f,Pe=Y[1]-ue,Oe=ge-f,Fe=Te-ue,at=ce*Fe-Pe*Oe;if(U!==null){if(Math.abs(at)>U)return!1}else if(at!==0)return!1;if(Math.abs(Oe)===Math.abs(Fe)&&Math.abs(Oe)===0)return F?!1:Y[0]===R[0]&&Y[1]===R[1];if(F){if(F==="start")return Math.abs(Oe)>=Math.abs(Fe)?Oe>0?f<ee&&ee<=ge:ge<=ee&&ee<f:Fe>0?ue<L&&L<=Te:Te<=L&&L<ue;if(F==="end")return Math.abs(Oe)>=Math.abs(Fe)?Oe>0?f<=ee&&ee<ge:ge<ee&&ee<=f:Fe>0?ue<=L&&L<Te:Te<L&&L<=ue;if(F==="both")return Math.abs(Oe)>=Math.abs(Fe)?Oe>0?f<ee&&ee<ge:ge<ee&&ee<f:Fe>0?ue<L&&L<Te:Te<L&&L<ue}else return Math.abs(Oe)>=Math.abs(Fe)?Oe>0?f<=ee&&ee<=ge:ge<=ee&&ee<=f:Fe>0?ue<=L&&L<=Te:Te<=L&&L<=ue;return!1}function $v(R,B={}){const Y=zg(R);switch(!B.properties&&R.type==="Feature"&&(B.properties=R.properties),Y.type){case"Polygon":return Wv(Y,B);case"MultiPolygon":return Qv(Y,B);default:throw new Error("invalid poly")}}function Wv(R,B={}){const F=zg(R).coordinates,U=B.properties?B.properties:R.type==="Feature"?R.properties:{};return Fy(F,U)}function Qv(R,B={}){const F=zg(R).coordinates,U=B.properties?B.properties:R.type==="Feature"?R.properties:{},ee=[];return F.forEach(L=>{ee.push(Fy(L,U))}),Ig(ee)}function Fy(R,B){return R.length>1?kv(R,B):zy(R[0],B)}function Kv(R,B={}){const Y=Bv(R),F=(Y[0]+Y[2])/2,U=(Y[1]+Y[3])/2;return id([F,U],B.properties,B)}var Eg={exports:{}},Jv=Eg.exports,ay;function e0(){return ay||(ay=1,(function(R,B){(function(Y,F){R.exports=F()})(Jv,(function(){function Y(_,o){(o==null||o>_.length)&&(o=_.length);for(var u=0,g=Array(o);u<o;u++)g[u]=_[u];return g}function F(_,o,u){return o=Te(o),(function(g,E){if(E&&(typeof E=="object"||typeof E=="function"))return E;if(E!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(P){if(P===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return P})(g)})(_,Pe()?Reflect.construct(o,u||[],Te(_).constructor):o.apply(_,u))}function U(_,o){if(!(_ instanceof o))throw new TypeError("Cannot call a class as a function")}function ee(_,o,u){if(Pe())return Reflect.construct.apply(null,arguments);var g=[null];g.push.apply(g,o);var E=new(_.bind.apply(_,g));return u&&Oe(E,u.prototype),E}function L(_,o){for(var u=0;u<o.length;u++){var g=o[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(_,Ie(g.key),g)}}function f(_,o,u){return o&&L(_.prototype,o),u&&L(_,u),Object.defineProperty(_,"prototype",{writable:!1}),_}function ue(_,o){var u=typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(!u){if(Array.isArray(_)||(u=Et(_))||o){u&&(_=u);var g=0,E=function(){};return{s:E,n:function(){return g>=_.length?{done:!0}:{done:!1,value:_[g++]}},e:function(re){throw re},f:E}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var P,V=!0,$=!1;return{s:function(){u=u.call(_)},n:function(){var re=u.next();return V=re.done,re},e:function(re){$=!0,P=re},f:function(){try{V||u.return==null||u.return()}finally{if($)throw P}}}}function ge(){return ge=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(_,o,u){var g=(function(P,V){for(;!{}.hasOwnProperty.call(P,V)&&(P=Te(P))!==null;);return P})(_,o);if(g){var E=Object.getOwnPropertyDescriptor(g,o);return E.get?E.get.call(arguments.length<3?_:u):E.value}},ge.apply(null,arguments)}function Te(_){return Te=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},Te(_)}function ce(_,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");_.prototype=Object.create(o&&o.prototype,{constructor:{value:_,writable:!0,configurable:!0}}),Object.defineProperty(_,"prototype",{writable:!1}),o&&Oe(_,o)}function Pe(){try{var _=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Pe=function(){return!!_})()}function Oe(_,o){return Oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,g){return u.__proto__=g,u},Oe(_,o)}function Fe(_,o,u,g){var E=ge(Te(1&g?_.prototype:_),o,u);return 2&g&&typeof E=="function"?function(P){return E.apply(u,P)}:E}function at(_){return(function(o){if(Array.isArray(o))return Y(o)})(_)||(function(o){if(typeof Symbol<"u"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null)return Array.from(o)})(_)||Et(_)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function Ie(_){var o=(function(u,g){if(typeof u!="object"||!u)return u;var E=u[Symbol.toPrimitive];if(E!==void 0){var P=E.call(u,g);if(typeof P!="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(_,"string");return typeof o=="symbol"?o:o+""}function Et(_,o){if(_){if(typeof _=="string")return Y(_,o);var u={}.toString.call(_).slice(8,-1);return u==="Object"&&_.constructor&&(u=_.constructor.name),u==="Map"||u==="Set"?Array.from(_):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?Y(_,o):void 0}}function vt(_){var o=typeof Map=="function"?new Map:void 0;return vt=function(u){if(u===null||!(function(E){try{return Function.toString.call(E).indexOf("[native code]")!==-1}catch{return typeof E=="function"}})(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(u))return o.get(u);o.set(u,g)}function g(){return ee(u,arguments,Te(this).constructor)}return g.prototype=Object.create(u.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),Oe(g,u)},vt(_)}var rt=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(o){this._quadrantSegments=o,this._quadrantSegments===0&&(this._joinStyle=_.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=_.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),o<=0&&(this._quadrantSegments=1),this._joinStyle!==_.JOIN_ROUND&&(this._quadrantSegments=_.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(o){this._joinStyle=o}},{key:"setSimplifyFactor",value:function(o){this._simplifyFactor=o<0?0:o}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(o){this._endCapStyle=o}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(o){this._mitreLimit=o}},{key:"setSingleSided",value:function(o){this._isSingleSided=o}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=_.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=_.CAP_ROUND,this._joinStyle=_.JOIN_ROUND,this._mitreLimit=_.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=_.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this.setQuadrantSegments(o)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.setQuadrantSegments(u),this.setEndCapStyle(g)}else if(arguments.length===4){var E=arguments[0],P=arguments[1],V=arguments[2],$=arguments[3];this.setQuadrantSegments(E),this.setEndCapStyle(P),this.setJoinStyle(V),this.setMitreLimit($)}}}},{key:"bufferDistanceError",value:function(o){var u=Math.PI/2/o;return 1-Math.cos(u/2)}}])})();rt.CAP_ROUND=1,rt.CAP_FLAT=2,rt.CAP_SQUARE=3,rt.JOIN_ROUND=1,rt.JOIN_MITRE=2,rt.JOIN_BEVEL=3,rt.DEFAULT_QUADRANT_SEGMENTS=8,rt.DEFAULT_MITRE_LIMIT=5,rt.DEFAULT_SIMPLIFY_FACTOR=.01;var At=(function(_){function o(u){var g;return U(this,o),(g=F(this,o,[u])).name=Object.keys({Exception:o})[0],g}return ce(o,_),f(o,[{key:"toString",value:function(){return this.message}}])})(vt(Error)),Mt=(function(_){function o(u){var g;return U(this,o),(g=F(this,o,[u])).name=Object.keys({IllegalArgumentException:o})[0],g}return ce(o,_),f(o)})(At),Lt=(function(){return f((function _(){U(this,_)}),[{key:"filter",value:function(_){}}])})();function _t(){}function Gt(){}function Ft(){}var xn,dn,sn,En,Rt,fn,Je,Tt,$t=(function(){return f((function _(){U(this,_)}),null,[{key:"equalsWithTolerance",value:function(_,o,u){return Math.abs(_-o)<=u}}])})(),Ht=(function(){return f((function _(o,u){U(this,_),this.low=u||0,this.high=o||0}),null,[{key:"toBinaryString",value:function(_){var o,u="";for(o=2147483648;o>0;o>>>=1)u+=(_.high&o)===o?"1":"0";for(o=2147483648;o>0;o>>>=1)u+=(_.low&o)===o?"1":"0";return u}}])})();function Pt(){}function Re(){}Pt.NaN=NaN,Pt.isNaN=function(_){return Number.isNaN(_)},Pt.isInfinite=function(_){return!Number.isFinite(_)},Pt.MAX_VALUE=Number.MAX_VALUE,Pt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Pt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(fn=2146435072,Je=new Float64Array(1),Tt=new Int32Array(Je.buffer),Pt.doubleToLongBits=function(_){Je[0]=_;var o=0|Tt[0],u=0|Tt[1];return(u&fn)===fn&&1048575&u&&o!==0&&(o=0,u=2146959360),new Ht(u,o)},Pt.longBitsToDouble=function(_){return Tt[0]=_.low,Tt[1]=_.high,Je[0]}):(xn=1023,dn=Math.log2,sn=Math.floor,En=Math.pow,Rt=(function(){for(var _=53;_>0;_--){var o=En(2,_)-1;if(sn(dn(o))+1===_)return o}return 0})(),Pt.doubleToLongBits=function(_){var o,u,g,E,P,V,$,re,fe;if(_<0||1/_===Number.NEGATIVE_INFINITY?(V=1<<31,_=-_):V=0,_===0)return new Ht(re=V,fe=0);if(_===1/0)return new Ht(re=2146435072|V,fe=0);if(_!=_)return new Ht(re=2146959360,fe=0);if(E=0,fe=0,(o=sn(_))>1)if(o<=Rt)(E=sn(dn(o)))<=20?(fe=0,re=o<<20-E&1048575):(fe=o%(u=En(2,g=E-20))<<32-g,re=o/u&1048575);else for(g=o,fe=0;(g=sn(u=g/2))!==0;)E++,fe>>>=1,fe|=(1&re)<<31,re>>>=1,u!==g&&(re|=524288);if($=E+xn,P=o===0,o=_-o,E<52&&o!==0)for(g=0;;){if((u=2*o)>=1?(o=u-1,P?($--,P=!1):(g<<=1,g|=1,E++)):(o=u,P?--$==0&&(E++,P=!1):(g<<=1,E++)),E===20)re|=g,g=0;else if(E===52){fe|=g;break}if(u===1){E<20?re|=g<<20-E:E<52&&(fe|=g<<52-E);break}}return re|=$<<20,new Ht(re|=V,fe)},Pt.longBitsToDouble=function(_){var o,u,g,E,P=_.high,V=_.low,$=P&1<<31?-1:1;for(g=((2146435072&P)>>20)-xn,E=0,u=1<<19,o=1;o<=20;o++)P&u&&(E+=En(2,-o)),u>>>=1;for(u=1<<31,o=21;o<=52;o++)V&u&&(E+=En(2,-o)),u>>>=1;if(g===-1023){if(E===0)return 0*$;g=-1022}else{if(g===1024)return E===0?$/0:NaN;E+=1}return $*E*En(2,g)});var lt=(function(_){function o(u){var g;return U(this,o),(g=F(this,o,[u])).name=Object.keys({RuntimeException:o})[0],g}return ce(o,_),f(o)})(At),zt=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,null,[{key:"constructor_",value:function(){if(arguments.length===0)lt.constructor_.call(this);else if(arguments.length===1){var u=arguments[0];lt.constructor_.call(this,u)}}}])})(lt),Ct=(function(){function _(){U(this,_)}return f(_,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)_.shouldNeverReachHere(null);else if(arguments.length===1){var o=arguments[0];throw new zt("Should never reach here"+(o!==null?": "+o:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var o=arguments[0];_.isTrue(o,null)}else if(arguments.length===2){var u=arguments[1];if(!arguments[0])throw u===null?new zt:new zt(u)}}},{key:"equals",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];_.equals(o,u,null)}else if(arguments.length===3){var g=arguments[0],E=arguments[1],P=arguments[2];if(!E.equals(g))throw new zt("Expected "+g+" but encountered "+E+(P!==null?": "+P:""))}}}])})(),en=new ArrayBuffer(8),Mn=new Float64Array(en),Rn=new Int32Array(en),Ue=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getM",value:function(){return Pt.NaN}},{key:"setOrdinate",value:function(o,u){switch(o){case _.X:this.x=u;break;case _.Y:this.y=u;break;case _.Z:this.setZ(u);break;default:throw new Mt("Invalid ordinate index: "+o)}}},{key:"equals2D",value:function(){if(arguments.length===1){var o=arguments[0];return this.x===o.x&&this.y===o.y}if(arguments.length===2){var u=arguments[0],g=arguments[1];return!!$t.equalsWithTolerance(this.x,u.x,g)&&!!$t.equalsWithTolerance(this.y,u.y,g)}}},{key:"setM",value:function(o){throw new Mt("Invalid ordinate index: "+_.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(o){switch(o){case _.X:return this.x;case _.Y:return this.y;case _.Z:return this.getZ()}throw new Mt("Invalid ordinate index: "+o)}},{key:"equals3D",value:function(o){return this.x===o.x&&this.y===o.y&&(this.getZ()===o.getZ()||Pt.isNaN(this.getZ())&&Pt.isNaN(o.getZ()))}},{key:"equals",value:function(o){return o instanceof _&&this.equals2D(o)}},{key:"equalInZ",value:function(o,u){return $t.equalsWithTolerance(this.getZ(),o.getZ(),u)}},{key:"setX",value:function(o){this.x=o}},{key:"compareTo",value:function(o){var u=o;return this.x<u.x?-1:this.x>u.x?1:this.y<u.y?-1:this.y>u.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(o){this.z=o}},{key:"clone",value:function(){try{return null}catch(o){if(o instanceof CloneNotSupportedException)return Ct.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw o}}},{key:"copy",value:function(){return new _(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(o){var u=this.x-o.x,g=this.y-o.y,E=this.getZ()-o.getZ();return Math.sqrt(u*u+g*g+E*E)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(o){this.y=o}},{key:"distance",value:function(o){var u=this.x-o.x,g=this.y-o.y;return Math.sqrt(u*u+g*g)}},{key:"hashCode",value:function(){var o=17;return o=37*(o=37*o+_.hashCode(this.x))+_.hashCode(this.y)}},{key:"setCoordinate",value:function(o){this.x=o.x,this.y=o.y,this.z=o.getZ()}},{key:"interfaces_",get:function(){return[_t,Gt,Ft]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)_.constructor_.call(this,0,0);else if(arguments.length===1){var o=arguments[0];_.constructor_.call(this,o.x,o.y,o.getZ())}else if(arguments.length===2){var u=arguments[0],g=arguments[1];_.constructor_.call(this,u,g,_.NULL_ORDINATE)}else if(arguments.length===3){var E=arguments[0],P=arguments[1],V=arguments[2];this.x=E,this.y=P,this.z=V}}},{key:"hashCode",value:function(o){return Mn[0]=o,Rn[0]^Rn[1]}}])})(),yi=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"compare",value:function(o,u){var g=_.compare(o.x,u.x);if(g!==0)return g;var E=_.compare(o.y,u.y);return E!==0?E:this._dimensionsToTest<=2?0:_.compare(o.getZ(),u.getZ())}},{key:"interfaces_",get:function(){return[Re]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)_.constructor_.call(this,2);else if(arguments.length===1){var o=arguments[0];if(o!==2&&o!==3)throw new Mt("only 2 or 3 dimensions may be specified");this._dimensionsToTest=o}}},{key:"compare",value:function(o,u){return o<u?-1:o>u?1:Pt.isNaN(o)?Pt.isNaN(u)?0:-1:Pt.isNaN(u)?1:0}}])})();Ue.DimensionalComparator=yi,Ue.NULL_ORDINATE=Pt.NaN,Ue.X=0,Ue.Y=1,Ue.Z=2,Ue.M=3;var Ln=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(o){if(!(o instanceof _))return!1;var u=o;return this.isNull()?u.isNull():this._maxx===u.getMaxX()&&this._maxy===u.getMaxY()&&this._minx===u.getMinX()&&this._miny===u.getMinY()}},{key:"intersection",value:function(o){if(this.isNull()||o.isNull()||!this.intersects(o))return new _;var u=this._minx>o._minx?this._minx:o._minx,g=this._miny>o._miny?this._miny:o._miny;return new _(u,this._maxx<o._maxx?this._maxx:o._maxx,g,this._maxy<o._maxy?this._maxy:o._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Ue){var o=arguments[0];return this.covers(o.x,o.y)}if(arguments[0]instanceof _){var u=arguments[0];return!this.isNull()&&!u.isNull()&&u.getMinX()>=this._minx&&u.getMaxX()<=this._maxx&&u.getMinY()>=this._miny&&u.getMaxY()<=this._maxy}}else if(arguments.length===2){var g=arguments[0],E=arguments[1];return!this.isNull()&&g>=this._minx&&g<=this._maxx&&E>=this._miny&&E<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return!this.isNull()&&!o.isNull()&&!(o._minx>this._maxx||o._maxx<this._minx||o._miny>this._maxy||o._maxy<this._miny)}if(arguments[0]instanceof Ue){var u=arguments[0];return this.intersects(u.x,u.y)}}else if(arguments.length===2){if(arguments[0]instanceof Ue&&arguments[1]instanceof Ue){var g=arguments[0],E=arguments[1];return!this.isNull()&&!((g.x<E.x?g.x:E.x)>this._maxx)&&!((g.x>E.x?g.x:E.x)<this._minx)&&!((g.y<E.y?g.y:E.y)>this._maxy)&&!((g.y>E.y?g.y:E.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var P=arguments[0],V=arguments[1];return!this.isNull()&&!(P>this._maxx||P<this._minx||V>this._maxy||V<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var o=this.getWidth(),u=this.getHeight();return Math.sqrt(o*o+u*u)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Ue){var o=arguments[0];this.expandToInclude(o.x,o.y)}else if(arguments[0]instanceof _){var u=arguments[0];if(u.isNull())return null;this.isNull()?(this._minx=u.getMinX(),this._maxx=u.getMaxX(),this._miny=u.getMinY(),this._maxy=u.getMaxY()):(u._minx<this._minx&&(this._minx=u._minx),u._maxx>this._maxx&&(this._maxx=u._maxx),u._miny<this._miny&&(this._miny=u._miny),u._maxy>this._maxy&&(this._maxy=u._maxy))}}else if(arguments.length===2){var g=arguments[0],E=arguments[1];this.isNull()?(this._minx=g,this._maxx=g,this._miny=E,this._maxy=E):(g<this._minx&&(this._minx=g),g>this._maxx&&(this._maxx=g),E<this._miny&&(this._miny=E),E>this._maxy&&(this._maxy=E))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var o=this.getWidth(),u=this.getHeight();return o<u?o:u}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(o){var u=o;return this.isNull()?u.isNull()?0:-1:u.isNull()?1:this._minx<u._minx?-1:this._minx>u._minx?1:this._miny<u._miny?-1:this._miny>u._miny?1:this._maxx<u._maxx?-1:this._maxx>u._maxx?1:this._maxy<u._maxy?-1:this._maxy>u._maxy?1:0}},{key:"translate",value:function(o,u){if(this.isNull())return null;this.init(this.getMinX()+o,this.getMaxX()+o,this.getMinY()+u,this.getMaxY()+u)}},{key:"copy",value:function(){return new _(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(o){return!(!this.isNull()&&!o.isNull())||o._minx>this._maxx||o._maxx<this._minx||o._miny>this._maxy||o._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var o=this.getWidth(),u=this.getHeight();return o>u?o:u}},{key:"expandBy",value:function(){if(arguments.length===1){var o=arguments[0];this.expandBy(o,o)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];if(this.isNull())return null;this._minx-=u,this._maxx+=u,this._miny-=g,this._maxy+=g,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return this.covers(o)}if(arguments[0]instanceof Ue){var u=arguments[0];return this.covers(u)}}else if(arguments.length===2){var g=arguments[0],E=arguments[1];return this.covers(g,E)}}},{key:"centre",value:function(){return this.isNull()?null:new Ue((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Ue){var o=arguments[0];this.init(o.x,o.x,o.y,o.y)}else if(arguments[0]instanceof _){var u=arguments[0];this._minx=u._minx,this._maxx=u._maxx,this._miny=u._miny,this._maxy=u._maxy}}else if(arguments.length===2){var g=arguments[0],E=arguments[1];this.init(g.x,E.x,g.y,E.y)}else if(arguments.length===4){var P=arguments[0],V=arguments[1],$=arguments[2],re=arguments[3];P<V?(this._minx=P,this._maxx=V):(this._minx=V,this._maxx=P),$<re?(this._miny=$,this._maxy=re):(this._miny=re,this._maxy=$)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(o){if(this.intersects(o))return 0;var u=0;this._maxx<o._minx?u=o._minx-this._maxx:this._minx>o._maxx&&(u=this._minx-o._maxx);var g=0;return this._maxy<o._miny?g=o._miny-this._maxy:this._miny>o._maxy&&(g=this._miny-o._maxy),u===0?g:g===0?u:Math.sqrt(u*u+g*g)}},{key:"hashCode",value:function(){var o=17;return o=37*(o=37*(o=37*(o=37*o+Ue.hashCode(this._minx))+Ue.hashCode(this._maxx))+Ue.hashCode(this._miny))+Ue.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[_t,Ft]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Ue){var o=arguments[0];this.init(o.x,o.x,o.y,o.y)}else if(arguments[0]instanceof _){var u=arguments[0];this.init(u)}}else if(arguments.length===2){var g=arguments[0],E=arguments[1];this.init(g.x,E.x,g.y,E.y)}else if(arguments.length===4){var P=arguments[0],V=arguments[1],$=arguments[2],re=arguments[3];this.init(P,V,$,re)}}},{key:"intersects",value:function(){if(arguments.length===3){var o=arguments[0],u=arguments[1],g=arguments[2];return g.x>=(o.x<u.x?o.x:u.x)&&g.x<=(o.x>u.x?o.x:u.x)&&g.y>=(o.y<u.y?o.y:u.y)&&g.y<=(o.y>u.y?o.y:u.y)}if(arguments.length===4){var E=arguments[0],P=arguments[1],V=arguments[2],$=arguments[3],re=Math.min(V.x,$.x),fe=Math.max(V.x,$.x),Be=Math.min(E.x,P.x),Xe=Math.max(E.x,P.x);return!(Be>fe)&&!(Xe<re)&&(re=Math.min(V.y,$.y),fe=Math.max(V.y,$.y),Be=Math.min(E.y,P.y),Xe=Math.max(E.y,P.y),!(Be>fe)&&!(Xe<re))}}}])})(),rn=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===_.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(o){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(o){return this===o||this.equalsExact(o,0)}},{key:"geometryChanged",value:function(){this.apply(_.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(o){return o!==null&&this.norm().equalsExact(o.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var o;if(arguments.length===1){var u=arguments[0];return o=u,this.getTypeCode()!==o.getTypeCode()?this.getTypeCode()-o.getTypeCode():this.isEmpty()&&o.isEmpty()?0:this.isEmpty()?-1:o.isEmpty()?1:this.compareToSameClass(u)}if(arguments.length===2){var g=arguments[0],E=arguments[1];return o=g,this.getTypeCode()!==o.getTypeCode()?this.getTypeCode()-o.getTypeCode():this.isEmpty()&&o.isEmpty()?0:this.isEmpty()?-1:o.isEmpty()?1:this.compareToSameClass(g,E)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(o){if(o.getTypeCode()===_.TYPECODE_GEOMETRYCOLLECTION)throw new Mt("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(o,u,g){return g===0?o.equals(u):o.distance(u)<=g}},{key:"norm",value:function(){var o=this.copy();return o.normalize(),o}},{key:"reverse",value:function(){var o=this.reverseInternal();return this.envelope!=null&&(o.envelope=this.envelope.copy()),o.setSRID(this.getSRID()),o}},{key:"copy",value:function(){var o=this.copyInternal();return o.envelope=this._envelope==null?null:this._envelope.copy(),o._SRID=this._SRID,o._userData=this._userData,o}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Ln(this._envelope)}},{key:"setSRID",value:function(o){this._SRID=o}},{key:"setUserData",value:function(o){this._userData=o}},{key:"compare",value:function(o,u){for(var g=o.iterator(),E=u.iterator();g.hasNext()&&E.hasNext();){var P=g.next(),V=E.next(),$=P.compareTo(V);if($!==0)return $}return g.hasNext()?1:E.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(o){return this.getClass()===o.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===_.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===_.TYPECODE_MULTIPOINT||this.getTypeCode()===_.TYPECODE_MULTILINESTRING||this.getTypeCode()===_.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Gt,_t,Ft]}},{key:"getClass",value:function(){return _}}],[{key:"hasNonEmptyElements",value:function(o){for(var u=0;u<o.length;u++)if(!o[u].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(o){for(var u=0;u<o.length;u++)if(o[u]===null)return!0;return!1}}])})();rn.constructor_=function(_){_&&(this._envelope=null,this._userData=null,this._factory=_,this._SRID=_.getSRID())},rn.TYPECODE_POINT=0,rn.TYPECODE_MULTIPOINT=1,rn.TYPECODE_LINESTRING=2,rn.TYPECODE_LINEARRING=3,rn.TYPECODE_MULTILINESTRING=4,rn.TYPECODE_POLYGON=5,rn.TYPECODE_MULTIPOLYGON=6,rn.TYPECODE_GEOMETRYCOLLECTION=7,rn.TYPENAME_POINT="Point",rn.TYPENAME_MULTIPOINT="MultiPoint",rn.TYPENAME_LINESTRING="LineString",rn.TYPENAME_LINEARRING="LinearRing",rn.TYPENAME_MULTILINESTRING="MultiLineString",rn.TYPENAME_POLYGON="Polygon",rn.TYPENAME_MULTIPOLYGON="MultiPolygon",rn.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",rn.geometryChangedFilter={get interfaces_(){return[Lt]},filter:function(_){_.geometryChangedAction()}};var Se=(function(){function _(){U(this,_)}return f(_,null,[{key:"toLocationSymbol",value:function(o){switch(o){case _.EXTERIOR:return"e";case _.BOUNDARY:return"b";case _.INTERIOR:return"i";case _.NONE:return"-"}throw new Mt("Unknown location value: "+o)}}])})();Se.INTERIOR=0,Se.BOUNDARY=1,Se.EXTERIOR=2,Se.NONE=-1;var oa=(function(){return f((function _(){U(this,_)}),[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])})(),vi=(function(_){function o(u){var g;return U(this,o),(g=F(this,o,[u])).name=Object.keys({NoSuchElementException:o})[0],g}return ce(o,_),f(o)})(At),er=(function(_){function o(u){var g;return U(this,o),(g=F(this,o,[u])).name=Object.keys({UnsupportedOperationException:o})[0],g}return ce(o,_),f(o)})(At),Ma=(function(_){function o(){return U(this,o),F(this,o,arguments)}return ce(o,_),f(o,[{key:"contains",value:function(){}}])})(oa),Ai=(function(_){function o(u){var g;return U(this,o),(g=F(this,o)).map=new Map,u instanceof oa&&g.addAll(u),g}return ce(o,_),f(o,[{key:"contains",value:function(u){var g=u.hashCode?u.hashCode():u;return!!this.map.has(g)}},{key:"add",value:function(u){var g=u.hashCode?u.hashCode():u;return!this.map.has(g)&&!!this.map.set(g,u)}},{key:"addAll",value:function(u){var g,E=ue(u);try{for(E.s();!(g=E.n()).done;){var P=g.value;this.add(P)}}catch(V){E.e(V)}finally{E.f()}return!0}},{key:"remove",value:function(){throw new er}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Vs(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])})(Ma),Vs=(function(){return f((function _(o){U(this,_),this.iterator=o.values();var u=this.iterator.next(),g=u.done,E=u.value;this.done=g,this.value=E}),[{key:"next",value:function(){if(this.done)throw new vi;var _=this.value,o=this.iterator.next(),u=o.done,g=o.value;return this.done=u,this.value=g,_}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new er}}])})(),Dt=(function(){function _(){U(this,_)}return f(_,null,[{key:"opposite",value:function(o){return o===_.LEFT?_.RIGHT:o===_.RIGHT?_.LEFT:o}}])})();Dt.ON=0,Dt.LEFT=1,Dt.RIGHT=2;var Us=(function(_){function o(u){var g;return U(this,o),(g=F(this,o,[u])).name=Object.keys({EmptyStackException:o})[0],g}return ce(o,_),f(o)})(At),rs=(function(_){function o(u){var g;return U(this,o),(g=F(this,o,[u])).name=Object.keys({IndexOutOfBoundsException:o})[0],g}return ce(o,_),f(o)})(At),zr=(function(_){function o(){return U(this,o),F(this,o,arguments)}return ce(o,_),f(o,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])})(oa),pl=(function(_){function o(){var u;return U(this,o),(u=F(this,o)).array=[],u}return ce(o,_),f(o,[{key:"add",value:function(u){return this.array.push(u),!0}},{key:"get",value:function(u){if(u<0||u>=this.size())throw new rs;return this.array[u]}},{key:"push",value:function(u){return this.array.push(u),u}},{key:"pop",value:function(){if(this.array.length===0)throw new Us;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new Us;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(u){return this.array.indexOf(u)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])})(zr);function ln(_,o){return _.interfaces_&&_.interfaces_.indexOf(o)>-1}var wr=(function(){return f((function _(o){U(this,_),this.str=o}),[{key:"append",value:function(_){this.str+=_}},{key:"setCharAt",value:function(_,o){this.str=this.str.substr(0,_)+o+this.str.substr(_+1)}},{key:"toString",value:function(){return this.str}}])})(),je=(function(){function _(o){U(this,_),this.value=o}return f(_,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(o){return this.value<o?-1:this.value>o?1:0}}],[{key:"compare",value:function(o,u){return o<u?-1:o>u?1:0}},{key:"isNan",value:function(o){return Number.isNaN(o)}},{key:"valueOf",value:function(o){return new _(o)}}])})(),te=(function(){return f((function _(){U(this,_)}),null,[{key:"isWhitespace",value:function(_){return _<=32&&_>=0||_===127}},{key:"toUpperCase",value:function(_){return _.toUpperCase()}}])})(),J=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"le",value:function(o){return this._hi<o._hi||this._hi===o._hi&&this._lo<=o._lo}},{key:"extractSignificantDigits",value:function(o,u){var g=this.abs(),E=_.magnitude(g._hi),P=_.TEN.pow(E);(g=g.divide(P)).gt(_.TEN)?(g=g.divide(_.TEN),E+=1):g.lt(_.ONE)&&(g=g.multiply(_.TEN),E-=1);for(var V=E+1,$=new wr,re=_.MAX_PRINT_DIGITS-1,fe=0;fe<=re;fe++){o&&fe===V&&$.append(".");var Be=Math.trunc(g._hi);if(Be<0)break;var Xe=!1,bt=0;Be>9?(Xe=!0,bt="9"):bt="0"+Be,$.append(bt),g=g.subtract(_.valueOf(Be)).multiply(_.TEN),Xe&&g.selfAdd(_.TEN);var Zt=!0,Qt=_.magnitude(g._hi);if(Qt<0&&Math.abs(Qt)>=re-fe&&(Zt=!1),!Zt)break}return u[0]=E,$.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return this.add(o.negate())}if(typeof arguments[0]=="number"){var u=arguments[0];return this.add(-u)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof _){var o=arguments[0];return this._hi===o._hi&&this._lo===o._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return this.isNaN()?this:this.selfAdd(-o._hi,-o._lo)}if(typeof arguments[0]=="number"){var u=arguments[0];return this.isNaN()?this:this.selfAdd(-u,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(o){return this.le(o)?this:o}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return this.selfDivide(o._hi,o._lo)}if(typeof arguments[0]=="number"){var u=arguments[0];return this.selfDivide(u,0)}}else if(arguments.length===2){var g,E,P,V,$=arguments[0],re=arguments[1],fe=null,Be=null,Xe=null,bt=null;return P=this._hi/$,bt=(fe=(Xe=_.SPLIT*P)-(fe=Xe-P))*(Be=(bt=_.SPLIT*$)-(Be=bt-$))-(V=P*$)+fe*(E=$-Be)+(g=P-fe)*Be+g*E,bt=P+(Xe=(this._hi-V-bt+this._lo-P*re)/$),this._hi=bt,this._lo=P-bt+Xe,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof _){var o,u,g,E,P=arguments[0],V=null,$=null,re=null,fe=null;return o=(g=this._hi/P._hi)-(V=(re=_.SPLIT*g)-(V=re-g)),fe=V*($=(fe=_.SPLIT*P._hi)-($=fe-P._hi))-(E=g*P._hi)+V*(u=P._hi-$)+o*$+o*u,new _(fe=g+(re=(this._hi-E-fe+this._lo-g*P._lo)/P._hi),g-fe+re)}if(typeof arguments[0]=="number"){var Be=arguments[0];return Pt.isNaN(Be)?_.createNaN():_.copy(this).selfDivide(Be,0)}}},{key:"ge",value:function(o){return this._hi>o._hi||this._hi===o._hi&&this._lo>=o._lo}},{key:"pow",value:function(o){if(o===0)return _.valueOf(1);var u=new _(this),g=_.valueOf(1),E=Math.abs(o);if(E>1)for(;E>0;)E%2==1&&g.selfMultiply(u),(E/=2)>0&&(u=u.sqr());else g=u;return o<0?g.reciprocal():g}},{key:"ceil",value:function(){if(this.isNaN())return _.NaN;var o=Math.ceil(this._hi),u=0;return o===this._hi&&(u=Math.ceil(this._lo)),new _(o,u)}},{key:"compareTo",value:function(o){var u=o;return this._hi<u._hi?-1:this._hi>u._hi?1:this._lo<u._lo?-1:this._lo>u._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return this.init(o),this}if(typeof arguments[0]=="number"){var u=arguments[0];return this.init(u),this}}},{key:"max",value:function(o){return this.ge(o)?this:o}},{key:"sqrt",value:function(){if(this.isZero())return _.valueOf(0);if(this.isNegative())return _.NaN;var o=1/Math.sqrt(this._hi),u=this._hi*o,g=_.valueOf(u),E=this.subtract(g.sqr())._hi*(.5*o);return g.add(E)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return this.selfAdd(o._hi,o._lo)}if(typeof arguments[0]=="number"){var u,g,E,P,V,$=arguments[0],re=null;return re=(E=this._hi+$)-(P=E-this._hi),g=(V=(re=$-P+(this._hi-re))+this._lo)+(E-(u=E+V)),this._hi=u+g,this._lo=g+(u-this._hi),this}}else if(arguments.length===2){var fe,Be,Xe,bt,Zt=arguments[0],Qt=arguments[1],un=null,zn=null,Cn=null;Xe=this._hi+Zt,Be=this._lo+Qt,zn=Xe-(Cn=Xe-this._hi),un=Be-(bt=Be-this._lo);var oi=(fe=Xe+(Cn=(zn=Zt-Cn+(this._hi-zn))+Be))+(Cn=(un=Qt-bt+(this._lo-un))+(Cn+(Xe-fe))),ur=Cn+(fe-oi);return this._hi=oi,this._lo=ur,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return this.selfMultiply(o._hi,o._lo)}if(typeof arguments[0]=="number"){var u=arguments[0];return this.selfMultiply(u,0)}}else if(arguments.length===2){var g,E,P=arguments[0],V=arguments[1],$=null,re=null,fe=null,Be=null;$=(fe=_.SPLIT*this._hi)-this._hi,Be=_.SPLIT*P,$=fe-$,g=this._hi-$,re=Be-P;var Xe=(fe=this._hi*P)+(Be=$*(re=Be-re)-fe+$*(E=P-re)+g*re+g*E+(this._hi*V+this._lo*P)),bt=Be+($=fe-Xe);return this._hi=Xe,this._lo=bt,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return _.NaN;var o=Math.floor(this._hi),u=0;return o===this._hi&&(u=Math.floor(this._lo)),new _(o,u)}},{key:"negate",value:function(){return this.isNaN()?this:new _(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(o){if(o instanceof CloneNotSupportedException)return null;throw o}}},{key:"multiply",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return o.isNaN()?_.createNaN():_.copy(this).selfMultiply(o)}if(typeof arguments[0]=="number"){var u=arguments[0];return Pt.isNaN(u)?_.createNaN():_.copy(this).selfMultiply(u,0)}}},{key:"isNaN",value:function(){return Pt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var o=_.magnitude(this._hi);return o>=-3&&o<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var o=this.getSpecialNumberString();if(o!==null)return o;var u=new Array(1).fill(null),g=this.extractSignificantDigits(!0,u),E=u[0]+1,P=g;if(g.charAt(0)===".")P="0"+g;else if(E<0)P="0."+_.stringOfChar("0",-E)+g;else if(g.indexOf(".")===-1){var V=E-g.length;P=g+_.stringOfChar("0",V)+".0"}return this.isNegative()?"-"+P:P}},{key:"reciprocal",value:function(){var o,u,g,E,P=null,V=null,$=null,re=null;o=(g=1/this._hi)-(P=($=_.SPLIT*g)-(P=$-g)),V=(re=_.SPLIT*this._hi)-this._hi;var fe=g+($=(1-(E=g*this._hi)-(re=P*(V=re-V)-E+P*(u=this._hi-V)+o*V+o*u)-g*this._lo)/this._hi);return new _(fe,g-fe+$)}},{key:"toSciNotation",value:function(){if(this.isZero())return _.SCI_NOT_ZERO;var o=this.getSpecialNumberString();if(o!==null)return o;var u=new Array(1).fill(null),g=this.extractSignificantDigits(!1,u),E=_.SCI_NOT_EXPONENT_CHAR+u[0];if(g.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+g);var P="";g.length>1&&(P=g.substring(1));var V=g.charAt(0)+"."+P;return this.isNegative()?"-"+V+E:V+E}},{key:"abs",value:function(){return this.isNaN()?_.NaN:this.isNegative()?this.negate():new _(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(o){return this._hi<o._hi||this._hi===o._hi&&this._lo<o._lo}},{key:"add",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return _.copy(this).selfAdd(o)}if(typeof arguments[0]=="number"){var u=arguments[0];return _.copy(this).selfAdd(u)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var o=arguments[0];this._hi=o,this._lo=0}else if(arguments[0]instanceof _){var u=arguments[0];this._hi=u._hi,this._lo=u._lo}}else if(arguments.length===2){var g=arguments[0],E=arguments[1];this._hi=g,this._lo=E}}},{key:"gt",value:function(o){return this._hi>o._hi||this._hi===o._hi&&this._lo>o._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?_.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[Ft,_t,Gt]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var o=arguments[0];this.init(o)}else if(arguments[0]instanceof _){var u=arguments[0];this.init(u)}else if(typeof arguments[0]=="string"){var g=arguments[0];_.constructor_.call(this,_.parse(g))}}else if(arguments.length===2){var E=arguments[0],P=arguments[1];this.init(E,P)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],u=arguments[1],g=arguments[2],E=arguments[3];return _.determinant(_.valueOf(o),_.valueOf(u),_.valueOf(g),_.valueOf(E))}if(arguments[3]instanceof _&&arguments[2]instanceof _&&arguments[0]instanceof _&&arguments[1]instanceof _){var P=arguments[1],V=arguments[2],$=arguments[3];return arguments[0].multiply($).selfSubtract(P.multiply(V))}}},{key:"sqr",value:function(o){return _.valueOf(o).selfMultiply(o)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var o=arguments[0];return _.parse(o)}if(typeof arguments[0]=="number")return new _(arguments[0])}},{key:"sqrt",value:function(o){return _.valueOf(o).sqrt()}},{key:"parse",value:function(o){for(var u=0,g=o.length;te.isWhitespace(o.charAt(u));)u++;var E=!1;if(u<g){var P=o.charAt(u);P!=="-"&&P!=="+"||(u++,P==="-"&&(E=!0))}for(var V=new _,$=0,re=0,fe=0,Be=!1;!(u>=g);){var Xe=o.charAt(u);if(u++,te.isDigit(Xe)){var bt=Xe-"0";V.selfMultiply(_.TEN),V.selfAdd(bt),$++}else{if(Xe!=="."){if(Xe==="e"||Xe==="E"){var Zt=o.substring(u);try{fe=je.parseInt(Zt)}catch(oi){throw oi instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Zt+" in string "+o):oi}break}throw new NumberFormatException("Unexpected character '"+Xe+"' at position "+u+" in string "+o)}re=$,Be=!0}}var Qt=V;Be||(re=$);var un=$-re-fe;if(un===0)Qt=V;else if(un>0){var zn=_.TEN.pow(un);Qt=V.divide(zn)}else if(un<0){var Cn=_.TEN.pow(-un);Qt=V.multiply(Cn)}return E?Qt.negate():Qt}},{key:"createNaN",value:function(){return new _(Pt.NaN,Pt.NaN)}},{key:"copy",value:function(o){return new _(o)}},{key:"magnitude",value:function(o){var u=Math.abs(o),g=Math.log(u)/Math.log(10),E=Math.trunc(Math.floor(g));return 10*Math.pow(10,E)<=u&&(E+=1),E}},{key:"stringOfChar",value:function(o,u){for(var g=new wr,E=0;E<u;E++)g.append(o);return g.toString()}}])})();J.PI=new J(3.141592653589793,12246467991473532e-32),J.TWO_PI=new J(6.283185307179586,24492935982947064e-32),J.PI_2=new J(1.5707963267948966,6123233995736766e-32),J.E=new J(2.718281828459045,14456468917292502e-32),J.NaN=new J(Pt.NaN,Pt.NaN),J.EPS=123259516440783e-46,J.SPLIT=134217729,J.MAX_PRINT_DIGITS=32,J.TEN=J.valueOf(10),J.ONE=J.valueOf(1),J.SCI_NOT_EXPONENT_CHAR="E",J.SCI_NOT_ZERO="0.0E0";var oe=(function(){function _(){U(this,_)}return f(_,null,[{key:"orientationIndex",value:function(o,u,g){var E=_.orientationIndexFilter(o,u,g);if(E<=1)return E;var P=J.valueOf(u.x).selfAdd(-o.x),V=J.valueOf(u.y).selfAdd(-o.y),$=J.valueOf(g.x).selfAdd(-u.x),re=J.valueOf(g.y).selfAdd(-u.y);return P.selfMultiply(re).selfSubtract(V.selfMultiply($)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof J&&arguments[2]instanceof J&&arguments[0]instanceof J&&arguments[1]instanceof J){var o=arguments[1],u=arguments[2],g=arguments[3];return arguments[0].multiply(g).selfSubtract(o.multiply(u)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var E=arguments[0],P=arguments[1],V=arguments[2],$=arguments[3],re=J.valueOf(E),fe=J.valueOf(P),Be=J.valueOf(V),Xe=J.valueOf($);return re.multiply(Xe).selfSubtract(fe.multiply(Be)).signum()}}},{key:"intersection",value:function(o,u,g,E){var P=new J(o.y).selfSubtract(u.y),V=new J(u.x).selfSubtract(o.x),$=new J(o.x).selfMultiply(u.y).selfSubtract(new J(u.x).selfMultiply(o.y)),re=new J(g.y).selfSubtract(E.y),fe=new J(E.x).selfSubtract(g.x),Be=new J(g.x).selfMultiply(E.y).selfSubtract(new J(E.x).selfMultiply(g.y)),Xe=V.multiply(Be).selfSubtract(fe.multiply($)),bt=re.multiply($).selfSubtract(P.multiply(Be)),Zt=P.multiply(fe).selfSubtract(re.multiply(V)),Qt=Xe.selfDivide(Zt).doubleValue(),un=bt.selfDivide(Zt).doubleValue();return Pt.isNaN(Qt)||Pt.isInfinite(Qt)||Pt.isNaN(un)||Pt.isInfinite(un)?null:new Ue(Qt,un)}},{key:"orientationIndexFilter",value:function(o,u,g){var E=null,P=(o.x-g.x)*(u.y-g.y),V=(o.y-g.y)*(u.x-g.x),$=P-V;if(P>0){if(V<=0)return _.signum($);E=P+V}else{if(!(P<0)||V>=0)return _.signum($);E=-P-V}var re=_.DP_SAFE_EPSILON*E;return $>=re||-$>=re?_.signum($):2}},{key:"signum",value:function(o){return o>0?1:o<0?-1:0}}])})();oe.DP_SAFE_EPSILON=1e-15;var ve=(function(){return f((function _(){U(this,_)}),[{key:"getM",value:function(_){if(this.hasM()){var o=this.getDimension()-this.getMeasures();return this.getOrdinate(_,o)}return Pt.NaN}},{key:"setOrdinate",value:function(_,o,u){}},{key:"getZ",value:function(_){return this.hasZ()?this.getOrdinate(_,2):Pt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(_,o){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(_){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(_){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(_){}},{key:"copy",value:function(){}},{key:"getY",value:function(_){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[Gt]}}])})();ve.X=0,ve.Y=1,ve.Z=2,ve.M=3;var xe=(function(){function _(){U(this,_)}return f(_,null,[{key:"index",value:function(o,u,g){return oe.orientationIndex(o,u,g)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var o=arguments[0],u=o.length-1;if(u<3)throw new Mt("Ring has fewer than 4 points, so orientation cannot be determined");for(var g=o[0],E=0,P=1;P<=u;P++){var V=o[P];V.y>g.y&&(g=V,E=P)}var $=E;do($-=1)<0&&($=u);while(o[$].equals2D(g)&&$!==E);var re=E;do re=(re+1)%u;while(o[re].equals2D(g)&&re!==E);var fe=o[$],Be=o[re];if(fe.equals2D(g)||Be.equals2D(g)||fe.equals2D(Be))return!1;var Xe=_.index(fe,g,Be);return Xe===0?fe.x>Be.x:Xe>0}if(ln(arguments[0],ve)){var bt=arguments[0],Zt=bt.size()-1;if(Zt<3)throw new Mt("Ring has fewer than 4 points, so orientation cannot be determined");for(var Qt=bt.getCoordinate(0),un=0,zn=1;zn<=Zt;zn++){var Cn=bt.getCoordinate(zn);Cn.y>Qt.y&&(Qt=Cn,un=zn)}var oi=null,ur=un;do(ur-=1)<0&&(ur=Zt),oi=bt.getCoordinate(ur);while(oi.equals2D(Qt)&&ur!==un);var hi=null,Wr=un;do Wr=(Wr+1)%Zt,hi=bt.getCoordinate(Wr);while(hi.equals2D(Qt)&&Wr!==un);if(oi.equals2D(Qt)||hi.equals2D(Qt)||oi.equals2D(hi))return!1;var _r=_.index(oi,Qt,hi);return _r===0?oi.x>hi.x:_r>0}}}])})();xe.CLOCKWISE=-1,xe.RIGHT=xe.CLOCKWISE,xe.COUNTERCLOCKWISE=1,xe.LEFT=xe.COUNTERCLOCKWISE,xe.COLLINEAR=0,xe.STRAIGHT=xe.COLLINEAR;var He=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(_,o){var u=this.getRightmostSideOfSegment(_,o);return u<0&&(u=this.getRightmostSideOfSegment(_,o-1)),u<0&&(this._minCoord=null,this.checkForRightmostCoordinate(_)),u}},{key:"findRightmostEdgeAtVertex",value:function(){var _=this._minDe.getEdge().getCoordinates();Ct.isTrue(this._minIndex>0&&this._minIndex<_.length,"rightmost point expected to be interior vertex of edge");var o=_[this._minIndex-1],u=_[this._minIndex+1],g=xe.index(this._minCoord,u,o),E=!1;(o.y<this._minCoord.y&&u.y<this._minCoord.y&&g===xe.COUNTERCLOCKWISE||o.y>this._minCoord.y&&u.y>this._minCoord.y&&g===xe.CLOCKWISE)&&(E=!0),E&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(_,o){var u=_.getEdge().getCoordinates();if(o<0||o+1>=u.length||u[o].y===u[o+1].y)return-1;var g=Dt.LEFT;return u[o].y<u[o+1].y&&(g=Dt.RIGHT),g}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(_){for(var o=_.getEdge().getCoordinates(),u=0;u<o.length-1;u++)(this._minCoord===null||o[u].x>this._minCoord.x)&&(this._minDe=_,this._minIndex=u,this._minCoord=o[u])}},{key:"findRightmostEdgeAtNode",value:function(){var _=this._minDe.getNode().getEdges();this._minDe=_.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(_){for(var o=_.iterator();o.hasNext();){var u=o.next();u.isForward()&&this.checkForRightmostCoordinate(u)}Ct.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Dt.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])})(),Ve=(function(_){function o(u,g){var E;return U(this,o),(E=F(this,o,[g?u+" [ "+g+" ]":u])).pt=g?new Ue(g):void 0,E.name=Object.keys({TopologyException:o})[0],E}return ce(o,_),f(o,[{key:"getCoordinate",value:function(){return this.pt}}])})(lt),De=(function(){return f((function _(){U(this,_),this.array=[]}),[{key:"addLast",value:function(_){this.array.push(_)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])})(),Le=(function(_){function o(u){var g;return U(this,o),(g=F(this,o)).array=[],u instanceof oa&&g.addAll(u),g}return ce(o,_),f(o,[{key:"interfaces_",get:function(){return[zr,oa]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(u){return arguments.length===1?this.array.push(u):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(u){var g,E=ue(u);try{for(E.s();!(g=E.n()).done;){var P=g.value;this.array.push(P)}}catch(V){E.e(V)}finally{E.f()}}},{key:"set",value:function(u,g){var E=this.array[u];return this.array[u]=g,E}},{key:"iterator",value:function(){return new ut(this)}},{key:"get",value:function(u){if(u<0||u>=this.size())throw new rs;return this.array[u]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(u){u?this.array.sort((function(g,E){return u.compare(g,E)})):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(u){for(var g=0,E=this.array.length;g<E;g++)if(this.array[g]===u)return!!this.array.splice(g,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])})(zr),ut=(function(){return f((function _(o){U(this,_),this.arrayList=o,this.position=0}),[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new vi;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(_){return this.arrayList.set(this.position-1,_)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])})(),ht=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"clearVisitedEdges",value:function(){for(var _=this._dirEdgeList.iterator();_.hasNext();)_.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(_){for(var o=null,u=_.getEdges().iterator();u.hasNext();){var g=u.next();if(g.isVisited()||g.getSym().isVisited()){o=g;break}}if(o===null)throw new Ve("unable to find edge to compute depths at "+_.getCoordinate());_.getEdges().computeDepths(o);for(var E=_.getEdges().iterator();E.hasNext();){var P=E.next();P.setVisited(!0),this.copySymDepths(P)}}},{key:"computeDepth",value:function(_){this.clearVisitedEdges();var o=this._finder.getEdge();o.getNode(),o.getLabel(),o.setEdgeDepths(Dt.RIGHT,_),this.copySymDepths(o),this.computeDepths(o)}},{key:"create",value:function(_){this.addReachable(_),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var _=this._dirEdgeList.iterator();_.hasNext();){var o=_.next();o.getDepth(Dt.RIGHT)>=1&&o.getDepth(Dt.LEFT)<=0&&!o.isInteriorAreaEdge()&&o.setInResult(!0)}}},{key:"computeDepths",value:function(_){var o=new Ai,u=new De,g=_.getNode();for(u.addLast(g),o.add(g),_.setVisited(!0);!u.isEmpty();){var E=u.removeFirst();o.add(E),this.computeNodeDepth(E);for(var P=E.getEdges().iterator();P.hasNext();){var V=P.next().getSym();if(!V.isVisited()){var $=V.getNode();o.contains($)||(u.addLast($),o.add($))}}}}},{key:"compareTo",value:function(_){var o=_;return this._rightMostCoord.x<o._rightMostCoord.x?-1:this._rightMostCoord.x>o._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var _=new Ln,o=this._dirEdgeList.iterator();o.hasNext();)for(var u=o.next().getEdge().getCoordinates(),g=0;g<u.length-1;g++)_.expandToInclude(u[g]);this._env=_}return this._env}},{key:"addReachable",value:function(_){var o=new pl;for(o.add(_);!o.empty();){var u=o.pop();this.add(u,o)}}},{key:"copySymDepths",value:function(_){var o=_.getSym();o.setDepth(Dt.LEFT,_.getDepth(Dt.RIGHT)),o.setDepth(Dt.RIGHT,_.getDepth(Dt.LEFT))}},{key:"add",value:function(_,o){_.setVisited(!0),this._nodes.add(_);for(var u=_.getEdges().iterator();u.hasNext();){var g=u.next();this._dirEdgeList.add(g);var E=g.getSym().getNode();E.isVisited()||o.push(E)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[_t]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new Le,this._nodes=new Le,this._rightMostCoord=null,this._env=null,this._finder=new He}}])})(),Ut=(function(){return f((function _(){U(this,_)}),null,[{key:"intersection",value:function(_,o,u,g){var E=_.x<o.x?_.x:o.x,P=_.y<o.y?_.y:o.y,V=_.x>o.x?_.x:o.x,$=_.y>o.y?_.y:o.y,re=u.x<g.x?u.x:g.x,fe=u.y<g.y?u.y:g.y,Be=u.x>g.x?u.x:g.x,Xe=u.y>g.y?u.y:g.y,bt=((E>re?E:re)+(V<Be?V:Be))/2,Zt=((P>fe?P:fe)+($<Xe?$:Xe))/2,Qt=_.x-bt,un=_.y-Zt,zn=o.x-bt,Cn=o.y-Zt,oi=u.x-bt,ur=u.y-Zt,hi=g.x-bt,Wr=g.y-Zt,_r=un-Cn,ks=zn-Qt,xo=Qt*Cn-zn*un,bo=ur-Wr,bl=hi-oi,Xs=oi*Wr-hi*ur,Da=_r*bl-bo*ks,nu=(ks*Xs-bl*xo)/Da,wo=(bo*xo-_r*Xs)/Da;return Pt.isNaN(nu)||Pt.isInfinite(nu)||Pt.isNaN(wo)||Pt.isInfinite(wo)?null:new Ue(nu+bt,wo+Zt)}}])})(),qt=(function(){return f((function _(){U(this,_)}),null,[{key:"arraycopy",value:function(_,o,u,g,E){for(var P=0,V=o;V<o+E;V++)u[g+P]=_[V],P++}},{key:"getProperty",value:function(_){return{"line.separator":`
`}[_]}}])})(),pn=(function(){function _(){U(this,_)}return f(_,null,[{key:"log10",value:function(o){var u=Math.log(o);return Pt.isInfinite(u)||Pt.isNaN(u)?u:u/_.LOG_10}},{key:"min",value:function(o,u,g,E){var P=o;return u<P&&(P=u),g<P&&(P=g),E<P&&(P=E),P}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],u=arguments[1],g=arguments[2];return o<u?u:o>g?g:o}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var E=arguments[0],P=arguments[1],V=arguments[2];return E<P?P:E>V?V:E}}},{key:"wrap",value:function(o,u){return o<0?u- -o%u:o%u}},{key:"max",value:function(){if(arguments.length===3){var o=arguments[1],u=arguments[2],g=arguments[0];return o>g&&(g=o),u>g&&(g=u),g}if(arguments.length===4){var E=arguments[1],P=arguments[2],V=arguments[3],$=arguments[0];return E>$&&($=E),P>$&&($=P),V>$&&($=V),$}}},{key:"average",value:function(o,u){return(o+u)/2}}])})();pn.LOG_10=Math.log(10);var Dn=(function(){function _(){U(this,_)}return f(_,null,[{key:"segmentToSegment",value:function(o,u,g,E){if(o.equals(u))return _.pointToSegment(o,g,E);if(g.equals(E))return _.pointToSegment(E,o,u);var P=!1;if(Ln.intersects(o,u,g,E)){var V=(u.x-o.x)*(E.y-g.y)-(u.y-o.y)*(E.x-g.x);if(V===0)P=!0;else{var $=(o.y-g.y)*(E.x-g.x)-(o.x-g.x)*(E.y-g.y),re=((o.y-g.y)*(u.x-o.x)-(o.x-g.x)*(u.y-o.y))/V,fe=$/V;(fe<0||fe>1||re<0||re>1)&&(P=!0)}}else P=!0;return P?pn.min(_.pointToSegment(o,g,E),_.pointToSegment(u,g,E),_.pointToSegment(g,o,u),_.pointToSegment(E,o,u)):0}},{key:"pointToSegment",value:function(o,u,g){if(u.x===g.x&&u.y===g.y)return o.distance(u);var E=(g.x-u.x)*(g.x-u.x)+(g.y-u.y)*(g.y-u.y),P=((o.x-u.x)*(g.x-u.x)+(o.y-u.y)*(g.y-u.y))/E;if(P<=0)return o.distance(u);if(P>=1)return o.distance(g);var V=((u.y-o.y)*(g.x-u.x)-(u.x-o.x)*(g.y-u.y))/E;return Math.abs(V)*Math.sqrt(E)}},{key:"pointToLinePerpendicular",value:function(o,u,g){var E=(g.x-u.x)*(g.x-u.x)+(g.y-u.y)*(g.y-u.y),P=((u.y-o.y)*(g.x-u.x)-(u.x-o.x)*(g.y-u.y))/E;return Math.abs(P)*Math.sqrt(E)}},{key:"pointToSegmentString",value:function(o,u){if(u.length===0)throw new Mt("Line array must contain at least one vertex");for(var g=o.distance(u[0]),E=0;E<u.length-1;E++){var P=_.pointToSegment(o,u[E],u[E+1]);P<g&&(g=P)}return g}}])})(),Fn=(function(){return f((function _(){U(this,_)}),[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||ln(arguments[0],ve);else if(arguments.length!==2){if(arguments.length===3){var _=arguments[0],o=arguments[1];return this.create(_,o)}}}}])})(),Ge=(function(){return f((function _(){U(this,_)}),[{key:"filter",value:function(_){}}])})(),Jn=(function(){return f((function _(){U(this,_)}),null,[{key:"ofLine",value:function(_){var o=_.size();if(o<=1)return 0;var u=0,g=new Ue;_.getCoordinate(0,g);for(var E=g.x,P=g.y,V=1;V<o;V++){_.getCoordinate(V,g);var $=g.x,re=g.y,fe=$-E,Be=re-P;u+=Math.sqrt(fe*fe+Be*Be),E=$,P=re}return u}}])})(),qi=f((function _(){U(this,_)})),gn=(function(){function _(){U(this,_)}return f(_,null,[{key:"copyCoord",value:function(o,u,g,E){for(var P=Math.min(o.getDimension(),g.getDimension()),V=0;V<P;V++)g.setOrdinate(E,V,o.getOrdinate(u,V))}},{key:"isRing",value:function(o){var u=o.size();return u===0||!(u<=3)&&o.getOrdinate(0,ve.X)===o.getOrdinate(u-1,ve.X)&&o.getOrdinate(0,ve.Y)===o.getOrdinate(u-1,ve.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(ln(arguments[0],ve)&&Number.isInteger(arguments[1])){var o=arguments[0],u=arguments[1];_.scroll(o,u,_.isRing(o))}else if(ln(arguments[0],ve)&&arguments[1]instanceof Ue){var g=arguments[0],E=arguments[1],P=_.indexOf(E,g);if(P<=0)return null;_.scroll(g,P)}}else if(arguments.length===3){var V=arguments[0],$=arguments[1],re=arguments[2];if($<=0)return null;for(var fe=V.copy(),Be=re?V.size()-1:V.size(),Xe=0;Xe<Be;Xe++)for(var bt=0;bt<V.getDimension();bt++)V.setOrdinate(Xe,bt,fe.getOrdinate(($+Xe)%Be,bt));if(re)for(var Zt=0;Zt<V.getDimension();Zt++)V.setOrdinate(Be,Zt,V.getOrdinate(0,Zt))}}},{key:"isEqual",value:function(o,u){var g=o.size();if(g!==u.size())return!1;for(var E=Math.min(o.getDimension(),u.getDimension()),P=0;P<g;P++)for(var V=0;V<E;V++){var $=o.getOrdinate(P,V),re=u.getOrdinate(P,V);if(o.getOrdinate(P,V)!==u.getOrdinate(P,V)&&(!Pt.isNaN($)||!Pt.isNaN(re)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var o=arguments[0];return _.minCoordinateIndex(o,0,o.size()-1)}if(arguments.length===3){for(var u=arguments[0],g=arguments[2],E=-1,P=null,V=arguments[1];V<=g;V++){var $=u.getCoordinate(V);(P===null||P.compareTo($)>0)&&(P=$,E=V)}return E}}},{key:"extend",value:function(o,u,g){var E=o.create(g,u.getDimension()),P=u.size();if(_.copy(u,0,E,0,P),P>0)for(var V=P;V<g;V++)_.copy(u,P-1,E,V,1);return E}},{key:"reverse",value:function(o){for(var u=o.size()-1,g=Math.trunc(u/2),E=0;E<=g;E++)_.swap(o,E,u-E)}},{key:"swap",value:function(o,u,g){if(u===g)return null;for(var E=0;E<o.getDimension();E++){var P=o.getOrdinate(u,E);o.setOrdinate(u,E,o.getOrdinate(g,E)),o.setOrdinate(g,E,P)}}},{key:"copy",value:function(o,u,g,E,P){for(var V=0;V<P;V++)_.copyCoord(o,u+V,g,E+V)}},{key:"ensureValidRing",value:function(o,u){var g=u.size();return g===0?u:g<=3?_.createClosedRing(o,u,4):u.getOrdinate(0,ve.X)===u.getOrdinate(g-1,ve.X)&&u.getOrdinate(0,ve.Y)===u.getOrdinate(g-1,ve.Y)?u:_.createClosedRing(o,u,g+1)}},{key:"indexOf",value:function(o,u){for(var g=0;g<u.size();g++)if(o.x===u.getOrdinate(g,ve.X)&&o.y===u.getOrdinate(g,ve.Y))return g;return-1}},{key:"createClosedRing",value:function(o,u,g){var E=o.create(g,u.getDimension()),P=u.size();_.copy(u,0,E,0,P);for(var V=P;V<g;V++)_.copy(u,0,E,V,1);return E}},{key:"minCoordinate",value:function(o){for(var u=null,g=0;g<o.size();g++){var E=o.getCoordinate(g);(u===null||u.compareTo(E)>0)&&(u=E)}return u}}])})(),xt=(function(){function _(){U(this,_)}return f(_,null,[{key:"toDimensionSymbol",value:function(o){switch(o){case _.FALSE:return _.SYM_FALSE;case _.TRUE:return _.SYM_TRUE;case _.DONTCARE:return _.SYM_DONTCARE;case _.P:return _.SYM_P;case _.L:return _.SYM_L;case _.A:return _.SYM_A}throw new Mt("Unknown dimension value: "+o)}},{key:"toDimensionValue",value:function(o){switch(te.toUpperCase(o)){case _.SYM_FALSE:return _.FALSE;case _.SYM_TRUE:return _.TRUE;case _.SYM_DONTCARE:return _.DONTCARE;case _.SYM_P:return _.P;case _.SYM_L:return _.L;case _.SYM_A:return _.A}throw new Mt("Unknown dimension symbol: "+o)}}])})();xt.P=0,xt.L=1,xt.A=2,xt.FALSE=-1,xt.TRUE=-2,xt.DONTCARE=-3,xt.SYM_FALSE="F",xt.SYM_TRUE="T",xt.SYM_DONTCARE="*",xt.SYM_P="0",xt.SYM_L="1",xt.SYM_A="2";var Zi=(function(){return f((function _(){U(this,_)}),[{key:"filter",value:function(_){}}])})(),Xn=(function(){return f((function _(){U(this,_)}),[{key:"filter",value:function(_,o){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])})(),Ci=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Ln:this._points.expandEnvelope(new Ln)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new o(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];if(!this.isEquivalentClass(u))return!1;var E=u;if(this._points.size()!==E._points.size())return!1;for(var P=0;P<this._points.size();P++)if(!this.equal(this._points.getCoordinate(P),E._points.getCoordinate(P),g))return!1;return!0}return Fe(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var u=0;u<Math.trunc(this._points.size()/2);u++){var g=this._points.size()-1-u;if(!this._points.getCoordinate(u).equals(this._points.getCoordinate(g))){if(this._points.getCoordinate(u).compareTo(this._points.getCoordinate(g))>0){var E=this._points.copy();gn.reverse(E),this._points=E}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?xt.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var u=this._points.copy();return gn.reverse(u),this.getFactory().createLineString(u)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return rn.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return Jn.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var u=arguments[0],g=0,E=0;g<this._points.size()&&E<u._points.size();){var P=this._points.getCoordinate(g).compareTo(u._points.getCoordinate(E));if(P!==0)return P;g++,E++}return g<this._points.size()?1:E<u._points.size()?-1:0}if(arguments.length===2){var V=arguments[0];return arguments[1].compare(this._points,V._points)}}},{key:"apply",value:function(){if(ln(arguments[0],Ge))for(var u=arguments[0],g=0;g<this._points.size();g++)u.filter(this._points.getCoordinate(g));else if(ln(arguments[0],Xn)){var E=arguments[0];if(this._points.size()===0)return null;for(var P=0;P<this._points.size()&&(E.filter(this._points,P),!E.isDone());P++);E.isGeometryChanged()&&this.geometryChanged()}else ln(arguments[0],Zi)?arguments[0].filter(this):ln(arguments[0],Lt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new er}},{key:"isEquivalentClass",value:function(u){return u instanceof o}},{key:"getCoordinateN",value:function(u){return this._points.getCoordinate(u)}},{key:"getGeometryType",value:function(){return rn.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(u){if(u===null&&(u=this.getFactory().getCoordinateSequenceFactory().create([])),u.size()===1)throw new Mt("Invalid number of points in LineString (found "+u.size()+" - must be 0 or >= 2)");this._points=u}},{key:"isCoordinate",value:function(u){for(var g=0;g<this._points.size();g++)if(this._points.getCoordinate(g).equals(u))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(u){return this.getFactory().createPoint(this._points.getCoordinate(u))}},{key:"interfaces_",get:function(){return[qi]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var u=arguments[0],g=arguments[1];rn.constructor_.call(this,g),this.init(u)}}}}])})(rn),ni=f((function _(){U(this,_)})),Ni=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Ln;var u=new Ln;return u.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),u}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new o(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];return!!this.isEquivalentClass(u)&&(!(!this.isEmpty()||!u.isEmpty())||this.isEmpty()===u.isEmpty()&&this.equal(u.getCoordinate(),this.getCoordinate(),g))}return Fe(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return xt.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return rn.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var u=arguments[0];return this.getCoordinate().compareTo(u.getCoordinate())}if(arguments.length===2){var g=arguments[0];return arguments[1].compare(this._coordinates,g._coordinates)}}},{key:"apply",value:function(){if(ln(arguments[0],Ge)){var u=arguments[0];if(this.isEmpty())return null;u.filter(this.getCoordinate())}else if(ln(arguments[0],Xn)){var g=arguments[0];if(this.isEmpty())return null;g.filter(this._coordinates,0),g.isGeometryChanged()&&this.geometryChanged()}else ln(arguments[0],Zi)?arguments[0].filter(this):ln(arguments[0],Lt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return rn.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(u){u===null&&(u=this.getFactory().getCoordinateSequenceFactory().create([])),Ct.isTrue(u.size()<=1),this._coordinates=u}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[ni]}}],[{key:"constructor_",value:function(){this._coordinates=null;var u=arguments[0],g=arguments[1];rn.constructor_.call(this,g),this.init(u)}}])})(rn),Bo=(function(){function _(){U(this,_)}return f(_,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var o=arguments[0];return Math.abs(_.ofRingSigned(o))}if(ln(arguments[0],ve)){var u=arguments[0];return Math.abs(_.ofRingSigned(u))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var o=arguments[0];if(o.length<3)return 0;for(var u=0,g=o[0].x,E=1;E<o.length-1;E++){var P=o[E].x-g,V=o[E+1].y;u+=P*(o[E-1].y-V)}return u/2}if(ln(arguments[0],ve)){var $=arguments[0],re=$.size();if(re<3)return 0;var fe=new Ue,Be=new Ue,Xe=new Ue;$.getCoordinate(0,Be),$.getCoordinate(1,Xe);var bt=Be.x;Xe.x-=bt;for(var Zt=0,Qt=1;Qt<re-1;Qt++)fe.y=Be.y,Be.x=Xe.x,Be.y=Xe.y,$.getCoordinate(Qt+1,Xe),Xe.x-=bt,Zt+=Be.x*(fe.y-Xe.y);return Zt/2}}}])})(),Ca=(function(){return f((function _(){U(this,_)}),null,[{key:"sort",value:function(){var _=arguments,o=arguments[0];if(arguments.length===1)o.sort((function(bt,Zt){return bt.compareTo(Zt)}));else if(arguments.length===2)o.sort((function(bt,Zt){return _[1].compare(bt,Zt)}));else if(arguments.length===3){var u=o.slice(arguments[1],arguments[2]);u.sort();var g=o.slice(0,arguments[1]).concat(u,o.slice(arguments[2],o.length));o.splice(0,o.length);var E,P=ue(g);try{for(P.s();!(E=P.n()).done;){var V=E.value;o.push(V)}}catch(bt){P.e(bt)}finally{P.f()}}else if(arguments.length===4){var $=o.slice(arguments[1],arguments[2]);$.sort((function(bt,Zt){return _[3].compare(bt,Zt)}));var re=o.slice(0,arguments[1]).concat($,o.slice(arguments[2],o.length));o.splice(0,o.length);var fe,Be=ue(re);try{for(Be.s();!(fe=Be.n()).done;){var Xe=fe.value;o.push(Xe)}}catch(bt){Be.e(bt)}finally{Be.f()}}}},{key:"asList",value:function(_){var o,u=new Le,g=ue(_);try{for(g.s();!(o=g.n()).done;){var E=o.value;u.add(E)}}catch(P){g.e(P)}finally{g.f()}return u}},{key:"copyOf",value:function(_,o){return _.slice(0,o)}}])})(),It=f((function _(){U(this,_)})),mr=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var u=new Array(this.getNumPoints()).fill(null),g=-1,E=this._shell.getCoordinates(),P=0;P<E.length;P++)u[++g]=E[P];for(var V=0;V<this._holes.length;V++)for(var $=this._holes[V].getCoordinates(),re=0;re<$.length;re++)u[++g]=$[re];return u}},{key:"getArea",value:function(){var u=0;u+=Bo.ofRing(this._shell.getCoordinateSequence());for(var g=0;g<this._holes.length;g++)u-=Bo.ofRing(this._holes[g].getCoordinateSequence());return u}},{key:"copyInternal",value:function(){for(var u=this._shell.copy(),g=new Array(this._holes.length).fill(null),E=0;E<this._holes.length;E++)g[E]=this._holes[E].copy();return new o(u,g,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var u=this._shell.getCoordinateSequence(),g=this.getEnvelopeInternal(),E=0;E<5;E++){var P=u.getX(E);if(P!==g.getMinX()&&P!==g.getMaxX())return!1;var V=u.getY(E);if(V!==g.getMinY()&&V!==g.getMaxY())return!1}for(var $=u.getX(0),re=u.getY(0),fe=1;fe<=4;fe++){var Be=u.getX(fe),Xe=u.getY(fe);if(Be!==$==(Xe!==re))return!1;$=Be,re=Xe}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];if(!this.isEquivalentClass(u))return!1;var E=u,P=this._shell,V=E._shell;if(!P.equalsExact(V,g)||this._holes.length!==E._holes.length)return!1;for(var $=0;$<this._holes.length;$++)if(!this._holes[$].equalsExact(E._holes[$],g))return!1;return!0}return Fe(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var u=0;u<this._holes.length;u++)this._holes[u]=this.normalized(this._holes[u],!1);Ca.sort(this._holes)}else if(arguments.length===2){var g=arguments[0],E=arguments[1];if(g.isEmpty())return null;var P=g.getCoordinateSequence(),V=gn.minCoordinateIndex(P,0,P.size()-2);gn.scroll(P,V,!0),xe.isCCW(P)===E&&gn.reverse(P)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var u=this.getExteriorRing().reverse(),g=new Array(this.getNumInteriorRing()).fill(null),E=0;E<g.length;E++)g[E]=this.getInteriorRingN(E).reverse();return this.getFactory().createPolygon(u,g)}},{key:"getTypeCode",value:function(){return rn.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var u=0;u+=this._shell.getLength();for(var g=0;g<this._holes.length;g++)u+=this._holes[g].getLength();return u}},{key:"getNumPoints",value:function(){for(var u=this._shell.getNumPoints(),g=0;g<this._holes.length;g++)u+=this._holes[g].getNumPoints();return u}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(u,g){var E=u.copy();return this.normalize(E,g),E}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var u=arguments[0],g=this._shell,E=u._shell;return g.compareToSameClass(E)}if(arguments.length===2){var P=arguments[1],V=arguments[0],$=this._shell,re=V._shell,fe=$.compareToSameClass(re,P);if(fe!==0)return fe;for(var Be=this.getNumInteriorRing(),Xe=V.getNumInteriorRing(),bt=0;bt<Be&&bt<Xe;){var Zt=this.getInteriorRingN(bt),Qt=V.getInteriorRingN(bt),un=Zt.compareToSameClass(Qt,P);if(un!==0)return un;bt++}return bt<Be?1:bt<Xe?-1:0}}},{key:"apply",value:function(){if(ln(arguments[0],Ge)){var u=arguments[0];this._shell.apply(u);for(var g=0;g<this._holes.length;g++)this._holes[g].apply(u)}else if(ln(arguments[0],Xn)){var E=arguments[0];if(this._shell.apply(E),!E.isDone())for(var P=0;P<this._holes.length&&(this._holes[P].apply(E),!E.isDone());P++);E.isGeometryChanged()&&this.geometryChanged()}else if(ln(arguments[0],Zi))arguments[0].filter(this);else if(ln(arguments[0],Lt)){var V=arguments[0];V.filter(this),this._shell.apply(V);for(var $=0;$<this._holes.length;$++)this._holes[$].apply(V)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var u=new Array(this._holes.length+1).fill(null);u[0]=this._shell;for(var g=0;g<this._holes.length;g++)u[g+1]=this._holes[g];return u.length<=1?this.getFactory().createLinearRing(u[0].getCoordinateSequence()):this.getFactory().createMultiLineString(u)}},{key:"getGeometryType",value:function(){return rn.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(u){return this._holes[u]}},{key:"interfaces_",get:function(){return[It]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var u=arguments[0],g=arguments[1],E=arguments[2];if(rn.constructor_.call(this,E),u===null&&(u=this.getFactory().createLinearRing()),g===null&&(g=[]),rn.hasNullElements(g))throw new Mt("holes must not contain null elements");if(u.isEmpty()&&rn.hasNonEmptyElements(g))throw new Mt("shell is empty but holes are not");this._shell=u,this._holes=g}}])})(rn),Zr=(function(_){function o(){return U(this,o),F(this,o,arguments)}return ce(o,_),f(o)})(Ma),Va=(function(_){function o(u){var g;return U(this,o),(g=F(this,o)).array=[],u instanceof oa&&g.addAll(u),g}return ce(o,_),f(o,[{key:"contains",value:function(u){var g,E=ue(this.array);try{for(E.s();!(g=E.n()).done;)if(g.value.compareTo(u)===0)return!0}catch(P){E.e(P)}finally{E.f()}return!1}},{key:"add",value:function(u){if(this.contains(u))return!1;for(var g=0,E=this.array.length;g<E;g++)if(this.array[g].compareTo(u)===1)return!!this.array.splice(g,0,u);return this.array.push(u),!0}},{key:"addAll",value:function(u){var g,E=ue(u);try{for(E.s();!(g=E.n()).done;){var P=g.value;this.add(P)}}catch(V){E.e(V)}finally{E.f()}return!0}},{key:"remove",value:function(){throw new er}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new li(this.array)}}])})(Zr),li=(function(){return f((function _(o){U(this,_),this.array=o,this.position=0}),[{key:"next",value:function(){if(this.position===this.array.length)throw new vi;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new er}}])})(),St=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"computeEnvelopeInternal",value:function(){for(var u=new Ln,g=0;g<this._geometries.length;g++)u.expandToInclude(this._geometries[g].getEnvelopeInternal());return u}},{key:"getGeometryN",value:function(u){return this._geometries[u]}},{key:"getCoordinates",value:function(){for(var u=new Array(this.getNumPoints()).fill(null),g=-1,E=0;E<this._geometries.length;E++)for(var P=this._geometries[E].getCoordinates(),V=0;V<P.length;V++)u[++g]=P[V];return u}},{key:"getArea",value:function(){for(var u=0,g=0;g<this._geometries.length;g++)u+=this._geometries[g].getArea();return u}},{key:"copyInternal",value:function(){for(var u=new Array(this._geometries.length).fill(null),g=0;g<u.length;g++)u[g]=this._geometries[g].copy();return new o(u,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];if(!this.isEquivalentClass(u))return!1;var E=u;if(this._geometries.length!==E._geometries.length)return!1;for(var P=0;P<this._geometries.length;P++)if(!this._geometries[P].equalsExact(E._geometries[P],g))return!1;return!0}return Fe(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var u=0;u<this._geometries.length;u++)this._geometries[u].normalize();Ca.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var u=xt.FALSE,g=0;g<this._geometries.length;g++)u=Math.max(u,this._geometries[g].getBoundaryDimension());return u}},{key:"reverseInternal",value:function(){for(var u=this._geometries.length,g=new Le(u),E=0;E<u;E++)g.add(this._geometries[E].reverse());return this.getFactory().buildGeometry(g)}},{key:"getTypeCode",value:function(){return rn.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var u=xt.FALSE,g=0;g<this._geometries.length;g++)u=Math.max(u,this._geometries[g].getDimension());return u}},{key:"getLength",value:function(){for(var u=0,g=0;g<this._geometries.length;g++)u+=this._geometries[g].getLength();return u}},{key:"getNumPoints",value:function(){for(var u=0,g=0;g<this._geometries.length;g++)u+=this._geometries[g].getNumPoints();return u}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var u=arguments[0],g=new Va(Ca.asList(this._geometries)),E=new Va(Ca.asList(u._geometries));return this.compare(g,E)}if(arguments.length===2){for(var P=arguments[1],V=arguments[0],$=this.getNumGeometries(),re=V.getNumGeometries(),fe=0;fe<$&&fe<re;){var Be=this.getGeometryN(fe),Xe=V.getGeometryN(fe),bt=Be.compareToSameClass(Xe,P);if(bt!==0)return bt;fe++}return fe<$?1:fe<re?-1:0}}},{key:"apply",value:function(){if(ln(arguments[0],Ge))for(var u=arguments[0],g=0;g<this._geometries.length;g++)this._geometries[g].apply(u);else if(ln(arguments[0],Xn)){var E=arguments[0];if(this._geometries.length===0)return null;for(var P=0;P<this._geometries.length&&(this._geometries[P].apply(E),!E.isDone());P++);E.isGeometryChanged()&&this.geometryChanged()}else if(ln(arguments[0],Zi)){var V=arguments[0];V.filter(this);for(var $=0;$<this._geometries.length;$++)this._geometries[$].apply(V)}else if(ln(arguments[0],Lt)){var re=arguments[0];re.filter(this);for(var fe=0;fe<this._geometries.length;fe++)this._geometries[fe].apply(re)}}},{key:"getBoundary",value:function(){return rn.checkNotGeometryCollection(this),Ct.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return rn.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var u=0;u<this._geometries.length;u++)if(!this._geometries[u].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var u=arguments[0],g=arguments[1];if(rn.constructor_.call(this,g),u===null&&(u=[]),rn.hasNullElements(u))throw new Mt("geometries must not contain null elements");this._geometries=u}}}}])})(rn),bn=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"copyInternal",value:function(){for(var u=new Array(this._geometries.length).fill(null),g=0;g<u.length;g++)u[g]=this._geometries[g].copy();return new o(u,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];return!!this.isEquivalentClass(u)&&Fe(o,"equalsExact",this,1).call(this,u,g)}return Fe(o,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var u=arguments[0];return this._geometries[u].getCoordinate()}return Fe(o,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return xt.FALSE}},{key:"getTypeCode",value:function(){return rn.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return rn.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[ni]}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];St.constructor_.call(this,u,g)}}])})(St),Tn=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"copyInternal",value:function(){return new o(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return xt.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||Fe(o,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var u=this._points.copy();return gn.reverse(u),this.getFactory().createLinearRing(u)}},{key:"getTypeCode",value:function(){return rn.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!Fe(o,"isClosed",this,1).call(this))throw new Mt("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<o.MINIMUM_VALID_SIZE)throw new Mt("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return rn.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];Ci.constructor_.call(this,u,g),this.validateConstruction()}}])})(Ci);Tn.MINIMUM_VALID_SIZE=4;var gr=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"setOrdinate",value:function(u,g){switch(u){case o.X:this.x=g;break;case o.Y:this.y=g;break;default:throw new Mt("Invalid ordinate index: "+u)}}},{key:"getZ",value:function(){return Ue.NULL_ORDINATE}},{key:"getOrdinate",value:function(u){switch(u){case o.X:return this.x;case o.Y:return this.y}throw new Mt("Invalid ordinate index: "+u)}},{key:"setZ",value:function(u){throw new Mt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(u){this.x=u.x,this.y=u.y,this.z=u.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Ue.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof o){var u=arguments[0];Ue.constructor_.call(this,u.x,u.y)}else if(arguments[0]instanceof Ue){var g=arguments[0];Ue.constructor_.call(this,g.x,g.y)}}else if(arguments.length===2){var E=arguments[0],P=arguments[1];Ue.constructor_.call(this,E,P,Ue.NULL_ORDINATE)}}}])})(Ue);gr.X=0,gr.Y=1,gr.Z=-1,gr.M=-1;var ws=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(u,g){switch(u){case o.X:this.x=g;break;case o.Y:this.y=g;break;case o.M:this._m=g;break;default:throw new Mt("Invalid ordinate index: "+u)}}},{key:"setM",value:function(u){this._m=u}},{key:"getZ",value:function(){return Ue.NULL_ORDINATE}},{key:"getOrdinate",value:function(u){switch(u){case o.X:return this.x;case o.Y:return this.y;case o.M:return this._m}throw new Mt("Invalid ordinate index: "+u)}},{key:"setZ",value:function(u){throw new Mt("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(u){this.x=u.x,this.y=u.y,this.z=u.getZ(),this._m=u.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Ue.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof o){var u=arguments[0];Ue.constructor_.call(this,u.x,u.y),this._m=u._m}else if(arguments[0]instanceof Ue){var g=arguments[0];Ue.constructor_.call(this,g.x,g.y),this._m=this.getM()}}else if(arguments.length===3){var E=arguments[0],P=arguments[1],V=arguments[2];Ue.constructor_.call(this,E,P,Ue.NULL_ORDINATE),this._m=V}}}])})(Ue);ws.X=0,ws.Y=1,ws.Z=-1,ws.M=2;var Ua=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(u,g){switch(u){case Ue.X:this.x=g;break;case Ue.Y:this.y=g;break;case Ue.Z:this.z=g;break;case Ue.M:this._m=g;break;default:throw new Mt("Invalid ordinate index: "+u)}}},{key:"setM",value:function(u){this._m=u}},{key:"getOrdinate",value:function(u){switch(u){case Ue.X:return this.x;case Ue.Y:return this.y;case Ue.Z:return this.getZ();case Ue.M:return this.getM()}throw new Mt("Invalid ordinate index: "+u)}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(u){this.x=u.x,this.y=u.y,this.z=u.getZ(),this._m=u.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Ue.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof o){var u=arguments[0];Ue.constructor_.call(this,u),this._m=u._m}else if(arguments[0]instanceof Ue){var g=arguments[0];Ue.constructor_.call(this,g),this._m=this.getM()}}else if(arguments.length===4){var E=arguments[0],P=arguments[1],V=arguments[2],$=arguments[3];Ue.constructor_.call(this,E,P,V),this._m=$}}}])})(Ue),yn=(function(){function _(){U(this,_)}return f(_,null,[{key:"measures",value:function(o){return o instanceof gr?0:o instanceof ws||o instanceof Ua?1:0}},{key:"dimension",value:function(o){return o instanceof gr?2:o instanceof ws?3:o instanceof Ua?4:3}},{key:"create",value:function(){if(arguments.length===1){var o=arguments[0];return _.create(o,0)}if(arguments.length===2){var u=arguments[0],g=arguments[1];return u===2?new gr:u===3&&g===0?new Ue:u===3&&g===1?new ws:u===4&&g===1?new Ua:new Ue}}}])})(),as=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"getCoordinate",value:function(u){return this.get(u)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&ln(arguments[0],oa)){for(var u=arguments[1],g=!1,E=arguments[0].iterator();E.hasNext();)this.add(E.next(),u),g=!0;return g}return Fe(o,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var u=Fe(o,"clone",this,1).call(this),g=0;g<this.size();g++)u.add(g,this.get(g).clone());return u}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(o.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(o.coordArrayType);for(var u=this.size(),g=new Array(u).fill(null),E=0;E<u;E++)g[E]=this.get(u-E-1);return g}}},{key:"add",value:function(){if(arguments.length===1){var u=arguments[0];return Fe(o,"add",this,1).call(this,u)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var g=arguments[0],E=arguments[1];return this.add(g,E,!0),!0}if(arguments[0]instanceof Ue&&typeof arguments[1]=="boolean"){var P=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(P))return null;Fe(o,"add",this,1).call(this,P)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var V=arguments[0],$=arguments[1];return this.add(V,$),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var re=arguments[0],fe=arguments[1];if(arguments[2])for(var Be=0;Be<re.length;Be++)this.add(re[Be],fe);else for(var Xe=re.length-1;Xe>=0;Xe--)this.add(re[Xe],fe);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Ue){var bt=arguments[0],Zt=arguments[1];if(!arguments[2]){var Qt=this.size();if(Qt>0&&(bt>0&&this.get(bt-1).equals2D(Zt)||bt<Qt&&this.get(bt).equals2D(Zt)))return null}Fe(o,"add",this,1).call(this,bt,Zt)}}else if(arguments.length===4){var un=arguments[0],zn=arguments[1],Cn=arguments[2],oi=arguments[3],ur=1;Cn>oi&&(ur=-1);for(var hi=Cn;hi!==oi;hi+=ur)this.add(un[hi],zn);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var u=this.get(0).copy();this.add(u,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var u=arguments[0];this.ensureCapacity(u.length),this.add(u,!0)}else if(arguments.length===2){var g=arguments[0],E=arguments[1];this.ensureCapacity(g.length),this.add(g,E)}}}}])})(Le);as.coordArrayType=new Array(0).fill(null);var ui=(function(){function _(){U(this,_)}return f(_,null,[{key:"isRing",value:function(o){return!(o.length<4)&&!!o[0].equals2D(o[o.length-1])}},{key:"ptNotInList",value:function(o,u){for(var g=0;g<o.length;g++){var E=o[g];if(_.indexOf(E,u)<0)return E}return null}},{key:"scroll",value:function(o,u){var g=_.indexOf(u,o);if(g<0)return null;var E=new Array(o.length).fill(null);qt.arraycopy(o,g,E,0,o.length-g),qt.arraycopy(o,0,E,o.length-g,g),qt.arraycopy(E,0,o,0,o.length)}},{key:"equals",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];if(o===u)return!0;if(o===null||u===null||o.length!==u.length)return!1;for(var g=0;g<o.length;g++)if(!o[g].equals(u[g]))return!1;return!0}if(arguments.length===3){var E=arguments[0],P=arguments[1],V=arguments[2];if(E===P)return!0;if(E===null||P===null||E.length!==P.length)return!1;for(var $=0;$<E.length;$++)if(V.compare(E[$],P[$])!==0)return!1;return!0}}},{key:"intersection",value:function(o,u){for(var g=new as,E=0;E<o.length;E++)u.intersects(o[E])&&g.add(o[E],!0);return g.toCoordinateArray()}},{key:"measures",value:function(o){if(o===null||o.length===0)return 0;var u,g=0,E=ue(o);try{for(E.s();!(u=E.n()).done;){var P=u.value;g=Math.max(g,yn.measures(P))}}catch(V){E.e(V)}finally{E.f()}return g}},{key:"hasRepeatedPoints",value:function(o){for(var u=1;u<o.length;u++)if(o[u-1].equals(o[u]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(o){return _.hasRepeatedPoints(o)?new as(o,!1).toCoordinateArray():o}},{key:"reverse",value:function(o){for(var u=o.length-1,g=Math.trunc(u/2),E=0;E<=g;E++){var P=o[E];o[E]=o[u-E],o[u-E]=P}}},{key:"removeNull",value:function(o){for(var u=0,g=0;g<o.length;g++)o[g]!==null&&u++;var E=new Array(u).fill(null);if(u===0)return E;for(var P=0,V=0;V<o.length;V++)o[V]!==null&&(E[P++]=o[V]);return E}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var o=arguments[0],u=new Array(o.length).fill(null),g=0;g<o.length;g++)u[g]=o[g].copy();return u}if(arguments.length===5)for(var E=arguments[0],P=arguments[1],V=arguments[2],$=arguments[3],re=arguments[4],fe=0;fe<re;fe++)V[$+fe]=E[P+fe].copy()}},{key:"isEqualReversed",value:function(o,u){for(var g=0;g<o.length;g++){var E=o[g],P=u[o.length-g-1];if(E.compareTo(P)!==0)return!1}return!0}},{key:"envelope",value:function(o){for(var u=new Ln,g=0;g<o.length;g++)u.expandToInclude(o[g]);return u}},{key:"toCoordinateArray",value:function(o){return o.toArray(_.coordArrayType)}},{key:"dimension",value:function(o){if(o===null||o.length===0)return 3;var u,g=0,E=ue(o);try{for(E.s();!(u=E.n()).done;){var P=u.value;g=Math.max(g,yn.dimension(P))}}catch(V){E.e(V)}finally{E.f()}return g}},{key:"atLeastNCoordinatesOrNothing",value:function(o,u){return u.length>=o?u:[]}},{key:"indexOf",value:function(o,u){for(var g=0;g<u.length;g++)if(o.equals(u[g]))return g;return-1}},{key:"increasingDirection",value:function(o){for(var u=0;u<Math.trunc(o.length/2);u++){var g=o.length-1-u,E=o[u].compareTo(o[g]);if(E!==0)return E}return 1}},{key:"compare",value:function(o,u){for(var g=0;g<o.length&&g<u.length;){var E=o[g].compareTo(u[g]);if(E!==0)return E;g++}return g<u.length?-1:g<o.length?1:0}},{key:"minCoordinate",value:function(o){for(var u=null,g=0;g<o.length;g++)(u===null||u.compareTo(o[g])>0)&&(u=o[g]);return u}},{key:"extract",value:function(o,u,g){u=pn.clamp(u,0,o.length);var E=(g=pn.clamp(g,-1,o.length))-u+1;g<0&&(E=0),u>=o.length&&(E=0),g<u&&(E=0);var P=new Array(E).fill(null);if(E===0)return P;for(var V=0,$=u;$<=g;$++)P[V++]=o[$];return P}}])})(),js=(function(){return f((function _(){U(this,_)}),[{key:"compare",value:function(_,o){var u=_,g=o;return ui.compare(u,g)}},{key:"interfaces_",get:function(){return[Re]}}])})(),Ts=(function(){return f((function _(){U(this,_)}),[{key:"compare",value:function(_,o){var u=_,g=o;if(u.length<g.length)return-1;if(u.length>g.length)return 1;if(u.length===0)return 0;var E=ui.compare(u,g);return ui.isEqualReversed(u,g)?0:E}},{key:"OLDcompare",value:function(_,o){var u=_,g=o;if(u.length<g.length)return-1;if(u.length>g.length)return 1;if(u.length===0)return 0;for(var E=ui.increasingDirection(u),P=ui.increasingDirection(g),V=E>0?0:u.length-1,$=P>0?0:u.length-1,re=0;re<u.length;re++){var fe=u[V].compareTo(g[$]);if(fe!==0)return fe;V+=E,$+=P}return 0}},{key:"interfaces_",get:function(){return[Re]}}])})();ui.ForwardComparator=js,ui.BidirectionalComparator=Ts,ui.coordArrayType=new Array(0).fill(null);var Ia=(function(){return f((function _(o){U(this,_),this.str=o}),[{key:"append",value:function(_){this.str+=_}},{key:"setCharAt",value:function(_,o){this.str=this.str.substr(0,_)+o+this.str.substr(_+1)}},{key:"toString",value:function(){return this.str}}])})(),xi=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getM",value:function(o){return this.hasM()?this._coordinates[o].getM():Pt.NaN}},{key:"setOrdinate",value:function(o,u,g){switch(u){case ve.X:this._coordinates[o].x=g;break;case ve.Y:this._coordinates[o].y=g;break;default:this._coordinates[o].setOrdinate(u,g)}}},{key:"getZ",value:function(o){return this.hasZ()?this._coordinates[o].getZ():Pt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(o,u){switch(u){case ve.X:return this._coordinates[o].x;case ve.Y:return this._coordinates[o].y;default:return this._coordinates[o].getOrdinate(u)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var o=arguments[0];return this._coordinates[o]}if(arguments.length===2){var u=arguments[0];arguments[1].setCoordinate(this._coordinates[u])}}},{key:"getCoordinateCopy",value:function(o){var u=this.createCoordinate();return u.setCoordinate(this._coordinates[o]),u}},{key:"createCoordinate",value:function(){return yn.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(o){return this._coordinates[o].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(o){for(var u=0;u<this._coordinates.length;u++)o.expandToInclude(this._coordinates[u]);return o}},{key:"copy",value:function(){for(var o=new Array(this.size()).fill(null),u=0;u<this._coordinates.length;u++){var g=this.createCoordinate();g.setCoordinate(this._coordinates[u]),o[u]=g}return new _(o,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var o=new Ia(17*this._coordinates.length);o.append("("),o.append(this._coordinates[0]);for(var u=1;u<this._coordinates.length;u++)o.append(", "),o.append(this._coordinates[u]);return o.append(")"),o.toString()}return"()"}},{key:"getY",value:function(o){return this._coordinates[o].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[ve,Ft]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];_.constructor_.call(this,o,ui.dimension(o),ui.measures(o))}else if(Number.isInteger(arguments[0])){var u=arguments[0];this._coordinates=new Array(u).fill(null);for(var g=0;g<u;g++)this._coordinates[g]=new Ue}else if(ln(arguments[0],ve)){var E=arguments[0];if(E===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=E.getDimension(),this._measures=E.getMeasures(),this._coordinates=new Array(E.size()).fill(null);for(var P=0;P<this._coordinates.length;P++)this._coordinates[P]=E.getCoordinateCopy(P)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var V=arguments[0],$=arguments[1];_.constructor_.call(this,V,$,ui.measures(V))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var re=arguments[0],fe=arguments[1];this._coordinates=new Array(re).fill(null),this._dimension=fe;for(var Be=0;Be<re;Be++)this._coordinates[Be]=yn.create(fe)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var Xe=arguments[0],bt=arguments[1],Zt=arguments[2];this._dimension=bt,this._measures=Zt,this._coordinates=Xe===null?new Array(0).fill(null):Xe}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var Qt=arguments[0],un=arguments[1],zn=arguments[2];this._coordinates=new Array(Qt).fill(null),this._dimension=un,this._measures=zn;for(var Cn=0;Cn<Qt;Cn++)this._coordinates[Cn]=this.createCoordinate()}}}}])})(),lo=(function(){function _(){U(this,_)}return f(_,[{key:"readResolve",value:function(){return _.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new xi(arguments[0]);if(ln(arguments[0],ve))return new xi(arguments[0])}else{if(arguments.length===2){var o=arguments[1];return o>3&&(o=3),o<2&&(o=2),new xi(arguments[0],o)}if(arguments.length===3){var u=arguments[2],g=arguments[1]-u;return u>1&&(u=1),g>3&&(g=3),g<2&&(g=2),new xi(arguments[0],g+u,u)}}}},{key:"interfaces_",get:function(){return[Fn,Ft]}}],[{key:"instance",value:function(){return _.instanceObject}}])})();lo.instanceObject=new lo;var Tr=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"copyInternal",value:function(){for(var u=new Array(this._geometries.length).fill(null),g=0;g<u.length;g++)u[g]=this._geometries[g].copy();return new o(u,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];return!!this.isEquivalentClass(u)&&Fe(o,"equalsExact",this,1).call(this,u,g)}return Fe(o,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return rn.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var u=new Le,g=0;g<this._geometries.length;g++)for(var E=this._geometries[g].getBoundary(),P=0;P<E.getNumGeometries();P++)u.add(E.getGeometryN(P));var V=new Array(u.size()).fill(null);return this.getFactory().createMultiLineString(u.toArray(V))}},{key:"getGeometryType",value:function(){return rn.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[It]}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];St.constructor_.call(this,u,g)}}])})(St),Vn=(function(){return f((function _(){U(this,_)}),[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])})(),Gs=(function(_){function o(){var u;return U(this,o),(u=F(this,o)).map=new Map,u}return ce(o,_),f(o,[{key:"get",value:function(u){return this.map.get(u)||null}},{key:"put",value:function(u,g){return this.map.set(u,g),g}},{key:"values",value:function(){for(var u=new Le,g=this.map.values(),E=g.next();!E.done;)u.add(E.value),E=g.next();return u}},{key:"entrySet",value:function(){var u=new Ai;return this.map.entries().forEach((function(g){return u.add(g)})),u}},{key:"size",value:function(){return this.map.size()}}])})(Vn),Yr=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"equals",value:function(o){if(!(o instanceof _))return!1;var u=o;return this._modelType===u._modelType&&this._scale===u._scale}},{key:"compareTo",value:function(o){var u=o,g=this.getMaximumSignificantDigits(),E=u.getMaximumSignificantDigits();return je.compare(g,E)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===_.FLOATING||this._modelType===_.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var o="UNKNOWN";return this._modelType===_.FLOATING?o="Floating":this._modelType===_.FLOATING_SINGLE?o="Floating-Single":this._modelType===_.FIXED&&(o="Fixed (Scale="+this.getScale()+")"),o}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var o=arguments[0];return Pt.isNaN(o)||this._modelType===_.FLOATING_SINGLE?o:this._modelType===_.FIXED?Math.round(o*this._scale)/this._scale:o}if(arguments[0]instanceof Ue){var u=arguments[0];if(this._modelType===_.FLOATING)return null;u.x=this.makePrecise(u.x),u.y=this.makePrecise(u.y)}}},{key:"getMaximumSignificantDigits",value:function(){var o=16;return this._modelType===_.FLOATING?o=16:this._modelType===_.FLOATING_SINGLE?o=6:this._modelType===_.FIXED&&(o=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),o}},{key:"setScale",value:function(o){this._scale=Math.abs(o)}},{key:"interfaces_",get:function(){return[Ft,_t]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=_.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof ss){var o=arguments[0];this._modelType=o,o===_.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var u=arguments[0];this._modelType=_.FIXED,this.setScale(u)}else if(arguments[0]instanceof _){var g=arguments[0];this._modelType=g._modelType,this._scale=g._scale}}}},{key:"mostPrecise",value:function(o,u){return o.compareTo(u)>=0?o:u}}])})(),ss=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"readResolve",value:function(){return _.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[Ft]}}],[{key:"constructor_",value:function(){this._name=null;var o=arguments[0];this._name=o,_.nameToTypeMap.put(o,this)}}])})();ss.nameToTypeMap=new Gs,Yr.Type=ss,Yr.FIXED=new ss("FIXED"),Yr.FLOATING=new ss("FLOATING"),Yr.FLOATING_SINGLE=new ss("FLOATING SINGLE"),Yr.maximumPreciseValue=9007199254740992;var Ss=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"copyInternal",value:function(){for(var u=new Array(this._geometries.length).fill(null),g=0;g<u.length;g++)u[g]=this._geometries[g].copy();return new o(u,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];return!!this.isEquivalentClass(u)&&Fe(o,"equalsExact",this,1).call(this,u,g)}return Fe(o,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?xt.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var u=0;u<this._geometries.length;u++)if(!this._geometries[u].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return rn.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new er}},{key:"getGeometryType",value:function(){return rn.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[qi]}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];St.constructor_.call(this,u,g)}}])})(St),Hr=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"createEmpty",value:function(o){switch(o){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new Mt("Invalid dimension: "+o)}}},{key:"toGeometry",value:function(o){return o.isNull()?this.createPoint():o.getMinX()===o.getMaxX()&&o.getMinY()===o.getMaxY()?this.createPoint(new Ue(o.getMinX(),o.getMinY())):o.getMinX()===o.getMaxX()||o.getMinY()===o.getMaxY()?this.createLineString([new Ue(o.getMinX(),o.getMinY()),new Ue(o.getMaxX(),o.getMaxY())]):this.createPolygon(this.createLinearRing([new Ue(o.getMinX(),o.getMinY()),new Ue(o.getMinX(),o.getMaxY()),new Ue(o.getMaxX(),o.getMaxY()),new Ue(o.getMaxX(),o.getMinY()),new Ue(o.getMinX(),o.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];return this.createLineString(o!==null?this.getCoordinateSequenceFactory().create(o):null)}if(ln(arguments[0],ve))return new Ci(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new Ss(null,this):arguments.length===1?new Ss(arguments[0],this):void 0}},{key:"buildGeometry",value:function(o){for(var u=null,g=!1,E=!1,P=o.iterator();P.hasNext();){var V=P.next(),$=V.getTypeCode();u===null&&(u=$),$!==u&&(g=!0),V instanceof St&&(E=!0)}if(u===null)return this.createGeometryCollection();if(g||E)return this.createGeometryCollection(_.toGeometryArray(o));var re=o.iterator().next();if(o.size()>1){if(re instanceof mr)return this.createMultiPolygon(_.toPolygonArray(o));if(re instanceof Ci)return this.createMultiLineString(_.toLineStringArray(o));if(re instanceof Ni)return this.createMultiPoint(_.toPointArray(o));Ct.shouldNeverReachHere("Unhandled geometry type: "+re.getGeometryType())}return re}},{key:"createMultiPointFromCoords",value:function(o){return this.createMultiPoint(o!==null?this.getCoordinateSequenceFactory().create(o):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Ue){var o=arguments[0];return this.createPoint(o!==null?this.getCoordinateSequenceFactory().create([o]):null)}if(ln(arguments[0],ve))return new Ni(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(ln(arguments[0],ve)){var o=arguments[0];return this.createPolygon(this.createLinearRing(o))}if(arguments[0]instanceof Array){var u=arguments[0];return this.createPolygon(this.createLinearRing(u))}if(arguments[0]instanceof Tn){var g=arguments[0];return this.createPolygon(g,null)}}else if(arguments.length===2)return new mr(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new St(null,this):arguments.length===1?new St(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];return this.createLinearRing(o!==null?this.getCoordinateSequenceFactory().create(o):null)}if(ln(arguments[0],ve))return new Tn(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new Tr(null,this):arguments.length===1?new Tr(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new bn(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new bn(arguments[0],this);if(ln(arguments[0],ve)){var o=arguments[0];if(o===null)return this.createMultiPoint(new Array(0).fill(null));for(var u=new Array(o.size()).fill(null),g=0;g<o.size();g++){var E=this.getCoordinateSequenceFactory().create(1,o.getDimension(),o.getMeasures());gn.copy(o,g,E,0,1),u[g]=this.createPoint(E)}return this.createMultiPoint(u)}}}},{key:"interfaces_",get:function(){return[Ft]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)_.constructor_.call(this,new Yr,0);else if(arguments.length===1){if(ln(arguments[0],Fn)){var o=arguments[0];_.constructor_.call(this,new Yr,0,o)}else if(arguments[0]instanceof Yr){var u=arguments[0];_.constructor_.call(this,u,0,_.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var g=arguments[0],E=arguments[1];_.constructor_.call(this,g,E,_.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var P=arguments[0],V=arguments[1],$=arguments[2];this._precisionModel=P,this._coordinateSequenceFactory=$,this._SRID=V}}},{key:"toMultiPolygonArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toGeometryArray",value:function(o){if(o===null)return null;var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return lo.instance()}},{key:"toMultiLineStringArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toLineStringArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toMultiPointArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toLinearRingArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toPointArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toPolygonArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"createPointFromInternalCoord",value:function(o,u){return u.getPrecisionModel().makePrecise(o),u.getFactory().createPoint(o)}}])})(),Fo="XY",Es="XYZ",ja="XYM",Yn="XYZM",Du={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},mc="EMPTY",Ms=1,os=2,Ga=3,gc=4,lr=5,ql=6;for(var Pu in Du)Du[Pu].toUpperCase();var Zl=(function(){return f((function _(o){U(this,_),this.wkt=o,this.index_=-1}),[{key:"isAlpha_",value:function(_){return _>="a"&&_<="z"||_>="A"&&_<="Z"}},{key:"isNumeric_",value:function(_,o){return _>="0"&&_<="9"||_=="."&&!(o!==void 0&&o)}},{key:"isWhiteSpace_",value:function(_){return _==" "||_=="	"||_=="\r"||_==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var _,o=this.nextChar_(),u=this.index_,g=o;if(o=="(")_=os;else if(o==",")_=lr;else if(o==")")_=Ga;else if(this.isNumeric_(o)||o=="-")_=gc,g=this.readNumber_();else if(this.isAlpha_(o))_=Ms,g=this.readText_();else{if(this.isWhiteSpace_(o))return this.nextToken();if(o!=="")throw new Error("Unexpected character: "+o);_=ql}return{position:u,value:g,type:_}}},{key:"readNumber_",value:function(){var _,o=this.index_,u=!1,g=!1;do _=="."?u=!0:_!="e"&&_!="E"||(g=!0),_=this.nextChar_();while(this.isNumeric_(_,u)||!g&&(_=="e"||_=="E")||g&&(_=="-"||_=="+"));return parseFloat(this.wkt.substring(o,this.index_--))}},{key:"readText_",value:function(){var _,o=this.index_;do _=this.nextChar_();while(this.isAlpha_(_));return this.wkt.substring(o,this.index_--).toUpperCase()}}])})(),uo=(function(){return f((function _(o,u){U(this,_),this.lexer_=o,this.token_,this.layout_=Fo,this.factory=u}),[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(_){return this.token_.type==_}},{key:"match",value:function(_){var o=this.isTokenType(_);return o&&this.consume_(),o}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var _=Fo,o=this.token_;if(this.isTokenType(Ms)){var u=o.value;u==="Z"?_=Es:u==="M"?_=ja:u==="ZM"&&(_=Yn),_!==Fo&&this.consume_()}return _}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(os)){var _=[];do _.push(this.parseGeometry_());while(this.match(lr));if(this.match(Ga))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(os)){var _=this.parsePoint_();if(this.match(Ga))return _}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(os)){var _=this.parsePointList_();if(this.match(Ga))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(os)){var _=this.parseLineStringTextList_();if(this.match(Ga))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var _;if(this.match(os)){if(_=this.token_.type==os?this.parsePointTextList_():this.parsePointList_(),this.match(Ga))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(os)){var _=this.parseLineStringTextList_();if(this.match(Ga))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(os)){var _=this.parsePolygonTextList_();if(this.match(Ga))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var _=[],o=this.layout_.length,u=0;u<o;++u){var g=this.token_;if(!this.match(gc))break;_.push(g.value)}if(_.length==o)return _;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var _=[this.parsePoint_()];this.match(lr);)_.push(this.parsePoint_());return _}},{key:"parsePointTextList_",value:function(){for(var _=[this.parsePointText_()];this.match(lr);)_.push(this.parsePointText_());return _}},{key:"parseLineStringTextList_",value:function(){for(var _=[this.parseLineStringText_()];this.match(lr);)_.push(this.parseLineStringText_());return _}},{key:"parsePolygonTextList_",value:function(){for(var _=[this.parsePolygonText_()];this.match(lr);)_.push(this.parsePolygonText_());return _}},{key:"isEmptyGeometry_",value:function(){var _=this.isTokenType(Ms)&&this.token_.value==mc;return _&&this.consume_(),_}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var _=this.factory,o=function(un){return ee(Ue,at(un))},u=function(un){var zn=un.map((function(Cn){return _.createLinearRing(Cn.map(o))}));return zn.length>1?_.createPolygon(zn[0],zn.slice(1)):_.createPolygon(zn[0])},g=this.token_;if(this.match(Ms)){var E=g.value;if(this.layout_=this.parseGeometryLayout_(),E=="GEOMETRYCOLLECTION"){var P=this.parseGeometryCollectionText_();return _.createGeometryCollection(P)}switch(E){case"POINT":var V=this.parsePointText_();return V?_.createPoint(ee(Ue,at(V))):_.createPoint();case"LINESTRING":var $=this.parseLineStringText_().map(o);return _.createLineString($);case"LINEARRING":var re=this.parseLineStringText_().map(o);return _.createLinearRing(re);case"POLYGON":var fe=this.parsePolygonText_();return fe&&fe.length!==0?u(fe):_.createPolygon();case"MULTIPOINT":var Be=this.parseMultiPointText_();if(!Be||Be.length===0)return _.createMultiPoint();var Xe=Be.map(o).map((function(un){return _.createPoint(un)}));return _.createMultiPoint(Xe);case"MULTILINESTRING":var bt=this.parseMultiLineStringText_().map((function(un){return _.createLineString(un.map(o))}));return _.createMultiLineString(bt);case"MULTIPOLYGON":var Zt=this.parseMultiPolygonText_();if(!Zt||Zt.length===0)return _.createMultiPolygon();var Qt=Zt.map(u);return _.createMultiPolygon(Qt);default:throw new Error("Invalid geometry type: "+E)}}throw new Error(this.formatErrorMessage_())}}])})();function _c(_){if(_.isEmpty())return"";var o=_.getCoordinate(),u=[o.x,o.y];return o.z===void 0||Number.isNaN(o.z)||u.push(o.z),o.m===void 0||Number.isNaN(o.m)||u.push(o.m),u.join(" ")}function Cs(_){for(var o=_.getCoordinates().map((function(P){var V=[P.x,P.y];return P.z===void 0||Number.isNaN(P.z)||V.push(P.z),P.m===void 0||Number.isNaN(P.m)||V.push(P.m),V})),u=[],g=0,E=o.length;g<E;++g)u.push(o[g].join(" "));return u.join(", ")}function Is(_){var o=[];o.push("("+Cs(_.getExteriorRing())+")");for(var u=0,g=_.getNumInteriorRing();u<g;++u)o.push("("+Cs(_.getInteriorRingN(u))+")");return o.join(", ")}var ih={Point:_c,LineString:Cs,LinearRing:Cs,Polygon:Is,MultiPoint:function(_){for(var o=[],u=0,g=_.getNumGeometries();u<g;++u)o.push("("+_c(_.getGeometryN(u))+")");return o.join(", ")},MultiLineString:function(_){for(var o=[],u=0,g=_.getNumGeometries();u<g;++u)o.push("("+Cs(_.getGeometryN(u))+")");return o.join(", ")},MultiPolygon:function(_){for(var o=[],u=0,g=_.getNumGeometries();u<g;++u)o.push("("+Is(_.getGeometryN(u))+")");return o.join(", ")},GeometryCollection:function(_){for(var o=[],u=0,g=_.getNumGeometries();u<g;++u)o.push(co(_.getGeometryN(u)));return o.join(", ")}};function co(_){var o=_.getGeometryType(),u=ih[o];o=o.toUpperCase();var g=(function(E){var P="";if(E.isEmpty())return P;var V=E.getCoordinate();return V.z===void 0||Number.isNaN(V.z)||(P+="Z"),V.m===void 0||Number.isNaN(V.m)||(P+="M"),P})(_);return g.length>0&&(o+=" "+g),_.isEmpty()?o+" "+mc:o+" ("+u(_)+")"}var Ru=(function(){return f((function _(o){U(this,_),this.geometryFactory=o||new Hr,this.precisionModel=this.geometryFactory.getPrecisionModel()}),[{key:"read",value:function(_){var o=new Zl(_);return new uo(o,this.geometryFactory).parse()}},{key:"write",value:function(_){return co(_)}}])})(),qs=(function(){return f((function _(o){U(this,_),this.parser=new Ru(o)}),[{key:"write",value:function(_){return this.parser.write(_)}}],[{key:"toLineString",value:function(_,o){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+_.x+" "+_.y+", "+o.x+" "+o.y+" )"}}])})(),ei=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getIndexAlongSegment",value:function(o,u){return this.computeIntLineIndex(),this._intLineIndex[o][u]}},{key:"getTopologySummary",value:function(){var o=new Ia;return this.isEndPoint()&&o.append(" endpoint"),this._isProper&&o.append(" proper"),this.isCollinear()&&o.append(" collinear"),o.toString()}},{key:"computeIntersection",value:function(o,u,g,E){this._inputLines[0][0]=o,this._inputLines[0][1]=u,this._inputLines[1][0]=g,this._inputLines[1][1]=E,this._result=this.computeIntersect(o,u,g,E)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var o=arguments[0];this.getEdgeDistance(o,0)>this.getEdgeDistance(o,1)?(this._intLineIndex[o][0]=0,this._intLineIndex[o][1]=1):(this._intLineIndex[o][0]=1,this._intLineIndex[o][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(o){this._precisionModel=o}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var o=arguments[0],u=0;u<this._result;u++)if(!this._intPt[u].equals2D(this._inputLines[o][0])&&!this._intPt[u].equals2D(this._inputLines[o][1]))return!0;return!1}}},{key:"getIntersection",value:function(o){return this._intPt[o]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==_.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(o,u){return _.computeEdgeDistance(this._intPt[u],this._inputLines[o][0],this._inputLines[o][1])}},{key:"isCollinear",value:function(){return this._result===_.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return qs.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+qs.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(o,u){return this._inputLines[o][u]}},{key:"isIntersection",value:function(o){for(var u=0;u<this._result;u++)if(this._intPt[u].equals2D(o))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(o,u){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[o][u]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Ue,this._intPt[1]=new Ue,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(o,u,g){var E=Math.abs(g.x-u.x),P=Math.abs(g.y-u.y),V=-1;if(o.equals(u))V=0;else if(o.equals(g))V=E>P?E:P;else{var $=Math.abs(o.x-u.x),re=Math.abs(o.y-u.y);(V=E>P?$:re)!==0||o.equals(u)||(V=Math.max($,re))}return Ct.isTrue(!(V===0&&!o.equals(u)),"Bad distance calculation"),V}},{key:"nonRobustComputeEdgeDistance",value:function(o,u,g){var E=o.x-u.x,P=o.y-u.y,V=Math.sqrt(E*E+P*P);return Ct.isTrue(!(V===0&&!o.equals(u)),"Invalid distance calculation"),V}}])})();ei.DONT_INTERSECT=0,ei.DO_INTERSECT=1,ei.COLLINEAR=2,ei.NO_INTERSECTION=0,ei.POINT_INTERSECTION=1,ei.COLLINEAR_INTERSECTION=2;var qa=(function(_){function o(){return U(this,o),F(this,o)}return ce(o,_),f(o,[{key:"isInSegmentEnvelopes",value:function(u){var g=new Ln(this._inputLines[0][0],this._inputLines[0][1]),E=new Ln(this._inputLines[1][0],this._inputLines[1][1]);return g.contains(u)&&E.contains(u)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return Fe(o,"computeIntersection",this,1).apply(this,arguments);var u=arguments[0],g=arguments[1],E=arguments[2];if(this._isProper=!1,Ln.intersects(g,E,u)&&xe.index(g,E,u)===0&&xe.index(E,g,u)===0)return this._isProper=!0,(u.equals(g)||u.equals(E))&&(this._isProper=!1),this._result=ei.POINT_INTERSECTION,null;this._result=ei.NO_INTERSECTION}},{key:"intersection",value:function(u,g,E,P){var V=this.intersectionSafe(u,g,E,P);return this.isInSegmentEnvelopes(V)||(V=new Ue(o.nearestEndpoint(u,g,E,P))),this._precisionModel!==null&&this._precisionModel.makePrecise(V),V}},{key:"checkDD",value:function(u,g,E,P,V){var $=oe.intersection(u,g,E,P),re=this.isInSegmentEnvelopes($);qt.out.println("DD in env = "+re+"  --------------------- "+$),V.distance($)>1e-4&&qt.out.println("Distance = "+V.distance($))}},{key:"intersectionSafe",value:function(u,g,E,P){var V=Ut.intersection(u,g,E,P);return V===null&&(V=o.nearestEndpoint(u,g,E,P)),V}},{key:"computeCollinearIntersection",value:function(u,g,E,P){var V=Ln.intersects(u,g,E),$=Ln.intersects(u,g,P),re=Ln.intersects(E,P,u),fe=Ln.intersects(E,P,g);return V&&$?(this._intPt[0]=E,this._intPt[1]=P,ei.COLLINEAR_INTERSECTION):re&&fe?(this._intPt[0]=u,this._intPt[1]=g,ei.COLLINEAR_INTERSECTION):V&&re?(this._intPt[0]=E,this._intPt[1]=u,!E.equals(u)||$||fe?ei.COLLINEAR_INTERSECTION:ei.POINT_INTERSECTION):V&&fe?(this._intPt[0]=E,this._intPt[1]=g,!E.equals(g)||$||re?ei.COLLINEAR_INTERSECTION:ei.POINT_INTERSECTION):$&&re?(this._intPt[0]=P,this._intPt[1]=u,!P.equals(u)||V||fe?ei.COLLINEAR_INTERSECTION:ei.POINT_INTERSECTION):$&&fe?(this._intPt[0]=P,this._intPt[1]=g,!P.equals(g)||V||re?ei.COLLINEAR_INTERSECTION:ei.POINT_INTERSECTION):ei.NO_INTERSECTION}},{key:"computeIntersect",value:function(u,g,E,P){if(this._isProper=!1,!Ln.intersects(u,g,E,P))return ei.NO_INTERSECTION;var V=xe.index(u,g,E),$=xe.index(u,g,P);if(V>0&&$>0||V<0&&$<0)return ei.NO_INTERSECTION;var re=xe.index(E,P,u),fe=xe.index(E,P,g);return re>0&&fe>0||re<0&&fe<0?ei.NO_INTERSECTION:V===0&&$===0&&re===0&&fe===0?this.computeCollinearIntersection(u,g,E,P):(V===0||$===0||re===0||fe===0?(this._isProper=!1,u.equals2D(E)||u.equals2D(P)?this._intPt[0]=u:g.equals2D(E)||g.equals2D(P)?this._intPt[0]=g:V===0?this._intPt[0]=new Ue(E):$===0?this._intPt[0]=new Ue(P):re===0?this._intPt[0]=new Ue(u):fe===0&&(this._intPt[0]=new Ue(g))):(this._isProper=!0,this._intPt[0]=this.intersection(u,g,E,P)),ei.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(u,g,E,P){var V=u,$=Dn.pointToSegment(u,E,P),re=Dn.pointToSegment(g,E,P);return re<$&&($=re,V=g),(re=Dn.pointToSegment(E,u,g))<$&&($=re,V=E),(re=Dn.pointToSegment(P,u,g))<$&&($=re,V=P),V}}])})(ei),In=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"countSegment",value:function(o,u){if(o.x<this._p.x&&u.x<this._p.x)return null;if(this._p.x===u.x&&this._p.y===u.y)return this._isPointOnSegment=!0,null;if(o.y===this._p.y&&u.y===this._p.y){var g=o.x,E=u.x;return g>E&&(g=u.x,E=o.x),this._p.x>=g&&this._p.x<=E&&(this._isPointOnSegment=!0),null}if(o.y>this._p.y&&u.y<=this._p.y||u.y>this._p.y&&o.y<=this._p.y){var P=xe.index(o,u,this._p);if(P===xe.COLLINEAR)return this._isPointOnSegment=!0,null;u.y<o.y&&(P=-P),P===xe.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==Se.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?Se.BOUNDARY:this._crossingCount%2==1?Se.INTERIOR:Se.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var o=arguments[0];this._p=o}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Ue&&ln(arguments[1],ve)){for(var o=arguments[1],u=new _(arguments[0]),g=new Ue,E=new Ue,P=1;P<o.size();P++)if(o.getCoordinate(P,g),o.getCoordinate(P-1,E),u.countSegment(g,E),u.isOnSegment())return u.getLocation();return u.getLocation()}if(arguments[0]instanceof Ue&&arguments[1]instanceof Array){for(var V=arguments[1],$=new _(arguments[0]),re=1;re<V.length;re++){var fe=V[re],Be=V[re-1];if($.countSegment(fe,Be),$.isOnSegment())return $.getLocation()}return $.getLocation()}}}])})(),Aa=(function(){function _(){U(this,_)}return f(_,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Ue&&ln(arguments[1],ve)){for(var o=arguments[0],u=arguments[1],g=new qa,E=new Ue,P=new Ue,V=u.size(),$=1;$<V;$++)if(u.getCoordinate($-1,E),u.getCoordinate($,P),g.computeIntersection(o,E,P),g.hasIntersection())return!0;return!1}if(arguments[0]instanceof Ue&&arguments[1]instanceof Array){for(var re=arguments[0],fe=arguments[1],Be=new qa,Xe=1;Xe<fe.length;Xe++){var bt=fe[Xe-1],Zt=fe[Xe];if(Be.computeIntersection(re,bt,Zt),Be.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(o,u){return In.locatePointInRing(o,u)}},{key:"isInRing",value:function(o,u){return _.locateInRing(o,u)!==Se.EXTERIOR}}])})(),ga=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"setAllLocations",value:function(o){for(var u=0;u<this.location.length;u++)this.location[u]=o}},{key:"isNull",value:function(){for(var o=0;o<this.location.length;o++)if(this.location[o]!==Se.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(o){for(var u=0;u<this.location.length;u++)this.location[u]===Se.NONE&&(this.location[u]=o)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(o){if(o.location.length>this.location.length){var u=new Array(3).fill(null);u[Dt.ON]=this.location[Dt.ON],u[Dt.LEFT]=Se.NONE,u[Dt.RIGHT]=Se.NONE,this.location=u}for(var g=0;g<this.location.length;g++)this.location[g]===Se.NONE&&g<o.location.length&&(this.location[g]=o.location[g])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var o=this.location[Dt.LEFT];this.location[Dt.LEFT]=this.location[Dt.RIGHT],this.location[Dt.RIGHT]=o}},{key:"toString",value:function(){var o=new wr;return this.location.length>1&&o.append(Se.toLocationSymbol(this.location[Dt.LEFT])),o.append(Se.toLocationSymbol(this.location[Dt.ON])),this.location.length>1&&o.append(Se.toLocationSymbol(this.location[Dt.RIGHT])),o.toString()}},{key:"setLocations",value:function(o,u,g){this.location[Dt.ON]=o,this.location[Dt.LEFT]=u,this.location[Dt.RIGHT]=g}},{key:"get",value:function(o){return o<this.location.length?this.location[o]:Se.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var o=0;o<this.location.length;o++)if(this.location[o]===Se.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var o=arguments[0];this.setLocation(Dt.ON,o)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.location[u]=g}}},{key:"init",value:function(o){this.location=new Array(o).fill(null),this.setAllLocations(Se.NONE)}},{key:"isEqualOnSide",value:function(o,u){return this.location[u]===o.location[u]}},{key:"allPositionsEqual",value:function(o){for(var u=0;u<this.location.length;u++)if(this.location[u]!==o)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];this.init(o.length)}else if(Number.isInteger(arguments[0])){var u=arguments[0];this.init(1),this.location[Dt.ON]=u}else if(arguments[0]instanceof _){var g=arguments[0];if(this.init(g.location.length),g!==null)for(var E=0;E<this.location.length;E++)this.location[E]=g.location[E]}}else if(arguments.length===3){var P=arguments[0],V=arguments[1],$=arguments[2];this.init(3),this.location[Dt.ON]=P,this.location[Dt.LEFT]=V,this.location[Dt.RIGHT]=$}}}])})(),Xr=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getGeometryCount",value:function(){var o=0;return this.elt[0].isNull()||o++,this.elt[1].isNull()||o++,o}},{key:"setAllLocations",value:function(o,u){this.elt[o].setAllLocations(u)}},{key:"isNull",value:function(o){return this.elt[o].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var o=arguments[0];this.setAllLocationsIfNull(0,o),this.setAllLocationsIfNull(1,o)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.elt[u].setAllLocationsIfNull(g)}}},{key:"isLine",value:function(o){return this.elt[o].isLine()}},{key:"merge",value:function(o){for(var u=0;u<2;u++)this.elt[u]===null&&o.elt[u]!==null?this.elt[u]=new ga(o.elt[u]):this.elt[u].merge(o.elt[u])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var o=arguments[0];return this.elt[o].get(Dt.ON)}if(arguments.length===2){var u=arguments[0],g=arguments[1];return this.elt[u].get(g)}}},{key:"toString",value:function(){var o=new wr;return this.elt[0]!==null&&(o.append("A:"),o.append(this.elt[0].toString())),this.elt[1]!==null&&(o.append(" B:"),o.append(this.elt[1].toString())),o.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var o=arguments[0];return this.elt[o].isArea()}}},{key:"isAnyNull",value:function(o){return this.elt[o].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];this.elt[o].setLocation(Dt.ON,u)}else if(arguments.length===3){var g=arguments[0],E=arguments[1],P=arguments[2];this.elt[g].setLocation(E,P)}}},{key:"isEqualOnSide",value:function(o,u){return this.elt[0].isEqualOnSide(o.elt[0],u)&&this.elt[1].isEqualOnSide(o.elt[1],u)}},{key:"allPositionsEqual",value:function(o,u){return this.elt[o].allPositionsEqual(u)}},{key:"toLine",value:function(o){this.elt[o].isArea()&&(this.elt[o]=new ga(this.elt[o].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var o=arguments[0];this.elt[0]=new ga(o),this.elt[1]=new ga(o)}else if(arguments[0]instanceof _){var u=arguments[0];this.elt[0]=new ga(u.elt[0]),this.elt[1]=new ga(u.elt[1])}}else if(arguments.length===2){var g=arguments[0],E=arguments[1];this.elt[0]=new ga(Se.NONE),this.elt[1]=new ga(Se.NONE),this.elt[g].setLocation(E)}else if(arguments.length===3){var P=arguments[0],V=arguments[1],$=arguments[2];this.elt[0]=new ga(P,V,$),this.elt[1]=new ga(P,V,$)}else if(arguments.length===4){var re=arguments[0],fe=arguments[1],Be=arguments[2],Xe=arguments[3];this.elt[0]=new ga(Se.NONE,Se.NONE,Se.NONE),this.elt[1]=new ga(Se.NONE,Se.NONE,Se.NONE),this.elt[re].setLocations(fe,Be,Xe)}}},{key:"toLineLabel",value:function(o){for(var u=new _(Se.NONE),g=0;g<2;g++)u.setLocation(g,o.getLocation(g));return u}}])})(),Yi=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var _=new Array(this._pts.size()).fill(null),o=0;o<this._pts.size();o++)_[o]=this._pts.get(o);this._ring=this._geometryFactory.createLinearRing(_),this._isHole=xe.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(_){this._startDe=_;var o=_,u=!0;do{if(o===null)throw new Ve("Found null DirectedEdge");if(o.getEdgeRing()===this)throw new Ve("Directed Edge visited twice during ring-building at "+o.getCoordinate());this._edges.add(o);var g=o.getLabel();Ct.isTrue(g.isArea()),this.mergeLabel(g),this.addPoints(o.getEdge(),o.isForward(),u),u=!1,this.setEdgeRing(o,this),o=this.getNext(o)}while(o!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(_){return this._pts.get(_)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var _=this._startDe;do{var o=_.getNode().getEdges().getOutgoingDegree(this);o>this._maxNodeDegree&&(this._maxNodeDegree=o),_=this.getNext(_)}while(_!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(_,o,u){var g=_.getCoordinates();if(o){var E=1;u&&(E=0);for(var P=E;P<g.length;P++)this._pts.add(g[P])}else{var V=g.length-2;u&&(V=g.length-1);for(var $=V;$>=0;$--)this._pts.add(g[$])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var _=this._startDe;do _.getEdge().setInResult(!0),_=_.getNext();while(_!==this._startDe)}},{key:"containsPoint",value:function(_){var o=this.getLinearRing();if(!o.getEnvelopeInternal().contains(_)||!Aa.isInRing(_,o.getCoordinates()))return!1;for(var u=this._holes.iterator();u.hasNext();)if(u.next().containsPoint(_))return!1;return!0}},{key:"addHole",value:function(_){this._holes.add(_)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var _=arguments[0];this.mergeLabel(_,0),this.mergeLabel(_,1)}else if(arguments.length===2){var o=arguments[1],u=arguments[0].getLocation(o,Dt.RIGHT);if(u===Se.NONE)return null;if(this._label.getLocation(o)===Se.NONE)return this._label.setLocation(o,u),null}}},{key:"setShell",value:function(_){this._shell=_,_!==null&&_.addHole(this)}},{key:"toPolygon",value:function(_){for(var o=new Array(this._holes.size()).fill(null),u=0;u<this._holes.size();u++)o[u]=this._holes.get(u).getLinearRing();return _.createPolygon(this.getLinearRing(),o)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new Le,this._pts=new Le,this._label=new Xr(Se.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Le,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var _=arguments[0],o=arguments[1];this._geometryFactory=o,this.computePoints(_),this.computeRing()}}}}])})(),tr=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"setEdgeRing",value:function(u,g){u.setMinEdgeRing(g)}},{key:"getNext",value:function(u){return u.getNextMin()}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];Yi.constructor_.call(this,u,g)}}])})(Yi),ki=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"buildMinimalRings",value:function(){var u=new Le,g=this._startDe;do{if(g.getMinEdgeRing()===null){var E=new tr(g,this._geometryFactory);u.add(E)}g=g.getNext()}while(g!==this._startDe);return u}},{key:"setEdgeRing",value:function(u,g){u.setEdgeRing(g)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var u=this._startDe;do u.getNode().getEdges().linkMinimalDirectedEdges(this),u=u.getNext();while(u!==this._startDe)}},{key:"getNext",value:function(u){return u.getNext()}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];Yi.constructor_.call(this,u,g)}}])})(Yi),mn=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"setVisited",value:function(_){this._isVisited=_}},{key:"setInResult",value:function(_){this._isInResult=_}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(_){this._label=_}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(_){this._isCovered=_,this._isCoveredSet=!0}},{key:"updateIM",value:function(_){Ct.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(_)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var _=arguments[0];this._label=_}}}}])})(),Qn=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"isIncidentEdgeInResult",value:function(){for(var u=this.getEdges().getEdges().iterator();u.hasNext();)if(u.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(u){u.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(u){}},{key:"computeMergedLocation",value:function(u,g){var E=Se.NONE;if(E=this._label.getLocation(g),!u.isNull(g)){var P=u.getLocation(g);E!==Se.BOUNDARY&&(E=P)}return E}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return Fe(o,"setLabel",this,1).apply(this,arguments);var u=arguments[0],g=arguments[1];this._label===null?this._label=new Xr(u,g):this._label.setLocation(u,g)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof o){var u=arguments[0];this.mergeLabel(u._label)}else if(arguments[0]instanceof Xr)for(var g=arguments[0],E=0;E<2;E++){var P=this.computeMergedLocation(g,E);this._label.getLocation(E)===Se.NONE&&this._label.setLocation(E,P)}}},{key:"add",value:function(u){this._edges.insert(u),u.setNode(this)}},{key:"setLabelBoundary",value:function(u){if(this._label===null)return null;var g=Se.NONE;this._label!==null&&(g=this._label.getLocation(u));var E=null;switch(g){case Se.BOUNDARY:E=Se.INTERIOR;break;case Se.INTERIOR:default:E=Se.BOUNDARY}this._label.setLocation(u,E)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var u=arguments[0],g=arguments[1];this._coord=u,this._edges=g,this._label=new Xr(0,Se.NONE)}}])})(mn),Za=(function(_){function o(){return U(this,o),F(this,o,arguments)}return ce(o,_),f(o)})(Vn);function Li(_){return _==null?0:_.color}function An(_){return _==null?null:_.parent}function ci(_,o){_!==null&&(_.color=o)}function la(_){return _==null?null:_.left}function ls(_){return _==null?null:_.right}var si=(function(_){function o(){var u;return U(this,o),(u=F(this,o)).root_=null,u.size_=0,u}return ce(o,_),f(o,[{key:"get",value:function(u){for(var g=this.root_;g!==null;){var E=u.compareTo(g.key);if(E<0)g=g.left;else{if(!(E>0))return g.value;g=g.right}}return null}},{key:"put",value:function(u,g){if(this.root_===null)return this.root_={key:u,value:g,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var E,P,V=this.root_;do if(E=V,(P=u.compareTo(V.key))<0)V=V.left;else{if(!(P>0)){var $=V.value;return V.value=g,$}V=V.right}while(V!==null);var re={key:u,left:null,right:null,value:g,parent:E,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return P<0?E.left=re:E.right=re,this.fixAfterInsertion(re),this.size_++,null}},{key:"fixAfterInsertion",value:function(u){var g;for(u.color=1;u!=null&&u!==this.root_&&u.parent.color===1;)An(u)===la(An(An(u)))?Li(g=ls(An(An(u))))===1?(ci(An(u),0),ci(g,0),ci(An(An(u)),1),u=An(An(u))):(u===ls(An(u))&&(u=An(u),this.rotateLeft(u)),ci(An(u),0),ci(An(An(u)),1),this.rotateRight(An(An(u)))):Li(g=la(An(An(u))))===1?(ci(An(u),0),ci(g,0),ci(An(An(u)),1),u=An(An(u))):(u===la(An(u))&&(u=An(u),this.rotateRight(u)),ci(An(u),0),ci(An(An(u)),1),this.rotateLeft(An(An(u))));this.root_.color=0}},{key:"values",value:function(){var u=new Le,g=this.getFirstEntry();if(g!==null)for(u.add(g.value);(g=o.successor(g))!==null;)u.add(g.value);return u}},{key:"entrySet",value:function(){var u=new Ai,g=this.getFirstEntry();if(g!==null)for(u.add(g);(g=o.successor(g))!==null;)u.add(g);return u}},{key:"rotateLeft",value:function(u){if(u!=null){var g=u.right;u.right=g.left,g.left!=null&&(g.left.parent=u),g.parent=u.parent,u.parent==null?this.root_=g:u.parent.left===u?u.parent.left=g:u.parent.right=g,g.left=u,u.parent=g}}},{key:"rotateRight",value:function(u){if(u!=null){var g=u.left;u.left=g.right,g.right!=null&&(g.right.parent=u),g.parent=u.parent,u.parent==null?this.root_=g:u.parent.right===u?u.parent.right=g:u.parent.left=g,g.right=u,u.parent=g}}},{key:"getFirstEntry",value:function(){var u=this.root_;if(u!=null)for(;u.left!=null;)u=u.left;return u}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(u){for(var g=this.root_;g!==null;){var E=u.compareTo(g.key);if(E<0)g=g.left;else{if(!(E>0))return!0;g=g.right}}return!1}}],[{key:"successor",value:function(u){var g;if(u===null)return null;if(u.right!==null){for(g=u.right;g.left!==null;)g=g.left;return g}g=u.parent;for(var E=u;g!==null&&E===g.right;)E=g,g=g.parent;return g}}])})(Za),Zs=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"find",value:function(_){return this.nodeMap.get(_)}},{key:"addNode",value:function(){if(arguments[0]instanceof Ue){var _=arguments[0],o=this.nodeMap.get(_);return o===null&&(o=this.nodeFact.createNode(_),this.nodeMap.put(_,o)),o}if(arguments[0]instanceof Qn){var u=arguments[0],g=this.nodeMap.get(u.getCoordinate());return g===null?(this.nodeMap.put(u.getCoordinate(),u),u):(g.mergeLabel(u),g)}}},{key:"print",value:function(_){for(var o=this.iterator();o.hasNext();)o.next().print(_)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(_){for(var o=new Le,u=this.iterator();u.hasNext();){var g=u.next();g.getLabel().getLocation(_)===Se.BOUNDARY&&o.add(g)}return o}},{key:"add",value:function(_){var o=_.getCoordinate();this.addNode(o).add(_)}}],[{key:"constructor_",value:function(){this.nodeMap=new si,this.nodeFact=null;var _=arguments[0];this.nodeFact=_}}])})(),bi=(function(){function _(){U(this,_)}return f(_,null,[{key:"isNorthern",value:function(o){return o===_.NE||o===_.NW}},{key:"isOpposite",value:function(o,u){return o!==u&&(o-u+4)%4===2}},{key:"commonHalfPlane",value:function(o,u){if(o===u)return o;if((o-u+4)%4===2)return-1;var g=o<u?o:u;return g===0&&(o>u?o:u)===3?3:g}},{key:"isInHalfPlane",value:function(o,u){return u===_.SE?o===_.SE||o===_.SW:o===u||o===u+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],u=arguments[1];if(o===0&&u===0)throw new Mt("Cannot compute the quadrant for point ( "+o+", "+u+" )");return o>=0?u>=0?_.NE:_.SE:u>=0?_.NW:_.SW}if(arguments[0]instanceof Ue&&arguments[1]instanceof Ue){var g=arguments[0],E=arguments[1];if(E.x===g.x&&E.y===g.y)throw new Mt("Cannot compute the quadrant for two identical points "+g);return E.x>=g.x?E.y>=g.y?_.NE:_.SE:E.y>=g.y?_.NW:_.SW}}}])})();bi.NE=0,bi.NW=1,bi.SW=2,bi.SE=3;var ho=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"compareDirection",value:function(o){return this._dx===o._dx&&this._dy===o._dy?0:this._quadrant>o._quadrant?1:this._quadrant<o._quadrant?-1:xe.index(o._p0,o._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(o){this._node=o}},{key:"print",value:function(o){var u=Math.atan2(this._dy,this._dx),g=this.getClass().getName(),E=g.lastIndexOf("."),P=g.substring(E+1);o.print("  "+P+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+u+"   "+this._label)}},{key:"compareTo",value:function(o){var u=o;return this.compareDirection(u)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var o=Math.atan2(this._dy,this._dx),u=this.getClass().getName(),g=u.lastIndexOf(".");return"  "+u.substring(g+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+o+"   "+this._label}},{key:"computeLabel",value:function(o){}},{key:"init",value:function(o,u){this._p0=o,this._p1=u,this._dx=u.x-o.x,this._dy=u.y-o.y,this._quadrant=bi.quadrant(this._dx,this._dy),Ct.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[_t]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var o=arguments[0];this._edge=o}else if(arguments.length===3){var u=arguments[0],g=arguments[1],E=arguments[2];_.constructor_.call(this,u,g,E,null)}else if(arguments.length===4){var P=arguments[0],V=arguments[1],$=arguments[2],re=arguments[3];_.constructor_.call(this,P),this.init(V,$),this._label=re}}}])})(),Or=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(u){return this._depth[u]}},{key:"setVisited",value:function(u){this._isVisited=u}},{key:"computeDirectedLabel",value:function(){this._label=new Xr(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(u,g){if(this._depth[u]!==-999&&this._depth[u]!==g)throw new Ve("assigned depths do not match",this.getCoordinate());this._depth[u]=g}},{key:"isInteriorAreaEdge",value:function(){for(var u=!0,g=0;g<2;g++)this._label.isArea(g)&&this._label.getLocation(g,Dt.LEFT)===Se.INTERIOR&&this._label.getLocation(g,Dt.RIGHT)===Se.INTERIOR||(u=!1);return u}},{key:"setNextMin",value:function(u){this._nextMin=u}},{key:"print",value:function(u){Fe(o,"print",this,1).call(this,u),u.print(" "+this._depth[Dt.LEFT]+"/"+this._depth[Dt.RIGHT]),u.print(" ("+this.getDepthDelta()+")"),this._isInResult&&u.print(" inResult")}},{key:"setMinEdgeRing",value:function(u){this._minEdgeRing=u}},{key:"isLineEdge",value:function(){var u=this._label.isLine(0)||this._label.isLine(1),g=!this._label.isArea(0)||this._label.allPositionsEqual(0,Se.EXTERIOR),E=!this._label.isArea(1)||this._label.allPositionsEqual(1,Se.EXTERIOR);return u&&g&&E}},{key:"setEdgeRing",value:function(u){this._edgeRing=u}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var u=this._edge.getDepthDelta();return this._isForward||(u=-u),u}},{key:"setInResult",value:function(u){this._isInResult=u}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(u){this.print(u),u.print(" "),this._isForward?this._edge.print(u):this._edge.printReverse(u)}},{key:"setSym",value:function(u){this._sym=u}},{key:"setVisitedEdge",value:function(u){this.setVisited(u),this._sym.setVisited(u)}},{key:"setEdgeDepths",value:function(u,g){var E=this.getEdge().getDepthDelta();this._isForward||(E=-E);var P=1;u===Dt.LEFT&&(P=-1);var V=Dt.opposite(u),$=g+E*P;this.setDepth(u,g),this.setDepth(V,$)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(u){this._next=u}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var u=arguments[0],g=arguments[1];if(ho.constructor_.call(this,u),this._isForward=g,g)this.init(u.getCoordinate(0),u.getCoordinate(1));else{var E=u.getNumPoints()-1;this.init(u.getCoordinate(E),u.getCoordinate(E-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(u,g){return u===Se.EXTERIOR&&g===Se.INTERIOR?1:u===Se.INTERIOR&&g===Se.EXTERIOR?-1:0}}])})(ho),nr=(function(){return f((function _(){U(this,_)}),[{key:"createNode",value:function(_){return new Qn(_,null)}}])})(),$r=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"printEdges",value:function(_){_.println("Edges:");for(var o=0;o<this._edges.size();o++){_.println("edge "+o+":");var u=this._edges.get(o);u.print(_),u.eiList.print(_)}}},{key:"find",value:function(_){return this._nodes.find(_)}},{key:"addNode",value:function(){if(arguments[0]instanceof Qn){var _=arguments[0];return this._nodes.addNode(_)}if(arguments[0]instanceof Ue){var o=arguments[0];return this._nodes.addNode(o)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var _=this._nodes.iterator();_.hasNext();)_.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(_){qt.out.println(_)}},{key:"isBoundaryNode",value:function(_,o){var u=this._nodes.find(o);if(u===null)return!1;var g=u.getLabel();return g!==null&&g.getLocation(_)===Se.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var _=this._nodes.iterator();_.hasNext();)_.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(_,o,u,g){return!!_.equals(u)&&xe.index(_,o,g)===xe.COLLINEAR&&bi.quadrant(_,o)===bi.quadrant(u,g)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(_){qt.out.print(_)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(_,o){for(var u=0;u<this._edges.size();u++){var g=this._edges.get(u),E=g.getCoordinates();if(this.matchInSameDirection(_,o,E[0],E[1])||this.matchInSameDirection(_,o,E[E.length-1],E[E.length-2]))return g}return null}},{key:"insertEdge",value:function(_){this._edges.add(_)}},{key:"findEdgeEnd",value:function(_){for(var o=this.getEdgeEnds().iterator();o.hasNext();){var u=o.next();if(u.getEdge()===_)return u}return null}},{key:"addEdges",value:function(_){for(var o=_.iterator();o.hasNext();){var u=o.next();this._edges.add(u);var g=new Or(u,!0),E=new Or(u,!1);g.setSym(E),E.setSym(g),this.add(g),this.add(E)}}},{key:"add",value:function(_){this._nodes.add(_),this._edgeEndList.add(_)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(_,o){for(var u=0;u<this._edges.size();u++){var g=this._edges.get(u),E=g.getCoordinates();if(_.equals(E[0])&&o.equals(E[1]))return g}return null}}],[{key:"constructor_",value:function(){if(this._edges=new Le,this._nodes=null,this._edgeEndList=new Le,arguments.length===0)this._nodes=new Zs(new nr);else if(arguments.length===1){var _=arguments[0];this._nodes=new Zs(_)}}},{key:"linkResultDirectedEdges",value:function(_){for(var o=_.iterator();o.hasNext();)o.next().getEdges().linkResultDirectedEdges()}}])})(),Yl=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"sortShellsAndHoles",value:function(o,u,g){for(var E=o.iterator();E.hasNext();){var P=E.next();P.isHole()?g.add(P):u.add(P)}}},{key:"computePolygons",value:function(o){for(var u=new Le,g=o.iterator();g.hasNext();){var E=g.next().toPolygon(this._geometryFactory);u.add(E)}return u}},{key:"placeFreeHoles",value:function(o,u){for(var g=u.iterator();g.hasNext();){var E=g.next();if(E.getShell()===null){var P=_.findEdgeRingContaining(E,o);if(P===null)throw new Ve("unable to assign hole to a shell",E.getCoordinate(0));E.setShell(P)}}}},{key:"buildMinimalEdgeRings",value:function(o,u,g){for(var E=new Le,P=o.iterator();P.hasNext();){var V=P.next();if(V.getMaxNodeDegree()>2){V.linkDirectedEdgesForMinimalEdgeRings();var $=V.buildMinimalRings(),re=this.findShell($);re!==null?(this.placePolygonHoles(re,$),u.add(re)):g.addAll($)}else E.add(V)}return E}},{key:"buildMaximalEdgeRings",value:function(o){for(var u=new Le,g=o.iterator();g.hasNext();){var E=g.next();if(E.isInResult()&&E.getLabel().isArea()&&E.getEdgeRing()===null){var P=new ki(E,this._geometryFactory);u.add(P),P.setInResult()}}return u}},{key:"placePolygonHoles",value:function(o,u){for(var g=u.iterator();g.hasNext();){var E=g.next();E.isHole()&&E.setShell(o)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(o){for(var u=0,g=null,E=o.iterator();E.hasNext();){var P=E.next();P.isHole()||(g=P,u++)}return Ct.isTrue(u<=1,"found two shells in MinimalEdgeRing list"),g}},{key:"add",value:function(){if(arguments.length===1){var o=arguments[0];this.add(o.getEdgeEnds(),o.getNodes())}else if(arguments.length===2){var u=arguments[0],g=arguments[1];$r.linkResultDirectedEdges(g);var E=this.buildMaximalEdgeRings(u),P=new Le,V=this.buildMinimalEdgeRings(E,this._shellList,P);this.sortShellsAndHoles(V,this._shellList,P),this.placeFreeHoles(this._shellList,P)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new Le;var o=arguments[0];this._geometryFactory=o}},{key:"findEdgeRingContaining",value:function(o,u){for(var g=o.getLinearRing(),E=g.getEnvelopeInternal(),P=g.getCoordinateN(0),V=null,$=null,re=u.iterator();re.hasNext();){var fe=re.next(),Be=fe.getLinearRing(),Xe=Be.getEnvelopeInternal();if(!Xe.equals(E)&&Xe.contains(E)){P=ui.ptNotInList(g.getCoordinates(),Be.getCoordinates());var bt=!1;Aa.isInRing(P,Be.getCoordinates())&&(bt=!0),bt&&(V===null||$.contains(Xe))&&($=(V=fe).getLinearRing().getEnvelopeInternal())}}return V}}])})(),fo=(function(){return f((function _(){U(this,_)}),[{key:"getBounds",value:function(){}}])})(),ua=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[fo,Ft]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var _=arguments[0],o=arguments[1];this._bounds=_,this._item=o}}])})(),$n=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"poll",value:function(){if(this.isEmpty())return null;var _=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),_}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(_){for(var o=null,u=this._items.get(_);2*_<=this._size&&((o=2*_)!==this._size&&this._items.get(o+1).compareTo(this._items.get(o))<0&&o++,this._items.get(o).compareTo(u)<0);_=o)this._items.set(_,this._items.get(o));this._items.set(_,u)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(_){this._items.add(null),this._size+=1;var o=this._size;for(this._items.set(0,_);_.compareTo(this._items.get(Math.trunc(o/2)))<0;o/=2)this._items.set(o,this._items.get(Math.trunc(o/2)));this._items.set(o,_)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new Le,this._items.add(null)}}])})(),po=(function(){return f((function _(){U(this,_)}),[{key:"insert",value:function(_,o){}},{key:"remove",value:function(_,o){}},{key:"query",value:function(){}}])})(),vn=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(_){Ct.isTrue(this._bounds===null),this._childBoundables.add(_)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[fo,Ft]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new Le,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var _=arguments[0];this._level=_}}}}])})(),_n={reverseOrder:function(){return{compare:function(_,o){return o.compareTo(_)}}},min:function(_){return _n.sort(_),_.get(0)},sort:function(_,o){var u=_.toArray();o?Ca.sort(u,o):Ca.sort(u);for(var g=_.iterator(),E=0,P=u.length;E<P;E++)g.next(),g.set(u[E])},singletonList:function(_){var o=new Le;return o.add(_),o}},Vo=(function(){function _(){U(this,_)}return f(_,null,[{key:"maxDistance",value:function(o,u,g,E,P,V,$,re){var fe=_.distance(o,u,P,V);return fe=Math.max(fe,_.distance(o,u,$,re)),fe=Math.max(fe,_.distance(g,E,P,V)),fe=Math.max(fe,_.distance(g,E,$,re))}},{key:"distance",value:function(o,u,g,E){var P=g-o,V=E-u;return Math.sqrt(P*P+V*V)}},{key:"maximumDistance",value:function(o,u){var g=Math.min(o.getMinX(),u.getMinX()),E=Math.min(o.getMinY(),u.getMinY()),P=Math.max(o.getMaxX(),u.getMaxX()),V=Math.max(o.getMaxY(),u.getMaxY());return _.distance(g,E,P,V)}},{key:"minMaxDistance",value:function(o,u){var g=o.getMinX(),E=o.getMinY(),P=o.getMaxX(),V=o.getMaxY(),$=u.getMinX(),re=u.getMinY(),fe=u.getMaxX(),Be=u.getMaxY(),Xe=_.maxDistance(g,E,g,V,$,re,$,Be);return Xe=Math.min(Xe,_.maxDistance(g,E,g,V,$,re,fe,re)),Xe=Math.min(Xe,_.maxDistance(g,E,g,V,fe,Be,$,Be)),Xe=Math.min(Xe,_.maxDistance(g,E,g,V,fe,Be,fe,re)),Xe=Math.min(Xe,_.maxDistance(g,E,P,E,$,re,$,Be)),Xe=Math.min(Xe,_.maxDistance(g,E,P,E,$,re,fe,re)),Xe=Math.min(Xe,_.maxDistance(g,E,P,E,fe,Be,$,Be)),Xe=Math.min(Xe,_.maxDistance(g,E,P,E,fe,Be,fe,re)),Xe=Math.min(Xe,_.maxDistance(P,V,g,V,$,re,$,Be)),Xe=Math.min(Xe,_.maxDistance(P,V,g,V,$,re,fe,re)),Xe=Math.min(Xe,_.maxDistance(P,V,g,V,fe,Be,$,Be)),Xe=Math.min(Xe,_.maxDistance(P,V,g,V,fe,Be,fe,re)),Xe=Math.min(Xe,_.maxDistance(P,V,P,E,$,re,$,Be)),Xe=Math.min(Xe,_.maxDistance(P,V,P,E,$,re,fe,re)),Xe=Math.min(Xe,_.maxDistance(P,V,P,E,fe,Be,$,Be)),Xe=Math.min(Xe,_.maxDistance(P,V,P,E,fe,Be,fe,re))}}])})(),Pn=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"maximumDistance",value:function(){return Vo.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(o,u){var g=_.isComposite(this._boundable1),E=_.isComposite(this._boundable2);if(g&&E)return _.area(this._boundable1)>_.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,o,u),null):(this.expand(this._boundable2,this._boundable1,!0,o,u),null);if(g)return this.expand(this._boundable1,this._boundable2,!1,o,u),null;if(E)return this.expand(this._boundable2,this._boundable1,!0,o,u),null;throw new Mt("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(_.isComposite(this._boundable1)||_.isComposite(this._boundable2))}},{key:"compareTo",value:function(o){var u=o;return this._distance<u._distance?-1:this._distance>u._distance?1:0}},{key:"expand",value:function(o,u,g,E,P){for(var V=o.getChildBoundables().iterator();V.hasNext();){var $=V.next(),re=null;(re=g?new _(u,$,this._itemDistance):new _($,u,this._itemDistance)).getDistance()<P&&E.add(re)}}},{key:"getBoundable",value:function(o){return o===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[_t]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var o=arguments[0],u=arguments[1],g=arguments[2];this._boundable1=o,this._boundable2=u,this._itemDistance=g,this._distance=this.distance()}},{key:"area",value:function(o){return o.getBounds().getArea()}},{key:"isComposite",value:function(o){return o instanceof vn}}])})(),ml=(function(){return f((function _(){U(this,_)}),[{key:"visitItem",value:function(_){}}])})(),Nr=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"queryInternal",value:function(){if(ln(arguments[2],ml)&&arguments[0]instanceof Object&&arguments[1]instanceof vn)for(var o=arguments[0],u=arguments[2],g=arguments[1].getChildBoundables(),E=0;E<g.size();E++){var P=g.get(E);this.getIntersectsOp().intersects(P.getBounds(),o)&&(P instanceof vn?this.queryInternal(o,P,u):P instanceof ua?u.visitItem(P.getItem()):Ct.shouldNeverReachHere())}else if(ln(arguments[2],zr)&&arguments[0]instanceof Object&&arguments[1]instanceof vn)for(var V=arguments[0],$=arguments[2],re=arguments[1].getChildBoundables(),fe=0;fe<re.size();fe++){var Be=re.get(fe);this.getIntersectsOp().intersects(Be.getBounds(),V)&&(Be instanceof vn?this.queryInternal(V,Be,$):Be instanceof ua?$.add(Be.getItem()):Ct.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(o){return o.get(o.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var o=0,u=arguments[0].getChildBoundables().iterator();u.hasNext();){var g=u.next();g instanceof vn?o+=this.size(g):g instanceof ua&&(o+=1)}return o}}},{key:"removeItem",value:function(o,u){for(var g=null,E=o.getChildBoundables().iterator();E.hasNext();){var P=E.next();P instanceof ua&&P.getItem()===u&&(g=P)}return g!==null&&(o.getChildBoundables().remove(g),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var o=this.itemsTree(this._root);return o===null?new Le:o}if(arguments.length===1){for(var u=arguments[0],g=new Le,E=u.getChildBoundables().iterator();E.hasNext();){var P=E.next();if(P instanceof vn){var V=this.itemsTree(P);V!==null&&g.add(V)}else P instanceof ua?g.add(P.getItem()):Ct.shouldNeverReachHere()}return g.size()<=0?null:g}}},{key:"insert",value:function(o,u){Ct.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ua(o,u))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var o=arguments[0],u=new Le;return this.boundablesAtLevel(o,this._root,u),u}if(arguments.length===3){var g=arguments[0],E=arguments[1],P=arguments[2];if(Ct.isTrue(g>-2),E.getLevel()===g)return P.add(E),null;for(var V=E.getChildBoundables().iterator();V.hasNext();){var $=V.next();$ instanceof vn?this.boundablesAtLevel(g,$,P):(Ct.isTrue($ instanceof ua),g===-1&&P.add($))}return null}}},{key:"query",value:function(){if(arguments.length===1){var o=arguments[0];this.build();var u=new Le;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),o)&&this.queryInternal(o,this._root,u),u}if(arguments.length===2){var g=arguments[0],E=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),g)&&this.queryInternal(g,this._root,E)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),o)&&this.remove(o,this._root,u)}if(arguments.length===3){var g=arguments[0],E=arguments[1],P=arguments[2],V=this.removeItem(E,P);if(V)return!0;for(var $=null,re=E.getChildBoundables().iterator();re.hasNext();){var fe=re.next();if(this.getIntersectsOp().intersects(fe.getBounds(),g)&&fe instanceof vn&&(V=this.remove(g,fe,P))){$=fe;break}}return $!==null&&$.getChildBoundables().isEmpty()&&E.getChildBoundables().remove($),V}}},{key:"createHigherLevels",value:function(o,u){Ct.isTrue(!o.isEmpty());var g=this.createParentBoundables(o,u+1);return g.size()===1?g.get(0):this.createHigherLevels(g,u+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var o=0,u=arguments[0].getChildBoundables().iterator();u.hasNext();){var g=u.next();if(g instanceof vn){var E=this.depth(g);E>o&&(o=E)}}return o+1}}},{key:"createParentBoundables",value:function(o,u){Ct.isTrue(!o.isEmpty());var g=new Le;g.add(this.createNode(u));var E=new Le(o);_n.sort(E,this.getComparator());for(var P=E.iterator();P.hasNext();){var V=P.next();this.lastNode(g).getChildBoundables().size()===this.getNodeCapacity()&&g.add(this.createNode(u)),this.lastNode(g).addChildBoundable(V)}return g}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[Ft]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new Le,this._nodeCapacity=null,arguments.length===0)_.constructor_.call(this,_.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var o=arguments[0];Ct.isTrue(o>1,"Node capacity must be greater than 1"),this._nodeCapacity=o}}},{key:"compareDoubles",value:function(o,u){return o>u?1:o<u?-1:0}}])})();Nr.IntersectsOp=function(){},Nr.DEFAULT_NODE_CAPACITY=10;var mo=(function(){return f((function _(){U(this,_)}),[{key:"distance",value:function(_,o){}}])})(),Br=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"createParentBoundablesFromVerticalSlices",value:function(u,g){Ct.isTrue(u.length>0);for(var E=new Le,P=0;P<u.length;P++)E.addAll(this.createParentBoundablesFromVerticalSlice(u[P],g));return E}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var u=arguments[0],g=arguments[1];return this.nearestNeighbourK(u,Pt.POSITIVE_INFINITY,g)}if(arguments.length===3){var E=arguments[0],P=arguments[2],V=arguments[1],$=new $n;$.add(E);for(var re=new $n;!$.isEmpty()&&V>=0;){var fe=$.poll(),Be=fe.getDistance();if(Be>=V)break;fe.isLeaves()?re.size()<P?re.add(fe):(re.peek().getDistance()>Be&&(re.poll(),re.add(fe)),V=re.peek().getDistance()):fe.expandToQueue($,V)}return o.getItems(re)}}},{key:"createNode",value:function(u){return new yc(u)}},{key:"size",value:function(){return arguments.length===0?Fe(o,"size",this,1).call(this):Fe(o,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Ln))return Fe(o,"insert",this,1).apply(this,arguments);var u=arguments[0],g=arguments[1];if(u.isNull())return null;Fe(o,"insert",this,1).call(this,u,g)}},{key:"getIntersectsOp",value:function(){return o.intersectsOp}},{key:"verticalSlices",value:function(u,g){for(var E=Math.trunc(Math.ceil(u.size()/g)),P=new Array(g).fill(null),V=u.iterator(),$=0;$<g;$++){P[$]=new Le;for(var re=0;V.hasNext()&&re<E;){var fe=V.next();P[$].add(fe),re++}}return P}},{key:"query",value:function(){if(arguments.length===1){var u=arguments[0];return Fe(o,"query",this,1).call(this,u)}if(arguments.length===2){var g=arguments[0],E=arguments[1];Fe(o,"query",this,1).call(this,g,E)}}},{key:"getComparator",value:function(){return o.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(u,g){return Fe(o,"createParentBoundables",this,1).call(this,u,g)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Ln){var u=arguments[0],g=arguments[1];return Fe(o,"remove",this,1).call(this,u,g)}return Fe(o,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?Fe(o,"depth",this,1).call(this):Fe(o,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(u,g){Ct.isTrue(!u.isEmpty());var E=Math.trunc(Math.ceil(u.size()/this.getNodeCapacity())),P=new Le(u);_n.sort(P,o.xComparator);var V=this.verticalSlices(P,Math.trunc(Math.ceil(Math.sqrt(E))));return this.createParentBoundablesFromVerticalSlices(V,g)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(ln(arguments[0],mo)){var u=arguments[0];if(this.isEmpty())return null;var g=new Pn(this.getRoot(),this.getRoot(),u);return this.nearestNeighbour(g)}if(arguments[0]instanceof Pn){var E=arguments[0],P=Pt.POSITIVE_INFINITY,V=null,$=new $n;for($.add(E);!$.isEmpty()&&P>0;){var re=$.poll(),fe=re.getDistance();if(fe>=P)break;re.isLeaves()?(P=fe,V=re):re.expandToQueue($,P)}return V===null?null:[V.getBoundable(0).getItem(),V.getBoundable(1).getItem()]}}else{if(arguments.length===2){var Be=arguments[0],Xe=arguments[1];if(this.isEmpty()||Be.isEmpty())return null;var bt=new Pn(this.getRoot(),Be.getRoot(),Xe);return this.nearestNeighbour(bt)}if(arguments.length===3){var Zt=arguments[2],Qt=new ua(arguments[0],arguments[1]),un=new Pn(this.getRoot(),Qt,Zt);return this.nearestNeighbour(un)[0]}if(arguments.length===4){var zn=arguments[2],Cn=arguments[3],oi=new ua(arguments[0],arguments[1]),ur=new Pn(this.getRoot(),oi,zn);return this.nearestNeighbourK(ur,Cn)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var u=arguments[0],g=arguments[1],E=Pt.POSITIVE_INFINITY,P=new $n;for(P.add(u);!P.isEmpty();){var V=P.poll(),$=V.getDistance();if($>g)return!1;if(V.maximumDistance()<=g)return!0;if(V.isLeaves()){if((E=$)<=g)return!0}else V.expandToQueue(P,E)}return!1}if(arguments.length===3){var re=arguments[0],fe=arguments[1],Be=arguments[2],Xe=new Pn(this.getRoot(),re.getRoot(),fe);return this.isWithinDistance(Xe,Be)}}},{key:"interfaces_",get:function(){return[po,Ft]}}],[{key:"constructor_",value:function(){if(arguments.length===0)o.constructor_.call(this,o.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var u=arguments[0];Nr.constructor_.call(this,u)}}},{key:"centreX",value:function(u){return o.avg(u.getMinX(),u.getMaxX())}},{key:"avg",value:function(u,g){return(u+g)/2}},{key:"getItems",value:function(u){for(var g=new Array(u.size()).fill(null),E=0;!u.isEmpty();){var P=u.poll();g[E]=P.getBoundable(0).getItem(),E++}return g}},{key:"centreY",value:function(u){return o.avg(u.getMinY(),u.getMaxY())}}])})(Nr),yc=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"computeBounds",value:function(){for(var u=null,g=this.getChildBoundables().iterator();g.hasNext();){var E=g.next();u===null?u=new Ln(E.getBounds()):u.expandToInclude(E.getBounds())}return u}}],[{key:"constructor_",value:function(){var u=arguments[0];vn.constructor_.call(this,u)}}])})(vn);Br.STRtreeNode=yc,Br.xComparator=new((function(){return f((function _(){U(this,_)}),[{key:"interfaces_",get:function(){return[Re]}},{key:"compare",value:function(_,o){return Nr.compareDoubles(Br.centreX(_.getBounds()),Br.centreX(o.getBounds()))}}])})()),Br.yComparator=new((function(){return f((function _(){U(this,_)}),[{key:"interfaces_",get:function(){return[Re]}},{key:"compare",value:function(_,o){return Nr.compareDoubles(Br.centreY(_.getBounds()),Br.centreY(o.getBounds()))}}])})()),Br.intersectsOp=new((function(){return f((function _(){U(this,_)}),[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(_,o){return _.intersects(o)}}])})()),Br.DEFAULT_NODE_CAPACITY=10;var Hl=(function(){function _(){U(this,_)}return f(_,null,[{key:"relativeSign",value:function(o,u){return o<u?-1:o>u?1:0}},{key:"compare",value:function(o,u,g){if(u.equals2D(g))return 0;var E=_.relativeSign(u.x,g.x),P=_.relativeSign(u.y,g.y);switch(o){case 0:return _.compareValue(E,P);case 1:return _.compareValue(P,E);case 2:return _.compareValue(P,-E);case 3:return _.compareValue(-E,P);case 4:return _.compareValue(-E,-P);case 5:return _.compareValue(-P,-E);case 6:return _.compareValue(-P,E);case 7:return _.compareValue(E,-P)}return Ct.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(o,u){return o<0?-1:o>0?1:u<0?-1:u>0?1:0}}])})(),vc=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(_){_.print(this.coord),_.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(_){var o=_;return this.segmentIndex<o.segmentIndex?-1:this.segmentIndex>o.segmentIndex?1:this.coord.equals2D(o.coord)?0:this._isInterior?o._isInterior?Hl.compare(this._segmentOctant,this.coord,o.coord):1:-1}},{key:"isEndPoint",value:function(_){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===_}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[_t]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var _=arguments[0],o=arguments[1],u=arguments[2],g=arguments[3];this._segString=_,this.coord=new Ue(o),this.segmentIndex=u,this._segmentOctant=g,this._isInterior=!o.equals2D(_.getCoordinate(u))}}])})(),af=(function(){return f((function _(){U(this,_)}),[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])})(),xc=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"getSplitCoordinates",value:function(){var _=new as;this.addEndpoints();for(var o=this.iterator(),u=o.next();o.hasNext();){var g=o.next();this.addEdgeCoordinates(u,g,_),u=g}return _.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var _=new Le;this.findCollapsesFromInsertedNodes(_),this.findCollapsesFromExistingVertices(_);for(var o=_.iterator();o.hasNext();){var u=o.next().intValue();this.add(this._edge.getCoordinate(u),u)}}},{key:"createSplitEdgePts",value:function(_,o){var u=o.segmentIndex-_.segmentIndex+2;if(u===2)return[new Ue(_.coord),new Ue(o.coord)];var g=this._edge.getCoordinate(o.segmentIndex),E=o.isInterior()||!o.coord.equals2D(g);E||u--;var P=new Array(u).fill(null),V=0;P[V++]=new Ue(_.coord);for(var $=_.segmentIndex+1;$<=o.segmentIndex;$++)P[V++]=this._edge.getCoordinate($);return E&&(P[V]=new Ue(o.coord)),P}},{key:"print",value:function(_){_.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(_)}},{key:"findCollapsesFromExistingVertices",value:function(_){for(var o=0;o<this._edge.size()-2;o++){var u=this._edge.getCoordinate(o);this._edge.getCoordinate(o+1);var g=this._edge.getCoordinate(o+2);u.equals2D(g)&&_.add(je.valueOf(o+1))}}},{key:"addEdgeCoordinates",value:function(_,o,u){var g=this.createSplitEdgePts(_,o);u.add(g,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(_){this.addEndpoints(),this.addCollapsedNodes();for(var o=this.iterator(),u=o.next();o.hasNext();){var g=o.next(),E=this.createSplitEdge(u,g);_.add(E),u=g}}},{key:"findCollapseIndex",value:function(_,o,u){if(!_.coord.equals2D(o.coord))return!1;var g=o.segmentIndex-_.segmentIndex;return o.isInterior()||g--,g===1&&(u[0]=_.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(_){for(var o=new Array(1).fill(null),u=this.iterator(),g=u.next();u.hasNext();){var E=u.next();this.findCollapseIndex(g,E,o)&&_.add(je.valueOf(o[0])),g=E}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var _=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(_),_)}},{key:"createSplitEdge",value:function(_,o){var u=this.createSplitEdgePts(_,o);return new ka(u,this._edge.getData())}},{key:"add",value:function(_,o){var u=new vc(this._edge,_,o,this._edge.getSegmentOctant(o)),g=this._nodeMap.get(u);return g!==null?(Ct.isTrue(g.coord.equals2D(_),"Found equal nodes with different coordinates"),g):(this._nodeMap.put(u,u),u)}},{key:"checkSplitEdgesCorrectness",value:function(_){var o=this._edge.getCoordinates(),u=_.get(0).getCoordinate(0);if(!u.equals2D(o[0]))throw new lt("bad split edge start point at "+u);var g=_.get(_.size()-1).getCoordinates(),E=g[g.length-1];if(!E.equals2D(o[o.length-1]))throw new lt("bad split edge end point at "+E)}}],[{key:"constructor_",value:function(){this._nodeMap=new si,this._edge=null;var _=arguments[0];this._edge=_}}])})(),ca=(function(){function _(){U(this,_)}return f(_,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],u=arguments[1];if(o===0&&u===0)throw new Mt("Cannot compute the octant for point ( "+o+", "+u+" )");var g=Math.abs(o),E=Math.abs(u);return o>=0?u>=0?g>=E?0:1:g>=E?7:6:u>=0?g>=E?3:2:g>=E?4:5}if(arguments[0]instanceof Ue&&arguments[1]instanceof Ue){var P=arguments[0],V=arguments[1],$=V.x-P.x,re=V.y-P.y;if($===0&&re===0)throw new Mt("Cannot compute the octant for two identical points "+P);return _.octant($,re)}}}])})(),As=(function(){return f((function _(){U(this,_)}),[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(_){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(_){}},{key:"getData",value:function(){}}])})(),Di=(function(){return f((function _(){U(this,_)}),[{key:"addIntersection",value:function(_,o){}},{key:"interfaces_",get:function(){return[As]}}])})(),ka=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(o){return this._pts[o]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(o){return o===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(o),this.getCoordinate(o+1))}},{key:"setData",value:function(o){this._data=o}},{key:"safeOctant",value:function(o,u){return o.equals2D(u)?0:ca.octant(o,u)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];this.addIntersectionNode(o,u)}else if(arguments.length===4){var g=arguments[1],E=arguments[3],P=new Ue(arguments[0].getIntersection(E));this.addIntersection(P,g)}}},{key:"toString",value:function(){return qs.toLineString(new xi(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(o,u){var g=u,E=g+1;if(E<this._pts.length){var P=this._pts[E];o.equals2D(P)&&(g=E)}return this._nodeList.add(o,g)}},{key:"addIntersections",value:function(o,u,g){for(var E=0;E<o.getIntersectionNum();E++)this.addIntersection(o,u,g,E)}},{key:"interfaces_",get:function(){return[Di]}}],[{key:"constructor_",value:function(){this._nodeList=new xc(this),this._pts=null,this._data=null;var o=arguments[0],u=arguments[1];this._pts=o,this._data=u}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var o=arguments[0],u=new Le;return _.getNodedSubstrings(o,u),u}if(arguments.length===2)for(var g=arguments[1],E=arguments[0].iterator();E.hasNext();)E.next().getNodeList().addSplitEdges(g)}}])})(),Fr=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof _){var o=arguments[0],u=xe.index(this.p0,this.p1,o.p0),g=xe.index(this.p0,this.p1,o.p1);return u>=0&&g>=0||u<=0&&g<=0?Math.max(u,g):0}if(arguments[0]instanceof Ue){var E=arguments[0];return xe.index(this.p0,this.p1,E)}}},{key:"toGeometry",value:function(o){return o.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(o){if(!(o instanceof _))return!1;var u=o;return this.p0.equals(u.p0)&&this.p1.equals(u.p1)}},{key:"intersection",value:function(o){var u=new qa;return u.computeIntersection(this.p0,this.p1,o.p0,o.p1),u.hasIntersection()?u.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Ue){var o=arguments[0];if(o.equals(this.p0)||o.equals(this.p1))return new Ue(o);var u=this.projectionFactor(o),g=new Ue;return g.x=this.p0.x+u*(this.p1.x-this.p0.x),g.y=this.p0.y+u*(this.p1.y-this.p0.y),g}if(arguments[0]instanceof _){var E=arguments[0],P=this.projectionFactor(E.p0),V=this.projectionFactor(E.p1);if(P>=1&&V>=1||P<=0&&V<=0)return null;var $=this.project(E.p0);P<0&&($=this.p0),P>1&&($=this.p1);var re=this.project(E.p1);return V<0&&(re=this.p0),V>1&&(re=this.p1),new _($,re)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(o){return o===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(o){return Dn.pointToLinePerpendicular(o,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return _.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(o){if(o.equals(this.p0))return 0;if(o.equals(this.p1))return 1;var u=this.p1.x-this.p0.x,g=this.p1.y-this.p0.y,E=u*u+g*g;return E<=0?Pt.NaN:((o.x-this.p0.x)*u+(o.y-this.p0.y)*g)/E}},{key:"closestPoints",value:function(o){var u=this.intersection(o);if(u!==null)return[u,u];var g=new Array(2).fill(null),E=Pt.MAX_VALUE,P=null,V=this.closestPoint(o.p0);E=V.distance(o.p0),g[0]=V,g[1]=o.p0;var $=this.closestPoint(o.p1);(P=$.distance(o.p1))<E&&(E=P,g[0]=$,g[1]=o.p1);var re=o.closestPoint(this.p0);(P=re.distance(this.p0))<E&&(E=P,g[0]=this.p0,g[1]=re);var fe=o.closestPoint(this.p1);return(P=fe.distance(this.p1))<E&&(E=P,g[0]=this.p1,g[1]=fe),g}},{key:"closestPoint",value:function(o){var u=this.projectionFactor(o);return u>0&&u<1?this.project(o):this.p0.distance(o)<this.p1.distance(o)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(o){var u=o,g=this.p0.compareTo(u.p0);return g!==0?g:this.p1.compareTo(u.p1)}},{key:"reverse",value:function(){var o=this.p0;this.p0=this.p1,this.p1=o}},{key:"equalsTopo",value:function(o){return this.p0.equals(o.p0)&&this.p1.equals(o.p1)||this.p0.equals(o.p1)&&this.p1.equals(o.p0)}},{key:"lineIntersection",value:function(o){return Ut.intersection(this.p0,this.p1,o.p0,o.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(o,u){var g=this.p0.x+o*(this.p1.x-this.p0.x),E=this.p0.y+o*(this.p1.y-this.p0.y),P=this.p1.x-this.p0.x,V=this.p1.y-this.p0.y,$=Math.sqrt(P*P+V*V),re=0,fe=0;if(u!==0){if($<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");re=u*P/$,fe=u*V/$}return new Ue(g-fe,E+re)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var o=arguments[0];this.setCoordinates(o.p0,o.p1)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.p0.x=u.x,this.p0.y=u.y,this.p1.x=g.x,this.p1.y=g.y}}},{key:"segmentFraction",value:function(o){var u=this.projectionFactor(o);return u<0?u=0:(u>1||Pt.isNaN(u))&&(u=1),u}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(o){var u=this.p1.getY()-this.p0.getY(),g=this.p0.getX()-this.p1.getX(),E=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),P=u*u+g*g,V=u*u-g*g,$=o.getX(),re=o.getY();return new Ue((-V*$-2*u*g*re-2*u*E)/P,(V*re-2*u*g*$-2*g*E)/P)}},{key:"distance",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return Dn.segmentToSegment(this.p0,this.p1,o.p0,o.p1)}if(arguments[0]instanceof Ue){var u=arguments[0];return Dn.pointToSegment(u,this.p0,this.p1)}}},{key:"pointAlong",value:function(o){var u=new Ue;return u.x=this.p0.x+o*(this.p1.x-this.p0.x),u.y=this.p0.y+o*(this.p1.y-this.p0.y),u}},{key:"hashCode",value:function(){var o=Pt.doubleToLongBits(this.p0.x);o^=31*Pt.doubleToLongBits(this.p0.y);var u=Math.trunc(o)^Math.trunc(o>>32),g=Pt.doubleToLongBits(this.p1.x);return g^=31*Pt.doubleToLongBits(this.p1.y),u^(Math.trunc(g)^Math.trunc(g>>32))}},{key:"interfaces_",get:function(){return[_t,Ft]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)_.constructor_.call(this,new Ue,new Ue);else if(arguments.length===1){var o=arguments[0];_.constructor_.call(this,o.p0,o.p1)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.p0=u,this.p1=g}else if(arguments.length===4){var E=arguments[0],P=arguments[1],V=arguments[2],$=arguments[3];_.constructor_.call(this,new Ue(E,P),new Ue(V,$))}}},{key:"midPoint",value:function(o,u){return new Ue((o.x+u.x)/2,(o.y+u.y)/2)}}])})(),Xl=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var _=arguments[1],o=arguments[2],u=arguments[3];arguments[0].getLineSegment(_,this._overlapSeg1),o.getLineSegment(u,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Fr,this._overlapSeg2=new Fr}}])})(),zi=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"getLineSegment",value:function(_,o){o.p0=this._pts[_],o.p1=this._pts[_+1]}},{key:"computeSelect",value:function(_,o,u,g){var E=this._pts[o],P=this._pts[u];if(u-o==1)return g.select(this,o),null;if(!_.intersects(E,P))return null;var V=Math.trunc((o+u)/2);o<V&&this.computeSelect(_,o,V,g),V<u&&this.computeSelect(_,V,u,g)}},{key:"getCoordinates",value:function(){for(var _=new Array(this._end-this._start+1).fill(null),o=0,u=this._start;u<=this._end;u++)_[o++]=this._pts[u];return _}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var _=arguments[0],o=arguments[1];this.computeOverlaps(this._start,this._end,_,_._start,_._end,o)}else if(arguments.length===6){var u=arguments[0],g=arguments[1],E=arguments[2],P=arguments[3],V=arguments[4],$=arguments[5];if(g-u==1&&V-P==1)return $.overlap(this,u,E,P),null;if(!this.overlaps(u,g,E,P,V))return null;var re=Math.trunc((u+g)/2),fe=Math.trunc((P+V)/2);u<re&&(P<fe&&this.computeOverlaps(u,re,E,P,fe,$),fe<V&&this.computeOverlaps(u,re,E,fe,V,$)),re<g&&(P<fe&&this.computeOverlaps(re,g,E,P,fe,$),fe<V&&this.computeOverlaps(re,g,E,fe,V,$))}}},{key:"setId",value:function(_){this._id=_}},{key:"select",value:function(_,o){this.computeSelect(_,this._start,this._end,o)}},{key:"getEnvelope",value:function(){if(this._env===null){var _=this._pts[this._start],o=this._pts[this._end];this._env=new Ln(_,o)}return this._env}},{key:"overlaps",value:function(_,o,u,g,E){return Ln.intersects(this._pts[_],this._pts[o],u._pts[g],u._pts[E])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var _=arguments[0],o=arguments[1],u=arguments[2],g=arguments[3];this._pts=_,this._start=o,this._end=u,this._context=g}}])})(),rh=(function(){function _(){U(this,_)}return f(_,null,[{key:"findChainEnd",value:function(o,u){for(var g=u;g<o.length-1&&o[g].equals2D(o[g+1]);)g++;if(g>=o.length-1)return o.length-1;for(var E=bi.quadrant(o[g],o[g+1]),P=u+1;P<o.length&&!(!o[P-1].equals2D(o[P])&&bi.quadrant(o[P-1],o[P])!==E);)P++;return P-1}},{key:"getChains",value:function(){if(arguments.length===1){var o=arguments[0];return _.getChains(o,null)}if(arguments.length===2){var u=arguments[0],g=arguments[1],E=new Le,P=0;do{var V=_.findChainEnd(u,P),$=new zi(u,P,V,g);E.add($),P=V}while(P<u.length-1);return E}}}])})(),gl=(function(){return f((function _(){U(this,_)}),[{key:"computeNodes",value:function(_){}},{key:"getNodedSubstrings",value:function(){}}])})(),bc=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"setSegmentIntersector",value:function(_){this._segInt=_}},{key:"interfaces_",get:function(){return[gl]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var _=arguments[0];this.setSegmentIntersector(_)}}}}])})(),wc=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return ka.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(u){for(var g=rh.getChains(u.getCoordinates(),u).iterator();g.hasNext();){var E=g.next();E.setId(this._idCounter++),this._index.insert(E.getEnvelope(),E),this._monoChains.add(E)}}},{key:"computeNodes",value:function(u){this._nodedSegStrings=u;for(var g=u.iterator();g.hasNext();)this.add(g.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var u=new Uo(this._segInt),g=this._monoChains.iterator();g.hasNext();)for(var E=g.next(),P=this._index.query(E.getEnvelope()).iterator();P.hasNext();){var V=P.next();if(V.getId()>E.getId()&&(E.computeOverlaps(V,u),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new Le,this._index=new Br,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var u=arguments[0];bc.constructor_.call(this,u)}}}}])})(bc),Uo=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"overlap",value:function(){if(arguments.length!==4)return Fe(o,"overlap",this,1).apply(this,arguments);var u=arguments[1],g=arguments[2],E=arguments[3],P=arguments[0].getContext(),V=g.getContext();this._si.processIntersections(P,u,V,E)}}],[{key:"constructor_",value:function(){this._si=null;var u=arguments[0];this._si=u}}])})(Xl);wc.SegmentOverlapAction=Uo;var _a=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"isDeletable",value:function(o,u,g,E){var P=this._inputLine[o],V=this._inputLine[u],$=this._inputLine[g];return!!this.isConcave(P,V,$)&&!!this.isShallow(P,V,$,E)&&this.isShallowSampled(P,V,o,g,E)}},{key:"deleteShallowConcavities",value:function(){for(var o=1,u=this.findNextNonDeletedIndex(o),g=this.findNextNonDeletedIndex(u),E=!1;g<this._inputLine.length;){var P=!1;this.isDeletable(o,u,g,this._distanceTol)&&(this._isDeleted[u]=_.DELETE,P=!0,E=!0),o=P?g:u,u=this.findNextNonDeletedIndex(o),g=this.findNextNonDeletedIndex(u)}return E}},{key:"isShallowConcavity",value:function(o,u,g,E){return xe.index(o,u,g)===this._angleOrientation&&Dn.pointToSegment(u,o,g)<E}},{key:"isShallowSampled",value:function(o,u,g,E,P){var V=Math.trunc((E-g)/_.NUM_PTS_TO_CHECK);V<=0&&(V=1);for(var $=g;$<E;$+=V)if(!this.isShallow(o,u,this._inputLine[$],P))return!1;return!0}},{key:"isConcave",value:function(o,u,g){var E=xe.index(o,u,g)===this._angleOrientation;return E}},{key:"simplify",value:function(o){this._distanceTol=Math.abs(o),o<0&&(this._angleOrientation=xe.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var u=!1;do u=this.deleteShallowConcavities();while(u);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(o){for(var u=o+1;u<this._inputLine.length&&this._isDeleted[u]===_.DELETE;)u++;return u}},{key:"isShallow",value:function(o,u,g,E){return Dn.pointToSegment(u,o,g)<E}},{key:"collapseLine",value:function(){for(var o=new as,u=0;u<this._inputLine.length;u++)this._isDeleted[u]!==_.DELETE&&o.add(this._inputLine[u]);return o.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=xe.COUNTERCLOCKWISE;var o=arguments[0];this._inputLine=o}},{key:"simplify",value:function(o,u){return new _(o).simplify(u)}}])})();_a.INIT=0,_a.DELETE=1,_a.KEEP=1,_a.NUM_PTS_TO_CHECK=10;var jo=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getCoordinates",value:function(){return this._ptList.toArray(_.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(o){this._precisionModel=o}},{key:"addPt",value:function(o){var u=new Ue(o);if(this._precisionModel.makePrecise(u),this.isRedundant(u))return null;this._ptList.add(u)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(o,u){if(u)for(var g=0;g<o.length;g++)this.addPt(o[g]);else for(var E=o.length-1;E>=0;E--)this.addPt(o[E])}},{key:"isRedundant",value:function(o){if(this._ptList.size()<1)return!1;var u=this._ptList.get(this._ptList.size()-1);return o.distance(u)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Hr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var o=new Ue(this._ptList.get(0)),u=this._ptList.get(this._ptList.size()-1);if(o.equals(u))return null;this._ptList.add(o)}},{key:"setMinimumVertexDistance",value:function(o){this._minimimVertexDistance=o}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Le}}])})();jo.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var ha=(function(){function _(){U(this,_)}return f(_,null,[{key:"toDegrees",value:function(o){return 180*o/Math.PI}},{key:"normalize",value:function(o){for(;o>Math.PI;)o-=_.PI_TIMES_2;for(;o<=-Math.PI;)o+=_.PI_TIMES_2;return o}},{key:"angle",value:function(){if(arguments.length===1){var o=arguments[0];return Math.atan2(o.y,o.x)}if(arguments.length===2){var u=arguments[0],g=arguments[1],E=g.x-u.x,P=g.y-u.y;return Math.atan2(P,E)}}},{key:"isAcute",value:function(o,u,g){var E=o.x-u.x,P=o.y-u.y;return E*(g.x-u.x)+P*(g.y-u.y)>0}},{key:"isObtuse",value:function(o,u,g){var E=o.x-u.x,P=o.y-u.y;return E*(g.x-u.x)+P*(g.y-u.y)<0}},{key:"interiorAngle",value:function(o,u,g){var E=_.angle(u,o),P=_.angle(u,g);return Math.abs(P-E)}},{key:"normalizePositive",value:function(o){if(o<0){for(;o<0;)o+=_.PI_TIMES_2;o>=_.PI_TIMES_2&&(o=0)}else{for(;o>=_.PI_TIMES_2;)o-=_.PI_TIMES_2;o<0&&(o=0)}return o}},{key:"angleBetween",value:function(o,u,g){var E=_.angle(u,o),P=_.angle(u,g);return _.diff(E,P)}},{key:"diff",value:function(o,u){var g=null;return(g=o<u?u-o:o-u)>Math.PI&&(g=2*Math.PI-g),g}},{key:"toRadians",value:function(o){return o*Math.PI/180}},{key:"getTurn",value:function(o,u){var g=Math.sin(u-o);return g>0?_.COUNTERCLOCKWISE:g<0?_.CLOCKWISE:_.NONE}},{key:"angleBetweenOriented",value:function(o,u,g){var E=_.angle(u,o),P=_.angle(u,g)-E;return P<=-Math.PI?P+_.PI_TIMES_2:P>Math.PI?P-_.PI_TIMES_2:P}}])})();ha.PI_TIMES_2=2*Math.PI,ha.PI_OVER_2=Math.PI/2,ha.PI_OVER_4=Math.PI/4,ha.COUNTERCLOCKWISE=xe.COUNTERCLOCKWISE,ha.CLOCKWISE=xe.CLOCKWISE,ha.NONE=xe.COLLINEAR;var Ys=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"addNextSegment",value:function(o,u){if(this._s0=this._s1,this._s1=this._s2,this._s2=o,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var g=xe.index(this._s0,this._s1,this._s2),E=g===xe.CLOCKWISE&&this._side===Dt.LEFT||g===xe.COUNTERCLOCKWISE&&this._side===Dt.RIGHT;g===0?this.addCollinear(u):E?this.addOutsideTurn(g,u):this.addInsideTurn(g,u)}},{key:"addLineEndCap",value:function(o,u){var g=new Fr(o,u),E=new Fr;this.computeOffsetSegment(g,Dt.LEFT,this._distance,E);var P=new Fr;this.computeOffsetSegment(g,Dt.RIGHT,this._distance,P);var V=u.x-o.x,$=u.y-o.y,re=Math.atan2($,V);switch(this._bufParams.getEndCapStyle()){case rt.CAP_ROUND:this._segList.addPt(E.p1),this.addDirectedFillet(u,re+Math.PI/2,re-Math.PI/2,xe.CLOCKWISE,this._distance),this._segList.addPt(P.p1);break;case rt.CAP_FLAT:this._segList.addPt(E.p1),this._segList.addPt(P.p1);break;case rt.CAP_SQUARE:var fe=new Ue;fe.x=Math.abs(this._distance)*Math.cos(re),fe.y=Math.abs(this._distance)*Math.sin(re);var Be=new Ue(E.p1.x+fe.x,E.p1.y+fe.y),Xe=new Ue(P.p1.x+fe.x,P.p1.y+fe.y);this._segList.addPt(Be),this._segList.addPt(Xe)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(o,u,g,E){var P=Ut.intersection(u.p0,u.p1,g.p0,g.p1);if(P!==null&&(E<=0?1:P.distance(o)/Math.abs(E))<=this._bufParams.getMitreLimit())return this._segList.addPt(P),null;this.addLimitedMitreJoin(u,g,E,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(o,u){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*_.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===rt.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===rt.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(u&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,o,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(o){this._segList.addPt(new Ue(o.x+this._distance,o.y+this._distance)),this._segList.addPt(new Ue(o.x+this._distance,o.y-this._distance)),this._segList.addPt(new Ue(o.x-this._distance,o.y-this._distance)),this._segList.addPt(new Ue(o.x-this._distance,o.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(o,u){this._segList.addPts(o,u)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(o,u,g,E,P){var V=u.x-o.x,$=u.y-o.y,re=Math.atan2($,V),fe=g.x-o.x,Be=g.y-o.y,Xe=Math.atan2(Be,fe);E===xe.CLOCKWISE?re<=Xe&&(re+=2*Math.PI):re>=Xe&&(re-=2*Math.PI),this._segList.addPt(u),this.addDirectedFillet(o,re,Xe,E,P),this._segList.addPt(g)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(o,u,g){this._s1=o,this._s2=u,this._side=g,this._seg1.setCoordinates(o,u),this.computeOffsetSegment(this._seg1,g,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(o,u,g,E){var P=this._seg0.p1,V=ha.angle(P,this._seg0.p0),$=ha.angleBetweenOriented(this._seg0.p0,P,this._seg1.p1)/2,re=ha.normalize(V+$),fe=ha.normalize(re+Math.PI),Be=E*g,Xe=g-Be*Math.abs(Math.sin($)),bt=P.x+Be*Math.cos(fe),Zt=P.y+Be*Math.sin(fe),Qt=new Ue(bt,Zt),un=new Fr(P,Qt),zn=un.pointAlongOffset(1,Xe),Cn=un.pointAlongOffset(1,-Xe);this._side===Dt.LEFT?(this._segList.addPt(zn),this._segList.addPt(Cn)):(this._segList.addPt(Cn),this._segList.addPt(zn))}},{key:"addDirectedFillet",value:function(o,u,g,E,P){var V=E===xe.CLOCKWISE?-1:1,$=Math.abs(u-g),re=Math.trunc($/this._filletAngleQuantum+.5);if(re<1)return null;for(var fe=$/re,Be=new Ue,Xe=0;Xe<re;Xe++){var bt=u+V*Xe*fe;Be.x=o.x+P*Math.cos(bt),Be.y=o.y+P*Math.sin(bt),this._segList.addPt(Be)}}},{key:"computeOffsetSegment",value:function(o,u,g,E){var P=u===Dt.LEFT?1:-1,V=o.p1.x-o.p0.x,$=o.p1.y-o.p0.y,re=Math.sqrt(V*V+$*$),fe=P*g*V/re,Be=P*g*$/re;E.p0.x=o.p0.x-Be,E.p0.y=o.p0.y+fe,E.p1.x=o.p1.x-Be,E.p1.y=o.p1.y+fe}},{key:"addInsideTurn",value:function(o,u){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*_.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var g=new Ue((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(g);var E=new Ue((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(E)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(o){var u=new Ue(o.x+this._distance,o.y);this._segList.addPt(u),this.addDirectedFillet(o,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(o,u){this._segList.addPt(o.p1),this._segList.addPt(u.p0)}},{key:"init",value:function(o){this._distance=o,this._maxCurveSegmentError=o*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new jo,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(o*_.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(o){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===rt.JOIN_BEVEL||this._bufParams.getJoinStyle()===rt.JOIN_MITRE?(o&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,xe.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Fr,this._seg1=new Fr,this._offset0=new Fr,this._offset1=new Fr,this._side=0,this._hasNarrowConcaveAngle=!1;var o=arguments[0],u=arguments[1],g=arguments[2];this._precisionModel=o,this._bufParams=u,this._li=new qa,this._filletAngleQuantum=Math.PI/2/u.getQuadrantSegments(),u.getQuadrantSegments()>=8&&u.getJoinStyle()===rt.JOIN_ROUND&&(this._closingSegLengthFactor=_.MAX_CLOSING_SEG_LEN_FACTOR),this.init(g)}}])})();Ys.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,Ys.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,Ys.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,Ys.MAX_CLOSING_SEG_LEN_FACTOR=80;var _l=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getOffsetCurve",value:function(o,u){if(this._distance=u,u===0)return null;var g=u<0,E=Math.abs(u),P=this.getSegGen(E);o.length<=1?this.computePointCurve(o[0],P):this.computeOffsetCurve(o,g,P);var V=P.getCoordinates();return g&&ui.reverse(V),V}},{key:"computeSingleSidedBufferCurve",value:function(o,u,g){var E=this.simplifyTolerance(this._distance);if(u){g.addSegments(o,!0);var P=_a.simplify(o,-E),V=P.length-1;g.initSideSegments(P[V],P[V-1],Dt.LEFT),g.addFirstSegment();for(var $=V-2;$>=0;$--)g.addNextSegment(P[$],!0)}else{g.addSegments(o,!1);var re=_a.simplify(o,E),fe=re.length-1;g.initSideSegments(re[0],re[1],Dt.LEFT),g.addFirstSegment();for(var Be=2;Be<=fe;Be++)g.addNextSegment(re[Be],!0)}g.addLastSegment(),g.closeRing()}},{key:"computeRingBufferCurve",value:function(o,u,g){var E=this.simplifyTolerance(this._distance);u===Dt.RIGHT&&(E=-E);var P=_a.simplify(o,E),V=P.length-1;g.initSideSegments(P[V-1],P[0],u);for(var $=1;$<=V;$++){var re=$!==1;g.addNextSegment(P[$],re)}g.closeRing()}},{key:"computeLineBufferCurve",value:function(o,u){var g=this.simplifyTolerance(this._distance),E=_a.simplify(o,g),P=E.length-1;u.initSideSegments(E[0],E[1],Dt.LEFT);for(var V=2;V<=P;V++)u.addNextSegment(E[V],!0);u.addLastSegment(),u.addLineEndCap(E[P-1],E[P]);var $=_a.simplify(o,-g),re=$.length-1;u.initSideSegments($[re],$[re-1],Dt.LEFT);for(var fe=re-2;fe>=0;fe--)u.addNextSegment($[fe],!0);u.addLastSegment(),u.addLineEndCap($[1],$[0]),u.closeRing()}},{key:"computePointCurve",value:function(o,u){switch(this._bufParams.getEndCapStyle()){case rt.CAP_ROUND:u.createCircle(o);break;case rt.CAP_SQUARE:u.createSquare(o)}}},{key:"getLineCurve",value:function(o,u){if(this._distance=u,this.isLineOffsetEmpty(u))return null;var g=Math.abs(u),E=this.getSegGen(g);if(o.length<=1)this.computePointCurve(o[0],E);else if(this._bufParams.isSingleSided()){var P=u<0;this.computeSingleSidedBufferCurve(o,P,E)}else this.computeLineBufferCurve(o,E);return E.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(o){return o*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(o,u,g){if(this._distance=g,o.length<=2)return this.getLineCurve(o,g);if(g===0)return _.copyCoordinates(o);var E=this.getSegGen(g);return this.computeRingBufferCurve(o,u,E),E.getCoordinates()}},{key:"computeOffsetCurve",value:function(o,u,g){var E=this.simplifyTolerance(this._distance);if(u){var P=_a.simplify(o,-E),V=P.length-1;g.initSideSegments(P[V],P[V-1],Dt.LEFT),g.addFirstSegment();for(var $=V-2;$>=0;$--)g.addNextSegment(P[$],!0)}else{var re=_a.simplify(o,E),fe=re.length-1;g.initSideSegments(re[0],re[1],Dt.LEFT),g.addFirstSegment();for(var Be=2;Be<=fe;Be++)g.addNextSegment(re[Be],!0)}g.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(o){return o===0||o<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(o){return new Ys(this._precisionModel,this._bufParams,o)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var o=arguments[0],u=arguments[1];this._precisionModel=o,this._bufParams=u}},{key:"copyCoordinates",value:function(o){for(var u=new Array(o.length).fill(null),g=0;g<u.length;g++)u[g]=new Ue(o[g]);return u}}])})(),Go=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var _=arguments[0],o=new Le,u=this._subgraphs.iterator();u.hasNext();){var g=u.next(),E=g.getEnvelope();_.y<E.getMinY()||_.y>E.getMaxY()||this.findStabbedSegments(_,g.getDirectedEdges(),o)}return o}if(arguments.length===3){if(ln(arguments[2],zr)&&arguments[0]instanceof Ue&&arguments[1]instanceof Or){for(var P=arguments[0],V=arguments[1],$=arguments[2],re=V.getEdge().getCoordinates(),fe=0;fe<re.length-1;fe++)if(this._seg.p0=re[fe],this._seg.p1=re[fe+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<P.x||this._seg.isHorizontal()||P.y<this._seg.p0.y||P.y>this._seg.p1.y||xe.index(this._seg.p0,this._seg.p1,P)===xe.RIGHT)){var Be=V.getDepth(Dt.LEFT);this._seg.p0.equals(re[fe])||(Be=V.getDepth(Dt.RIGHT));var Xe=new Bi(this._seg,Be);$.add(Xe)}}else if(ln(arguments[2],zr)&&arguments[0]instanceof Ue&&ln(arguments[1],zr))for(var bt=arguments[0],Zt=arguments[2],Qt=arguments[1].iterator();Qt.hasNext();){var un=Qt.next();un.isForward()&&this.findStabbedSegments(bt,un,Zt)}}}},{key:"getDepth",value:function(_){var o=this.findStabbedSegments(_);return o.size()===0?0:_n.min(o)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Fr;var _=arguments[0];this._subgraphs=_}}])})(),Bi=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"compareTo",value:function(_){var o=_;if(this._upwardSeg.minX()>=o._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=o._upwardSeg.minX())return-1;var u=this._upwardSeg.orientationIndex(o._upwardSeg);return u!==0||(u=-1*o._upwardSeg.orientationIndex(this._upwardSeg))!==0?u:this._upwardSeg.compareTo(o._upwardSeg)}},{key:"compareX",value:function(_,o){var u=_.p0.compareTo(o.p0);return u!==0?u:_.p1.compareTo(o.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[_t]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var _=arguments[0],o=arguments[1];this._upwardSeg=new Fr(_),this._leftDepth=o}}])})();Go.DepthSegment=Bi;var qo=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,null,[{key:"constructor_",value:function(){At.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])})(At),go=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getY",value:function(){var o=this.y/this.w;if(Pt.isNaN(o)||Pt.isInfinite(o))throw new qo;return o}},{key:"getX",value:function(){var o=this.x/this.w;if(Pt.isNaN(o)||Pt.isInfinite(o))throw new qo;return o}},{key:"getCoordinate",value:function(){var o=new Ue;return o.x=this.getX(),o.y=this.getY(),o}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var o=arguments[0];this.x=o.x,this.y=o.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var u=arguments[0],g=arguments[1];this.x=u,this.y=g,this.w=1}else if(arguments[0]instanceof _&&arguments[1]instanceof _){var E=arguments[0],P=arguments[1];this.x=E.y*P.w-P.y*E.w,this.y=P.x*E.w-E.x*P.w,this.w=E.x*P.y-P.x*E.y}else if(arguments[0]instanceof Ue&&arguments[1]instanceof Ue){var V=arguments[0],$=arguments[1];this.x=V.y-$.y,this.y=$.x-V.x,this.w=V.x*$.y-$.x*V.y}}else if(arguments.length===3){var re=arguments[0],fe=arguments[1],Be=arguments[2];this.x=re,this.y=fe,this.w=Be}else if(arguments.length===4){var Xe=arguments[0],bt=arguments[1],Zt=arguments[2],Qt=arguments[3],un=Xe.y-bt.y,zn=bt.x-Xe.x,Cn=Xe.x*bt.y-bt.x*Xe.y,oi=Zt.y-Qt.y,ur=Qt.x-Zt.x,hi=Zt.x*Qt.y-Qt.x*Zt.y;this.x=zn*hi-ur*Cn,this.y=oi*Cn-un*hi,this.w=un*ur-oi*zn}}}])})(),yl=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"area",value:function(){return _.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return _.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(o){if(o===null)throw new Mt("Supplied point is null.");return _.interpolateZ(o,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return _.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return _.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return _.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return _.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return _.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return _.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var o=arguments[0],u=arguments[1],g=arguments[2];this.p0=o,this.p1=u,this.p2=g}},{key:"area",value:function(o,u,g){return Math.abs(((g.x-o.x)*(u.y-o.y)-(u.x-o.x)*(g.y-o.y))/2)}},{key:"signedArea",value:function(o,u,g){return((g.x-o.x)*(u.y-o.y)-(u.x-o.x)*(g.y-o.y))/2}},{key:"det",value:function(o,u,g,E){return o*E-u*g}},{key:"interpolateZ",value:function(o,u,g,E){var P=u.x,V=u.y,$=g.x-P,re=E.x-P,fe=g.y-V,Be=E.y-V,Xe=$*Be-re*fe,bt=o.x-P,Zt=o.y-V,Qt=(Be*bt-re*Zt)/Xe,un=(-fe*bt+$*Zt)/Xe;return u.getZ()+Qt*(g.getZ()-u.getZ())+un*(E.getZ()-u.getZ())}},{key:"longestSideLength",value:function(o,u,g){var E=o.distance(u),P=u.distance(g),V=g.distance(o),$=E;return P>$&&($=P),V>$&&($=V),$}},{key:"circumcentreDD",value:function(o,u,g){var E=J.valueOf(o.x).subtract(g.x),P=J.valueOf(o.y).subtract(g.y),V=J.valueOf(u.x).subtract(g.x),$=J.valueOf(u.y).subtract(g.y),re=J.determinant(E,P,V,$).multiply(2),fe=E.sqr().add(P.sqr()),Be=V.sqr().add($.sqr()),Xe=J.determinant(P,fe,$,Be),bt=J.determinant(E,fe,V,Be),Zt=J.valueOf(g.x).subtract(Xe.divide(re)).doubleValue(),Qt=J.valueOf(g.y).add(bt.divide(re)).doubleValue();return new Ue(Zt,Qt)}},{key:"isAcute",value:function(o,u,g){return!!ha.isAcute(o,u,g)&&!!ha.isAcute(u,g,o)&&!!ha.isAcute(g,o,u)}},{key:"circumcentre",value:function(o,u,g){var E=g.x,P=g.y,V=o.x-E,$=o.y-P,re=u.x-E,fe=u.y-P,Be=2*_.det(V,$,re,fe),Xe=_.det($,V*V+$*$,fe,re*re+fe*fe),bt=_.det(V,V*V+$*$,re,re*re+fe*fe);return new Ue(E-Xe/Be,P+bt/Be)}},{key:"perpendicularBisector",value:function(o,u){var g=u.x-o.x,E=u.y-o.y,P=new go(o.x+g/2,o.y+E/2,1),V=new go(o.x-E+g/2,o.y+g+E/2,1);return new go(P,V)}},{key:"angleBisector",value:function(o,u,g){var E=u.distance(o),P=E/(E+u.distance(g)),V=g.x-o.x,$=g.y-o.y;return new Ue(o.x+P*V,o.y+P*$)}},{key:"area3D",value:function(o,u,g){var E=u.x-o.x,P=u.y-o.y,V=u.getZ()-o.getZ(),$=g.x-o.x,re=g.y-o.y,fe=g.getZ()-o.getZ(),Be=P*fe-V*re,Xe=V*$-E*fe,bt=E*re-P*$,Zt=Be*Be+Xe*Xe+bt*bt,Qt=Math.sqrt(Zt)/2;return Qt}},{key:"centroid",value:function(o,u,g){var E=(o.x+u.x+g.x)/3,P=(o.y+u.y+g.y)/3;return new Ue(E,P)}},{key:"inCentre",value:function(o,u,g){var E=u.distance(g),P=o.distance(g),V=o.distance(u),$=E+P+V,re=(E*o.x+P*u.x+V*g.x)/$,fe=(E*o.y+P*u.y+V*g.y)/$;return new Ue(re,fe)}}])})(),_o=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"addRingSide",value:function(_,o,u,g,E){if(o===0&&_.length<Tn.MINIMUM_VALID_SIZE)return null;var P=g,V=E;_.length>=Tn.MINIMUM_VALID_SIZE&&xe.isCCW(_)&&(P=E,V=g,u=Dt.opposite(u));var $=this._curveBuilder.getRingCurve(_,u,o);this.addCurve($,P,V)}},{key:"addRingBothSides",value:function(_,o){this.addRingSide(_,o,Dt.LEFT,Se.EXTERIOR,Se.INTERIOR),this.addRingSide(_,o,Dt.RIGHT,Se.INTERIOR,Se.EXTERIOR)}},{key:"addPoint",value:function(_){if(this._distance<=0)return null;var o=_.getCoordinates(),u=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(u,Se.EXTERIOR,Se.INTERIOR)}},{key:"addPolygon",value:function(_){var o=this._distance,u=Dt.LEFT;this._distance<0&&(o=-this._distance,u=Dt.RIGHT);var g=_.getExteriorRing(),E=ui.removeRepeatedPoints(g.getCoordinates());if(this._distance<0&&this.isErodedCompletely(g,this._distance)||this._distance<=0&&E.length<3)return null;this.addRingSide(E,o,u,Se.EXTERIOR,Se.INTERIOR);for(var P=0;P<_.getNumInteriorRing();P++){var V=_.getInteriorRingN(P),$=ui.removeRepeatedPoints(V.getCoordinates());this._distance>0&&this.isErodedCompletely(V,-this._distance)||this.addRingSide($,o,Dt.opposite(u),Se.INTERIOR,Se.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(_,o){var u=new yl(_[0],_[1],_[2]),g=u.inCentre();return Dn.pointToSegment(g,u.p0,u.p1)<Math.abs(o)}},{key:"addLineString",value:function(_){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var o=ui.removeRepeatedPoints(_.getCoordinates());if(ui.isRing(o)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(o,this._distance);else{var u=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(u,Se.EXTERIOR,Se.INTERIOR)}}},{key:"addCurve",value:function(_,o,u){if(_===null||_.length<2)return null;var g=new ka(_,new Xr(0,Se.BOUNDARY,o,u));this._curveList.add(g)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(_){if(_.isEmpty())return null;if(_ instanceof mr)this.addPolygon(_);else if(_ instanceof Ci)this.addLineString(_);else if(_ instanceof Ni)this.addPoint(_);else if(_ instanceof bn)this.addCollection(_);else if(_ instanceof Ss)this.addCollection(_);else if(_ instanceof Tr)this.addCollection(_);else{if(!(_ instanceof St))throw new er(_.getGeometryType());this.addCollection(_)}}},{key:"isErodedCompletely",value:function(_,o){var u=_.getCoordinates();if(u.length<4)return o<0;if(u.length===4)return this.isTriangleErodedCompletely(u,o);var g=_.getEnvelopeInternal(),E=Math.min(g.getHeight(),g.getWidth());return o<0&&2*Math.abs(o)>E}},{key:"addCollection",value:function(_){for(var o=0;o<_.getNumGeometries();o++){var u=_.getGeometryN(o);this.add(u)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Le;var _=arguments[0],o=arguments[1],u=arguments[2];this._inputGeom=_,this._distance=o,this._curveBuilder=u}}])})(),ah=(function(){return f((function _(){U(this,_)}),[{key:"locate",value:function(_){}}])})(),$l=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,_.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new vi;var o=this._parent.getGeometryN(this._index++);return o instanceof St?(this._subcollectionIterator=new _(o),this._subcollectionIterator.next()):o}},{key:"remove",value:function(){throw new er(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[af]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var o=arguments[0];this._parent=o,this._atStart=!0,this._index=0,this._max=o.getNumGeometries()}},{key:"isAtomic",value:function(o){return!(o instanceof St)}}])})(),sh=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"locate",value:function(o){return _.locate(o,this._geom)}},{key:"interfaces_",get:function(){return[ah]}}],[{key:"constructor_",value:function(){this._geom=null;var o=arguments[0];this._geom=o}},{key:"locatePointInPolygon",value:function(o,u){if(u.isEmpty())return Se.EXTERIOR;var g=u.getExteriorRing(),E=_.locatePointInRing(o,g);if(E!==Se.INTERIOR)return E;for(var P=0;P<u.getNumInteriorRing();P++){var V=u.getInteriorRingN(P),$=_.locatePointInRing(o,V);if($===Se.BOUNDARY)return Se.BOUNDARY;if($===Se.INTERIOR)return Se.EXTERIOR}return Se.INTERIOR}},{key:"locatePointInRing",value:function(o,u){return u.getEnvelopeInternal().intersects(o)?Aa.locateInRing(o,u.getCoordinates()):Se.EXTERIOR}},{key:"containsPointInPolygon",value:function(o,u){return Se.EXTERIOR!==_.locatePointInPolygon(o,u)}},{key:"locateInGeometry",value:function(o,u){if(u instanceof mr)return _.locatePointInPolygon(o,u);if(u instanceof St)for(var g=new $l(u);g.hasNext();){var E=g.next();if(E!==u){var P=_.locateInGeometry(o,E);if(P!==Se.EXTERIOR)return P}}return Se.EXTERIOR}},{key:"isContained",value:function(o,u){return Se.EXTERIOR!==_.locate(o,u)}},{key:"locate",value:function(o,u){return u.isEmpty()?Se.EXTERIOR:u.getEnvelopeInternal().intersects(o)?_.locateInGeometry(o,u):Se.EXTERIOR}}])})(),us=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"getNextCW",value:function(_){this.getEdges();var o=this._edgeList.indexOf(_),u=o-1;return o===0&&(u=this._edgeList.size()-1),this._edgeList.get(u)}},{key:"propagateSideLabels",value:function(_){for(var o=Se.NONE,u=this.iterator();u.hasNext();){var g=u.next().getLabel();g.isArea(_)&&g.getLocation(_,Dt.LEFT)!==Se.NONE&&(o=g.getLocation(_,Dt.LEFT))}if(o===Se.NONE)return null;for(var E=o,P=this.iterator();P.hasNext();){var V=P.next(),$=V.getLabel();if($.getLocation(_,Dt.ON)===Se.NONE&&$.setLocation(_,Dt.ON,E),$.isArea(_)){var re=$.getLocation(_,Dt.LEFT),fe=$.getLocation(_,Dt.RIGHT);if(fe!==Se.NONE){if(fe!==E)throw new Ve("side location conflict",V.getCoordinate());re===Se.NONE&&Ct.shouldNeverReachHere("found single null side (at "+V.getCoordinate()+")"),E=re}else Ct.isTrue($.getLocation(_,Dt.LEFT)===Se.NONE,"found single null side"),$.setLocation(_,Dt.RIGHT,E),$.setLocation(_,Dt.LEFT,E)}}}},{key:"getCoordinate",value:function(){var _=this.iterator();return _.hasNext()?_.next().getCoordinate():null}},{key:"print",value:function(_){qt.out.println("EdgeEndStar:   "+this.getCoordinate());for(var o=this.iterator();o.hasNext();)o.next().print(_)}},{key:"isAreaLabelsConsistent",value:function(_){return this.computeEdgeEndLabels(_.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(_){var o=this.getEdges();if(o.size()<=0)return!0;var u=o.size()-1,g=o.get(u).getLabel().getLocation(_,Dt.LEFT);Ct.isTrue(g!==Se.NONE,"Found unlabelled area edge");for(var E=g,P=this.iterator();P.hasNext();){var V=P.next().getLabel();Ct.isTrue(V.isArea(_),"Found non-area edge");var $=V.getLocation(_,Dt.LEFT),re=V.getLocation(_,Dt.RIGHT);if($===re||re!==E)return!1;E=$}return!0}},{key:"findIndex",value:function(_){this.iterator();for(var o=0;o<this._edgeList.size();o++)if(this._edgeList.get(o)===_)return o;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new Le(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(_,o,u){return this._ptInAreaLocation[_]===Se.NONE&&(this._ptInAreaLocation[_]=sh.locate(o,u[_].getGeometry())),this._ptInAreaLocation[_]}},{key:"toString",value:function(){var _=new wr;_.append("EdgeEndStar:   "+this.getCoordinate()),_.append(`
`);for(var o=this.iterator();o.hasNext();){var u=o.next();_.append(u),_.append(`
`)}return _.toString()}},{key:"computeEdgeEndLabels",value:function(_){for(var o=this.iterator();o.hasNext();)o.next().computeLabel(_)}},{key:"computeLabelling",value:function(_){this.computeEdgeEndLabels(_[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var o=[!1,!1],u=this.iterator();u.hasNext();)for(var g=u.next().getLabel(),E=0;E<2;E++)g.isLine(E)&&g.getLocation(E)===Se.BOUNDARY&&(o[E]=!0);for(var P=this.iterator();P.hasNext();)for(var V=P.next(),$=V.getLabel(),re=0;re<2;re++)if($.isAnyNull(re)){var fe=Se.NONE;if(o[re])fe=Se.EXTERIOR;else{var Be=V.getCoordinate();fe=this.getLocation(re,Be,_)}$.setAllLocationsIfNull(re,fe)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(_,o){this._edgeMap.put(_,o),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new si,this._edgeList=null,this._ptInAreaLocation=[Se.NONE,Se.NONE]}}])})(),Lu=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var u=null,g=null,E=this._SCANNING_FOR_INCOMING,P=0;P<this._resultAreaEdgeList.size();P++){var V=this._resultAreaEdgeList.get(P),$=V.getSym();if(V.getLabel().isArea())switch(u===null&&V.isInResult()&&(u=V),E){case this._SCANNING_FOR_INCOMING:if(!$.isInResult())continue;g=$,E=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!V.isInResult())continue;g.setNext(V),E=this._SCANNING_FOR_INCOMING}}if(E===this._LINKING_TO_OUTGOING){if(u===null)throw new Ve("no outgoing dirEdge found",this.getCoordinate());Ct.isTrue(u.isInResult(),"unable to link last incoming dirEdge"),g.setNext(u)}}},{key:"insert",value:function(u){var g=u;this.insertEdgeEnd(g,g)}},{key:"getRightmostEdge",value:function(){var u=this.getEdges(),g=u.size();if(g<1)return null;var E=u.get(0);if(g===1)return E;var P=u.get(g-1),V=E.getQuadrant(),$=P.getQuadrant();return bi.isNorthern(V)&&bi.isNorthern($)?E:bi.isNorthern(V)||bi.isNorthern($)?E.getDy()!==0?E:P.getDy()!==0?P:(Ct.shouldNeverReachHere("found two horizontal edges incident on node"),null):P}},{key:"print",value:function(u){qt.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var g=this.iterator();g.hasNext();){var E=g.next();u.print("out "),E.print(u),u.println(),u.print("in "),E.getSym().print(u),u.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Le;for(var u=this.iterator();u.hasNext();){var g=u.next();(g.isInResult()||g.getSym().isInResult())&&this._resultAreaEdgeList.add(g)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(u){for(var g=this.iterator();g.hasNext();){var E=g.next().getLabel();E.setAllLocationsIfNull(0,u.getLocation(0)),E.setAllLocationsIfNull(1,u.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var u=null,g=null,E=this._edgeList.size()-1;E>=0;E--){var P=this._edgeList.get(E),V=P.getSym();g===null&&(g=V),u!==null&&V.setNext(u),u=P}g.setNext(u)}},{key:"computeDepths",value:function(){if(arguments.length===1){var u=arguments[0],g=this.findIndex(u),E=u.getDepth(Dt.LEFT),P=u.getDepth(Dt.RIGHT),V=this.computeDepths(g+1,this._edgeList.size(),E);if(this.computeDepths(0,g,V)!==P)throw new Ve("depth mismatch at "+u.getCoordinate())}else if(arguments.length===3){for(var $=arguments[1],re=arguments[2],fe=arguments[0];fe<$;fe++){var Be=this._edgeList.get(fe);Be.setEdgeDepths(Dt.RIGHT,re),re=Be.getDepth(Dt.LEFT)}return re}}},{key:"mergeSymLabels",value:function(){for(var u=this.iterator();u.hasNext();){var g=u.next();g.getLabel().merge(g.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(u){for(var g=null,E=null,P=this._SCANNING_FOR_INCOMING,V=this._resultAreaEdgeList.size()-1;V>=0;V--){var $=this._resultAreaEdgeList.get(V),re=$.getSym();switch(g===null&&$.getEdgeRing()===u&&(g=$),P){case this._SCANNING_FOR_INCOMING:if(re.getEdgeRing()!==u)continue;E=re,P=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if($.getEdgeRing()!==u)continue;E.setNextMin($),P=this._SCANNING_FOR_INCOMING}}P===this._LINKING_TO_OUTGOING&&(Ct.isTrue(g!==null,"found null for first outgoing dirEdge"),Ct.isTrue(g.getEdgeRing()===u,"unable to link last incoming dirEdge"),E.setNextMin(g))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var u=0,g=this.iterator();g.hasNext();)g.next().isInResult()&&u++;return u}if(arguments.length===1){for(var E=arguments[0],P=0,V=this.iterator();V.hasNext();)V.next().getEdgeRing()===E&&P++;return P}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var u=Se.NONE,g=this.iterator();g.hasNext();){var E=g.next(),P=E.getSym();if(!E.isLineEdge()){if(E.isInResult()){u=Se.INTERIOR;break}if(P.isInResult()){u=Se.EXTERIOR;break}}}if(u===Se.NONE)return null;for(var V=u,$=this.iterator();$.hasNext();){var re=$.next(),fe=re.getSym();re.isLineEdge()?re.getEdge().setCovered(V===Se.INTERIOR):(re.isInResult()&&(V=Se.EXTERIOR),fe.isInResult()&&(V=Se.INTERIOR))}}},{key:"computeLabelling",value:function(u){Fe(o,"computeLabelling",this,1).call(this,u),this._label=new Xr(Se.NONE);for(var g=this.iterator();g.hasNext();)for(var E=g.next().getEdge().getLabel(),P=0;P<2;P++){var V=E.getLocation(P);V!==Se.INTERIOR&&V!==Se.BOUNDARY||this._label.setLocation(P,Se.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])})(us),oh=(function(_){function o(){return U(this,o),F(this,o)}return ce(o,_),f(o,[{key:"createNode",value:function(u){return new Qn(u,new Lu)}}])})(nr),Tc=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"compareTo",value:function(o){var u=o;return _.compareOriented(this._pts,this._orientation,u._pts,u._orientation)}},{key:"interfaces_",get:function(){return[_t]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var o=arguments[0];this._pts=o,this._orientation=_.orientation(o)}},{key:"orientation",value:function(o){return ui.increasingDirection(o)===1}},{key:"compareOriented",value:function(o,u,g,E){for(var P=u?1:-1,V=E?1:-1,$=u?o.length:-1,re=E?g.length:-1,fe=u?0:o.length-1,Be=E?0:g.length-1;;){var Xe=o[fe].compareTo(g[Be]);if(Xe!==0)return Xe;var bt=(fe+=P)===$,Zt=(Be+=V)===re;if(bt&&!Zt)return-1;if(!bt&&Zt)return 1;if(bt&&Zt)return 0}}}])})(),zu=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"print",value:function(_){_.print("MULTILINESTRING ( ");for(var o=0;o<this._edges.size();o++){var u=this._edges.get(o);o>0&&_.print(","),_.print("(");for(var g=u.getCoordinates(),E=0;E<g.length;E++)E>0&&_.print(","),_.print(g[E].x+" "+g[E].y);_.println(")")}_.print(")  ")}},{key:"addAll",value:function(_){for(var o=_.iterator();o.hasNext();)this.add(o.next())}},{key:"findEdgeIndex",value:function(_){for(var o=0;o<this._edges.size();o++)if(this._edges.get(o).equals(_))return o;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(_){return this._edges.get(_)}},{key:"findEqualEdge",value:function(_){var o=new Tc(_.getCoordinates());return this._ocaMap.get(o)}},{key:"add",value:function(_){this._edges.add(_);var o=new Tc(_.getCoordinates());this._ocaMap.put(o,_)}}],[{key:"constructor_",value:function(){this._edges=new Le,this._ocaMap=new si}}])})(),Wl=(function(){return f((function _(){U(this,_)}),[{key:"processIntersections",value:function(_,o,u,g){}},{key:"isDone",value:function(){}}])})(),Zo=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"isTrivialIntersection",value:function(o,u,g,E){if(o===g&&this._li.getIntersectionNum()===1){if(_.isAdjacentSegments(u,E))return!0;if(o.isClosed()){var P=o.size()-1;if(u===0&&E===P||E===0&&u===P)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(o,u,g,E){if(o===g&&u===E)return null;this.numTests++;var P=o.getCoordinates()[u],V=o.getCoordinates()[u+1],$=g.getCoordinates()[E],re=g.getCoordinates()[E+1];this._li.computeIntersection(P,V,$,re),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(o,u,g,E)||(this._hasIntersection=!0,o.addIntersections(this._li,u,0),g.addIntersections(this._li,E,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[Wl]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var o=arguments[0];this._li=o}},{key:"isAdjacentSegments",value:function(o,u){return Math.abs(o-u)===1}}])})(),vl=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(_){_.print(this.coord),_.print(" seg # = "+this.segmentIndex),_.println(" dist = "+this.dist)}},{key:"compareTo",value:function(_){var o=_;return this.compare(o.segmentIndex,o.dist)}},{key:"isEndPoint",value:function(_){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===_}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(_,o){return this.segmentIndex<_?-1:this.segmentIndex>_?1:this.dist<o?-1:this.dist>o?1:0}},{key:"interfaces_",get:function(){return[_t]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var _=arguments[0],o=arguments[1],u=arguments[2];this.coord=new Ue(_),this.segmentIndex=o,this.dist=u}}])})(),lh=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"print",value:function(_){_.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(_)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(_){this.addEndpoints();for(var o=this.iterator(),u=o.next();o.hasNext();){var g=o.next(),E=this.createSplitEdge(u,g);_.add(E),u=g}}},{key:"addEndpoints",value:function(){var _=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[_],_,0)}},{key:"createSplitEdge",value:function(_,o){var u=o.segmentIndex-_.segmentIndex+2,g=this.edge.pts[o.segmentIndex],E=o.dist>0||!o.coord.equals2D(g);E||u--;var P=new Array(u).fill(null),V=0;P[V++]=new Ue(_.coord);for(var $=_.segmentIndex+1;$<=o.segmentIndex;$++)P[V++]=this.edge.pts[$];return E&&(P[V]=o.coord),new Ou(P,new Xr(this.edge._label))}},{key:"add",value:function(_,o,u){var g=new vl(_,o,u),E=this._nodeMap.get(g);return E!==null?E:(this._nodeMap.put(g,g),g)}},{key:"isIntersection",value:function(_){for(var o=this.iterator();o.hasNext();)if(o.next().coord.equals(_))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new si,this.edge=null;var _=arguments[0];this.edge=_}}])})(),Ql=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(_.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])||_.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||_.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||_.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===xt.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===xt.FALSE}},{key:"isCoveredBy",value:function(){return(_.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])||_.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||_.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||_.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===xt.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===xt.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var o=arguments[0],u=0;u<o.length;u++){var g=Math.trunc(u/3),E=u%3;this._matrix[g][E]=xt.toDimensionValue(o.charAt(u))}else if(arguments.length===3){var P=arguments[0],V=arguments[1],$=arguments[2];this._matrix[P][V]=$}}},{key:"isContains",value:function(){return _.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===xt.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===xt.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var o=arguments[0],u=0;u<o.length;u++){var g=Math.trunc(u/3),E=u%3;this.setAtLeast(g,E,xt.toDimensionValue(o.charAt(u)))}else if(arguments.length===3){var P=arguments[0],V=arguments[1],$=arguments[2];this._matrix[P][V]<$&&(this._matrix[P][V]=$)}}},{key:"setAtLeastIfValid",value:function(o,u,g){o>=0&&u>=0&&this.setAtLeast(o,u,g)}},{key:"isWithin",value:function(){return _.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===xt.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===xt.FALSE}},{key:"isTouches",value:function(o,u){return o>u?this.isTouches(u,o):(o===xt.A&&u===xt.A||o===xt.L&&u===xt.L||o===xt.L&&u===xt.A||o===xt.P&&u===xt.A||o===xt.P&&u===xt.L)&&this._matrix[Se.INTERIOR][Se.INTERIOR]===xt.FALSE&&(_.isTrue(this._matrix[Se.INTERIOR][Se.BOUNDARY])||_.isTrue(this._matrix[Se.BOUNDARY][Se.INTERIOR])||_.isTrue(this._matrix[Se.BOUNDARY][Se.BOUNDARY]))}},{key:"isOverlaps",value:function(o,u){return o===xt.P&&u===xt.P||o===xt.A&&u===xt.A?_.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&_.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR])&&_.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR]):o===xt.L&&u===xt.L&&this._matrix[Se.INTERIOR][Se.INTERIOR]===1&&_.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR])&&_.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR])}},{key:"isEquals",value:function(o,u){return o===u&&_.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&this._matrix[Se.INTERIOR][Se.EXTERIOR]===xt.FALSE&&this._matrix[Se.BOUNDARY][Se.EXTERIOR]===xt.FALSE&&this._matrix[Se.EXTERIOR][Se.INTERIOR]===xt.FALSE&&this._matrix[Se.EXTERIOR][Se.BOUNDARY]===xt.FALSE}},{key:"toString",value:function(){for(var o=new Ia("123456789"),u=0;u<3;u++)for(var g=0;g<3;g++)o.setCharAt(3*u+g,xt.toDimensionSymbol(this._matrix[u][g]));return o.toString()}},{key:"setAll",value:function(o){for(var u=0;u<3;u++)for(var g=0;g<3;g++)this._matrix[u][g]=o}},{key:"get",value:function(o,u){return this._matrix[o][u]}},{key:"transpose",value:function(){var o=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=o,o=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=o,o=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=o,this}},{key:"matches",value:function(o){if(o.length!==9)throw new Mt("Should be length 9: "+o);for(var u=0;u<3;u++)for(var g=0;g<3;g++)if(!_.matches(this._matrix[u][g],o.charAt(3*u+g)))return!1;return!0}},{key:"add",value:function(o){for(var u=0;u<3;u++)for(var g=0;g<3;g++)this.setAtLeast(u,g,o.get(u,g))}},{key:"isDisjoint",value:function(){return this._matrix[Se.INTERIOR][Se.INTERIOR]===xt.FALSE&&this._matrix[Se.INTERIOR][Se.BOUNDARY]===xt.FALSE&&this._matrix[Se.BOUNDARY][Se.INTERIOR]===xt.FALSE&&this._matrix[Se.BOUNDARY][Se.BOUNDARY]===xt.FALSE}},{key:"isCrosses",value:function(o,u){return o===xt.P&&u===xt.L||o===xt.P&&u===xt.A||o===xt.L&&u===xt.A?_.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&_.isTrue(this._matrix[Se.INTERIOR][Se.EXTERIOR]):o===xt.L&&u===xt.P||o===xt.A&&u===xt.P||o===xt.A&&u===xt.L?_.isTrue(this._matrix[Se.INTERIOR][Se.INTERIOR])&&_.isTrue(this._matrix[Se.EXTERIOR][Se.INTERIOR]):o===xt.L&&u===xt.L&&this._matrix[Se.INTERIOR][Se.INTERIOR]===0}},{key:"interfaces_",get:function(){return[Gt]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map((function(){return Array(3)})),this.setAll(xt.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var o=arguments[0];_.constructor_.call(this),this.set(o)}else if(arguments[0]instanceof _){var u=arguments[0];_.constructor_.call(this),this._matrix[Se.INTERIOR][Se.INTERIOR]=u._matrix[Se.INTERIOR][Se.INTERIOR],this._matrix[Se.INTERIOR][Se.BOUNDARY]=u._matrix[Se.INTERIOR][Se.BOUNDARY],this._matrix[Se.INTERIOR][Se.EXTERIOR]=u._matrix[Se.INTERIOR][Se.EXTERIOR],this._matrix[Se.BOUNDARY][Se.INTERIOR]=u._matrix[Se.BOUNDARY][Se.INTERIOR],this._matrix[Se.BOUNDARY][Se.BOUNDARY]=u._matrix[Se.BOUNDARY][Se.BOUNDARY],this._matrix[Se.BOUNDARY][Se.EXTERIOR]=u._matrix[Se.BOUNDARY][Se.EXTERIOR],this._matrix[Se.EXTERIOR][Se.INTERIOR]=u._matrix[Se.EXTERIOR][Se.INTERIOR],this._matrix[Se.EXTERIOR][Se.BOUNDARY]=u._matrix[Se.EXTERIOR][Se.BOUNDARY],this._matrix[Se.EXTERIOR][Se.EXTERIOR]=u._matrix[Se.EXTERIOR][Se.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var o=arguments[0],u=arguments[1];return u===xt.SYM_DONTCARE||u===xt.SYM_TRUE&&(o>=0||o===xt.TRUE)||u===xt.SYM_FALSE&&o===xt.FALSE||u===xt.SYM_P&&o===xt.P||u===xt.SYM_L&&o===xt.L||u===xt.SYM_A&&o===xt.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var g=arguments[1];return new _(arguments[0]).matches(g)}}},{key:"isTrue",value:function(o){return o>=0||o===xt.TRUE}}])})(),yo=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(o){return o===null||o.length===0?null:(this.ensureCapacity(this._size+o.length),qt.arraycopy(o,0,this._data,this._size,o.length),void(this._size+=o.length))}},{key:"ensureCapacity",value:function(o){if(o<=this._data.length)return null;var u=Math.max(o,2*this._data.length);this._data=Ca.copyOf(this._data,u)}},{key:"toArray",value:function(){var o=new Array(this._size).fill(null);return qt.arraycopy(this._data,0,o,0,this._size),o}},{key:"add",value:function(o){this.ensureCapacity(this._size+1),this._data[this._size]=o,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)_.constructor_.call(this,10);else if(arguments.length===1){var o=arguments[0];this._data=new Array(o).fill(null)}}}])})(),Sc=(function(){function _(){U(this,_)}return f(_,[{key:"getChainStartIndices",value:function(o){var u=0,g=new yo(Math.trunc(o.length/2));g.add(u);do{var E=this.findChainEnd(o,u);g.add(E),u=E}while(u<o.length-1);return g.toArray()}},{key:"findChainEnd",value:function(o,u){for(var g=bi.quadrant(o[u],o[u+1]),E=u+1;E<o.length&&bi.quadrant(o[E-1],o[E])===g;)E++;return E-1}},{key:"OLDgetChainStartIndices",value:function(o){var u=0,g=new Le;g.add(u);do{var E=this.findChainEnd(o,u);g.add(E),u=E}while(u<o.length-1);return _.toIntArray(g)}}],[{key:"toIntArray",value:function(o){for(var u=new Array(o.size()).fill(null),g=0;g<u.length;g++)u[g]=o.get(g).intValue();return u}}])})(),Kl=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(_){var o=this.pts[this.startIndex[_]].x,u=this.pts[this.startIndex[_+1]].x;return o>u?o:u}},{key:"getMinX",value:function(_){var o=this.pts[this.startIndex[_]].x,u=this.pts[this.startIndex[_+1]].x;return o<u?o:u}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var _=arguments[0],o=arguments[1],u=arguments[2],g=arguments[3];this.computeIntersectsForChain(this.startIndex[_],this.startIndex[_+1],o,o.startIndex[u],o.startIndex[u+1],g)}else if(arguments.length===6){var E=arguments[0],P=arguments[1],V=arguments[2],$=arguments[3],re=arguments[4],fe=arguments[5];if(P-E==1&&re-$==1)return fe.addIntersections(this.e,E,V.e,$),null;if(!this.overlaps(E,P,V,$,re))return null;var Be=Math.trunc((E+P)/2),Xe=Math.trunc(($+re)/2);E<Be&&($<Xe&&this.computeIntersectsForChain(E,Be,V,$,Xe,fe),Xe<re&&this.computeIntersectsForChain(E,Be,V,Xe,re,fe)),Be<P&&($<Xe&&this.computeIntersectsForChain(Be,P,V,$,Xe,fe),Xe<re&&this.computeIntersectsForChain(Be,P,V,Xe,re,fe))}}},{key:"overlaps",value:function(_,o,u,g,E){return Ln.intersects(this.pts[_],this.pts[o],u.pts[g],u.pts[E])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(_,o){for(var u=0;u<this.startIndex.length-1;u++)for(var g=0;g<_.startIndex.length-1;g++)this.computeIntersectsForChain(u,_,g,o)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var _=arguments[0];this.e=_,this.pts=_.getCoordinates();var o=new Sc;this.startIndex=o.getChainStartIndices(this.pts)}}])})(),Hs=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"getDepth",value:function(o,u){return this._depth[o][u]}},{key:"setDepth",value:function(o,u,g){this._depth[o][u]=g}},{key:"isNull",value:function(){if(arguments.length===0){for(var o=0;o<2;o++)for(var u=0;u<3;u++)if(this._depth[o][u]!==_.NULL_VALUE)return!1;return!0}if(arguments.length===1){var g=arguments[0];return this._depth[g][1]===_.NULL_VALUE}if(arguments.length===2){var E=arguments[0],P=arguments[1];return this._depth[E][P]===_.NULL_VALUE}}},{key:"normalize",value:function(){for(var o=0;o<2;o++)if(!this.isNull(o)){var u=this._depth[o][1];this._depth[o][2]<u&&(u=this._depth[o][2]),u<0&&(u=0);for(var g=1;g<3;g++){var E=0;this._depth[o][g]>u&&(E=1),this._depth[o][g]=E}}}},{key:"getDelta",value:function(o){return this._depth[o][Dt.RIGHT]-this._depth[o][Dt.LEFT]}},{key:"getLocation",value:function(o,u){return this._depth[o][u]<=0?Se.EXTERIOR:Se.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var o=arguments[0],u=0;u<2;u++)for(var g=1;g<3;g++){var E=o.getLocation(u,g);E!==Se.EXTERIOR&&E!==Se.INTERIOR||(this.isNull(u,g)?this._depth[u][g]=_.depthAtLocation(E):this._depth[u][g]+=_.depthAtLocation(E))}else if(arguments.length===3){var P=arguments[0],V=arguments[1];arguments[2]===Se.INTERIOR&&this._depth[P][V]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var o=0;o<2;o++)for(var u=0;u<3;u++)this._depth[o][u]=_.NULL_VALUE}},{key:"depthAtLocation",value:function(o){return o===Se.EXTERIOR?0:o===Se.INTERIOR?1:_.NULL_VALUE}}])})();Hs.NULL_VALUE=-1;var Ou=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var u=new Array(2).fill(null);return u[0]=this.pts[0],u[1]=this.pts[1],new o(u,Xr.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(u){this._isIsolated=u}},{key:"setName",value:function(u){this._name=u}},{key:"equals",value:function(u){if(!(u instanceof o))return!1;var g=u;if(this.pts.length!==g.pts.length)return!1;for(var E=!0,P=!0,V=this.pts.length,$=0;$<this.pts.length;$++)if(this.pts[$].equals2D(g.pts[$])||(E=!1),this.pts[$].equals2D(g.pts[--V])||(P=!1),!E&&!P)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var u=arguments[0];return this.pts[u]}}},{key:"print",value:function(u){u.print("edge "+this._name+": "),u.print("LINESTRING (");for(var g=0;g<this.pts.length;g++)g>0&&u.print(","),u.print(this.pts[g].x+" "+this.pts[g].y);u.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(u){o.updateIM(this._label,u)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(u){u.print("edge "+this._name+": ");for(var g=this.pts.length-1;g>=0;g--)u.print(this.pts[g]+" ");u.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new Kl(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Ln;for(var u=0;u<this.pts.length;u++)this._env.expandToInclude(this.pts[u])}return this._env}},{key:"addIntersection",value:function(u,g,E,P){var V=new Ue(u.getIntersection(P)),$=g,re=u.getEdgeDistance(E,P),fe=$+1;if(fe<this.pts.length){var Be=this.pts[fe];V.equals2D(Be)&&($=fe,re=0)}this.eiList.add(V,$,re)}},{key:"toString",value:function(){var u=new Ia;u.append("edge "+this._name+": "),u.append("LINESTRING (");for(var g=0;g<this.pts.length;g++)g>0&&u.append(","),u.append(this.pts[g].x+" "+this.pts[g].y);return u.append(")  "+this._label+" "+this._depthDelta),u.toString()}},{key:"isPointwiseEqual",value:function(u){if(this.pts.length!==u.pts.length)return!1;for(var g=0;g<this.pts.length;g++)if(!this.pts[g].equals2D(u.pts[g]))return!1;return!0}},{key:"setDepthDelta",value:function(u){this._depthDelta=u}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(u,g,E){for(var P=0;P<u.getIntersectionNum();P++)this.addIntersection(u,g,E,P)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new lh(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Hs,this._depthDelta=0,arguments.length===1){var u=arguments[0];o.constructor_.call(this,u,null)}else if(arguments.length===2){var g=arguments[0],E=arguments[1];this.pts=g,this._label=E}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Ql&&arguments[0]instanceof Xr))return Fe(o,"updateIM",this).apply(this,arguments);var u=arguments[0],g=arguments[1];g.setAtLeastIfValid(u.getLocation(0,Dt.ON),u.getLocation(1,Dt.ON),1),u.isArea()&&(g.setAtLeastIfValid(u.getLocation(0,Dt.LEFT),u.getLocation(1,Dt.LEFT),2),g.setAtLeastIfValid(u.getLocation(0,Dt.RIGHT),u.getLocation(1,Dt.RIGHT),2))}}])})(mn),xl=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"setWorkingPrecisionModel",value:function(o){this._workingPrecisionModel=o}},{key:"insertUniqueEdge",value:function(o){var u=this._edgeList.findEqualEdge(o);if(u!==null){var g=u.getLabel(),E=o.getLabel();u.isPointwiseEqual(o)||(E=new Xr(o.getLabel())).flip(),g.merge(E);var P=_.depthDelta(E),V=u.getDepthDelta()+P;u.setDepthDelta(V)}else this._edgeList.add(o),o.setDepthDelta(_.depthDelta(o.getLabel()))}},{key:"buildSubgraphs",value:function(o,u){for(var g=new Le,E=o.iterator();E.hasNext();){var P=E.next(),V=P.getRightmostCoordinate(),$=new Go(g).getDepth(V);P.computeDepth($),P.findResultEdges(),g.add(P),u.add(P.getDirectedEdges(),P.getNodes())}}},{key:"createSubgraphs",value:function(o){for(var u=new Le,g=o.getNodes().iterator();g.hasNext();){var E=g.next();if(!E.isVisited()){var P=new ht;P.create(E),u.add(P)}}return _n.sort(u,_n.reverseOrder()),u}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(o){if(this._workingNoder!==null)return this._workingNoder;var u=new wc,g=new qa;return g.setPrecisionModel(o),u.setSegmentIntersector(new Zo(g)),u}},{key:"buffer",value:function(o,u){var g=this._workingPrecisionModel;g===null&&(g=o.getPrecisionModel()),this._geomFact=o.getFactory();var E=new _l(g,this._bufParams),P=new _o(o,u,E).getCurves();if(P.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(P,g),this._graph=new $r(new oh),this._graph.addEdges(this._edgeList.getEdges());var V=this.createSubgraphs(this._graph),$=new Yl(this._geomFact);this.buildSubgraphs(V,$);var re=$.getPolygons();return re.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(re)}},{key:"computeNodedEdges",value:function(o,u){var g=this.getNoder(u);g.computeNodes(o);for(var E=g.getNodedSubstrings().iterator();E.hasNext();){var P=E.next(),V=P.getCoordinates();if(V.length!==2||!V[0].equals2D(V[1])){var $=P.getData(),re=new Ou(P.getCoordinates(),new Xr($));this.insertUniqueEdge(re)}}}},{key:"setNoder",value:function(o){this._workingNoder=o}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new zu;var o=arguments[0];this._bufParams=o}},{key:"depthDelta",value:function(o){var u=o.getLocation(0,Dt.LEFT),g=o.getLocation(0,Dt.RIGHT);return u===Se.INTERIOR&&g===Se.EXTERIOR?1:u===Se.EXTERIOR&&g===Se.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(o){for(var u=new Hr,g=new Le;o.hasNext();){var E=o.next(),P=u.createLineString(E.getCoordinates());g.add(P)}return u.buildGeometry(g)}}])})(),uh=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"rescale",value:function(){if(ln(arguments[0],oa))for(var o=arguments[0].iterator();o.hasNext();){var u=o.next();this.rescale(u.getCoordinates())}else if(arguments[0]instanceof Array){for(var g=arguments[0],E=0;E<g.length;E++)g[E].x=g[E].x/this._scaleFactor+this._offsetX,g[E].y=g[E].y/this._scaleFactor+this._offsetY;g.length===2&&g[0].equals2D(g[1])&&qt.out.println(g)}}},{key:"scale",value:function(){if(ln(arguments[0],oa)){for(var o=arguments[0],u=new Le(o.size()),g=o.iterator();g.hasNext();){var E=g.next();u.add(new ka(this.scale(E.getCoordinates()),E.getData()))}return u}if(arguments[0]instanceof Array){for(var P=arguments[0],V=new Array(P.length).fill(null),$=0;$<P.length;$++)V[$]=new Ue(Math.round((P[$].x-this._offsetX)*this._scaleFactor),Math.round((P[$].y-this._offsetY)*this._scaleFactor),P[$].getZ());return ui.removeRepeatedPoints(V)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var o=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(o),o}},{key:"computeNodes",value:function(o){var u=o;this._isScaled&&(u=this.scale(o)),this._noder.computeNodes(u)}},{key:"interfaces_",get:function(){return[gl]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var o=arguments[0],u=arguments[1];_.constructor_.call(this,o,u,0,0)}else if(arguments.length===4){var g=arguments[0],E=arguments[1];this._noder=g,this._scaleFactor=E,this._isScaled=!this.isIntegerPrecision()}}}])})(),ch=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var o=this._segStrings.iterator();o.hasNext();){var u=o.next().getCoordinates();this.checkEndPtVertexIntersections(u[0],this._segStrings),this.checkEndPtVertexIntersections(u[u.length-1],this._segStrings)}else if(arguments.length===2){for(var g=arguments[0],E=arguments[1].iterator();E.hasNext();)for(var P=E.next().getCoordinates(),V=1;V<P.length-1;V++)if(P[V].equals(g))throw new lt("found endpt/interior pt intersection at index "+V+" :pt "+g)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var o=this._segStrings.iterator();o.hasNext();)for(var u=o.next(),g=this._segStrings.iterator();g.hasNext();){var E=g.next();this.checkInteriorIntersections(u,E)}else if(arguments.length===2)for(var P=arguments[0],V=arguments[1],$=P.getCoordinates(),re=V.getCoordinates(),fe=0;fe<$.length-1;fe++)for(var Be=0;Be<re.length-1;Be++)this.checkInteriorIntersections(P,fe,V,Be);else if(arguments.length===4){var Xe=arguments[0],bt=arguments[1],Zt=arguments[2],Qt=arguments[3];if(Xe===Zt&&bt===Qt)return null;var un=Xe.getCoordinates()[bt],zn=Xe.getCoordinates()[bt+1],Cn=Zt.getCoordinates()[Qt],oi=Zt.getCoordinates()[Qt+1];if(this._li.computeIntersection(un,zn,Cn,oi),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,un,zn)||this.hasInteriorIntersection(this._li,Cn,oi)))throw new lt("found non-noded intersection at "+un+"-"+zn+" and "+Cn+"-"+oi)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var o=this._segStrings.iterator();o.hasNext();){var u=o.next();this.checkCollapses(u)}else if(arguments.length===1)for(var g=arguments[0].getCoordinates(),E=0;E<g.length-2;E++)this.checkCollapse(g[E],g[E+1],g[E+2])}},{key:"hasInteriorIntersection",value:function(o,u,g){for(var E=0;E<o.getIntersectionNum();E++){var P=o.getIntersection(E);if(!P.equals(u)&&!P.equals(g))return!0}return!1}},{key:"checkCollapse",value:function(o,u,g){if(o.equals(g))throw new lt("found non-noded collapse at "+_.fact.createLineString([o,u,g]))}}],[{key:"constructor_",value:function(){this._li=new qa,this._segStrings=null;var o=arguments[0];this._segStrings=o}}])})();ch.fact=new Hr;var Nu=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"intersectsScaled",value:function(o,u){var g=Math.min(o.x,u.x),E=Math.max(o.x,u.x),P=Math.min(o.y,u.y),V=Math.max(o.y,u.y),$=this._maxx<g||this._minx>E||this._maxy<P||this._miny>V;if($)return!1;var re=this.intersectsToleranceSquare(o,u);return Ct.isTrue(!($&&re),"Found bad envelope test"),re}},{key:"initCorners",value:function(o){var u=.5;this._minx=o.x-u,this._maxx=o.x+u,this._miny=o.y-u,this._maxy=o.y+u,this._corner[0]=new Ue(this._maxx,this._maxy),this._corner[1]=new Ue(this._minx,this._maxy),this._corner[2]=new Ue(this._minx,this._miny),this._corner[3]=new Ue(this._maxx,this._miny)}},{key:"intersects",value:function(o,u){return this._scaleFactor===1?this.intersectsScaled(o,u):(this.copyScaled(o,this._p0Scaled),this.copyScaled(u,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(o){return Math.round(o*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(o,u){u.x=this.scale(o.x),u.y=this.scale(o.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var o=_.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Ln(this._originalPt.x-o,this._originalPt.x+o,this._originalPt.y-o,this._originalPt.y+o)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(o,u){return this._li.computeIntersection(o,u,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(o,u,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(o,u,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(o,u,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(o,u){var g=!1,E=!1;return this._li.computeIntersection(o,u,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(o,u,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(g=!0),this._li.computeIntersection(o,u,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(E=!0),this._li.computeIntersection(o,u,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!g||!E)||!!o.equals(this._pt)||!!u.equals(this._pt))))}},{key:"addSnappedNode",value:function(o,u){var g=o.getCoordinate(u),E=o.getCoordinate(u+1);return!!this.intersects(g,E)&&(o.addIntersection(this.getCoordinate(),u),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var o=arguments[0],u=arguments[1],g=arguments[2];if(this._originalPt=o,this._pt=o,this._scaleFactor=u,this._li=g,u<=0)throw new Mt("Scale factor must be non-zero");u!==1&&(this._pt=new Ue(this.scale(o.x),this.scale(o.y)),this._p0Scaled=new Ue,this._p1Scaled=new Ue),this.initCorners(this._pt)}}])})();Nu.SAFE_ENV_EXPANSION_FACTOR=.75;var Jl=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var _=arguments[1];arguments[0].getLineSegment(_,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Fr}}])})(),Ec=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"snap",value:function(){if(arguments.length===1){var _=arguments[0];return this.snap(_,null,-1)}if(arguments.length===3){var o=arguments[0],u=arguments[1],g=arguments[2],E=o.getSafeEnvelope(),P=new Bu(o,u,g);return this._index.query(E,new((function(){return f((function V(){U(this,V)}),[{key:"interfaces_",get:function(){return[ml]}},{key:"visitItem",value:function(V){V.select(E,P)}}])})())),P.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var _=arguments[0];this._index=_}}])})(),Bu=(function(_){function o(){var u;return U(this,o),u=F(this,o),o.constructor_.apply(u,arguments),u}return ce(o,_),f(o,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof zi))return Fe(o,"select",this,1).apply(this,arguments);var u=arguments[1],g=arguments[0].getContext();if(this._parentEdge===g&&(u===this._hotPixelVertexIndex||u+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(g,u)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var u=arguments[0],g=arguments[1],E=arguments[2];this._hotPixel=u,this._parentEdge=g,this._hotPixelVertexIndex=E}}])})(Jl);Ec.HotPixelSnapAction=Bu;var ya=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"processIntersections",value:function(_,o,u,g){if(_===u&&o===g)return null;var E=_.getCoordinates()[o],P=_.getCoordinates()[o+1],V=u.getCoordinates()[g],$=u.getCoordinates()[g+1];if(this._li.computeIntersection(E,P,V,$),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var re=0;re<this._li.getIntersectionNum();re++)this._interiorIntersections.add(this._li.getIntersection(re));_.addIntersections(this._li,o,0),u.addIntersections(this._li,g,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[Wl]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var _=arguments[0];this._li=_,this._interiorIntersections=new Le}}])})(),vo=(function(){return f((function _(){U(this,_),_.constructor_.apply(this,arguments)}),[{key:"checkCorrectness",value:function(_){var o=ka.getNodedSubstrings(_),u=new ch(o);try{u.checkValid()}catch(g){if(!(g instanceof At))throw g;g.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return ka.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(_,o){var u=this.findInteriorIntersections(_,o);this.computeIntersectionSnaps(u),this.computeVertexSnaps(_)}},{key:"findInteriorIntersections",value:function(_,o){var u=new ya(o);return this._noder.setSegmentIntersector(u),this._noder.computeNodes(_),u.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(ln(arguments[0],oa))for(var _=arguments[0].iterator();_.hasNext();){var o=_.next();this.computeVertexSnaps(o)}else if(arguments[0]instanceof ka)for(var u=arguments[0],g=u.getCoordinates(),E=0;E<g.length;E++){var P=new Nu(g[E],this._scaleFactor,this._li);this._pointSnapper.snap(P,u,E)&&u.addIntersection(g[E],E)}}},{key:"computeNodes",value:function(_){this._nodedSegStrings=_,this._noder=new wc,this._pointSnapper=new Ec(this._noder.getIndex()),this.snapRound(_,this._li)}},{key:"computeIntersectionSnaps",value:function(_){for(var o=_.iterator();o.hasNext();){var u=o.next(),g=new Nu(u,this._scaleFactor,this._li);this._pointSnapper.snap(g)}}},{key:"interfaces_",get:function(){return[gl]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var _=arguments[0];this._pm=_,this._li=new qa,this._li.setPrecisionModel(_),this._scaleFactor=_.getScale()}}])})(),Vr=(function(){function _(){U(this,_),_.constructor_.apply(this,arguments)}return f(_,[{key:"bufferFixedPrecision",value:function(o){var u=new uh(new vo(new Yr(1)),o.getScale()),g=new xl(this._bufParams);g.setWorkingPrecisionModel(o),g.setNoder(u),this._resultGeometry=g.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var o=_.MAX_PRECISION_DIGITS;o>=0;o--){try{this.bufferReducedPrecision(o)}catch(P){if(!(P instanceof Ve))throw P;this._saveException=P}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var u=arguments[0],g=_.precisionScaleFactor(this._argGeom,this._distance,u),E=new Yr(g);this.bufferFixedPrecision(E)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var o=this._argGeom.getFactory().getPrecisionModel();o.getType()===Yr.FIXED?this.bufferFixedPrecision(o):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(o){this._bufParams.setQuadrantSegments(o)}},{key:"bufferOriginalPrecision",value:function(){try{var o=new xl(this._bufParams);this._resultGeometry=o.buffer(this._argGeom,this._distance)}catch(u){if(!(u instanceof lt))throw u;this._saveException=u}}},{key:"getResultGeometry",value:function(o){return this._distance=o,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(o){this._bufParams.setEndCapStyle(o)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new rt,this._resultGeometry=null,this._saveException=null,arguments.length===1){var o=arguments[0];this._argGeom=o}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this._argGeom=u,this._bufParams=g}}},{key:"bufferOp",value:function(){if(arguments.length===2){var o=arguments[1];return new _(arguments[0]).getResultGeometry(o)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof rn&&typeof arguments[1]=="number"){var u=arguments[1],g=arguments[2],E=new _(arguments[0]);return E.setQuadrantSegments(g),E.getResultGeometry(u)}if(arguments[2]instanceof rt&&arguments[0]instanceof rn&&typeof arguments[1]=="number"){var P=arguments[1];return new _(arguments[0],arguments[2]).getResultGeometry(P)}}else if(arguments.length===4){var V=arguments[1],$=arguments[2],re=arguments[3],fe=new _(arguments[0]);return fe.setQuadrantSegments($),fe.setEndCapStyle(re),fe.getResultGeometry(V)}}},{key:"precisionScaleFactor",value:function(o,u,g){var E=o.getEnvelopeInternal(),P=pn.max(Math.abs(E.getMaxX()),Math.abs(E.getMaxY()),Math.abs(E.getMinX()),Math.abs(E.getMinY()))+2*(u>0?u:0),V=g-Math.trunc(Math.log(P)/Math.log(10)+1);return Math.pow(10,V)}}])})();Vr.CAP_ROUND=rt.CAP_ROUND,Vr.CAP_BUTT=rt.CAP_FLAT,Vr.CAP_FLAT=rt.CAP_FLAT,Vr.CAP_SQUARE=rt.CAP_SQUARE,Vr.MAX_PRECISION_DIGITS=12;var eu=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],tu=(function(){return f((function _(o){U(this,_),this.geometryFactory=o||new Hr}),[{key:"read",value:function(_){var o,u=(o=typeof _=="string"?JSON.parse(_):_).type;if(!fa[u])throw new Error("Unknown GeoJSON type: "+o.type);return eu.indexOf(u)!==-1?fa[u].call(this,o.coordinates):u==="GeometryCollection"?fa[u].call(this,o.geometries):fa[u].call(this,o)}},{key:"write",value:function(_){var o=_.getGeometryType();if(!va[o])throw new Error("Geometry is not supported");return va[o].call(this,_)}}])})(),fa={Feature:function(_){var o={};for(var u in _)o[u]=_[u];if(_.geometry){var g=_.geometry.type;if(!fa[g])throw new Error("Unknown GeoJSON type: "+_.type);o.geometry=this.read(_.geometry)}return _.bbox&&(o.bbox=fa.bbox.call(this,_.bbox)),o},FeatureCollection:function(_){var o={};if(_.features){o.features=[];for(var u=0;u<_.features.length;++u)o.features.push(this.read(_.features[u]))}return _.bbox&&(o.bbox=this.parse.bbox.call(this,_.bbox)),o},coordinates:function(_){for(var o=[],u=0;u<_.length;++u){var g=_[u];o.push(ee(Ue,at(g)))}return o},bbox:function(_){return this.geometryFactory.createLinearRing([new Ue(_[0],_[1]),new Ue(_[2],_[1]),new Ue(_[2],_[3]),new Ue(_[0],_[3]),new Ue(_[0],_[1])])},Point:function(_){var o=ee(Ue,at(_));return this.geometryFactory.createPoint(o)},MultiPoint:function(_){for(var o=[],u=0;u<_.length;++u)o.push(fa.Point.call(this,_[u]));return this.geometryFactory.createMultiPoint(o)},LineString:function(_){var o=fa.coordinates.call(this,_);return this.geometryFactory.createLineString(o)},MultiLineString:function(_){for(var o=[],u=0;u<_.length;++u)o.push(fa.LineString.call(this,_[u]));return this.geometryFactory.createMultiLineString(o)},Polygon:function(_){for(var o=fa.coordinates.call(this,_[0]),u=this.geometryFactory.createLinearRing(o),g=[],E=1;E<_.length;++E){var P=_[E],V=fa.coordinates.call(this,P),$=this.geometryFactory.createLinearRing(V);g.push($)}return this.geometryFactory.createPolygon(u,g)},MultiPolygon:function(_){for(var o=[],u=0;u<_.length;++u){var g=_[u];o.push(fa.Polygon.call(this,g))}return this.geometryFactory.createMultiPolygon(o)},GeometryCollection:function(_){for(var o=[],u=0;u<_.length;++u){var g=_[u];o.push(this.read(g))}return this.geometryFactory.createGeometryCollection(o)}},va={coordinate:function(_){var o=[_.x,_.y];return _.z&&o.push(_.z),_.m&&o.push(_.m),o},Point:function(_){return{type:"Point",coordinates:va.coordinate.call(this,_.getCoordinate())}},MultiPoint:function(_){for(var o=[],u=0;u<_._geometries.length;++u){var g=_._geometries[u],E=va.Point.call(this,g);o.push(E.coordinates)}return{type:"MultiPoint",coordinates:o}},LineString:function(_){for(var o=[],u=_.getCoordinates(),g=0;g<u.length;++g){var E=u[g];o.push(va.coordinate.call(this,E))}return{type:"LineString",coordinates:o}},MultiLineString:function(_){for(var o=[],u=0;u<_._geometries.length;++u){var g=_._geometries[u],E=va.LineString.call(this,g);o.push(E.coordinates)}return{type:"MultiLineString",coordinates:o}},Polygon:function(_){var o=[],u=va.LineString.call(this,_._shell);o.push(u.coordinates);for(var g=0;g<_._holes.length;++g){var E=_._holes[g],P=va.LineString.call(this,E);o.push(P.coordinates)}return{type:"Polygon",coordinates:o}},MultiPolygon:function(_){for(var o=[],u=0;u<_._geometries.length;++u){var g=_._geometries[u],E=va.Polygon.call(this,g);o.push(E.coordinates)}return{type:"MultiPolygon",coordinates:o}},GeometryCollection:function(_){for(var o=[],u=0;u<_._geometries.length;++u){var g=_._geometries[u],E=g.getGeometryType();o.push(va[E].call(this,g))}return{type:"GeometryCollection",geometries:o}}};return{BufferOp:Vr,GeoJSONReader:(function(){return f((function _(o){U(this,_),this.parser=new tu(o||new Hr)}),[{key:"read",value:function(_){return this.parser.read(_)}}])})(),GeoJSONWriter:(function(){return f((function _(){U(this,_),this.parser=new tu(this.geometryFactory)}),[{key:"write",value:function(_){return this.parser.write(_)}}])})()}}))})(Eg)),Eg.exports}var t0=e0();const n0=Dy(t0);function rf(){return new Ag}function Ag(){this.reset()}Ag.prototype={constructor:Ag,reset:function(){this.s=this.t=0},add:function(R){sy(yg,R,this.t),sy(this,yg.s,this.s),this.s?this.t+=yg.t:this.s=yg.t},valueOf:function(){return this.s}};var yg=new Ag;function sy(R,B,Y){var F=R.s=B+Y,U=F-B,ee=F-U;R.t=B-ee+(Y-U)}var pr=1e-6,Ii=Math.PI,dc=Ii/2,oy=Ii/4,pc=Ii*2,nf=180/Ii,Gl=Ii/180,is=Math.abs,i0=Math.atan,np=Math.atan2,Gr=Math.cos,qr=Math.sin,op=Math.sqrt;function Vy(R){return R>1?0:R<-1?Ii:Math.acos(R)}function rd(R){return R>1?dc:R<-1?-dc:Math.asin(R)}function mm(){}function kg(R,B){R&&uy.hasOwnProperty(R.type)&&uy[R.type](R,B)}var ly={Feature:function(R,B){kg(R.geometry,B)},FeatureCollection:function(R,B){for(var Y=R.features,F=-1,U=Y.length;++F<U;)kg(Y[F].geometry,B)}},uy={Sphere:function(R,B){B.sphere()},Point:function(R,B){R=R.coordinates,B.point(R[0],R[1],R[2])},MultiPoint:function(R,B){for(var Y=R.coordinates,F=-1,U=Y.length;++F<U;)R=Y[F],B.point(R[0],R[1],R[2])},LineString:function(R,B){w_(R.coordinates,B,0)},MultiLineString:function(R,B){for(var Y=R.coordinates,F=-1,U=Y.length;++F<U;)w_(Y[F],B,0)},Polygon:function(R,B){cy(R.coordinates,B)},MultiPolygon:function(R,B){for(var Y=R.coordinates,F=-1,U=Y.length;++F<U;)cy(Y[F],B)},GeometryCollection:function(R,B){for(var Y=R.geometries,F=-1,U=Y.length;++F<U;)kg(Y[F],B)}};function w_(R,B,Y){var F=-1,U=R.length-Y,ee;for(B.lineStart();++F<U;)ee=R[F],B.point(ee[0],ee[1],ee[2]);B.lineEnd()}function cy(R,B){var Y=-1,F=R.length;for(B.polygonStart();++Y<F;)w_(R[Y],B,1);B.polygonEnd()}function r0(R,B){R&&ly.hasOwnProperty(R.type)?ly[R.type](R,B):kg(R,B)}rf();rf();function T_(R){return[np(R[1],R[0]),rd(R[2])]}function ip(R){var B=R[0],Y=R[1],F=Gr(Y);return[F*Gr(B),F*qr(B),qr(Y)]}function vg(R,B){return R[0]*B[0]+R[1]*B[1]+R[2]*B[2]}function Dg(R,B){return[R[1]*B[2]-R[2]*B[1],R[2]*B[0]-R[0]*B[2],R[0]*B[1]-R[1]*B[0]]}function v_(R,B){R[0]+=B[0],R[1]+=B[1],R[2]+=B[2]}function xg(R,B){return[R[0]*B,R[1]*B,R[2]*B]}function S_(R){var B=op(R[0]*R[0]+R[1]*R[1]+R[2]*R[2]);R[0]/=B,R[1]/=B,R[2]/=B}rf();function Uy(R,B){function Y(F,U){return F=R(F,U),B(F[0],F[1])}return R.invert&&B.invert&&(Y.invert=function(F,U){return F=B.invert(F,U),F&&R.invert(F[0],F[1])}),Y}function E_(R,B){return[R>Ii?R-pc:R<-Ii?R+pc:R,B]}E_.invert=E_;function a0(R,B,Y){return(R%=pc)?B||Y?Uy(fy(R),dy(B,Y)):fy(R):B||Y?dy(B,Y):E_}function hy(R){return function(B,Y){return B+=R,[B>Ii?B-pc:B<-Ii?B+pc:B,Y]}}function fy(R){var B=hy(R);return B.invert=hy(-R),B}function dy(R,B){var Y=Gr(R),F=qr(R),U=Gr(B),ee=qr(B);function L(f,ue){var ge=Gr(ue),Te=Gr(f)*ge,ce=qr(f)*ge,Pe=qr(ue),Oe=Pe*Y+Te*F;return[np(ce*U-Oe*ee,Te*Y-Pe*F),rd(Oe*U+ce*ee)]}return L.invert=function(f,ue){var ge=Gr(ue),Te=Gr(f)*ge,ce=qr(f)*ge,Pe=qr(ue),Oe=Pe*U-ce*ee;return[np(ce*U+Pe*ee,Te*Y+Oe*F),rd(Oe*Y-Te*F)]},L}function s0(R,B,Y,F,U,ee){if(Y){var L=Gr(B),f=qr(B),ue=F*Y;U==null?(U=B+F*pc,ee=B-ue/2):(U=py(L,U),ee=py(L,ee),(F>0?U<ee:U>ee)&&(U+=F*pc));for(var ge,Te=U;F>0?Te>ee:Te<ee;Te-=ue)ge=T_([L,-f*Gr(Te),-f*qr(Te)]),R.point(ge[0],ge[1])}}function py(R,B){B=ip(B),B[0]-=R,S_(B);var Y=Vy(-B[1]);return((-B[2]<0?-Y:Y)+pc-pr)%pc}function jy(){var R=[],B;return{point:function(Y,F){B.push([Y,F])},lineStart:function(){R.push(B=[])},lineEnd:mm,rejoin:function(){R.length>1&&R.push(R.pop().concat(R.shift()))},result:function(){var Y=R;return R=[],B=null,Y}}}function o0(R,B,Y,F,U,ee){var L=R[0],f=R[1],ue=B[0],ge=B[1],Te=0,ce=1,Pe=ue-L,Oe=ge-f,Fe;if(Fe=Y-L,!(!Pe&&Fe>0)){if(Fe/=Pe,Pe<0){if(Fe<Te)return;Fe<ce&&(ce=Fe)}else if(Pe>0){if(Fe>ce)return;Fe>Te&&(Te=Fe)}if(Fe=U-L,!(!Pe&&Fe<0)){if(Fe/=Pe,Pe<0){if(Fe>ce)return;Fe>Te&&(Te=Fe)}else if(Pe>0){if(Fe<Te)return;Fe<ce&&(ce=Fe)}if(Fe=F-f,!(!Oe&&Fe>0)){if(Fe/=Oe,Oe<0){if(Fe<Te)return;Fe<ce&&(ce=Fe)}else if(Oe>0){if(Fe>ce)return;Fe>Te&&(Te=Fe)}if(Fe=ee-f,!(!Oe&&Fe<0)){if(Fe/=Oe,Oe<0){if(Fe>ce)return;Fe>Te&&(Te=Fe)}else if(Oe>0){if(Fe<Te)return;Fe<ce&&(ce=Fe)}return Te>0&&(R[0]=L+Te*Pe,R[1]=f+Te*Oe),ce<1&&(B[0]=L+ce*Pe,B[1]=f+ce*Oe),!0}}}}}function Mg(R,B){return is(R[0]-B[0])<pr&&is(R[1]-B[1])<pr}function bg(R,B,Y,F){this.x=R,this.z=B,this.o=Y,this.e=F,this.v=!1,this.n=this.p=null}function Gy(R,B,Y,F,U){var ee=[],L=[],f,ue;if(R.forEach(function(Fe){if(!((at=Fe.length-1)<=0)){var at,Ie=Fe[0],Et=Fe[at],vt;if(Mg(Ie,Et)){for(U.lineStart(),f=0;f<at;++f)U.point((Ie=Fe[f])[0],Ie[1]);U.lineEnd();return}ee.push(vt=new bg(Ie,Fe,null,!0)),L.push(vt.o=new bg(Ie,null,vt,!1)),ee.push(vt=new bg(Et,Fe,null,!1)),L.push(vt.o=new bg(Et,null,vt,!0))}}),!!ee.length){for(L.sort(B),my(ee),my(L),f=0,ue=L.length;f<ue;++f)L[f].e=Y=!Y;for(var ge=ee[0],Te,ce;;){for(var Pe=ge,Oe=!0;Pe.v;)if((Pe=Pe.n)===ge)return;Te=Pe.z,U.lineStart();do{if(Pe.v=Pe.o.v=!0,Pe.e){if(Oe)for(f=0,ue=Te.length;f<ue;++f)U.point((ce=Te[f])[0],ce[1]);else F(Pe.x,Pe.n.x,1,U);Pe=Pe.n}else{if(Oe)for(Te=Pe.p.z,f=Te.length-1;f>=0;--f)U.point((ce=Te[f])[0],ce[1]);else F(Pe.x,Pe.p.x,-1,U);Pe=Pe.p}Pe=Pe.o,Te=Pe.z,Oe=!Oe}while(!Pe.v);U.lineEnd()}}}function my(R){if(B=R.length){for(var B,Y=0,F=R[0],U;++Y<B;)F.n=U=R[Y],U.p=F,F=U;F.n=U=R[0],U.p=F}}function qy(R,B){return R<B?-1:R>B?1:R>=B?0:NaN}function l0(R){return R.length===1&&(R=u0(R)),{left:function(B,Y,F,U){for(F==null&&(F=0),U==null&&(U=B.length);F<U;){var ee=F+U>>>1;R(B[ee],Y)<0?F=ee+1:U=ee}return F},right:function(B,Y,F,U){for(F==null&&(F=0),U==null&&(U=B.length);F<U;){var ee=F+U>>>1;R(B[ee],Y)>0?U=ee:F=ee+1}return F}}}function u0(R){return function(B,Y){return qy(R(B),Y)}}l0(qy);function Zy(R){for(var B=R.length,Y,F=-1,U=0,ee,L;++F<B;)U+=R[F].length;for(ee=new Array(U);--B>=0;)for(L=R[B],Y=L.length;--Y>=0;)ee[--U]=L[Y];return ee}var gm=1e9,wg=-gm;function c0(R,B,Y,F){function U(ge,Te){return R<=ge&&ge<=Y&&B<=Te&&Te<=F}function ee(ge,Te,ce,Pe){var Oe=0,Fe=0;if(ge==null||(Oe=L(ge,ce))!==(Fe=L(Te,ce))||ue(ge,Te)<0^ce>0)do Pe.point(Oe===0||Oe===3?R:Y,Oe>1?F:B);while((Oe=(Oe+ce+4)%4)!==Fe);else Pe.point(Te[0],Te[1])}function L(ge,Te){return is(ge[0]-R)<pr?Te>0?0:3:is(ge[0]-Y)<pr?Te>0?2:1:is(ge[1]-B)<pr?Te>0?1:0:Te>0?3:2}function f(ge,Te){return ue(ge.x,Te.x)}function ue(ge,Te){var ce=L(ge,1),Pe=L(Te,1);return ce!==Pe?ce-Pe:ce===0?Te[1]-ge[1]:ce===1?ge[0]-Te[0]:ce===2?ge[1]-Te[1]:Te[0]-ge[0]}return function(ge){var Te=ge,ce=jy(),Pe,Oe,Fe,at,Ie,Et,vt,rt,At,Mt,Lt,_t={point:Gt,lineStart:sn,lineEnd:En,polygonStart:xn,polygonEnd:dn};function Gt(fn,Je){U(fn,Je)&&Te.point(fn,Je)}function Ft(){for(var fn=0,Je=0,Tt=Oe.length;Je<Tt;++Je)for(var $t=Oe[Je],Ht=1,Pt=$t.length,Re=$t[0],lt,zt,Ct=Re[0],en=Re[1];Ht<Pt;++Ht)lt=Ct,zt=en,Re=$t[Ht],Ct=Re[0],en=Re[1],zt<=F?en>F&&(Ct-lt)*(F-zt)>(en-zt)*(R-lt)&&++fn:en<=F&&(Ct-lt)*(F-zt)<(en-zt)*(R-lt)&&--fn;return fn}function xn(){Te=ce,Pe=[],Oe=[],Lt=!0}function dn(){var fn=Ft(),Je=Lt&&fn,Tt=(Pe=Zy(Pe)).length;(Je||Tt)&&(ge.polygonStart(),Je&&(ge.lineStart(),ee(null,null,1,ge),ge.lineEnd()),Tt&&Gy(Pe,f,fn,ee,ge),ge.polygonEnd()),Te=ge,Pe=Oe=Fe=null}function sn(){_t.point=Rt,Oe&&Oe.push(Fe=[]),Mt=!0,At=!1,vt=rt=NaN}function En(){Pe&&(Rt(at,Ie),Et&&At&&ce.rejoin(),Pe.push(ce.result())),_t.point=Gt,At&&Te.lineEnd()}function Rt(fn,Je){var Tt=U(fn,Je);if(Oe&&Fe.push([fn,Je]),Mt)at=fn,Ie=Je,Et=Tt,Mt=!1,Tt&&(Te.lineStart(),Te.point(fn,Je));else if(Tt&&At)Te.point(fn,Je);else{var $t=[vt=Math.max(wg,Math.min(gm,vt)),rt=Math.max(wg,Math.min(gm,rt))],Ht=[fn=Math.max(wg,Math.min(gm,fn)),Je=Math.max(wg,Math.min(gm,Je))];o0($t,Ht,R,B,Y,F)?(At||(Te.lineStart(),Te.point($t[0],$t[1])),Te.point(Ht[0],Ht[1]),Tt||Te.lineEnd(),Lt=!1):Tt&&(Te.lineStart(),Te.point(fn,Je),Lt=!1)}vt=fn,rt=Je,At=Tt}return _t}}var x_=rf();function h0(R,B){var Y=B[0],F=B[1],U=[qr(Y),-Gr(Y),0],ee=0,L=0;x_.reset();for(var f=0,ue=R.length;f<ue;++f)if(Te=(ge=R[f]).length)for(var ge,Te,ce=ge[Te-1],Pe=ce[0],Oe=ce[1]/2+oy,Fe=qr(Oe),at=Gr(Oe),Ie=0;Ie<Te;++Ie,Pe=vt,Fe=At,at=Mt,ce=Et){var Et=ge[Ie],vt=Et[0],rt=Et[1]/2+oy,At=qr(rt),Mt=Gr(rt),Lt=vt-Pe,_t=Lt>=0?1:-1,Gt=_t*Lt,Ft=Gt>Ii,xn=Fe*At;if(x_.add(np(xn*_t*qr(Gt),at*Mt+xn*Gr(Gt))),ee+=Ft?Lt+_t*pc:Lt,Ft^Pe>=Y^vt>=Y){var dn=Dg(ip(ce),ip(Et));S_(dn);var sn=Dg(U,dn);S_(sn);var En=(Ft^Lt>=0?-1:1)*rd(sn[2]);(F>En||F===En&&(dn[0]||dn[1]))&&(L+=Ft^Lt>=0?1:-1)}}return(ee<-pr||ee<pr&&x_<-pr)^L&1}rf();function gy(R){return R}rf();rf();var rp=1/0,Pg=rp,vm=-rp,Rg=vm,_y={point:f0,lineStart:mm,lineEnd:mm,polygonStart:mm,polygonEnd:mm,result:function(){var R=[[rp,Pg],[vm,Rg]];return vm=Rg=-(Pg=rp=1/0),R}};function f0(R,B){R<rp&&(rp=R),R>vm&&(vm=R),B<Pg&&(Pg=B),B>Rg&&(Rg=B)}rf();function Yy(R,B,Y,F){return function(U,ee){var L=B(ee),f=U.invert(F[0],F[1]),ue=jy(),ge=B(ue),Te=!1,ce,Pe,Oe,Fe={point:at,lineStart:Et,lineEnd:vt,polygonStart:function(){Fe.point=rt,Fe.lineStart=At,Fe.lineEnd=Mt,Pe=[],ce=[]},polygonEnd:function(){Fe.point=at,Fe.lineStart=Et,Fe.lineEnd=vt,Pe=Zy(Pe);var Lt=h0(ce,f);Pe.length?(Te||(ee.polygonStart(),Te=!0),Gy(Pe,p0,Lt,Y,ee)):Lt&&(Te||(ee.polygonStart(),Te=!0),ee.lineStart(),Y(null,null,1,ee),ee.lineEnd()),Te&&(ee.polygonEnd(),Te=!1),Pe=ce=null},sphere:function(){ee.polygonStart(),ee.lineStart(),Y(null,null,1,ee),ee.lineEnd(),ee.polygonEnd()}};function at(Lt,_t){var Gt=U(Lt,_t);R(Lt=Gt[0],_t=Gt[1])&&ee.point(Lt,_t)}function Ie(Lt,_t){var Gt=U(Lt,_t);L.point(Gt[0],Gt[1])}function Et(){Fe.point=Ie,L.lineStart()}function vt(){Fe.point=at,L.lineEnd()}function rt(Lt,_t){Oe.push([Lt,_t]);var Gt=U(Lt,_t);ge.point(Gt[0],Gt[1])}function At(){ge.lineStart(),Oe=[]}function Mt(){rt(Oe[0][0],Oe[0][1]),ge.lineEnd();var Lt=ge.clean(),_t=ue.result(),Gt,Ft=_t.length,xn,dn,sn;if(Oe.pop(),ce.push(Oe),Oe=null,!!Ft){if(Lt&1){if(dn=_t[0],(xn=dn.length-1)>0){for(Te||(ee.polygonStart(),Te=!0),ee.lineStart(),Gt=0;Gt<xn;++Gt)ee.point((sn=dn[Gt])[0],sn[1]);ee.lineEnd()}return}Ft>1&&Lt&2&&_t.push(_t.pop().concat(_t.shift())),Pe.push(_t.filter(d0))}}return Fe}}function d0(R){return R.length>1}function p0(R,B){return((R=R.x)[0]<0?R[1]-dc-pr:dc-R[1])-((B=B.x)[0]<0?B[1]-dc-pr:dc-B[1])}const yy=Yy(function(){return!0},m0,_0,[-Ii,-dc]);function m0(R){var B=NaN,Y=NaN,F=NaN,U;return{lineStart:function(){R.lineStart(),U=1},point:function(ee,L){var f=ee>0?Ii:-Ii,ue=is(ee-B);is(ue-Ii)<pr?(R.point(B,Y=(Y+L)/2>0?dc:-dc),R.point(F,Y),R.lineEnd(),R.lineStart(),R.point(f,Y),R.point(ee,Y),U=0):F!==f&&ue>=Ii&&(is(B-F)<pr&&(B-=F*pr),is(ee-f)<pr&&(ee-=f*pr),Y=g0(B,Y,ee,L),R.point(F,Y),R.lineEnd(),R.lineStart(),R.point(f,Y),U=0),R.point(B=ee,Y=L),F=f},lineEnd:function(){R.lineEnd(),B=Y=NaN},clean:function(){return 2-U}}}function g0(R,B,Y,F){var U,ee,L=qr(R-Y);return is(L)>pr?i0((qr(B)*(ee=Gr(F))*qr(Y)-qr(F)*(U=Gr(B))*qr(R))/(U*ee*L)):(B+F)/2}function _0(R,B,Y,F){var U;if(R==null)U=Y*dc,F.point(-Ii,U),F.point(0,U),F.point(Ii,U),F.point(Ii,0),F.point(Ii,-U),F.point(0,-U),F.point(-Ii,-U),F.point(-Ii,0),F.point(-Ii,U);else if(is(R[0]-B[0])>pr){var ee=R[0]<B[0]?Ii:-Ii;U=Y*ee/2,F.point(-ee,U),F.point(0,U),F.point(ee,U)}else F.point(B[0],B[1])}function y0(R,B){var Y=Gr(R),F=Y>0,U=is(Y)>pr;function ee(Te,ce,Pe,Oe){s0(Oe,R,B,Pe,Te,ce)}function L(Te,ce){return Gr(Te)*Gr(ce)>Y}function f(Te){var ce,Pe,Oe,Fe,at;return{lineStart:function(){Fe=Oe=!1,at=1},point:function(Ie,Et){var vt=[Ie,Et],rt,At=L(Ie,Et),Mt=F?At?0:ge(Ie,Et):At?ge(Ie+(Ie<0?Ii:-Ii),Et):0;if(!ce&&(Fe=Oe=At)&&Te.lineStart(),At!==Oe&&(rt=ue(ce,vt),(!rt||Mg(ce,rt)||Mg(vt,rt))&&(vt[0]+=pr,vt[1]+=pr,At=L(vt[0],vt[1]))),At!==Oe)at=0,At?(Te.lineStart(),rt=ue(vt,ce),Te.point(rt[0],rt[1])):(rt=ue(ce,vt),Te.point(rt[0],rt[1]),Te.lineEnd()),ce=rt;else if(U&&ce&&F^At){var Lt;!(Mt&Pe)&&(Lt=ue(vt,ce,!0))&&(at=0,F?(Te.lineStart(),Te.point(Lt[0][0],Lt[0][1]),Te.point(Lt[1][0],Lt[1][1]),Te.lineEnd()):(Te.point(Lt[1][0],Lt[1][1]),Te.lineEnd(),Te.lineStart(),Te.point(Lt[0][0],Lt[0][1])))}At&&(!ce||!Mg(ce,vt))&&Te.point(vt[0],vt[1]),ce=vt,Oe=At,Pe=Mt},lineEnd:function(){Oe&&Te.lineEnd(),ce=null},clean:function(){return at|(Fe&&Oe)<<1}}}function ue(Te,ce,Pe){var Oe=ip(Te),Fe=ip(ce),at=[1,0,0],Ie=Dg(Oe,Fe),Et=vg(Ie,Ie),vt=Ie[0],rt=Et-vt*vt;if(!rt)return!Pe&&Te;var At=Y*Et/rt,Mt=-Y*vt/rt,Lt=Dg(at,Ie),_t=xg(at,At),Gt=xg(Ie,Mt);v_(_t,Gt);var Ft=Lt,xn=vg(_t,Ft),dn=vg(Ft,Ft),sn=xn*xn-dn*(vg(_t,_t)-1);if(!(sn<0)){var En=op(sn),Rt=xg(Ft,(-xn-En)/dn);if(v_(Rt,_t),Rt=T_(Rt),!Pe)return Rt;var fn=Te[0],Je=ce[0],Tt=Te[1],$t=ce[1],Ht;Je<fn&&(Ht=fn,fn=Je,Je=Ht);var Pt=Je-fn,Re=is(Pt-Ii)<pr,lt=Re||Pt<pr;if(!Re&&$t<Tt&&(Ht=Tt,Tt=$t,$t=Ht),lt?Re?Tt+$t>0^Rt[1]<(is(Rt[0]-fn)<pr?Tt:$t):Tt<=Rt[1]&&Rt[1]<=$t:Pt>Ii^(fn<=Rt[0]&&Rt[0]<=Je)){var zt=xg(Ft,(-xn+En)/dn);return v_(zt,_t),[Rt,T_(zt)]}}}function ge(Te,ce){var Pe=F?R:Ii-R,Oe=0;return Te<-Pe?Oe|=1:Te>Pe&&(Oe|=2),ce<-Pe?Oe|=4:ce>Pe&&(Oe|=8),Oe}return Yy(L,f,ee,F?[0,-R]:[-Ii,R-Ii])}function Hy(R){return function(B){var Y=new M_;for(var F in R)Y[F]=R[F];return Y.stream=B,Y}}function M_(){}M_.prototype={constructor:M_,point:function(R,B){this.stream.point(R,B)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Xy(R,B,Y){var F=B[1][0]-B[0][0],U=B[1][1]-B[0][1],ee=R.clipExtent&&R.clipExtent();R.scale(150).translate([0,0]),ee!=null&&R.clipExtent(null),r0(Y,R.stream(_y));var L=_y.result(),f=Math.min(F/(L[1][0]-L[0][0]),U/(L[1][1]-L[0][1])),ue=+B[0][0]+(F-f*(L[1][0]+L[0][0]))/2,ge=+B[0][1]+(U-f*(L[1][1]+L[0][1]))/2;return ee!=null&&R.clipExtent(ee),R.scale(f*150).translate([ue,ge])}function v0(R,B,Y){return Xy(R,[[0,0],B],Y)}var vy=16,x0=Gr(30*Gl);function xy(R,B){return+B?w0(R,B):b0(R)}function b0(R){return Hy({point:function(B,Y){B=R(B,Y),this.stream.point(B[0],B[1])}})}function w0(R,B){function Y(F,U,ee,L,f,ue,ge,Te,ce,Pe,Oe,Fe,at,Ie){var Et=ge-F,vt=Te-U,rt=Et*Et+vt*vt;if(rt>4*B&&at--){var At=L+Pe,Mt=f+Oe,Lt=ue+Fe,_t=op(At*At+Mt*Mt+Lt*Lt),Gt=rd(Lt/=_t),Ft=is(is(Lt)-1)<pr||is(ee-ce)<pr?(ee+ce)/2:np(Mt,At),xn=R(Ft,Gt),dn=xn[0],sn=xn[1],En=dn-F,Rt=sn-U,fn=vt*En-Et*Rt;(fn*fn/rt>B||is((Et*En+vt*Rt)/rt-.5)>.3||L*Pe+f*Oe+ue*Fe<x0)&&(Y(F,U,ee,L,f,ue,dn,sn,Ft,At/=_t,Mt/=_t,Lt,at,Ie),Ie.point(dn,sn),Y(dn,sn,Ft,At,Mt,Lt,ge,Te,ce,Pe,Oe,Fe,at,Ie))}}return function(F){var U,ee,L,f,ue,ge,Te,ce,Pe,Oe,Fe,at,Ie={point:Et,lineStart:vt,lineEnd:At,polygonStart:function(){F.polygonStart(),Ie.lineStart=Mt},polygonEnd:function(){F.polygonEnd(),Ie.lineStart=vt}};function Et(Gt,Ft){Gt=R(Gt,Ft),F.point(Gt[0],Gt[1])}function vt(){ce=NaN,Ie.point=rt,F.lineStart()}function rt(Gt,Ft){var xn=ip([Gt,Ft]),dn=R(Gt,Ft);Y(ce,Pe,Te,Oe,Fe,at,ce=dn[0],Pe=dn[1],Te=Gt,Oe=xn[0],Fe=xn[1],at=xn[2],vy,F),F.point(ce,Pe)}function At(){Ie.point=Et,F.lineEnd()}function Mt(){vt(),Ie.point=Lt,Ie.lineEnd=_t}function Lt(Gt,Ft){rt(U=Gt,Ft),ee=ce,L=Pe,f=Oe,ue=Fe,ge=at,Ie.point=rt}function _t(){Y(ce,Pe,Te,Oe,Fe,at,ee,L,U,f,ue,ge,vy,F),Ie.lineEnd=At,At()}return Ie}}var T0=Hy({point:function(R,B){this.stream.point(R*Gl,B*Gl)}});function S0(R){return E0(function(){return R})()}function E0(R){var B,Y=150,F=480,U=250,ee,L,f=0,ue=0,ge=0,Te=0,ce=0,Pe,Oe,Fe=null,at=yy,Ie=null,Et,vt,rt,At=gy,Mt=.5,Lt=xy(dn,Mt),_t,Gt;function Ft(Rt){return Rt=Oe(Rt[0]*Gl,Rt[1]*Gl),[Rt[0]*Y+ee,L-Rt[1]*Y]}function xn(Rt){return Rt=Oe.invert((Rt[0]-ee)/Y,(L-Rt[1])/Y),Rt&&[Rt[0]*nf,Rt[1]*nf]}function dn(Rt,fn){return Rt=B(Rt,fn),[Rt[0]*Y+ee,L-Rt[1]*Y]}Ft.stream=function(Rt){return _t&&Gt===Rt?_t:_t=T0(at(Pe,Lt(At(Gt=Rt))))},Ft.clipAngle=function(Rt){return arguments.length?(at=+Rt?y0(Fe=Rt*Gl,6*Gl):(Fe=null,yy),En()):Fe*nf},Ft.clipExtent=function(Rt){return arguments.length?(At=Rt==null?(Ie=Et=vt=rt=null,gy):c0(Ie=+Rt[0][0],Et=+Rt[0][1],vt=+Rt[1][0],rt=+Rt[1][1]),En()):Ie==null?null:[[Ie,Et],[vt,rt]]},Ft.scale=function(Rt){return arguments.length?(Y=+Rt,sn()):Y},Ft.translate=function(Rt){return arguments.length?(F=+Rt[0],U=+Rt[1],sn()):[F,U]},Ft.center=function(Rt){return arguments.length?(f=Rt[0]%360*Gl,ue=Rt[1]%360*Gl,sn()):[f*nf,ue*nf]},Ft.rotate=function(Rt){return arguments.length?(ge=Rt[0]%360*Gl,Te=Rt[1]%360*Gl,ce=Rt.length>2?Rt[2]%360*Gl:0,sn()):[ge*nf,Te*nf,ce*nf]},Ft.precision=function(Rt){return arguments.length?(Lt=xy(dn,Mt=Rt*Rt),En()):op(Mt)},Ft.fitExtent=function(Rt,fn){return Xy(Ft,Rt,fn)},Ft.fitSize=function(Rt,fn){return v0(Ft,Rt,fn)};function sn(){Oe=Uy(Pe=a0(ge,Te,ce),B);var Rt=B(f,ue);return ee=F-Rt[0]*Y,L=U+Rt[1]*Y,En()}function En(){return _t=Gt=null,Ft}return function(){return B=R.apply(this,arguments),Ft.invert=B.invert&&xn,sn()}}function $y(R){return function(B,Y){var F=Gr(B),U=Gr(Y),ee=R(F*U);return[ee*U*qr(B),ee*qr(Y)]}}function Wy(R){return function(B,Y){var F=op(B*B+Y*Y),U=R(F),ee=qr(U),L=Gr(U);return[np(B*ee,F*L),rd(F&&Y*ee/F)]}}var M0=$y(function(R){return op(2/(1+R))});M0.invert=Wy(function(R){return 2*rd(R/2)});var Qy=$y(function(R){return(R=Vy(R))&&R/qr(R)});Qy.invert=Wy(function(R){return R});function C0(){return S0(Qy).scale(79.4188).clipAngle(180-.001)}function by(R,B){return[R,B]}by.invert=by;var{BufferOp:I0,GeoJSONReader:A0,GeoJSONWriter:k0}=n0;function D0(R,B,Y){Y=Y||{};var F=Y.units||"kilometers",U=Y.steps||8;if(!R)throw new Error("geojson is required");if(typeof Y!="object")throw new Error("options must be an object");if(typeof U!="number")throw new Error("steps must be an number");if(B===void 0)throw new Error("radius is required");if(U<=0)throw new Error("steps must be greater than 0");var ee=[];switch(R.type){case"GeometryCollection":return I_(R,function(L){var f=Cg(L,B,F,U);f&&ee.push(f)}),Ig(ee);case"FeatureCollection":return K_(R,function(L){var f=Cg(L,B,F,U);f&&K_(f,function(ue){ue&&ee.push(ue)})}),Ig(ee)}return Cg(R,B,F,U)}function Cg(R,B,Y,F){var U=R.properties||{},ee=R.type==="Feature"?R.geometry:R;if(ee.type==="GeometryCollection"){var L=[];return I_(R,function(at){var Ie=Cg(at,B,Y,F);Ie&&L.push(Ie)}),Ig(L)}var f=P0(ee),ue={type:ee.type,coordinates:Jy(ee.coordinates,f)},ge=new A0,Te=ge.read(ue),ce=Oy(Ny(B,Y),"meters"),Pe=I0.bufferOp(Te,ce,F),Oe=new k0;if(Pe=Oe.write(Pe),!Ky(Pe.coordinates)){var Fe={type:Pe.type,coordinates:ev(Pe.coordinates,f)};return sp(Fe,U)}}function Ky(R){return Array.isArray(R[0])?Ky(R[0]):isNaN(R[0])}function Jy(R,B){return typeof R[0]!="object"?B(R):R.map(function(Y){return Jy(Y,B)})}function ev(R,B){return typeof R[0]!="object"?B.invert(R):R.map(function(Y){return ev(Y,B)})}function P0(R){var B=Kv(R).geometry.coordinates,Y=[-B[0],-B[1]];return C0().rotate(Y).scale(Fs)}function R0(R,B,Y={}){const F=Y.steps||64,U=Y.properties?Y.properties:!Array.isArray(R)&&R.type==="Feature"&&R.properties?R.properties:{},ee=[];for(let L=0;L<F;L++)ee.push(Rv(R,B,L*-360/F,Y).geometry.coordinates);return ee.push(ee[0]),tp([ee],U)}const ku={uniqueId:"distanceLab",meta:{title:"",description:"2",initialViewState:{longitude:0,latitude:0,zoom:4}},state:{clickedCoordsPrevious:null,clickedCoordsCurrent:null},compute:R=>{const{clickedCoordsPrevious:B,clickedCoordsCurrent:Y}=R;if(B&&Y){const F=_m.MercatorCoordinate.fromLngLat({lng:B[0],lat:B[1]}),U=_m.MercatorCoordinate.fromLngLat({lng:Y[0],lat:Y[1]}),ee=new _m.MercatorCoordinate((U.x+F.x)/2,(U.y+F.y)/2),L=U.x-F.x,f=U.y-F.y,ue=Math.sqrt(L*L+f*f),ge=ee.meterInMercatorCoordinateUnits(),Te=ue/ge/1e3,ce=Lv(id(B),id(Y),{units:"kilometers"});return[{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[B,Y]},properties:{distanceByMercator:Te,distanceByTurf:ce}}]}]}else return null},Panel:(R,B)=>{const{clickedCoordsPrevious:Y,clickedCoordsCurrent:F}=R,U=B&&B.length>0?B[0]?.features[0]:null,ee=U?U.properties?.distanceByMercator:null,L=U?U.properties?.distanceByTurf:null;return Nt.jsxs("div",{children:[Nt.jsx("h2",{children:""}),Nt.jsx("p",{children:"2"}),Nt.jsxs("div",{children:[Nt.jsx("b",{children:":"})," ",Y?`[${Y[0].toFixed(6)}, ${Y[1].toFixed(6)}]`:""]}),Nt.jsxs("div",{children:[Nt.jsx("b",{children:":"})," ",F?`[${F[0].toFixed(6)}, ${F[1].toFixed(6)}]`:""]}),Nt.jsx("hr",{}),Nt.jsx("div",{children:F?Nt.jsxs("div",{children:[" (WGS84):",Nt.jsx("br",{}),"Longitude: ",F[0].toFixed(4),", Latitude:"," ",F[1].toFixed(4)]}):Nt.jsx("div",{children:""})}),Nt.jsx("hr",{}),Nt.jsxs("div",{children:[ee?Nt.jsxs("h3",{children:["2:",Nt.jsx("br",{}),ee.toFixed(4)," "]}):Nt.jsx("div",{children:"2"}),Nt.jsxs("p",{children:[Nt.jsx("b",{children:"Mercator "}),Nt.jsx("br",{}),""]})]}),Nt.jsx("hr",{}),Nt.jsxs("div",{children:[L?Nt.jsxs("h3",{children:["Turf.js 2:",Nt.jsx("br",{}),L.toFixed(4)," "]}):Nt.jsx("div",{children:"2"}),Nt.jsxs("p",{children:[Nt.jsx("b",{children:"turf.distance  Haversine formula "}),Nt.jsx("br",{})," ",Nt.jsx("br",{}),""]})]})]})}},Ul={uniqueId:"bufferCircleLab",meta:{title:" vs ",description:"",initialViewState:{longitude:0,latitude:0,zoom:4}},state:{clickedCoords:null,radiusKm:1e3,circleSteps:6},compute:R=>{const{clickedCoords:B,radiusKm:Y,circleSteps:F}=R;if(B){const U=id(B),ee=D0(U,Y,{steps:F,units:"kilometers"}),L=R0(B,Y,{steps:F,units:"kilometers"}),f=[];if(ee){const ue=J_(ee);ee.properties={description:"Buffer (Turf.js)",area:ue},f.push({type:"FeatureCollection",features:[ee]})}if(L){const ue=J_(L);L.properties={description:"Circle (Turf.js)",area:ue},f.push({type:"FeatureCollection",features:[L]})}return f}else return null},Panel:(R,B,Y)=>{const{clickedCoords:F,radiusKm:U,circleSteps:ee}=R,L=B&&Array.isArray(B)?B[0]?.features[0].properties?.area:null,f=B&&Array.isArray(B)?B[1]?.features[0].properties?.area:null;return Nt.jsxs("div",{children:[Nt.jsx("h2",{children:" vs "}),Nt.jsx("p",{children:"1"}),Nt.jsx("div",{children:Nt.jsxs("label",{children:[" (km):",Nt.jsx("input",{type:"number",value:U,onChange:ue=>{Y?.({...R,radiusKm:parseFloat(ue.target.value)})}})]})}),Nt.jsx("div",{children:Nt.jsxs("label",{children:[" (steps):",Nt.jsx("input",{type:"number",value:ee,onChange:ue=>{Y?.({...R,circleSteps:parseInt(ue.target.value,10)})}})]})}),Nt.jsxs("div",{children:[Nt.jsx("b",{children:":"})," ",F?`[${F[0].toFixed(6)}, ${F[1].toFixed(6)}]`:""]}),Nt.jsx("hr",{}),L&&f&&Nt.jsxs("div",{children:[Nt.jsx("h3",{children:""}),Nt.jsxs("div",{children:[Nt.jsxs("h3",{children:[":",Nt.jsx("br",{}),L.toFixed(2)," "]}),Nt.jsx("p",{children:"Turf.js  buffer  D3.js  geoAzimuthalEquidistant  Planar buffer"})]}),Nt.jsx("hr",{}),Nt.jsxs("div",{children:[Nt.jsxs("h3",{children:[":",Nt.jsx("br",{}),f.toFixed(2)," "]}),Nt.jsx("p",{children:"Turf.js  circle   buffer "})]}),Nt.jsx("hr",{}),Nt.jsx("div",{children:Nt.jsx("b",{children:" "})})]})]})}},Tg=(R,B)=>{const Y=$v(B);return Y.type==="FeatureCollection"?Y.features.some(F=>F.geometry.type==="LineString"?y_(R,F):!1):Y.geometry.type==="MultiLineString"?Y.geometry.coordinates.some(F=>{const U=zy(F);return y_(R,U)}):Y.geometry.type==="LineString"?y_(R,Y):!1},jl={uniqueId:"pointInPolygonLab",meta:{title:"",description:"",initialViewState:{longitude:0,latitude:0,zoom:4}},state:{clickedCoords:null,polygonType:"simple",ignoreBoundary:!1},compute:R=>{const{clickedCoords:B,polygonType:Y,ignoreBoundary:F}=R;if(B){let U,ee,L;const f=id(B);if(Y==="simple")U=tp([[[B[0]-1,B[1]-1],[B[0]+1,B[1]-1],[B[0]+1,B[1]+1],[B[0]-1,B[1]+1],[B[0]-1,B[1]-1]]]),ee=_g(f,U,{ignoreBoundary:F}),L=Tg(f,U);else if(Y==="concave")U=tp([[[B[0]-1,B[1]-1],[B[0]+.5,B[1]],[B[0]+1,B[1]-1],[B[0]+1,B[1]+1],[B[0]-1,B[1]+1],[B[0]-1,B[1]-1]]]),ee=_g(f,U,{ignoreBoundary:F}),L=Tg(f,U);else if(Y==="hole")U=tp([[[B[0]-1,B[1]-1],[B[0]+1,B[1]-1],[B[0]+1,B[1]+1],[B[0]-1,B[1]+1],[B[0]-1,B[1]-1]],[[B[0]-.5,B[1]-.5],[B[0]+.5,B[1]-.5],[B[0]+.5,B[1]+.5],[B[0]-.5,B[1]+.5],[B[0]-.5,B[1]-.5]]]),ee=_g(f,U,{ignoreBoundary:F}),L=Tg(f,U);else{U=Dv([[[[B[0]-2,B[1]-1],[B[0]-1,B[1]-1],[B[0]-1,B[1]+1],[B[0]-2,B[1]+1],[B[0]-2,B[1]-1]]],[[[B[0]+1,B[1]-1],[B[0]+2,B[1]-1],[B[0]+2,B[1]+1],[B[0]+1,B[1]+1],[B[0]+1,B[1]-1]]]]),ee=!1;for(const ue of U.geometry.coordinates){const ge=tp(ue);if(_g(f,ge,{ignoreBoundary:F})){ee=!0;break}}L=!1;for(const ue of U.geometry.coordinates){const ge=tp(ue);if(Tg(f,ge)){L=!0;break}}}return U.properties={isInside:ee,isOnLine:L||!1,classification:L?"boundary":ee?"inside":"outside",description:"Polygon for Point-In-Polygon Test"},[{type:"FeatureCollection",features:[U,f]}]}else return null},Panel:(R,B,Y)=>{const{clickedCoords:F,polygonType:U,ignoreBoundary:ee}=R,L=B&&Array.isArray(B)?B[0]?.features[0].properties?.isInside:null;return Nt.jsxs("div",{children:[Nt.jsx("h2",{children:""}),Nt.jsx("p",{children:"1"}),Nt.jsx("div",{children:Nt.jsxs("label",{children:[":",Nt.jsxs("select",{value:U,onChange:f=>Y?.({polygonType:f.target.value}),children:[Nt.jsx("option",{value:"simple",children:""}),Nt.jsx("option",{value:"concave",children:""}),Nt.jsx("option",{value:"hole",children:""}),Nt.jsx("option",{value:"multi",children:""})]})]})}),Nt.jsx("div",{children:Nt.jsxs("label",{children:[":",Nt.jsx("input",{type:"checkbox",checked:!ee,onChange:f=>Y?.({ignoreBoundary:!f.target.checked})})]})}),Nt.jsxs("div",{children:[":"," ",F?`[${F[0].toFixed(6)}, ${F[1].toFixed(6)}]`:""]}),L&&Nt.jsxs("div",{children:[": ",L?"":""]})]})}},L0=[ku,Ul,jl],z0=({selectedLabId:R,onLabSelect:B})=>Nt.jsx("div",{style:{width:"98vw",height:"4vh",borderBottom:"1px solid #ccc"},children:Nt.jsx("ul",{style:{listStyle:"none",display:"flex",gap:"10px",padding:0},children:L0.map(Y=>Nt.jsx("li",{style:{fontWeight:Y.uniqueId===R?"bold":"normal",textDecoration:"underline"},children:Nt.jsx("span",{onClick:()=>B&&B(Y.uniqueId),style:{cursor:"pointer"},children:Y.meta.title})},Y.uniqueId))})}),O0="modulepreload",N0=function(R){return"/study-gis-algo-vite/"+R},wy={},B0=function(B,Y,F){let U=Promise.resolve();if(Y&&Y.length>0){let ge=function(Te){return Promise.all(Te.map(ce=>Promise.resolve(ce).then(Pe=>({status:"fulfilled",value:Pe}),Pe=>({status:"rejected",reason:Pe}))))};var L=ge;document.getElementsByTagName("link");const f=document.querySelector("meta[property=csp-nonce]"),ue=f?.nonce||f?.getAttribute("nonce");U=ge(Y.map(Te=>{if(Te=N0(Te),Te in wy)return;wy[Te]=!0;const ce=Te.endsWith(".css"),Pe=ce?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Te}"]${Pe}`))return;const Oe=document.createElement("link");if(Oe.rel=ce?"stylesheet":O0,ce||(Oe.as="script"),Oe.crossOrigin="",Oe.href=Te,ue&&Oe.setAttribute("nonce",ue),document.head.appendChild(Oe),ce)return new Promise((Fe,at)=>{Oe.addEventListener("load",Fe),Oe.addEventListener("error",()=>at(new Error(`Unable to preload CSS for ${Te}`)))})}))}function ee(f){const ue=new Event("vite:preloadError",{cancelable:!0});if(ue.payload=f,window.dispatchEvent(ue),!ue.defaultPrevented)throw f}return U.then(f=>{for(const ue of f||[])ue.status==="rejected"&&ee(ue.reason);return B().catch(ee)})},F0=nn.createContext(null);function V0(R,B){const Y=Array.isArray(R)?R[0]:R?R.x:0,F=Array.isArray(R)?R[1]:R?R.y:0,U=Array.isArray(B)?B[0]:B?B.x:0,ee=Array.isArray(B)?B[1]:B?B.y:0;return Y===U&&F===ee}function No(R,B){if(R===B)return!0;if(!R||!B)return!1;if(Array.isArray(R)){if(!Array.isArray(B)||R.length!==B.length)return!1;for(let Y=0;Y<R.length;Y++)if(!No(R[Y],B[Y]))return!1;return!0}else if(Array.isArray(B))return!1;if(typeof R=="object"&&typeof B=="object"){const Y=Object.keys(R),F=Object.keys(B);if(Y.length!==F.length)return!1;for(const U of Y)if(!B.hasOwnProperty(U)||!No(R[U],B[U]))return!1;return!0}return!1}function Ty(R){return{longitude:R.center.lng,latitude:R.center.lat,zoom:R.zoom,pitch:R.pitch,bearing:R.bearing,padding:R.padding}}function Sy(R,B){const Y=B.viewState||B,F={};if("longitude"in Y&&"latitude"in Y&&(Y.longitude!==R.center.lng||Y.latitude!==R.center.lat)){const U=R.center.constructor;F.center=new U(Y.longitude,Y.latitude)}return"zoom"in Y&&Y.zoom!==R.zoom&&(F.zoom=Y.zoom),"bearing"in Y&&Y.bearing!==R.bearing&&(F.bearing=Y.bearing),"pitch"in Y&&Y.pitch!==R.pitch&&(F.pitch=Y.pitch),Y.padding&&R.padding&&!No(Y.padding,R.padding)&&(F.padding=Y.padding),F}const U0=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ey(R){if(!R)return null;if(typeof R=="string"||("toJS"in R&&(R=R.toJS()),!R.layers))return R;const B={};for(const F of R.layers)B[F.id]=F;const Y=R.layers.map(F=>{let U=null;"interactive"in F&&(U=Object.assign({},F),delete U.interactive);const ee=B[F.ref];if(ee){U=U||Object.assign({},F),delete U.ref;for(const L of U0)L in ee&&(U[L]=ee[L])}return U||F});return{...R,layers:Y}}const My={version:8,sources:{},layers:[]},Cy={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Iy={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Ay={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},j0=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],G0=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class ap{constructor(B,Y,F){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=U=>{const ee=this.props[Ay[U.type]];ee?ee(U):U.type==="error"&&console.error(U.error)},this._onCameraEvent=U=>{if(this._internalUpdate)return;U.viewState=this._propsedCameraUpdate||Ty(this._map.transform);const ee=this.props[Iy[U.type]];ee&&ee(U)},this._onCameraUpdate=U=>this._internalUpdate?U:(this._propsedCameraUpdate=Ty(U),Sy(U,this.props)),this._onPointerEvent=U=>{(U.type==="mousemove"||U.type==="mouseout")&&this._updateHover(U);const ee=this.props[Cy[U.type]];ee&&(this.props.interactiveLayerIds&&U.type!=="mouseover"&&U.type!=="mouseout"&&(U.features=this._hoveredFeatures||this._queryRenderedFeatures(U.point)),ee(U),delete U.features)},this._MapClass=B,this.props=Y,this._initialize(F)}get map(){return this._map}setProps(B){const Y=this.props;this.props=B;const F=this._updateSettings(B,Y),U=this._updateSize(B),ee=this._updateViewState(B);this._updateStyle(B,Y),this._updateStyleComponents(B),this._updateHandlers(B,Y),(F||U||ee&&!this._map.isMoving())&&this.redraw()}static reuse(B,Y){const F=ap.savedMaps.pop();if(!F)return null;const U=F.map,ee=U.getContainer();for(Y.className=ee.className;ee.childNodes.length>0;)Y.appendChild(ee.childNodes[0]);U._container=Y;const L=U._resizeObserver;L&&(L.disconnect(),L.observe(Y)),F.setProps({...B,styleDiffing:!1}),U.resize();const{initialViewState:f}=B;return f&&(f.bounds?U.fitBounds(f.bounds,{...f.fitBoundsOptions,duration:0}):F._updateViewState(f)),U.isStyleLoaded()?U.fire("load"):U.once("style.load",()=>U.fire("load")),U._update(),F}_initialize(B){const{props:Y}=this,{mapStyle:F=My}=Y,U={...Y,...Y.initialViewState,container:B,style:Ey(F)},ee=U.initialViewState||U.viewState||U;if(Object.assign(U,{center:[ee.longitude||0,ee.latitude||0],zoom:ee.zoom||0,pitch:ee.pitch||0,bearing:ee.bearing||0}),Y.gl){const f=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=f,Y.gl)}const L=new this._MapClass(U);ee.padding&&L.setPadding(ee.padding),Y.cursor&&(L.getCanvas().style.cursor=Y.cursor),L.transformCameraUpdate=this._onCameraUpdate,L.on("style.load",()=>{this._styleComponents={light:L.getLight(),sky:L.getSky(),projection:L.getProjection?.(),terrain:L.getTerrain()},this._updateStyleComponents(this.props)}),L.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const f in Cy)L.on(f,this._onPointerEvent);for(const f in Iy)L.on(f,this._onCameraEvent);for(const f in Ay)L.on(f,this._onEvent);this._map=L}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),ap.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const B=this._map;B.style&&(B._frame&&(B._frame.cancel(),B._frame=null),B._render())}_updateSize(B){const{viewState:Y}=B;if(Y){const F=this._map;if(Y.width!==F.transform.width||Y.height!==F.transform.height)return F.resize(),!0}return!1}_updateViewState(B){const Y=this._map,F=Y.transform;if(!Y.isMoving()){const ee=Sy(F,B);if(Object.keys(ee).length>0)return this._internalUpdate=!0,Y.jumpTo(ee),this._internalUpdate=!1,!0}return!1}_updateSettings(B,Y){const F=this._map;let U=!1;for(const ee of j0)ee in B&&!No(B[ee],Y[ee])&&(U=!0,F[`set${ee[0].toUpperCase()}${ee.slice(1)}`]?.call(F,B[ee]));return U}_updateStyle(B,Y){if(B.cursor!==Y.cursor&&(this._map.getCanvas().style.cursor=B.cursor||""),B.mapStyle!==Y.mapStyle){const{mapStyle:F=My,styleDiffing:U=!0}=B,ee={diff:U};"localIdeographFontFamily"in B&&(ee.localIdeographFontFamily=B.localIdeographFontFamily),this._map.setStyle(Ey(F),ee)}}_updateStyleComponents({light:B,projection:Y,sky:F,terrain:U}){const ee=this._map,L=this._styleComponents;ee.style._loaded&&(B&&!No(B,L.light)&&(L.light=B,ee.setLight(B)),Y&&!No(Y,L.projection)&&Y!==L.projection?.type&&(L.projection=typeof Y=="string"?{type:Y}:Y,ee.setProjection?.(L.projection)),F&&!No(F,L.sky)&&(L.sky=F,ee.setSky(F)),U!==void 0&&!No(U,L.terrain)&&(!U||ee.getSource(U.source))&&(L.terrain=U,ee.setTerrain(U)))}_updateHandlers(B,Y){const F=this._map;for(const U of G0){const ee=B[U]??!0,L=Y[U]??!0;No(ee,L)||(ee?F[U].enable(ee):F[U].disable())}}_queryRenderedFeatures(B){const Y=this._map,{interactiveLayerIds:F=[]}=this.props;try{return Y.queryRenderedFeatures(B,{layers:F.filter(Y.getLayer.bind(Y))})}catch{return[]}}_updateHover(B){const{props:Y}=this;if(Y.interactiveLayerIds&&(Y.onMouseMove||Y.onMouseEnter||Y.onMouseLeave)){const U=B.type,ee=this._hoveredFeatures?.length>0,L=this._queryRenderedFeatures(B.point),f=L.length>0;!f&&ee&&(B.type="mouseleave",this._onPointerEvent(B)),this._hoveredFeatures=L,f&&!ee&&(B.type="mouseenter",this._onPointerEvent(B)),B.type=U}else this._hoveredFeatures=null}}ap.savedMaps=[];const q0=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Z0(R){if(!R)return null;const B=R.map,Y={getMap:()=>B};for(const F of Y0(B))!(F in Y)&&!q0.includes(F)&&(Y[F]=B[F].bind(B));return Y}function Y0(R){const B=new Set;let Y=R;for(;Y;){for(const F of Object.getOwnPropertyNames(Y))F[0]!=="_"&&typeof R[F]=="function"&&F!=="fire"&&F!=="setEventedParent"&&B.add(F);Y=Object.getPrototypeOf(Y)}return Array.from(B)}const H0=typeof document<"u"?nn.useLayoutEffect:nn.useEffect;function X0(R,B){const{RTLTextPlugin:Y,maxParallelImageRequests:F,workerCount:U,workerUrl:ee}=B;if(Y&&R.getRTLTextPluginStatus&&R.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:L,lazy:f=!0}=typeof Y=="string"?{pluginUrl:Y}:Y;R.setRTLTextPlugin(L,ue=>{ue&&console.error(ue)},f)}F!==void 0&&R.setMaxParallelImageRequests(F),U!==void 0&&R.setWorkerCount(U),ee!==void 0&&R.setWorkerUrl(ee)}const lp=nn.createContext(null);function $0(R,B){const Y=nn.useContext(F0),[F,U]=nn.useState(null),ee=nn.useRef(),{current:L}=nn.useRef({mapLib:null,map:null});nn.useEffect(()=>{const ge=R.mapLib;let Te=!0,ce;return Promise.resolve(ge||B0(()=>Promise.resolve().then(()=>Av),void 0)).then(Pe=>{if(!Te)return;if(!Pe)throw new Error("Invalid mapLib");const Oe="Map"in Pe?Pe:Pe.default;if(!Oe.Map)throw new Error("Invalid mapLib");X0(Oe,R),R.reuseMaps&&(ce=ap.reuse(R,ee.current)),ce||(ce=new ap(Oe.Map,R,ee.current)),L.map=Z0(ce),L.mapLib=Oe,U(ce),Y?.onMapMount(L.map,R.id)}).catch(Pe=>{const{onError:Oe}=R;Oe?Oe({type:"error",target:null,originalEvent:null,error:Pe}):console.error(Pe)}),()=>{Te=!1,ce&&(Y?.onMapUnmount(R.id),R.reuseMaps?ce.recycle():ce.destroy())}},[]),H0(()=>{F&&F.setProps(R)}),nn.useImperativeHandle(B,()=>L.map,[F]);const f=nn.useMemo(()=>({position:"relative",width:"100%",height:"100%",...R.style}),[R.style]),ue={height:"100%"};return nn.createElement("div",{id:R.id,ref:ee,style:f},F&&nn.createElement(lp.Provider,{value:L},nn.createElement("div",{"mapboxgl-children":"",style:ue},R.children)))}const W0=nn.forwardRef($0);var tv=Py();const Q0=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function nh(R,B){if(!R||!B)return;const Y=R.style;for(const F in B){const U=B[F];Number.isFinite(U)&&!Q0.test(F)?Y[F]=`${U}px`:Y[F]=U}}function nv(R,B){if(R===B)return null;const Y=ky(R),F=ky(B),U=[];for(const ee of F)Y.has(ee)||U.push(ee);for(const ee of Y)F.has(ee)||U.push(ee);return U.length===0?null:U}function ky(R){return new Set(R?R.trim().split(/\s+/):[])}nn.memo(nn.forwardRef((R,B)=>{const{map:Y,mapLib:F}=nn.useContext(lp),U=nn.useRef({props:R}),ee=nn.useMemo(()=>{let Et=!1;nn.Children.forEach(R.children,At=>{At&&(Et=!0)});const vt={...R,element:Et?document.createElement("div"):void 0},rt=new F.Marker(vt);return rt.setLngLat([R.longitude,R.latitude]),rt.getElement().addEventListener("click",At=>{U.current.props.onClick?.({type:"click",target:rt,originalEvent:At})}),rt.on("dragstart",At=>{const Mt=At;Mt.lngLat=ee.getLngLat(),U.current.props.onDragStart?.(Mt)}),rt.on("drag",At=>{const Mt=At;Mt.lngLat=ee.getLngLat(),U.current.props.onDrag?.(Mt)}),rt.on("dragend",At=>{const Mt=At;Mt.lngLat=ee.getLngLat(),U.current.props.onDragEnd?.(Mt)}),rt},[]);nn.useEffect(()=>(ee.addTo(Y.getMap()),()=>{ee.remove()}),[]);const{longitude:L,latitude:f,offset:ue,style:ge,draggable:Te=!1,popup:ce=null,rotation:Pe=0,rotationAlignment:Oe="auto",pitchAlignment:Fe="auto"}=R;nn.useEffect(()=>{nh(ee.getElement(),ge)},[ge]),nn.useImperativeHandle(B,()=>ee,[]);const at=U.current.props;(ee.getLngLat().lng!==L||ee.getLngLat().lat!==f)&&ee.setLngLat([L,f]),ue&&!V0(ee.getOffset(),ue)&&ee.setOffset(ue),ee.isDraggable()!==Te&&ee.setDraggable(Te),ee.getRotation()!==Pe&&ee.setRotation(Pe),ee.getRotationAlignment()!==Oe&&ee.setRotationAlignment(Oe),ee.getPitchAlignment()!==Fe&&ee.setPitchAlignment(Fe),ee.getPopup()!==ce&&ee.setPopup(ce);const Ie=nv(at.className,R.className);if(Ie)for(const Et of Ie)ee.toggleClassName(Et);return U.current.props=R,tv.createPortal(R.children,ee.getElement())}));nn.memo(nn.forwardRef((R,B)=>{const{map:Y,mapLib:F}=nn.useContext(lp),U=nn.useMemo(()=>document.createElement("div"),[]),ee=nn.useRef({props:R}),L=nn.useMemo(()=>{const f={...R},ue=new F.Popup(f);return ue.setLngLat([R.longitude,R.latitude]),ue.once("open",ge=>{ee.current.props.onOpen?.(ge)}),ue},[]);if(nn.useEffect(()=>{const f=ue=>{ee.current.props.onClose?.(ue)};return L.on("close",f),L.setDOMContent(U).addTo(Y.getMap()),()=>{L.off("close",f),L.isOpen()&&L.remove()}},[]),nn.useEffect(()=>{nh(L.getElement(),R.style)},[R.style]),nn.useImperativeHandle(B,()=>L,[]),L.isOpen()){const f=ee.current.props;(L.getLngLat().lng!==R.longitude||L.getLngLat().lat!==R.latitude)&&L.setLngLat([R.longitude,R.latitude]),R.offset&&!No(f.offset,R.offset)&&L.setOffset(R.offset),(f.anchor!==R.anchor||f.maxWidth!==R.maxWidth)&&(L.options.anchor=R.anchor,L.setMaxWidth(R.maxWidth));const ue=nv(f.className,R.className);if(ue)for(const ge of ue)L.toggleClassName(ge);ee.current.props=R}return tv.createPortal(R.children,U)}));function ad(R,B,Y,F){const U=nn.useContext(lp),ee=nn.useMemo(()=>R(U),[]);return nn.useEffect(()=>{const L=B,f=null,ue=typeof B=="function"?B:null,{map:ge}=U;return ge.hasControl(ee)||(ge.addControl(ee,L?.position),f&&f(U)),()=>{ue&&ue(U),ge.hasControl(ee)&&ge.removeControl(ee)}},[]),ee}function K0(R){const B=ad(({mapLib:Y})=>new Y.AttributionControl(R),{position:R.position});return nn.useEffect(()=>{nh(B._container,R.style)},[R.style]),null}nn.memo(K0);function J0(R){const B=ad(({mapLib:Y})=>new Y.FullscreenControl({container:R.containerId&&document.getElementById(R.containerId)}),{position:R.position});return nn.useEffect(()=>{nh(B._controlContainer,R.style)},[R.style]),null}nn.memo(J0);function ex(R,B){const Y=nn.useRef({props:R}),F=ad(({mapLib:U})=>{const ee=new U.GeolocateControl(R),L=ee._setupUI;return ee._setupUI=()=>{ee._container.hasChildNodes()||L()},ee.on("geolocate",f=>{Y.current.props.onGeolocate?.(f)}),ee.on("error",f=>{Y.current.props.onError?.(f)}),ee.on("outofmaxbounds",f=>{Y.current.props.onOutOfMaxBounds?.(f)}),ee.on("trackuserlocationstart",f=>{Y.current.props.onTrackUserLocationStart?.(f)}),ee.on("trackuserlocationend",f=>{Y.current.props.onTrackUserLocationEnd?.(f)}),ee},{position:R.position});return Y.current.props=R,nn.useImperativeHandle(B,()=>F,[]),nn.useEffect(()=>{nh(F._container,R.style)},[R.style]),null}nn.memo(nn.forwardRef(ex));function tx(R){const B=ad(({mapLib:Y})=>new Y.NavigationControl(R),{position:R.position});return nn.useEffect(()=>{nh(B._container,R.style)},[R.style]),null}nn.memo(tx);function nx(R){const B=ad(({mapLib:ee})=>new ee.ScaleControl(R),{position:R.position}),Y=nn.useRef(R),F=Y.current;Y.current=R;const{style:U}=R;return R.maxWidth!==void 0&&R.maxWidth!==F.maxWidth&&(B.options.maxWidth=R.maxWidth),R.unit!==void 0&&R.unit!==F.unit&&B.setUnit(R.unit),nn.useEffect(()=>{nh(B._container,U)},[U]),null}nn.memo(nx);function ix(R){const B=ad(({mapLib:Y})=>new Y.TerrainControl(R),{position:R.position});return nn.useEffect(()=>{nh(B._container,R.style)},[R.style]),null}nn.memo(ix);function rx(R){const B=ad(({mapLib:Y})=>new Y.LogoControl(R),{position:R.position});return nn.useEffect(()=>{nh(B._container,R.style)},[R.style]),null}nn.memo(rx);function Lg(R,B){if(!R)throw new Error(B)}let ax=0;function sx(R,B,Y){if(R.style&&R.style._loaded){const F={...Y};return delete F.id,delete F.children,R.addSource(B,F),R.getSource(B)}return null}function ox(R,B,Y){Lg(B.id===Y.id,"source id changed"),Lg(B.type===Y.type,"source type changed");let F="",U=0;for(const L in B)L!=="children"&&L!=="id"&&!No(Y[L],B[L])&&(F=L,U++);if(!U)return;const ee=B.type;if(ee==="geojson")R.setData(B.data);else if(ee==="image")R.updateImage({url:B.url,coordinates:B.coordinates});else switch(F){case"coordinates":R.setCoordinates?.(B.coordinates);break;case"url":R.setUrl?.(B.url);break;case"tiles":R.setTiles?.(B.tiles);break;default:console.warn(`Unable to update <Source> prop: ${F}`)}}function lx(R){const B=nn.useContext(lp).map.getMap(),Y=nn.useRef(R),[,F]=nn.useState(0),U=nn.useMemo(()=>R.id||`jsx-source-${ax++}`,[]);nn.useEffect(()=>{if(B){const L=()=>setTimeout(()=>F(f=>f+1),0);return B.on("styledata",L),L(),()=>{if(B.off("styledata",L),B.style&&B.style._loaded&&B.getSource(U)){const f=B.getStyle()?.layers;if(f)for(const ue of f)ue.source===U&&B.removeLayer(ue.id);B.removeSource(U)}}}},[B]);let ee=B&&B.style&&B.getSource(U);return ee?ox(ee,R,Y.current):ee=sx(B,U,R),Y.current=R,ee&&nn.Children.map(R.children,L=>L&&nn.cloneElement(L,{source:U}))||null}function ux(R,B,Y,F){if(Lg(Y.id===F.id,"layer id changed"),Lg(Y.type===F.type,"layer type changed"),Y.type==="custom"||F.type==="custom")return;const{layout:U={},paint:ee={},filter:L,minzoom:f,maxzoom:ue,beforeId:ge}=Y;if(ge!==F.beforeId&&R.moveLayer(B,ge),U!==F.layout){const Te=F.layout||{};for(const ce in U)No(U[ce],Te[ce])||R.setLayoutProperty(B,ce,U[ce]);for(const ce in Te)U.hasOwnProperty(ce)||R.setLayoutProperty(B,ce,void 0)}if(ee!==F.paint){const Te=F.paint||{};for(const ce in ee)No(ee[ce],Te[ce])||R.setPaintProperty(B,ce,ee[ce]);for(const ce in Te)ee.hasOwnProperty(ce)||R.setPaintProperty(B,ce,void 0)}No(L,F.filter)||R.setFilter(B,L),(f!==F.minzoom||ue!==F.maxzoom)&&R.setLayerZoomRange(B,f,ue)}function cx(R,B,Y){if(R.style&&R.style._loaded&&(!("source"in Y)||R.getSource(Y.source))){const F={...Y,id:B};delete F.beforeId,R.addLayer(F,Y.beforeId)}}let hx=0;function b_(R){const B=nn.useContext(lp).map.getMap(),Y=nn.useRef(R),[,F]=nn.useState(0),U=nn.useMemo(()=>R.id||`jsx-layer-${hx++}`,[]);if(nn.useEffect(()=>{if(B){const L=()=>F(f=>f+1);return B.on("styledata",L),L(),()=>{B.off("styledata",L),B.style&&B.style._loaded&&B.getLayer(U)&&B.removeLayer(U)}}},[B]),B&&B.style&&B.getLayer(U))try{ux(B,U,R,Y.current)}catch(L){console.warn(L)}else cx(B,U,R);return Y.current=R,null}const fx=({resultGeoJSONs:R,onMapClick:B})=>Nt.jsx("div",{style:{width:"80vw",height:"80vh"},children:Nt.jsx(W0,{initialViewState:{longitude:0,latitude:0,zoom:4},hash:!1,style:{width:"100%",height:"100%"},mapStyle:"https://tile.yuiseki.net/styles/osm-fiord/style.json",onClick:Y=>{B&&B(Y)},children:R&&R.map((Y,F)=>Nt.jsxs(lx,{type:"geojson",data:Y,children:[Nt.jsx(b_,{id:`line-layer-${F}`,type:"line",paint:{"line-color":"#FF0000","line-width":4}}),Nt.jsx(b_,{id:`fill-layer-${F}`,type:"fill",paint:{"fill-color":"#00FF00","fill-opacity":.5}}),Nt.jsx(b_,{id:`circle-layer-${F}`,type:"circle",paint:{"circle-radius":6,"circle-color":"#0000FF"}})]},F))})});function dx(){const[R,B]=nn.useState(null),[Y,F]=nn.useState(null);return Nt.jsxs("div",{style:{padding:"10px"},children:[Nt.jsx("h1",{children:"GIS Algorithm Study App"}),Nt.jsx("div",{children:Nt.jsxs("p",{children:["NOTE: ",Nt.jsx("b",{children:"GeoJSON  WGS84 (EPSG:4326 10) "}),Nt.jsx("b",{children:"MapLibre  Web Mercator (EPSG:3857) "})]})}),Nt.jsx("hr",{}),Nt.jsx(z0,{selectedLabId:R||void 0,onLabSelect:U=>{B(U)}}),Nt.jsxs("div",{style:{display:"flex"},children:[Nt.jsx(fx,{resultGeoJSONs:Y,onMapClick:U=>{if(R==="distanceLab"){const ee=[U.lngLat.lng,U.lngLat.lat];ku.state=ku.state||{clickedCoordsPrevious:null,clickedCoordsCurrent:null};const L=ku.state.clickedCoordsCurrent;ku.state.clickedCoordsPrevious=L,ku.state.clickedCoordsCurrent=ee;const f=ku.compute(ku.state);F(f)}else if(R==="bufferCircleLab"){const ee=[U.lngLat.lng,U.lngLat.lat];Ul.state=Ul.state||{clickedCoords:null},Ul.state.clickedCoords=ee;const L=Ul.compute(Ul.state);F(L)}else if(R==="pointInPolygonLab"){const ee=[U.lngLat.lng,U.lngLat.lat];jl.state=jl.state||{clickedCoords:null,polygonType:"simple",ignoreBoundary:!0},jl.state.clickedCoords=ee;const L=jl.compute(jl.state);F(L)}}}),Nt.jsx("div",{style:{width:"30vw",padding:"10px"},children:R==="distanceLab"&&ku.Panel?ku.Panel(ku.state,Y):R==="bufferCircleLab"&&Ul.Panel?Ul.Panel(Ul.state,Y,U=>{Ul.state=U;const ee=Ul.compute(Ul.state);F(ee)}):R==="pointInPolygonLab"&&jl.Panel?jl.Panel(jl.state,Y,U=>{jl.state=U;const ee=jl.compute(jl.state);F(ee)}):Nt.jsxs("div",{children:[Nt.jsx("h2",{children:""}),Nt.jsx("p",{children:""})]})})]})]})}Ev.createRoot(document.getElementById("root")).render(Nt.jsx(nn.StrictMode,{children:Nt.jsx(dx,{})}));
