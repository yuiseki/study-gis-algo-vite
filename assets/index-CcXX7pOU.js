function N0(S,C){for(var P=0;P<C.length;P++){const I=C[P];if(typeof I!="string"&&!Array.isArray(I)){for(const D in I)if(D!=="default"&&!(D in S)){const U=Object.getOwnPropertyDescriptor(I,D);U&&Object.defineProperty(S,D,U.get?U:{enumerable:!0,get:()=>I[D]})}}}return Object.freeze(Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}))}(function(){const C=document.createElement("link").relList;if(C&&C.supports&&C.supports("modulepreload"))return;for(const D of document.querySelectorAll('link[rel="modulepreload"]'))I(D);new MutationObserver(D=>{for(const U of D)if(U.type==="childList")for(const L of U.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&I(L)}).observe(document,{childList:!0,subtree:!0});function P(D){const U={};return D.integrity&&(U.integrity=D.integrity),D.referrerPolicy&&(U.referrerPolicy=D.referrerPolicy),D.crossOrigin==="use-credentials"?U.credentials="include":D.crossOrigin==="anonymous"?U.credentials="omit":U.credentials="same-origin",U}function I(D){if(D.ep)return;D.ep=!0;const U=P(D);fetch(D.href,U)}})();function Vv(S){return S&&S.__esModule&&Object.prototype.hasOwnProperty.call(S,"default")?S.default:S}var W_={exports:{}},Om={};var By;function B0(){if(By)return Om;By=1;var S=Symbol.for("react.transitional.element"),C=Symbol.for("react.fragment");function P(I,D,U){var L=null;if(U!==void 0&&(L=""+U),D.key!==void 0&&(L=""+D.key),"key"in D){U={};for(var c in D)c!=="key"&&(U[c]=D[c])}else U=D;return D=U.ref,{$$typeof:S,type:I,key:L,ref:D!==void 0?D:null,props:U}}return Om.Fragment=C,Om.jsx=P,Om.jsxs=P,Om}var Fy;function F0(){return Fy||(Fy=1,W_.exports=B0()),W_.exports}var et=F0(),K_={exports:{}},jn={};var jy;function j0(){if(jy)return jn;jy=1;var S=Symbol.for("react.transitional.element"),C=Symbol.for("react.portal"),P=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),U=Symbol.for("react.consumer"),L=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),X=Symbol.for("react.suspense"),ne=Symbol.for("react.memo"),fe=Symbol.for("react.lazy"),ie=Symbol.for("react.activity"),xe=Symbol.iterator;function Be(Me){return Me===null||typeof Me!="object"?null:(Me=xe&&Me[xe]||Me["@@iterator"],typeof Me=="function"?Me:null)}var Ge={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},dt=Object.assign,Ce={};function It(Me,ut,Ot){this.props=Me,this.context=ut,this.refs=Ce,this.updater=Ot||Ge}It.prototype.isReactComponent={},It.prototype.setState=function(Me,ut){if(typeof Me!="object"&&typeof Me!="function"&&Me!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Me,ut,"setState")},It.prototype.forceUpdate=function(Me){this.updater.enqueueForceUpdate(this,Me,"forceUpdate")};function Ye(){}Ye.prototype=It.prototype;function at(Me,ut,Ot){this.props=Me,this.context=ut,this.refs=Ce,this.updater=Ot||Ge}var jt=at.prototype=new Ye;jt.constructor=at,dt(jt,It.prototype),jt.isPureReactComponent=!0;var At=Array.isArray;function Vt(){}var wt={H:null,A:null,T:null,S:null},oe=Object.prototype.hasOwnProperty;function de(Me,ut,Ot){var Ct=Ot.ref;return{$$typeof:S,type:Me,key:ut,ref:Ct!==void 0?Ct:null,props:Ot}}function Ie(Me,ut){return de(Me.type,ut,Me.props)}function Xe(Me){return typeof Me=="object"&&Me!==null&&Me.$$typeof===S}function Ne(Me){var ut={"=":"=0",":":"=2"};return"$"+Me.replace(/[=:]/g,function(Ot){return ut[Ot]})}var He=/\/+/g;function Fe(Me,ut){return typeof Me=="object"&&Me!==null&&Me.key!=null?Ne(""+Me.key):ut.toString(36)}function Le(Me){switch(Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason;default:switch(typeof Me.status=="string"?Me.then(Vt,Vt):(Me.status="pending",Me.then(function(ut){Me.status==="pending"&&(Me.status="fulfilled",Me.value=ut)},function(ut){Me.status==="pending"&&(Me.status="rejected",Me.reason=ut)})),Me.status){case"fulfilled":return Me.value;case"rejected":throw Me.reason}}throw Me}function me(Me,ut,Ot,Ct,Zt){var tn=typeof Me;(tn==="undefined"||tn==="boolean")&&(Me=null);var _n=!1;if(Me===null)_n=!0;else switch(tn){case"bigint":case"string":case"number":_n=!0;break;case"object":switch(Me.$$typeof){case S:case C:_n=!0;break;case fe:return _n=Me._init,me(_n(Me._payload),ut,Ot,Ct,Zt)}}if(_n)return Zt=Zt(Me),_n=Ct===""?"."+Fe(Me,0):Ct,At(Zt)?(Ot="",_n!=null&&(Ot=_n.replace(He,"$&/")+"/"),me(Zt,ut,Ot,"",function(Rn){return Rn})):Zt!=null&&(Xe(Zt)&&(Zt=Ie(Zt,Ot+(Zt.key==null||Me&&Me.key===Zt.key?"":(""+Zt.key).replace(He,"$&/")+"/")+_n)),ut.push(Zt)),1;_n=0;var Qe=Ct===""?".":Ct+":";if(At(Me))for(var ni=0;ni<Me.length;ni++)Ct=Me[ni],tn=Qe+Fe(Ct,ni),_n+=me(Ct,ut,Ot,tn,Zt);else if(ni=Be(Me),typeof ni=="function")for(Me=ni.call(Me),ni=0;!(Ct=Me.next()).done;)Ct=Ct.value,tn=Qe+Fe(Ct,ni++),_n+=me(Ct,ut,Ot,tn,Zt);else if(tn==="object"){if(typeof Me.then=="function")return me(Le(Me),ut,Ot,Ct,Zt);throw ut=String(Me),Error("Objects are not valid as a React child (found: "+(ut==="[object Object]"?"object with keys {"+Object.keys(Me).join(", ")+"}":ut)+"). If you meant to render a collection of children, use an array instead.")}return _n}function Pe(Me,ut,Ot){if(Me==null)return Me;var Ct=[],Zt=0;return me(Me,Ct,"","",function(tn){return ut.call(Ot,tn,Zt++)}),Ct}function Ue(Me){if(Me._status===-1){var ut=Me._result;ut=ut(),ut.then(function(Ot){(Me._status===0||Me._status===-1)&&(Me._status=1,Me._result=Ot)},function(Ot){(Me._status===0||Me._status===-1)&&(Me._status=2,Me._result=Ot)}),Me._status===-1&&(Me._status=0,Me._result=ut)}if(Me._status===1)return Me._result.default;throw Me._result}var tt=typeof reportError=="function"?reportError:function(Me){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ut=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Me=="object"&&Me!==null&&typeof Me.message=="string"?String(Me.message):String(Me),error:Me});if(!window.dispatchEvent(ut))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Me);return}console.error(Me)},vt={map:Pe,forEach:function(Me,ut,Ot){Pe(Me,function(){ut.apply(this,arguments)},Ot)},count:function(Me){var ut=0;return Pe(Me,function(){ut++}),ut},toArray:function(Me){return Pe(Me,function(ut){return ut})||[]},only:function(Me){if(!Xe(Me))throw Error("React.Children.only expected to receive a single React element child.");return Me}};return jn.Activity=ie,jn.Children=vt,jn.Component=It,jn.Fragment=P,jn.Profiler=D,jn.PureComponent=at,jn.StrictMode=I,jn.Suspense=X,jn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=wt,jn.__COMPILER_RUNTIME={__proto__:null,c:function(Me){return wt.H.useMemoCache(Me)}},jn.cache=function(Me){return function(){return Me.apply(null,arguments)}},jn.cacheSignal=function(){return null},jn.cloneElement=function(Me,ut,Ot){if(Me==null)throw Error("The argument must be a React element, but you passed "+Me+".");var Ct=dt({},Me.props),Zt=Me.key;if(ut!=null)for(tn in ut.key!==void 0&&(Zt=""+ut.key),ut)!oe.call(ut,tn)||tn==="key"||tn==="__self"||tn==="__source"||tn==="ref"&&ut.ref===void 0||(Ct[tn]=ut[tn]);var tn=arguments.length-2;if(tn===1)Ct.children=Ot;else if(1<tn){for(var _n=Array(tn),Qe=0;Qe<tn;Qe++)_n[Qe]=arguments[Qe+2];Ct.children=_n}return de(Me.type,Zt,Ct)},jn.createContext=function(Me){return Me={$$typeof:L,_currentValue:Me,_currentValue2:Me,_threadCount:0,Provider:null,Consumer:null},Me.Provider=Me,Me.Consumer={$$typeof:U,_context:Me},Me},jn.createElement=function(Me,ut,Ot){var Ct,Zt={},tn=null;if(ut!=null)for(Ct in ut.key!==void 0&&(tn=""+ut.key),ut)oe.call(ut,Ct)&&Ct!=="key"&&Ct!=="__self"&&Ct!=="__source"&&(Zt[Ct]=ut[Ct]);var _n=arguments.length-2;if(_n===1)Zt.children=Ot;else if(1<_n){for(var Qe=Array(_n),ni=0;ni<_n;ni++)Qe[ni]=arguments[ni+2];Zt.children=Qe}if(Me&&Me.defaultProps)for(Ct in _n=Me.defaultProps,_n)Zt[Ct]===void 0&&(Zt[Ct]=_n[Ct]);return de(Me,tn,Zt)},jn.createRef=function(){return{current:null}},jn.forwardRef=function(Me){return{$$typeof:c,render:Me}},jn.isValidElement=Xe,jn.lazy=function(Me){return{$$typeof:fe,_payload:{_status:-1,_result:Me},_init:Ue}},jn.memo=function(Me,ut){return{$$typeof:ne,type:Me,compare:ut===void 0?null:ut}},jn.startTransition=function(Me){var ut=wt.T,Ot={};wt.T=Ot;try{var Ct=Me(),Zt=wt.S;Zt!==null&&Zt(Ot,Ct),typeof Ct=="object"&&Ct!==null&&typeof Ct.then=="function"&&Ct.then(Vt,tt)}catch(tn){tt(tn)}finally{ut!==null&&Ot.types!==null&&(ut.types=Ot.types),wt.T=ut}},jn.unstable_useCacheRefresh=function(){return wt.H.useCacheRefresh()},jn.use=function(Me){return wt.H.use(Me)},jn.useActionState=function(Me,ut,Ot){return wt.H.useActionState(Me,ut,Ot)},jn.useCallback=function(Me,ut){return wt.H.useCallback(Me,ut)},jn.useContext=function(Me){return wt.H.useContext(Me)},jn.useDebugValue=function(){},jn.useDeferredValue=function(Me,ut){return wt.H.useDeferredValue(Me,ut)},jn.useEffect=function(Me,ut){return wt.H.useEffect(Me,ut)},jn.useEffectEvent=function(Me){return wt.H.useEffectEvent(Me)},jn.useId=function(){return wt.H.useId()},jn.useImperativeHandle=function(Me,ut,Ot){return wt.H.useImperativeHandle(Me,ut,Ot)},jn.useInsertionEffect=function(Me,ut){return wt.H.useInsertionEffect(Me,ut)},jn.useLayoutEffect=function(Me,ut){return wt.H.useLayoutEffect(Me,ut)},jn.useMemo=function(Me,ut){return wt.H.useMemo(Me,ut)},jn.useOptimistic=function(Me,ut){return wt.H.useOptimistic(Me,ut)},jn.useReducer=function(Me,ut,Ot){return wt.H.useReducer(Me,ut,Ot)},jn.useRef=function(Me){return wt.H.useRef(Me)},jn.useState=function(Me){return wt.H.useState(Me)},jn.useSyncExternalStore=function(Me,ut,Ot){return wt.H.useSyncExternalStore(Me,ut,Ot)},jn.useTransition=function(){return wt.H.useTransition()},jn.version="19.2.3",jn}var Uy;function wy(){return Uy||(Uy=1,K_.exports=j0()),K_.exports}var cn=wy(),Q_={exports:{}},Nm={},J_={exports:{}},ey={};var Vy;function U0(){return Vy||(Vy=1,(function(S){function C(me,Pe){var Ue=me.length;me.push(Pe);e:for(;0<Ue;){var tt=Ue-1>>>1,vt=me[tt];if(0<D(vt,Pe))me[tt]=Pe,me[Ue]=vt,Ue=tt;else break e}}function P(me){return me.length===0?null:me[0]}function I(me){if(me.length===0)return null;var Pe=me[0],Ue=me.pop();if(Ue!==Pe){me[0]=Ue;e:for(var tt=0,vt=me.length,Me=vt>>>1;tt<Me;){var ut=2*(tt+1)-1,Ot=me[ut],Ct=ut+1,Zt=me[Ct];if(0>D(Ot,Ue))Ct<vt&&0>D(Zt,Ot)?(me[tt]=Zt,me[Ct]=Ue,tt=Ct):(me[tt]=Ot,me[ut]=Ue,tt=ut);else if(Ct<vt&&0>D(Zt,Ue))me[tt]=Zt,me[Ct]=Ue,tt=Ct;else break e}}return Pe}function D(me,Pe){var Ue=me.sortIndex-Pe.sortIndex;return Ue!==0?Ue:me.id-Pe.id}if(S.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var U=performance;S.unstable_now=function(){return U.now()}}else{var L=Date,c=L.now();S.unstable_now=function(){return L.now()-c}}var X=[],ne=[],fe=1,ie=null,xe=3,Be=!1,Ge=!1,dt=!1,Ce=!1,It=typeof setTimeout=="function"?setTimeout:null,Ye=typeof clearTimeout=="function"?clearTimeout:null,at=typeof setImmediate<"u"?setImmediate:null;function jt(me){for(var Pe=P(ne);Pe!==null;){if(Pe.callback===null)I(ne);else if(Pe.startTime<=me)I(ne),Pe.sortIndex=Pe.expirationTime,C(X,Pe);else break;Pe=P(ne)}}function At(me){if(dt=!1,jt(me),!Ge)if(P(X)!==null)Ge=!0,Vt||(Vt=!0,Ne());else{var Pe=P(ne);Pe!==null&&Le(At,Pe.startTime-me)}}var Vt=!1,wt=-1,oe=5,de=-1;function Ie(){return Ce?!0:!(S.unstable_now()-de<oe)}function Xe(){if(Ce=!1,Vt){var me=S.unstable_now();de=me;var Pe=!0;try{e:{Ge=!1,dt&&(dt=!1,Ye(wt),wt=-1),Be=!0;var Ue=xe;try{t:{for(jt(me),ie=P(X);ie!==null&&!(ie.expirationTime>me&&Ie());){var tt=ie.callback;if(typeof tt=="function"){ie.callback=null,xe=ie.priorityLevel;var vt=tt(ie.expirationTime<=me);if(me=S.unstable_now(),typeof vt=="function"){ie.callback=vt,jt(me),Pe=!0;break t}ie===P(X)&&I(X),jt(me)}else I(X);ie=P(X)}if(ie!==null)Pe=!0;else{var Me=P(ne);Me!==null&&Le(At,Me.startTime-me),Pe=!1}}break e}finally{ie=null,xe=Ue,Be=!1}Pe=void 0}}finally{Pe?Ne():Vt=!1}}}var Ne;if(typeof at=="function")Ne=function(){at(Xe)};else if(typeof MessageChannel<"u"){var He=new MessageChannel,Fe=He.port2;He.port1.onmessage=Xe,Ne=function(){Fe.postMessage(null)}}else Ne=function(){It(Xe,0)};function Le(me,Pe){wt=It(function(){me(S.unstable_now())},Pe)}S.unstable_IdlePriority=5,S.unstable_ImmediatePriority=1,S.unstable_LowPriority=4,S.unstable_NormalPriority=3,S.unstable_Profiling=null,S.unstable_UserBlockingPriority=2,S.unstable_cancelCallback=function(me){me.callback=null},S.unstable_forceFrameRate=function(me){0>me||125<me?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):oe=0<me?Math.floor(1e3/me):5},S.unstable_getCurrentPriorityLevel=function(){return xe},S.unstable_next=function(me){switch(xe){case 1:case 2:case 3:var Pe=3;break;default:Pe=xe}var Ue=xe;xe=Pe;try{return me()}finally{xe=Ue}},S.unstable_requestPaint=function(){Ce=!0},S.unstable_runWithPriority=function(me,Pe){switch(me){case 1:case 2:case 3:case 4:case 5:break;default:me=3}var Ue=xe;xe=me;try{return Pe()}finally{xe=Ue}},S.unstable_scheduleCallback=function(me,Pe,Ue){var tt=S.unstable_now();switch(typeof Ue=="object"&&Ue!==null?(Ue=Ue.delay,Ue=typeof Ue=="number"&&0<Ue?tt+Ue:tt):Ue=tt,me){case 1:var vt=-1;break;case 2:vt=250;break;case 5:vt=1073741823;break;case 4:vt=1e4;break;default:vt=5e3}return vt=Ue+vt,me={id:fe++,callback:Pe,priorityLevel:me,startTime:Ue,expirationTime:vt,sortIndex:-1},Ue>tt?(me.sortIndex=Ue,C(ne,me),P(X)===null&&me===P(ne)&&(dt?(Ye(wt),wt=-1):dt=!0,Le(At,Ue-tt))):(me.sortIndex=vt,C(X,me),Ge||Be||(Ge=!0,Vt||(Vt=!0,Ne()))),me},S.unstable_shouldYield=Ie,S.unstable_wrapCallback=function(me){var Pe=xe;return function(){var Ue=xe;xe=Pe;try{return me.apply(this,arguments)}finally{xe=Ue}}}})(ey)),ey}var Gy;function V0(){return Gy||(Gy=1,J_.exports=U0()),J_.exports}var ty={exports:{}},Us={};var qy;function G0(){if(qy)return Us;qy=1;var S=wy();function C(X){var ne="https://react.dev/errors/"+X;if(1<arguments.length){ne+="?args[]="+encodeURIComponent(arguments[1]);for(var fe=2;fe<arguments.length;fe++)ne+="&args[]="+encodeURIComponent(arguments[fe])}return"Minified React error #"+X+"; visit "+ne+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function P(){}var I={d:{f:P,r:function(){throw Error(C(522))},D:P,C:P,L:P,m:P,X:P,S:P,M:P},p:0,findDOMNode:null},D=Symbol.for("react.portal");function U(X,ne,fe){var ie=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:ie==null?null:""+ie,children:X,containerInfo:ne,implementation:fe}}var L=S.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(X,ne){if(X==="font")return"";if(typeof ne=="string")return ne==="use-credentials"?ne:""}return Us.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=I,Us.createPortal=function(X,ne){var fe=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ne||ne.nodeType!==1&&ne.nodeType!==9&&ne.nodeType!==11)throw Error(C(299));return U(X,ne,null,fe)},Us.flushSync=function(X){var ne=L.T,fe=I.p;try{if(L.T=null,I.p=2,X)return X()}finally{L.T=ne,I.p=fe,I.d.f()}},Us.preconnect=function(X,ne){typeof X=="string"&&(ne?(ne=ne.crossOrigin,ne=typeof ne=="string"?ne==="use-credentials"?ne:"":void 0):ne=null,I.d.C(X,ne))},Us.prefetchDNS=function(X){typeof X=="string"&&I.d.D(X)},Us.preinit=function(X,ne){if(typeof X=="string"&&ne&&typeof ne.as=="string"){var fe=ne.as,ie=c(fe,ne.crossOrigin),xe=typeof ne.integrity=="string"?ne.integrity:void 0,Be=typeof ne.fetchPriority=="string"?ne.fetchPriority:void 0;fe==="style"?I.d.S(X,typeof ne.precedence=="string"?ne.precedence:void 0,{crossOrigin:ie,integrity:xe,fetchPriority:Be}):fe==="script"&&I.d.X(X,{crossOrigin:ie,integrity:xe,fetchPriority:Be,nonce:typeof ne.nonce=="string"?ne.nonce:void 0})}},Us.preinitModule=function(X,ne){if(typeof X=="string")if(typeof ne=="object"&&ne!==null){if(ne.as==null||ne.as==="script"){var fe=c(ne.as,ne.crossOrigin);I.d.M(X,{crossOrigin:fe,integrity:typeof ne.integrity=="string"?ne.integrity:void 0,nonce:typeof ne.nonce=="string"?ne.nonce:void 0})}}else ne==null&&I.d.M(X)},Us.preload=function(X,ne){if(typeof X=="string"&&typeof ne=="object"&&ne!==null&&typeof ne.as=="string"){var fe=ne.as,ie=c(fe,ne.crossOrigin);I.d.L(X,fe,{crossOrigin:ie,integrity:typeof ne.integrity=="string"?ne.integrity:void 0,nonce:typeof ne.nonce=="string"?ne.nonce:void 0,type:typeof ne.type=="string"?ne.type:void 0,fetchPriority:typeof ne.fetchPriority=="string"?ne.fetchPriority:void 0,referrerPolicy:typeof ne.referrerPolicy=="string"?ne.referrerPolicy:void 0,imageSrcSet:typeof ne.imageSrcSet=="string"?ne.imageSrcSet:void 0,imageSizes:typeof ne.imageSizes=="string"?ne.imageSizes:void 0,media:typeof ne.media=="string"?ne.media:void 0})}},Us.preloadModule=function(X,ne){if(typeof X=="string")if(ne){var fe=c(ne.as,ne.crossOrigin);I.d.m(X,{as:typeof ne.as=="string"&&ne.as!=="script"?ne.as:void 0,crossOrigin:fe,integrity:typeof ne.integrity=="string"?ne.integrity:void 0})}else I.d.m(X)},Us.requestFormReset=function(X){I.d.r(X)},Us.unstable_batchedUpdates=function(X,ne){return X(ne)},Us.useFormState=function(X,ne,fe){return L.H.useFormState(X,ne,fe)},Us.useFormStatus=function(){return L.H.useHostTransitionStatus()},Us.version="19.2.3",Us}var Zy;function Gv(){if(Zy)return ty.exports;Zy=1;function S(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S)}catch(C){console.error(C)}}return S(),ty.exports=G0(),ty.exports}var Yy;function q0(){if(Yy)return Nm;Yy=1;var S=V0(),C=wy(),P=Gv();function I(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)s+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function D(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function U(r){var s=r,d=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(d=s.return),r=s.return;while(r)}return s.tag===3?d:null}function L(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function c(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function X(r){if(U(r)!==r)throw Error(I(188))}function ne(r){var s=r.alternate;if(!s){if(s=U(r),s===null)throw Error(I(188));return s!==r?null:r}for(var d=r,x=s;;){var A=d.return;if(A===null)break;var O=A.alternate;if(O===null){if(x=A.return,x!==null){d=x;continue}break}if(A.child===O.child){for(O=A.child;O;){if(O===d)return X(A),r;if(O===x)return X(A),s;O=O.sibling}throw Error(I(188))}if(d.return!==x.return)d=A,x=O;else{for(var W=!1,ce=A.child;ce;){if(ce===d){W=!0,d=A,x=O;break}if(ce===x){W=!0,x=A,d=O;break}ce=ce.sibling}if(!W){for(ce=O.child;ce;){if(ce===d){W=!0,d=O,x=A;break}if(ce===x){W=!0,x=O,d=A;break}ce=ce.sibling}if(!W)throw Error(I(189))}}if(d.alternate!==x)throw Error(I(190))}if(d.tag!==3)throw Error(I(188));return d.stateNode.current===d?r:s}function fe(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=fe(r),s!==null)return s;r=r.sibling}return null}var ie=Object.assign,xe=Symbol.for("react.element"),Be=Symbol.for("react.transitional.element"),Ge=Symbol.for("react.portal"),dt=Symbol.for("react.fragment"),Ce=Symbol.for("react.strict_mode"),It=Symbol.for("react.profiler"),Ye=Symbol.for("react.consumer"),at=Symbol.for("react.context"),jt=Symbol.for("react.forward_ref"),At=Symbol.for("react.suspense"),Vt=Symbol.for("react.suspense_list"),wt=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),de=Symbol.for("react.activity"),Ie=Symbol.for("react.memo_cache_sentinel"),Xe=Symbol.iterator;function Ne(r){return r===null||typeof r!="object"?null:(r=Xe&&r[Xe]||r["@@iterator"],typeof r=="function"?r:null)}var He=Symbol.for("react.client.reference");function Fe(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===He?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case dt:return"Fragment";case It:return"Profiler";case Ce:return"StrictMode";case At:return"Suspense";case Vt:return"SuspenseList";case de:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case Ge:return"Portal";case at:return r.displayName||"Context";case Ye:return(r._context.displayName||"Context")+".Consumer";case jt:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case wt:return s=r.displayName||null,s!==null?s:Fe(r.type)||"Memo";case oe:s=r._payload,r=r._init;try{return Fe(r(s))}catch{}}return null}var Le=Array.isArray,me=C.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Pe=P.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Ue={pending:!1,data:null,method:null,action:null},tt=[],vt=-1;function Me(r){return{current:r}}function ut(r){0>vt||(r.current=tt[vt],tt[vt]=null,vt--)}function Ot(r,s){vt++,tt[vt]=r.current,r.current=s}var Ct=Me(null),Zt=Me(null),tn=Me(null),_n=Me(null);function Qe(r,s){switch(Ot(tn,s),Ot(Zt,r),Ot(Ct,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?dd(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=dd(s),r=ap(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}ut(Ct),Ot(Ct,r)}function ni(){ut(Ct),ut(Zt),ut(tn)}function Rn(r){r.memoizedState!==null&&Ot(_n,r);var s=Ct.current,d=ap(s,r.type);s!==d&&(Ot(Zt,r),Ot(Ct,d))}function rn(r){Zt.current===r&&(ut(Ct),ut(Zt)),_n.current===r&&(ut(_n),yd._currentValue=Ue)}var Re,fi;function Dn(r){if(Re===void 0)try{throw Error()}catch(d){var s=d.stack.trim().match(/\n( *(at )?)/);Re=s&&s[1]||"",fi=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Re+r+fi}var Pn=!1;function Ia(r,s){if(!r||Pn)return"";Pn=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var x={DetermineComponentFrameRoot:function(){try{if(s){var Ft=function(){throw Error()};if(Object.defineProperty(Ft.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ft,[])}catch(bt){var yt=bt}Reflect.construct(r,[],Ft)}else{try{Ft.call()}catch(bt){yt=bt}r.call(Ft.prototype)}}else{try{throw Error()}catch(bt){yt=bt}(Ft=r())&&typeof Ft.catch=="function"&&Ft.catch(function(){})}}catch(bt){if(bt&&yt&&typeof bt.stack=="string")return[bt.stack,yt.stack]}return[null,null]}};x.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var A=Object.getOwnPropertyDescriptor(x.DetermineComponentFrameRoot,"name");A&&A.configurable&&Object.defineProperty(x.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var O=x.DetermineComponentFrameRoot(),W=O[0],ce=O[1];if(W&&ce){var Ve=W.split(`
`),_t=ce.split(`
`);for(A=x=0;x<Ve.length&&!Ve[x].includes("DetermineComponentFrameRoot");)x++;for(;A<_t.length&&!_t[A].includes("DetermineComponentFrameRoot");)A++;if(x===Ve.length||A===_t.length)for(x=Ve.length-1,A=_t.length-1;1<=x&&0<=A&&Ve[x]!==_t[A];)A--;for(;1<=x&&0<=A;x--,A--)if(Ve[x]!==_t[A]){if(x!==1||A!==1)do if(x--,A--,0>A||Ve[x]!==_t[A]){var kt=`
`+Ve[x].replace(" at new "," at ");return r.displayName&&kt.includes("<anonymous>")&&(kt=kt.replace("<anonymous>",r.displayName)),kt}while(1<=x&&0<=A);break}}}finally{Pn=!1,Error.prepareStackTrace=d}return(d=r?r.displayName||r.name:"")?Dn(d):""}function Ri(r,s){switch(r.tag){case 26:case 27:case 5:return Dn(r.type);case 16:return Dn("Lazy");case 13:return r.child!==s&&s!==null?Dn("Suspense Fallback"):Dn("Suspense");case 19:return Dn("SuspenseList");case 0:case 15:return Ia(r.type,!1);case 11:return Ia(r.type.render,!1);case 1:return Ia(r.type,!0);case 31:return Dn("Activity");default:return""}}function Gs(r){try{var s="",d=null;do s+=Ri(r,d),d=r,r=r.return;while(r);return s}catch(x){return`
Error generating stack: `+x.message+`
`+x.stack}}var Yt=Object.prototype.hasOwnProperty,qs=S.unstable_scheduleCallback,os=S.unstable_cancelCallback,Nr=S.unstable_shouldYield,wl=S.unstable_requestPaint,dn=S.unstable_now,Sr=S.unstable_getCurrentPriorityLevel,nt=S.unstable_ImmediatePriority,re=S.unstable_UserBlockingPriority,te=S.unstable_NormalPriority,he=S.unstable_LowPriority,Se=S.unstable_IdlePriority,Ee=S.log,lt=S.unstable_setDisableYieldValue,Je=null,qe=null;function Ze(r){if(typeof Ee=="function"&&lt(r),qe&&typeof qe.setStrictMode=="function")try{qe.setStrictMode(Je,r)}catch{}}var St=Math.clz32?Math.clz32:Qt,Mt=Math.log,Wt=Math.LN2;function Qt(r){return r>>>=0,r===0?32:31-(Mt(r)/Wt|0)|0}var yn=256,zn=262144,Un=4194304;function it(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function ii(r,s,d){var x=r.pendingLanes;if(x===0)return 0;var A=0,O=r.suspendedLanes,W=r.pingedLanes;r=r.warmLanes;var ce=x&134217727;return ce!==0?(x=ce&~O,x!==0?A=it(x):(W&=ce,W!==0?A=it(W):d||(d=ce&~r,d!==0&&(A=it(d))))):(ce=x&~O,ce!==0?A=it(ce):W!==0?A=it(W):d||(d=x&~r,d!==0&&(A=it(d)))),A===0?0:s!==0&&s!==A&&(s&O)===0&&(O=A&-A,d=s&-s,O>=d||O===32&&(d&4194048)!==0)?s:A}function Hi(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function xn(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Nt(){var r=Un;return Un<<=1,(Un&62914560)===0&&(Un=4194304),r}function Xi(r){for(var s=[],d=0;31>d;d++)s.push(r);return s}function Kn(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function ki(r,s,d,x,A,O){var W=r.pendingLanes;r.pendingLanes=d,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=d,r.entangledLanes&=d,r.errorRecoveryDisabledLanes&=d,r.shellSuspendCounter=0;var ce=r.entanglements,Ve=r.expirationTimes,_t=r.hiddenUpdates;for(d=W&~d;0<d;){var kt=31-St(d),Ft=1<<kt;ce[kt]=0,Ve[kt]=-1;var yt=_t[kt];if(yt!==null)for(_t[kt]=null,kt=0;kt<yt.length;kt++){var bt=yt[kt];bt!==null&&(bt.lane&=-536870913)}d&=~Ft}x!==0&&si(r,x,0),O!==0&&A===0&&r.tag!==0&&(r.suspendedLanes|=O&~(W&~s))}function si(r,s,d){r.pendingLanes|=s,r.suspendedLanes&=~s;var x=31-St(s);r.entangledLanes|=s,r.entanglements[x]=r.entanglements[x]|1073741824|d&261930}function ji(r,s){var d=r.entangledLanes|=s;for(r=r.entanglements;d;){var x=31-St(d),A=1<<x;A&s|r[x]&s&&(r[x]|=s),d&=~A}}function qo(r,s){var d=s&-s;return d=(d&42)!==0?1:Aa(d),(d&(r.suspendedLanes|s))!==0?0:d}function Aa(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Gt(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function _r(){var r=Pe.p;return r!==0?r:(r=window.event,r===void 0?32:jg(r.type))}function Xr(r,s){var d=Pe.p;try{return Pe.p=r,s()}finally{Pe.p=d}}var Va=Math.random().toString(36).slice(2),di="__reactFiber$"+Va,Ut="__reactProps$"+Va,Sn="__reactContainer$"+Va,Mn="__reactEvents$"+Va,yr="__reactListeners$"+Va,Ms="__reactHandles$"+Va,Ga="__reactResources$"+Va,wn="__reactMarker$"+Va;function ls(r){delete r[di],delete r[Ut],delete r[Mn],delete r[yr],delete r[Ms]}function pi(r){var s=r[di];if(s)return s;for(var d=r.parentNode;d;){if(s=d[Sn]||d[di]){if(d=s.alternate,s.child!==null||d!==null&&d.child!==null)for(r=dh(r);r!==null;){if(d=r[di])return d;r=dh(r)}return s}r=d,d=r.parentNode}return null}function Zs(r){if(r=r[di]||r[Sn]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function Cs(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(I(33))}function ka(r){var s=r[Ga];return s||(s=r[Ga]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function Ti(r){r[wn]=!0}var ho=new Set,Er={};function Vn(r,s){Ys(r,s),Ys(r+"Capture",s)}function Ys(r,s){for(Er[r]=s,r=0;r<s.length;r++)ho.add(s[r])}var $r=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),us={},Is={};function Wr(r){return Yt.call(Is,r)?!0:Yt.call(us,r)?!1:$r.test(r)?Is[r]=!0:(us[r]=!0,!1)}function Zo(r,s,d){if(Wr(s))if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var x=s.toLowerCase().slice(0,5);if(x!=="data-"&&x!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+d)}}function As(r,s,d){if(d===null)r.removeAttribute(s);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+d)}}function qa(r,s,d,x){if(x===null)r.removeAttribute(d);else{switch(typeof x){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(d);return}r.setAttributeNS(s,d,""+x)}}function $n(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Yu(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Dc(r,s,d){var x=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof x<"u"&&typeof x.get=="function"&&typeof x.set=="function"){var A=x.get,O=x.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return A.call(this)},set:function(W){d=""+W,O.call(this,W)}}),Object.defineProperty(r,s,{enumerable:x.enumerable}),{getValue:function(){return d},setValue:function(W){d=""+W},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function ks(r){if(!r._valueTracker){var s=Yu(r)?"checked":"value";r._valueTracker=Dc(r,s,""+r[s])}}function cs(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var d=s.getValue(),x="";return r&&(x=Yu(r)?r.checked?"true":"false":r.value),r=x,r!==d?(s.setValue(r),!0):!1}function Za(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Lc=/[\n"\\]/g;function cr(r){return r.replace(Lc,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function nu(r,s,d,x,A,O,W,ce){r.name="",W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?r.type=W:r.removeAttribute("type"),s!=null?W==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+$n(s)):r.value!==""+$n(s)&&(r.value=""+$n(s)):W!=="submit"&&W!=="reset"||r.removeAttribute("value"),s!=null?iu(r,W,$n(s)):d!=null?iu(r,W,$n(d)):x!=null&&r.removeAttribute("value"),A==null&&O!=null&&(r.defaultChecked=!!O),A!=null&&(r.checked=A&&typeof A!="function"&&typeof A!="symbol"),ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?r.name=""+$n(ce):r.removeAttribute("name")}function Hu(r,s,d,x,A,O,W,ce){if(O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"&&(r.type=O),s!=null||d!=null){if(!(O!=="submit"&&O!=="reset"||s!=null)){ks(r);return}d=d!=null?""+$n(d):"",s=s!=null?""+$n(s):d,ce||s===r.value||(r.value=s),r.defaultValue=s}x=x??A,x=typeof x!="function"&&typeof x!="symbol"&&!!x,r.checked=ce?r.checked:!!x,r.defaultChecked=!!x,W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"&&(r.name=W),ks(r)}function iu(r,s,d){s==="number"&&Za(r.ownerDocument)===r||r.defaultValue===""+d||(r.defaultValue=""+d)}function fo(r,s,d,x){if(r=r.options,s){s={};for(var A=0;A<d.length;A++)s["$"+d[A]]=!0;for(d=0;d<r.length;d++)A=s.hasOwnProperty("$"+r[d].value),r[d].selected!==A&&(r[d].selected=A),A&&x&&(r[d].defaultSelected=!0)}else{for(d=""+$n(d),s=null,A=0;A<r.length;A++){if(r[A].value===d){r[A].selected=!0,x&&(r[A].defaultSelected=!0);return}s!==null||r[A].disabled||(s=r[A])}s!==null&&(s.selected=!0)}}function zc(r,s,d){if(s!=null&&(s=""+$n(s),s!==r.value&&(r.value=s),d==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=d!=null?""+$n(d):""}function Ps(r,s,d,x){if(s==null){if(x!=null){if(d!=null)throw Error(I(92));if(Le(x)){if(1<x.length)throw Error(I(93));x=x[0]}d=x}d==null&&(d=""),s=d}d=$n(s),r.defaultValue=d,x=r.textContent,x===d&&x!==""&&x!==null&&(r.value=x),ks(r)}function Rs(r,s){if(s){var d=r.firstChild;if(d&&d===r.lastChild&&d.nodeType===3){d.nodeValue=s;return}}r.textContent=s}var Eh=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function po(r,s,d){var x=s.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?x?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":x?r.setProperty(s,d):typeof d!="number"||d===0||Eh.has(s)?s==="float"?r.cssFloat=d:r[s]=(""+d).trim():r[s]=d+"px"}function Xu(r,s,d){if(s!=null&&typeof s!="object")throw Error(I(62));if(r=r.style,d!=null){for(var x in d)!d.hasOwnProperty(x)||s!=null&&s.hasOwnProperty(x)||(x.indexOf("--")===0?r.setProperty(x,""):x==="float"?r.cssFloat="":r[x]="");for(var A in s)x=s[A],s.hasOwnProperty(A)&&d[A]!==x&&po(r,A,x)}else for(var O in s)s.hasOwnProperty(O)&&po(r,O,s[O])}function Hs(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ri=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Ya=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function An(r){return Ya.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Pa(){}var ya=null;function Kr(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var $i=null,ir=null;function Di(r){var s=Zs(r);if(s&&(r=s.stateNode)){var d=r[Ut]||null;e:switch(r=s.stateNode,s.type){case"input":if(nu(r,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),s=d.name,d.type==="radio"&&s!=null){for(d=r;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+cr(""+s)+'"][type="radio"]'),s=0;s<d.length;s++){var x=d[s];if(x!==r&&x.form===r.form){var A=x[Ut]||null;if(!A)throw Error(I(90));nu(x,A.value,A.defaultValue,A.defaultValue,A.checked,A.defaultChecked,A.type,A.name)}}for(s=0;s<d.length;s++)x=d[s],x.form===r.form&&cs(x)}break e;case"textarea":zc(r,d.value,d.defaultValue);break e;case"select":s=d.value,s!=null&&fo(r,!!d.multiple,s,!1)}}}var vn=!1;function ei(r,s,d){if(vn)return r(s,d);vn=!0;try{var x=r(s);return x}finally{if(vn=!1,($i!==null||ir!==null)&&(nd(),$i&&(s=$i,r=ir,ir=$i=null,Di(s),r)))for(s=0;s<r.length;s++)Di(r[s])}}function Ha(r,s){var d=r.stateNode;if(d===null)return null;var x=d[Ut]||null;if(x===null)return null;d=x[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(r=r.type,x=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!x;break e;default:r=!1}if(r)return null;if(d&&typeof d!="function")throw Error(I(231,s,typeof d));return d}var Ni=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),kn=!1;if(Ni)try{var mi={};Object.defineProperty(mi,"passive",{get:function(){kn=!0}}),window.addEventListener("test",mi,mi),window.removeEventListener("test",mi,mi)}catch{kn=!1}var ca=null,hs=null,ci=null;function Xs(){if(ci)return ci;var r,s=hs,d=s.length,x,A="value"in ca?ca.value:ca.textContent,O=A.length;for(r=0;r<d&&s[r]===A[r];r++);var W=d-r;for(x=1;x<=W&&s[d-x]===A[O-x];x++);return ci=A.slice(r,1<x?1-x:void 0)}function Si(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function mo(){return!0}function Br(){return!1}function rr(r){function s(d,x,A,O,W){this._reactName=d,this._targetInst=A,this.type=x,this.nativeEvent=O,this.target=W,this.currentTarget=null;for(var ce in r)r.hasOwnProperty(ce)&&(d=r[ce],this[ce]=d?d(O):O[ce]);return this.isDefaultPrevented=(O.defaultPrevented!=null?O.defaultPrevented:O.returnValue===!1)?mo:Br,this.isPropagationStopped=Br,this}return ie(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=mo)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=mo)},persist:function(){},isPersistent:mo}),s}var Qr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ru=rr(Qr),go=ie({},Qr,{view:0,detail:0}),ha=rr(go),Qn,_o,Tn,bn=ie({},go,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ur,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==Tn&&(Tn&&r.type==="mousemove"?(Qn=r.screenX-Tn.screenX,_o=r.screenY-Tn.screenY):_o=Qn=0,Tn=r),Qn)},movementY:function(r){return"movementY"in r?r.movementY:_o}}),Yo=rr(bn),On=ie({},bn,{dataTransfer:0}),Tl=rr(On),Fr=ie({},go,{relatedTarget:0}),yo=rr(Fr),jr=ie({},Qr,{animationName:0,elapsedTime:0,pseudoElement:0}),Oc=rr(jr),au=ie({},Qr,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Nc=rr(au),If=ie({},Qr,{data:0}),Bc=rr(If),fa={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ds={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Li={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ra(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=Li[r])?!!s[r]:!1}function Ur(){return Ra}var su=ie({},go,{key:function(r){if(r.key){var s=fa[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=Si(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?Ds[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ur,charCode:function(r){return r.type==="keypress"?Si(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?Si(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Bi=rr(su),Mh=ie({},bn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sl=rr(Mh),Fc=ie({},go,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ur}),jc=rr(Fc),Ho=ie({},Qr,{propertyName:0,elapsedTime:0,pseudoElement:0}),va=rr(Ho),Xo=ie({},bn,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),da=rr(Xo),$s=ie({},Qr,{newState:0,oldState:0}),El=rr($s),$o=[9,13,27,32],Ui=Ni&&"CompositionEvent"in window,Wo=null;Ni&&"documentMode"in document&&(Wo=document.documentMode);var vo=Ni&&"TextEvent"in window&&!Wo,Ml=Ni&&(!Ui||Wo&&8<Wo&&11>=Wo),xo=" ",Ch=!1;function ou(r,s){switch(r){case"keyup":return $o.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ih(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var fs=!1;function $u(r,s){switch(r){case"compositionend":return Ih(s);case"keypress":return s.which!==32?null:(Ch=!0,xo);case"textInput":return r=s.data,r===xo&&Ch?null:r;default:return null}}function Ah(r,s){if(fs)return r==="compositionend"||!Ui&&ou(r,s)?(r=Xs(),ci=hs=ca=null,fs=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Ml&&s.locale!=="ko"?null:s.data;default:return null}}var Uc={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Wu(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!Uc[r.type]:s==="textarea"}function lu(r,s,d,x){$i?ir?ir.push(x):ir=[x]:$i=x,s=ud(s,"onChange"),0<s.length&&(d=new ru("onChange","change",null,d,x),r.push({event:d,listeners:s}))}var Ko=null,Cl=null;function kh(r){wg(r,0)}function uu(r){var s=Cs(r);if(cs(s))return r}function bo(r,s){if(r==="change")return s}var Vc=!1;if(Ni){var cu;if(Ni){var Ws="oninput"in document;if(!Ws){var Ku=document.createElement("div");Ku.setAttribute("oninput","return;"),Ws=typeof Ku.oninput=="function"}cu=Ws}else cu=!1;Vc=cu&&(!document.documentMode||9<document.documentMode)}function Il(){Ko&&(Ko.detachEvent("onpropertychange",Ph),Cl=Ko=null)}function Ph(r){if(r.propertyName==="value"&&uu(Cl)){var s=[];lu(s,Cl,r,Kr(r)),ei(kh,s)}}function Rh(r,s,d){r==="focusin"?(Il(),Ko=s,Cl=d,Ko.attachEvent("onpropertychange",Ph)):r==="focusout"&&Il()}function Qu(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return uu(Cl)}function hu(r,s){if(r==="click")return uu(s)}function Gc(r,s){if(r==="input"||r==="change")return uu(s)}function Ju(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var xa=typeof Object.is=="function"?Object.is:Ju;function wo(r,s){if(xa(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var d=Object.keys(r),x=Object.keys(s);if(d.length!==x.length)return!1;for(x=0;x<d.length;x++){var A=d[x];if(!Yt.call(s,A)||!xa(r[A],s[A]))return!1}return!0}function Vr(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function fu(r,s){var d=Vr(r);r=0;for(var x;d;){if(d.nodeType===3){if(x=r+d.textContent.length,r<=s&&x>=s)return{node:d,offset:s-r};r=x}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Vr(d)}}function du(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?du(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function pa(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=Za(r.document);s instanceof r.HTMLIFrameElement;){try{var d=typeof s.contentWindow.location.href=="string"}catch{d=!1}if(d)r=s.contentWindow;else break;s=Za(r.document)}return s}function ba(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var _=Ni&&"documentMode"in document&&11>=document.documentMode,o=null,u=null,g=null,M=!1;function B(r,s,d){var x=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;M||o==null||o!==Za(x)||(x=o,"selectionStart"in x&&ba(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),g&&wo(g,x)||(g=x,x=ud(u,"onSelect"),0<x.length&&(s=new ru("onSelect","select",null,s,d),r.push({event:s,listeners:x}),s.target=o)))}function G(r,s){var d={};return d[r.toLowerCase()]=s.toLowerCase(),d["Webkit"+r]="webkit"+s,d["Moz"+r]="moz"+s,d}var K={animationend:G("Animation","AnimationEnd"),animationiteration:G("Animation","AnimationIteration"),animationstart:G("Animation","AnimationStart"),transitionrun:G("Transition","TransitionRun"),transitionstart:G("Transition","TransitionStart"),transitioncancel:G("Transition","TransitionCancel"),transitionend:G("Transition","TransitionEnd")},le={},_e={};Ni&&(_e=document.createElement("div").style,"AnimationEvent"in window||(delete K.animationend.animation,delete K.animationiteration.animation,delete K.animationstart.animation),"TransitionEvent"in window||delete K.transitionend.transition);function Ke(r){if(le[r])return le[r];if(!K[r])return r;var s=K[r],d;for(d in s)if(s.hasOwnProperty(d)&&d in _e)return le[r]=s[d];return r}var ct=Ke("animationend"),Bt=Ke("animationiteration"),Jt=Ke("animationstart"),sn=Ke("transitionrun"),pn=Ke("transitionstart"),Nn=Ke("transitioncancel"),In=Ke("transitionend"),hi=new Map,hr="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");hr.push("scrollEnd");function gi(r,s){hi.set(r,s),Vn(s,[r])}var Jr=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},vr=[],Ls=0,To=0;function So(){for(var r=Ls,s=To=Ls=0;s<r;){var d=vr[s];vr[s++]=null;var x=vr[s];vr[s++]=null;var A=vr[s];vr[s++]=null;var O=vr[s];if(vr[s++]=null,x!==null&&A!==null){var W=x.pending;W===null?A.next=A:(A.next=W.next,W.next=A),x.pending=A}O!==0&&pu(d,A,O)}}function Al(r,s,d,x){vr[Ls++]=r,vr[Ls++]=s,vr[Ls++]=d,vr[Ls++]=x,To|=x,r.lanes|=x,r=r.alternate,r!==null&&(r.lanes|=x)}function Ks(r,s,d,x){return Al(r,s,d,x),Eo(r)}function Da(r,s){return Al(r,null,null,s),Eo(r)}function pu(r,s,d){r.lanes|=d;var x=r.alternate;x!==null&&(x.lanes|=d);for(var A=!1,O=r.return;O!==null;)O.childLanes|=d,x=O.alternate,x!==null&&(x.childLanes|=d),O.tag===22&&(r=O.stateNode,r===null||r._visibility&1||(A=!0)),r=O,O=O.return;return r.tag===3?(O=r.stateNode,A&&s!==null&&(A=31-St(d),r=O.hiddenUpdates,x=r[A],x===null?r[A]=[s]:x.push(s),s.lane=d|536870912),O):null}function Eo(r){if(50<td)throw td=0,im=null,Error(I(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var Ln={};function Dh(r,s,d,x){this.tag=r,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ds(r,s,d,x){return new Dh(r,s,d,x)}function Lh(r){return r=r.prototype,!(!r||!r.isReactComponent)}function ps(r,s){var d=r.alternate;return d===null?(d=ds(r.tag,s,r.key,r.mode),d.elementType=r.elementType,d.type=r.type,d.stateNode=r.stateNode,d.alternate=r,r.alternate=d):(d.pendingProps=s,d.type=r.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=r.flags&65011712,d.childLanes=r.childLanes,d.lanes=r.lanes,d.child=r.child,d.memoizedProps=r.memoizedProps,d.memoizedState=r.memoizedState,d.updateQueue=r.updateQueue,s=r.dependencies,d.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},d.sibling=r.sibling,d.index=r.index,d.ref=r.ref,d.refCleanup=r.refCleanup,d}function Pd(r,s){r.flags&=65011714;var d=r.alternate;return d===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=d.childLanes,r.lanes=d.lanes,r.child=d.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=d.memoizedProps,r.memoizedState=d.memoizedState,r.updateQueue=d.updateQueue,r.type=d.type,s=d.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function zh(r,s,d,x,A,O){var W=0;if(x=r,typeof r=="function")Lh(r)&&(W=1);else if(typeof r=="string")W=wm(r,d,Ct.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case de:return r=ds(31,d,s,A),r.elementType=de,r.lanes=O,r;case dt:return kl(d.children,A,O,s);case Ce:W=8,A|=24;break;case It:return r=ds(12,d,s,A|2),r.elementType=It,r.lanes=O,r;case At:return r=ds(13,d,s,A),r.elementType=At,r.lanes=O,r;case Vt:return r=ds(19,d,s,A),r.elementType=Vt,r.lanes=O,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case at:W=10;break e;case Ye:W=9;break e;case jt:W=11;break e;case wt:W=14;break e;case oe:W=16,x=null;break e}W=29,d=Error(I(130,r===null?"null":typeof r,"")),x=null}return s=ds(W,d,s,A),s.elementType=r,s.type=x,s.lanes=O,s}function kl(r,s,d,x){return r=ds(7,r,x,s),r.lanes=d,r}function Af(r,s,d){return r=ds(6,r,null,s),r.lanes=d,r}function Oh(r){var s=ds(18,null,null,0);return s.stateNode=r,s}function Pl(r,s,d){return s=ds(4,r.children!==null?r.children:[],r.key,s),s.lanes=d,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var qc=new WeakMap;function La(r,s){if(typeof r=="object"&&r!==null){var d=qc.get(r);return d!==void 0?d:(s={value:r,source:s,stack:Gs(s)},qc.set(r,s),s)}return{value:r,source:s,stack:Gs(s)}}var Rl=[],Dl=0,mu=null,Ll=0,ea=[],ta=0,Mo=null,Co=1,Xa="";function Qo(r,s){Rl[Dl++]=Ll,Rl[Dl++]=mu,mu=r,Ll=s}function kf(r,s,d){ea[ta++]=Co,ea[ta++]=Xa,ea[ta++]=Mo,Mo=r;var x=Co;r=Xa;var A=32-St(x)-1;x&=~(1<<A),d+=1;var O=32-St(s)+A;if(30<O){var W=A-A%5;O=(x&(1<<W)-1).toString(32),x>>=W,A-=W,Co=1<<32-St(s)+A|d<<A|x,Xa=O+r}else Co=1<<O|d<<A|x,Xa=r}function gu(r){r.return!==null&&(Qo(r,1),kf(r,1,0))}function ec(r){for(;r===mu;)mu=Rl[--Dl],Rl[Dl]=null,Ll=Rl[--Dl],Rl[Dl]=null;for(;r===Mo;)Mo=ea[--ta],ea[ta]=null,Xa=ea[--ta],ea[ta]=null,Co=ea[--ta],ea[ta]=null}function Pf(r,s){ea[ta++]=Co,ea[ta++]=Xa,ea[ta++]=Mo,Co=s.id,Xa=s.overflow,Mo=r}var na=null,Ei=null,Zn=!1,Jo=null,ms=!1,Wi=Error(I(519));function $a(r){var s=Error(I(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw el(La(s,r)),Wi}function gs(r){var s=r.stateNode,d=r.type,x=r.memoizedProps;switch(s[di]=r,s[Ut]=x,d){case"dialog":Jn("cancel",s),Jn("close",s);break;case"iframe":case"object":case"embed":Jn("load",s);break;case"video":case"audio":for(d=0;d<od.length;d++)Jn(od[d],s);break;case"source":Jn("error",s);break;case"img":case"image":case"link":Jn("error",s),Jn("load",s);break;case"details":Jn("toggle",s);break;case"input":Jn("invalid",s),Hu(s,x.value,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name,!0);break;case"select":Jn("invalid",s);break;case"textarea":Jn("invalid",s),Ps(s,x.value,x.defaultValue,x.children)}d=x.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||s.textContent===""+d||x.suppressHydrationWarning===!0||np(s.textContent,d)?(x.popover!=null&&(Jn("beforetoggle",s),Jn("toggle",s)),x.onScroll!=null&&Jn("scroll",s),x.onScrollEnd!=null&&Jn("scrollend",s),x.onClick!=null&&(s.onclick=Pa),s=!0):s=!1,s||$a(r,!0)}function Zc(r){for(na=r.return;na;)switch(na.tag){case 5:case 31:case 13:ms=!1;return;case 27:case 3:ms=!0;return;default:na=na.return}}function Io(r){if(r!==na)return!1;if(!Zn)return Zc(r),Zn=!0,!1;var s=r.tag,d;if((d=s!==3&&s!==27)&&((d=s===5)&&(d=r.type,d=!(d!=="form"&&d!=="button")||pd(r.type,r.memoizedProps)),d=!d),d&&Ei&&$a(r),Zc(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(I(317));Ei=bc(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(I(317));Ei=bc(r)}else s===27?(s=Ei,or(r.type)?(r=up,up=null,Ei=r):Ei=s):Ei=na?Fo(r.stateNode.nextSibling):null;return!0}function Ao(){Ei=na=null,Zn=!1}function ko(){var r=Jo;return r!==null&&(Fs===null?Fs=r:Fs.push.apply(Fs,r),Jo=null),r}function el(r){Jo===null?Jo=[r]:Jo.push(r)}var tl=Me(null),zs=null,Po=null;function nl(r,s,d){Ot(tl,s._currentValue),s._currentValue=d}function Ro(r){r._currentValue=tl.current,ut(tl)}function Nh(r,s,d){for(;r!==null;){var x=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,x!==null&&(x.childLanes|=s)):x!==null&&(x.childLanes&s)!==s&&(x.childLanes|=s),r===d)break;r=r.return}}function Bh(r,s,d,x){var A=r.child;for(A!==null&&(A.return=r);A!==null;){var O=A.dependencies;if(O!==null){var W=A.child;O=O.firstContext;e:for(;O!==null;){var ce=O;O=A;for(var Ve=0;Ve<s.length;Ve++)if(ce.context===s[Ve]){O.lanes|=d,ce=O.alternate,ce!==null&&(ce.lanes|=d),Nh(O.return,d,r),x||(W=null);break e}O=ce.next}}else if(A.tag===18){if(W=A.return,W===null)throw Error(I(341));W.lanes|=d,O=W.alternate,O!==null&&(O.lanes|=d),Nh(W,d,r),W=null}else W=A.child;if(W!==null)W.return=A;else for(W=A;W!==null;){if(W===r){W=null;break}if(A=W.sibling,A!==null){A.return=W.return,W=A;break}W=W.return}A=W}}function Os(r,s,d,x){r=null;for(var A=s,O=!1;A!==null;){if(!O){if((A.flags&524288)!==0)O=!0;else if((A.flags&262144)!==0)break}if(A.tag===10){var W=A.alternate;if(W===null)throw Error(I(387));if(W=W.memoizedProps,W!==null){var ce=A.type;xa(A.pendingProps.value,W.value)||(r!==null?r.push(ce):r=[ce])}}else if(A===_n.current){if(W=A.alternate,W===null)throw Error(I(387));W.memoizedState.memoizedState!==A.memoizedState.memoizedState&&(r!==null?r.push(yd):r=[yd])}A=A.return}r!==null&&Bh(s,r,d,x),s.flags|=262144}function tc(r){for(r=r.firstContext;r!==null;){if(!xa(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function il(r){zs=r,Po=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function xr(r){return Fh(zs,r)}function Yc(r,s){return zs===null&&il(r),Fh(r,s)}function Fh(r,s){var d=s._currentValue;if(s={context:s,memoizedValue:d,next:null},Po===null){if(r===null)throw Error(I(308));Po=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Po=Po.next=s;return d}var Rf=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(d,x){r.push(x)}};this.abort=function(){s.aborted=!0,r.forEach(function(d){return d()})}},Rd=S.unstable_scheduleCallback,Df=S.unstable_NormalPriority,Ki={$$typeof:at,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zl(){return{controller:new Rf,data:new Map,refCount:0}}function wa(r){r.refCount--,r.refCount===0&&Rd(Df,function(){r.controller.abort()})}var za=null,jh=0,Ta=0,nc=null;function ic(r,s){if(za===null){var d=za=[];jh=0,Ta=vc(),nc={status:"pending",value:void 0,then:function(x){d.push(x)}}}return jh++,s.then(rc,rc),s}function rc(){if(--jh===0&&za!==null){nc!==null&&(nc.status="fulfilled");var r=za;za=null,Ta=0,nc=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function Hc(r,s){var d=[],x={status:"pending",value:null,reason:null,then:function(A){d.push(A)}};return r.then(function(){x.status="fulfilled",x.value=s;for(var A=0;A<d.length;A++)(0,d[A])(s)},function(A){for(x.status="rejected",x.reason=A,A=0;A<d.length;A++)(0,d[A])(void 0)}),x}var Wa=me.S;me.S=function(r,s){Jp=dn(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&ic(r,s),Wa!==null&&Wa(r,s)};var Qs=Me(null);function Xc(){var r=Qs.current;return r!==null?r:Zi.pooledCache}function Ol(r,s){s===null?Ot(Qs,Qs.current):Ot(Qs,s.pool)}function Do(){var r=Xc();return r===null?null:{parent:Ki._currentValue,pool:r}}var Xt=Error(I(460)),$c=Error(I(474)),Nl=Error(I(542)),Wc={then:function(){}};function Bl(r){return r=r.status,r==="fulfilled"||r==="rejected"}function ac(r,s,d){switch(d=r[d],d===void 0?r.push(s):d!==s&&(s.then(Pa,Pa),s=d),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Lf(r),r;default:if(typeof s.status=="string")s.then(Pa,Pa);else{if(r=Zi,r!==null&&100<r.shellSuspendCounter)throw Error(I(482));r=s,r.status="pending",r.then(function(x){if(s.status==="pending"){var A=s;A.status="fulfilled",A.value=x}},function(x){if(s.status==="pending"){var A=s;A.status="rejected",A.reason=x}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,Lf(r),r}throw _u=s,Xt}}function _s(r){try{var s=r._init;return s(r._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(_u=d,Xt):d}}var _u=null;function Uh(){if(_u===null)throw Error(I(459));var r=_u;return _u=null,r}function Lf(r){if(r===Xt||r===Nl)throw Error(I(483))}var Ns=null,Kc=0;function Qc(r){var s=Kc;return Kc+=1,Ns===null&&(Ns=[]),ac(Ns,r,s)}function Fl(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function Vh(r,s){throw s.$$typeof===xe?Error(I(525)):(r=Object.prototype.toString.call(s),Error(I(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function Jc(r){function s(rt,We){if(r){var gt=rt.deletions;gt===null?(rt.deletions=[We],rt.flags|=16):gt.push(We)}}function d(rt,We){if(!r)return null;for(;We!==null;)s(rt,We),We=We.sibling;return null}function x(rt){for(var We=new Map;rt!==null;)rt.key!==null?We.set(rt.key,rt):We.set(rt.index,rt),rt=rt.sibling;return We}function A(rt,We){return rt=ps(rt,We),rt.index=0,rt.sibling=null,rt}function O(rt,We,gt){return rt.index=gt,r?(gt=rt.alternate,gt!==null?(gt=gt.index,gt<We?(rt.flags|=67108866,We):gt):(rt.flags|=67108866,We)):(rt.flags|=1048576,We)}function W(rt){return r&&rt.alternate===null&&(rt.flags|=67108866),rt}function ce(rt,We,gt,Rt){return We===null||We.tag!==6?(We=Af(gt,rt.mode,Rt),We.return=rt,We):(We=A(We,gt),We.return=rt,We)}function Ve(rt,We,gt,Rt){var ln=gt.type;return ln===dt?kt(rt,We,gt.props.children,Rt,gt.key):We!==null&&(We.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===oe&&_s(ln)===We.type)?(We=A(We,gt.props),Fl(We,gt),We.return=rt,We):(We=zh(gt.type,gt.key,gt.props,null,rt.mode,Rt),Fl(We,gt),We.return=rt,We)}function _t(rt,We,gt,Rt){return We===null||We.tag!==4||We.stateNode.containerInfo!==gt.containerInfo||We.stateNode.implementation!==gt.implementation?(We=Pl(gt,rt.mode,Rt),We.return=rt,We):(We=A(We,gt.children||[]),We.return=rt,We)}function kt(rt,We,gt,Rt,ln){return We===null||We.tag!==7?(We=kl(gt,rt.mode,Rt,ln),We.return=rt,We):(We=A(We,gt),We.return=rt,We)}function Ft(rt,We,gt){if(typeof We=="string"&&We!==""||typeof We=="number"||typeof We=="bigint")return We=Af(""+We,rt.mode,gt),We.return=rt,We;if(typeof We=="object"&&We!==null){switch(We.$$typeof){case Be:return gt=zh(We.type,We.key,We.props,null,rt.mode,gt),Fl(gt,We),gt.return=rt,gt;case Ge:return We=Pl(We,rt.mode,gt),We.return=rt,We;case oe:return We=_s(We),Ft(rt,We,gt)}if(Le(We)||Ne(We))return We=kl(We,rt.mode,gt,null),We.return=rt,We;if(typeof We.then=="function")return Ft(rt,Qc(We),gt);if(We.$$typeof===at)return Ft(rt,Yc(rt,We),gt);Vh(rt,We)}return null}function yt(rt,We,gt,Rt){var ln=We!==null?We.key:null;if(typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint")return ln!==null?null:ce(rt,We,""+gt,Rt);if(typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case Be:return gt.key===ln?Ve(rt,We,gt,Rt):null;case Ge:return gt.key===ln?_t(rt,We,gt,Rt):null;case oe:return gt=_s(gt),yt(rt,We,gt,Rt)}if(Le(gt)||Ne(gt))return ln!==null?null:kt(rt,We,gt,Rt,null);if(typeof gt.then=="function")return yt(rt,We,Qc(gt),Rt);if(gt.$$typeof===at)return yt(rt,We,Yc(rt,gt),Rt);Vh(rt,gt)}return null}function bt(rt,We,gt,Rt,ln){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint")return rt=rt.get(gt)||null,ce(We,rt,""+Rt,ln);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case Be:return rt=rt.get(Rt.key===null?gt:Rt.key)||null,Ve(We,rt,Rt,ln);case Ge:return rt=rt.get(Rt.key===null?gt:Rt.key)||null,_t(We,rt,Rt,ln);case oe:return Rt=_s(Rt),bt(rt,We,gt,Rt,ln)}if(Le(Rt)||Ne(Rt))return rt=rt.get(gt)||null,kt(We,rt,Rt,ln,null);if(typeof Rt.then=="function")return bt(rt,We,gt,Qc(Rt),ln);if(Rt.$$typeof===at)return bt(rt,We,gt,Yc(We,Rt),ln);Vh(We,Rt)}return null}function un(rt,We,gt,Rt){for(var ln=null,ui=null,gn=We,Fn=We=0,Wn=null;gn!==null&&Fn<gt.length;Fn++){gn.index>Fn?(Wn=gn,gn=null):Wn=gn.sibling;var bi=yt(rt,gn,gt[Fn],Rt);if(bi===null){gn===null&&(gn=Wn);break}r&&gn&&bi.alternate===null&&s(rt,gn),We=O(bi,We,Fn),ui===null?ln=bi:ui.sibling=bi,ui=bi,gn=Wn}if(Fn===gt.length)return d(rt,gn),Zn&&Qo(rt,Fn),ln;if(gn===null){for(;Fn<gt.length;Fn++)gn=Ft(rt,gt[Fn],Rt),gn!==null&&(We=O(gn,We,Fn),ui===null?ln=gn:ui.sibling=gn,ui=gn);return Zn&&Qo(rt,Fn),ln}for(gn=x(gn);Fn<gt.length;Fn++)Wn=bt(gn,rt,Fn,gt[Fn],Rt),Wn!==null&&(r&&Wn.alternate!==null&&gn.delete(Wn.key===null?Fn:Wn.key),We=O(Wn,We,Fn),ui===null?ln=Wn:ui.sibling=Wn,ui=Wn);return r&&gn.forEach(function(Bu){return s(rt,Bu)}),Zn&&Qo(rt,Fn),ln}function En(rt,We,gt,Rt){if(gt==null)throw Error(I(151));for(var ln=null,ui=null,gn=We,Fn=We=0,Wn=null,bi=gt.next();gn!==null&&!bi.done;Fn++,bi=gt.next()){gn.index>Fn?(Wn=gn,gn=null):Wn=gn.sibling;var Bu=yt(rt,gn,bi.value,Rt);if(Bu===null){gn===null&&(gn=Wn);break}r&&gn&&Bu.alternate===null&&s(rt,gn),We=O(Bu,We,Fn),ui===null?ln=Bu:ui.sibling=Bu,ui=Bu,gn=Wn}if(bi.done)return d(rt,gn),Zn&&Qo(rt,Fn),ln;if(gn===null){for(;!bi.done;Fn++,bi=gt.next())bi=Ft(rt,bi.value,Rt),bi!==null&&(We=O(bi,We,Fn),ui===null?ln=bi:ui.sibling=bi,ui=bi);return Zn&&Qo(rt,Fn),ln}for(gn=x(gn);!bi.done;Fn++,bi=gt.next())bi=bt(gn,rt,Fn,bi.value,Rt),bi!==null&&(r&&bi.alternate!==null&&gn.delete(bi.key===null?Fn:bi.key),We=O(bi,We,Fn),ui===null?ln=bi:ui.sibling=bi,ui=bi);return r&&gn.forEach(function(qg){return s(rt,qg)}),Zn&&Qo(rt,Fn),ln}function Ai(rt,We,gt,Rt){if(typeof gt=="object"&&gt!==null&&gt.type===dt&&gt.key===null&&(gt=gt.props.children),typeof gt=="object"&&gt!==null){switch(gt.$$typeof){case Be:e:{for(var ln=gt.key;We!==null;){if(We.key===ln){if(ln=gt.type,ln===dt){if(We.tag===7){d(rt,We.sibling),Rt=A(We,gt.props.children),Rt.return=rt,rt=Rt;break e}}else if(We.elementType===ln||typeof ln=="object"&&ln!==null&&ln.$$typeof===oe&&_s(ln)===We.type){d(rt,We.sibling),Rt=A(We,gt.props),Fl(Rt,gt),Rt.return=rt,rt=Rt;break e}d(rt,We);break}else s(rt,We);We=We.sibling}gt.type===dt?(Rt=kl(gt.props.children,rt.mode,Rt,gt.key),Rt.return=rt,rt=Rt):(Rt=zh(gt.type,gt.key,gt.props,null,rt.mode,Rt),Fl(Rt,gt),Rt.return=rt,rt=Rt)}return W(rt);case Ge:e:{for(ln=gt.key;We!==null;){if(We.key===ln)if(We.tag===4&&We.stateNode.containerInfo===gt.containerInfo&&We.stateNode.implementation===gt.implementation){d(rt,We.sibling),Rt=A(We,gt.children||[]),Rt.return=rt,rt=Rt;break e}else{d(rt,We);break}else s(rt,We);We=We.sibling}Rt=Pl(gt,rt.mode,Rt),Rt.return=rt,rt=Rt}return W(rt);case oe:return gt=_s(gt),Ai(rt,We,gt,Rt)}if(Le(gt))return un(rt,We,gt,Rt);if(Ne(gt)){if(ln=Ne(gt),typeof ln!="function")throw Error(I(150));return gt=ln.call(gt),En(rt,We,gt,Rt)}if(typeof gt.then=="function")return Ai(rt,We,Qc(gt),Rt);if(gt.$$typeof===at)return Ai(rt,We,Yc(rt,gt),Rt);Vh(rt,gt)}return typeof gt=="string"&&gt!==""||typeof gt=="number"||typeof gt=="bigint"?(gt=""+gt,We!==null&&We.tag===6?(d(rt,We.sibling),Rt=A(We,gt),Rt.return=rt,rt=Rt):(d(rt,We),Rt=Af(gt,rt.mode,Rt),Rt.return=rt,rt=Rt),W(rt)):d(rt,We)}return function(rt,We,gt,Rt){try{Kc=0;var ln=Ai(rt,We,gt,Rt);return Ns=null,ln}catch(gn){if(gn===Xt||gn===Nl)throw gn;var ui=ds(29,gn,null,rt.mode);return ui.lanes=Rt,ui.return=rt,ui}finally{}}}var Lo=Jc(!0),Gh=Jc(!1),rl=!1;function qh(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Js(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function Hn(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function al(r,s,d){var x=r.updateQueue;if(x===null)return null;if(x=x.shared,(yi&2)!==0){var A=x.pending;return A===null?s.next=s:(s.next=A.next,A.next=s),x.pending=s,s=Eo(r),pu(r,null,d),s}return Al(r,x,s,d),Eo(r)}function jl(r,s,d){if(s=s.updateQueue,s!==null&&(s=s.shared,(d&4194048)!==0)){var x=s.lanes;x&=r.pendingLanes,d|=x,s.lanes=d,ji(r,d)}}function yu(r,s){var d=r.updateQueue,x=r.alternate;if(x!==null&&(x=x.updateQueue,d===x)){var A=null,O=null;if(d=d.firstBaseUpdate,d!==null){do{var W={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};O===null?A=O=W:O=O.next=W,d=d.next}while(d!==null);O===null?A=O=s:O=O.next=s}else A=O=s;d={baseState:x.baseState,firstBaseUpdate:A,lastBaseUpdate:O,shared:x.shared,callbacks:x.callbacks},r.updateQueue=d;return}r=d.lastBaseUpdate,r===null?d.firstBaseUpdate=s:r.next=s,d.lastBaseUpdate=s}var eh=!1;function vu(){if(eh){var r=nc;if(r!==null)throw r}}function sc(r,s,d,x){eh=!1;var A=r.updateQueue;rl=!1;var O=A.firstBaseUpdate,W=A.lastBaseUpdate,ce=A.shared.pending;if(ce!==null){A.shared.pending=null;var Ve=ce,_t=Ve.next;Ve.next=null,W===null?O=_t:W.next=_t,W=Ve;var kt=r.alternate;kt!==null&&(kt=kt.updateQueue,ce=kt.lastBaseUpdate,ce!==W&&(ce===null?kt.firstBaseUpdate=_t:ce.next=_t,kt.lastBaseUpdate=Ve))}if(O!==null){var Ft=A.baseState;W=0,kt=_t=Ve=null,ce=O;do{var yt=ce.lane&-536870913,bt=yt!==ce.lane;if(bt?(Yn&yt)===yt:(x&yt)===yt){yt!==0&&yt===Ta&&(eh=!0),kt!==null&&(kt=kt.next={lane:0,tag:ce.tag,payload:ce.payload,callback:null,next:null});e:{var un=r,En=ce;yt=s;var Ai=d;switch(En.tag){case 1:if(un=En.payload,typeof un=="function"){Ft=un.call(Ai,Ft,yt);break e}Ft=un;break e;case 3:un.flags=un.flags&-65537|128;case 0:if(un=En.payload,yt=typeof un=="function"?un.call(Ai,Ft,yt):un,yt==null)break e;Ft=ie({},Ft,yt);break e;case 2:rl=!0}}yt=ce.callback,yt!==null&&(r.flags|=64,bt&&(r.flags|=8192),bt=A.callbacks,bt===null?A.callbacks=[yt]:bt.push(yt))}else bt={lane:yt,tag:ce.tag,payload:ce.payload,callback:ce.callback,next:null},kt===null?(_t=kt=bt,Ve=Ft):kt=kt.next=bt,W|=yt;if(ce=ce.next,ce===null){if(ce=A.shared.pending,ce===null)break;bt=ce,ce=bt.next,bt.next=null,A.lastBaseUpdate=bt,A.shared.pending=null}}while(!0);kt===null&&(Ve=Ft),A.baseState=Ve,A.firstBaseUpdate=_t,A.lastBaseUpdate=kt,O===null&&(A.shared.lanes=0),No|=W,r.lanes=W,r.memoizedState=Ft}}function Zh(r,s){if(typeof r!="function")throw Error(I(191,r));r.call(s)}function zf(r,s){var d=r.callbacks;if(d!==null)for(r.callbacks=null,r=0;r<d.length;r++)Zh(d[r],s)}var Oa=Me(null),xu=Me(0);function on(r,s){r=Au,Ot(xu,r),Ot(Oa,s),Au=r|s.baseLanes}function mn(){Ot(xu,Au),Ot(Oa,Oa.current)}function Ul(){Au=xu.current,ut(Oa),ut(xu)}var Na=Me(null),ia=null;function fr(r){var s=r.alternate;Ot(dr,dr.current&1),Ot(Na,r),ia===null&&(s===null||Oa.current!==null||s.memoizedState!==null)&&(ia=r)}function Ba(r){Ot(dr,dr.current),Ot(Na,r),ia===null&&(ia=r)}function Of(r){r.tag===22?(Ot(dr,dr.current),Ot(Na,r),ia===null&&(ia=r)):Vl()}function Vl(){Ot(dr,dr.current),Ot(Na,Na.current)}function Ka(r){ut(Na),ia===r&&(ia=null),ut(dr)}var dr=Me(0);function sl(r){for(var s=r;s!==null;){if(s.tag===13){var d=s.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Ts(d)||qr(d)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var oi=0,fn=null,Mi=null,Qi=null,bu=!1,ys=!1,ol=!1,oc=0,ll=0,ul=null,Nf=0;function Ji(){throw Error(I(321))}function eo(r,s){if(s===null)return!1;for(var d=0;d<s.length&&d<r.length;d++)if(!xa(r[d],s[d]))return!1;return!0}function lc(r,s,d,x,A,O){return oi=O,fn=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,me.H=r===null||r.memoizedState===null?Ar:Fa,ol=!1,O=d(x,A),ol=!1,ys&&(O=th(s,d,x,A)),uc(r),O}function uc(r){me.H=tr;var s=Mi!==null&&Mi.next!==null;if(oi=0,Qi=Mi=fn=null,bu=!1,ll=0,ul=null,s)throw Error(I(300));r===null||kr||(r=r.dependencies,r!==null&&tc(r)&&(kr=!0))}function th(r,s,d,x){fn=r;var A=0;do{if(ys&&(ul=null),ll=0,ys=!1,25<=A)throw Error(I(301));if(A+=1,Qi=Mi=null,r.updateQueue!=null){var O=r.updateQueue;O.lastEffect=null,O.events=null,O.stores=null,O.memoCache!=null&&(O.memoCache.index=0)}me.H=Gi,O=s(d,x)}while(ys);return O}function nh(){var r=me.H,s=r.useState()[0];return s=typeof s.then=="function"?wu(s):s,r=r.useState()[0],(Mi!==null?Mi.memoizedState:null)!==r&&(fn.flags|=1024),s}function ih(){var r=oc!==0;return oc=0,r}function cl(r,s,d){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~d}function hl(r){if(bu){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}bu=!1}oi=0,Qi=Mi=fn=null,ys=!1,ll=oc=0,ul=null}function ma(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qi===null?fn.memoizedState=Qi=r:Qi=Qi.next=r,Qi}function Vi(){if(Mi===null){var r=fn.alternate;r=r!==null?r.memoizedState:null}else r=Mi.next;var s=Qi===null?fn.memoizedState:Qi.next;if(s!==null)Qi=s,Mi=r;else{if(r===null)throw fn.alternate===null?Error(I(467)):Error(I(310));Mi=r,r={memoizedState:Mi.memoizedState,baseState:Mi.baseState,baseQueue:Mi.baseQueue,queue:Mi.queue,next:null},Qi===null?fn.memoizedState=Qi=r:Qi=Qi.next=r}return Qi}function zo(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function wu(r){var s=ll;return ll+=1,ul===null&&(ul=[]),r=ac(ul,r,s),s=fn,(Qi===null?s.memoizedState:Qi.next)===null&&(s=s.alternate,me.H=s===null||s.memoizedState===null?Ar:Fa),r}function cc(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return wu(r);if(r.$$typeof===at)return xr(r)}throw Error(I(438,String(r)))}function hc(r){var s=null,d=fn.updateQueue;if(d!==null&&(s=d.memoCache),s==null){var x=fn.alternate;x!==null&&(x=x.updateQueue,x!==null&&(x=x.memoCache,x!=null&&(s={data:x.data.map(function(A){return A.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),d===null&&(d=zo(),fn.updateQueue=d),d.memoCache=s,d=s.data[s.index],d===void 0)for(d=s.data[s.index]=Array(r),x=0;x<r;x++)d[x]=Ie;return s.index++,d}function to(r,s){return typeof s=="function"?s(r):s}function v(r){var s=Vi();return t(s,Mi,r)}function t(r,s,d){var x=r.queue;if(x===null)throw Error(I(311));x.lastRenderedReducer=d;var A=r.baseQueue,O=x.pending;if(O!==null){if(A!==null){var W=A.next;A.next=O.next,O.next=W}s.baseQueue=A=O,x.pending=null}if(O=r.baseState,A===null)r.memoizedState=O;else{s=A.next;var ce=W=null,Ve=null,_t=s,kt=!1;do{var Ft=_t.lane&-536870913;if(Ft!==_t.lane?(Yn&Ft)===Ft:(oi&Ft)===Ft){var yt=_t.revertLane;if(yt===0)Ve!==null&&(Ve=Ve.next={lane:0,revertLane:0,gesture:null,action:_t.action,hasEagerState:_t.hasEagerState,eagerState:_t.eagerState,next:null}),Ft===Ta&&(kt=!0);else if((oi&yt)===yt){_t=_t.next,yt===Ta&&(kt=!0);continue}else Ft={lane:0,revertLane:_t.revertLane,gesture:null,action:_t.action,hasEagerState:_t.hasEagerState,eagerState:_t.eagerState,next:null},Ve===null?(ce=Ve=Ft,W=O):Ve=Ve.next=Ft,fn.lanes|=yt,No|=yt;Ft=_t.action,ol&&d(O,Ft),O=_t.hasEagerState?_t.eagerState:d(O,Ft)}else yt={lane:Ft,revertLane:_t.revertLane,gesture:_t.gesture,action:_t.action,hasEagerState:_t.hasEagerState,eagerState:_t.eagerState,next:null},Ve===null?(ce=Ve=yt,W=O):Ve=Ve.next=yt,fn.lanes|=Ft,No|=Ft;_t=_t.next}while(_t!==null&&_t!==s);if(Ve===null?W=O:Ve.next=ce,!xa(O,r.memoizedState)&&(kr=!0,kt&&(d=nc,d!==null)))throw d;r.memoizedState=O,r.baseState=W,r.baseQueue=Ve,x.lastRenderedState=O}return A===null&&(x.lanes=0),[r.memoizedState,x.dispatch]}function a(r){var s=Vi(),d=s.queue;if(d===null)throw Error(I(311));d.lastRenderedReducer=r;var x=d.dispatch,A=d.pending,O=s.memoizedState;if(A!==null){d.pending=null;var W=A=A.next;do O=r(O,W.action),W=W.next;while(W!==A);xa(O,s.memoizedState)||(kr=!0),s.memoizedState=O,s.baseQueue===null&&(s.baseState=O),d.lastRenderedState=O}return[O,x]}function h(r,s,d){var x=fn,A=Vi(),O=Zn;if(O){if(d===void 0)throw Error(I(407));d=d()}else d=s();var W=!xa((Mi||A).memoizedState,d);if(W&&(A.memoizedState=d,kr=!0),A=A.queue,pt(T.bind(null,x,A,r),[r]),A.getSnapshot!==s||W||Qi!==null&&Qi.memoizedState.tag&1){if(x.flags|=2048,Ae(9,{destroy:void 0},b.bind(null,x,A,d,s),null),Zi===null)throw Error(I(349));O||(oi&127)!==0||p(x,s,d)}return d}function p(r,s,d){r.flags|=16384,r={getSnapshot:s,value:d},s=fn.updateQueue,s===null?(s=zo(),fn.updateQueue=s,s.stores=[r]):(d=s.stores,d===null?s.stores=[r]:d.push(r))}function b(r,s,d,x){s.value=d,s.getSnapshot=x,k(s)&&z(r)}function T(r,s,d){return d(function(){k(s)&&z(r)})}function k(r){var s=r.getSnapshot;r=r.value;try{var d=s();return!xa(r,d)}catch{return!0}}function z(r){var s=Da(r,2);s!==null&&js(s,r,2)}function F(r){var s=ma();if(typeof r=="function"){var d=r;if(r=d(),ol){Ze(!0);try{d()}finally{Ze(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:to,lastRenderedState:r},s}function V(r,s,d,x){return r.baseState=d,t(r,Mi,typeof x=="function"?x:to)}function H(r,s,d,x,A){if(Gr(r))throw Error(I(485));if(r=s.action,r!==null){var O={payload:A,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(W){O.listeners.push(W)}};me.T!==null?d(!0):O.isTransition=!1,x(O),d=s.pending,d===null?(O.next=s.pending=O,Y(s,O)):(O.next=d.next,s.pending=d.next=O)}}function Y(r,s){var d=s.action,x=s.payload,A=r.state;if(s.isTransition){var O=me.T,W={};me.T=W;try{var ce=d(A,x),Ve=me.S;Ve!==null&&Ve(W,ce),J(r,s,ce)}catch(_t){ge(r,s,_t)}finally{O!==null&&W.types!==null&&(O.types=W.types),me.T=O}}else try{O=d(A,x),J(r,s,O)}catch(_t){ge(r,s,_t)}}function J(r,s,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(x){ae(r,s,x)},function(x){return ge(r,s,x)}):ae(r,s,d)}function ae(r,s,d){s.status="fulfilled",s.value=d,ve(s),r.state=d,s=r.pending,s!==null&&(d=s.next,d===s?r.pending=null:(d=d.next,s.next=d,Y(r,d)))}function ge(r,s,d){var x=r.pending;if(r.pending=null,x!==null){x=x.next;do s.status="rejected",s.reason=d,ve(s),s=s.next;while(s!==x)}r.action=null}function ve(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function ye(r,s){return s}function be(r,s){if(Zn){var d=Zi.formState;if(d!==null){e:{var x=fn;if(Zn){if(Ei){t:{for(var A=Ei,O=ms;A.nodeType!==8;){if(!O){A=null;break t}if(A=Fo(A.nextSibling),A===null){A=null;break t}}O=A.data,A=O==="F!"||O==="F"?A:null}if(A){Ei=Fo(A.nextSibling),x=A.data==="F!";break e}}$a(x)}x=!1}x&&(s=d[0])}}return d=ma(),d.memoizedState=d.baseState=s,x={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ye,lastRenderedState:s},d.queue=x,d=Su.bind(null,fn,x),x.dispatch=d,x=F(!1),O=Ir.bind(null,fn,!1,x.queue),x=ma(),A={state:s,dispatch:null,action:r,pending:null},x.queue=A,d=H.bind(null,fn,A,O,d),A.dispatch=d,x.memoizedState=r,[s,d,!1]}function De(r){var s=Vi();return we(s,Mi,r)}function we(r,s,d){if(s=t(r,s,ye)[0],r=v(to)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var x=wu(s)}catch(W){throw W===Xt?Nl:W}else x=s;s=Vi();var A=s.queue,O=A.dispatch;return d!==s.memoizedState&&(fn.flags|=2048,Ae(9,{destroy:void 0},Oe.bind(null,A,d),null)),[x,O,r]}function Oe(r,s){r.action=s}function je(r){var s=Vi(),d=Mi;if(d!==null)return we(s,d,r);Vi(),s=s.memoizedState,d=Vi();var x=d.queue.dispatch;return d.memoizedState=r,[s,x,!1]}function Ae(r,s,d,x){return r={tag:r,create:d,deps:x,inst:s,next:null},s=fn.updateQueue,s===null&&(s=zo(),fn.updateQueue=s),d=s.lastEffect,d===null?s.lastEffect=r.next=r:(x=d.next,d.next=r,r.next=x,s.lastEffect=r),r}function $e(){return Vi().memoizedState}function ht(r,s,d,x){var A=ma();fn.flags|=r,A.memoizedState=Ae(1|s,{destroy:void 0},d,x===void 0?null:x)}function st(r,s,d,x){var A=Vi();x=x===void 0?null:x;var O=A.memoizedState.inst;Mi!==null&&x!==null&&eo(x,Mi.memoizedState.deps)?A.memoizedState=Ae(s,O,d,x):(fn.flags|=r,A.memoizedState=Ae(1|s,O,d,x))}function ft(r,s){ht(8390656,8,r,s)}function pt(r,s){st(2048,8,r,s)}function Dt(r){fn.flags|=4;var s=fn.updateQueue;if(s===null)s=zo(),fn.updateQueue=s,s.events=[r];else{var d=s.events;d===null?s.events=[r]:d.push(r)}}function qt(r){var s=Vi().memoizedState;return Dt({ref:s,nextImpl:r}),function(){if((yi&2)!==0)throw Error(I(440));return s.impl.apply(void 0,arguments)}}function Pt(r,s){return st(4,2,r,s)}function an(r,s){return st(4,4,r,s)}function Cn(r,s){if(typeof s=="function"){r=r();var d=s(r);return function(){typeof d=="function"?d():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function ai(r,s,d){d=d!=null?d.concat([r]):null,st(4,4,Cn.bind(null,s,r),d)}function Ci(){}function li(r,s){var d=Vi();s=s===void 0?null:s;var x=d.memoizedState;return s!==null&&eo(s,x[1])?x[0]:(d.memoizedState=[r,s],r)}function Fi(r,s){var d=Vi();s=s===void 0?null:s;var x=d.memoizedState;if(s!==null&&eo(s,x[1]))return x[0];if(x=r(),ol){Ze(!0);try{r()}finally{Ze(!1)}}return d.memoizedState=[x,s],x}function _i(r,s,d){return d===void 0||(oi&1073741824)!==0&&(Yn&261930)===0?r.memoizedState=s:(r.memoizedState=d,r=of(),fn.lanes|=r,No|=r,d)}function Mr(r,s,d,x){return xa(d,s)?d:Oa.current!==null?(r=_i(r,d,x),xa(r,s)||(kr=!0),r):(oi&42)===0||(oi&1073741824)!==0&&(Yn&261930)===0?(kr=!0,r.memoizedState=d):(r=of(),fn.lanes|=r,No|=r,s)}function zi(r,s,d,x,A){var O=Pe.p;Pe.p=O!==0&&8>O?O:8;var W=me.T,ce={};me.T=ce,Ir(r,!1,s,d);try{var Ve=A(),_t=me.S;if(_t!==null&&_t(ce,Ve),Ve!==null&&typeof Ve=="object"&&typeof Ve.then=="function"){var kt=Hc(Ve,x);Qa(r,s,kt,vi(r))}else Qa(r,s,x,vi(r))}catch(Ft){Qa(r,s,{then:function(){},status:"rejected",reason:Ft},vi())}finally{Pe.p=O,W!==null&&ce.types!==null&&(W.types=ce.types),me.T=W}}function Cr(){}function er(r,s,d,x){if(r.tag!==5)throw Error(I(476));var A=ar(r).queue;zi(r,A,s,Ue,d===null?Cr:function(){return ra(r),d(x)})}function ar(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:Ue,baseState:Ue,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:to,lastRenderedState:Ue},next:null};var d={};return s.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:to,lastRenderedState:d},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function ra(r){var s=ar(r);s.next===null&&(s=r.alternate.memoizedState),Qa(r,s.next.queue,{},vi())}function ga(){return xr(yd)}function no(){return Vi().memoizedState}function fl(){return Vi().memoizedState}function Tu(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var d=vi();r=Hn(d);var x=al(s,r,d);x!==null&&(js(x,s,d),jl(x,s,d)),s={cache:zl()},r.payload=s;return}s=s.return}}function Yh(r,s,d){var x=vi();d={lane:x,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},Gr(r)?aa(s,d):(d=Ks(r,s,d,x),d!==null&&(js(d,r,x),vs(d,s,x)))}function Su(r,s,d){var x=vi();Qa(r,s,d,x)}function Qa(r,s,d,x){var A={lane:x,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(Gr(r))aa(s,A);else{var O=r.alternate;if(r.lanes===0&&(O===null||O.lanes===0)&&(O=s.lastRenderedReducer,O!==null))try{var W=s.lastRenderedState,ce=O(W,d);if(A.hasEagerState=!0,A.eagerState=ce,xa(ce,W))return Al(r,s,A,0),Zi===null&&So(),!1}catch{}finally{}if(d=Ks(r,s,A,x),d!==null)return js(d,r,x),vs(d,s,x),!0}return!1}function Ir(r,s,d,x){if(x={lane:2,revertLane:vc(),gesture:null,action:x,hasEagerState:!1,eagerState:null,next:null},Gr(r)){if(s)throw Error(I(479))}else s=Ks(r,d,x,2),s!==null&&js(s,r,2)}function Gr(r){var s=r.alternate;return r===fn||s!==null&&s===fn}function aa(r,s){ys=bu=!0;var d=r.pending;d===null?s.next=s:(s.next=d.next,d.next=s),r.pending=s}function vs(r,s,d){if((d&4194048)!==0){var x=s.lanes;x&=r.pendingLanes,d|=x,s.lanes=d,ji(r,d)}}var tr={readContext:xr,use:cc,useCallback:Ji,useContext:Ji,useEffect:Ji,useImperativeHandle:Ji,useLayoutEffect:Ji,useInsertionEffect:Ji,useMemo:Ji,useReducer:Ji,useRef:Ji,useState:Ji,useDebugValue:Ji,useDeferredValue:Ji,useTransition:Ji,useSyncExternalStore:Ji,useId:Ji,useHostTransitionStatus:Ji,useFormState:Ji,useActionState:Ji,useOptimistic:Ji,useMemoCache:Ji,useCacheRefresh:Ji};tr.useEffectEvent=Ji;var Ar={readContext:xr,use:cc,useCallback:function(r,s){return ma().memoizedState=[r,s===void 0?null:s],r},useContext:xr,useEffect:ft,useImperativeHandle:function(r,s,d){d=d!=null?d.concat([r]):null,ht(4194308,4,Cn.bind(null,s,r),d)},useLayoutEffect:function(r,s){return ht(4194308,4,r,s)},useInsertionEffect:function(r,s){ht(4,2,r,s)},useMemo:function(r,s){var d=ma();s=s===void 0?null:s;var x=r();if(ol){Ze(!0);try{r()}finally{Ze(!1)}}return d.memoizedState=[x,s],x},useReducer:function(r,s,d){var x=ma();if(d!==void 0){var A=d(s);if(ol){Ze(!0);try{d(s)}finally{Ze(!1)}}}else A=s;return x.memoizedState=x.baseState=A,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:A},x.queue=r,r=r.dispatch=Yh.bind(null,fn,r),[x.memoizedState,r]},useRef:function(r){var s=ma();return r={current:r},s.memoizedState=r},useState:function(r){r=F(r);var s=r.queue,d=Su.bind(null,fn,s);return s.dispatch=d,[r.memoizedState,d]},useDebugValue:Ci,useDeferredValue:function(r,s){var d=ma();return _i(d,r,s)},useTransition:function(){var r=F(!1);return r=zi.bind(null,fn,r.queue,!0,!1),ma().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,d){var x=fn,A=ma();if(Zn){if(d===void 0)throw Error(I(407));d=d()}else{if(d=s(),Zi===null)throw Error(I(349));(Yn&127)!==0||p(x,s,d)}A.memoizedState=d;var O={value:d,getSnapshot:s};return A.queue=O,ft(T.bind(null,x,O,r),[r]),x.flags|=2048,Ae(9,{destroy:void 0},b.bind(null,x,O,d,s),null),d},useId:function(){var r=ma(),s=Zi.identifierPrefix;if(Zn){var d=Xa,x=Co;d=(x&~(1<<32-St(x)-1)).toString(32)+d,s="_"+s+"R_"+d,d=oc++,0<d&&(s+="H"+d.toString(32)),s+="_"}else d=Nf++,s="_"+s+"r_"+d.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:ga,useFormState:be,useActionState:be,useOptimistic:function(r){var s=ma();s.memoizedState=s.baseState=r;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=d,s=Ir.bind(null,fn,!0,d),d.dispatch=s,[r,s]},useMemoCache:hc,useCacheRefresh:function(){return ma().memoizedState=Tu.bind(null,fn)},useEffectEvent:function(r){var s=ma(),d={impl:r};return s.memoizedState=d,function(){if((yi&2)!==0)throw Error(I(440));return d.impl.apply(void 0,arguments)}}},Fa={readContext:xr,use:cc,useCallback:li,useContext:xr,useEffect:pt,useImperativeHandle:ai,useInsertionEffect:Pt,useLayoutEffect:an,useMemo:Fi,useReducer:v,useRef:$e,useState:function(){return v(to)},useDebugValue:Ci,useDeferredValue:function(r,s){var d=Vi();return Mr(d,Mi.memoizedState,r,s)},useTransition:function(){var r=v(to)[0],s=Vi().memoizedState;return[typeof r=="boolean"?r:wu(r),s]},useSyncExternalStore:h,useId:no,useHostTransitionStatus:ga,useFormState:De,useActionState:De,useOptimistic:function(r,s){var d=Vi();return V(d,Mi,r,s)},useMemoCache:hc,useCacheRefresh:fl};Fa.useEffectEvent=qt;var Gi={readContext:xr,use:cc,useCallback:li,useContext:xr,useEffect:pt,useImperativeHandle:ai,useInsertionEffect:Pt,useLayoutEffect:an,useMemo:Fi,useReducer:a,useRef:$e,useState:function(){return a(to)},useDebugValue:Ci,useDeferredValue:function(r,s){var d=Vi();return Mi===null?_i(d,r,s):Mr(d,Mi.memoizedState,r,s)},useTransition:function(){var r=a(to)[0],s=Vi().memoizedState;return[typeof r=="boolean"?r:wu(r),s]},useSyncExternalStore:h,useId:no,useHostTransitionStatus:ga,useFormState:je,useActionState:je,useOptimistic:function(r,s){var d=Vi();return Mi!==null?V(d,Mi,r,s):(d.baseState=r,[r,d.queue.dispatch])},useMemoCache:hc,useCacheRefresh:fl};Gi.useEffectEvent=qt;function Bf(r,s,d,x){s=r.memoizedState,d=d(x,s),d=d==null?s:ie({},s,d),r.memoizedState=d,r.lanes===0&&(r.updateQueue.baseState=d)}var Hh={enqueueSetState:function(r,s,d){r=r._reactInternals;var x=vi(),A=Hn(x);A.payload=s,d!=null&&(A.callback=d),s=al(r,A,x),s!==null&&(js(s,r,x),jl(s,r,x))},enqueueReplaceState:function(r,s,d){r=r._reactInternals;var x=vi(),A=Hn(x);A.tag=1,A.payload=s,d!=null&&(A.callback=d),s=al(r,A,x),s!==null&&(js(s,r,x),jl(s,r,x))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var d=vi(),x=Hn(d);x.tag=2,s!=null&&(x.callback=s),s=al(r,x,d),s!==null&&(js(s,r,d),jl(s,r,d))}};function Xh(r,s,d,x,A,O,W){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(x,O,W):s.prototype&&s.prototype.isPureReactComponent?!wo(d,x)||!wo(A,O):!0}function Ff(r,s,d,x){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(d,x),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(d,x),s.state!==r&&Hh.enqueueReplaceState(s,s.state,null)}function xs(r,s){var d=s;if("ref"in s){d={};for(var x in s)x!=="ref"&&(d[x]=s[x])}if(r=r.defaultProps){d===s&&(d=ie({},d));for(var A in r)d[A]===void 0&&(d[A]=r[A])}return d}function Gl(r){Jr(r)}function dl(r){console.error(r)}function jf(r){Jr(r)}function Eu(r,s){try{var d=r.onUncaughtError;d(s.value,{componentStack:s.stack})}catch(x){setTimeout(function(){throw x})}}function $h(r,s,d){try{var x=r.onCaughtError;x(d.value,{componentStack:d.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(A){setTimeout(function(){throw A})}}function ql(r,s,d){return d=Hn(d),d.tag=3,d.payload={element:null},d.callback=function(){Eu(r,s)},d}function Wh(r){return r=Hn(r),r.tag=3,r}function Kh(r,s,d,x){var A=d.type.getDerivedStateFromError;if(typeof A=="function"){var O=x.value;r.payload=function(){return A(O)},r.callback=function(){$h(s,d,x)}}var W=d.stateNode;W!==null&&typeof W.componentDidCatch=="function"&&(r.callback=function(){$h(s,d,x),typeof A!="function"&&(gc===null?gc=new Set([this]):gc.add(this));var ce=x.stack;this.componentDidCatch(x.value,{componentStack:ce!==null?ce:""})})}function Rp(r,s,d,x,A){if(d.flags|=32768,x!==null&&typeof x=="object"&&typeof x.then=="function"){if(s=d.alternate,s!==null&&Os(s,d,A,!0),d=Na.current,d!==null){switch(d.tag){case 31:case 13:return ia===null?Pu():d.alternate===null&&Dr===0&&(Dr=3),d.flags&=-257,d.flags|=65536,d.lanes=A,x===Wc?d.flags|=16384:(s=d.updateQueue,s===null?d.updateQueue=new Set([x]):s.add(x),rd(r,x,A)),!1;case 22:return d.flags|=65536,x===Wc?d.flags|=16384:(s=d.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([x])},d.updateQueue=s):(d=s.retryQueue,d===null?s.retryQueue=new Set([x]):d.add(x)),rd(r,x,A)),!1}throw Error(I(435,d.tag))}return rd(r,x,A),Pu(),!1}if(Zn)return s=Na.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=A,x!==Wi&&(r=Error(I(422),{cause:x}),el(La(r,d)))):(x!==Wi&&(s=Error(I(423),{cause:x}),el(La(s,d))),r=r.current.alternate,r.flags|=65536,A&=-A,r.lanes|=A,x=La(x,d),A=ql(r.stateNode,x,A),yu(r,A),Dr!==4&&(Dr=2)),!1;var O=Error(I(520),{cause:x});if(O=La(O,d),Qf===null?Qf=[O]:Qf.push(O),Dr!==4&&(Dr=2),s===null)return!0;x=La(x,d),d=s;do{switch(d.tag){case 3:return d.flags|=65536,r=A&-A,d.lanes|=r,r=ql(d.stateNode,x,r),yu(d,r),!1;case 1:if(s=d.type,O=d.stateNode,(d.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||O!==null&&typeof O.componentDidCatch=="function"&&(gc===null||!gc.has(O))))return d.flags|=65536,A&=-A,d.lanes|=A,A=Wh(A),Kh(A,r,d,x),yu(d,A),!1}d=d.return}while(d!==null);return!1}var Dp=Error(I(461)),kr=!1;function Sa(r,s,d,x){s.child=r===null?Gh(s,null,d,x):Lo(s,r.child,d,x)}function Lp(r,s,d,x,A){d=d.render;var O=s.ref;if("ref"in x){var W={};for(var ce in x)ce!=="ref"&&(W[ce]=x[ce])}else W=x;return il(s),x=lc(r,s,d,W,O,A),ce=ih(),r!==null&&!kr?(cl(r,s,A),br(r,s,A)):(Zn&&ce&&gu(s),s.flags|=1,Sa(r,s,x,A),s.child)}function rh(r,s,d,x,A){if(r===null){var O=d.type;return typeof O=="function"&&!Lh(O)&&O.defaultProps===void 0&&d.compare===null?(s.tag=15,s.type=O,Km(r,s,O,x,A)):(r=zh(d.type,null,x,s,s.mode,A),r.ref=s.ref,r.return=s,s.child=r)}if(O=r.child,!Fd(r,A)){var W=O.memoizedProps;if(d=d.compare,d=d!==null?d:wo,d(W,x)&&r.ref===s.ref)return br(r,s,A)}return s.flags|=1,r=ps(O,x),r.ref=s.ref,r.return=s,s.child=r}function Km(r,s,d,x,A){if(r!==null){var O=r.memoizedProps;if(wo(O,x)&&r.ref===s.ref)if(kr=!1,s.pendingProps=x=O,Fd(r,A))(r.flags&131072)!==0&&(kr=!0);else return s.lanes=r.lanes,br(r,s,A)}return zp(r,s,d,x,A)}function ah(r,s,d,x){var A=x.children,O=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),x.mode==="hidden"){if((s.flags&128)!==0){if(O=O!==null?O.baseLanes|d:d,r!==null){for(x=s.child=r.child,A=0;x!==null;)A=A|x.lanes|x.childLanes,x=x.sibling;x=A&~O}else x=0,s.child=null;return Uf(r,s,O,d,x)}if((d&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&Ol(s,O!==null?O.cachePool:null),O!==null?on(s,O):mn(),Of(s);else return x=s.lanes=536870912,Uf(r,s,O!==null?O.baseLanes|d:d,d,x)}else O!==null?(Ol(s,O.cachePool),on(s,O),Vl(),s.memoizedState=null):(r!==null&&Ol(s,null),mn(),Vl());return Sa(r,s,A,d),s.child}function fc(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Uf(r,s,d,x,A){var O=Xc();return O=O===null?null:{parent:Ki._currentValue,pool:O},s.memoizedState={baseLanes:d,cachePool:O},r!==null&&Ol(s,null),mn(),Of(s),r!==null&&Os(r,s,x,!0),s.childLanes=A,null}function Dd(r,s){return s=Bd({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function Qm(r,s,d){return Lo(s,r.child,null,d),r=Dd(s,s.pendingProps),r.flags|=2,Ka(s),s.memoizedState=null,r}function w_(r,s,d){var x=s.pendingProps,A=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(Zn){if(x.mode==="hidden")return r=Dd(s,x),s.lanes=536870912,fc(null,r);if(Ba(s),(r=Ei)?(r=_m(r,ms),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:Mo!==null?{id:Co,overflow:Xa}:null,retryLane:536870912,hydrationErrors:null},d=Oh(r),d.return=s,s.child=d,na=s,Ei=null)):r=null,r===null)throw $a(s);return s.lanes=536870912,null}return Dd(s,x)}var O=r.memoizedState;if(O!==null){var W=O.dehydrated;if(Ba(s),A)if(s.flags&256)s.flags&=-257,s=Qm(r,s,d);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(I(558));else if(kr||Os(r,s,d,!1),A=(d&r.childLanes)!==0,kr||A){if(x=Zi,x!==null&&(W=qo(x,d),W!==0&&W!==O.retryLane))throw O.retryLane=W,Da(r,W),js(x,r,W),Dp;Pu(),s=Qm(r,s,d)}else r=O.treeContext,Ei=Fo(W.nextSibling),na=s,Zn=!0,Jo=null,ms=!1,r!==null&&Pf(s,r),s=Dd(s,x),s.flags|=4096;return s}return r=ps(r.child,{mode:x.mode,children:x.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Ld(r,s){var d=s.ref;if(d===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(I(284));(r===null||r.ref!==d)&&(s.flags|=4194816)}}function zp(r,s,d,x,A){return il(s),d=lc(r,s,d,x,void 0,A),x=ih(),r!==null&&!kr?(cl(r,s,A),br(r,s,A)):(Zn&&x&&gu(s),s.flags|=1,Sa(r,s,d,A),s.child)}function Op(r,s,d,x,A,O){return il(s),s.updateQueue=null,d=th(s,x,d,A),uc(r),x=ih(),r!==null&&!kr?(cl(r,s,O),br(r,s,O)):(Zn&&x&&gu(s),s.flags|=1,Sa(r,s,d,O),s.child)}function zd(r,s,d,x,A){if(il(s),s.stateNode===null){var O=Ln,W=d.contextType;typeof W=="object"&&W!==null&&(O=xr(W)),O=new d(x,O),s.memoizedState=O.state!==null&&O.state!==void 0?O.state:null,O.updater=Hh,s.stateNode=O,O._reactInternals=s,O=s.stateNode,O.props=x,O.state=s.memoizedState,O.refs={},qh(s),W=d.contextType,O.context=typeof W=="object"&&W!==null?xr(W):Ln,O.state=s.memoizedState,W=d.getDerivedStateFromProps,typeof W=="function"&&(Bf(s,d,W,x),O.state=s.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof O.getSnapshotBeforeUpdate=="function"||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(W=O.state,typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount(),W!==O.state&&Hh.enqueueReplaceState(O,O.state,null),sc(s,x,O,A),vu(),O.state=s.memoizedState),typeof O.componentDidMount=="function"&&(s.flags|=4194308),x=!0}else if(r===null){O=s.stateNode;var ce=s.memoizedProps,Ve=xs(d,ce);O.props=Ve;var _t=O.context,kt=d.contextType;W=Ln,typeof kt=="object"&&kt!==null&&(W=xr(kt));var Ft=d.getDerivedStateFromProps;kt=typeof Ft=="function"||typeof O.getSnapshotBeforeUpdate=="function",ce=s.pendingProps!==ce,kt||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(ce||_t!==W)&&Ff(s,O,x,W),rl=!1;var yt=s.memoizedState;O.state=yt,sc(s,x,O,A),vu(),_t=s.memoizedState,ce||yt!==_t||rl?(typeof Ft=="function"&&(Bf(s,d,Ft,x),_t=s.memoizedState),(Ve=rl||Xh(s,d,Ve,x,yt,_t,W))?(kt||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(s.flags|=4194308)):(typeof O.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=x,s.memoizedState=_t),O.props=x,O.state=_t,O.context=W,x=Ve):(typeof O.componentDidMount=="function"&&(s.flags|=4194308),x=!1)}else{O=s.stateNode,Js(r,s),W=s.memoizedProps,kt=xs(d,W),O.props=kt,Ft=s.pendingProps,yt=O.context,_t=d.contextType,Ve=Ln,typeof _t=="object"&&_t!==null&&(Ve=xr(_t)),ce=d.getDerivedStateFromProps,(_t=typeof ce=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(W!==Ft||yt!==Ve)&&Ff(s,O,x,Ve),rl=!1,yt=s.memoizedState,O.state=yt,sc(s,x,O,A),vu();var bt=s.memoizedState;W!==Ft||yt!==bt||rl||r!==null&&r.dependencies!==null&&tc(r.dependencies)?(typeof ce=="function"&&(Bf(s,d,ce,x),bt=s.memoizedState),(kt=rl||Xh(s,d,kt,x,yt,bt,Ve)||r!==null&&r.dependencies!==null&&tc(r.dependencies))?(_t||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(x,bt,Ve),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(x,bt,Ve)),typeof O.componentDidUpdate=="function"&&(s.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof O.componentDidUpdate!="function"||W===r.memoizedProps&&yt===r.memoizedState||(s.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||W===r.memoizedProps&&yt===r.memoizedState||(s.flags|=1024),s.memoizedProps=x,s.memoizedState=bt),O.props=x,O.state=bt,O.context=Ve,x=kt):(typeof O.componentDidUpdate!="function"||W===r.memoizedProps&&yt===r.memoizedState||(s.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||W===r.memoizedProps&&yt===r.memoizedState||(s.flags|=1024),x=!1)}return O=x,Ld(r,s),x=(s.flags&128)!==0,O||x?(O=s.stateNode,d=x&&typeof d.getDerivedStateFromError!="function"?null:O.render(),s.flags|=1,r!==null&&x?(s.child=Lo(s,r.child,null,A),s.child=Lo(s,null,d,A)):Sa(r,s,d,A),s.memoizedState=O.state,r=s.child):r=br(r,s,A),r}function Np(r,s,d,x){return Ao(),s.flags|=256,Sa(r,s,d,x),s.child}var Od={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Bp(r){return{baseLanes:r,cachePool:Do()}}function Fp(r,s,d){return r=r!==null?r.childLanes&~d:0,s&&(r|=so),r}function jp(r,s,d){var x=s.pendingProps,A=!1,O=(s.flags&128)!==0,W;if((W=O)||(W=r!==null&&r.memoizedState===null?!1:(dr.current&2)!==0),W&&(A=!0,s.flags&=-129),W=(s.flags&32)!==0,s.flags&=-33,r===null){if(Zn){if(A?fr(s):Vl(),(r=Ei)?(r=_m(r,ms),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:Mo!==null?{id:Co,overflow:Xa}:null,retryLane:536870912,hydrationErrors:null},d=Oh(r),d.return=s,s.child=d,na=s,Ei=null)):r=null,r===null)throw $a(s);return qr(r)?s.lanes=32:s.lanes=536870912,null}var ce=x.children;return x=x.fallback,A?(Vl(),A=s.mode,ce=Bd({mode:"hidden",children:ce},A),x=kl(x,A,d,null),ce.return=s,x.return=s,ce.sibling=x,s.child=ce,x=s.child,x.memoizedState=Bp(d),x.childLanes=Fp(r,W,d),s.memoizedState=Od,fc(null,x)):(fr(s),Nd(s,ce))}var Ve=r.memoizedState;if(Ve!==null&&(ce=Ve.dehydrated,ce!==null)){if(O)s.flags&256?(fr(s),s.flags&=-257,s=Vf(r,s,d)):s.memoizedState!==null?(Vl(),s.child=r.child,s.flags|=128,s=null):(Vl(),ce=x.fallback,A=s.mode,x=Bd({mode:"visible",children:x.children},A),ce=kl(ce,A,d,null),ce.flags|=2,x.return=s,ce.return=s,x.sibling=ce,s.child=x,Lo(s,r.child,null,d),x=s.child,x.memoizedState=Bp(d),x.childLanes=Fp(r,W,d),s.memoizedState=Od,s=fc(null,x));else if(fr(s),qr(ce)){if(W=ce.nextSibling&&ce.nextSibling.dataset,W)var _t=W.dgst;W=_t,x=Error(I(419)),x.stack="",x.digest=W,el({value:x,source:null,stack:null}),s=Vf(r,s,d)}else if(kr||Os(r,s,d,!1),W=(d&r.childLanes)!==0,kr||W){if(W=Zi,W!==null&&(x=qo(W,d),x!==0&&x!==Ve.retryLane))throw Ve.retryLane=x,Da(r,x),js(W,r,x),Dp;Ts(ce)||Pu(),s=Vf(r,s,d)}else Ts(ce)?(s.flags|=192,s.child=r.child,s=null):(r=Ve.treeContext,Ei=Fo(ce.nextSibling),na=s,Zn=!0,Jo=null,ms=!1,r!==null&&Pf(s,r),s=Nd(s,x.children),s.flags|=4096);return s}return A?(Vl(),ce=x.fallback,A=s.mode,Ve=r.child,_t=Ve.sibling,x=ps(Ve,{mode:"hidden",children:x.children}),x.subtreeFlags=Ve.subtreeFlags&65011712,_t!==null?ce=ps(_t,ce):(ce=kl(ce,A,d,null),ce.flags|=2),ce.return=s,x.return=s,x.sibling=ce,s.child=x,fc(null,x),x=s.child,ce=r.child.memoizedState,ce===null?ce=Bp(d):(A=ce.cachePool,A!==null?(Ve=Ki._currentValue,A=A.parent!==Ve?{parent:Ve,pool:Ve}:A):A=Do(),ce={baseLanes:ce.baseLanes|d,cachePool:A}),x.memoizedState=ce,x.childLanes=Fp(r,W,d),s.memoizedState=Od,fc(r.child,x)):(fr(s),d=r.child,r=d.sibling,d=ps(d,{mode:"visible",children:x.children}),d.return=s,d.sibling=null,r!==null&&(W=s.deletions,W===null?(s.deletions=[r],s.flags|=16):W.push(r)),s.child=d,s.memoizedState=null,d)}function Nd(r,s){return s=Bd({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function Bd(r,s){return r=ds(22,r,null,s),r.lanes=0,r}function Vf(r,s,d){return Lo(s,r.child,null,d),r=Nd(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function Up(r,s,d){r.lanes|=s;var x=r.alternate;x!==null&&(x.lanes|=s),Nh(r.return,s,d)}function Gf(r,s,d,x,A,O){var W=r.memoizedState;W===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:x,tail:d,tailMode:A,treeForkCount:O}:(W.isBackwards=s,W.rendering=null,W.renderingStartTime=0,W.last=x,W.tail=d,W.tailMode=A,W.treeForkCount=O)}function Qh(r,s,d){var x=s.pendingProps,A=x.revealOrder,O=x.tail;x=x.children;var W=dr.current,ce=(W&2)!==0;if(ce?(W=W&1|2,s.flags|=128):W&=1,Ot(dr,W),Sa(r,s,x,d),x=Zn?Ll:0,!ce&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Up(r,d,s);else if(r.tag===19)Up(r,d,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(A){case"forwards":for(d=s.child,A=null;d!==null;)r=d.alternate,r!==null&&sl(r)===null&&(A=d),d=d.sibling;d=A,d===null?(A=s.child,s.child=null):(A=d.sibling,d.sibling=null),Gf(s,!1,A,d,O,x);break;case"backwards":case"unstable_legacy-backwards":for(d=null,A=s.child,s.child=null;A!==null;){if(r=A.alternate,r!==null&&sl(r)===null){s.child=A;break}r=A.sibling,A.sibling=d,d=A,A=r}Gf(s,!0,d,null,O,x);break;case"together":Gf(s,!1,null,null,void 0,x);break;default:s.memoizedState=null}return s.child}function br(r,s,d){if(r!==null&&(s.dependencies=r.dependencies),No|=s.lanes,(d&s.childLanes)===0)if(r!==null){if(Os(r,s,d,!1),(d&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(I(153));if(s.child!==null){for(r=s.child,d=ps(r,r.pendingProps),s.child=d,d.return=s;r.sibling!==null;)r=r.sibling,d=d.sibling=ps(r,r.pendingProps),d.return=s;d.sibling=null}return s.child}function Fd(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&tc(r)))}function Vp(r,s,d){switch(s.tag){case 3:Qe(s,s.stateNode.containerInfo),nl(s,Ki,r.memoizedState.cache),Ao();break;case 27:case 5:Rn(s);break;case 4:Qe(s,s.stateNode.containerInfo);break;case 10:nl(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Ba(s),null;break;case 13:var x=s.memoizedState;if(x!==null)return x.dehydrated!==null?(fr(s),s.flags|=128,null):(d&s.child.childLanes)!==0?jp(r,s,d):(fr(s),r=br(r,s,d),r!==null?r.sibling:null);fr(s);break;case 19:var A=(r.flags&128)!==0;if(x=(d&s.childLanes)!==0,x||(Os(r,s,d,!1),x=(d&s.childLanes)!==0),A){if(x)return Qh(r,s,d);s.flags|=128}if(A=s.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),Ot(dr,dr.current),x)break;return null;case 22:return s.lanes=0,ah(r,s,d,s.pendingProps);case 24:nl(s,Ki,r.memoizedState.cache)}return br(r,s,d)}function Jm(r,s,d){if(r!==null)if(r.memoizedProps!==s.pendingProps)kr=!0;else{if(!Fd(r,d)&&(s.flags&128)===0)return kr=!1,Vp(r,s,d);kr=(r.flags&131072)!==0}else kr=!1,Zn&&(s.flags&1048576)!==0&&kf(s,Ll,s.index);switch(s.lanes=0,s.tag){case 16:e:{var x=s.pendingProps;if(r=_s(s.elementType),s.type=r,typeof r=="function")Lh(r)?(x=xs(r,x),s.tag=1,s=zd(null,s,r,x,d)):(s.tag=0,s=zp(null,s,r,x,d));else{if(r!=null){var A=r.$$typeof;if(A===jt){s.tag=11,s=Lp(null,s,r,x,d);break e}else if(A===wt){s.tag=14,s=rh(null,s,r,x,d);break e}}throw s=Fe(r)||r,Error(I(306,s,""))}}return s;case 0:return zp(r,s,s.type,s.pendingProps,d);case 1:return x=s.type,A=xs(x,s.pendingProps),zd(r,s,x,A,d);case 3:e:{if(Qe(s,s.stateNode.containerInfo),r===null)throw Error(I(387));x=s.pendingProps;var O=s.memoizedState;A=O.element,Js(r,s),sc(s,x,null,d);var W=s.memoizedState;if(x=W.cache,nl(s,Ki,x),x!==O.cache&&Bh(s,[Ki],d,!0),vu(),x=W.element,O.isDehydrated)if(O={element:x,isDehydrated:!1,cache:W.cache},s.updateQueue.baseState=O,s.memoizedState=O,s.flags&256){s=Np(r,s,x,d);break e}else if(x!==A){A=La(Error(I(424)),s),el(A),s=Np(r,s,x,d);break e}else{switch(r=s.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(Ei=Fo(r.firstChild),na=s,Zn=!0,Jo=null,ms=!0,d=Gh(s,null,x,d),s.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling}else{if(Ao(),x===A){s=br(r,s,d);break e}Sa(r,s,x,d)}s=s.child}return s;case 26:return Ld(r,s),r===null?(d=hp(s.type,null,s.pendingProps,null))?s.memoizedState=d:Zn||(d=s.type,r=s.pendingProps,x=Du(tn.current).createElement(d),x[di]=s,x[Ut]=r,zr(x,d,r),Ti(x),s.stateNode=x):s.memoizedState=hp(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return Rn(s),r===null&&Zn&&(x=s.stateNode=Ig(s.type,s.pendingProps,tn.current),na=s,ms=!0,A=Ei,or(s.type)?(up=A,Ei=Fo(x.firstChild)):Ei=A),Sa(r,s,s.pendingProps.children,d),Ld(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&Zn&&((A=x=Ei)&&(x=sa(x,s.type,s.pendingProps,ms),x!==null?(s.stateNode=x,na=s,Ei=Fo(x.firstChild),ms=!1,A=!0):A=!1),A||$a(s)),Rn(s),A=s.type,O=s.pendingProps,W=r!==null?r.memoizedProps:null,x=O.children,pd(A,O)?x=null:W!==null&&pd(A,W)&&(s.flags|=32),s.memoizedState!==null&&(A=lc(r,s,nh,null,null,d),yd._currentValue=A),Ld(r,s),Sa(r,s,x,d),s.child;case 6:return r===null&&Zn&&((r=d=Ei)&&(d=oa(d,s.pendingProps,ms),d!==null?(s.stateNode=d,na=s,Ei=null,r=!0):r=!1),r||$a(s)),null;case 13:return jp(r,s,d);case 4:return Qe(s,s.stateNode.containerInfo),x=s.pendingProps,r===null?s.child=Lo(s,null,x,d):Sa(r,s,x,d),s.child;case 11:return Lp(r,s,s.type,s.pendingProps,d);case 7:return Sa(r,s,s.pendingProps,d),s.child;case 8:return Sa(r,s,s.pendingProps.children,d),s.child;case 12:return Sa(r,s,s.pendingProps.children,d),s.child;case 10:return x=s.pendingProps,nl(s,s.type,x.value),Sa(r,s,x.children,d),s.child;case 9:return A=s.type._context,x=s.pendingProps.children,il(s),A=xr(A),x=x(A),s.flags|=1,Sa(r,s,x,d),s.child;case 14:return rh(r,s,s.type,s.pendingProps,d);case 15:return Km(r,s,s.type,s.pendingProps,d);case 19:return Qh(r,s,d);case 31:return w_(r,s,d);case 22:return ah(r,s,d,s.pendingProps);case 24:return il(s),x=xr(Ki),r===null?(A=Xc(),A===null&&(A=Zi,O=zl(),A.pooledCache=O,O.refCount++,O!==null&&(A.pooledCacheLanes|=d),A=O),s.memoizedState={parent:x,cache:A},qh(s),nl(s,Ki,A)):((r.lanes&d)!==0&&(Js(r,s),sc(s,null,null,d),vu()),A=r.memoizedState,O=s.memoizedState,A.parent!==x?(A={parent:x,cache:x},s.memoizedState=A,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=A),nl(s,Ki,x)):(x=O.cache,nl(s,Ki,x),x!==A.cache&&Bh(s,[Ki],d,!0))),Sa(r,s,s.pendingProps.children,d),s.child;case 29:throw s.pendingProps}throw Error(I(156,s.tag))}function Zl(r){r.flags|=4}function Gp(r,s,d,x,A){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(A&335544128)===A)if(r.stateNode.complete)r.flags|=8192;else if(am())r.flags|=8192;else throw _u=Wc,$c}else r.flags&=-16777217}function eg(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!Tm(s))if(am())r.flags|=8192;else throw _u=Wc,$c}function qf(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?Nt():536870912,r.lanes|=s,af|=s)}function Zf(r,s){if(!Zn)switch(r.tailMode){case"hidden":s=r.tail;for(var d=null;s!==null;)s.alternate!==null&&(d=s),s=s.sibling;d===null?r.tail=null:d.sibling=null;break;case"collapsed":d=r.tail;for(var x=null;d!==null;)d.alternate!==null&&(x=d),d=d.sibling;x===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:x.sibling=null}}function qi(r){var s=r.alternate!==null&&r.alternate.child===r.child,d=0,x=0;if(s)for(var A=r.child;A!==null;)d|=A.lanes|A.childLanes,x|=A.subtreeFlags&65011712,x|=A.flags&65011712,A.return=r,A=A.sibling;else for(A=r.child;A!==null;)d|=A.lanes|A.childLanes,x|=A.subtreeFlags,x|=A.flags,A.return=r,A=A.sibling;return r.subtreeFlags|=x,r.childLanes=d,s}function tg(r,s,d){var x=s.pendingProps;switch(ec(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qi(s),null;case 1:return qi(s),null;case 3:return d=s.stateNode,x=null,r!==null&&(x=r.memoizedState.cache),s.memoizedState.cache!==x&&(s.flags|=2048),Ro(Ki),ni(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(r===null||r.child===null)&&(Io(s)?Zl(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,ko())),qi(s),null;case 26:var A=s.type,O=s.memoizedState;return r===null?(Zl(s),O!==null?(qi(s),eg(s,O)):(qi(s),Gp(s,A,null,x,d))):O?O!==r.memoizedState?(Zl(s),qi(s),eg(s,O)):(qi(s),s.flags&=-16777217):(r=r.memoizedProps,r!==x&&Zl(s),qi(s),Gp(s,A,r,x,d)),null;case 27:if(rn(s),d=tn.current,A=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==x&&Zl(s);else{if(!x){if(s.stateNode===null)throw Error(I(166));return qi(s),null}r=Ct.current,Io(s)?gs(s):(r=Ig(A,x,d),s.stateNode=r,Zl(s))}return qi(s),null;case 5:if(rn(s),A=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==x&&Zl(s);else{if(!x){if(s.stateNode===null)throw Error(I(166));return qi(s),null}if(O=Ct.current,Io(s))gs(s);else{var W=Du(tn.current);switch(O){case 1:O=W.createElementNS("http://www.w3.org/2000/svg",A);break;case 2:O=W.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;default:switch(A){case"svg":O=W.createElementNS("http://www.w3.org/2000/svg",A);break;case"math":O=W.createElementNS("http://www.w3.org/1998/Math/MathML",A);break;case"script":O=W.createElement("div"),O.innerHTML="<script><\/script>",O=O.removeChild(O.firstChild);break;case"select":O=typeof x.is=="string"?W.createElement("select",{is:x.is}):W.createElement("select"),x.multiple?O.multiple=!0:x.size&&(O.size=x.size);break;default:O=typeof x.is=="string"?W.createElement(A,{is:x.is}):W.createElement(A)}}O[di]=s,O[Ut]=x;e:for(W=s.child;W!==null;){if(W.tag===5||W.tag===6)O.appendChild(W.stateNode);else if(W.tag!==4&&W.tag!==27&&W.child!==null){W.child.return=W,W=W.child;continue}if(W===s)break e;for(;W.sibling===null;){if(W.return===null||W.return===s)break e;W=W.return}W.sibling.return=W.return,W=W.sibling}s.stateNode=O;e:switch(zr(O,A,x),A){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}x&&Zl(s)}}return qi(s),Gp(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,d),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==x&&Zl(s);else{if(typeof x!="string"&&s.stateNode===null)throw Error(I(166));if(r=tn.current,Io(s)){if(r=s.stateNode,d=s.memoizedProps,x=null,A=na,A!==null)switch(A.tag){case 27:case 5:x=A.memoizedProps}r[di]=s,r=!!(r.nodeValue===d||x!==null&&x.suppressHydrationWarning===!0||np(r.nodeValue,d)),r||$a(s,!0)}else r=Du(r).createTextNode(x),r[di]=s,s.stateNode=r}return qi(s),null;case 31:if(d=s.memoizedState,r===null||r.memoizedState!==null){if(x=Io(s),d!==null){if(r===null){if(!x)throw Error(I(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(I(557));r[di]=s}else Ao(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;qi(s),r=!1}else d=ko(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=d),r=!0;if(!r)return s.flags&256?(Ka(s),s):(Ka(s),null);if((s.flags&128)!==0)throw Error(I(558))}return qi(s),null;case 13:if(x=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(A=Io(s),x!==null&&x.dehydrated!==null){if(r===null){if(!A)throw Error(I(318));if(A=s.memoizedState,A=A!==null?A.dehydrated:null,!A)throw Error(I(317));A[di]=s}else Ao(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;qi(s),A=!1}else A=ko(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=A),A=!0;if(!A)return s.flags&256?(Ka(s),s):(Ka(s),null)}return Ka(s),(s.flags&128)!==0?(s.lanes=d,s):(d=x!==null,r=r!==null&&r.memoizedState!==null,d&&(x=s.child,A=null,x.alternate!==null&&x.alternate.memoizedState!==null&&x.alternate.memoizedState.cachePool!==null&&(A=x.alternate.memoizedState.cachePool.pool),O=null,x.memoizedState!==null&&x.memoizedState.cachePool!==null&&(O=x.memoizedState.cachePool.pool),O!==A&&(x.flags|=2048)),d!==r&&d&&(s.child.flags|=8192),qf(s,s.updateQueue),qi(s),null);case 4:return ni(),r===null&&ep(s.stateNode.containerInfo),qi(s),null;case 10:return Ro(s.type),qi(s),null;case 19:if(ut(dr),x=s.memoizedState,x===null)return qi(s),null;if(A=(s.flags&128)!==0,O=x.rendering,O===null)if(A)Zf(x,!1);else{if(Dr!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(O=sl(r),O!==null){for(s.flags|=128,Zf(x,!1),r=O.updateQueue,s.updateQueue=r,qf(s,r),s.subtreeFlags=0,r=d,d=s.child;d!==null;)Pd(d,r),d=d.sibling;return Ot(dr,dr.current&1|2),Zn&&Qo(s,x.treeForkCount),s.child}r=r.sibling}x.tail!==null&&dn()>Jf&&(s.flags|=128,A=!0,Zf(x,!1),s.lanes=4194304)}else{if(!A)if(r=sl(O),r!==null){if(s.flags|=128,A=!0,r=r.updateQueue,s.updateQueue=r,qf(s,r),Zf(x,!0),x.tail===null&&x.tailMode==="hidden"&&!O.alternate&&!Zn)return qi(s),null}else 2*dn()-x.renderingStartTime>Jf&&d!==536870912&&(s.flags|=128,A=!0,Zf(x,!1),s.lanes=4194304);x.isBackwards?(O.sibling=s.child,s.child=O):(r=x.last,r!==null?r.sibling=O:s.child=O,x.last=O)}return x.tail!==null?(r=x.tail,x.rendering=r,x.tail=r.sibling,x.renderingStartTime=dn(),r.sibling=null,d=dr.current,Ot(dr,A?d&1|2:d&1),Zn&&Qo(s,x.treeForkCount),r):(qi(s),null);case 22:case 23:return Ka(s),Ul(),x=s.memoizedState!==null,r!==null?r.memoizedState!==null!==x&&(s.flags|=8192):x&&(s.flags|=8192),x?(d&536870912)!==0&&(s.flags&128)===0&&(qi(s),s.subtreeFlags&6&&(s.flags|=8192)):qi(s),d=s.updateQueue,d!==null&&qf(s,d.retryQueue),d=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),x=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(x=s.memoizedState.cachePool.pool),x!==d&&(s.flags|=2048),r!==null&&ut(Qs),null;case 24:return d=null,r!==null&&(d=r.memoizedState.cache),s.memoizedState.cache!==d&&(s.flags|=2048),Ro(Ki),qi(s),null;case 25:return null;case 30:return null}throw Error(I(156,s.tag))}function ng(r,s){switch(ec(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Ro(Ki),ni(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return rn(s),null;case 31:if(s.memoizedState!==null){if(Ka(s),s.alternate===null)throw Error(I(340));Ao()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(Ka(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(I(340));Ao()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return ut(dr),null;case 4:return ni(),null;case 10:return Ro(s.type),null;case 22:case 23:return Ka(s),Ul(),r!==null&&ut(Qs),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Ro(Ki),null;case 25:return null;default:return null}}function ig(r,s){switch(ec(s),s.tag){case 3:Ro(Ki),ni();break;case 26:case 27:case 5:rn(s);break;case 4:ni();break;case 31:s.memoizedState!==null&&Ka(s);break;case 13:Ka(s);break;case 19:ut(dr);break;case 10:Ro(s.type);break;case 22:case 23:Ka(s),Ul(),r!==null&&ut(Qs);break;case 24:Ro(Ki)}}function Yf(r,s){try{var d=s.updateQueue,x=d!==null?d.lastEffect:null;if(x!==null){var A=x.next;d=A;do{if((d.tag&r)===r){x=void 0;var O=d.create,W=d.inst;x=O(),W.destroy=x}d=d.next}while(d!==A)}}catch(ce){xi(s,s.return,ce)}}function dc(r,s,d){try{var x=s.updateQueue,A=x!==null?x.lastEffect:null;if(A!==null){var O=A.next;x=O;do{if((x.tag&r)===r){var W=x.inst,ce=W.destroy;if(ce!==void 0){W.destroy=void 0,A=s;var Ve=d,_t=ce;try{_t()}catch(kt){xi(A,Ve,kt)}}}x=x.next}while(x!==O)}}catch(kt){xi(s,s.return,kt)}}function Hf(r){var s=r.updateQueue;if(s!==null){var d=r.stateNode;try{zf(s,d)}catch(x){xi(r,r.return,x)}}}function jd(r,s,d){d.props=xs(r.type,r.memoizedProps),d.state=r.memoizedState;try{d.componentWillUnmount()}catch(x){xi(r,s,x)}}function Jh(r,s){try{var d=r.ref;if(d!==null){switch(r.tag){case 26:case 27:case 5:var x=r.stateNode;break;case 30:x=r.stateNode;break;default:x=r.stateNode}typeof d=="function"?r.refCleanup=d(x):d.current=x}}catch(A){xi(r,s,A)}}function Ja(r,s){var d=r.ref,x=r.refCleanup;if(d!==null)if(typeof x=="function")try{x()}catch(A){xi(r,s,A)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(A){xi(r,s,A)}else d.current=null}function ef(r){var s=r.type,d=r.memoizedProps,x=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":d.autoFocus&&x.focus();break e;case"img":d.src?x.src=d.src:d.srcSet&&(x.srcset=d.srcSet)}}catch(A){xi(r,r.return,A)}}function qp(r,s,d){try{var x=r.stateNode;fd(x,r.type,d,s),x[Ut]=s}catch(A){xi(r,r.return,A)}}function rg(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&or(r.type)||r.tag===4}function Zp(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||rg(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&or(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function Yp(r,s,d){var x=r.tag;if(x===5||x===6)r=r.stateNode,s?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(r,s):(s=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,s.appendChild(r),d=d._reactRootContainer,d!=null||s.onclick!==null||(s.onclick=Pa));else if(x!==4&&(x===27&&or(r.type)&&(d=r.stateNode,s=null),r=r.child,r!==null))for(Yp(r,s,d),r=r.sibling;r!==null;)Yp(r,s,d),r=r.sibling}function Ud(r,s,d){var x=r.tag;if(x===5||x===6)r=r.stateNode,s?d.insertBefore(r,s):d.appendChild(r);else if(x!==4&&(x===27&&or(r.type)&&(d=r.stateNode),r=r.child,r!==null))for(Ud(r,s,d),r=r.sibling;r!==null;)Ud(r,s,d),r=r.sibling}function ag(r){var s=r.stateNode,d=r.memoizedProps;try{for(var x=r.type,A=s.attributes;A.length;)s.removeAttributeNode(A[0]);zr(s,x,d),s[di]=r,s[Ut]=d}catch(O){xi(r,r.return,O)}}var Mu=!1,Pr=!1,Hp=!1,Xp=typeof WeakSet=="function"?WeakSet:Set,Rr=null;function T_(r,s){if(r=r.containerInfo,ip=xf,r=pa(r),ba(r)){if("selectionStart"in r)var d={start:r.selectionStart,end:r.selectionEnd};else e:{d=(d=r.ownerDocument)&&d.defaultView||window;var x=d.getSelection&&d.getSelection();if(x&&x.rangeCount!==0){d=x.anchorNode;var A=x.anchorOffset,O=x.focusNode;x=x.focusOffset;try{d.nodeType,O.nodeType}catch{d=null;break e}var W=0,ce=-1,Ve=-1,_t=0,kt=0,Ft=r,yt=null;t:for(;;){for(var bt;Ft!==d||A!==0&&Ft.nodeType!==3||(ce=W+A),Ft!==O||x!==0&&Ft.nodeType!==3||(Ve=W+x),Ft.nodeType===3&&(W+=Ft.nodeValue.length),(bt=Ft.firstChild)!==null;)yt=Ft,Ft=bt;for(;;){if(Ft===r)break t;if(yt===d&&++_t===A&&(ce=W),yt===O&&++kt===x&&(Ve=W),(bt=Ft.nextSibling)!==null)break;Ft=yt,yt=Ft.parentNode}Ft=bt}d=ce===-1||Ve===-1?null:{start:ce,end:Ve}}else d=null}d=d||{start:0,end:0}}else d=null;for(rp={focusedElem:r,selectionRange:d},xf=!1,Rr=s;Rr!==null;)if(s=Rr,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,Rr=r;else for(;Rr!==null;){switch(s=Rr,O=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(d=0;d<r.length;d++)A=r[d],A.ref.impl=A.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&O!==null){r=void 0,d=s,A=O.memoizedProps,O=O.memoizedState,x=d.stateNode;try{var un=xs(d.type,A);r=x.getSnapshotBeforeUpdate(un,O),x.__reactInternalSnapshotBeforeUpdate=r}catch(En){xi(d,d.return,En)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,d=r.nodeType,d===9)es(r);else if(d===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":es(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(I(163))}if(r=s.sibling,r!==null){r.return=s.return,Rr=r;break}Rr=s.return}}function pr(r,s,d){var x=d.flags;switch(d.tag){case 0:case 11:case 15:Yl(r,d),x&4&&Yf(5,d);break;case 1:if(Yl(r,d),x&4)if(r=d.stateNode,s===null)try{r.componentDidMount()}catch(W){xi(d,d.return,W)}else{var A=xs(d.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(A,s,r.__reactInternalSnapshotBeforeUpdate)}catch(W){xi(d,d.return,W)}}x&64&&Hf(d),x&512&&Jh(d,d.return);break;case 3:if(Yl(r,d),x&64&&(r=d.updateQueue,r!==null)){if(s=null,d.child!==null)switch(d.child.tag){case 27:case 5:s=d.child.stateNode;break;case 1:s=d.child.stateNode}try{zf(r,s)}catch(W){xi(d,d.return,W)}}break;case 27:s===null&&x&4&&ag(d);case 26:case 5:Yl(r,d),s===null&&x&4&&ef(d),x&512&&Jh(d,d.return);break;case 12:Yl(r,d);break;case 31:Yl(r,d),x&4&&$p(r,d);break;case 13:Yl(r,d),x&4&&Wp(r,d),x&64&&(r=d.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(d=k_.bind(null,d),lp(r,d))));break;case 22:if(x=d.memoizedState!==null||Mu,!x){s=s!==null&&s.memoizedState!==null||Pr,A=Mu;var O=Pr;Mu=x,(Pr=s)&&!O?Cu(r,d,(d.subtreeFlags&8772)!==0):Yl(r,d),Mu=A,Pr=O}break;case 30:break;default:Yl(r,d)}}function sh(r){var s=r.alternate;s!==null&&(r.alternate=null,sh(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&ls(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var sr=null,ja=!1;function Oo(r,s,d){for(d=d.child;d!==null;)tf(r,s,d),d=d.sibling}function tf(r,s,d){if(qe&&typeof qe.onCommitFiberUnmount=="function")try{qe.onCommitFiberUnmount(Je,d)}catch{}switch(d.tag){case 26:Pr||Ja(d,s),Oo(r,s,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:Pr||Ja(d,s);var x=sr,A=ja;or(d.type)&&(sr=d.stateNode,ja=!1),Oo(r,s,d),df(d.stateNode),sr=x,ja=A;break;case 5:Pr||Ja(d,s);case 6:if(x=sr,A=ja,sr=null,Oo(r,s,d),sr=x,ja=A,sr!==null)if(ja)try{(sr.nodeType===9?sr.body:sr.nodeName==="HTML"?sr.ownerDocument.body:sr).removeChild(d.stateNode)}catch(O){xi(d,s,O)}else try{sr.removeChild(d.stateNode)}catch(O){xi(d,s,O)}break;case 18:sr!==null&&(ja?(r=sr,Bo(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,d.stateNode),Tf(r)):Bo(sr,d.stateNode));break;case 4:x=sr,A=ja,sr=d.stateNode.containerInfo,ja=!0,Oo(r,s,d),sr=x,ja=A;break;case 0:case 11:case 14:case 15:dc(2,d,s),Pr||dc(4,d,s),Oo(r,s,d);break;case 1:Pr||(Ja(d,s),x=d.stateNode,typeof x.componentWillUnmount=="function"&&jd(d,s,x)),Oo(r,s,d);break;case 21:Oo(r,s,d);break;case 22:Pr=(x=Pr)||d.memoizedState!==null,Oo(r,s,d),Pr=x;break;default:Oo(r,s,d)}}function $p(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Tf(r)}catch(d){xi(s,s.return,d)}}}function Wp(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Tf(r)}catch(d){xi(s,s.return,d)}}function Xf(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new Xp),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new Xp),s;default:throw Error(I(435,r.tag))}}function nf(r,s){var d=Xf(r);s.forEach(function(x){if(!d.has(x)){d.add(x);var A=P_.bind(null,r,x);x.then(A,A)}})}function _a(r,s){var d=s.deletions;if(d!==null)for(var x=0;x<d.length;x++){var A=d[x],O=r,W=s,ce=W;e:for(;ce!==null;){switch(ce.tag){case 27:if(or(ce.type)){sr=ce.stateNode,ja=!1;break e}break;case 5:sr=ce.stateNode,ja=!1;break e;case 3:case 4:sr=ce.stateNode.containerInfo,ja=!0;break e}ce=ce.return}if(sr===null)throw Error(I(160));tf(O,W,A),sr=null,ja=!1,O=A.alternate,O!==null&&(O.return=null),A.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)oh(s,r),s=s.sibling}var Bs=null;function oh(r,s){var d=r.alternate,x=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:_a(s,r),Ea(r),x&4&&(dc(3,r,r.return),Yf(3,r),dc(5,r,r.return));break;case 1:_a(s,r),Ea(r),x&512&&(Pr||d===null||Ja(d,d.return)),x&64&&Mu&&(r=r.updateQueue,r!==null&&(x=r.callbacks,x!==null&&(d=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=d===null?x:d.concat(x))));break;case 26:var A=Bs;if(_a(s,r),Ea(r),x&512&&(Pr||d===null||Ja(d,d.return)),x&4){var O=d!==null?d.memoizedState:null;if(x=r.memoizedState,d===null)if(x===null)if(r.stateNode===null){e:{x=r.type,d=r.memoizedProps,A=A.ownerDocument||A;t:switch(x){case"title":O=A.getElementsByTagName("title")[0],(!O||O[wn]||O[di]||O.namespaceURI==="http://www.w3.org/2000/svg"||O.hasAttribute("itemprop"))&&(O=A.createElement(x),A.head.insertBefore(O,A.querySelector("head > title"))),zr(O,x,d),O[di]=r,Ti(O),x=O;break e;case"link":var W=fp("link","href",A).get(x+(d.href||""));if(W){for(var ce=0;ce<W.length;ce++)if(O=W[ce],O.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&O.getAttribute("rel")===(d.rel==null?null:d.rel)&&O.getAttribute("title")===(d.title==null?null:d.title)&&O.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){W.splice(ce,1);break t}}O=A.createElement(x),zr(O,x,d),A.head.appendChild(O);break;case"meta":if(W=fp("meta","content",A).get(x+(d.content||""))){for(ce=0;ce<W.length;ce++)if(O=W[ce],O.getAttribute("content")===(d.content==null?null:""+d.content)&&O.getAttribute("name")===(d.name==null?null:d.name)&&O.getAttribute("property")===(d.property==null?null:d.property)&&O.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&O.getAttribute("charset")===(d.charSet==null?null:d.charSet)){W.splice(ce,1);break t}}O=A.createElement(x),zr(O,x,d),A.head.appendChild(O);break;default:throw Error(I(468,x))}O[di]=r,Ti(O),x=O}r.stateNode=x}else dp(A,r.type,r.stateNode);else r.stateNode=Dg(A,x,r.memoizedProps);else O!==x?(O===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):O.count--,x===null?dp(A,r.type,r.stateNode):Dg(A,x,r.memoizedProps)):x===null&&r.stateNode!==null&&qp(r,r.memoizedProps,d.memoizedProps)}break;case 27:_a(s,r),Ea(r),x&512&&(Pr||d===null||Ja(d,d.return)),d!==null&&x&4&&qp(r,r.memoizedProps,d.memoizedProps);break;case 5:if(_a(s,r),Ea(r),x&512&&(Pr||d===null||Ja(d,d.return)),r.flags&32){A=r.stateNode;try{Rs(A,"")}catch(un){xi(r,r.return,un)}}x&4&&r.stateNode!=null&&(A=r.memoizedProps,qp(r,A,d!==null?d.memoizedProps:A)),x&1024&&(Hp=!0);break;case 6:if(_a(s,r),Ea(r),x&4){if(r.stateNode===null)throw Error(I(162));x=r.memoizedProps,d=r.stateNode;try{d.nodeValue=x}catch(un){xi(r,r.return,un)}}break;case 3:if(ph=null,A=Bs,Bs=pf(s.containerInfo),_a(s,r),Bs=A,Ea(r),x&4&&d!==null&&d.memoizedState.isDehydrated)try{Tf(s.containerInfo)}catch(un){xi(r,r.return,un)}Hp&&(Hp=!1,sg(r));break;case 4:x=Bs,Bs=pf(r.stateNode.containerInfo),_a(s,r),Ea(r),Bs=x;break;case 12:_a(s,r),Ea(r);break;case 31:_a(s,r),Ea(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,nf(r,x)));break;case 13:_a(s,r),Ea(r),r.child.flags&8192&&r.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(sf=dn()),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,nf(r,x)));break;case 22:A=r.memoizedState!==null;var Ve=d!==null&&d.memoizedState!==null,_t=Mu,kt=Pr;if(Mu=_t||A,Pr=kt||Ve,_a(s,r),Pr=kt,Mu=_t,Ea(r),x&8192)e:for(s=r.stateNode,s._visibility=A?s._visibility&-2:s._visibility|1,A&&(d===null||Ve||Mu||Pr||io(r)),d=null,s=r;;){if(s.tag===5||s.tag===26){if(d===null){Ve=d=s;try{if(O=Ve.stateNode,A)W=O.style,typeof W.setProperty=="function"?W.setProperty("display","none","important"):W.display="none";else{ce=Ve.stateNode;var Ft=Ve.memoizedProps.style,yt=Ft!=null&&Ft.hasOwnProperty("display")?Ft.display:null;ce.style.display=yt==null||typeof yt=="boolean"?"":(""+yt).trim()}}catch(un){xi(Ve,Ve.return,un)}}}else if(s.tag===6){if(d===null){Ve=s;try{Ve.stateNode.nodeValue=A?"":Ve.memoizedProps}catch(un){xi(Ve,Ve.return,un)}}}else if(s.tag===18){if(d===null){Ve=s;try{var bt=Ve.stateNode;A?xc(bt,!0):xc(Ve.stateNode,!1)}catch(un){xi(Ve,Ve.return,un)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;d===s&&(d=null),s=s.return}d===s&&(d=null),s.sibling.return=s.return,s=s.sibling}x&4&&(x=r.updateQueue,x!==null&&(d=x.retryQueue,d!==null&&(x.retryQueue=null,nf(r,d))));break;case 19:_a(s,r),Ea(r),x&4&&(x=r.updateQueue,x!==null&&(r.updateQueue=null,nf(r,x)));break;case 30:break;case 21:break;default:_a(s,r),Ea(r)}}function Ea(r){var s=r.flags;if(s&2){try{for(var d,x=r.return;x!==null;){if(rg(x)){d=x;break}x=x.return}if(d==null)throw Error(I(160));switch(d.tag){case 27:var A=d.stateNode,O=Zp(r);Ud(r,O,A);break;case 5:var W=d.stateNode;d.flags&32&&(Rs(W,""),d.flags&=-33);var ce=Zp(r);Ud(r,ce,W);break;case 3:case 4:var Ve=d.stateNode.containerInfo,_t=Zp(r);Yp(r,_t,Ve);break;default:throw Error(I(161))}}catch(kt){xi(r,r.return,kt)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function sg(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;sg(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function Yl(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)pr(r,s.alternate,s),s=s.sibling}function io(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:dc(4,s,s.return),io(s);break;case 1:Ja(s,s.return);var d=s.stateNode;typeof d.componentWillUnmount=="function"&&jd(s,s.return,d),io(s);break;case 27:df(s.stateNode);case 26:case 5:Ja(s,s.return),io(s);break;case 22:s.memoizedState===null&&io(s);break;case 30:io(s);break;default:io(s)}r=r.sibling}}function Cu(r,s,d){for(d=d&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var x=s.alternate,A=r,O=s,W=O.flags;switch(O.tag){case 0:case 11:case 15:Cu(A,O,d),Yf(4,O);break;case 1:if(Cu(A,O,d),x=O,A=x.stateNode,typeof A.componentDidMount=="function")try{A.componentDidMount()}catch(_t){xi(x,x.return,_t)}if(x=O,A=x.updateQueue,A!==null){var ce=x.stateNode;try{var Ve=A.shared.hiddenCallbacks;if(Ve!==null)for(A.shared.hiddenCallbacks=null,A=0;A<Ve.length;A++)Zh(Ve[A],ce)}catch(_t){xi(x,x.return,_t)}}d&&W&64&&Hf(O),Jh(O,O.return);break;case 27:ag(O);case 26:case 5:Cu(A,O,d),d&&x===null&&W&4&&ef(O),Jh(O,O.return);break;case 12:Cu(A,O,d);break;case 31:Cu(A,O,d),d&&W&4&&$p(A,O);break;case 13:Cu(A,O,d),d&&W&4&&Wp(A,O);break;case 22:O.memoizedState===null&&Cu(A,O,d),Jh(O,O.return);break;case 30:break;default:Cu(A,O,d)}s=s.sibling}}function Vd(r,s){var d=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(d=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==d&&(r!=null&&r.refCount++,d!=null&&wa(d))}function lh(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&wa(r))}function ro(r,s,d,x){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)Kp(r,s,d,x),s=s.sibling}function Kp(r,s,d,x){var A=s.flags;switch(s.tag){case 0:case 11:case 15:ro(r,s,d,x),A&2048&&Yf(9,s);break;case 1:ro(r,s,d,x);break;case 3:ro(r,s,d,x),A&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&wa(r)));break;case 12:if(A&2048){ro(r,s,d,x),r=s.stateNode;try{var O=s.memoizedProps,W=O.id,ce=O.onPostCommit;typeof ce=="function"&&ce(W,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(Ve){xi(s,s.return,Ve)}}else ro(r,s,d,x);break;case 31:ro(r,s,d,x);break;case 13:ro(r,s,d,x);break;case 23:break;case 22:O=s.stateNode,W=s.alternate,s.memoizedState!==null?O._visibility&2?ro(r,s,d,x):$f(r,s):O._visibility&2?ro(r,s,d,x):(O._visibility|=2,uh(r,s,d,x,(s.subtreeFlags&10256)!==0||!1)),A&2048&&Vd(W,s);break;case 24:ro(r,s,d,x),A&2048&&lh(s.alternate,s);break;default:ro(r,s,d,x)}}function uh(r,s,d,x,A){for(A=A&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var O=r,W=s,ce=d,Ve=x,_t=W.flags;switch(W.tag){case 0:case 11:case 15:uh(O,W,ce,Ve,A),Yf(8,W);break;case 23:break;case 22:var kt=W.stateNode;W.memoizedState!==null?kt._visibility&2?uh(O,W,ce,Ve,A):$f(O,W):(kt._visibility|=2,uh(O,W,ce,Ve,A)),A&&_t&2048&&Vd(W.alternate,W);break;case 24:uh(O,W,ce,Ve,A),A&&_t&2048&&lh(W.alternate,W);break;default:uh(O,W,ce,Ve,A)}s=s.sibling}}function $f(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var d=r,x=s,A=x.flags;switch(x.tag){case 22:$f(d,x),A&2048&&Vd(x.alternate,x);break;case 24:$f(d,x),A&2048&&lh(x.alternate,x);break;default:$f(d,x)}s=s.sibling}}var Wf=8192;function rf(r,s,d){if(r.subtreeFlags&Wf)for(r=r.child;r!==null;)og(r,s,d),r=r.sibling}function og(r,s,d){switch(r.tag){case 26:rf(r,s,d),r.flags&Wf&&r.memoizedState!==null&&Lg(d,Bs,r.memoizedState,r.memoizedProps);break;case 5:rf(r,s,d);break;case 3:case 4:var x=Bs;Bs=pf(r.stateNode.containerInfo),rf(r,s,d),Bs=x;break;case 22:r.memoizedState===null&&(x=r.alternate,x!==null&&x.memoizedState!==null?(x=Wf,Wf=16777216,rf(r,s,d),Wf=x):rf(r,s,d));break;default:rf(r,s,d)}}function lg(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function Iu(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var x=s[d];Rr=x,cg(x,r)}lg(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)ug(r),r=r.sibling}function ug(r){switch(r.tag){case 0:case 11:case 15:Iu(r),r.flags&2048&&dc(9,r,r.return);break;case 3:Iu(r);break;case 12:Iu(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,Kf(r)):Iu(r);break;default:Iu(r)}}function Kf(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var d=0;d<s.length;d++){var x=s[d];Rr=x,cg(x,r)}lg(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:dc(8,s,s.return),Kf(s);break;case 22:d=s.stateNode,d._visibility&2&&(d._visibility&=-3,Kf(s));break;default:Kf(s)}r=r.sibling}}function cg(r,s){for(;Rr!==null;){var d=Rr;switch(d.tag){case 0:case 11:case 15:dc(8,d,s);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var x=d.memoizedState.cachePool.pool;x!=null&&x.refCount++}break;case 24:wa(d.memoizedState.cache)}if(x=d.child,x!==null)x.return=d,Rr=x;else e:for(d=r;Rr!==null;){x=Rr;var A=x.sibling,O=x.return;if(sh(x),x===d){Rr=null;break e}if(A!==null){A.return=O,Rr=A;break e}Rr=O}}}var S_={getCacheForType:function(r){var s=xr(Ki),d=s.data.get(r);return d===void 0&&(d=r(),s.data.set(r,d)),d},cacheSignal:function(){return xr(Ki).controller.signal}},E_=typeof WeakMap=="function"?WeakMap:Map,yi=0,Zi=null,Xn=null,Yn=0,Ii=0,ao=null,pc=!1,ch=!1,Gd=!1,Au=0,Dr=0,No=0,mc=0,Qp=0,so=0,af=0,Qf=null,Fs=null,qd=!1,sf=0,Jp=0,Jf=1/0,ed=null,gc=null,Lr=0,_c=null,hh=null,ku=0,em=0,tm=null,nm=null,td=0,im=null;function vi(){return(yi&2)!==0&&Yn!==0?Yn&-Yn:me.T!==null?vc():_r()}function of(){if(so===0)if((Yn&536870912)===0||Zn){var r=zn;zn<<=1,(zn&3932160)===0&&(zn=262144),so=r}else so=536870912;return r=Na.current,r!==null&&(r.flags|=32),so}function js(r,s,d){(r===Zi&&(Ii===2||Ii===9)||r.cancelPendingCommit!==null)&&(pl(r,0),yc(r,Yn,so,!1)),Kn(r,d),((yi&2)===0||r!==Zi)&&(r===Zi&&((yi&2)===0&&(mc|=d),Dr===4&&yc(r,Yn,so,!1)),gl(r))}function hg(r,s,d){if((yi&6)!==0)throw Error(I(327));var x=!d&&(s&127)===0&&(s&r.expiredLanes)===0||Hi(r,s),A=x?C_(r,s):Hd(r,s,!0),O=x;do{if(A===0){ch&&!x&&yc(r,s,0,!1);break}else{if(d=r.current.alternate,O&&!fg(d)){A=Hd(r,s,!1),O=!1;continue}if(A===2){if(O=s,r.errorRecoveryDisabledLanes&O)var W=0;else W=r.pendingLanes&-536870913,W=W!==0?W:W&536870912?536870912:0;if(W!==0){s=W;e:{var ce=r;A=Qf;var Ve=ce.current.memoizedState.isDehydrated;if(Ve&&(pl(ce,W).flags|=256),W=Hd(ce,W,!1),W!==2){if(Gd&&!Ve){ce.errorRecoveryDisabledLanes|=O,mc|=O,A=4;break e}O=Fs,Fs=A,O!==null&&(Fs===null?Fs=O:Fs.push.apply(Fs,O))}A=W}if(O=!1,A!==2)continue}}if(A===1){pl(r,0),yc(r,s,0,!0);break}e:{switch(x=r,O=A,O){case 0:case 1:throw Error(I(345));case 4:if((s&4194048)!==s)break;case 6:yc(x,s,so,!pc);break e;case 2:Fs=null;break;case 3:case 5:break;default:throw Error(I(329))}if((s&62914560)===s&&(A=sf+300-dn(),10<A)){if(yc(x,s,so,!pc),ii(x,0,!0)!==0)break e;ku=s,x.timeoutHandle=op(rm.bind(null,x,d,Fs,ed,qd,s,so,mc,af,pc,O,"Throttled",-0,0),A);break e}rm(x,d,Fs,ed,qd,s,so,mc,af,pc,O,null,-0,0)}}break}while(!0);gl(r)}function rm(r,s,d,x,A,O,W,ce,Ve,_t,kt,Ft,yt,bt){if(r.timeoutHandle=-1,Ft=s.subtreeFlags,Ft&8192||(Ft&16785408)===16785408){Ft={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Pa},og(s,O,Ft);var un=(O&62914560)===O?sf-dn():(O&4194048)===O?Jp-dn():0;if(un=zg(Ft,un),un!==null){ku=O,r.cancelPendingCommit=un(gg.bind(null,r,s,O,d,x,A,W,ce,Ve,kt,Ft,null,yt,bt)),yc(r,O,W,!_t);return}}gg(r,s,O,d,x,A,W,ce,Ve)}function fg(r){for(var s=r;;){var d=s.tag;if((d===0||d===11||d===15)&&s.flags&16384&&(d=s.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var x=0;x<d.length;x++){var A=d[x],O=A.getSnapshot;A=A.value;try{if(!xa(O(),A))return!1}catch{return!1}}if(d=s.child,s.subtreeFlags&16384&&d!==null)d.return=s,s=d;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function yc(r,s,d,x){s&=~Qp,s&=~mc,r.suspendedLanes|=s,r.pingedLanes&=~s,x&&(r.warmLanes|=s),x=r.expirationTimes;for(var A=s;0<A;){var O=31-St(A),W=1<<O;x[O]=-1,A&=~W}d!==0&&si(r,d,s)}function nd(){return(yi&6)===0?(fh(0),!1):!0}function Zd(){if(Xn!==null){if(Ii===0)var r=Xn.return;else r=Xn,Po=zs=null,hl(r),Ns=null,Kc=0,r=Xn;for(;r!==null;)ig(r.alternate,r),r=r.return;Xn=null}}function pl(r,s){var d=r.timeoutHandle;d!==-1&&(r.timeoutHandle=-1,O_(d)),d=r.cancelPendingCommit,d!==null&&(r.cancelPendingCommit=null,d()),ku=0,Zd(),Zi=r,Xn=d=ps(r.current,null),Yn=s,Ii=0,ao=null,pc=!1,ch=Hi(r,s),Gd=!1,af=so=Qp=mc=No=Dr=0,Fs=Qf=null,qd=!1,(s&8)!==0&&(s|=s&32);var x=r.entangledLanes;if(x!==0)for(r=r.entanglements,x&=s;0<x;){var A=31-St(x),O=1<<A;s|=r[A],x&=~O}return Au=s,So(),d}function Yd(r,s){fn=null,me.H=tr,s===Xt||s===Nl?(s=Uh(),Ii=3):s===$c?(s=Uh(),Ii=4):Ii=s===Dp?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,ao=s,Xn===null&&(Dr=1,Eu(r,La(s,r.current)))}function am(){var r=Na.current;return r===null?!0:(Yn&4194048)===Yn?ia===null:(Yn&62914560)===Yn||(Yn&536870912)!==0?r===ia:!1}function sm(){var r=me.H;return me.H=tr,r===null?tr:r}function id(){var r=me.A;return me.A=S_,r}function Pu(){Dr=4,pc||(Yn&4194048)!==Yn&&Na.current!==null||(ch=!0),(No&134217727)===0&&(mc&134217727)===0||Zi===null||yc(Zi,Yn,so,!1)}function Hd(r,s,d){var x=yi;yi|=2;var A=sm(),O=id();(Zi!==r||Yn!==s)&&(ed=null,pl(r,s)),s=!1;var W=Dr;e:do try{if(Ii!==0&&Xn!==null){var ce=Xn,Ve=ao;switch(Ii){case 8:Zd(),W=6;break e;case 3:case 2:case 9:case 6:Na.current===null&&(s=!0);var _t=Ii;if(Ii=0,ao=null,lf(r,ce,Ve,_t),d&&ch){W=0;break e}break;default:_t=Ii,Ii=0,ao=null,lf(r,ce,Ve,_t)}}M_(),W=Dr;break}catch(kt){Yd(r,kt)}while(!0);return s&&r.shellSuspendCounter++,Po=zs=null,yi=x,me.H=A,me.A=O,Xn===null&&(Zi=null,Yn=0,So()),W}function M_(){for(;Xn!==null;)dg(Xn)}function C_(r,s){var d=yi;yi|=2;var x=sm(),A=id();Zi!==r||Yn!==s?(ed=null,Jf=dn()+500,pl(r,s)):ch=Hi(r,s);e:do try{if(Ii!==0&&Xn!==null){s=Xn;var O=ao;t:switch(Ii){case 1:Ii=0,ao=null,lf(r,s,O,1);break;case 2:case 9:if(Bl(O)){Ii=0,ao=null,pg(s);break}s=function(){Ii!==2&&Ii!==9||Zi!==r||(Ii=7),gl(r)},O.then(s,s);break e;case 3:Ii=7;break e;case 4:Ii=5;break e;case 7:Bl(O)?(Ii=0,ao=null,pg(s)):(Ii=0,ao=null,lf(r,s,O,7));break;case 5:var W=null;switch(Xn.tag){case 26:W=Xn.memoizedState;case 5:case 27:var ce=Xn;if(W?Tm(W):ce.stateNode.complete){Ii=0,ao=null;var Ve=ce.sibling;if(Ve!==null)Xn=Ve;else{var _t=ce.return;_t!==null?(Xn=_t,Xd(_t)):Xn=null}break t}}Ii=0,ao=null,lf(r,s,O,5);break;case 6:Ii=0,ao=null,lf(r,s,O,6);break;case 8:Zd(),Dr=6;break e;default:throw Error(I(462))}}I_();break}catch(kt){Yd(r,kt)}while(!0);return Po=zs=null,me.H=x,me.A=A,yi=d,Xn!==null?0:(Zi=null,Yn=0,So(),Dr)}function I_(){for(;Xn!==null&&!Nr();)dg(Xn)}function dg(r){var s=Jm(r.alternate,r,Au);r.memoizedProps=r.pendingProps,s===null?Xd(r):Xn=s}function pg(r){var s=r,d=s.alternate;switch(s.tag){case 15:case 0:s=Op(d,s,s.pendingProps,s.type,void 0,Yn);break;case 11:s=Op(d,s,s.pendingProps,s.type.render,s.ref,Yn);break;case 5:hl(s);default:ig(d,s),s=Xn=Pd(s,Au),s=Jm(d,s,Au)}r.memoizedProps=r.pendingProps,s===null?Xd(r):Xn=s}function lf(r,s,d,x){Po=zs=null,hl(s),Ns=null,Kc=0;var A=s.return;try{if(Rp(r,A,s,d,Yn)){Dr=1,Eu(r,La(d,r.current)),Xn=null;return}}catch(O){if(A!==null)throw Xn=A,O;Dr=1,Eu(r,La(d,r.current)),Xn=null;return}s.flags&32768?(Zn||x===1?r=!0:ch||(Yn&536870912)!==0?r=!1:(pc=r=!0,(x===2||x===9||x===3||x===6)&&(x=Na.current,x!==null&&x.tag===13&&(x.flags|=16384))),mg(s,r)):Xd(s)}function Xd(r){var s=r;do{if((s.flags&32768)!==0){mg(s,pc);return}r=s.return;var d=tg(s.alternate,s,Au);if(d!==null){Xn=d;return}if(s=s.sibling,s!==null){Xn=s;return}Xn=s=r}while(s!==null);Dr===0&&(Dr=5)}function mg(r,s){do{var d=ng(r.alternate,r);if(d!==null){d.flags&=32767,Xn=d;return}if(d=r.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!s&&(r=r.sibling,r!==null)){Xn=r;return}Xn=r=d}while(r!==null);Dr=6,Xn=null}function gg(r,s,d,x,A,O,W,ce,Ve){r.cancelPendingCommit=null;do uf();while(Lr!==0);if((yi&6)!==0)throw Error(I(327));if(s!==null){if(s===r.current)throw Error(I(177));if(O=s.lanes|s.childLanes,O|=To,ki(r,d,O,W,ce,Ve),r===Zi&&(Xn=Zi=null,Yn=0),hh=s,_c=r,ku=d,em=O,tm=A,nm=x,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,R_(te,function(){return lm(),null})):(r.callbackNode=null,r.callbackPriority=0),x=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||x){x=me.T,me.T=null,A=Pe.p,Pe.p=2,W=yi,yi|=4;try{T_(r,s,d)}finally{yi=W,Pe.p=A,me.T=x}}Lr=1,_g(),yg(),vg()}}function _g(){if(Lr===1){Lr=0;var r=_c,s=hh,d=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||d){d=me.T,me.T=null;var x=Pe.p;Pe.p=2;var A=yi;yi|=4;try{oh(s,r);var O=rp,W=pa(r.containerInfo),ce=O.focusedElem,Ve=O.selectionRange;if(W!==ce&&ce&&ce.ownerDocument&&du(ce.ownerDocument.documentElement,ce)){if(Ve!==null&&ba(ce)){var _t=Ve.start,kt=Ve.end;if(kt===void 0&&(kt=_t),"selectionStart"in ce)ce.selectionStart=_t,ce.selectionEnd=Math.min(kt,ce.value.length);else{var Ft=ce.ownerDocument||document,yt=Ft&&Ft.defaultView||window;if(yt.getSelection){var bt=yt.getSelection(),un=ce.textContent.length,En=Math.min(Ve.start,un),Ai=Ve.end===void 0?En:Math.min(Ve.end,un);!bt.extend&&En>Ai&&(W=Ai,Ai=En,En=W);var rt=fu(ce,En),We=fu(ce,Ai);if(rt&&We&&(bt.rangeCount!==1||bt.anchorNode!==rt.node||bt.anchorOffset!==rt.offset||bt.focusNode!==We.node||bt.focusOffset!==We.offset)){var gt=Ft.createRange();gt.setStart(rt.node,rt.offset),bt.removeAllRanges(),En>Ai?(bt.addRange(gt),bt.extend(We.node,We.offset)):(gt.setEnd(We.node,We.offset),bt.addRange(gt))}}}}for(Ft=[],bt=ce;bt=bt.parentNode;)bt.nodeType===1&&Ft.push({element:bt,left:bt.scrollLeft,top:bt.scrollTop});for(typeof ce.focus=="function"&&ce.focus(),ce=0;ce<Ft.length;ce++){var Rt=Ft[ce];Rt.element.scrollLeft=Rt.left,Rt.element.scrollTop=Rt.top}}xf=!!ip,rp=ip=null}finally{yi=A,Pe.p=x,me.T=d}}r.current=s,Lr=2}}function yg(){if(Lr===2){Lr=0;var r=_c,s=hh,d=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||d){d=me.T,me.T=null;var x=Pe.p;Pe.p=2;var A=yi;yi|=4;try{pr(r,s.alternate,s)}finally{yi=A,Pe.p=x,me.T=d}}Lr=3}}function vg(){if(Lr===4||Lr===3){Lr=0,wl();var r=_c,s=hh,d=ku,x=nm;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?Lr=5:(Lr=0,hh=_c=null,om(r,r.pendingLanes));var A=r.pendingLanes;if(A===0&&(gc=null),Gt(d),s=s.stateNode,qe&&typeof qe.onCommitFiberRoot=="function")try{qe.onCommitFiberRoot(Je,s,void 0,(s.current.flags&128)===128)}catch{}if(x!==null){s=me.T,A=Pe.p,Pe.p=2,me.T=null;try{for(var O=r.onRecoverableError,W=0;W<x.length;W++){var ce=x[W];O(ce.value,{componentStack:ce.stack})}}finally{me.T=s,Pe.p=A}}(ku&3)!==0&&uf(),gl(r),A=r.pendingLanes,(d&261930)!==0&&(A&42)!==0?r===im?td++:(td=0,im=r):td=0,fh(0)}}function om(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,wa(s)))}function uf(){return _g(),yg(),vg(),lm()}function lm(){if(Lr!==5)return!1;var r=_c,s=em;em=0;var d=Gt(ku),x=me.T,A=Pe.p;try{Pe.p=32>d?32:d,me.T=null,d=tm,tm=null;var O=_c,W=ku;if(Lr=0,hh=_c=null,ku=0,(yi&6)!==0)throw Error(I(331));var ce=yi;if(yi|=4,ug(O.current),Kp(O,O.current,W,d),yi=ce,fh(0,!1),qe&&typeof qe.onPostCommitFiberRoot=="function")try{qe.onPostCommitFiberRoot(Je,O)}catch{}return!0}finally{Pe.p=A,me.T=x,om(r,s)}}function Ru(r,s,d){s=La(d,s),s=ql(r.stateNode,s,2),r=al(r,s,2),r!==null&&(Kn(r,2),gl(r))}function xi(r,s,d){if(r.tag===3)Ru(r,r,d);else for(;s!==null;){if(s.tag===3){Ru(s,r,d);break}else if(s.tag===1){var x=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(gc===null||!gc.has(x))){r=La(d,r),d=Wh(2),x=al(s,d,2),x!==null&&(Kh(d,x,s,r),Kn(x,2),gl(x));break}}s=s.return}}function rd(r,s,d){var x=r.pingCache;if(x===null){x=r.pingCache=new E_;var A=new Set;x.set(s,A)}else A=x.get(s),A===void 0&&(A=new Set,x.set(s,A));A.has(d)||(Gd=!0,A.add(d),r=A_.bind(null,r,s,d),s.then(r,r))}function A_(r,s,d){var x=r.pingCache;x!==null&&x.delete(s),r.pingedLanes|=r.suspendedLanes&d,r.warmLanes&=~d,Zi===r&&(Yn&d)===d&&(Dr===4||Dr===3&&(Yn&62914560)===Yn&&300>dn()-sf?(yi&2)===0&&pl(r,0):Qp|=d,af===Yn&&(af=0)),gl(r)}function um(r,s){s===0&&(s=Nt()),r=Da(r,s),r!==null&&(Kn(r,s),gl(r))}function k_(r){var s=r.memoizedState,d=0;s!==null&&(d=s.retryLane),um(r,d)}function P_(r,s){var d=0;switch(r.tag){case 31:case 13:var x=r.stateNode,A=r.memoizedState;A!==null&&(d=A.retryLane);break;case 19:x=r.stateNode;break;case 22:x=r.stateNode._retryCache;break;default:throw Error(I(314))}x!==null&&x.delete(s),um(r,d)}function R_(r,s){return qs(r,s)}var $d=null,cf=null,Wd=!1,ad=!1,ml=!1,bs=0;function gl(r){r!==cf&&r.next===null&&(cf===null?$d=cf=r:cf=cf.next=r),ad=!0,Wd||(Wd=!0,cm())}function fh(r,s){if(!ml&&ad){ml=!0;do for(var d=!1,x=$d;x!==null;){if(r!==0){var A=x.pendingLanes;if(A===0)var O=0;else{var W=x.suspendedLanes,ce=x.pingedLanes;O=(1<<31-St(42|r)+1)-1,O&=A&~(W&~ce),O=O&201326741?O&201326741|1:O?O|2:0}O!==0&&(d=!0,Qd(x,O))}else O=Yn,O=ii(x,x===Zi?O:0,x.cancelPendingCommit!==null||x.timeoutHandle!==-1),(O&3)===0||Hi(x,O)||(d=!0,Qd(x,O));x=x.next}while(d);ml=!1}}function D_(){sd()}function sd(){ad=Wd=!1;var r=0;bs!==0&&gm()&&(r=bs);for(var s=dn(),d=null,x=$d;x!==null;){var A=x.next,O=Kd(x,s);O===0?(x.next=null,d===null?$d=A:d.next=A,A===null&&(cf=d)):(d=x,(r!==0||(O&3)!==0)&&(ad=!0)),x=A}Lr!==0&&Lr!==5||fh(r),bs!==0&&(bs=0)}function Kd(r,s){for(var d=r.suspendedLanes,x=r.pingedLanes,A=r.expirationTimes,O=r.pendingLanes&-62914561;0<O;){var W=31-St(O),ce=1<<W,Ve=A[W];Ve===-1?((ce&d)===0||(ce&x)!==0)&&(A[W]=xn(ce,s)):Ve<=s&&(r.expiredLanes|=ce),O&=~ce}if(s=Zi,d=Yn,d=ii(r,r===s?d:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x=r.callbackNode,d===0||r===s&&(Ii===2||Ii===9)||r.cancelPendingCommit!==null)return x!==null&&x!==null&&os(x),r.callbackNode=null,r.callbackPriority=0;if((d&3)===0||Hi(r,d)){if(s=d&-d,s===r.callbackPriority)return s;switch(x!==null&&os(x),Gt(d)){case 2:case 8:d=re;break;case 32:d=te;break;case 268435456:d=Se;break;default:d=te}return x=xg.bind(null,r),d=qs(d,x),r.callbackPriority=s,r.callbackNode=d,s}return x!==null&&x!==null&&os(x),r.callbackPriority=2,r.callbackNode=null,2}function xg(r,s){if(Lr!==0&&Lr!==5)return r.callbackNode=null,r.callbackPriority=0,null;var d=r.callbackNode;if(uf()&&r.callbackNode!==d)return null;var x=Yn;return x=ii(r,r===Zi?x:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),x===0?null:(hg(r,x,s),Kd(r,dn()),r.callbackNode!=null&&r.callbackNode===d?xg.bind(null,r):null)}function Qd(r,s){if(uf())return null;hg(r,s,!0)}function cm(){Bn(function(){(yi&6)!==0?qs(nt,D_):sd()})}function vc(){if(bs===0){var r=Ta;r===0&&(r=yn,yn<<=1,(yn&261888)===0&&(yn=256)),bs=r}return bs}function hm(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:An(""+r)}function fm(r,s){var d=s.ownerDocument.createElement("input");return d.name=s.name,d.value=s.value,r.id&&d.setAttribute("form",r.id),s.parentNode.insertBefore(d,s),r=new FormData(r),d.parentNode.removeChild(d),r}function dm(r,s,d,x,A){if(s==="submit"&&d&&d.stateNode===A){var O=hm((A[Ut]||null).action),W=x.submitter;W&&(s=(s=W[Ut]||null)?hm(s.formAction):W.getAttribute("formAction"),s!==null&&(O=s,W=null));var ce=new ru("action","action",null,x,A);r.push({event:ce,listeners:[{instance:null,listener:function(){if(x.defaultPrevented){if(bs!==0){var Ve=W?fm(A,W):new FormData(A);er(d,{pending:!0,data:Ve,method:A.method,action:O},null,Ve)}}else typeof O=="function"&&(ce.preventDefault(),Ve=W?fm(A,W):new FormData(A),er(d,{pending:!0,data:Ve,method:A.method,action:O},O,Ve))},currentTarget:A}]})}}for(var Jd=0;Jd<hr.length;Jd++){var hf=hr[Jd],bg=hf.toLowerCase(),L_=hf[0].toUpperCase()+hf.slice(1);gi(bg,"on"+L_)}gi(ct,"onAnimationEnd"),gi(Bt,"onAnimationIteration"),gi(Jt,"onAnimationStart"),gi("dblclick","onDoubleClick"),gi("focusin","onFocus"),gi("focusout","onBlur"),gi(sn,"onTransitionRun"),gi(pn,"onTransitionStart"),gi(Nn,"onTransitionCancel"),gi(In,"onTransitionEnd"),Ys("onMouseEnter",["mouseout","mouseover"]),Ys("onMouseLeave",["mouseout","mouseover"]),Ys("onPointerEnter",["pointerout","pointerover"]),Ys("onPointerLeave",["pointerout","pointerover"]),Vn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Vn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Vn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Vn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Vn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var od="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),z_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(od));function wg(r,s){s=(s&4)!==0;for(var d=0;d<r.length;d++){var x=r[d],A=x.event;x=x.listeners;e:{var O=void 0;if(s)for(var W=x.length-1;0<=W;W--){var ce=x[W],Ve=ce.instance,_t=ce.currentTarget;if(ce=ce.listener,Ve!==O&&A.isPropagationStopped())break e;O=ce,A.currentTarget=_t;try{O(A)}catch(kt){Jr(kt)}A.currentTarget=null,O=Ve}else for(W=0;W<x.length;W++){if(ce=x[W],Ve=ce.instance,_t=ce.currentTarget,ce=ce.listener,Ve!==O&&A.isPropagationStopped())break e;O=ce,A.currentTarget=_t;try{O(A)}catch(kt){Jr(kt)}A.currentTarget=null,O=Ve}}}}function Jn(r,s){var d=s[Mn];d===void 0&&(d=s[Mn]=new Set);var x=r+"__bubble";d.has(x)||(pm(s,r,2,!1),d.add(x))}function ld(r,s,d){var x=0;s&&(x|=4),pm(d,r,x,s)}var _l="_reactListening"+Math.random().toString(36).slice(2);function ep(r){if(!r[_l]){r[_l]=!0,ho.forEach(function(d){d!=="selectionchange"&&(z_.has(d)||ld(d,!1,r),ld(d,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[_l]||(s[_l]=!0,ld("selectionchange",!1,s))}}function pm(r,s,d,x){switch(jg(s)){case 2:var A=Im;break;case 8:A=Fg;break;default:A=Sc}d=A.bind(null,s,d,r),A=void 0,!kn||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(A=!0),x?A!==void 0?r.addEventListener(s,d,{capture:!0,passive:A}):r.addEventListener(s,d,!0):A!==void 0?r.addEventListener(s,d,{passive:A}):r.addEventListener(s,d,!1)}function tp(r,s,d,x,A){var O=x;if((s&1)===0&&(s&2)===0&&x!==null)e:for(;;){if(x===null)return;var W=x.tag;if(W===3||W===4){var ce=x.stateNode.containerInfo;if(ce===A)break;if(W===4)for(W=x.return;W!==null;){var Ve=W.tag;if((Ve===3||Ve===4)&&W.stateNode.containerInfo===A)return;W=W.return}for(;ce!==null;){if(W=pi(ce),W===null)return;if(Ve=W.tag,Ve===5||Ve===6||Ve===26||Ve===27){x=O=W;continue e}ce=ce.parentNode}}x=x.return}ei(function(){var _t=O,kt=Kr(d),Ft=[];e:{var yt=hi.get(r);if(yt!==void 0){var bt=ru,un=r;switch(r){case"keypress":if(Si(d)===0)break e;case"keydown":case"keyup":bt=Bi;break;case"focusin":un="focus",bt=yo;break;case"focusout":un="blur",bt=yo;break;case"beforeblur":case"afterblur":bt=yo;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":bt=Yo;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":bt=Tl;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":bt=jc;break;case ct:case Bt:case Jt:bt=Oc;break;case In:bt=va;break;case"scroll":case"scrollend":bt=ha;break;case"wheel":bt=da;break;case"copy":case"cut":case"paste":bt=Nc;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":bt=Sl;break;case"toggle":case"beforetoggle":bt=El}var En=(s&4)!==0,Ai=!En&&(r==="scroll"||r==="scrollend"),rt=En?yt!==null?yt+"Capture":null:yt;En=[];for(var We=_t,gt;We!==null;){var Rt=We;if(gt=Rt.stateNode,Rt=Rt.tag,Rt!==5&&Rt!==26&&Rt!==27||gt===null||rt===null||(Rt=Ha(We,rt),Rt!=null&&En.push(ff(We,Rt,gt))),Ai)break;We=We.return}0<En.length&&(yt=new bt(yt,un,null,d,kt),Ft.push({event:yt,listeners:En}))}}if((s&7)===0){e:{if(yt=r==="mouseover"||r==="pointerover",bt=r==="mouseout"||r==="pointerout",yt&&d!==ya&&(un=d.relatedTarget||d.fromElement)&&(pi(un)||un[Sn]))break e;if((bt||yt)&&(yt=kt.window===kt?kt:(yt=kt.ownerDocument)?yt.defaultView||yt.parentWindow:window,bt?(un=d.relatedTarget||d.toElement,bt=_t,un=un?pi(un):null,un!==null&&(Ai=U(un),En=un.tag,un!==Ai||En!==5&&En!==27&&En!==6)&&(un=null)):(bt=null,un=_t),bt!==un)){if(En=Yo,Rt="onMouseLeave",rt="onMouseEnter",We="mouse",(r==="pointerout"||r==="pointerover")&&(En=Sl,Rt="onPointerLeave",rt="onPointerEnter",We="pointer"),Ai=bt==null?yt:Cs(bt),gt=un==null?yt:Cs(un),yt=new En(Rt,We+"leave",bt,d,kt),yt.target=Ai,yt.relatedTarget=gt,Rt=null,pi(kt)===_t&&(En=new En(rt,We+"enter",un,d,kt),En.target=gt,En.relatedTarget=Ai,Rt=En),Ai=Rt,bt&&un)t:{for(En=Tg,rt=bt,We=un,gt=0,Rt=rt;Rt;Rt=En(Rt))gt++;Rt=0;for(var ln=We;ln;ln=En(ln))Rt++;for(;0<gt-Rt;)rt=En(rt),gt--;for(;0<Rt-gt;)We=En(We),Rt--;for(;gt--;){if(rt===We||We!==null&&rt===We.alternate){En=rt;break t}rt=En(rt),We=En(We)}En=null}else En=null;bt!==null&&cd(Ft,yt,bt,En,!1),un!==null&&Ai!==null&&cd(Ft,Ai,un,En,!0)}}e:{if(yt=_t?Cs(_t):window,bt=yt.nodeName&&yt.nodeName.toLowerCase(),bt==="select"||bt==="input"&&yt.type==="file")var ui=bo;else if(Wu(yt))if(Vc)ui=Gc;else{ui=Qu;var gn=Rh}else bt=yt.nodeName,!bt||bt.toLowerCase()!=="input"||yt.type!=="checkbox"&&yt.type!=="radio"?_t&&Hs(_t.elementType)&&(ui=bo):ui=hu;if(ui&&(ui=ui(r,_t))){lu(Ft,ui,d,kt);break e}gn&&gn(r,yt,_t),r==="focusout"&&_t&&yt.type==="number"&&_t.memoizedProps.value!=null&&iu(yt,"number",yt.value)}switch(gn=_t?Cs(_t):window,r){case"focusin":(Wu(gn)||gn.contentEditable==="true")&&(o=gn,u=_t,g=null);break;case"focusout":g=u=o=null;break;case"mousedown":M=!0;break;case"contextmenu":case"mouseup":case"dragend":M=!1,B(Ft,d,kt);break;case"selectionchange":if(_)break;case"keydown":case"keyup":B(Ft,d,kt)}var Fn;if(Ui)e:{switch(r){case"compositionstart":var Wn="onCompositionStart";break e;case"compositionend":Wn="onCompositionEnd";break e;case"compositionupdate":Wn="onCompositionUpdate";break e}Wn=void 0}else fs?ou(r,d)&&(Wn="onCompositionEnd"):r==="keydown"&&d.keyCode===229&&(Wn="onCompositionStart");Wn&&(Ml&&d.locale!=="ko"&&(fs||Wn!=="onCompositionStart"?Wn==="onCompositionEnd"&&fs&&(Fn=Xs()):(ca=kt,hs="value"in ca?ca.value:ca.textContent,fs=!0)),gn=ud(_t,Wn),0<gn.length&&(Wn=new Bc(Wn,r,null,d,kt),Ft.push({event:Wn,listeners:gn}),Fn?Wn.data=Fn:(Fn=Ih(d),Fn!==null&&(Wn.data=Fn)))),(Fn=vo?$u(r,d):Ah(r,d))&&(Wn=ud(_t,"onBeforeInput"),0<Wn.length&&(gn=new Bc("onBeforeInput","beforeinput",null,d,kt),Ft.push({event:gn,listeners:Wn}),gn.data=Fn)),dm(Ft,r,_t,d,kt)}wg(Ft,s)})}function ff(r,s,d){return{instance:r,listener:s,currentTarget:d}}function ud(r,s){for(var d=s+"Capture",x=[];r!==null;){var A=r,O=A.stateNode;if(A=A.tag,A!==5&&A!==26&&A!==27||O===null||(A=Ha(r,d),A!=null&&x.unshift(ff(r,A,O)),A=Ha(r,s),A!=null&&x.push(ff(r,A,O))),r.tag===3)return x;r=r.return}return[]}function Tg(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function cd(r,s,d,x,A){for(var O=s._reactName,W=[];d!==null&&d!==x;){var ce=d,Ve=ce.alternate,_t=ce.stateNode;if(ce=ce.tag,Ve!==null&&Ve===x)break;ce!==5&&ce!==26&&ce!==27||_t===null||(Ve=_t,A?(_t=Ha(d,O),_t!=null&&W.unshift(ff(d,_t,Ve))):A||(_t=Ha(d,O),_t!=null&&W.push(ff(d,_t,Ve)))),d=d.return}W.length!==0&&r.push({event:s,listeners:W})}var Sg=/\r\n?/g,hd=/\u0000|\uFFFD/g;function mm(r){return(typeof r=="string"?r:""+r).replace(Sg,`
`).replace(hd,"")}function np(r,s){return s=mm(s),mm(r)===s}function Oi(r,s,d,x,A,O){switch(d){case"children":typeof x=="string"?s==="body"||s==="textarea"&&x===""||Rs(r,x):(typeof x=="number"||typeof x=="bigint")&&s!=="body"&&Rs(r,""+x);break;case"className":As(r,"class",x);break;case"tabIndex":As(r,"tabindex",x);break;case"dir":case"role":case"viewBox":case"width":case"height":As(r,d,x);break;case"style":Xu(r,x,O);break;case"data":if(s!=="object"){As(r,"data",x);break}case"src":case"href":if(x===""&&(s!=="a"||d!=="href")){r.removeAttribute(d);break}if(x==null||typeof x=="function"||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(d);break}x=An(""+x),r.setAttribute(d,x);break;case"action":case"formAction":if(typeof x=="function"){r.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof O=="function"&&(d==="formAction"?(s!=="input"&&Oi(r,s,"name",A.name,A,null),Oi(r,s,"formEncType",A.formEncType,A,null),Oi(r,s,"formMethod",A.formMethod,A,null),Oi(r,s,"formTarget",A.formTarget,A,null)):(Oi(r,s,"encType",A.encType,A,null),Oi(r,s,"method",A.method,A,null),Oi(r,s,"target",A.target,A,null)));if(x==null||typeof x=="symbol"||typeof x=="boolean"){r.removeAttribute(d);break}x=An(""+x),r.setAttribute(d,x);break;case"onClick":x!=null&&(r.onclick=Pa);break;case"onScroll":x!=null&&Jn("scroll",r);break;case"onScrollEnd":x!=null&&Jn("scrollend",r);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(I(61));if(d=x.__html,d!=null){if(A.children!=null)throw Error(I(60));r.innerHTML=d}}break;case"multiple":r.multiple=x&&typeof x!="function"&&typeof x!="symbol";break;case"muted":r.muted=x&&typeof x!="function"&&typeof x!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(x==null||typeof x=="function"||typeof x=="boolean"||typeof x=="symbol"){r.removeAttribute("xlink:href");break}d=An(""+x),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(d,""+x):r.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":x&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(d,""):r.removeAttribute(d);break;case"capture":case"download":x===!0?r.setAttribute(d,""):x!==!1&&x!=null&&typeof x!="function"&&typeof x!="symbol"?r.setAttribute(d,x):r.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":x!=null&&typeof x!="function"&&typeof x!="symbol"&&!isNaN(x)&&1<=x?r.setAttribute(d,x):r.removeAttribute(d);break;case"rowSpan":case"start":x==null||typeof x=="function"||typeof x=="symbol"||isNaN(x)?r.removeAttribute(d):r.setAttribute(d,x);break;case"popover":Jn("beforetoggle",r),Jn("toggle",r),Zo(r,"popover",x);break;case"xlinkActuate":qa(r,"http://www.w3.org/1999/xlink","xlink:actuate",x);break;case"xlinkArcrole":qa(r,"http://www.w3.org/1999/xlink","xlink:arcrole",x);break;case"xlinkRole":qa(r,"http://www.w3.org/1999/xlink","xlink:role",x);break;case"xlinkShow":qa(r,"http://www.w3.org/1999/xlink","xlink:show",x);break;case"xlinkTitle":qa(r,"http://www.w3.org/1999/xlink","xlink:title",x);break;case"xlinkType":qa(r,"http://www.w3.org/1999/xlink","xlink:type",x);break;case"xmlBase":qa(r,"http://www.w3.org/XML/1998/namespace","xml:base",x);break;case"xmlLang":qa(r,"http://www.w3.org/XML/1998/namespace","xml:lang",x);break;case"xmlSpace":qa(r,"http://www.w3.org/XML/1998/namespace","xml:space",x);break;case"is":Zo(r,"is",x);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=ri.get(d)||d,Zo(r,d,x))}}function ws(r,s,d,x,A,O){switch(d){case"style":Xu(r,x,O);break;case"dangerouslySetInnerHTML":if(x!=null){if(typeof x!="object"||!("__html"in x))throw Error(I(61));if(d=x.__html,d!=null){if(A.children!=null)throw Error(I(60));r.innerHTML=d}}break;case"children":typeof x=="string"?Rs(r,x):(typeof x=="number"||typeof x=="bigint")&&Rs(r,""+x);break;case"onScroll":x!=null&&Jn("scroll",r);break;case"onScrollEnd":x!=null&&Jn("scrollend",r);break;case"onClick":x!=null&&(r.onclick=Pa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Er.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(A=d.endsWith("Capture"),s=d.slice(2,A?d.length-7:void 0),O=r[Ut]||null,O=O!=null?O[d]:null,typeof O=="function"&&r.removeEventListener(s,O,A),typeof x=="function")){typeof O!="function"&&O!==null&&(d in r?r[d]=null:r.hasAttribute(d)&&r.removeAttribute(d)),r.addEventListener(s,x,A);break e}d in r?r[d]=x:x===!0?r.setAttribute(d,""):Zo(r,d,x)}}}function zr(r,s,d){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Jn("error",r),Jn("load",r);var x=!1,A=!1,O;for(O in d)if(d.hasOwnProperty(O)){var W=d[O];if(W!=null)switch(O){case"src":x=!0;break;case"srcSet":A=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(I(137,s));default:Oi(r,s,O,W,d,null)}}A&&Oi(r,s,"srcSet",d.srcSet,d,null),x&&Oi(r,s,"src",d.src,d,null);return;case"input":Jn("invalid",r);var ce=O=W=A=null,Ve=null,_t=null;for(x in d)if(d.hasOwnProperty(x)){var kt=d[x];if(kt!=null)switch(x){case"name":A=kt;break;case"type":W=kt;break;case"checked":Ve=kt;break;case"defaultChecked":_t=kt;break;case"value":O=kt;break;case"defaultValue":ce=kt;break;case"children":case"dangerouslySetInnerHTML":if(kt!=null)throw Error(I(137,s));break;default:Oi(r,s,x,kt,d,null)}}Hu(r,O,ce,Ve,_t,W,A,!1);return;case"select":Jn("invalid",r),x=W=O=null;for(A in d)if(d.hasOwnProperty(A)&&(ce=d[A],ce!=null))switch(A){case"value":O=ce;break;case"defaultValue":W=ce;break;case"multiple":x=ce;default:Oi(r,s,A,ce,d,null)}s=O,d=W,r.multiple=!!x,s!=null?fo(r,!!x,s,!1):d!=null&&fo(r,!!x,d,!0);return;case"textarea":Jn("invalid",r),O=A=x=null;for(W in d)if(d.hasOwnProperty(W)&&(ce=d[W],ce!=null))switch(W){case"value":x=ce;break;case"defaultValue":A=ce;break;case"children":O=ce;break;case"dangerouslySetInnerHTML":if(ce!=null)throw Error(I(91));break;default:Oi(r,s,W,ce,d,null)}Ps(r,x,A,O);return;case"option":for(Ve in d)if(d.hasOwnProperty(Ve)&&(x=d[Ve],x!=null))switch(Ve){case"selected":r.selected=x&&typeof x!="function"&&typeof x!="symbol";break;default:Oi(r,s,Ve,x,d,null)}return;case"dialog":Jn("beforetoggle",r),Jn("toggle",r),Jn("cancel",r),Jn("close",r);break;case"iframe":case"object":Jn("load",r);break;case"video":case"audio":for(x=0;x<od.length;x++)Jn(od[x],r);break;case"image":Jn("error",r),Jn("load",r);break;case"details":Jn("toggle",r);break;case"embed":case"source":case"link":Jn("error",r),Jn("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(_t in d)if(d.hasOwnProperty(_t)&&(x=d[_t],x!=null))switch(_t){case"children":case"dangerouslySetInnerHTML":throw Error(I(137,s));default:Oi(r,s,_t,x,d,null)}return;default:if(Hs(s)){for(kt in d)d.hasOwnProperty(kt)&&(x=d[kt],x!==void 0&&ws(r,s,kt,x,d,void 0));return}}for(ce in d)d.hasOwnProperty(ce)&&(x=d[ce],x!=null&&Oi(r,s,ce,x,d,null))}function fd(r,s,d,x){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var A=null,O=null,W=null,ce=null,Ve=null,_t=null,kt=null;for(bt in d){var Ft=d[bt];if(d.hasOwnProperty(bt)&&Ft!=null)switch(bt){case"checked":break;case"value":break;case"defaultValue":Ve=Ft;default:x.hasOwnProperty(bt)||Oi(r,s,bt,null,x,Ft)}}for(var yt in x){var bt=x[yt];if(Ft=d[yt],x.hasOwnProperty(yt)&&(bt!=null||Ft!=null))switch(yt){case"type":O=bt;break;case"name":A=bt;break;case"checked":_t=bt;break;case"defaultChecked":kt=bt;break;case"value":W=bt;break;case"defaultValue":ce=bt;break;case"children":case"dangerouslySetInnerHTML":if(bt!=null)throw Error(I(137,s));break;default:bt!==Ft&&Oi(r,s,yt,bt,x,Ft)}}nu(r,W,ce,Ve,_t,kt,O,A);return;case"select":bt=W=ce=yt=null;for(O in d)if(Ve=d[O],d.hasOwnProperty(O)&&Ve!=null)switch(O){case"value":break;case"multiple":bt=Ve;default:x.hasOwnProperty(O)||Oi(r,s,O,null,x,Ve)}for(A in x)if(O=x[A],Ve=d[A],x.hasOwnProperty(A)&&(O!=null||Ve!=null))switch(A){case"value":yt=O;break;case"defaultValue":ce=O;break;case"multiple":W=O;default:O!==Ve&&Oi(r,s,A,O,x,Ve)}s=ce,d=W,x=bt,yt!=null?fo(r,!!d,yt,!1):!!x!=!!d&&(s!=null?fo(r,!!d,s,!0):fo(r,!!d,d?[]:"",!1));return;case"textarea":bt=yt=null;for(ce in d)if(A=d[ce],d.hasOwnProperty(ce)&&A!=null&&!x.hasOwnProperty(ce))switch(ce){case"value":break;case"children":break;default:Oi(r,s,ce,null,x,A)}for(W in x)if(A=x[W],O=d[W],x.hasOwnProperty(W)&&(A!=null||O!=null))switch(W){case"value":yt=A;break;case"defaultValue":bt=A;break;case"children":break;case"dangerouslySetInnerHTML":if(A!=null)throw Error(I(91));break;default:A!==O&&Oi(r,s,W,A,x,O)}zc(r,yt,bt);return;case"option":for(var un in d)if(yt=d[un],d.hasOwnProperty(un)&&yt!=null&&!x.hasOwnProperty(un))switch(un){case"selected":r.selected=!1;break;default:Oi(r,s,un,null,x,yt)}for(Ve in x)if(yt=x[Ve],bt=d[Ve],x.hasOwnProperty(Ve)&&yt!==bt&&(yt!=null||bt!=null))switch(Ve){case"selected":r.selected=yt&&typeof yt!="function"&&typeof yt!="symbol";break;default:Oi(r,s,Ve,yt,x,bt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var En in d)yt=d[En],d.hasOwnProperty(En)&&yt!=null&&!x.hasOwnProperty(En)&&Oi(r,s,En,null,x,yt);for(_t in x)if(yt=x[_t],bt=d[_t],x.hasOwnProperty(_t)&&yt!==bt&&(yt!=null||bt!=null))switch(_t){case"children":case"dangerouslySetInnerHTML":if(yt!=null)throw Error(I(137,s));break;default:Oi(r,s,_t,yt,x,bt)}return;default:if(Hs(s)){for(var Ai in d)yt=d[Ai],d.hasOwnProperty(Ai)&&yt!==void 0&&!x.hasOwnProperty(Ai)&&ws(r,s,Ai,void 0,x,yt);for(kt in x)yt=x[kt],bt=d[kt],!x.hasOwnProperty(kt)||yt===bt||yt===void 0&&bt===void 0||ws(r,s,kt,yt,x,bt);return}}for(var rt in d)yt=d[rt],d.hasOwnProperty(rt)&&yt!=null&&!x.hasOwnProperty(rt)&&Oi(r,s,rt,null,x,yt);for(Ft in x)yt=x[Ft],bt=d[Ft],!x.hasOwnProperty(Ft)||yt===bt||yt==null&&bt==null||Oi(r,s,Ft,yt,x,bt)}function Eg(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function Mg(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,d=performance.getEntriesByType("resource"),x=0;x<d.length;x++){var A=d[x],O=A.transferSize,W=A.initiatorType,ce=A.duration;if(O&&ce&&Eg(W)){for(W=0,ce=A.responseEnd,x+=1;x<d.length;x++){var Ve=d[x],_t=Ve.startTime;if(_t>ce)break;var kt=Ve.transferSize,Ft=Ve.initiatorType;kt&&Eg(Ft)&&(Ve=Ve.responseEnd,W+=kt*(Ve<ce?1:(ce-_t)/(Ve-_t)))}if(--x,s+=8*(O+W)/(A.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var ip=null,rp=null;function Du(r){return r.nodeType===9?r:r.ownerDocument}function dd(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ap(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function pd(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var sp=null;function gm(){var r=window.event;return r&&r.type==="popstate"?r===sp?!1:(sp=r,!0):(sp=null,!1)}var op=typeof setTimeout=="function"?setTimeout:void 0,O_=typeof clearTimeout=="function"?clearTimeout:void 0,Cg=typeof Promise=="function"?Promise:void 0,Bn=typeof queueMicrotask=="function"?queueMicrotask:typeof Cg<"u"?function(r){return Cg.resolve(null).then(r).catch(Lu)}:op;function Lu(r){setTimeout(function(){throw r})}function or(r){return r==="head"}function Bo(r,s){var d=s,x=0;do{var A=d.nextSibling;if(r.removeChild(d),A&&A.nodeType===8)if(d=A.data,d==="/$"||d==="/&"){if(x===0){r.removeChild(A),Tf(s);return}x--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")x++;else if(d==="html")df(r.ownerDocument.documentElement);else if(d==="head"){d=r.ownerDocument.head,df(d);for(var O=d.firstChild;O;){var W=O.nextSibling,ce=O.nodeName;O[wn]||ce==="SCRIPT"||ce==="STYLE"||ce==="LINK"&&O.rel.toLowerCase()==="stylesheet"||d.removeChild(O),O=W}}else d==="body"&&df(r.ownerDocument.body);d=A}while(d);Tf(s)}function xc(r,s){var d=r;r=0;do{var x=d.nextSibling;if(d.nodeType===1?s?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(s?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),x&&x.nodeType===8)if(d=x.data,d==="/$"){if(r===0)break;r--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||r++;d=x}while(d)}function es(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var d=s;switch(s=s.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":es(d),ls(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}r.removeChild(d)}}function sa(r,s,d,x){for(;r.nodeType===1;){var A=d;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!x&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(x){if(!r[wn])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(O=r.getAttribute("rel"),O==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(O!==A.rel||r.getAttribute("href")!==(A.href==null||A.href===""?null:A.href)||r.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin)||r.getAttribute("title")!==(A.title==null?null:A.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(O=r.getAttribute("src"),(O!==(A.src==null?null:A.src)||r.getAttribute("type")!==(A.type==null?null:A.type)||r.getAttribute("crossorigin")!==(A.crossOrigin==null?null:A.crossOrigin))&&O&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var O=A.name==null?null:""+A.name;if(A.type==="hidden"&&r.getAttribute("name")===O)return r}else return r;if(r=Fo(r.nextSibling),r===null)break}return null}function oa(r,s,d){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!d||(r=Fo(r.nextSibling),r===null))return null;return r}function _m(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=Fo(r.nextSibling),r===null))return null;return r}function Ts(r){return r.data==="$?"||r.data==="$~"}function qr(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function lp(r,s){var d=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||d.readyState!=="loading")s();else{var x=function(){s(),d.removeEventListener("DOMContentLoaded",x)};d.addEventListener("DOMContentLoaded",x),r._reactRetry=x}}function Fo(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var up=null;function bc(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="/$"||d==="/&"){if(s===0)return Fo(r.nextSibling);s--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||s++}r=r.nextSibling}return null}function dh(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var d=r.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(s===0)return r;s--}else d!=="/$"&&d!=="/&"||s++}r=r.previousSibling}return null}function Ig(r,s,d){switch(s=Du(d),r){case"html":if(r=s.documentElement,!r)throw Error(I(452));return r;case"head":if(r=s.head,!r)throw Error(I(453));return r;case"body":if(r=s.body,!r)throw Error(I(454));return r;default:throw Error(I(451))}}function df(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);ls(r)}var oo=new Map,ym=new Set;function pf(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var Hl=Pe.d;Pe.d={f:vm,r:ts,D:wc,C:cp,L:xm,m:Ag,X:Pg,S:kg,M:Rg};function vm(){var r=Hl.f(),s=nd();return r||s}function ts(r){var s=Zs(r);s!==null&&s.tag===5&&s.type==="form"?ra(s):Hl.r(r)}var ns=typeof document>"u"?null:document;function Ua(r,s,d){var x=ns;if(x&&typeof s=="string"&&s){var A=cr(s);A='link[rel="'+r+'"][href="'+A+'"]',typeof d=="string"&&(A+='[crossorigin="'+d+'"]'),ym.has(A)||(ym.add(A),r={rel:r,crossOrigin:d,href:s},x.querySelector(A)===null&&(s=x.createElement("link"),zr(s,"link",r),Ti(s),x.head.appendChild(s)))}}function wc(r){Hl.D(r),Ua("dns-prefetch",r,null)}function cp(r,s){Hl.C(r,s),Ua("preconnect",r,s)}function xm(r,s,d){Hl.L(r,s,d);var x=ns;if(x&&r&&s){var A='link[rel="preload"][as="'+cr(s)+'"]';s==="image"&&d&&d.imageSrcSet?(A+='[imagesrcset="'+cr(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(A+='[imagesizes="'+cr(d.imageSizes)+'"]')):A+='[href="'+cr(r)+'"]';var O=A;switch(s){case"style":O=zu(r);break;case"script":O=Tc(r)}oo.has(O)||(r=ie({rel:"preload",href:s==="image"&&d&&d.imageSrcSet?void 0:r,as:s},d),oo.set(O,r),x.querySelector(A)!==null||s==="style"&&x.querySelector(mf(O))||s==="script"&&x.querySelector(_f(O))||(s=x.createElement("link"),zr(s,"link",r),Ti(s),x.head.appendChild(s)))}}function Ag(r,s){Hl.m(r,s);var d=ns;if(d&&r){var x=s&&typeof s.as=="string"?s.as:"script",A='link[rel="modulepreload"][as="'+cr(x)+'"][href="'+cr(r)+'"]',O=A;switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":O=Tc(r)}if(!oo.has(O)&&(r=ie({rel:"modulepreload",href:r},s),oo.set(O,r),d.querySelector(A)===null)){switch(x){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(_f(O)))return}x=d.createElement("link"),zr(x,"link",r),Ti(x),d.head.appendChild(x)}}}function kg(r,s,d){Hl.S(r,s,d);var x=ns;if(x&&r){var A=ka(x).hoistableStyles,O=zu(r);s=s||"default";var W=A.get(O);if(!W){var ce={loading:0,preload:null};if(W=x.querySelector(mf(O)))ce.loading=5;else{r=ie({rel:"stylesheet",href:r,"data-precedence":s},d),(d=oo.get(O))&&yf(r,d);var Ve=W=x.createElement("link");Ti(Ve),zr(Ve,"link",r),Ve._p=new Promise(function(_t,kt){Ve.onload=_t,Ve.onerror=kt}),Ve.addEventListener("load",function(){ce.loading|=1}),Ve.addEventListener("error",function(){ce.loading|=2}),ce.loading|=4,md(W,s,x)}W={type:"stylesheet",instance:W,count:1,state:ce},A.set(O,W)}}}function Pg(r,s){Hl.X(r,s);var d=ns;if(d&&r){var x=ka(d).hoistableScripts,A=Tc(r),O=x.get(A);O||(O=d.querySelector(_f(A)),O||(r=ie({src:r,async:!0},s),(s=oo.get(A))&&vf(r,s),O=d.createElement("script"),Ti(O),zr(O,"link",r),d.head.appendChild(O)),O={type:"script",instance:O,count:1,state:null},x.set(A,O))}}function Rg(r,s){Hl.M(r,s);var d=ns;if(d&&r){var x=ka(d).hoistableScripts,A=Tc(r),O=x.get(A);O||(O=d.querySelector(_f(A)),O||(r=ie({src:r,async:!0,type:"module"},s),(s=oo.get(A))&&vf(r,s),O=d.createElement("script"),Ti(O),zr(O,"link",r),d.head.appendChild(O)),O={type:"script",instance:O,count:1,state:null},x.set(A,O))}}function hp(r,s,d,x){var A=(A=tn.current)?pf(A):null;if(!A)throw Error(I(446));switch(r){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(s=zu(d.href),d=ka(A).hoistableStyles,x=d.get(s),x||(x={type:"style",instance:null,count:0,state:null},d.set(s,x)),x):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){r=zu(d.href);var O=ka(A).hoistableStyles,W=O.get(r);if(W||(A=A.ownerDocument||A,W={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},O.set(r,W),(O=A.querySelector(mf(r)))&&!O._p&&(W.instance=O,W.state.loading=5),oo.has(r)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},oo.set(r,d),O||gf(A,r,d,W.state))),s&&x===null)throw Error(I(528,""));return W}if(s&&x!==null)throw Error(I(529,""));return null;case"script":return s=d.async,d=d.src,typeof d=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Tc(d),d=ka(A).hoistableScripts,x=d.get(s),x||(x={type:"script",instance:null,count:0,state:null},d.set(s,x)),x):{type:"void",instance:null,count:0,state:null};default:throw Error(I(444,r))}}function zu(r){return'href="'+cr(r)+'"'}function mf(r){return'link[rel="stylesheet"]['+r+"]"}function bm(r){return ie({},r,{"data-precedence":r.precedence,precedence:null})}function gf(r,s,d,x){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?x.loading=1:(s=r.createElement("link"),x.preload=s,s.addEventListener("load",function(){return x.loading|=1}),s.addEventListener("error",function(){return x.loading|=2}),zr(s,"link",d),Ti(s),r.head.appendChild(s))}function Tc(r){return'[src="'+cr(r)+'"]'}function _f(r){return"script[async]"+r}function Dg(r,s,d){if(s.count++,s.instance===null)switch(s.type){case"style":var x=r.querySelector('style[data-href~="'+cr(d.href)+'"]');if(x)return s.instance=x,Ti(x),x;var A=ie({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return x=(r.ownerDocument||r).createElement("style"),Ti(x),zr(x,"style",A),md(x,d.precedence,r),s.instance=x;case"stylesheet":A=zu(d.href);var O=r.querySelector(mf(A));if(O)return s.state.loading|=4,s.instance=O,Ti(O),O;x=bm(d),(A=oo.get(A))&&yf(x,A),O=(r.ownerDocument||r).createElement("link"),Ti(O);var W=O;return W._p=new Promise(function(ce,Ve){W.onload=ce,W.onerror=Ve}),zr(O,"link",x),s.state.loading|=4,md(O,d.precedence,r),s.instance=O;case"script":return O=Tc(d.src),(A=r.querySelector(_f(O)))?(s.instance=A,Ti(A),A):(x=d,(A=oo.get(O))&&(x=ie({},d),vf(x,A)),r=r.ownerDocument||r,A=r.createElement("script"),Ti(A),zr(A,"link",x),r.head.appendChild(A),s.instance=A);case"void":return null;default:throw Error(I(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(x=s.instance,s.state.loading|=4,md(x,d.precedence,r));return s.instance}function md(r,s,d){for(var x=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),A=x.length?x[x.length-1]:null,O=A,W=0;W<x.length;W++){var ce=x[W];if(ce.dataset.precedence===s)O=ce;else if(O!==A)break}O?O.parentNode.insertBefore(r,O.nextSibling):(s=d.nodeType===9?d.head:d,s.insertBefore(r,s.firstChild))}function yf(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function vf(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var ph=null;function fp(r,s,d){if(ph===null){var x=new Map,A=ph=new Map;A.set(d,x)}else A=ph,x=A.get(d),x||(x=new Map,A.set(d,x));if(x.has(r))return x;for(x.set(r,null),d=d.getElementsByTagName(r),A=0;A<d.length;A++){var O=d[A];if(!(O[wn]||O[di]||r==="link"&&O.getAttribute("rel")==="stylesheet")&&O.namespaceURI!=="http://www.w3.org/2000/svg"){var W=O.getAttribute(s)||"";W=r+W;var ce=x.get(W);ce?ce.push(O):x.set(W,[O])}}return x}function dp(r,s,d){r=r.ownerDocument||r,r.head.insertBefore(d,s==="title"?r.querySelector("head > title"):null)}function wm(r,s,d){if(d===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;switch(s.rel){case"stylesheet":return r=s.disabled,typeof s.precedence=="string"&&r==null;default:return!0}case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function Tm(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function Lg(r,s,d,x){if(d.type==="stylesheet"&&(typeof x.media!="string"||matchMedia(x.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var A=zu(x.href),O=s.querySelector(mf(A));if(O){s=O._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=gd.bind(r),s.then(r,r)),d.state.loading|=4,d.instance=O,Ti(O);return}O=s.ownerDocument||s,x=bm(x),(A=oo.get(A))&&yf(x,A),O=O.createElement("link"),Ti(O);var W=O;W._p=new Promise(function(ce,Ve){W.onload=ce,W.onerror=Ve}),zr(O,"link",x),d.instance=O}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(d,s),(s=d.state.preload)&&(d.state.loading&3)===0&&(r.count++,d=gd.bind(r),s.addEventListener("load",d),s.addEventListener("error",d))}}var pp=0;function zg(r,s){return r.stylesheets&&r.count===0&&_d(r,r.stylesheets),0<r.count||0<r.imgCount?function(d){var x=setTimeout(function(){if(r.stylesheets&&_d(r,r.stylesheets),r.unsuspend){var O=r.unsuspend;r.unsuspend=null,O()}},6e4+s);0<r.imgBytes&&pp===0&&(pp=62500*Mg());var A=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&_d(r,r.stylesheets),r.unsuspend)){var O=r.unsuspend;r.unsuspend=null,O()}},(r.imgBytes>pp?50:800)+s);return r.unsuspend=d,function(){r.unsuspend=null,clearTimeout(x),clearTimeout(A)}}:null}function gd(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)_d(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var mp=null;function _d(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,mp=new Map,s.forEach(N_,r),mp=null,gd.call(r))}function N_(r,s){if(!(s.state.loading&4)){var d=mp.get(r);if(d)var x=d.get(null);else{d=new Map,mp.set(r,d);for(var A=r.querySelectorAll("link[data-precedence],style[data-precedence]"),O=0;O<A.length;O++){var W=A[O];(W.nodeName==="LINK"||W.getAttribute("media")!=="not all")&&(d.set(W.dataset.precedence,W),x=W)}x&&d.set(null,x)}A=s.instance,W=A.getAttribute("data-precedence"),O=d.get(W)||x,O===x&&d.set(null,A),d.set(W,A),this.count++,x=gd.bind(this),A.addEventListener("load",x),A.addEventListener("error",x),O?O.parentNode.insertBefore(A,O.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(A,r.firstChild)),s.state.loading|=4}}var yd={$$typeof:at,Provider:null,Consumer:null,_currentValue:Ue,_currentValue2:Ue,_threadCount:0};function Sm(r,s,d,x,A,O,W,ce,Ve){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Xi(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xi(0),this.hiddenUpdates=Xi(null),this.identifierPrefix=x,this.onUncaughtError=A,this.onCaughtError=O,this.onRecoverableError=W,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ve,this.incompleteTransitions=new Map}function Em(r,s,d,x,A,O,W,ce,Ve,_t,kt,Ft){return r=new Sm(r,s,d,W,Ve,_t,kt,Ft,ce),s=1,O===!0&&(s|=24),O=ds(3,null,null,s),r.current=O,O.stateNode=r,s=zl(),s.refCount++,r.pooledCache=s,s.refCount++,O.memoizedState={element:x,isDehydrated:d,cache:s},qh(O),r}function Og(r){return r?(r=Ln,r):Ln}function Ng(r,s,d,x,A,O){A=Og(A),x.context===null?x.context=A:x.pendingContext=A,x=Hn(s),x.payload={element:d},O=O===void 0?null:O,O!==null&&(x.callback=O),d=al(r,x,s),d!==null&&(js(d,r,s),jl(d,r,s))}function Mm(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var d=r.retryLane;r.retryLane=d!==0&&d<s?d:s}}function mh(r,s){Mm(r,s),(r=r.alternate)&&Mm(r,s)}function Cm(r){if(r.tag===13||r.tag===31){var s=Da(r,67108864);s!==null&&js(s,r,67108864),mh(r,67108864)}}function Bg(r){if(r.tag===13||r.tag===31){var s=vi();s=Aa(s);var d=Da(r,s);d!==null&&js(d,r,s),mh(r,s)}}var xf=!0;function Im(r,s,d,x){var A=me.T;me.T=null;var O=Pe.p;try{Pe.p=2,Sc(r,s,d,x)}finally{Pe.p=O,me.T=A}}function Fg(r,s,d,x){var A=me.T;me.T=null;var O=Pe.p;try{Pe.p=8,Sc(r,s,d,x)}finally{Pe.p=O,me.T=A}}function Sc(r,s,d,x){if(xf){var A=gp(x);if(A===null)tp(r,s,x,_p,d),km(r,x);else if(F_(A,r,s,d,x))x.stopPropagation();else if(km(r,x),s&4&&-1<B_.indexOf(r)){for(;A!==null;){var O=Zs(A);if(O!==null)switch(O.tag){case 3:if(O=O.stateNode,O.current.memoizedState.isDehydrated){var W=it(O.pendingLanes);if(W!==0){var ce=O;for(ce.pendingLanes|=2,ce.entangledLanes|=2;W;){var Ve=1<<31-St(W);ce.entanglements[1]|=Ve,W&=~Ve}gl(O),(yi&6)===0&&(Jf=dn()+500,fh(0))}}break;case 31:case 13:ce=Da(O,2),ce!==null&&js(ce,O,2),nd(),mh(O,2)}if(O=gp(x),O===null&&tp(r,s,x,_p,d),O===A)break;A=O}A!==null&&x.stopPropagation()}else tp(r,s,x,null,d)}}function gp(r){return r=Kr(r),gh(r)}var _p=null;function gh(r){if(_p=null,r=pi(r),r!==null){var s=U(r);if(s===null)r=null;else{var d=s.tag;if(d===13){if(r=L(s),r!==null)return r;r=null}else if(d===31){if(r=c(s),r!==null)return r;r=null}else if(d===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return _p=r,null}function jg(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Sr()){case nt:return 2;case re:return 8;case te:case he:return 32;case Se:return 268435456;default:return 32}default:return 32}}var Am=!1,Ou=null,Nu=null,Ec=null,vd=new Map,xd=new Map,Mc=[],B_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function km(r,s){switch(r){case"focusin":case"focusout":Ou=null;break;case"dragenter":case"dragleave":Nu=null;break;case"mouseover":case"mouseout":Ec=null;break;case"pointerover":case"pointerout":vd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":xd.delete(s.pointerId)}}function yl(r,s,d,x,A,O){return r===null||r.nativeEvent!==O?(r={blockedOn:s,domEventName:d,eventSystemFlags:x,nativeEvent:O,targetContainers:[A]},s!==null&&(s=Zs(s),s!==null&&Cm(s)),r):(r.eventSystemFlags|=x,s=r.targetContainers,A!==null&&s.indexOf(A)===-1&&s.push(A),r)}function F_(r,s,d,x,A){switch(s){case"focusin":return Ou=yl(Ou,r,s,d,x,A),!0;case"dragenter":return Nu=yl(Nu,r,s,d,x,A),!0;case"mouseover":return Ec=yl(Ec,r,s,d,x,A),!0;case"pointerover":var O=A.pointerId;return vd.set(O,yl(vd.get(O)||null,r,s,d,x,A)),!0;case"gotpointercapture":return O=A.pointerId,xd.set(O,yl(xd.get(O)||null,r,s,d,x,A)),!0}return!1}function bf(r){var s=pi(r.target);if(s!==null){var d=U(s);if(d!==null){if(s=d.tag,s===13){if(s=L(d),s!==null){r.blockedOn=s,Xr(r.priority,function(){Bg(d)});return}}else if(s===31){if(s=c(d),s!==null){r.blockedOn=s,Xr(r.priority,function(){Bg(d)});return}}else if(s===3&&d.stateNode.current.memoizedState.isDehydrated){r.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}r.blockedOn=null}function yp(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var d=gp(r.nativeEvent);if(d===null){d=r.nativeEvent;var x=new d.constructor(d.type,d);ya=x,d.target.dispatchEvent(x),ya=null}else return s=Zs(d),s!==null&&Cm(s),r.blockedOn=d,!1;s.shift()}return!0}function Ug(r,s,d){yp(r)&&d.delete(s)}function j_(){Am=!1,Ou!==null&&yp(Ou)&&(Ou=null),Nu!==null&&yp(Nu)&&(Nu=null),Ec!==null&&yp(Ec)&&(Ec=null),vd.forEach(Ug),xd.forEach(Ug)}function wf(r,s){r.blockedOn===s&&(r.blockedOn=null,Am||(Am=!0,S.unstable_scheduleCallback(S.unstable_NormalPriority,j_)))}var bd=null;function Vg(r){bd!==r&&(bd=r,S.unstable_scheduleCallback(S.unstable_NormalPriority,function(){bd===r&&(bd=null);for(var s=0;s<r.length;s+=3){var d=r[s],x=r[s+1],A=r[s+2];if(typeof x!="function"){if(gh(x||d)===null)continue;break}var O=Zs(d);O!==null&&(r.splice(s,3),s-=3,er(O,{pending:!0,data:A,method:d.method,action:x},x,A))}}))}function Tf(r){function s(Ve){return wf(Ve,r)}Ou!==null&&wf(Ou,r),Nu!==null&&wf(Nu,r),Ec!==null&&wf(Ec,r),vd.forEach(s),xd.forEach(s);for(var d=0;d<Mc.length;d++){var x=Mc[d];x.blockedOn===r&&(x.blockedOn=null)}for(;0<Mc.length&&(d=Mc[0],d.blockedOn===null);)bf(d),d.blockedOn===null&&Mc.shift();if(d=(r.ownerDocument||r).$$reactFormReplay,d!=null)for(x=0;x<d.length;x+=3){var A=d[x],O=d[x+1],W=A[Ut]||null;if(typeof O=="function")W||Vg(d);else if(W){var ce=null;if(O&&O.hasAttribute("formAction")){if(A=O,W=O[Ut]||null)ce=W.formAction;else if(gh(A)!==null)continue}else ce=W.action;typeof ce=="function"?d[x+1]=ce:(d.splice(x,3),x-=3),Vg(d)}}}function Pm(){function r(O){O.canIntercept&&O.info==="react-transition"&&O.intercept({handler:function(){return new Promise(function(W){return A=W})},focusReset:"manual",scroll:"manual"})}function s(){A!==null&&(A(),A=null),x||setTimeout(d,20)}function d(){if(!x&&!navigation.transition){var O=navigation.currentEntry;O&&O.url!=null&&navigation.navigate(O.url,{state:O.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var x=!1,A=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(d,100),function(){x=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),A!==null&&(A(),A=null)}}}function vp(r){this._internalRoot=r}xp.prototype.render=vp.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(I(409));var d=s.current,x=vi();Ng(d,x,r,s,null,null)},xp.prototype.unmount=vp.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;Ng(r.current,2,null,r,null,null),nd(),s[Sn]=null}};function xp(r){this._internalRoot=r}xp.prototype.unstable_scheduleHydration=function(r){if(r){var s=_r();r={blockedOn:null,target:r,priority:s};for(var d=0;d<Mc.length&&s!==0&&s<Mc[d].priority;d++);Mc.splice(d,0,r),d===0&&bf(r)}};var Rm=C.version;if(Rm!=="19.2.3")throw Error(I(527,Rm,"19.2.3"));Pe.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(I(188)):(r=Object.keys(r).join(","),Error(I(268,r)));return r=ne(s),r=r!==null?fe(r):null,r=r===null?null:r.stateNode,r};var Gg={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:me,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bp.isDisabled&&bp.supportsFiber)try{Je=bp.inject(Gg),qe=bp}catch{}}return Nm.createRoot=function(r,s){if(!D(r))throw Error(I(299));var d=!1,x="",A=Gl,O=dl,W=jf;return s!=null&&(s.unstable_strictMode===!0&&(d=!0),s.identifierPrefix!==void 0&&(x=s.identifierPrefix),s.onUncaughtError!==void 0&&(A=s.onUncaughtError),s.onCaughtError!==void 0&&(O=s.onCaughtError),s.onRecoverableError!==void 0&&(W=s.onRecoverableError)),s=Em(r,1,!1,null,null,d,x,null,A,O,W,Pm),r[Sn]=s.current,ep(r),new vp(s)},Nm.hydrateRoot=function(r,s,d){if(!D(r))throw Error(I(299));var x=!1,A="",O=Gl,W=dl,ce=jf,Ve=null;return d!=null&&(d.unstable_strictMode===!0&&(x=!0),d.identifierPrefix!==void 0&&(A=d.identifierPrefix),d.onUncaughtError!==void 0&&(O=d.onUncaughtError),d.onCaughtError!==void 0&&(W=d.onCaughtError),d.onRecoverableError!==void 0&&(ce=d.onRecoverableError),d.formState!==void 0&&(Ve=d.formState)),s=Em(r,1,!0,s,d??null,x,A,Ve,O,W,ce,Pm),s.context=Og(null),d=s.current,x=vi(),x=Aa(x),A=Hn(x),A.callback=null,al(d,A,x),d=x,s.current.lanes=d,Kn(s,d),gl(s),r[Sn]=s.current,ep(r),new xp(s)},Nm.version="19.2.3",Nm}var Hy;function Z0(){if(Hy)return Q_.exports;Hy=1;function S(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(S)}catch(C){console.error(C)}}return S(),Q_.exports=q0(),Q_.exports}var Y0=Z0(),n_={exports:{}};var H0=n_.exports,Xy;function X0(){return Xy||(Xy=1,(function(S,C){(function(P,I){S.exports=I()})(H0,(function(){var P={},I={};function D(L,c,X){if(I[L]=X,L==="index"){var ne="var sharedModule = {}; ("+I.shared+")(sharedModule); ("+I.worker+")(sharedModule);",fe={};return I.shared(fe),I.index(P,fe),typeof window<"u"&&P.setWorkerUrl(window.URL.createObjectURL(new Blob([ne],{type:"text/javascript"}))),P}}D("shared",["exports"],(function(L){function c(i,e,n,l){return new(n||(n=Promise))((function(f,m){function y(R){try{E(l.next(R))}catch(N){m(N)}}function w(R){try{E(l.throw(R))}catch(N){m(N)}}function E(R){var N;R.done?f(R.value):(N=R.value,N instanceof n?N:new n((function(j){j(N)}))).then(y,w)}E((l=l.apply(i,e||[])).next())}))}function X(i,e){this.x=i,this.y=e}function ne(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var fe,ie;typeof SuppressedError=="function"&&SuppressedError,X.prototype={clone(){return new X(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,e){return this.clone()._rotateAround(i,e)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const e=i.x-this.x,n=i.y-this.y;return e*e+n*n},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,e){return Math.atan2(this.x*e-this.y*i,this.x*i+this.y*e)},_matMult(i){const e=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=e,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const e=Math.cos(i),n=Math.sin(i),l=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=l,this},_rotateAround(i,e){const n=Math.cos(i),l=Math.sin(i),f=e.y+l*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-l*(this.y-e.y),this.y=f,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:X},X.convert=function(i){if(i instanceof X)return i;if(Array.isArray(i))return new X(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new X(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var xe=(function(){if(ie)return fe;function i(e,n,l,f){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=f}return ie=1,fe=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,f=0;f<8;f++){var m=this.sampleCurveX(l)-e;if(Math.abs(m)<n)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=m/y}var w=0,E=1;for(l=e,f=0;f<20&&(m=this.sampleCurveX(l),!(Math.abs(m-e)<n));f++)e>m?w=l:E=l,l=.5*(E-w)+w;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},fe})(),Be=ne(xe);let Ge,dt;function Ce(){return Ge==null&&(Ge=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Ge}function It(){if(dt==null&&(dt=!1,Ce())){const e=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(e){for(let l=0;l<25;l++){const f=4*l;e.fillStyle=`rgb(${f},${f+1},${f+2})`,e.fillRect(l%5,Math.floor(l/5),1,1)}const n=e.getImageData(0,0,5,5).data;for(let l=0;l<100;l++)if(l%4!=3&&n[l]!==l){dt=!0;break}}}return dt||!1}var Ye=1e-6,at=typeof Float32Array<"u"?Float32Array:Array;function jt(){var i=new at(9);return at!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function At(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Vt(){var i=new at(3);return at!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function wt(i){var e=i[0],n=i[1],l=i[2];return Math.sqrt(e*e+n*n+l*l)}function oe(i,e,n){var l=new at(3);return l[0]=i,l[1]=e,l[2]=n,l}function de(i,e,n){return i[0]=e[0]+n[0],i[1]=e[1]+n[1],i[2]=e[2]+n[2],i}function Ie(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i}function Xe(i,e,n){var l=e[0],f=e[1],m=e[2],y=n[0],w=n[1],E=n[2];return i[0]=f*E-m*w,i[1]=m*y-l*E,i[2]=l*w-f*y,i}var Ne,He=wt;function Fe(i,e,n){var l=e[0],f=e[1],m=e[2],y=e[3];return i[0]=n[0]*l+n[4]*f+n[8]*m+n[12]*y,i[1]=n[1]*l+n[5]*f+n[9]*m+n[13]*y,i[2]=n[2]*l+n[6]*f+n[10]*m+n[14]*y,i[3]=n[3]*l+n[7]*f+n[11]*m+n[15]*y,i}function Le(){var i=new at(4);return at!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function me(i,e,n,l){var f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",m=Math.PI/360;e*=m,l*=m,n*=m;var y=Math.sin(e),w=Math.cos(e),E=Math.sin(n),R=Math.cos(n),N=Math.sin(l),j=Math.cos(l);switch(f){case"xyz":i[0]=y*R*j+w*E*N,i[1]=w*E*j-y*R*N,i[2]=w*R*N+y*E*j,i[3]=w*R*j-y*E*N;break;case"xzy":i[0]=y*R*j-w*E*N,i[1]=w*E*j-y*R*N,i[2]=w*R*N+y*E*j,i[3]=w*R*j+y*E*N;break;case"yxz":i[0]=y*R*j+w*E*N,i[1]=w*E*j-y*R*N,i[2]=w*R*N-y*E*j,i[3]=w*R*j+y*E*N;break;case"yzx":i[0]=y*R*j+w*E*N,i[1]=w*E*j+y*R*N,i[2]=w*R*N-y*E*j,i[3]=w*R*j-y*E*N;break;case"zxy":i[0]=y*R*j-w*E*N,i[1]=w*E*j+y*R*N,i[2]=w*R*N+y*E*j,i[3]=w*R*j-y*E*N;break;case"zyx":i[0]=y*R*j-w*E*N,i[1]=w*E*j+y*R*N,i[2]=w*R*N-y*E*j,i[3]=w*R*j+y*E*N;break;default:throw new Error("Unknown angle order "+f)}return i}function Pe(){var i=new at(2);return at!=Float32Array&&(i[0]=0,i[1]=0),i}function Ue(i,e){var n=new at(2);return n[0]=i,n[1]=e,n}Vt(),Ne=new at(4),at!=Float32Array&&(Ne[0]=0,Ne[1]=0,Ne[2]=0,Ne[3]=0),Vt(),oe(1,0,0),oe(0,1,0),Le(),Le(),jt(),Pe();const tt=8192;function vt(i,e,n){return e*(tt/(i.tileSize*Math.pow(2,n-i.tileID.overscaledZ)))}function Me(i,e){return(i%e+e)%e}function ut(i,e,n){return i*(1-n)+e*n}function Ot(i){if(i<=0)return 0;if(i>=1)return 1;const e=i*i,n=e*i;return 4*(i<.5?n:3*(i-e)+n-.75)}function Ct(i,e,n,l){const f=new Be(i,e,n,l);return m=>f.solve(m)}const Zt=Ct(.25,.1,.25,1);function tn(i,e,n){return Math.min(n,Math.max(e,i))}function _n(i,e,n){const l=n-e,f=((i-e)%l+l)%l+e;return f===e?n:f}function Qe(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}let ni=1;function Rn(i,e,n){const l={};for(const f in i)l[f]=e.call(this,i[f],f,i);return l}function rn(i,e,n){const l={};for(const f in i)e.call(this,i[f],f,i)&&(l[f]=i[f]);return l}function Re(i){return Array.isArray(i)?i.map(Re):typeof i=="object"&&i?Rn(i,Re):i}const fi={};function Dn(i){fi[i]||(typeof console<"u"&&console.warn(i),fi[i]=!0)}function Pn(i,e,n){return(n.y-i.y)*(e.x-i.x)>(e.y-i.y)*(n.x-i.x)}function Ia(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let Ri=null;function Gs(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const Yt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function qs(i,e,n,l,f){return c(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const m=new VideoFrame(i,{timestamp:0});try{const y=m?.format;if(!y||!y.startsWith("BGR")&&!y.startsWith("RGB"))throw new Error(`Unrecognized format ${y}`);const w=y.startsWith("BGR"),E=new Uint8ClampedArray(l*f*4);if(yield m.copyTo(E,(function(R,N,j,q,Z){const $=4*Math.max(-N,0),Q=(Math.max(0,j)-j)*q*4+$,ee=4*q,se=Math.max(0,N),Te=Math.max(0,j);return{rect:{x:se,y:Te,width:Math.min(R.width,N+q)-se,height:Math.min(R.height,j+Z)-Te},layout:[{offset:Q,stride:ee}]}})(i,e,n,l,f)),w)for(let R=0;R<E.length;R+=4){const N=E[R];E[R]=E[R+2],E[R+2]=N}return E}finally{m.close()}}))}let os,Nr;function wl(i,e,n,l){return i.addEventListener(e,n,l),{unsubscribe:()=>{i.removeEventListener(e,n,l)}}}function dn(i){return i*Math.PI/180}function Sr(i){return i/Math.PI*180}const nt={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},re={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},te="AbortError";class he extends Error{constructor(e=te){super(e instanceof Error?e.message:e),this.name=te,e instanceof Error&&e.stack&&(this.stack=e.stack)}}function Se(i){return i.name===te}const Ee={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function lt(i){return Ee.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const Je="global-dispatcher";class qe extends Error{constructor(e,n,l,f){super(`AJAXError: ${n} (${e}): ${l}`),this.status=e,this.statusText=n,this.url=l,this.body=f}}const Ze=()=>Ia(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,St=function(i,e){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const l=lt(i.url);if(l)return l(i,e);if(Ia(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:Je},e)}if(!(/^file:/.test(n=i.url)||/^file:/.test(Ze())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(l,f){return c(this,void 0,void 0,(function*(){const m=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,cache:l.cache,referrer:Ze(),signal:f.signal});let y,w;l.type!=="json"||m.headers.has("Accept")||m.headers.set("Accept","application/json");try{y=yield fetch(m)}catch(R){throw Se(R)?R:new qe(0,R.message,l.url,new Blob)}if(!y.ok){const R=yield y.blob();throw new qe(y.status,y.statusText,l.url,R)}w=l.type==="arrayBuffer"||l.type==="image"?y.arrayBuffer():l.type==="json"?y.json():y.text();const E=yield w;return f.signal.throwIfAborted(),{data:E,cacheControl:y.headers.get("Cache-Control"),expires:y.headers.get("Expires")}}))})(i,e);if(Ia(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:Je},e)}var n;return(function(l,f){return new Promise(((m,y)=>{var w;const E=new XMLHttpRequest;E.open(l.method||"GET",l.url,!0),l.type!=="arrayBuffer"&&l.type!=="image"||(E.responseType="arraybuffer");for(const R in l.headers)E.setRequestHeader(R,l.headers[R]);l.type==="json"&&(E.responseType="text",!((w=l.headers)===null||w===void 0)&&w.Accept||E.setRequestHeader("Accept","application/json")),E.withCredentials=l.credentials==="include",E.onerror=()=>{y(new Error(E.statusText))},E.onload=()=>{if(!f.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let R=E.response;if(l.type==="json")try{R=JSON.parse(E.response)}catch(N){return void y(N)}m({data:R,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const R=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});y(new qe(E.status,E.statusText,l.url,R))}},f.signal.addEventListener("abort",(()=>{E.abort(),y(new he(f.signal.reason))})),E.send(l.body)}))})(i,e)};function Mt(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const e=new URL(i),n=window.location;return e.protocol===n.protocol&&e.host===n.host}function Wt(i,e,n){n[i]&&n[i].indexOf(e)!==-1||(n[i]=n[i]||[],n[i].push(e))}function Qt(i,e,n){if(n&&n[i]){const l=n[i].indexOf(e);l!==-1&&n[i].splice(l,1)}}class yn{constructor(e,n={}){Qe(this,n),this.type=e}}class zn extends yn{constructor(e,n={}){super("error",Qe({error:e},n))}}class Un{on(e,n){return this._listeners=this._listeners||{},Wt(e,n,this._listeners),{unsubscribe:()=>{this.off(e,n)}}}off(e,n){return Qt(e,n,this._listeners),Qt(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Wt(e,n,this._oneTimeListeners),this):new Promise((l=>this.once(e,l)))}fire(e,n){typeof e=="string"&&(e=new yn(e,n||{}));const l=e.type;if(this.listens(l)){e.target=this;const f=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const w of f)w.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const w of m)Qt(l,w,this._oneTimeListeners),w.call(this,e);const y=this._eventedParent;y&&(Qe(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof zn&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var it={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ii=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Hi(i,e){const n={};for(const l in i)l!=="ref"&&(n[l]=i[l]);return ii.forEach((l=>{l in e&&(n[l]=e[l])})),n}function xn(i,e){if(Array.isArray(i)){if(!Array.isArray(e)||i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(!xn(i[n],e[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&e!==null){if(typeof e!="object"||Object.keys(i).length!==Object.keys(e).length)return!1;for(const n in i)if(!xn(i[n],e[n]))return!1;return!0}return i===e}function Nt(i,e){i.push(e)}function Xi(i,e,n){Nt(n,{command:"addSource",args:[i,e[i]]})}function Kn(i,e,n){Nt(e,{command:"removeSource",args:[i]}),n[i]=!0}function ki(i,e,n,l){Kn(i,n,l),Xi(i,e,n)}function si(i,e,n){let l;for(l in i[n])if(Object.prototype.hasOwnProperty.call(i[n],l)&&l!=="data"&&!xn(i[n][l],e[n][l]))return!1;for(l in e[n])if(Object.prototype.hasOwnProperty.call(e[n],l)&&l!=="data"&&!xn(i[n][l],e[n][l]))return!1;return!0}function ji(i,e,n,l,f,m){i=i||{},e=e||{};for(const y in i)Object.prototype.hasOwnProperty.call(i,y)&&(xn(i[y],e[y])||n.push({command:m,args:[l,y,e[y],f]}));for(const y in e)Object.prototype.hasOwnProperty.call(e,y)&&!Object.prototype.hasOwnProperty.call(i,y)&&(xn(i[y],e[y])||n.push({command:m,args:[l,y,e[y],f]}))}function qo(i){return i.id}function Aa(i,e){return i[e.id]=e,i}class Gt{constructor(e,n,l,f){this.message=(e?`${e}: `:"")+l,f&&(this.identifier=f),n!=null&&n.__line__&&(this.line=n.__line__)}}function _r(i,...e){for(const n of e)for(const l in n)i[l]=n[l];return i}class Xr extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}class Va{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[l,f]of n)this.bindings[l]=f}concat(e){return new Va(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const di={kind:"null"},Ut={kind:"number"},Sn={kind:"string"},Mn={kind:"boolean"},yr={kind:"color"},Ms={kind:"projectionDefinition"},Ga={kind:"object"},wn={kind:"value"},ls={kind:"collator"},pi={kind:"formatted"},Zs={kind:"padding"},Cs={kind:"colorArray"},ka={kind:"numberArray"},Ti={kind:"resolvedImage"},ho={kind:"variableAnchorOffsetCollection"};function Er(i,e){return{kind:"array",itemType:i,N:e}}function Vn(i){if(i.kind==="array"){const e=Vn(i.itemType);return typeof i.N=="number"?`array<${e}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${e}>`}return i.kind}const Ys=[di,Ut,Sn,Mn,yr,Ms,pi,Ga,Er(wn),Zs,ka,Cs,Ti,ho];function $r(i,e){if(e.kind==="error")return null;if(i.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!$r(i.itemType,e.itemType))&&(typeof i.N!="number"||i.N===e.N))return null}else{if(i.kind===e.kind)return null;if(i.kind==="value"){for(const n of Ys)if(!$r(n,e))return null}}return`Expected ${Vn(i)} but found ${Vn(e)} instead.`}function us(i,e){return e.some((n=>n.kind===i.kind))}function Is(i,e){return e.some((n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i))}function Wr(i,e){return i.kind==="array"&&e.kind==="array"?i.itemType.kind===e.itemType.kind&&typeof i.N=="number":i.kind===e.kind}const Zo=.96422,As=.82521,qa=4/29,$n=6/29,Yu=3*$n*$n,Dc=$n*$n*$n,ks=Math.PI/180,cs=180/Math.PI;function Za(i){return(i%=360)<0&&(i+=360),i}function Lc([i,e,n,l]){let f,m;const y=nu((.2225045*(i=cr(i))+.7168786*(e=cr(e))+.0606169*(n=cr(n)))/1);i===e&&e===n?f=m=y:(f=nu((.4360747*i+.3850649*e+.1430804*n)/Zo),m=nu((.0139322*i+.0971045*e+.7141733*n)/As));const w=116*y-16;return[w<0?0:w,500*(f-y),200*(y-m),l]}function cr(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function nu(i){return i>Dc?Math.pow(i,1/3):i/Yu+qa}function Hu([i,e,n,l]){let f=(i+16)/116,m=isNaN(e)?f:f+e/500,y=isNaN(n)?f:f-n/200;return f=1*fo(f),m=Zo*fo(m),y=As*fo(y),[iu(3.1338561*m-1.6168667*f-.4906146*y),iu(-.9787684*m+1.9161415*f+.033454*y),iu(.0719453*m-.2289914*f+1.4052427*y),l]}function iu(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function fo(i){return i>$n?i*i*i:Yu*(i-qa)}const zc=Object.hasOwn||function(i,e){return Object.prototype.hasOwnProperty.call(i,e)};function Ps(i,e){return zc(i,e)?i[e]:void 0}function Rs(i){return parseInt(i.padEnd(2,i),16)/255}function Eh(i,e){return po(e?i/100:i,0,1)}function po(i,e,n){return Math.min(Math.max(e,i),n)}function Xu(i){return!i.some(Number.isNaN)}const Hs={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function ri(i,e,n){return i+n*(e-i)}function Ya(i,e,n){return i.map(((l,f)=>ri(l,e[f],n)))}class An{constructor(e,n,l,f=1,m=!0){this.r=e,this.g=n,this.b=l,this.a=f,m||(this.r*=f,this.g*=f,this.b*=f,f||this.overwriteGetter("rgb",[e,n,l,f]))}static parse(e){if(e instanceof An)return e;if(typeof e!="string")return;const n=(function(l){if((l=l.toLowerCase().trim())==="transparent")return[0,0,0,0];const f=Ps(Hs,l);if(f){const[y,w,E]=f;return[y/255,w/255,E/255,1]}if(l.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(l)){const y=l.length<6?1:2;let w=1;return[Rs(l.slice(w,w+=y)),Rs(l.slice(w,w+=y)),Rs(l.slice(w,w+=y)),Rs(l.slice(w,w+y)||"ff")]}if(l.startsWith("rgb")){const y=l.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[w,E,R,N,j,q,Z,$,Q,ee,se,Te]=y,ue=[N||" ",Z||" ",ee].join("");if(ue==="  "||ue==="  /"||ue===",,"||ue===",,,"){const pe=[R,q,Q].join(""),ke=pe==="%%%"?100:pe===""?255:0;if(ke){const ze=[po(+E/ke,0,1),po(+j/ke,0,1),po(+$/ke,0,1),se?Eh(+se,Te):1];if(Xu(ze))return ze}}return}}const m=l.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,w,E,R,N,j,q,Z,$]=m,Q=[E||" ",N||" ",q].join("");if(Q==="  "||Q==="  /"||Q===",,"||Q===",,,"){const ee=[+w,po(+R,0,100),po(+j,0,100),Z?Eh(+Z,$):1];if(Xu(ee))return(function([se,Te,ue,pe]){function ke(ze){const ot=(ze+se/30)%12,Et=Te*Math.min(ue,1-ue);return ue-Et*Math.max(-1,Math.min(ot-3,9-ot,1))}return se=Za(se),Te/=100,ue/=100,[ke(0),ke(8),ke(4),pe]})(ee)}}})(e);return n?new An(...n,!1):void 0}get rgb(){const{r:e,g:n,b:l,a:f}=this,m=f||1/0;return this.overwriteGetter("rgb",[e/m,n/m,l/m,f])}get hcl(){return this.overwriteGetter("hcl",(function(e){const[n,l,f,m]=Lc(e),y=Math.sqrt(l*l+f*f);return[Math.round(1e4*y)?Za(Math.atan2(f,l)*cs):NaN,y,n,m]})(this.rgb))}get lab(){return this.overwriteGetter("lab",Lc(this.rgb))}overwriteGetter(e,n){return Object.defineProperty(this,e,{value:n}),n}toString(){const[e,n,l,f]=this.rgb;return`rgba(${[e,n,l].map((m=>Math.round(255*m))).join(",")},${f})`}static interpolate(e,n,l,f="rgb"){switch(f){case"rgb":{const[m,y,w,E]=Ya(e.rgb,n.rgb,l);return new An(m,y,w,E,!1)}case"hcl":{const[m,y,w,E]=e.hcl,[R,N,j,q]=n.hcl;let Z,$;if(isNaN(m)||isNaN(R))isNaN(m)?isNaN(R)?Z=NaN:(Z=R,w!==1&&w!==0||($=N)):(Z=m,j!==1&&j!==0||($=y));else{let ue=R-m;R>m&&ue>180?ue-=360:R<m&&m-R>180&&(ue+=360),Z=m+l*ue}const[Q,ee,se,Te]=(function([ue,pe,ke,ze]){return ue=isNaN(ue)?0:ue*ks,Hu([ke,Math.cos(ue)*pe,Math.sin(ue)*pe,ze])})([Z,$??ri(y,N,l),ri(w,j,l),ri(E,q,l)]);return new An(Q,ee,se,Te,!1)}case"lab":{const[m,y,w,E]=Hu(Ya(e.lab,n.lab,l));return new An(m,y,w,E,!1)}}}}An.black=new An(0,0,0,1),An.white=new An(1,1,1,1),An.transparent=new An(0,0,0,0),An.red=new An(1,0,0,1);class Pa{constructor(e,n,l){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const ya=["bottom","center","top"];class Kr{constructor(e,n,l,f,m,y){this.text=e,this.image=n,this.scale=l,this.fontStack=f,this.textColor=m,this.verticalAlign=y}}class $i{constructor(e){this.sections=e}static fromString(e){return new $i([new Kr(e,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||e.image&&e.image.name.length!==0))}static factory(e){return e instanceof $i?e:$i.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}}class ir{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof ir)return e;if(typeof e=="number")return new ir([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const n of e)if(typeof n!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new ir(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new ir(Ya(e.values,n.values,l))}}class Di{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Di)return e;if(typeof e=="number")return new Di([e]);if(Array.isArray(e)){for(const n of e)if(typeof n!="number")return;return new Di(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){return new Di(Ya(e.values,n.values,l))}}class vn{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof vn)return e;if(typeof e=="string"){const l=An.parse(e);return l?new vn([l]):void 0}if(!Array.isArray(e))return;const n=[];for(const l of e){if(typeof l!="string")return;const f=An.parse(l);if(!f)return;n.push(f)}return new vn(n)}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l,f="rgb"){const m=[];if(e.values.length!=n.values.length)throw new Error(`colorArray: Arrays have mismatched length (${e.values.length} vs. ${n.values.length}), cannot interpolate.`);for(let y=0;y<e.values.length;y++)m.push(An.interpolate(e.values[y],n.values[y],l,f));return new vn(m)}}class ei extends Error{constructor(e){super(e),this.name="RuntimeError"}toJSON(){return this.message}}const Ha=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ni{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Ni)return e;if(Array.isArray(e)&&!(e.length<1)&&e.length%2==0){for(let n=0;n<e.length;n+=2){const l=e[n],f=e[n+1];if(typeof l!="string"||!Ha.has(l)||!Array.isArray(f)||f.length!==2||typeof f[0]!="number"||typeof f[1]!="number")return}return new Ni(e)}}toString(){return JSON.stringify(this.values)}static interpolate(e,n,l){const f=e.values,m=n.values;if(f.length!==m.length)throw new ei(`Cannot interpolate values of different length. from: ${e.toString()}, to: ${n.toString()}`);const y=[];for(let w=0;w<f.length;w+=2){if(f[w]!==m[w])throw new ei(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${m[w]}`);y.push(f[w]);const[E,R]=f[w+1],[N,j]=m[w+1];y.push([ri(E,N,l),ri(R,j,l)])}return new Ni(y)}}class kn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new kn({name:e,available:!1}):null}}class mi{constructor(e,n,l){this.from=e,this.to=n,this.transition=l}static interpolate(e,n,l){return new mi(e,n,l)}static parse(e){return e instanceof mi?e:Array.isArray(e)&&e.length===3&&typeof e[0]=="string"&&typeof e[1]=="string"&&typeof e[2]=="number"?new mi(e[0],e[1],e[2]):typeof e=="object"&&typeof e.from=="string"&&typeof e.to=="string"&&typeof e.transition=="number"?new mi(e.from,e.to,e.transition):typeof e=="string"?new mi(e,e,1):void 0}}function ca(i,e,n,l){return typeof i=="number"&&i>=0&&i<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[i,e,n,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[i,e,n,l]:[i,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function hs(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof mi||i instanceof An||i instanceof Pa||i instanceof $i||i instanceof ir||i instanceof Di||i instanceof vn||i instanceof Ni||i instanceof kn)return!0;if(Array.isArray(i)){for(const e of i)if(!hs(e))return!1;return!0}if(typeof i=="object"){for(const e in i)if(!hs(i[e]))return!1;return!0}return!1}function ci(i){if(i===null)return di;if(typeof i=="string")return Sn;if(typeof i=="boolean")return Mn;if(typeof i=="number")return Ut;if(i instanceof An)return yr;if(i instanceof mi)return Ms;if(i instanceof Pa)return ls;if(i instanceof $i)return pi;if(i instanceof ir)return Zs;if(i instanceof Di)return ka;if(i instanceof vn)return Cs;if(i instanceof Ni)return ho;if(i instanceof kn)return Ti;if(Array.isArray(i)){const e=i.length;let n;for(const l of i){const f=ci(l);if(n){if(n===f)continue;n=wn;break}n=f}return Er(n||wn,e)}return Ga}function Xs(i){const e=typeof i;return i===null?"":e==="string"||e==="number"||e==="boolean"?String(i):i instanceof An||i instanceof mi||i instanceof $i||i instanceof ir||i instanceof Di||i instanceof vn||i instanceof Ni||i instanceof kn?i.toString():JSON.stringify(i)}class Si{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!hs(e[1]))return n.error("invalid value");const l=e[1];let f=ci(l);const m=n.expectedType;return f.kind!=="array"||f.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(f=m),new Si(f,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const mo={string:Sn,number:Ut,boolean:Mn,object:Ga};class Br{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l,f=1;const m=e[0];if(m==="array"){let w,E;if(e.length>2){const R=e[1];if(typeof R!="string"||!(R in mo)||R==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=mo[R],f++}else w=wn;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);E=e[2],f++}l=Er(w,E)}else{if(!mo[m])throw new Error(`Types doesn't contain name = ${m}`);l=mo[m]}const y=[];for(;f<e.length;f++){const w=n.parse(e[f],f,wn);if(!w)return null;y.push(w)}return new Br(l,y)}evaluate(e){for(let n=0;n<this.args.length;n++){const l=this.args[n].evaluate(e);if(!$r(this.type,ci(l)))return l;if(n===this.args.length-1)throw new ei(`Expected value to be of type ${Vn(this.type)}, but found ${Vn(ci(l))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const rr={"to-boolean":Mn,"to-color":yr,"to-number":Ut,"to-string":Sn};class Qr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[0];if(!rr[l])throw new Error(`Can't parse ${l} as it is not part of the known types`);if((l==="to-boolean"||l==="to-string")&&e.length!==2)return n.error("Expected one argument.");const f=rr[l],m=[];for(let y=1;y<e.length;y++){const w=n.parse(e[y],y,wn);if(!w)return null;m.push(w)}return new Qr(f,m)}evaluate(e){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(e);case"color":{let n,l;for(const f of this.args){if(n=f.evaluate(e),l=null,n instanceof An)return n;if(typeof n=="string"){const m=e.parseColor(n);if(m)return m}else if(Array.isArray(n)&&(l=n.length<3||n.length>4?`Invalid rgba value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:ca(n[0],n[1],n[2],n[3]),!l))return new An(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new ei(l||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const l of this.args){n=l.evaluate(e);const f=ir.parse(n);if(f)return f}throw new ei(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"numberArray":{let n;for(const l of this.args){n=l.evaluate(e);const f=Di.parse(n);if(f)return f}throw new ei(`Could not parse numberArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"colorArray":{let n;for(const l of this.args){n=l.evaluate(e);const f=vn.parse(n);if(f)return f}throw new ei(`Could not parse colorArray from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const l of this.args){n=l.evaluate(e);const f=Ni.parse(n);if(f)return f}throw new ei(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const l of this.args){if(n=l.evaluate(e),n===null)return 0;const f=Number(n);if(!isNaN(f))return f}throw new ei(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return $i.fromString(Xs(this.args[0].evaluate(e)));case"resolvedImage":return kn.fromString(Xs(this.args[0].evaluate(e)));case"projectionDefinition":return this.args[0].evaluate(e);default:return Xs(this.args[0].evaluate(e))}}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}const ru=["Unknown","Point","LineString","Polygon"];class go{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ru[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let n=this._parseColorCache.get(e);return n||(n=An.parse(e),this._parseColorCache.set(e,n)),n}}class ha{constructor(e,n,l=[],f,m=new Va,y=[]){this.registry=e,this.path=l,this.key=l.map((w=>`[${w}]`)).join(""),this.scope=m,this.errors=y,this.expectedType=f,this._isConstant=n}parse(e,n,l,f,m={}){return n?this.concat(n,l,f)._parse(e,m):this._parse(e,m)}_parse(e,n){function l(f,m,y){return y==="assert"?new Br(m,[f]):y==="coerce"?new Qr(m,[f]):f}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const f=e[0];if(typeof f!="string")return this.error(`Expression name must be a string, but found ${typeof f} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[f];if(m){let y=m.parse(e,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,E=y.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||E.kind!=="value"){if(w.kind==="projectionDefinition"&&["string","array"].includes(E.kind)||["color","formatted","resolvedImage"].includes(w.kind)&&["value","string"].includes(E.kind)||["padding","numberArray"].includes(w.kind)&&["value","number","array"].includes(E.kind)||w.kind==="colorArray"&&["value","string","array"].includes(E.kind)||w.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(E.kind))y=l(y,w,n.typeAnnotation||"coerce");else if(this.checkSubtype(w,E))return null}else y=l(y,w,n.typeAnnotation||"assert")}if(!(y instanceof Si)&&y.type.kind!=="resolvedImage"&&this._isConstant(y)){const w=new go;try{y=new Si(y.type,y.evaluate(w))}catch(E){return this.error(E.message),null}}return y}return this.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,l){const f=typeof e=="number"?this.path.concat(e):this.path,m=l?this.scope.concat(l):this.scope;return new ha(this.registry,this._isConstant,f,n||null,m,this.errors)}error(e,...n){const l=`${this.key}${n.map((f=>`[${f}]`)).join("")}`;this.errors.push(new Xr(l,e))}checkSubtype(e,n){const l=$r(e,n);return l&&this.error(l),l}}class Qn{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let m=1;m<e.length-1;m+=2){const y=e[m];if(typeof y!="string")return n.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",m);const w=n.parse(e[m+1],m+1);if(!w)return null;l.push([y,w])}const f=n.parse(e[e.length-1],e.length-1,n.expectedType,l);return f?new Qn(l,f):null}outputDefined(){return this.result.outputDefined()}}class _o{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const l=e[1];return n.scope.has(l)?new _o(l,n.scope.get(l)):n.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class Tn{constructor(e,n,l){this.type=e,this.index=n,this.input=l}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,Ut),f=n.parse(e[2],2,Er(n.expectedType||wn));return l&&f?new Tn(f.type.itemType,l,f):null}evaluate(e){const n=this.index.evaluate(e),l=this.input.evaluate(e);if(n<0)throw new ei(`Array index out of bounds: ${n} < 0.`);if(n>=l.length)throw new ei(`Array index out of bounds: ${n} > ${l.length-1}.`);if(n!==Math.floor(n))throw new ei(`Array index must be an integer, but found ${n} instead.`);return l[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class bn{constructor(e,n){this.type=Mn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,wn),f=n.parse(e[2],2,wn);return l&&f?us(l.type,[Mn,Sn,Ut,di,wn])?new bn(l,f):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(l.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!l)return!1;if(!Is(n,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(ci(n))} instead.`);if(!Is(l,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Vn(ci(l))} instead.`);return l.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Yo{constructor(e,n,l){this.type=Ut,this.needle=e,this.haystack=n,this.fromIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,wn),f=n.parse(e[2],2,wn);if(!l||!f)return null;if(!us(l.type,[Mn,Sn,Ut,di,wn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(l.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,Ut);return m?new Yo(l,f,m):null}return new Yo(l,f)}evaluate(e){const n=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Is(n,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Vn(ci(n))} instead.`);let f;if(this.fromIndex&&(f=this.fromIndex.evaluate(e)),Is(l,["string"])){const m=l.indexOf(n,f);return m===-1?-1:[...l.slice(0,m)].length}if(Is(l,["array"]))return l.indexOf(n,f);throw new ei(`Expected second argument to be of type array or string, but found ${Vn(ci(l))} instead.`)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class On{constructor(e,n,l,f,m,y){this.inputType=e,this.type=n,this.input=l,this.cases=f,this.outputs=m,this.otherwise=y}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let l,f;n.expectedType&&n.expectedType.kind!=="value"&&(f=n.expectedType);const m={},y=[];for(let R=2;R<e.length-1;R+=2){let N=e[R];const j=e[R+1];Array.isArray(N)||(N=[N]);const q=n.concat(R);if(N.length===0)return q.error("Expected at least one branch label.");for(const $ of N){if(typeof $!="number"&&typeof $!="string")return q.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return q.error("Numeric branch labels must be integer values.");if(l){if(q.checkSubtype(l,ci($)))return null}else l=ci($);if(m[String($)]!==void 0)return q.error("Branch labels must be unique.");m[String($)]=y.length}const Z=n.parse(j,R,f);if(!Z)return null;f=f||Z.type,y.push(Z)}const w=n.parse(e[1],1,wn);if(!w)return null;const E=n.parse(e[e.length-1],e.length-1,f);return E?w.type.kind!=="value"&&n.concat(1).checkSubtype(l,w.type)?null:new On(l,f,w,m,y,E):null}evaluate(e){const n=this.input.evaluate(e);return(ci(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}}class Tl{constructor(e,n,l){this.type=e,this.branches=n,this.otherwise=l}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);const f=[];for(let y=1;y<e.length-1;y+=2){const w=n.parse(e[y],y,Mn);if(!w)return null;const E=n.parse(e[y+1],y+1,l);if(!E)return null;f.push([w,E]),l=l||E.type}const m=n.parse(e[e.length-1],e.length-1,l);if(!m)return null;if(!l)throw new Error("Can't infer output type");return new Tl(l,f,m)}evaluate(e){for(const[n,l]of this.branches)if(n.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,l]of this.branches)e(n),e(l);e(this.otherwise)}outputDefined(){return this.branches.every((([e,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}}class Fr{constructor(e,n,l,f){this.type=e,this.input=n,this.beginIndex=l,this.endIndex=f}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 2 or 3 arguments, but found ${e.length-1} instead.`);const l=n.parse(e[1],1,wn),f=n.parse(e[2],2,Ut);if(!l||!f)return null;if(!us(l.type,[Er(wn),Sn,wn]))return n.error(`Expected first argument to be of type array or string, but found ${Vn(l.type)} instead`);if(e.length===4){const m=n.parse(e[3],3,Ut);return m?new Fr(l.type,l,f,m):null}return new Fr(l.type,l,f)}evaluate(e){const n=this.input.evaluate(e),l=this.beginIndex.evaluate(e);let f;if(this.endIndex&&(f=this.endIndex.evaluate(e)),Is(n,["string"]))return[...n].slice(l,f).join("");if(Is(n,["array"]))return n.slice(l,f);throw new ei(`Expected first argument to be of type array or string, but found ${Vn(ci(n))} instead.`)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function yo(i,e){const n=i.length-1;let l,f,m=0,y=n,w=0;for(;m<=y;)if(w=Math.floor((m+y)/2),l=i[w],f=i[w+1],l<=e){if(w===n||e<f)return w;m=w+1}else{if(!(l>e))throw new ei("Input is not a number.");y=w-1}return 0}class jr{constructor(e,n,l){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[f,m]of l)this.labels.push(f),this.outputs.push(m)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const l=n.parse(e[1],1,Ut);if(!l)return null;const f=[];let m=null;n.expectedType&&n.expectedType.kind!=="value"&&(m=n.expectedType);for(let y=1;y<e.length;y+=2){const w=y===1?-1/0:e[y],E=e[y+1],R=y,N=y+1;if(typeof w!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(f.length&&f[f.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const j=n.parse(E,N,m);if(!j)return null;m=m||j.type,f.push([w,j])}return new jr(m,l,f)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const f=this.input.evaluate(e);if(f<=n[0])return l[0].evaluate(e);const m=n.length;return f>=n[m-1]?l[m-1].evaluate(e):l[yo(n,f)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Oc(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var au,Nc,If=(function(){if(Nc)return au;function i(e,n,l,f){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=l,this.p2y=f}return Nc=1,au=i,i.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,n){if(n===void 0&&(n=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,f=0;f<8;f++){var m=this.sampleCurveX(l)-e;if(Math.abs(m)<n)return l;var y=this.sampleCurveDerivativeX(l);if(Math.abs(y)<1e-6)break;l-=m/y}var w=0,E=1;for(l=e,f=0;f<20&&(m=this.sampleCurveX(l),!(Math.abs(m-e)<n));f++)e>m?w=l:E=l,l=.5*(E-w)+w;return l},solve:function(e,n){return this.sampleCurveY(this.solveCurveX(e,n))}},au})(),Bc=Oc(If);class fa{constructor(e,n,l,f,m){this.type=e,this.operator=n,this.interpolation=l,this.input=f,this.labels=[],this.outputs=[];for(const[y,w]of m)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(e,n,l,f){let m=0;if(e.name==="exponential")m=Ds(n,e.base,l,f);else if(e.name==="linear")m=Ds(n,1,l,f);else if(e.name==="cubic-bezier"){const y=e.controlPoints;m=new Bc(y[0],y[1],y[2],y[3]).solve(Ds(n,1,l,f))}return m}static parse(e,n){let[l,f,m,...y]=e;if(!Array.isArray(f)||f.length===0)return n.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){const R=f[1];if(typeof R!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:R}}else{if(f[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(f[0])}`,1,0);{const R=f.slice(1);if(R.length!==4||R.some((N=>typeof N!="number"||N<0||N>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:R}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(m=n.parse(m,2,Ut),!m)return null;const w=[];let E=null;l!=="interpolate-hcl"&&l!=="interpolate-lab"||n.expectedType==Cs?n.expectedType&&n.expectedType.kind!=="value"&&(E=n.expectedType):E=yr;for(let R=0;R<y.length;R+=2){const N=y[R],j=y[R+1],q=R+3,Z=R+4;if(typeof N!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(w.length&&w[w.length-1][0]>=N)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const $=n.parse(j,Z,E);if(!$)return null;E=E||$.type,w.push([N,$])}return Wr(E,Ut)||Wr(E,Ms)||Wr(E,yr)||Wr(E,Zs)||Wr(E,ka)||Wr(E,Cs)||Wr(E,ho)||Wr(E,Er(Ut))?new fa(E,l,f,m,w):n.error(`Type ${Vn(E)} is not interpolatable.`)}evaluate(e){const n=this.labels,l=this.outputs;if(n.length===1)return l[0].evaluate(e);const f=this.input.evaluate(e);if(f<=n[0])return l[0].evaluate(e);const m=n.length;if(f>=n[m-1])return l[m-1].evaluate(e);const y=yo(n,f),w=fa.interpolationFactor(this.interpolation,f,n[y],n[y+1]),E=l[y].evaluate(e),R=l[y+1].evaluate(e);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return ri(E,R,w);case"color":return An.interpolate(E,R,w);case"padding":return ir.interpolate(E,R,w);case"colorArray":return vn.interpolate(E,R,w);case"numberArray":return Di.interpolate(E,R,w);case"variableAnchorOffsetCollection":return Ni.interpolate(E,R,w);case"array":return Ya(E,R,w);case"projectionDefinition":return mi.interpolate(E,R,w)}case"interpolate-hcl":switch(this.type.kind){case"color":return An.interpolate(E,R,w,"hcl");case"colorArray":return vn.interpolate(E,R,w,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return An.interpolate(E,R,w,"lab");case"colorArray":return vn.interpolate(E,R,w,"lab")}}}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}}function Ds(i,e,n,l){const f=l-n,m=i-n;return f===0?0:e===1?m/f:(Math.pow(e,m)-1)/(Math.pow(e,f)-1)}const Li={color:An.interpolate,number:ri,padding:ir.interpolate,numberArray:Di.interpolate,colorArray:vn.interpolate,variableAnchorOffsetCollection:Ni.interpolate,array:Ya};class Ra{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let l=null;const f=n.expectedType;f&&f.kind!=="value"&&(l=f);const m=[];for(const w of e.slice(1)){const E=n.parse(w,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!E)return null;l=l||E.type,m.push(E)}if(!l)throw new Error("No output type");const y=f&&m.some((w=>$r(f,w.type)));return new Ra(y?wn:l,m)}evaluate(e){let n,l=null,f=0;for(const m of this.args)if(f++,l=m.evaluate(e),l&&l instanceof kn&&!l.available&&(n||(n=l.name),l=null,f===this.args.length&&(l=n)),l!==null)break;return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}}function Ur(i,e){return i==="=="||i==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function su(i,e,n,l){return l.compare(e,n)===0}function Bi(i,e,n){const l=i!=="=="&&i!=="!=";return class qv{constructor(m,y,w){this.type=Mn,this.lhs=m,this.rhs=y,this.collator=w,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const w=m[0];let E=y.parse(m[1],1,wn);if(!E)return null;if(!Ur(w,E.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${Vn(E.type)}'.`);let R=y.parse(m[2],2,wn);if(!R)return null;if(!Ur(w,R.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${Vn(R.type)}'.`);if(E.type.kind!==R.type.kind&&E.type.kind!=="value"&&R.type.kind!=="value")return y.error(`Cannot compare types '${Vn(E.type)}' and '${Vn(R.type)}'.`);l&&(E.type.kind==="value"&&R.type.kind!=="value"?E=new Br(R.type,[E]):E.type.kind!=="value"&&R.type.kind==="value"&&(R=new Br(E.type,[R])));let N=null;if(m.length===4){if(E.type.kind!=="string"&&R.type.kind!=="string"&&E.type.kind!=="value"&&R.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(N=y.parse(m[3],3,ls),!N)return null}return new qv(E,R,N)}evaluate(m){const y=this.lhs.evaluate(m),w=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const E=ci(y),R=ci(w);if(E.kind!==R.kind||E.kind!=="string"&&E.kind!=="number")throw new ei(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${E.kind}, ${R.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const E=ci(y),R=ci(w);if(E.kind!=="string"||R.kind!=="string")return e(m,y,w)}return this.collator?n(m,y,w,this.collator.evaluate(m)):e(m,y,w)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const Mh=Bi("==",(function(i,e,n){return e===n}),su),Sl=Bi("!=",(function(i,e,n){return e!==n}),(function(i,e,n,l){return!su(0,e,n,l)})),Fc=Bi("<",(function(i,e,n){return e<n}),(function(i,e,n,l){return l.compare(e,n)<0})),jc=Bi(">",(function(i,e,n){return e>n}),(function(i,e,n,l){return l.compare(e,n)>0})),Ho=Bi("<=",(function(i,e,n){return e<=n}),(function(i,e,n,l){return l.compare(e,n)<=0})),va=Bi(">=",(function(i,e,n){return e>=n}),(function(i,e,n,l){return l.compare(e,n)>=0}));class Xo{constructor(e,n,l){this.type=ls,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return n.error("Collator options argument must be an object.");const f=n.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Mn);if(!f)return null;const m=n.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Mn);if(!m)return null;let y=null;return l.locale&&(y=n.parse(l.locale,1,Sn),!y)?null:new Xo(f,m,y)}evaluate(e){return new Pa(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}class da{constructor(e,n,l,f,m){this.type=Sn,this.number=e,this.locale=n,this.currency=l,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Ut);if(!l)return null;const f=e[2];if(typeof f!="object"||Array.isArray(f))return n.error("NumberFormat options argument must be an object.");let m=null;if(f.locale&&(m=n.parse(f.locale,1,Sn),!m))return null;let y=null;if(f.currency&&(y=n.parse(f.currency,1,Sn),!y))return null;let w=null;if(f["min-fraction-digits"]&&(w=n.parse(f["min-fraction-digits"],1,Ut),!w))return null;let E=null;return f["max-fraction-digits"]&&(E=n.parse(f["max-fraction-digits"],1,Ut),!E)?null:new da(l,m,y,w,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class $s{constructor(e){this.type=pi,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return n.error("First argument must be an image or text section.");const f=[];let m=!1;for(let y=1;y<=e.length-1;++y){const w=e[y];if(m&&typeof w=="object"&&!Array.isArray(w)){m=!1;let E=null;if(w["font-scale"]&&(E=n.parse(w["font-scale"],1,Ut),!E))return null;let R=null;if(w["text-font"]&&(R=n.parse(w["text-font"],1,Er(Sn)),!R))return null;let N=null;if(w["text-color"]&&(N=n.parse(w["text-color"],1,yr),!N))return null;let j=null;if(w["vertical-align"]){if(typeof w["vertical-align"]=="string"&&!ya.includes(w["vertical-align"]))return n.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${w["vertical-align"]}' instead.`);if(j=n.parse(w["vertical-align"],1,Sn),!j)return null}const q=f[f.length-1];q.scale=E,q.font=R,q.textColor=N,q.verticalAlign=j}else{const E=n.parse(e[y],1,wn);if(!E)return null;const R=E.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,f.push({content:E,scale:null,font:null,textColor:null,verticalAlign:null})}}return new $s(f)}evaluate(e){return new $i(this.sections.map((n=>{const l=n.content.evaluate(e);return ci(l)===Ti?new Kr("",l,null,null,null,n.verticalAlign?n.verticalAlign.evaluate(e):null):new Kr(Xs(l),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null,n.verticalAlign?n.verticalAlign.evaluate(e):null)})))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor),n.verticalAlign&&e(n.verticalAlign)}outputDefined(){return!1}}class El{constructor(e){this.type=Ti,this.input=e}static parse(e,n){if(e.length!==2)return n.error("Expected two arguments.");const l=n.parse(e[1],1,Sn);return l?new El(l):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),l=kn.fromString(n);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(n)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}}class $o{constructor(e){this.type=Ut,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=n.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Vn(l.type)} instead.`):new $o(l):null}evaluate(e){const n=this.input.evaluate(e);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new ei(`Expected value to be of type string or array, but found ${Vn(ci(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Ui=8192;function Wo(i,e){const n=(180+i[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,f=Math.pow(2,e.z);return[Math.round(n*f*Ui),Math.round(l*f*Ui)]}function vo(i,e){const n=Math.pow(2,e.z);return[(f=(i[0]/Ui+e.x)/n,360*f-180),(l=(i[1]/Ui+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*l)*Math.PI/180))-90)];var l,f}function Ml(i,e){i[0]=Math.min(i[0],e[0]),i[1]=Math.min(i[1],e[1]),i[2]=Math.max(i[2],e[0]),i[3]=Math.max(i[3],e[1])}function xo(i,e){return!(i[0]<=e[0]||i[2]>=e[2]||i[1]<=e[1]||i[3]>=e[3])}function Ch(i,e,n){const l=i[0]-e[0],f=i[1]-e[1],m=i[0]-n[0],y=i[1]-n[1];return l*y-m*f==0&&l*m<=0&&f*y<=0}function ou(i,e,n,l){return(f=[l[0]-n[0],l[1]-n[1]])[0]*(m=[e[0]-i[0],e[1]-i[1]])[1]-f[1]*m[0]!=0&&!(!Wu(i,e,n,l)||!Wu(n,l,i,e));var f,m}function Ih(i,e,n){for(const l of n)for(let f=0;f<l.length-1;++f)if(ou(i,e,l[f],l[f+1]))return!0;return!1}function fs(i,e,n=!1){let l=!1;for(const w of e)for(let E=0;E<w.length-1;E++){if(Ch(i,w[E],w[E+1]))return n;(m=w[E])[1]>(f=i)[1]!=(y=w[E+1])[1]>f[1]&&f[0]<(y[0]-m[0])*(f[1]-m[1])/(y[1]-m[1])+m[0]&&(l=!l)}var f,m,y;return l}function $u(i,e){for(const n of e)if(fs(i,n))return!0;return!1}function Ah(i,e){for(const n of i)if(!fs(n,e))return!1;for(let n=0;n<i.length-1;++n)if(Ih(i[n],i[n+1],e))return!1;return!0}function Uc(i,e){for(const n of e)if(Ah(i,n))return!0;return!1}function Wu(i,e,n,l){const f=l[0]-n[0],m=l[1]-n[1],y=(i[0]-n[0])*m-f*(i[1]-n[1]),w=(e[0]-n[0])*m-f*(e[1]-n[1]);return y>0&&w<0||y<0&&w>0}function lu(i,e,n){const l=[];for(let f=0;f<i.length;f++){const m=[];for(let y=0;y<i[f].length;y++){const w=Wo(i[f][y],n);Ml(e,w),m.push(w)}l.push(m)}return l}function Ko(i,e,n){const l=[];for(let f=0;f<i.length;f++){const m=lu(i[f],e,n);l.push(m)}return l}function Cl(i,e,n,l){if(i[0]<n[0]||i[0]>n[2]){const f=.5*l;let m=i[0]-n[0]>f?-l:n[0]-i[0]>f?l:0;m===0&&(m=i[0]-n[2]>f?-l:n[2]-i[0]>f?l:0),i[0]+=m}Ml(e,i)}function kh(i,e,n,l){const f=Math.pow(2,l.z)*Ui,m=[l.x*Ui,l.y*Ui],y=[];for(const w of i)for(const E of w){const R=[E.x+m[0],E.y+m[1]];Cl(R,e,n,f),y.push(R)}return y}function uu(i,e,n,l){const f=Math.pow(2,l.z)*Ui,m=[l.x*Ui,l.y*Ui],y=[];for(const E of i){const R=[];for(const N of E){const j=[N.x+m[0],N.y+m[1]];Ml(e,j),R.push(j)}y.push(R)}if(e[2]-e[0]<=f/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of y)for(const R of E)Cl(R,e,n,f)}var w;return y}class bo{constructor(e,n){this.type=Mn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(hs(e[1])){const l=e[1];if(l.type==="FeatureCollection"){const f=[];for(const m of l.features){const{type:y,coordinates:w}=m.geometry;y==="Polygon"&&f.push(w),y==="MultiPolygon"&&f.push(...w)}if(f.length)return new bo(l,{type:"MultiPolygon",coordinates:f})}else if(l.type==="Feature"){const f=l.geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new bo(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new bo(l,l)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const f=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(l.type==="Polygon"){const w=lu(l.coordinates,m,y),E=kh(n.geometry(),f,m,y);if(!xo(f,m))return!1;for(const R of E)if(!fs(R,w))return!1}if(l.type==="MultiPolygon"){const w=Ko(l.coordinates,m,y),E=kh(n.geometry(),f,m,y);if(!xo(f,m))return!1;for(const R of E)if(!$u(R,w))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const f=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(l.type==="Polygon"){const w=lu(l.coordinates,m,y),E=uu(n.geometry(),f,m,y);if(!xo(f,m))return!1;for(const R of E)if(!Ah(R,w))return!1}if(l.type==="MultiPolygon"){const w=Ko(l.coordinates,m,y),E=uu(n.geometry(),f,m,y);if(!xo(f,m))return!1;for(const R of E)if(!Uc(R,w))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Vc=class{constructor(i=[],e=(n,l)=>n<l?-1:n>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],e=this.data.pop();return--this.length>0&&(this.data[0]=e,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:e,compare:n}=this,l=e[i];for(;i>0;){const f=i-1>>1,m=e[f];if(n(l,m)>=0)break;e[i]=m,i=f}e[i]=l}_down(i){const{data:e,compare:n}=this,l=this.length>>1,f=e[i];for(;i<l;){let m=1+(i<<1);const y=m+1;if(y<this.length&&n(e[y],e[m])<0&&(m=y),n(e[m],f)>=0)break;e[i]=e[m],i=m}e[i]=f}};function cu(i,e,n=0,l=i.length-1,f=Ku){for(;l>n;){if(l-n>600){const E=l-n+1,R=e-n+1,N=Math.log(E),j=.5*Math.exp(2*N/3),q=.5*Math.sqrt(N*j*(E-j)/E)*(R-E/2<0?-1:1);cu(i,e,Math.max(n,Math.floor(e-R*j/E+q)),Math.min(l,Math.floor(e+(E-R)*j/E+q)),f)}const m=i[e];let y=n,w=l;for(Ws(i,n,e),f(i[l],m)>0&&Ws(i,n,l);y<w;){for(Ws(i,y,w),y++,w--;f(i[y],m)<0;)y++;for(;f(i[w],m)>0;)w--}f(i[n],m)===0?Ws(i,n,w):(w++,Ws(i,w,l)),w<=e&&(n=w+1),e<=w&&(l=w-1)}}function Ws(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function Ku(i,e){return i<e?-1:i>e?1:0}function Il(i,e){if(i.length<=1)return[i];const n=[];let l,f;for(const m of i){const y=Rh(m);y!==0&&(m.area=Math.abs(y),f===void 0&&(f=y<0),f===y<0?(l&&n.push(l),l=[m]):l.push(m))}if(l&&n.push(l),e>1)for(let m=0;m<n.length;m++)n[m].length<=e||(cu(n[m],e,1,n[m].length-1,Ph),n[m]=n[m].slice(0,e));return n}function Ph(i,e){return e.area-i.area}function Rh(i){let e=0;for(let n,l,f=0,m=i.length,y=m-1;f<m;y=f++)n=i[f],l=i[y],e+=(l.x-n.x)*(n.y+l.y);return e}const Qu=1/298.257223563,hu=Qu*(2-Qu),Gc=Math.PI/180;class Ju{constructor(e){const n=6378.137*Gc*1e3,l=Math.cos(e*Gc),f=1/(1-hu*(1-l*l)),m=Math.sqrt(f);this.kx=n*m*l,this.ky=n*m*f*(1-hu)}distance(e,n){const l=this.wrap(e[0]-n[0])*this.kx,f=(e[1]-n[1])*this.ky;return Math.sqrt(l*l+f*f)}pointOnLine(e,n){let l,f,m,y,w=1/0;for(let E=0;E<e.length-1;E++){let R=e[E][0],N=e[E][1],j=this.wrap(e[E+1][0]-R)*this.kx,q=(e[E+1][1]-N)*this.ky,Z=0;j===0&&q===0||(Z=(this.wrap(n[0]-R)*this.kx*j+(n[1]-N)*this.ky*q)/(j*j+q*q),Z>1?(R=e[E+1][0],N=e[E+1][1]):Z>0&&(R+=j/this.kx*Z,N+=q/this.ky*Z)),j=this.wrap(n[0]-R)*this.kx,q=(n[1]-N)*this.ky;const $=j*j+q*q;$<w&&(w=$,l=R,f=N,m=E,y=Z)}return{point:[l,f],index:m,t:Math.max(0,Math.min(1,y))}}wrap(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}}function xa(i,e){return e[0]-i[0]}function wo(i){return i[1]-i[0]+1}function Vr(i,e){return i[1]>=i[0]&&i[1]<e}function fu(i,e){if(i[0]>i[1])return[null,null];const n=wo(i);if(e){if(n===2)return[i,null];const f=Math.floor(n/2);return[[i[0],i[0]+f],[i[0]+f,i[1]]]}if(n===1)return[i,null];const l=Math.floor(n/2)-1;return[[i[0],i[0]+l],[i[0]+l+1,i[1]]]}function du(i,e){if(!Vr(e,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let l=e[0];l<=e[1];++l)Ml(n,i[l]);return n}function pa(i){const e=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const l of n)Ml(e,l);return e}function ba(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function _(i,e,n){if(!ba(i)||!ba(e))return NaN;let l=0,f=0;return i[2]<e[0]&&(l=e[0]-i[2]),i[0]>e[2]&&(l=i[0]-e[2]),i[1]>e[3]&&(f=i[1]-e[3]),i[3]<e[1]&&(f=e[1]-i[3]),n.distance([0,0],[l,f])}function o(i,e,n){const l=n.pointOnLine(e,i);return n.distance(i,l.point)}function u(i,e,n,l,f){const m=Math.min(o(i,[n,l],f),o(e,[n,l],f)),y=Math.min(o(n,[i,e],f),o(l,[i,e],f));return Math.min(m,y)}function g(i,e,n,l,f){if(!Vr(e,i.length)||!Vr(l,n.length))return 1/0;let m=1/0;for(let y=e[0];y<e[1];++y){const w=i[y],E=i[y+1];for(let R=l[0];R<l[1];++R){const N=n[R],j=n[R+1];if(ou(w,E,N,j))return 0;m=Math.min(m,u(w,E,N,j,f))}}return m}function M(i,e,n,l,f){if(!Vr(e,i.length)||!Vr(l,n.length))return NaN;let m=1/0;for(let y=e[0];y<=e[1];++y)for(let w=l[0];w<=l[1];++w)if(m=Math.min(m,f.distance(i[y],n[w])),m===0)return m;return m}function B(i,e,n){if(fs(i,e,!0))return 0;let l=1/0;for(const f of e){const m=f[0],y=f[f.length-1];if(m!==y&&(l=Math.min(l,o(i,[y,m],n)),l===0))return l;const w=n.pointOnLine(f,i);if(l=Math.min(l,n.distance(i,w.point)),l===0)return l}return l}function G(i,e,n,l){if(!Vr(e,i.length))return NaN;for(let m=e[0];m<=e[1];++m)if(fs(i[m],n,!0))return 0;let f=1/0;for(let m=e[0];m<e[1];++m){const y=i[m],w=i[m+1];for(const E of n)for(let R=0,N=E.length,j=N-1;R<N;j=R++){const q=E[j],Z=E[R];if(ou(y,w,q,Z))return 0;f=Math.min(f,u(y,w,q,Z,l))}}return f}function K(i,e){for(const n of i)for(const l of n)if(fs(l,e,!0))return!0;return!1}function le(i,e,n,l=1/0){const f=pa(i),m=pa(e);if(l!==1/0&&_(f,m,n)>=l)return l;if(xo(f,m)){if(K(i,e))return 0}else if(K(e,i))return 0;let y=1/0;for(const w of i)for(let E=0,R=w.length,N=R-1;E<R;N=E++){const j=w[N],q=w[E];for(const Z of e)for(let $=0,Q=Z.length,ee=Q-1;$<Q;ee=$++){const se=Z[ee],Te=Z[$];if(ou(j,q,se,Te))return 0;y=Math.min(y,u(j,q,se,Te,n))}}return y}function _e(i,e,n,l,f,m){if(!m)return;const y=_(du(l,m),f,n);y<e&&i.push([y,m,[0,0]])}function Ke(i,e,n,l,f,m,y){if(!m||!y)return;const w=_(du(l,m),du(f,y),n);w<e&&i.push([w,m,y])}function ct(i,e,n,l,f=1/0){let m=Math.min(l.distance(i[0],n[0][0]),f);if(m===0)return m;const y=new Vc([[0,[0,i.length-1],[0,0]]],xa),w=pa(n);for(;y.length>0;){const E=y.pop();if(E[0]>=m)continue;const R=E[1],N=e?50:100;if(wo(R)<=N){if(!Vr(R,i.length))return NaN;if(e){const j=G(i,R,n,l);if(isNaN(j)||j===0)return j;m=Math.min(m,j)}else for(let j=R[0];j<=R[1];++j){const q=B(i[j],n,l);if(m=Math.min(m,q),m===0)return 0}}else{const j=fu(R,e);_e(y,m,l,i,w,j[0]),_e(y,m,l,i,w,j[1])}}return m}function Bt(i,e,n,l,f,m=1/0){let y=Math.min(m,f.distance(i[0],n[0]));if(y===0)return y;const w=new Vc([[0,[0,i.length-1],[0,n.length-1]]],xa);for(;w.length>0;){const E=w.pop();if(E[0]>=y)continue;const R=E[1],N=E[2],j=e?50:100,q=l?50:100;if(wo(R)<=j&&wo(N)<=q){if(!Vr(R,i.length)&&Vr(N,n.length))return NaN;let Z;if(e&&l)Z=g(i,R,n,N,f),y=Math.min(y,Z);else if(e&&!l){const $=i.slice(R[0],R[1]+1);for(let Q=N[0];Q<=N[1];++Q)if(Z=o(n[Q],$,f),y=Math.min(y,Z),y===0)return y}else if(!e&&l){const $=n.slice(N[0],N[1]+1);for(let Q=R[0];Q<=R[1];++Q)if(Z=o(i[Q],$,f),y=Math.min(y,Z),y===0)return y}else Z=M(i,R,n,N,f),y=Math.min(y,Z)}else{const Z=fu(R,e),$=fu(N,l);Ke(w,y,f,i,n,Z[0],$[0]),Ke(w,y,f,i,n,Z[0],$[1]),Ke(w,y,f,i,n,Z[1],$[0]),Ke(w,y,f,i,n,Z[1],$[1])}}return y}function Jt(i){return i.type==="MultiPolygon"?i.coordinates.map((e=>({type:"Polygon",coordinates:e}))):i.type==="MultiLineString"?i.coordinates.map((e=>({type:"LineString",coordinates:e}))):i.type==="MultiPoint"?i.coordinates.map((e=>({type:"Point",coordinates:e}))):[i]}class sn{constructor(e,n){this.type=Ut,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${e.length-1} instead.`);if(hs(e[1])){const l=e[1];if(l.type==="FeatureCollection")return new sn(l,l.features.map((f=>Jt(f.geometry))).flat());if(l.type==="Feature")return new sn(l,Jt(l.geometry));if("type"in l&&"coordinates"in l)return new sn(l,Jt(l))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(n,l){const f=n.geometry(),m=f.flat().map((E=>vo([E.x,E.y],n.canonical)));if(f.length===0)return NaN;const y=new Ju(m[0][1]);let w=1/0;for(const E of l){switch(E.type){case"Point":w=Math.min(w,Bt(m,!1,[E.coordinates],!1,y,w));break;case"LineString":w=Math.min(w,Bt(m,!1,E.coordinates,!0,y,w));break;case"Polygon":w=Math.min(w,ct(m,!1,E.coordinates,y,w))}if(w===0)return w}return w})(e,this.geometries);if(e.geometryType()==="LineString")return(function(n,l){const f=n.geometry(),m=f.flat().map((E=>vo([E.x,E.y],n.canonical)));if(f.length===0)return NaN;const y=new Ju(m[0][1]);let w=1/0;for(const E of l){switch(E.type){case"Point":w=Math.min(w,Bt(m,!0,[E.coordinates],!1,y,w));break;case"LineString":w=Math.min(w,Bt(m,!0,E.coordinates,!0,y,w));break;case"Polygon":w=Math.min(w,ct(m,!0,E.coordinates,y,w))}if(w===0)return w}return w})(e,this.geometries);if(e.geometryType()==="Polygon")return(function(n,l){const f=n.geometry();if(f.length===0||f[0].length===0)return NaN;const m=Il(f,0).map((E=>E.map((R=>R.map((N=>vo([N.x,N.y],n.canonical))))))),y=new Ju(m[0][0][0][1]);let w=1/0;for(const E of l)for(const R of m){switch(E.type){case"Point":w=Math.min(w,ct([E.coordinates],!1,R,y,w));break;case"LineString":w=Math.min(w,ct(E.coordinates,!0,R,y,w));break;case"Polygon":w=Math.min(w,le(R,E.coordinates,y,w))}if(w===0)return w}return w})(e,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class pn{constructor(e){this.type=wn,this.key=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=e[1];return l==null?n.error("Global state property must be defined."):typeof l!="string"?n.error(`Global state property must be string, but found ${typeof e[1]} instead.`):new pn(l)}evaluate(e){var n;const l=(n=e.globals)===null||n===void 0?void 0:n.globalState;return l&&Object.keys(l).length!==0?Ps(l,this.key):null}eachChild(){}outputDefined(){return!1}}const Nn={"==":Mh,"!=":Sl,">":jc,"<":Fc,">=":va,"<=":Ho,array:Br,at:Tn,boolean:Br,case:Tl,coalesce:Ra,collator:Xo,format:$s,image:El,in:bn,"index-of":Yo,interpolate:fa,"interpolate-hcl":fa,"interpolate-lab":fa,length:$o,let:Qn,literal:Si,match:On,number:Br,"number-format":da,object:Br,slice:Fr,step:jr,string:Br,"to-boolean":Qr,"to-color":Qr,"to-number":Qr,"to-string":Qr,var:_o,within:bo,distance:sn,"global-state":pn};class In{constructor(e,n,l,f){this.name=e,this.type=n,this._evaluate=l,this.args=f}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,n){const l=e[0],f=In.definitions[l];if(!f)return n.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(f)?f[0]:f.type,y=Array.isArray(f)?[[f[1],f[2]]]:f.overloads,w=y.filter((([R])=>!Array.isArray(R)||R.length===e.length-1));let E=null;for(const[R,N]of w){E=new ha(n.registry,vr,n.path,null,n.scope);const j=[];let q=!1;for(let Z=1;Z<e.length;Z++){const $=e[Z],Q=Array.isArray(R)?R[Z-1]:R.type,ee=E.parse($,1+j.length,Q);if(!ee){q=!0;break}j.push(ee)}if(!q)if(Array.isArray(R)&&R.length!==j.length)E.error(`Expected ${R.length} arguments, but found ${j.length} instead.`);else{for(let Z=0;Z<j.length;Z++){const $=Array.isArray(R)?R[Z]:R.type,Q=j[Z];E.concat(Z+1).checkSubtype($,Q.type)}if(E.errors.length===0)return new In(l,m,N,j)}}if(w.length===1)n.errors.push(...E.errors);else{const R=(w.length?w:y).map((([j])=>{return q=j,Array.isArray(q)?`(${q.map(Vn).join(", ")})`:`(${Vn(q.type)}...)`;var q})).join(" | "),N=[];for(let j=1;j<e.length;j++){const q=n.parse(e[j],1+N.length);if(!q)return null;N.push(Vn(q.type))}n.error(`Expected arguments of type ${R}, but found (${N.join(", ")}) instead.`)}return null}static register(e,n){In.definitions=n;for(const l in n)e[l]=In}}function hi(i,[e,n,l,f]){e=e.evaluate(i),n=n.evaluate(i),l=l.evaluate(i);const m=f?f.evaluate(i):1,y=ca(e,n,l,m);if(y)throw new ei(y);return new An(e/255,n/255,l/255,m,!1)}function hr(i,e){return i in e}function gi(i,e){const n=e[i];return n===void 0?null:n}function Jr(i){return{type:i}}function vr(i){if(i instanceof _o)return vr(i.boundExpression);if(i instanceof In&&i.name==="error"||i instanceof Xo||i instanceof bo||i instanceof sn||i instanceof pn)return!1;const e=i instanceof Qr||i instanceof Br;let n=!0;return i.eachChild((l=>{n=e?n&&vr(l):n&&l instanceof Si})),!!n&&Ls(i)&&So(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ls(i){if(i instanceof In&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof bo||i instanceof sn)return!1;let e=!0;return i.eachChild((n=>{e&&!Ls(n)&&(e=!1)})),e}function To(i){if(i instanceof In&&i.name==="feature-state")return!1;let e=!0;return i.eachChild((n=>{e&&!To(n)&&(e=!1)})),e}function So(i,e){if(i instanceof In&&e.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild((l=>{n&&!So(l,e)&&(n=!1)})),n}function Al(i){return{result:"success",value:i}}function Ks(i){return{result:"error",value:i}}function Da(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function pu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function Eo(i){return!!i.expression&&i.expression.interpolated}function Ln(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Dh(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&ci(i)===Ga}function ds(i){return i}function Lh(i,e){const n=i.stops&&typeof i.stops[0][0]=="object",l=n||!(n||i.property!==void 0),f=i.type||(Eo(e)?"exponential":"interval"),m=(function(N){switch(N.type){case"color":return An.parse;case"padding":return ir.parse;case"numberArray":return Di.parse;case"colorArray":return vn.parse;default:return null}})(e);if(m&&((i=_r({},i)).stops&&(i.stops=i.stops.map((N=>[N[0],m(N[1])]))),i.default=m(i.default?i.default:e.default)),i.colorSpace&&(y=i.colorSpace)!=="rgb"&&y!=="hcl"&&y!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var y;const w=(function(N){switch(N){case"exponential":return kl;case"interval":return zh;case"categorical":return Pd;case"identity":return Af;default:throw new Error(`Unknown function type "${N}"`)}})(f);let E,R;if(f==="categorical"){E=Object.create(null);for(const N of i.stops)E[N[0]]=N[1];R=typeof i.stops[0][0]}if(n){const N={},j=[];for(let $=0;$<i.stops.length;$++){const Q=i.stops[$],ee=Q[0].zoom;N[ee]===void 0&&(N[ee]={zoom:ee,type:i.type,property:i.property,default:i.default,stops:[]},j.push(ee)),N[ee].stops.push([Q[0].value,Q[1]])}const q=[];for(const $ of j)q.push([N[$].zoom,Lh(N[$],e)]);const Z={name:"linear"};return{kind:"composite",interpolationType:Z,interpolationFactor:fa.interpolationFactor.bind(void 0,Z),zoomStops:q.map(($=>$[0])),evaluate:({zoom:$},Q)=>kl({stops:q,base:i.base},e,$).evaluate($,Q)}}if(l){const N=f==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:fa.interpolationFactor.bind(void 0,N),zoomStops:i.stops.map((j=>j[0])),evaluate:({zoom:j})=>w(i,e,j,E,R)}}return{kind:"source",evaluate(N,j){const q=j&&j.properties?j.properties[i.property]:void 0;return q===void 0?ps(i.default,e.default):w(i,e,q,E,R)}}}function ps(i,e,n){return i!==void 0?i:e!==void 0?e:n!==void 0?n:void 0}function Pd(i,e,n,l,f){return ps(typeof n===f?l[n]:void 0,i.default,e.default)}function zh(i,e,n){if(Ln(n)!=="number")return ps(i.default,e.default);const l=i.stops.length;if(l===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[l-1][0])return i.stops[l-1][1];const f=yo(i.stops.map((m=>m[0])),n);return i.stops[f][1]}function kl(i,e,n){const l=i.base!==void 0?i.base:1;if(Ln(n)!=="number")return ps(i.default,e.default);const f=i.stops.length;if(f===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[f-1][0])return i.stops[f-1][1];const m=yo(i.stops.map((N=>N[0])),n),y=(function(N,j,q,Z){const $=Z-q,Q=N-q;return $===0?0:j===1?Q/$:(Math.pow(j,Q)-1)/(Math.pow(j,$)-1)})(n,l,i.stops[m][0],i.stops[m+1][0]),w=i.stops[m][1],E=i.stops[m+1][1],R=Li[e.type]||ds;return typeof w.evaluate=="function"?{evaluate(...N){const j=w.evaluate.apply(void 0,N),q=E.evaluate.apply(void 0,N);if(j!==void 0&&q!==void 0)return R(j,q,y,i.colorSpace)}}:R(w,E,y,i.colorSpace)}function Af(i,e,n){switch(e.type){case"color":n=An.parse(n);break;case"formatted":n=$i.fromString(n.toString());break;case"resolvedImage":n=kn.fromString(n.toString());break;case"padding":n=ir.parse(n);break;case"colorArray":n=vn.parse(n);break;case"numberArray":n=Di.parse(n);break;default:Ln(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0)}return ps(n,i.default,e.default)}In.register(Nn,{error:[{kind:"error"},[Sn],(i,[e])=>{throw new ei(e.evaluate(i))}],typeof:[Sn,[wn],(i,[e])=>Vn(ci(e.evaluate(i)))],"to-rgba":[Er(Ut,4),[yr],(i,[e])=>{const[n,l,f,m]=e.evaluate(i).rgb;return[255*n,255*l,255*f,m]}],rgb:[yr,[Ut,Ut,Ut],hi],rgba:[yr,[Ut,Ut,Ut,Ut],hi],has:{type:Mn,overloads:[[[Sn],(i,[e])=>hr(e.evaluate(i),i.properties())],[[Sn,Ga],(i,[e,n])=>hr(e.evaluate(i),n.evaluate(i))]]},get:{type:wn,overloads:[[[Sn],(i,[e])=>gi(e.evaluate(i),i.properties())],[[Sn,Ga],(i,[e,n])=>gi(e.evaluate(i),n.evaluate(i))]]},"feature-state":[wn,[Sn],(i,[e])=>gi(e.evaluate(i),i.featureState||{})],properties:[Ga,[],i=>i.properties()],"geometry-type":[Sn,[],i=>i.geometryType()],id:[wn,[],i=>i.id()],zoom:[Ut,[],i=>i.globals.zoom],"heatmap-density":[Ut,[],i=>i.globals.heatmapDensity||0],elevation:[Ut,[],i=>i.globals.elevation||0],"line-progress":[Ut,[],i=>i.globals.lineProgress||0],accumulated:[wn,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ut,Jr(Ut),(i,e)=>{let n=0;for(const l of e)n+=l.evaluate(i);return n}],"*":[Ut,Jr(Ut),(i,e)=>{let n=1;for(const l of e)n*=l.evaluate(i);return n}],"-":{type:Ut,overloads:[[[Ut,Ut],(i,[e,n])=>e.evaluate(i)-n.evaluate(i)],[[Ut],(i,[e])=>-e.evaluate(i)]]},"/":[Ut,[Ut,Ut],(i,[e,n])=>e.evaluate(i)/n.evaluate(i)],"%":[Ut,[Ut,Ut],(i,[e,n])=>e.evaluate(i)%n.evaluate(i)],ln2:[Ut,[],()=>Math.LN2],pi:[Ut,[],()=>Math.PI],e:[Ut,[],()=>Math.E],"^":[Ut,[Ut,Ut],(i,[e,n])=>Math.pow(e.evaluate(i),n.evaluate(i))],sqrt:[Ut,[Ut],(i,[e])=>Math.sqrt(e.evaluate(i))],log10:[Ut,[Ut],(i,[e])=>Math.log(e.evaluate(i))/Math.LN10],ln:[Ut,[Ut],(i,[e])=>Math.log(e.evaluate(i))],log2:[Ut,[Ut],(i,[e])=>Math.log(e.evaluate(i))/Math.LN2],sin:[Ut,[Ut],(i,[e])=>Math.sin(e.evaluate(i))],cos:[Ut,[Ut],(i,[e])=>Math.cos(e.evaluate(i))],tan:[Ut,[Ut],(i,[e])=>Math.tan(e.evaluate(i))],asin:[Ut,[Ut],(i,[e])=>Math.asin(e.evaluate(i))],acos:[Ut,[Ut],(i,[e])=>Math.acos(e.evaluate(i))],atan:[Ut,[Ut],(i,[e])=>Math.atan(e.evaluate(i))],min:[Ut,Jr(Ut),(i,e)=>Math.min(...e.map((n=>n.evaluate(i))))],max:[Ut,Jr(Ut),(i,e)=>Math.max(...e.map((n=>n.evaluate(i))))],abs:[Ut,[Ut],(i,[e])=>Math.abs(e.evaluate(i))],round:[Ut,[Ut],(i,[e])=>{const n=e.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ut,[Ut],(i,[e])=>Math.floor(e.evaluate(i))],ceil:[Ut,[Ut],(i,[e])=>Math.ceil(e.evaluate(i))],"filter-==":[Mn,[Sn,wn],(i,[e,n])=>i.properties()[e.value]===n.value],"filter-id-==":[Mn,[wn],(i,[e])=>i.id()===e.value],"filter-type-==":[Mn,[Sn],(i,[e])=>i.geometryType()===e.value],"filter-<":[Mn,[Sn,wn],(i,[e,n])=>{const l=i.properties()[e.value],f=n.value;return typeof l==typeof f&&l<f}],"filter-id-<":[Mn,[wn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<l}],"filter->":[Mn,[Sn,wn],(i,[e,n])=>{const l=i.properties()[e.value],f=n.value;return typeof l==typeof f&&l>f}],"filter-id->":[Mn,[wn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>l}],"filter-<=":[Mn,[Sn,wn],(i,[e,n])=>{const l=i.properties()[e.value],f=n.value;return typeof l==typeof f&&l<=f}],"filter-id-<=":[Mn,[wn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n<=l}],"filter->=":[Mn,[Sn,wn],(i,[e,n])=>{const l=i.properties()[e.value],f=n.value;return typeof l==typeof f&&l>=f}],"filter-id->=":[Mn,[wn],(i,[e])=>{const n=i.id(),l=e.value;return typeof n==typeof l&&n>=l}],"filter-has":[Mn,[wn],(i,[e])=>e.value in i.properties()],"filter-has-id":[Mn,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Mn,[Er(Sn)],(i,[e])=>e.value.indexOf(i.geometryType())>=0],"filter-id-in":[Mn,[Er(wn)],(i,[e])=>e.value.indexOf(i.id())>=0],"filter-in-small":[Mn,[Sn,Er(wn)],(i,[e,n])=>n.value.indexOf(i.properties()[e.value])>=0],"filter-in-large":[Mn,[Sn,Er(wn)],(i,[e,n])=>(function(l,f,m,y){for(;m<=y;){const w=m+y>>1;if(f[w]===l)return!0;f[w]>l?y=w-1:m=w+1}return!1})(i.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Mn,overloads:[[[Mn,Mn],(i,[e,n])=>e.evaluate(i)&&n.evaluate(i)],[Jr(Mn),(i,e)=>{for(const n of e)if(!n.evaluate(i))return!1;return!0}]]},any:{type:Mn,overloads:[[[Mn,Mn],(i,[e,n])=>e.evaluate(i)||n.evaluate(i)],[Jr(Mn),(i,e)=>{for(const n of e)if(n.evaluate(i))return!0;return!1}]]},"!":[Mn,[Mn],(i,[e])=>!e.evaluate(i)],"is-supported-script":[Mn,[Sn],(i,[e])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(e.evaluate(i))}],upcase:[Sn,[Sn],(i,[e])=>e.evaluate(i).toUpperCase()],downcase:[Sn,[Sn],(i,[e])=>e.evaluate(i).toLowerCase()],concat:[Sn,Jr(wn),(i,e)=>e.map((n=>Xs(n.evaluate(i)))).join("")],"resolved-locale":[Sn,[ls],(i,[e])=>e.evaluate(i).resolvedLocale()]});class Oh{constructor(e,n,l){this.expression=e,this._warningHistory={},this._evaluator=new go,this._defaultValue=n?(function(f){if(f.type==="color"&&Dh(f.default))return new An(0,0,0,0);switch(f.type){case"color":return An.parse(f.default)||null;case"padding":return ir.parse(f.default)||null;case"numberArray":return Di.parse(f.default)||null;case"colorArray":return vn.parse(f.default)||null;case"variableAnchorOffsetCollection":return Ni.parse(f.default)||null;case"projectionDefinition":return mi.parse(f.default)||null;default:return f.default===void 0?null:f.default}})(n):null,this._enumValues=n&&n.type==="enum"?n.values:null,this._globalState=l}evaluateWithoutErrorHandling(e,n,l,f,m,y){return this._globalState&&(e=ta(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=l,this._evaluator.canonical=f,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,n,l,f,m,y){this._globalState&&(e=ta(e,this._globalState)),this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=l||null,this._evaluator.canonical=f,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map((E=>JSON.stringify(E))).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Pl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in Nn}function qc(i,e,n){const l=new ha(Nn,vr,[],e?(function(m){const y={color:yr,string:Sn,number:Ut,enum:Sn,boolean:Mn,formatted:pi,padding:Zs,numberArray:ka,colorArray:Cs,projectionDefinition:Ms,resolvedImage:Ti,variableAnchorOffsetCollection:ho};return m.type==="array"?Er(y[m.value]||wn,m.length):y[m.type]})(e):void 0),f=l.parse(i,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Al(new Oh(f,e,n)):Ks(l.errors)}class La{constructor(e,n,l){this.kind=e,this._styleExpression=n,this.isStateDependent=e!=="constant"&&!To(n.expression),this.globalStateRefs=ea(n.expression),this._globalState=l}evaluateWithoutErrorHandling(e,n,l,f,m,y){return this._globalState&&(e=ta(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,f,m,y)}evaluate(e,n,l,f,m,y){return this._globalState&&(e=ta(e,this._globalState)),this._styleExpression.evaluate(e,n,l,f,m,y)}}class Rl{constructor(e,n,l,f,m){this.kind=e,this.zoomStops=l,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!To(n.expression),this.globalStateRefs=ea(n.expression),this.interpolationType=f,this._globalState=m}evaluateWithoutErrorHandling(e,n,l,f,m,y){return this._globalState&&(e=ta(e,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(e,n,l,f,m,y)}evaluate(e,n,l,f,m,y){return this._globalState&&(e=ta(e,this._globalState)),this._styleExpression.evaluate(e,n,l,f,m,y)}interpolationFactor(e,n,l){return this.interpolationType?fa.interpolationFactor(this.interpolationType,e,n,l):0}}function Dl(i,e,n){const l=qc(i,e,n);if(l.result==="error")return l;const f=l.value.expression,m=Ls(f);if(!m&&!Da(e))return Ks([new Xr("","data expressions not supported")]);const y=So(f,["zoom"]);if(!y&&!pu(e))return Ks([new Xr("","zoom expressions not supported")]);const w=Ll(f);return w||y?w instanceof Xr?Ks([w]):w instanceof fa&&!Eo(e)?Ks([new Xr("",'"interpolate" expressions cannot be used with this property')]):Al(w?new Rl(m?"camera":"composite",l.value,w.labels,w instanceof fa?w.interpolation:void 0,n):new La(m?"constant":"source",l.value,n)):Ks([new Xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class mu{constructor(e,n){this._parameters=e,this._specification=n,_r(this,Lh(this._parameters,this._specification))}static deserialize(e){return new mu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Ll(i){let e=null;if(i instanceof Qn)e=Ll(i.result);else if(i instanceof Ra){for(const n of i.args)if(e=Ll(n),e)break}else(i instanceof jr||i instanceof fa)&&i.input instanceof In&&i.input.name==="zoom"&&(e=i);return e instanceof Xr||i.eachChild((n=>{const l=Ll(n);l instanceof Xr?e=l:!e&&l?e=new Xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new Xr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function ea(i,e=new Set){return i instanceof pn&&e.add(i.key),i.eachChild((n=>{ea(n,e)})),e}function ta(i,e){const{zoom:n,heatmapDensity:l,elevation:f,lineProgress:m,isSupportedScript:y,accumulated:w}=i??{};return{zoom:n,heatmapDensity:l,elevation:f,lineProgress:m,isSupportedScript:y,accumulated:w,globalState:e}}function Mo(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const e of i.slice(1))if(!Mo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const Co={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Xa(i,e){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Mo(i)||(i=gu(i));const n=qc(i,Co,e);if(n.result==="error")throw new Error(n.value.map((l=>`${l.key}: ${l.message}`)).join(", "));return{filter:(l,f,m)=>n.value.evaluate(l,f,{},m),needGeometry:kf(i),getGlobalStateRefs:()=>ea(n.value.expression)}}function Qo(i,e){return i<e?-1:i>e?1:0}function kf(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let e=1;e<i.length;e++)if(kf(i[e]))return!0;return!1}function gu(i){if(!i)return!0;const e=i[0];return i.length<=1?e!=="any":e==="=="?ec(i[1],i[2],"=="):e==="!="?Ei(ec(i[1],i[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ec(i[1],i[2],e):e==="any"?(n=i.slice(1),["any"].concat(n.map(gu))):e==="all"?["all"].concat(i.slice(1).map(gu)):e==="none"?["all"].concat(i.slice(1).map(gu).map(Ei)):e==="in"?Pf(i[1],i.slice(2)):e==="!in"?Ei(Pf(i[1],i.slice(2))):e==="has"?na(i[1]):e!=="!has"||Ei(na(i[1]));var n}function ec(i,e,n){switch(i){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,i,e]}}function Pf(i,e){if(e.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((n=>typeof n!=typeof e[0]))?["filter-in-large",i,["literal",e.sort(Qo)]]:["filter-in-small",i,["literal",e]]}}function na(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ei(i){return["!",i]}function Zn(i){const e=typeof i;if(e==="number"||e==="boolean"||e==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let f="[";for(const m of i)f+=`${Zn(m)},`;return`${f}]`}const n=Object.keys(i).sort();let l="{";for(let f=0;f<n.length;f++)l+=`${JSON.stringify(n[f])}:${Zn(i[n[f]])},`;return`${l}}`}function Jo(i){let e="";for(const n of ii)e+=`/${Zn(i[n])}`;return e}function ms(i){const e=i.value;return e?[new Gt(i.key,e,"constants have been deprecated as of v8")]:[]}function Wi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function $a(i){if(Array.isArray(i))return i.map($a);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const e={};for(const n in i)e[n]=$a(i[n]);return e}return Wi(i)}function gs(i){const e=i.key,n=i.value,l=i.valueSpec||{},f=i.objectElementValidators||{},m=i.style,y=i.styleSpec,w=i.validateSpec;let E=[];const R=Ln(n);if(R!=="object")return[new Gt(e,n,`object expected, ${R} found`)];for(const N in n){const j=N.split(".")[0],q=Ps(l,j)||l["*"];let Z;if(Ps(f,j))Z=f[j];else if(Ps(l,j))Z=w;else if(f["*"])Z=f["*"];else{if(!l["*"]){E.push(new Gt(e,n[N],`unknown property "${N}"`));continue}Z=w}E=E.concat(Z({key:(e&&`${e}.`)+N,value:n[N],valueSpec:q,style:m,styleSpec:y,object:n,objectKey:N,validateSpec:w},n))}for(const N in l)f[N]||l[N].required&&l[N].default===void 0&&n[N]===void 0&&E.push(new Gt(e,n,`missing required property "${N}"`));return E}function Zc(i){const e=i.value,n=i.valueSpec,l=i.style,f=i.styleSpec,m=i.key,y=i.arrayElementValidator||i.validateSpec;if(Ln(e)!=="array")return[new Gt(m,e,`array expected, ${Ln(e)} found`)];if(n.length&&e.length!==n.length)return[new Gt(m,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Gt(m,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let w={type:n.value,values:n.values};f.$version<7&&(w.function=n.function),Ln(n.value)==="object"&&(w=n.value);let E=[];for(let R=0;R<e.length;R++)E=E.concat(y({array:e,arrayIndex:R,value:e[R],valueSpec:w,validateSpec:i.validateSpec,style:l,styleSpec:f,key:`${m}[${R}]`}));return E}function Io(i){const e=i.key,n=i.value,l=i.valueSpec;let f=Ln(n);return f==="number"&&n!=n&&(f="NaN"),f!=="number"?[new Gt(e,n,`number expected, ${f} found`)]:"minimum"in l&&n<l.minimum?[new Gt(e,n,`${n} is less than the minimum value ${l.minimum}`)]:"maximum"in l&&n>l.maximum?[new Gt(e,n,`${n} is greater than the maximum value ${l.maximum}`)]:[]}function Ao(i){const e=i.valueSpec,n=Wi(i.value.type);let l,f,m,y={};const w=n!=="categorical"&&i.value.property===void 0,E=!w,R=Ln(i.value.stops)==="array"&&Ln(i.value.stops[0])==="array"&&Ln(i.value.stops[0][0])==="object",N=gs({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(Z){if(n==="identity")return[new Gt(Z.key,Z.value,'identity function may not have a "stops" property')];let $=[];const Q=Z.value;return $=$.concat(Zc({key:Z.key,value:Q,valueSpec:Z.valueSpec,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:j})),Ln(Q)==="array"&&Q.length===0&&$.push(new Gt(Z.key,Q,"array must have at least one stop")),$},default:function(Z){return Z.validateSpec({key:Z.key,value:Z.value,valueSpec:e,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec})}}});return n==="identity"&&w&&N.push(new Gt(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||N.push(new Gt(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!Eo(i.valueSpec)&&N.push(new Gt(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(E&&!Da(i.valueSpec)?N.push(new Gt(i.key,i.value,"property functions not supported")):w&&!pu(i.valueSpec)&&N.push(new Gt(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!R||i.value.property!==void 0||N.push(new Gt(i.key,i.value,'"property" property is required')),N;function j(Z){let $=[];const Q=Z.value,ee=Z.key;if(Ln(Q)!=="array")return[new Gt(ee,Q,`array expected, ${Ln(Q)} found`)];if(Q.length!==2)return[new Gt(ee,Q,`array length 2 expected, length ${Q.length} found`)];if(R){if(Ln(Q[0])!=="object")return[new Gt(ee,Q,`object expected, ${Ln(Q[0])} found`)];if(Q[0].zoom===void 0)return[new Gt(ee,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new Gt(ee,Q,"object stop key must have value")];if(m&&m>Wi(Q[0].zoom))return[new Gt(ee,Q[0].zoom,"stop zoom values must appear in ascending order")];Wi(Q[0].zoom)!==m&&(m=Wi(Q[0].zoom),f=void 0,y={}),$=$.concat(gs({key:`${ee}[0]`,value:Q[0],valueSpec:{zoom:{}},validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Io,value:q}}))}else $=$.concat(q({key:`${ee}[0]`,value:Q[0],validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec},Q));return Pl($a(Q[1]))?$.concat([new Gt(`${ee}[1]`,Q[1],"expressions are not allowed in function stops.")]):$.concat(Z.validateSpec({key:`${ee}[1]`,value:Q[1],valueSpec:e,validateSpec:Z.validateSpec,style:Z.style,styleSpec:Z.styleSpec}))}function q(Z,$){const Q=Ln(Z.value),ee=Wi(Z.value),se=Z.value!==null?Z.value:$;if(l){if(Q!==l)return[new Gt(Z.key,se,`${Q} stop domain type must match previous stop domain type ${l}`)]}else l=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean")return[new Gt(Z.key,se,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&n!=="categorical"){let Te=`number expected, ${Q} found`;return Da(e)&&n===void 0&&(Te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Gt(Z.key,se,Te)]}return n!=="categorical"||Q!=="number"||isFinite(ee)&&Math.floor(ee)===ee?n!=="categorical"&&Q==="number"&&f!==void 0&&ee<f?[new Gt(Z.key,se,"stop domain values must appear in ascending order")]:(f=ee,n==="categorical"&&ee in y?[new Gt(Z.key,se,"stop domain values must be unique")]:(y[ee]=!0,[])):[new Gt(Z.key,se,`integer expected, found ${ee}`)]}}function ko(i){const e=(i.expressionContext==="property"?Dl:qc)($a(i.value),i.valueSpec);if(e.result==="error")return e.value.map((l=>new Gt(`${i.key}${l.key}`,i.value,l.message)));const n=e.value.expression||e.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Gt(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!To(n))return[new Gt(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!To(n))return[new Gt(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!So(n,["zoom","feature-state"]))return[new Gt(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Ls(n))return[new Gt(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function el(i){const e=i.key,n=i.value,l=Ln(n);return l!=="string"?[new Gt(e,n,`color expected, ${l} found`)]:An.parse(String(n))?[]:[new Gt(e,n,`color expected, "${n}" found`)]}function tl(i){const e=i.key,n=i.value,l=i.valueSpec,f=[];return Array.isArray(l.values)?l.values.indexOf(Wi(n))===-1&&f.push(new Gt(e,n,`expected one of [${l.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(l.values).indexOf(Wi(n))===-1&&f.push(new Gt(e,n,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(n)} found`)),f}function zs(i){return Mo($a(i.value))?ko(_r({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Po(i)}function Po(i){const e=i.value,n=i.key;if(Ln(e)!=="array")return[new Gt(n,e,`array expected, ${Ln(e)} found`)];const l=i.styleSpec;let f,m=[];if(e.length<1)return[new Gt(n,e,"filter array must have at least 1 element")];switch(m=m.concat(tl({key:`${n}[0]`,value:e[0],valueSpec:l.filter_operator,style:i.style,styleSpec:i.styleSpec})),Wi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Wi(e[1])==="$type"&&m.push(new Gt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Gt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(f=Ln(e[1]),f!=="string"&&m.push(new Gt(`${n}[1]`,e[1],`string expected, ${f} found`)));for(let y=2;y<e.length;y++)f=Ln(e[y]),Wi(e[1])==="$type"?m=m.concat(tl({key:`${n}[${y}]`,value:e[y],valueSpec:l.geometry_type,style:i.style,styleSpec:i.styleSpec})):f!=="string"&&f!=="number"&&f!=="boolean"&&m.push(new Gt(`${n}[${y}]`,e[y],`string, number, or boolean expected, ${f} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)m=m.concat(Po({key:`${n}[${y}]`,value:e[y],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":f=Ln(e[1]),e.length!==2?m.push(new Gt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):f!=="string"&&m.push(new Gt(`${n}[1]`,e[1],`string expected, ${f} found`))}return m}function nl(i,e){const n=i.key,l=i.validateSpec,f=i.style,m=i.styleSpec,y=i.value,w=i.objectKey,E=m[`${e}_${i.layerType}`];if(!E)return[];const R=w.match(/^(.*)-transition$/);if(e==="paint"&&R&&E[R[1]]&&E[R[1]].transition)return l({key:n,value:y,valueSpec:m.transition,style:f,styleSpec:m});const N=i.valueSpec||E[w];if(!N)return[new Gt(n,y,`unknown property "${w}"`)];let j;if(Ln(y)==="string"&&Da(N)&&!N.tokens&&(j=/^{([^}]+)}$/.exec(y)))return[new Gt(n,y,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const q=[];return i.layerType==="symbol"&&w==="text-font"&&Dh($a(y))&&Wi(y.type)==="identity"&&q.push(new Gt(n,y,'"text-font" does not support identity functions')),q.concat(l({key:i.key,value:y,valueSpec:N,style:f,styleSpec:m,expressionContext:"property",propertyType:e,propertyKey:w}))}function Ro(i){return nl(i,"paint")}function Nh(i){return nl(i,"layout")}function Bh(i){let e=[];const n=i.value,l=i.key,f=i.style,m=i.styleSpec;if(Ln(n)!=="object")return[new Gt(l,n,`object expected, ${Ln(n)} found`)];n.type||n.ref||e.push(new Gt(l,n,'either "type" or "ref" is required'));let y=Wi(n.type);const w=Wi(n.ref);if(n.id){const E=Wi(n.id);for(let R=0;R<i.arrayIndex;R++){const N=f.layers[R];Wi(N.id)===E&&e.push(new Gt(l,n.id,`duplicate layer id "${n.id}", previously used at line ${N.id.__line__}`))}}if("ref"in n){let E;["type","source","source-layer","filter","layout"].forEach((R=>{R in n&&e.push(new Gt(l,n[R],`"${R}" is prohibited for ref layers`))})),f.layers.forEach((R=>{Wi(R.id)===w&&(E=R)})),E?E.ref?e.push(new Gt(l,n.ref,"ref cannot reference another ref layer")):y=Wi(E.type):e.push(new Gt(l,n.ref,`ref layer "${w}" not found`))}else if(y!=="background")if(n.source){const E=f.sources&&f.sources[n.source],R=E&&Wi(E.type);E?R==="vector"&&y==="raster"?e.push(new Gt(l,n.source,`layer "${n.id}" requires a raster source`)):R!=="raster-dem"&&y==="hillshade"||R!=="raster-dem"&&y==="color-relief"?e.push(new Gt(l,n.source,`layer "${n.id}" requires a raster-dem source`)):R==="raster"&&y!=="raster"?e.push(new Gt(l,n.source,`layer "${n.id}" requires a vector source`)):R!=="vector"||n["source-layer"]?R==="raster-dem"&&y!=="hillshade"&&y!=="color-relief"?e.push(new Gt(l,n.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):y!=="line"||!n.paint||!n.paint["line-gradient"]||R==="geojson"&&E.lineMetrics||e.push(new Gt(l,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Gt(l,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Gt(l,n.source,`source "${n.source}" not found`))}else e.push(new Gt(l,n,'missing required property "source"'));return e=e.concat(gs({key:l,value:n,valueSpec:m.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${l}.type`,value:n.type,valueSpec:m.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:zs,layout:E=>gs({layer:n,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":R=>Nh(_r({layerType:y},R))}}),paint:E=>gs({layer:n,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":R=>Ro(_r({layerType:y},R))}})}})),e}function Os(i){const e=i.value,n=i.key,l=Ln(e);return l!=="string"?[new Gt(n,e,`string expected, ${l} found`)]:[]}const tc={promoteId:function({key:i,value:e}){if(Ln(e)==="string")return Os({key:i,value:e});{const n=[];for(const l in e)n.push(...Os({key:`${i}.${l}`,value:e[l]}));return n}}};function il(i){const e=i.value,n=i.key,l=i.styleSpec,f=i.style,m=i.validateSpec;if(!e.type)return[new Gt(n,e,'"type" is required')];const y=Wi(e.type);let w;switch(y){case"vector":case"raster":return w=gs({key:n,value:e,valueSpec:l[`source_${y.replace("-","_")}`],style:i.style,styleSpec:l,objectElementValidators:tc,validateSpec:m}),w;case"raster-dem":return w=(function(E){var R;const N=(R=E.sourceName)!==null&&R!==void 0?R:"",j=E.value,q=E.styleSpec,Z=q.source_raster_dem,$=E.style;let Q=[];const ee=Ln(j);if(j===void 0)return Q;if(ee!=="object")return Q.push(new Gt("source_raster_dem",j,`object expected, ${ee} found`)),Q;const se=Wi(j.encoding)==="custom",Te=["redFactor","greenFactor","blueFactor","baseShift"],ue=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const pe in j)!se&&Te.includes(pe)?Q.push(new Gt(pe,j[pe],`In "${N}": "${pe}" is only valid when "encoding" is set to "custom". ${ue} encoding found`)):Z[pe]?Q=Q.concat(E.validateSpec({key:pe,value:j[pe],valueSpec:Z[pe],validateSpec:E.validateSpec,style:$,styleSpec:q})):Q.push(new Gt(pe,j[pe],`unknown property "${pe}"`));return Q})({sourceName:n,value:e,style:i.style,styleSpec:l,validateSpec:m}),w;case"geojson":if(w=gs({key:n,value:e,valueSpec:l.source_geojson,style:f,styleSpec:l,validateSpec:m,objectElementValidators:tc}),e.cluster)for(const E in e.clusterProperties){const[R,N]=e.clusterProperties[E],j=typeof R=="string"?[R,["accumulated"],["get",E]]:R;w.push(...ko({key:`${n}.${E}.map`,value:N,expressionContext:"cluster-map"})),w.push(...ko({key:`${n}.${E}.reduce`,value:j,expressionContext:"cluster-reduce"}))}return w;case"video":return gs({key:n,value:e,valueSpec:l.source_video,style:f,validateSpec:m,styleSpec:l});case"image":return gs({key:n,value:e,valueSpec:l.source_image,style:f,validateSpec:m,styleSpec:l});case"canvas":return[new Gt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return tl({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function xr(i){const e=i.value,n=i.styleSpec,l=n.light,f=i.style;let m=[];const y=Ln(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Gt("light",e,`object expected, ${y} found`)]),m;for(const w in e){const E=w.match(/^(.*)-transition$/);m=m.concat(E&&l[E[1]]&&l[E[1]].transition?i.validateSpec({key:w,value:e[w],valueSpec:n.transition,validateSpec:i.validateSpec,style:f,styleSpec:n}):l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],validateSpec:i.validateSpec,style:f,styleSpec:n}):[new Gt(w,e[w],`unknown property "${w}"`)])}return m}function Yc(i){const e=i.value,n=i.styleSpec,l=n.sky,f=i.style,m=Ln(e);if(e===void 0)return[];if(m!=="object")return[new Gt("sky",e,`object expected, ${m} found`)];let y=[];for(const w in e)y=y.concat(l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],style:f,styleSpec:n}):[new Gt(w,e[w],`unknown property "${w}"`)]);return y}function Fh(i){const e=i.value,n=i.styleSpec,l=n.terrain,f=i.style;let m=[];const y=Ln(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Gt("terrain",e,`object expected, ${y} found`)]),m;for(const w in e)m=m.concat(l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],validateSpec:i.validateSpec,style:f,styleSpec:n}):[new Gt(w,e[w],`unknown property "${w}"`)]);return m}function Rf(i){let e=[];const n=i.value,l=i.key;if(Array.isArray(n)){const f=[],m=[];for(const y in n)n[y].id&&f.includes(n[y].id)&&e.push(new Gt(l,n,`all the sprites' ids must be unique, but ${n[y].id} is duplicated`)),f.push(n[y].id),n[y].url&&m.includes(n[y].url)&&e.push(new Gt(l,n,`all the sprites' URLs must be unique, but ${n[y].url} is duplicated`)),m.push(n[y].url),e=e.concat(gs({key:`${l}[${y}]`,value:n[y],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return e}return Os({key:l,value:n})}function Rd(i){return e=i.value,e&&e.constructor===Object?[]:[new Gt(i.key,i.value,`object expected, ${Ln(i.value)} found`)];var e}const Df={"*":()=>[],array:Zc,boolean:function(i){const e=i.value,n=i.key,l=Ln(e);return l!=="boolean"?[new Gt(n,e,`boolean expected, ${l} found`)]:[]},number:Io,color:el,constants:ms,enum:tl,filter:zs,function:Ao,layer:Bh,object:gs,source:il,light:xr,sky:Yc,terrain:Fh,projection:function(i){const e=i.value,n=i.styleSpec,l=n.projection,f=i.style,m=Ln(e);if(e===void 0)return[];if(m!=="object")return[new Gt("projection",e,`object expected, ${m} found`)];let y=[];for(const w in e)y=y.concat(l[w]?i.validateSpec({key:w,value:e[w],valueSpec:l[w],style:f,styleSpec:n}):[new Gt(w,e[w],`unknown property "${w}"`)]);return y},projectionDefinition:function(i){const e=i.key;let n=i.value;n=n instanceof String?n.valueOf():n;const l=Ln(n);return l!=="array"||(function(f){return Array.isArray(f)&&f.length===3&&typeof f[0]=="string"&&typeof f[1]=="string"&&typeof f[2]=="number"})(n)||(function(f){return!!["interpolate","step","literal"].includes(f[0])})(n)?["array","string"].includes(l)?[]:[new Gt(e,n,`projection expected, invalid type "${l}" found`)]:[new Gt(e,n,`projection expected, invalid array ${JSON.stringify(n)} found`)]},string:Os,formatted:function(i){return Os(i).length===0?[]:ko(i)},resolvedImage:function(i){return Os(i).length===0?[]:ko(i)},padding:function(i){const e=i.key,n=i.value;if(Ln(n)==="array"){if(n.length<1||n.length>4)return[new Gt(e,n,`padding requires 1 to 4 values; ${n.length} values found`)];const l={type:"number"};let f=[];for(let m=0;m<n.length;m++)f=f.concat(i.validateSpec({key:`${e}[${m}]`,value:n[m],validateSpec:i.validateSpec,valueSpec:l}));return f}return Io({key:e,value:n,valueSpec:{}})},numberArray:function(i){const e=i.key,n=i.value;if(Ln(n)==="array"){const l={type:"number"};if(n.length<1)return[new Gt(e,n,"array length at least 1 expected, length 0 found")];let f=[];for(let m=0;m<n.length;m++)f=f.concat(i.validateSpec({key:`${e}[${m}]`,value:n[m],validateSpec:i.validateSpec,valueSpec:l}));return f}return Io({key:e,value:n,valueSpec:{}})},colorArray:function(i){const e=i.key,n=i.value;if(Ln(n)==="array"){if(n.length<1)return[new Gt(e,n,"array length at least 1 expected, length 0 found")];let l=[];for(let f=0;f<n.length;f++)l=l.concat(el({key:`${e}[${f}]`,value:n[f]}));return l}return el({key:e,value:n})},variableAnchorOffsetCollection:function(i){const e=i.key,n=i.value,l=Ln(n),f=i.styleSpec;if(l!=="array"||n.length<1||n.length%2!=0)return[new Gt(e,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let m=[];for(let y=0;y<n.length;y+=2)m=m.concat(tl({key:`${e}[${y}]`,value:n[y],valueSpec:f.layout_symbol["text-anchor"]})),m=m.concat(Zc({key:`${e}[${y+1}]`,value:n[y+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:f}));return m},sprite:Rf,state:Rd};function Ki(i){const e=i.value,n=i.valueSpec,l=i.styleSpec;return i.validateSpec=Ki,n.expression&&Dh(Wi(e))?Ao(i):n.expression&&Pl($a(e))?ko(i):n.type&&Df[n.type]?Df[n.type](i):gs(_r({},i,{valueSpec:n.type?l[n.type]:n}))}function zl(i){const e=i.value,n=i.key,l=Os(i);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new Gt(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new Gt(n,e,'"glyphs" url must include a "{range}" token'))),l}function wa(i,e=it){let n=[];return n=n.concat(Ki({key:"",value:i,valueSpec:e.$root,styleSpec:e,style:i,validateSpec:Ki,objectElementValidators:{glyphs:zl,"*":()=>[]}})),i.constants&&(n=n.concat(ms({key:"constants",value:i.constants}))),jh(n)}function za(i){return function(e){return i(Object.assign({},e,{validateSpec:Ki}))}}function jh(i){return[].concat(i).sort(((e,n)=>e.line-n.line))}function Ta(i){return function(...e){return jh(i.apply(this,e))}}wa.source=Ta(za(il)),wa.sprite=Ta(za(Rf)),wa.glyphs=Ta(za(zl)),wa.light=Ta(za(xr)),wa.sky=Ta(za(Yc)),wa.terrain=Ta(za(Fh)),wa.state=Ta(za(Rd)),wa.layer=Ta(za(Bh)),wa.filter=Ta(za(zs)),wa.paintProperty=Ta(za(Ro)),wa.layoutProperty=Ta(za(Nh));const nc=it,ic=wa,rc=ic.light,Hc=ic.sky,Wa=ic.paintProperty,Qs=ic.layoutProperty;function Xc(i,e){let n=!1;if(e&&e.length)for(const l of e)i.fire(new zn(new Error(l.message))),n=!0;return n}class Ol{constructor(e,n,l){const f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(n=y[1])+2*(l=y[2]);for(let E=0;E<this.d*this.d;E++){const R=y[3+E],N=y[3+E+1];f.push(R===N?null:y.subarray(R,N))}const w=y[3+f.length+1];this.keys=y.subarray(y[3+f.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=n+2*l;for(let y=0;y<this.d*this.d;y++)f.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=e,this.padding=l,this.scale=n/e,this.uid=0;const m=l/n*e;this.min=-m,this.max=e+m}insert(e,n,l,f,m){this._forEachCell(n,l,f,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(n),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,n,l,f,m,y){this.cells[m].push(y)}query(e,n,l,f,m){const y=this.min,w=this.max;if(e<=y&&n<=y&&w<=l&&w<=f&&!m)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(e,n,l,f,this._queryCell,E,{},m),E}}_queryCell(e,n,l,f,m,y,w,E){const R=this.cells[m];if(R!==null){const N=this.keys,j=this.bboxes;for(let q=0;q<R.length;q++){const Z=R[q];if(w[Z]===void 0){const $=4*Z;(E?E(j[$+0],j[$+1],j[$+2],j[$+3]):e<=j[$+2]&&n<=j[$+3]&&l>=j[$+0]&&f>=j[$+1])?(w[Z]=!0,y.push(N[Z])):w[Z]=!1}}}}_forEachCell(e,n,l,f,m,y,w,E){const R=this._convertToCellCoord(e),N=this._convertToCellCoord(n),j=this._convertToCellCoord(l),q=this._convertToCellCoord(f);for(let Z=R;Z<=j;Z++)for(let $=N;$<=q;$++){const Q=this.d*$+Z;if((!E||E(this._convertFromCellCoord(Z),this._convertFromCellCoord($),this._convertFromCellCoord(Z+1),this._convertFromCellCoord($+1)))&&m.call(this,e,n,l,f,Q,y,w,E))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,n=3+this.cells.length+1+1;let l=0;for(let y=0;y<this.cells.length;y++)l+=this.cells[y].length;const f=new Int32Array(n+l+this.keys.length+this.bboxes.length);f[0]=this.extent,f[1]=this.n,f[2]=this.padding;let m=n;for(let y=0;y<e.length;y++){const w=e[y];f[3+y]=m,f.set(w,m),m+=w.length}return f[3+e.length]=m,f.set(this.keys,m),m+=this.keys.length,f[3+e.length+1]=m,f.set(this.bboxes,m),m+=this.bboxes.length,f.buffer}static serialize(e,n){const l=e.toArrayBuffer();return n&&n.push(l),{buffer:l}}static deserialize(e){return new Ol(e.buffer)}}const Do={};function Xt(i,e,n={}){if(Do[i])throw new Error(`${i} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:i,writeable:!1}),Do[i]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}Xt("Object",Object),Xt("Set",Set),Xt("TransferableGridIndex",Ol),Xt("Color",An),Xt("Error",Error),Xt("AJAXError",qe),Xt("ResolvedImage",kn),Xt("StylePropertyFunction",mu),Xt("StyleExpression",Oh,{omit:["_evaluator"]}),Xt("ZoomDependentExpression",Rl),Xt("ZoomConstantExpression",La),Xt("CompoundExpression",In,{omit:["_evaluate"]});for(const i in Nn)Nn[i]._classRegistryKey||Xt(`Expression_${i}`,Nn[i]);function $c(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function Nl(i){return i.$name||i.constructor._classRegistryKey}function Wc(i){return!(function(e){if(e===null||typeof e!="object")return!1;const n=Nl(e);return!(!n||n==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||$c(i)||Gs(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Bl(i,e){if(Wc(i))return($c(i)||Gs(i))&&e&&e.push(i),ArrayBuffer.isView(i)&&e&&e.push(i.buffer),i instanceof ImageData&&e&&e.push(i.data.buffer),i;if(Array.isArray(i)){const m=[];for(const y of i)m.push(Bl(y,e));return m}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=Nl(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Do[n])throw new Error(`${n} is not registered.`);const{klass:l}=Do[n],f=l.serialize?l.serialize(i,e):{};if(l.serialize){if(e&&f===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in i){if(!i.hasOwnProperty(m)||Do[n].omit.indexOf(m)>=0)continue;const y=i[m];f[m]=Do[n].shallow.indexOf(m)>=0?y:Bl(y,e)}i instanceof Error&&(f.message=i.message)}if(f.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(f.$name=n),f}function ac(i){if(Wc(i))return i;if(Array.isArray(i))return i.map(ac);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const e=Nl(i)||"Object";if(!Do[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:n}=Do[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(i);const l=Object.create(n.prototype);for(const f of Object.keys(i)){if(f==="$name")continue;const m=i[f];l[f]=Do[e].shallow.indexOf(f)>=0?m:ac(m)}return l}class _s{constructor(){this.first=!0}update(e,n){const l=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=n),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=l,!0))}}function _u(i){return/[\u02EA\u02EB\u2E80-\u2FDF\u2FF0-\u303F\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FD-\u30FF\u3105-\u312F\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Uh(i){return/[\u02EA\u02EB\u1100-\u11FF\u1400-\u167F\u18B0-\u18F5\u2E80-\u2E99\u2E9B-\u2EF3\u2F00-\u2FD5\u2FF0-\u3007\u3012\u3013\u3020-\u302F\u3031-\u303F\u3041-\u3096\u309D-\u30FB\u30FD-\u30FF\u3105-\u312F\u3131-\u318E\u3190-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE48\uFE50-\uFE57\uFE5F-\uFE62\uFE67-\uFE6F\uFF00-\uFF07\uFF0A-\uFF0C\uFF0E-\uFF19\uFF1F-\uFF3A\uFF3C\uFF3E\uFF40-\uFF5A\uFFE0-\uFFE2\uFFE4-\uFFE7]|\uD802[\uDD80-\uDD9F]|\uD805[\uDD80-\uDDFF]|\uD806[\uDE00-\uDEBF]|\uD811[\uDC00-\uDE7F]|\uD81B[\uDFE0-\uDFE4\uDFF0-\uDFF6]|[\uD81C-\uD822\uD83D\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD30-\uDEFB]|\uD833[\uDEC0-\uDFCF]|\uD834[\uDC00-\uDDFF\uDEE0-\uDF7F]|\uD836[\uDC00-\uDEAF]|\uD83C[\uDC00-\uDE00\uDF00-\uDFFF]|\uD83E[\uDD00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))}function Lf(i){return/\s/u.test(String.fromCodePoint(i))}function Ns(i){for(const e of i)if(Uh(e.codePointAt(0)))return!0;return!1}function Kc(i){for(const e of i)if(!Vh(e.codePointAt(0)))return!1;return!0}function Qc(i){const e=i.map((n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}})).filter((n=>n));return new RegExp(e.join("|"),"u")}const Fl=Qc(["Arab","Dupl","Mong","Ougr","Syrc"]);function Vh(i){return!Fl.test(String.fromCodePoint(i))}function Jc(i){return!(Uh(i)||(e=i,/[\xA7\xA9\xAE\xB1\xBC-\xBE\xD7\xF7\u2016\u2020\u2021\u2030\u2031\u203B\u203C\u2042\u2047-\u2049\u2051\u2100-\u218F\u221E\u2234\u2235\u2300-\u2307\u230C-\u231F\u2324-\u2328\u232B\u237D-\u239A\u23BE-\u23CD\u23CF\u23D1-\u23DB\u23E2-\u2422\u2424-\u24FF\u25A0-\u2619\u2620-\u2767\u2776-\u2793\u2B12-\u2B2F\u2B50-\u2B59\u2BB8-\u2BEB\u3000-\u303F\u30A0-\u30FF\uE000-\uF8FF\uFE30-\uFE6F\uFF00-\uFFEF\uFFFC\uFFFD]|[\uDB80-\uDBFF][\uDC00-\uDFFF]/gim.test(String.fromCodePoint(e))));var e}const Lo=Qc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Gh(i){return Lo.test(String.fromCodePoint(i))}function rl(i,e){return!(!e&&Gh(i)||/[\u0900-\u0DFF\u0F00-\u109F\u1780-\u17FF]/gim.test(String.fromCodePoint(i)))}function qh(i){for(const e of i)if(Gh(e.codePointAt(0)))return!0;return!1}const Js=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(Js.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,e){return c(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const n=i.pluginURL,l=new Promise((m=>{this.loadScriptResolve=m}));e(n);const f=new Promise((m=>setTimeout((()=>m()),this.TIMEOUT)));if(yield Promise.race([l,f]),this.isParsed()){const m={pluginStatus:"loaded",pluginURL:n};return this.setState(m),m}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${n}`)}))}};class Hn{constructor(e,n){this.isSupportedScript=al,this.zoom=e,n?(this.now=n.now||0,this.fadeDuration=n.fadeDuration||0,this.zoomHistory=n.zoomHistory||new _s,this.transition=n.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new _s,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,n=e-Math.floor(e),l=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*n}}}function al(i){return(function(e,n){for(const l of e)if(!rl(l.codePointAt(0),n))return!1;return!0})(i,Js.getRTLTextPluginStatus()==="loaded")}const jl="-transition";class yu{constructor(e,n,l){this.property=e,this.value=n,this.expression=(function(f,m,y){if(Dh(f))return new mu(f,m);if(Pl(f)){const w=Dl(f,m,y);if(w.result==="error")throw new Error(w.value.map((E=>`${E.key}: ${E.message}`)).join(", "));return w.value}{let w=f;return m.type==="color"&&typeof f=="string"?w=An.parse(f):m.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?m.type!=="numberArray"||typeof f!="number"&&!Array.isArray(f)?m.type!=="colorArray"||typeof f!="string"&&!Array.isArray(f)?m.type==="variableAnchorOffsetCollection"&&Array.isArray(f)?w=Ni.parse(f):m.type==="projectionDefinition"&&typeof f=="string"&&(w=mi.parse(f)):w=vn.parse(f):w=Di.parse(f):w=ir.parse(f),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>w}}})(n===void 0?e.specification.default:n,e.specification,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(e,n,l){return this.property.possiblyEvaluate(this,e,n,l)}}class eh{constructor(e,n){this.property=e,this.value=new yu(e,void 0,n)}transitioned(e,n){return new sc(this.property,this.value,n,Qe({},e.transition,this.transition),e.now)}untransitioned(){return new sc(this.property,this.value,null,{},0)}}class vu{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._globalState=n}getValue(e){return Re(this._values[e].value.value)}setValue(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new eh(this._values[e].property,this._globalState)),this._values[e].value=new yu(this._values[e].property,n===null?void 0:Re(n),this._globalState)}getTransition(e){return Re(this._values[e].transition)}setTransition(e,n){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new eh(this._values[e].property,this._globalState)),this._values[e].transition=Re(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l);const f=this.getTransition(n);f!==void 0&&(e[`${n}${jl}`]=f)}return e}transitioned(e,n){const l=new Zh(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].transitioned(e,n._values[f]);return l}untransitioned(){const e=new Zh(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class sc{constructor(e,n,l,f,m){this.property=e,this.value=n,this.begin=m+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=l)}possiblyEvaluate(e,n,l){const f=e.now||0,m=this.value.possiblyEvaluate(e,n,l),y=this.prior;if(y){if(f>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(f<this.begin)return y.possiblyEvaluate(e,n,l);{const w=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,n,l),m,Ot(w))}}return m}}class Zh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,l){const f=new xu(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].possiblyEvaluate(e,n,l);return f}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class zf{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._globalState=n}hasValue(e){return this._values[e].value!==void 0}getValue(e){return Re(this._values[e].value)}setValue(e,n){this._values[e]=new yu(this._values[e].property,n===null?void 0:Re(n),this._globalState)}serialize(){const e={};for(const n of Object.keys(this._values)){const l=this.getValue(n);l!==void 0&&(e[n]=l)}return e}possiblyEvaluate(e,n,l){const f=new xu(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].possiblyEvaluate(e,n,l);return f}}class Oa{constructor(e,n,l){this.property=e,this.value=n,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,l,f){return this.property.evaluate(this.value,this.parameters,e,n,l,f)}}class xu{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class on{constructor(e){this.specification=e}possiblyEvaluate(e,n){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(n)}interpolate(e,n,l){const f=Li[this.specification.type];return f?f(e,n,l):e}}class mn{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,l,f){return new Oa(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},l,f)}:e.expression,n)}interpolate(e,n,l){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Oa(this,{kind:"constant",value:void 0},e.parameters);const f=Li[this.specification.type];if(f){const m=f(e.value.value,n.value.value,l);return new Oa(this,{kind:"constant",value:m},e.parameters)}return e}evaluate(e,n,l,f,m,y){return e.kind==="constant"?e.value:e.evaluate(n,l,f,m,y)}}class Ul extends mn{possiblyEvaluate(e,n,l,f){if(e.value===void 0)return new Oa(this,{kind:"constant",value:void 0},n);if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},l,f),y=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,w=this._calculate(y,y,y,n);return new Oa(this,{kind:"constant",value:w},n)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:n.zoom-1}),e.expression.evaluate({zoom:n.zoom}),e.expression.evaluate({zoom:n.zoom+1}),n);return new Oa(this,{kind:"constant",value:m},n)}return new Oa(this,e.expression,n)}evaluate(e,n,l,f,m,y){if(e.kind==="source"){const w=e.evaluate(n,l,f,m,y);return this._calculate(w,w,w,n)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(n.zoom)-1},l,f),e.evaluate({zoom:Math.floor(n.zoom)},l,f),e.evaluate({zoom:Math.floor(n.zoom)+1},l,f),n):e.value}_calculate(e,n,l,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class Na{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,f){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(n,null,{},l,f);return this._calculate(m,m,m,n)}return this._calculate(e.expression.evaluate(new Hn(Math.floor(n.zoom-1),n)),e.expression.evaluate(new Hn(Math.floor(n.zoom),n)),e.expression.evaluate(new Hn(Math.floor(n.zoom+1),n)),n)}}_calculate(e,n,l,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:n}:{from:l,to:n}}interpolate(e){return e}}class ia{constructor(e){this.specification=e}possiblyEvaluate(e,n,l,f){return!!e.expression.evaluate(n,null,{},l,f)}interpolate(){return!1}}class fr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in e){const l=e[n];l.specification.overridable&&this.overridableProperties.push(n);const f=this.defaultPropertyValues[n]=new yu(l,void 0,void 0),m=this.defaultTransitionablePropertyValues[n]=new eh(l,void 0);this.defaultTransitioningPropertyValues[n]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=f.possiblyEvaluate({})}}}Xt("DataDrivenProperty",mn),Xt("DataConstantProperty",on),Xt("CrossFadedDataDrivenProperty",Ul),Xt("CrossFadedProperty",Na),Xt("ColorRampProperty",ia);class Ba extends Un{constructor(e,n,l){if(super(),this.id=e.id,this.type=e.type,this._globalState=l,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter,this._featureFilter=Xa(e.filter,l)),n.layout&&(this._unevaluatedLayout=new zf(n.layout,l)),n.paint)){this._transitionablePaint=new vu(n.paint,l);for(const f in e.paint)this.setPaintProperty(f,e.paint[f],{validate:!1});for(const f in e.layout)this.setLayoutProperty(f,e.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xu(n.paint)}}setFilter(e){this.filter=e,this._featureFilter=Xa(e,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}getLayoutAffectingGlobalStateRefs(){const e=new Set;if(this._unevaluatedLayout)for(const n in this._unevaluatedLayout._values){const l=this._unevaluatedLayout._values[n];for(const f of l.getGlobalStateRefs())e.add(f)}for(const n of this._featureFilter.getGlobalStateRefs())e.add(n);return e}getPaintAffectingGlobalStateRefs(){var e;const n=new globalThis.Map;if(this._transitionablePaint)for(const l in this._transitionablePaint._values){const f=this._transitionablePaint._values[l].value;for(const m of f.getGlobalStateRefs()){const y=(e=n.get(m))!==null&&e!==void 0?e:[];y.push({name:l,value:f.value}),n.set(m,y)}}return n}setLayoutProperty(e,n,l={}){n!=null&&this._validate(Qs,`layers.${this.id}.layout.${e}`,e,n,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return e.endsWith(jl)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,l={}){if(n!=null&&this._validate(Wa,`layers.${this.id}.paint.${e}`,e,n,l))return!1;if(e.endsWith(jl))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const f=this._transitionablePaint._values[e],m=f.property.specification["property-type"]==="cross-faded-data-driven",y=f.value.isDataDriven(),w=f.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const E=this._transitionablePaint._values[e].value;return E.isDataDriven()||y||m||this._handleOverridablePaintPropertyUpdate(e,w,E)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,n,l){return!1}isHidden(e,n=!1){return!!(this.minzoom&&e<(n?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),rn(e,((n,l)=>!(n===void 0||l==="layout"&&!Object.keys(n).length||l==="paint"&&!Object.keys(n).length)))}_validate(e,n,l,f,m={}){return(!m||m.validate!==!1)&&Xc(this,e.call(ic,{key:n,layerType:this.type,objectKey:l,value:f,styleSpec:it,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Oa&&Da(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}let Of;var Vl={get paint(){return Of=Of||new fr({"raster-opacity":new on(it.paint_raster["raster-opacity"]),"raster-hue-rotate":new on(it.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new on(it.paint_raster["raster-brightness-min"]),"raster-brightness-max":new on(it.paint_raster["raster-brightness-max"]),"raster-saturation":new on(it.paint_raster["raster-saturation"]),"raster-contrast":new on(it.paint_raster["raster-contrast"]),"raster-resampling":new on(it.paint_raster["raster-resampling"]),"raster-fade-duration":new on(it.paint_raster["raster-fade-duration"])})}};class Ka extends Ba{constructor(e,n){super(e,Vl,n)}}const dr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class sl{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class oi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function fn(i,e=1){let n=0,l=0;return{members:i.map((f=>{const m=dr[f.type].BYTES_PER_ELEMENT,y=n=Mi(n,Math.max(e,m)),w=f.components||1;return l=Math.max(l,m),n+=m*w,{name:f.name,type:f.type,components:w,offset:y}})),size:Mi(n,Math.max(l,e)),alignment:e}}function Mi(i,e){return Math.ceil(i/e)*e}class Qi extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const f=2*e;return this.int16[f+0]=n,this.int16[f+1]=l,e}}Qi.prototype.bytesPerElement=4,Xt("StructArrayLayout2i4",Qi);class bu extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l)}emplace(e,n,l,f){const m=3*e;return this.int16[m+0]=n,this.int16[m+1]=l,this.int16[m+2]=f,e}}bu.prototype.bytesPerElement=6,Xt("StructArrayLayout3i6",bu);class ys extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,f)}emplace(e,n,l,f,m){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=l,this.int16[y+2]=f,this.int16[y+3]=m,e}}ys.prototype.bytesPerElement=8,Xt("StructArrayLayout4i8",ys);class ol extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,f,m,y)}emplace(e,n,l,f,m,y,w){const E=6*e;return this.int16[E+0]=n,this.int16[E+1]=l,this.int16[E+2]=f,this.int16[E+3]=m,this.int16[E+4]=y,this.int16[E+5]=w,e}}ol.prototype.bytesPerElement=12,Xt("StructArrayLayout2i4i12",ol);class oc extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,f,m,y)}emplace(e,n,l,f,m,y,w){const E=4*e,R=8*e;return this.int16[E+0]=n,this.int16[E+1]=l,this.uint8[R+4]=f,this.uint8[R+5]=m,this.uint8[R+6]=y,this.uint8[R+7]=w,e}}oc.prototype.bytesPerElement=8,Xt("StructArrayLayout2i4ub8",oc);class ll extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const f=2*e;return this.float32[f+0]=n,this.float32[f+1]=l,e}}ll.prototype.bytesPerElement=8,Xt("StructArrayLayout2f8",ll);class ul extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y,w,E,R,N){const j=this.length;return this.resize(j+1),this.emplace(j,e,n,l,f,m,y,w,E,R,N)}emplace(e,n,l,f,m,y,w,E,R,N,j){const q=10*e;return this.uint16[q+0]=n,this.uint16[q+1]=l,this.uint16[q+2]=f,this.uint16[q+3]=m,this.uint16[q+4]=y,this.uint16[q+5]=w,this.uint16[q+6]=E,this.uint16[q+7]=R,this.uint16[q+8]=N,this.uint16[q+9]=j,e}}ul.prototype.bytesPerElement=20,Xt("StructArrayLayout10ui20",ul);class Nf extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y,w,E){const R=this.length;return this.resize(R+1),this.emplace(R,e,n,l,f,m,y,w,E)}emplace(e,n,l,f,m,y,w,E,R){const N=8*e;return this.uint16[N+0]=n,this.uint16[N+1]=l,this.uint16[N+2]=f,this.uint16[N+3]=m,this.uint16[N+4]=y,this.uint16[N+5]=w,this.uint16[N+6]=E,this.uint16[N+7]=R,e}}Nf.prototype.bytesPerElement=16,Xt("StructArrayLayout8ui16",Nf);class Ji extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y,w,E,R,N,j,q){const Z=this.length;return this.resize(Z+1),this.emplace(Z,e,n,l,f,m,y,w,E,R,N,j,q)}emplace(e,n,l,f,m,y,w,E,R,N,j,q,Z){const $=12*e;return this.int16[$+0]=n,this.int16[$+1]=l,this.int16[$+2]=f,this.int16[$+3]=m,this.uint16[$+4]=y,this.uint16[$+5]=w,this.uint16[$+6]=E,this.uint16[$+7]=R,this.int16[$+8]=N,this.int16[$+9]=j,this.int16[$+10]=q,this.int16[$+11]=Z,e}}Ji.prototype.bytesPerElement=24,Xt("StructArrayLayout4i4ui4i24",Ji);class eo extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l)}emplace(e,n,l,f){const m=3*e;return this.float32[m+0]=n,this.float32[m+1]=l,this.float32[m+2]=f,e}}eo.prototype.bytesPerElement=12,Xt("StructArrayLayout3f12",eo);class lc extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}lc.prototype.bytesPerElement=4,Xt("StructArrayLayout1ul4",lc);class uc extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y,w,E,R){const N=this.length;return this.resize(N+1),this.emplace(N,e,n,l,f,m,y,w,E,R)}emplace(e,n,l,f,m,y,w,E,R,N){const j=10*e,q=5*e;return this.int16[j+0]=n,this.int16[j+1]=l,this.int16[j+2]=f,this.int16[j+3]=m,this.int16[j+4]=y,this.int16[j+5]=w,this.uint32[q+3]=E,this.uint16[j+8]=R,this.uint16[j+9]=N,e}}uc.prototype.bytesPerElement=20,Xt("StructArrayLayout6i1ul2ui20",uc);class th extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,f,m,y)}emplace(e,n,l,f,m,y,w){const E=6*e;return this.int16[E+0]=n,this.int16[E+1]=l,this.int16[E+2]=f,this.int16[E+3]=m,this.int16[E+4]=y,this.int16[E+5]=w,e}}th.prototype.bytesPerElement=12,Xt("StructArrayLayout2i2i2i12",th);class nh extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,l,f,m)}emplace(e,n,l,f,m,y){const w=4*e,E=8*e;return this.float32[w+0]=n,this.float32[w+1]=l,this.float32[w+2]=f,this.int16[E+6]=m,this.int16[E+7]=y,e}}nh.prototype.bytesPerElement=16,Xt("StructArrayLayout2f1f2i16",nh);class ih extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,l,f,m,y)}emplace(e,n,l,f,m,y,w){const E=16*e,R=4*e,N=8*e;return this.uint8[E+0]=n,this.uint8[E+1]=l,this.float32[R+1]=f,this.float32[R+2]=m,this.int16[N+6]=y,this.int16[N+7]=w,e}}ih.prototype.bytesPerElement=16,Xt("StructArrayLayout2ub2f2i16",ih);class cl extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l)}emplace(e,n,l,f){const m=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=l,this.uint16[m+2]=f,e}}cl.prototype.bytesPerElement=6,Xt("StructArrayLayout3ui6",cl);class hl extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y,w,E,R,N,j,q,Z,$,Q,ee,se){const Te=this.length;return this.resize(Te+1),this.emplace(Te,e,n,l,f,m,y,w,E,R,N,j,q,Z,$,Q,ee,se)}emplace(e,n,l,f,m,y,w,E,R,N,j,q,Z,$,Q,ee,se,Te){const ue=24*e,pe=12*e,ke=48*e;return this.int16[ue+0]=n,this.int16[ue+1]=l,this.uint16[ue+2]=f,this.uint16[ue+3]=m,this.uint32[pe+2]=y,this.uint32[pe+3]=w,this.uint32[pe+4]=E,this.uint16[ue+10]=R,this.uint16[ue+11]=N,this.uint16[ue+12]=j,this.float32[pe+7]=q,this.float32[pe+8]=Z,this.uint8[ke+36]=$,this.uint8[ke+37]=Q,this.uint8[ke+38]=ee,this.uint32[pe+10]=se,this.int16[ue+22]=Te,e}}hl.prototype.bytesPerElement=48,Xt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",hl);class ma extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f,m,y,w,E,R,N,j,q,Z,$,Q,ee,se,Te,ue,pe,ke,ze,ot,Et,xt,Lt,Ht,zt){const Tt=this.length;return this.resize(Tt+1),this.emplace(Tt,e,n,l,f,m,y,w,E,R,N,j,q,Z,$,Q,ee,se,Te,ue,pe,ke,ze,ot,Et,xt,Lt,Ht,zt)}emplace(e,n,l,f,m,y,w,E,R,N,j,q,Z,$,Q,ee,se,Te,ue,pe,ke,ze,ot,Et,xt,Lt,Ht,zt,Tt){const mt=32*e,en=16*e;return this.int16[mt+0]=n,this.int16[mt+1]=l,this.int16[mt+2]=f,this.int16[mt+3]=m,this.int16[mt+4]=y,this.int16[mt+5]=w,this.int16[mt+6]=E,this.int16[mt+7]=R,this.uint16[mt+8]=N,this.uint16[mt+9]=j,this.uint16[mt+10]=q,this.uint16[mt+11]=Z,this.uint16[mt+12]=$,this.uint16[mt+13]=Q,this.uint16[mt+14]=ee,this.uint16[mt+15]=se,this.uint16[mt+16]=Te,this.uint16[mt+17]=ue,this.uint16[mt+18]=pe,this.uint16[mt+19]=ke,this.uint16[mt+20]=ze,this.uint16[mt+21]=ot,this.uint16[mt+22]=Et,this.uint32[en+12]=xt,this.float32[en+13]=Lt,this.float32[en+14]=Ht,this.uint16[mt+30]=zt,this.uint16[mt+31]=Tt,e}}ma.prototype.bytesPerElement=64,Xt("StructArrayLayout8i15ui1ul2f2ui64",ma);class Vi extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Vi.prototype.bytesPerElement=4,Xt("StructArrayLayout1f4",Vi);class zo extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l)}emplace(e,n,l,f){const m=3*e;return this.uint16[6*e+0]=n,this.float32[m+1]=l,this.float32[m+2]=f,e}}zo.prototype.bytesPerElement=12,Xt("StructArrayLayout1ui2f12",zo);class wu extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,l){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,l)}emplace(e,n,l,f){const m=4*e;return this.uint32[2*e+0]=n,this.uint16[m+2]=l,this.uint16[m+3]=f,e}}wu.prototype.bytesPerElement=8,Xt("StructArrayLayout1ul2ui8",wu);class cc extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const l=this.length;return this.resize(l+1),this.emplace(l,e,n)}emplace(e,n,l){const f=2*e;return this.uint16[f+0]=n,this.uint16[f+1]=l,e}}cc.prototype.bytesPerElement=4,Xt("StructArrayLayout2ui4",cc);class hc extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}hc.prototype.bytesPerElement=2,Xt("StructArrayLayout1ui2",hc);class to extends oi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,l,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,n,l,f)}emplace(e,n,l,f,m){const y=4*e;return this.float32[y+0]=n,this.float32[y+1]=l,this.float32[y+2]=f,this.float32[y+3]=m,e}}to.prototype.bytesPerElement=16,Xt("StructArrayLayout4f16",to);class v extends sl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new X(this.anchorPointX,this.anchorPointY)}}v.prototype.size=20;class t extends uc{get(e){return new v(this,e)}}Xt("CollisionBoxArray",t);class a extends sl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}a.prototype.size=48;class h extends hl{get(e){return new a(this,e)}}Xt("PlacedSymbolArray",h);class p extends sl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class b extends ma{get(e){return new p(this,e)}}Xt("SymbolInstanceArray",b);class T extends Vi{getoffsetX(e){return this.float32[1*e+0]}}Xt("GlyphOffsetArray",T);class k extends bu{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Xt("SymbolLineVertexArray",k);class z extends sl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}z.prototype.size=12;class F extends zo{get(e){return new z(this,e)}}Xt("TextAnchorOffsetArray",F);class V extends sl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}V.prototype.size=8;class H extends wu{get(e){return new V(this,e)}}Xt("FeatureIndexArray",H);class Y extends Qi{}class J extends Qi{}class ae extends Qi{}class ge extends ol{}class ve extends oc{}class ye extends ll{}class be extends ul{}class De extends Nf{}class we extends Ji{}class Oe extends eo{}class je extends lc{}class Ae extends th{}class $e extends ih{}class ht extends cl{}class st extends cc{}const ft=fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:pt}=ft;class Dt{constructor(e=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=e}prepareSegment(e,n,l,f){const m=this.segments[this.segments.length-1];return e>Dt.MAX_VERTEX_ARRAY_LENGTH&&Dn(`Max vertices per segment is ${Dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Dt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!m||m.vertexLength+e>Dt.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==f?this.createNewSegment(n,l,f):m}createNewSegment(e,n,l){const f={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0,vaos:{}};return l!==void 0&&(f.sortKey=l),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(f),f}getOrCreateLatestSegment(e,n,l){return this.prepareSegment(0,e,n,l)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,l,f){return new Dt([{vertexOffset:e,primitiveOffset:n,vertexLength:l,primitiveLength:f,vaos:{},sortKey:0}])}}function qt(i,e){return 256*(i=tn(Math.floor(i),0,255))+tn(Math.floor(e),0,255)}Dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xt("SegmentVector",Dt);const Pt=fn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),an=fn([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Cn,ai,Ci,li={exports:{}},Fi={exports:{}},_i={exports:{}},Mr=(function(){if(Ci)return li.exports;Ci=1;var i=(Cn||(Cn=1,Fi.exports=function(n,l){var f,m,y,w,E,R,N,j;for(m=n.length-(f=3&n.length),y=l,E=3432918353,R=461845907,j=0;j<m;)N=255&n.charCodeAt(j)|(255&n.charCodeAt(++j))<<8|(255&n.charCodeAt(++j))<<16|(255&n.charCodeAt(++j))<<24,++j,y=27492+(65535&(w=5*(65535&(y=(y^=N=(65535&(N=(N=(65535&N)*E+(((N>>>16)*E&65535)<<16)&4294967295)<<15|N>>>17))*R+(((N>>>16)*R&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(N=0,f){case 3:N^=(255&n.charCodeAt(j+2))<<16;case 2:N^=(255&n.charCodeAt(j+1))<<8;case 1:y^=N=(65535&(N=(N=(65535&(N^=255&n.charCodeAt(j)))*E+(((N>>>16)*E&65535)<<16)&4294967295)<<15|N>>>17))*R+(((N>>>16)*R&65535)<<16)&4294967295}return y^=n.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0}),Fi.exports),e=(ai||(ai=1,_i.exports=function(n,l){for(var f,m=n.length,y=l^m,w=0;m>=4;)f=1540483477*(65535&(f=255&n.charCodeAt(w)|(255&n.charCodeAt(++w))<<8|(255&n.charCodeAt(++w))<<16|(255&n.charCodeAt(++w))<<24))+((1540483477*(f>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),m-=4,++w;switch(m){case 3:y^=(255&n.charCodeAt(w+2))<<16;case 2:y^=(255&n.charCodeAt(w+1))<<8;case 1:y=1540483477*(65535&(y^=255&n.charCodeAt(w)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0}),_i.exports);return li.exports=i,li.exports.murmur3=i,li.exports.murmur2=e,li.exports})(),zi=ne(Mr);class Cr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,l,f){this.ids.push(er(e)),this.positions.push(n,l,f)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=er(e);let l=0,f=this.ids.length-1;for(;l<f;){const y=l+f>>1;this.ids[y]>=n?f=y:l=y+1}const m=[];for(;this.ids[l]===n;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(e,n){const l=new Float64Array(e.ids),f=new Uint32Array(e.positions);return ar(l,f,0,l.length-1),n&&n.push(l.buffer,f.buffer),{ids:l,positions:f}}static deserialize(e){const n=new Cr;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function er(i){const e=+i;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:zi(String(i))}function ar(i,e,n,l){for(;n<l;){const f=i[n+l>>1];let m=n-1,y=l+1;for(;;){do m++;while(i[m]<f);do y--;while(i[y]>f);if(m>=y)break;ra(i,m,y),ra(e,3*m,3*y),ra(e,3*m+1,3*y+1),ra(e,3*m+2,3*y+2)}y-n<l-y?(ar(i,e,n,y),n=y+1):(ar(i,e,y+1,l),l=y)}}function ra(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}Xt("FeaturePositionMap",Cr);class ga{constructor(e,n){this.gl=e.gl,this.location=n}}class no extends ga{constructor(e,n){super(e,n),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class fl extends ga{constructor(e,n){super(e,n),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Tu extends ga{constructor(e,n){super(e,n),this.current=An.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const Yh=new Float32Array(16);function Su(i){return[qt(255*i.r,255*i.g),qt(255*i.b,255*i.a)]}class Qa{constructor(e,n,l){this.value=e,this.uniformNames=n.map((f=>`u_${f}`)),this.type=l}setUniform(e,n,l){e.set(l.constantOr(this.value))}getBinding(e,n,l){return this.type==="color"?new Tu(e,n):new no(e,n)}}class Ir{constructor(e,n){this.uniformNames=n.map((l=>`u_${l}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=e.tlbr}setConstantDashPositions(e,n){this.dashTo=[0,e.y,e.height,e.width],this.dashFrom=[0,n.y,n.height,n.width]}setUniform(e,n,l,f){let m=null;f==="u_pattern_to"?m=this.patternTo:f==="u_pattern_from"?m=this.patternFrom:f==="u_dasharray_to"?m=this.dashTo:f==="u_dasharray_from"?m=this.dashFrom:f==="u_pixel_ratio_to"?m=this.pixelRatioTo:f==="u_pixel_ratio_from"&&(m=this.pixelRatioFrom),m!==null&&e.set(m)}getBinding(e,n,l){return l.substr(0,9)==="u_pattern"||l.substr(0,12)==="u_dasharray_"?new fl(e,n):new no(e,n)}}class Gr{constructor(e,n,l,f){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=n.map((m=>({name:`a_${m}`,type:"Float32",components:l==="color"?2:1,offset:0}))),this.paintVertexArray=new f}populatePaintArray(e,n,l){const f=this.paintVertexArray.length,m=this.expression.evaluate(new Hn(0,l),n,{},l.canonical,[],l.formattedSection);this.paintVertexArray.resize(e),this._setPaintValue(f,e,m)}updatePaintArray(e,n,l,f,m){const y=this.expression.evaluate(new Hn(0,m),l,f);this._setPaintValue(e,n,y)}_setPaintValue(e,n,l){if(this.type==="color"){const f=Su(l);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,f[0],f[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class aa{constructor(e,n,l,f,m,y){this.expression=e,this.uniformNames=n.map((w=>`u_${w}_t`)),this.type=l,this.useIntegerZoom=f,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=n.map((w=>({name:`a_${w}`,type:"Float32",components:l==="color"?4:2,offset:0}))),this.paintVertexArray=new y}populatePaintArray(e,n,l){const f=this.expression.evaluate(new Hn(this.zoom,l),n,{},l.canonical,[],l.formattedSection),m=this.expression.evaluate(new Hn(this.zoom+1,l),n,{},l.canonical,[],l.formattedSection),y=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(y,e,f,m)}updatePaintArray(e,n,l,f,m){const y=this.expression.evaluate(new Hn(this.zoom,m),l,f),w=this.expression.evaluate(new Hn(this.zoom+1,m),l,f);this._setPaintValue(e,n,y,w)}_setPaintValue(e,n,l,f){if(this.type==="color"){const m=Su(l),y=Su(f);for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,m[0],m[1],y[0],y[1])}else{for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,l,f);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(f))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n){const l=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,f=tn(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);e.set(f)}getBinding(e,n,l){return new no(e,n)}}class vs{constructor(e,n,l,f,m,y){this.expression=e,this.type=n,this.useIntegerZoom=l,this.zoom=f,this.layerId=y,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,n,l){const f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,this.getPositionIds(n),l)}updatePaintArray(e,n,l,f,m){this._setPaintValues(e,n,this.getPositionIds(l),m)}_setPaintValues(e,n,l,f){const m=this.getPositions(f);if(!m||!l)return;const y=m[l.min],w=m[l.mid],E=m[l.max];if(y&&w&&E)for(let R=e;R<n;R++)this.emplace(this.zoomInPaintVertexArray,R,w,y),this.emplace(this.zoomOutPaintVertexArray,R,w,E)}upload(e){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const n=this.getVertexAttributes();this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,n,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,n,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class tr extends vs{getPositions(e){return e.imagePositions}getPositionIds(e){return e.patterns&&e.patterns[this.layerId]}getVertexAttributes(){return Pt.members}emplace(e,n,l,f){e.emplace(n,l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],f.tlbr[0],f.tlbr[1],f.tlbr[2],f.tlbr[3],l.pixelRatio,f.pixelRatio)}}class Ar extends vs{getPositions(e){return e.dashPositions}getPositionIds(e){return e.dashes&&e.dashes[this.layerId]}getVertexAttributes(){return an.members}emplace(e,n,l,f){e.emplace(n,0,l.y,l.height,l.width,0,f.y,f.height,f.width)}}class Fa{constructor(e,n,l){this.binders={},this._buffers=[];const f=[];for(const m in e.paint._values){if(!l(m))continue;const y=e.paint.get(m);if(!(y instanceof Oa&&Da(y.property.specification)))continue;const w=Bf(m,e.type),E=y.value,R=y.property.specification.type,N=y.property.useIntegerZoom,j=y.property.specification["property-type"],q=j==="cross-faded"||j==="cross-faded-data-driven";if(E.kind==="constant")this.binders[m]=q?new Ir(E.value,w):new Qa(E.value,w,R),f.push(`/u_${m}`);else if(E.kind==="source"||q){const Z=Hh(m,R,"source");this.binders[m]=q?m==="line-dasharray"?new Ar(E,R,N,n,Z,e.id):new tr(E,R,N,n,Z,e.id):new Gr(E,w,R,Z),f.push(`/a_${m}`)}else{const Z=Hh(m,R,"composite");this.binders[m]=new aa(E,w,R,N,n,Z),f.push(`/z_${m}`)}}this.cacheKey=f.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Gr||n instanceof aa?n.maxValue:0}populatePaintArrays(e,n,l){for(const f in this.binders){const m=this.binders[f];(m instanceof Gr||m instanceof aa||m instanceof vs)&&m.populatePaintArray(e,n,l)}}setConstantPatternPositions(e,n){for(const l in this.binders){const f=this.binders[l];f instanceof Ir&&f.setConstantPatternPositions(e,n)}}setConstantDashPositions(e,n){for(const l in this.binders){const f=this.binders[l];f instanceof Ir&&f.setConstantDashPositions(e,n)}}updatePaintArrays(e,n,l,f,m){let y=!1;for(const w in e){const E=n.getPositions(w);for(const R of E){const N=l.feature(R.index);for(const j in this.binders){const q=this.binders[j];if((q instanceof Gr||q instanceof aa||q instanceof vs)&&q.expression.isStateDependent===!0){const Z=f.paint.get(j);q.expression=Z.value,q.updatePaintArray(R.start,R.end,N,e[w],m),y=!0}}}}return y}defines(){const e=[];for(const n in this.binders){const l=this.binders[n];(l instanceof Qa||l instanceof Ir)&&e.push(...l.uniformNames.map((f=>`#define HAS_UNIFORM_${f}`)))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Gr||l instanceof aa)for(let f=0;f<l.paintVertexAttributes.length;f++)e.push(l.paintVertexAttributes[f].name);else if(l instanceof vs){const f=l.getVertexAttributes();for(const m of f)e.push(m.name)}}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const l=this.binders[n];if(l instanceof Qa||l instanceof Ir||l instanceof aa)for(const f of l.uniformNames)e.push(f)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,n){const l=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Qa||m instanceof Ir||m instanceof aa){for(const y of m.uniformNames)if(n[y]){const w=m.getBinding(e,n[y],y);l.push({name:y,property:f,binding:w})}}}return l}setUniforms(e,n,l,f){for(const{name:m,property:y,binding:w}of n)this.binders[y].setUniform(w,f,l.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const n in this.binders){const l=this.binders[n];if(e&&l instanceof vs){const f=e.fromScale===2?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(l instanceof Gr||l instanceof aa)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(e){for(const n in this.binders){const l=this.binders[n];(l instanceof Gr||l instanceof aa||l instanceof vs)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Gr||n instanceof aa||n instanceof vs)&&n.destroy()}}}class Gi{constructor(e,n,l=()=>!0){this.programConfigurations={};for(const f of e)this.programConfigurations[f.id]=new Fa(f,n,l);this.needsUpload=!1,this._featureMap=new Cr,this._bufferOffset=0}populatePaintArrays(e,n,l,f){for(const m in this.programConfigurations)this.programConfigurations[m].populatePaintArrays(e,n,f);n.id!==void 0&&this._featureMap.add(n.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,l,f){for(const m of l)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,n,m,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function Bf(i,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${e}-`,"").replace(/-/g,"_")]}function Hh(i,e,n){const l={color:{source:ll,composite:to},number:{source:Vi,composite:ll}},f=(function(m){return{"line-pattern":{source:be,composite:be},"fill-pattern":{source:be,composite:be},"fill-extrusion-pattern":{source:be,composite:be},"line-dasharray":{source:De,composite:De}}[m]})(i);return f&&f[n]||l[e][n]}Xt("ConstantBinder",Qa),Xt("CrossFadedConstantBinder",Ir),Xt("SourceExpressionBinder",Gr),Xt("CrossFadedPatternBinder",tr),Xt("CrossFadedDasharrayBinder",Ar),Xt("CompositeExpressionBinder",aa),Xt("ProgramConfiguration",Fa,{omit:["_buffers"]}),Xt("ProgramConfigurationSet",Gi);const Xh=Math.pow(2,14)-1,Ff=-Xh-1;function xs(i){const e=tt/i.extent,n=i.loadGeometry();for(let l=0;l<n.length;l++){const f=n[l];for(let m=0;m<f.length;m++){const y=f[m],w=Math.round(y.x*e),E=Math.round(y.y*e);y.x=tn(w,Ff,Xh),y.y=tn(E,Ff,Xh),(w<y.x||w>y.x+1||E<y.y||E>y.y+1)&&Dn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Gl(i,e){return{type:i.type,id:i.id,properties:i.properties,geometry:e?xs(i):[]}}const dl=-32768;function jf(i,e,n,l,f){i.emplaceBack(dl+8*e+l,dl+8*n+f)}class Eu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new J,this.indexArray=new ht,this.segments=new Dt,this.programConfigurations=new Gi(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){const f=this.layers[0],m=[];let y=null,w=!1,E=f.type==="heatmap";if(f.type==="circle"){const N=f;y=N.layout.get("circle-sort-key"),w=!y.isConstant(),E=E||N.paint.get("circle-pitch-alignment")==="map"}const R=E?n.subdivisionGranularity.circle:1;for(const{feature:N,id:j,index:q,sourceLayerIndex:Z}of e){const $=this.layers[0]._featureFilter.needGeometry,Q=Gl(N,$);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),Q,l))continue;const ee=w?y.evaluate(Q,{},l):void 0,se={id:j,properties:N.properties,type:N.type,sourceLayerIndex:Z,index:q,geometry:$?Q.geometry:xs(N),patterns:{},sortKey:ee};m.push(se)}w&&m.sort(((N,j)=>N.sortKey-j.sortKey));for(const N of m){const{geometry:j,index:q,sourceLayerIndex:Z}=N,$=e[q].feature;this.addFeature(N,j,q,l,R),n.featureIndex.insert($,j,q,Z,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,pt),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,l,f,m=1){let y;switch(m){case 1:y=[0,7];break;case 3:y=[0,2,5,7];break;case 5:y=[0,1,3,4,6,7];break;case 7:y=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${m}; valid values are 1, 3, 5, 7.`)}const w=y.length;for(const E of n)for(const R of E){const N=R.x,j=R.y;if(N<0||N>=tt||j<0||j>=tt)continue;const q=this.segments.prepareSegment(w*w,this.layoutVertexArray,this.indexArray,e.sortKey),Z=q.vertexLength;for(let $=0;$<w;$++)for(let Q=0;Q<w;Q++)jf(this.layoutVertexArray,N,j,y[Q],y[$]);for(let $=0;$<w-1;$++)for(let Q=0;Q<w-1;Q++){const ee=Z+$*w+Q,se=Z+($+1)*w+Q;this.indexArray.emplaceBack(ee,se+1,ee+1),this.indexArray.emplaceBack(ee,se,se+1)}q.vertexLength+=w*w,q.primitiveLength+=(w-1)*(w-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:{},canonical:f})}}function $h(i,e){for(let n=0;n<i.length;n++)if(rh(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(rh(i,e[n]))return!0;return!!Rp(i,e)}function ql(i,e,n){return!!rh(i,e)||!!kr(e,i,n)}function Wh(i,e){if(i.length===1)return Lp(e,i[0]);for(let n=0;n<e.length;n++){const l=e[n];for(let f=0;f<l.length;f++)if(rh(i,l[f]))return!0}for(let n=0;n<i.length;n++)if(Lp(e,i[n]))return!0;for(let n=0;n<e.length;n++)if(Rp(i,e[n]))return!0;return!1}function Kh(i,e,n){if(i.length>1){if(Rp(i,e))return!0;for(let l=0;l<e.length;l++)if(kr(e[l],i,n))return!0}for(let l=0;l<i.length;l++)if(kr(i[l],e,n))return!0;return!1}function Rp(i,e){if(i.length===0||e.length===0)return!1;for(let n=0;n<i.length-1;n++){const l=i[n],f=i[n+1];for(let m=0;m<e.length-1;m++)if(Dp(l,f,e[m],e[m+1]))return!0}return!1}function Dp(i,e,n,l){return Pn(i,n,l)!==Pn(e,n,l)&&Pn(i,e,n)!==Pn(i,e,l)}function kr(i,e,n){const l=n*n;if(e.length===1)return i.distSqr(e[0])<l;for(let f=1;f<e.length;f++)if(Sa(i,e[f-1],e[f])<l)return!0;return!1}function Sa(i,e,n){const l=e.distSqr(n);if(l===0)return i.distSqr(e);const f=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/l;return i.distSqr(f<0?e:f>1?n:n.sub(e)._mult(f)._add(e))}function Lp(i,e){let n,l,f,m=!1;for(let y=0;y<i.length;y++){n=i[y];for(let w=0,E=n.length-1;w<n.length;E=w++)l=n[w],f=n[E],l.y>e.y!=f.y>e.y&&e.x<(f.x-l.x)*(e.y-l.y)/(f.y-l.y)+l.x&&(m=!m)}return m}function rh(i,e){let n=!1;for(let l=0,f=i.length-1;l<i.length;f=l++){const m=i[l],y=i[f];m.y>e.y!=y.y>e.y&&e.x<(y.x-m.x)*(e.y-m.y)/(y.y-m.y)+m.x&&(n=!n)}return n}function Km(i,e,n){const l=n[0],f=n[2];if(i.x<l.x&&e.x<l.x||i.x>f.x&&e.x>f.x||i.y<l.y&&e.y<l.y||i.y>f.y&&e.y>f.y)return!1;const m=Pn(i,e,n[0]);return m!==Pn(i,e,n[1])||m!==Pn(i,e,n[2])||m!==Pn(i,e,n[3])}function ah(i,e,n){const l=e.paint.get(i).value;return l.kind==="constant"?l.value:n.programConfigurations.get(e.id).getMaxValue(i)}function fc(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Uf(i,e,n,l,f){if(!e[0]&&!e[1])return i;const m=X.convert(e)._mult(f);n==="viewport"&&m._rotate(-l);const y=[];for(let w=0;w<i.length;w++)y.push(i[w].sub(m));return y}function Dd(i){const e=[];for(let n=0;n<i.length;n++){const l=i[n],f=e.at(-1);(n===0||f&&!l.equals(f))&&e.push(l)}return e}function Qm({queryGeometry:i,size:e},n){return ql(i,n,e)}function w_({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:f},m){return ql(i,m,e*(n.projectTileCoordinates(m.x,m.y,l,f).signedDistanceFromCamera/n.cameraToCenterDistance))}function Ld({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:f},m){const y=n.projectTileCoordinates(m.x,m.y,l,f).signedDistanceFromCamera,w=e*(n.cameraToCenterDistance/y);return ql(i,zd(m,n,l,f),w)}function zp({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:f},m){return ql(i,zd(m,n,l,f),e)}function Op({queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:f,pitchAlignment:m="map",pitchScale:y="map"},w){const E=m==="map"?y==="map"?Qm:w_:y==="map"?Ld:zp,R={queryGeometry:i,size:e,transform:n,unwrappedTileID:l,getElevation:f};for(const N of w)for(const j of N)if(E(R,j))return!0;return!1}function zd(i,e,n,l){const f=e.projectTileCoordinates(i.x,i.y,n,l).point;return new X((.5*f.x+.5)*e.width,(.5*-f.y+.5)*e.height)}let Np,Od;Xt("CircleBucket",Eu,{omit:["layers"]});var Bp={get paint(){return Od=Od||new fr({"circle-radius":new mn(it.paint_circle["circle-radius"]),"circle-color":new mn(it.paint_circle["circle-color"]),"circle-blur":new mn(it.paint_circle["circle-blur"]),"circle-opacity":new mn(it.paint_circle["circle-opacity"]),"circle-translate":new on(it.paint_circle["circle-translate"]),"circle-translate-anchor":new on(it.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new on(it.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new on(it.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mn(it.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mn(it.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mn(it.paint_circle["circle-stroke-opacity"])})},get layout(){return Np=Np||new fr({"circle-sort-key":new mn(it.layout_circle["circle-sort-key"])})}};class Fp extends Ba{constructor(e,n){super(e,Bp,n)}createBucket(e){return new Eu(e)}queryRadius(e){const n=e;return ah("circle-radius",this,n)+ah("circle-stroke-width",this,n)+fc(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:f,transform:m,pixelsToTileUnits:y,unwrappedTileID:w,getElevation:E}){const R=Uf(e,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-m.bearingInRadians,y),N=this.paint.get("circle-radius").evaluate(n,l)+this.paint.get("circle-stroke-width").evaluate(n,l),j=this.paint.get("circle-pitch-scale"),q=this.paint.get("circle-pitch-alignment");let Z,$;return q==="map"?(Z=R,$=N*y):(Z=(function(Q,ee,se,Te){return Q.map((ue=>zd(ue,ee,se,Te)))})(R,m,w,E),$=N),Op({queryGeometry:Z,size:$,transform:m,unwrappedTileID:w,getElevation:E,pitchAlignment:q,pitchScale:j},f)}}class jp extends Eu{}let Nd;Xt("HeatmapBucket",jp,{omit:["layers"]});var Bd={get paint(){return Nd=Nd||new fr({"heatmap-radius":new mn(it.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mn(it.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new on(it.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ia(it.paint_heatmap["heatmap-color"]),"heatmap-opacity":new on(it.paint_heatmap["heatmap-opacity"])})}};function Vf(i,{width:e,height:n},l,f){if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==e*n*l)throw new RangeError(`mismatched image size. expected: ${f.length} but got: ${e*n*l}`)}else f=new Uint8Array(e*n*l);return i.width=e,i.height=n,i.data=f,i}function Up(i,{width:e,height:n},l){if(e===i.width&&n===i.height)return;const f=Vf({},{width:e,height:n},l);Gf(i,f,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,e),height:Math.min(i.height,n)},l),i.width=e,i.height=n,i.data=f.data}function Gf(i,e,n,l,f,m){if(f.width===0||f.height===0)return e;if(f.width>i.width||f.height>i.height||n.x>i.width-f.width||n.y>i.height-f.height)throw new RangeError("out of range source coordinates for image copy");if(f.width>e.width||f.height>e.height||l.x>e.width-f.width||l.y>e.height-f.height)throw new RangeError("out of range destination coordinates for image copy");const y=i.data,w=e.data;if(y===w)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<f.height;E++){const R=((n.y+E)*i.width+n.x)*m,N=((l.y+E)*e.width+l.x)*m;for(let j=0;j<f.width*m;j++)w[N+j]=y[R+j]}return e}class Qh{constructor(e,n){Vf(this,e,1,n)}resize(e){Up(this,e,1)}clone(){return new Qh({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,f,m){Gf(e,n,l,f,m,1)}}class br{constructor(e,n){Vf(this,e,4,n)}resize(e){Up(this,e,4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new br({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,l,f,m){Gf(e,n,l,f,m,4)}setPixel(e,n,l){const f=4*(e*this.width+n);this.data[f+0]=Math.round(255*l.r/l.a),this.data[f+1]=Math.round(255*l.g/l.a),this.data[f+2]=Math.round(255*l.b/l.a),this.data[f+3]=Math.round(255*l.a)}}function Fd(i){const e={},n=i.resolution||256,l=i.clips?i.clips.length:1,f=i.image||new br({width:n,height:l});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const m=(y,w,E)=>{e[i.evaluationKey]=E;const R=i.expression.evaluate(e);f.setPixel(y/4/n,w/4,R)};if(i.clips)for(let y=0,w=0;y<l;++y,w+=4*n)for(let E=0,R=0;E<n;E++,R+=4){const N=E/(n-1),{start:j,end:q}=i.clips[y];m(w,R,j*(1-N)+q*N)}else for(let y=0,w=0;y<n;y++,w+=4)m(0,w,y/(n-1));return f}Xt("AlphaImage",Qh),Xt("RGBAImage",br);const Vp="big-fb";class Jm extends Ba{createBucket(e){return new jp(e)}constructor(e,n){super(e,Bd,n),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Fd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Vp)&&this.heatmapFbos.delete(Vp)}queryRadius(e){return ah("heatmap-radius",this,e)}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:f,transform:m,pixelsToTileUnits:y,unwrappedTileID:w,getElevation:E}){return Op({queryGeometry:e,size:this.paint.get("heatmap-radius").evaluate(n,l)*y,transform:m,unwrappedTileID:w,getElevation:E},f)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Zl;var Gp={get paint(){return Zl=Zl||new fr({"hillshade-illumination-direction":new on(it.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new on(it.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new on(it.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new on(it.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new on(it.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new on(it.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new on(it.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new on(it.paint_hillshade["hillshade-method"])})}};class eg extends Ba{constructor(e,n){super(e,Gp,n),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let e=this.paint.get("hillshade-illumination-direction").values,n=this.paint.get("hillshade-illumination-altitude").values,l=this.paint.get("hillshade-highlight-color").values,f=this.paint.get("hillshade-shadow-color").values;const m=Math.max(e.length,n.length,l.length,f.length);e=e.concat(Array(m-e.length).fill(e.at(-1))),n=n.concat(Array(m-n.length).fill(n.at(-1))),l=l.concat(Array(m-l.length).fill(l.at(-1))),f=f.concat(Array(m-f.length).fill(f.at(-1)));const y=n.map(dn);return{directionRadians:e.map(dn),altitudeRadians:y,shadowColor:f,highlightColor:l}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let qf;var Zf={get paint(){return qf=qf||new fr({"color-relief-opacity":new on(it["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new ia(it["paint_color-relief"]["color-relief-color"])})}};class qi{constructor(e,n,l,f){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(n,f)}update(e,n,l){const{width:f,height:m}=e,y=!(this.size&&this.size[0]===f&&this.size[1]===m||l),{context:w}=this,{gl:E}=w;if(this.useMipmap=!!(n&&n.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!n||n.premultiply!==!1)),y)this.size=[f,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Gs(e)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,e):E.texImage2D(E.TEXTURE_2D,0,this.format,f,m,0,this.format,E.UNSIGNED_BYTE,e.data);else{const{x:R,y:N}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||Gs(e)?E.texSubImage2D(E.TEXTURE_2D,0,R,N,E.RGBA,E.UNSIGNED_BYTE,e):E.texSubImage2D(E.TEXTURE_2D,0,R,N,f,m,E.RGBA,E.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D),w.pixelStoreUnpackFlipY.setDefault(),w.pixelStoreUnpack.setDefault(),w.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(e,n,l){const{context:f}=this,{gl:m}=f;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||e),this.filter=e),n!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,n),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class tg{constructor(e,n,l,f=1,m=1,y=1,w=0){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(l&&!["mapbox","terrarium","custom"].includes(l))return void Dn(`"${l}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const E=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),l){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=f,this.greenFactor=m,this.blueFactor=y,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let R=0;R<E;R++)this.data[this._idx(-1,R)]=this.data[this._idx(0,R)],this.data[this._idx(E,R)]=this.data[this._idx(E-1,R)],this.data[this._idx(R,-1)]=this.data[this._idx(R,0)],this.data[this._idx(R,E)]=this.data[this._idx(R,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let R=0;R<E;R++)for(let N=0;N<E;N++){const j=this.get(R,N);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(e,n){const l=new Uint8Array(this.data.buffer),f=4*this._idx(e,n);return this.unpack(l[f],l[f+1],l[f+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}unpack(e,n,l){return e*this.redFactor+n*this.greenFactor+l*this.blueFactor-this.baseShift}pack(e){return ng(e,this.getUnpackVector())}getPixels(){return new br({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,n,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let f=n*this.dim,m=n*this.dim+this.dim,y=l*this.dim,w=l*this.dim+this.dim;switch(n){case-1:f=m-1;break;case 1:m=f+1}switch(l){case-1:y=w-1;break;case 1:w=y+1}const E=-n*this.dim,R=-l*this.dim;for(let N=y;N<w;N++)for(let j=f;j<m;j++)this.data[this._idx(j,N)]=e.data[this._idx(j+E,N+R)]}}function ng(i,e){const n=e[0],l=e[1],f=e[2],m=e[3],y=Math.min(n,l,f),w=Math.round((i+m)/y);return{r:Math.floor(w*y/n)%256,g:Math.floor(w*y/l)%256,b:Math.floor(w*y/f)%256}}Xt("DEMData",tg);class ig extends Ba{constructor(e,n){super(e,Zf,n)}_createColorRamp(e){const n={elevationStops:[],colorStops:[]},l=this._transitionablePaint._values["color-relief-color"].value.expression;if(l instanceof La&&l._styleExpression.expression instanceof fa){this.colorRampExpression=l;const y=l._styleExpression.expression;n.elevationStops=y.labels,n.colorStops=[];for(const w of n.elevationStops)n.colorStops.push(y.evaluate({globals:{elevation:w}}))}if(n.elevationStops.length<1&&(n.elevationStops=[0],n.colorStops=[An.transparent]),n.elevationStops.length<2&&(n.elevationStops.push(n.elevationStops[0]+1),n.colorStops.push(n.colorStops[0])),n.elevationStops.length<=e)return n;const f={elevationStops:[],colorStops:[]},m=(n.elevationStops.length-1)/(e-1);for(let y=0;y<n.elevationStops.length-.5;y+=m)f.elevationStops.push(n.elevationStops[Math.round(y)]),f.colorStops.push(n.colorStops[Math.round(y)]);return Dn(`Too many colors in specification of ${this.id} color-relief layer, may not render properly. Max possible colors: ${e}, provided: ${n.elevationStops.length}`),f}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(e,n,l){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const f=this._createColorRamp(n),m=new br({width:f.colorStops.length,height:1}),y=new br({width:f.colorStops.length,height:1});for(let w=0;w<f.elevationStops.length;w++){const E=ng(f.elevationStops[w],l);y.setPixel(0,w,new An(E.r/255,E.g/255,E.b/255,1)),m.setPixel(0,w,f.colorStops[w])}return this.colorRampTextures={elevationTexture:new qi(e,y,e.gl.RGBA),colorTexture:new qi(e,m,e.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Yf=fn([{name:"a_pos",components:2,type:"Int16"}],4),{members:dc}=Yf;function Hf(i,e,n){const l=n.patternDependencies;let f=!1;for(const m of e){const y=m.paint.get(`${i}-pattern`);y.isConstant()||(f=!0);const w=y.constantOr(null);w&&(f=!0,l[w.to]=!0,l[w.from]=!0)}return f}function jd(i,e,n,l,f){const{zoom:m}=l,y=f.patternDependencies;for(const w of e){const E=w.paint.get(`${i}-pattern`).value;if(E.kind!=="constant"){let R=E.evaluate({zoom:m-1},n,{},f.availableImages),N=E.evaluate({zoom:m},n,{},f.availableImages),j=E.evaluate({zoom:m+1},n,{},f.availableImages);R=R&&R.name?R.name:R,N=N&&N.name?N.name:N,j=j&&j.name?j.name:j,y[R]=!0,y[N]=!0,y[j]=!0,n.patterns[w.id]={min:R,mid:N,max:j}}}return n}function Jh(i,e,n,l,f){let m;if(f===(function(y,w,E,R){let N=0;for(let j=w,q=E-R;j<E;j+=R)N+=(y[q]-y[j])*(y[j+1]+y[q+1]),q=j;return N})(i,e,n,l)>0)for(let y=e;y<n;y+=l)m=Wp(y/l|0,i[y],i[y+1],m);else for(let y=n-l;y>=e;y-=l)m=Wp(y/l|0,i[y],i[y+1],m);return m&&sh(m,m.next)&&(Xf(m),m=m.next),m}function Ja(i,e){if(!i)return i;e||(e=i);let n,l=i;do if(n=!1,l.steiner||!sh(l,l.next)&&pr(l.prev,l,l.next)!==0)l=l.next;else{if(Xf(l),l=e=l.prev,l===l.next)break;n=!0}while(n||l!==e);return e}function ef(i,e,n,l,f,m,y){if(!i)return;!y&&m&&(function(E,R,N,j){let q=E;do q.z===0&&(q.z=Pr(q.x,q.y,R,N,j)),q.prevZ=q.prev,q.nextZ=q.next,q=q.next;while(q!==E);q.prevZ.nextZ=null,q.prevZ=null,(function(Z){let $,Q=1;do{let ee,se=Z;Z=null;let Te=null;for($=0;se;){$++;let ue=se,pe=0;for(let ze=0;ze<Q&&(pe++,ue=ue.nextZ,ue);ze++);let ke=Q;for(;pe>0||ke>0&&ue;)pe!==0&&(ke===0||!ue||se.z<=ue.z)?(ee=se,se=se.nextZ,pe--):(ee=ue,ue=ue.nextZ,ke--),Te?Te.nextZ=ee:Z=ee,ee.prevZ=Te,Te=ee;se=ue}Te.nextZ=null,Q*=2}while($>1)})(q)})(i,l,f,m);let w=i;for(;i.prev!==i.next;){const E=i.prev,R=i.next;if(m?rg(i,l,f,m):qp(i))e.push(E.i,i.i,R.i),Xf(i),i=R.next,w=R.next;else if((i=R)===w){y?y===1?ef(i=Zp(Ja(i),e),e,n,l,f,m,2):y===2&&Yp(i,e,n,l,f,m):ef(Ja(i),e,n,l,f,m,1);break}}}function qp(i){const e=i.prev,n=i,l=i.next;if(pr(e,n,l)>=0)return!1;const f=e.x,m=n.x,y=l.x,w=e.y,E=n.y,R=l.y,N=Math.min(f,m,y),j=Math.min(w,E,R),q=Math.max(f,m,y),Z=Math.max(w,E,R);let $=l.next;for(;$!==e;){if($.x>=N&&$.x<=q&&$.y>=j&&$.y<=Z&&Rr(f,w,m,E,y,R,$.x,$.y)&&pr($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function rg(i,e,n,l){const f=i.prev,m=i,y=i.next;if(pr(f,m,y)>=0)return!1;const w=f.x,E=m.x,R=y.x,N=f.y,j=m.y,q=y.y,Z=Math.min(w,E,R),$=Math.min(N,j,q),Q=Math.max(w,E,R),ee=Math.max(N,j,q),se=Pr(Z,$,e,n,l),Te=Pr(Q,ee,e,n,l);let ue=i.prevZ,pe=i.nextZ;for(;ue&&ue.z>=se&&pe&&pe.z<=Te;){if(ue.x>=Z&&ue.x<=Q&&ue.y>=$&&ue.y<=ee&&ue!==f&&ue!==y&&Rr(w,N,E,j,R,q,ue.x,ue.y)&&pr(ue.prev,ue,ue.next)>=0||(ue=ue.prevZ,pe.x>=Z&&pe.x<=Q&&pe.y>=$&&pe.y<=ee&&pe!==f&&pe!==y&&Rr(w,N,E,j,R,q,pe.x,pe.y)&&pr(pe.prev,pe,pe.next)>=0))return!1;pe=pe.nextZ}for(;ue&&ue.z>=se;){if(ue.x>=Z&&ue.x<=Q&&ue.y>=$&&ue.y<=ee&&ue!==f&&ue!==y&&Rr(w,N,E,j,R,q,ue.x,ue.y)&&pr(ue.prev,ue,ue.next)>=0)return!1;ue=ue.prevZ}for(;pe&&pe.z<=Te;){if(pe.x>=Z&&pe.x<=Q&&pe.y>=$&&pe.y<=ee&&pe!==f&&pe!==y&&Rr(w,N,E,j,R,q,pe.x,pe.y)&&pr(pe.prev,pe,pe.next)>=0)return!1;pe=pe.nextZ}return!0}function Zp(i,e){let n=i;do{const l=n.prev,f=n.next.next;!sh(l,f)&&sr(l,n,n.next,f)&&tf(l,f)&&tf(f,l)&&(e.push(l.i,n.i,f.i),Xf(n),Xf(n.next),n=i=f),n=n.next}while(n!==i);return Ja(n)}function Yp(i,e,n,l,f,m){let y=i;do{let w=y.next.next;for(;w!==y.prev;){if(y.i!==w.i&&T_(y,w)){let E=$p(y,w);return y=Ja(y,y.next),E=Ja(E,E.next),ef(y,e,n,l,f,m,0),void ef(E,e,n,l,f,m,0)}w=w.next}y=y.next}while(y!==i)}function Ud(i,e){let n=i.x-e.x;return n===0&&(n=i.y-e.y,n===0)&&(n=(i.next.y-i.y)/(i.next.x-i.x)-(e.next.y-e.y)/(e.next.x-e.x)),n}function ag(i,e){const n=(function(f,m){let y=m;const w=f.x,E=f.y;let R,N=-1/0;if(sh(f,y))return y;do{if(sh(f,y.next))return y.next;if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){const Q=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(Q<=w&&Q>N&&(N=Q,R=y.x<y.next.x?y:y.next,Q===w))return R}y=y.next}while(y!==m);if(!R)return null;const j=R,q=R.x,Z=R.y;let $=1/0;y=R;do{if(w>=y.x&&y.x>=q&&w!==y.x&&Xp(E<Z?w:N,E,q,Z,E<Z?N:w,E,y.x,y.y)){const Q=Math.abs(E-y.y)/(w-y.x);tf(y,f)&&(Q<$||Q===$&&(y.x>R.x||y.x===R.x&&Mu(R,y)))&&(R=y,$=Q)}y=y.next}while(y!==j);return R})(i,e);if(!n)return e;const l=$p(n,i);return Ja(l,l.next),Ja(n,n.next)}function Mu(i,e){return pr(i.prev,i,e.prev)<0&&pr(e.next,i,i.next)<0}function Pr(i,e,n,l,f){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*f|0)|i<<8))|i<<4))|i<<2))|i<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*f|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Hp(i){let e=i,n=i;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==i);return n}function Xp(i,e,n,l,f,m,y,w){return(f-y)*(e-w)>=(i-y)*(m-w)&&(i-y)*(l-w)>=(n-y)*(e-w)&&(n-y)*(m-w)>=(f-y)*(l-w)}function Rr(i,e,n,l,f,m,y,w){return!(i===y&&e===w)&&Xp(i,e,n,l,f,m,y,w)}function T_(i,e){return i.next.i!==e.i&&i.prev.i!==e.i&&!(function(n,l){let f=n;do{if(f.i!==n.i&&f.next.i!==n.i&&f.i!==l.i&&f.next.i!==l.i&&sr(f,f.next,n,l))return!0;f=f.next}while(f!==n);return!1})(i,e)&&(tf(i,e)&&tf(e,i)&&(function(n,l){let f=n,m=!1;const y=(n.x+l.x)/2,w=(n.y+l.y)/2;do f.y>w!=f.next.y>w&&f.next.y!==f.y&&y<(f.next.x-f.x)*(w-f.y)/(f.next.y-f.y)+f.x&&(m=!m),f=f.next;while(f!==n);return m})(i,e)&&(pr(i.prev,i,e.prev)||pr(i,e.prev,e))||sh(i,e)&&pr(i.prev,i,i.next)>0&&pr(e.prev,e,e.next)>0)}function pr(i,e,n){return(e.y-i.y)*(n.x-e.x)-(e.x-i.x)*(n.y-e.y)}function sh(i,e){return i.x===e.x&&i.y===e.y}function sr(i,e,n,l){const f=Oo(pr(i,e,n)),m=Oo(pr(i,e,l)),y=Oo(pr(n,l,i)),w=Oo(pr(n,l,e));return f!==m&&y!==w||!(f!==0||!ja(i,n,e))||!(m!==0||!ja(i,l,e))||!(y!==0||!ja(n,i,l))||!(w!==0||!ja(n,e,l))}function ja(i,e,n){return e.x<=Math.max(i.x,n.x)&&e.x>=Math.min(i.x,n.x)&&e.y<=Math.max(i.y,n.y)&&e.y>=Math.min(i.y,n.y)}function Oo(i){return i>0?1:i<0?-1:0}function tf(i,e){return pr(i.prev,i,i.next)<0?pr(i,e,i.next)>=0&&pr(i,i.prev,e)>=0:pr(i,e,i.prev)<0||pr(i,i.next,e)<0}function $p(i,e){const n=nf(i.i,i.x,i.y),l=nf(e.i,e.x,e.y),f=i.next,m=e.prev;return i.next=e,e.prev=i,n.next=f,f.prev=n,l.next=n,n.prev=l,m.next=l,l.prev=m,l}function Wp(i,e,n,l){const f=nf(i,e,n);return l?(f.next=l.next,f.prev=l,l.next.prev=f,l.next=f):(f.prev=f,f.next=f),f}function Xf(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function nf(i,e,n){return{i,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class _a{constructor(e,n){if(n>e)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=e,this._minGranularity=n}getGranularityForZoomLevel(e){return Math.max(Math.floor(this._baseZoomGranularity/(1<<e)),this._minGranularity,1)}}class Bs{constructor(e){this.fill=e.fill,this.line=e.line,this.tile=e.tile,this.stencil=e.stencil,this.circle=e.circle}}Bs.noSubdivision=new Bs({fill:new _a(0,0),line:new _a(0,0),tile:new _a(0,0),stencil:new _a(0,0),circle:1}),Xt("SubdivisionGranularityExpression",_a),Xt("SubdivisionGranularitySetting",Bs);const oh=-32768,Ea=32767;class sg{constructor(e,n){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=e,this._granularityCellSize=tt/e,this._canonical=n}_getKey(e,n){return(e+=32768)<<16|n+32768}_vertexToIndex(e,n){if(e<-32768||n<-32768||e>32767||n>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const l=0|Math.round(e),f=0|Math.round(n),m=this._getKey(l,f);if(this._vertexDictionary.has(m))return this._vertexDictionary.get(m);const y=this._vertexBuffer.length/2;return this._vertexDictionary.set(m,y),this._vertexBuffer.push(l,f),y}_subdivideTrianglesScanline(e){if(this._granularity<2)return(function(f,m){const y=[];for(let w=0;w<m.length;w+=3){const E=m[w],R=m[w+1],N=m[w+2],j=f[2*E],q=f[2*E+1];(f[2*R]-j)*(f[2*N+1]-q)-(f[2*R+1]-q)*(f[2*N]-j)>0?(y.push(E),y.push(N),y.push(R)):(y.push(E),y.push(R),y.push(N))}return y})(this._vertexBuffer,e);const n=[],l=e.length;for(let f=0;f<l;f+=3){const m=[e[f+0],e[f+1],e[f+2]],y=[this._vertexBuffer[2*e[f+0]+0],this._vertexBuffer[2*e[f+0]+1],this._vertexBuffer[2*e[f+1]+0],this._vertexBuffer[2*e[f+1]+1],this._vertexBuffer[2*e[f+2]+0],this._vertexBuffer[2*e[f+2]+1]];let w=1/0,E=1/0,R=-1/0,N=-1/0;for(let Q=0;Q<3;Q++){const ee=y[2*Q],se=y[2*Q+1];w=Math.min(w,ee),R=Math.max(R,ee),E=Math.min(E,se),N=Math.max(N,se)}if(w===R||E===N)continue;const j=Math.floor(w/this._granularityCellSize),q=Math.ceil(R/this._granularityCellSize),Z=Math.floor(E/this._granularityCellSize),$=Math.ceil(N/this._granularityCellSize);if(j!==q||Z!==$)for(let Q=Z;Q<$;Q++){const ee=this._scanlineGenerateVertexRingForCellRow(Q,y,m);Cu(this._vertexBuffer,ee,n)}else n.push(...m)}return n}_scanlineGenerateVertexRingForCellRow(e,n,l){const f=e*this._granularityCellSize,m=f+this._granularityCellSize,y=[];for(let w=0;w<3;w++){const E=n[2*w],R=n[2*w+1],N=n[2*(w+1)%6],j=n[(2*(w+1)+1)%6],q=n[2*(w+2)%6],Z=n[(2*(w+2)+1)%6],$=N-E,Q=j-R,ee=$===0,se=Q===0,Te=(f-R)/Q,ue=(m-R)/Q,pe=Math.min(Te,ue),ke=Math.max(Te,ue);if(!se&&(pe>=1||ke<=0)||se&&(R<f||R>m)){j>=f&&j<=m&&y.push(l[(w+1)%3]);continue}!se&&pe>0&&y.push(this._vertexToIndex(E+$*pe,R+Q*pe));const ze=E+$*Math.max(pe,0),ot=E+$*Math.min(ke,1);ee||this._generateIntraEdgeVertices(y,E,R,N,j,ze,ot),!se&&ke<1&&y.push(this._vertexToIndex(E+$*ke,R+Q*ke)),(se||j>=f&&j<=m)&&y.push(l[(w+1)%3]),!se&&(j<=f||j>=m)&&this._generateInterEdgeVertices(y,E,R,N,j,q,Z,ot,f,m)}return y}_generateIntraEdgeVertices(e,n,l,f,m,y,w){const E=f-n,R=m-l,N=R===0,j=N?Math.min(n,f):Math.min(y,w),q=N?Math.max(n,f):Math.max(y,w),Z=Math.floor(j/this._granularityCellSize)+1,$=Math.ceil(q/this._granularityCellSize)-1;if(N?n<f:y<w)for(let Q=Z;Q<=$;Q++){const ee=Q*this._granularityCellSize;e.push(this._vertexToIndex(ee,l+R*(ee-n)/E))}else for(let Q=$;Q>=Z;Q--){const ee=Q*this._granularityCellSize;e.push(this._vertexToIndex(ee,l+R*(ee-n)/E))}}_generateInterEdgeVertices(e,n,l,f,m,y,w,E,R,N){const j=m-l,q=y-f,Z=w-m,$=(R-m)/Z,Q=(N-m)/Z,ee=Math.min($,Q),se=Math.max($,Q),Te=f+q*ee;let ue=Math.floor(Math.min(Te,E)/this._granularityCellSize)+1,pe=Math.ceil(Math.max(Te,E)/this._granularityCellSize)-1,ke=E<Te;const ze=Z===0;if(ze&&(w===R||w===N))return;if(ze||ee>=1||se<=0){const Et=l-w,xt=y+(n-y)*Math.min((R-w)/Et,(N-w)/Et);ue=Math.floor(Math.min(xt,E)/this._granularityCellSize)+1,pe=Math.ceil(Math.max(xt,E)/this._granularityCellSize)-1,ke=E<xt}const ot=j>0?N:R;if(ke)for(let Et=ue;Et<=pe;Et++)e.push(this._vertexToIndex(Et*this._granularityCellSize,ot));else for(let Et=pe;Et>=ue;Et--)e.push(this._vertexToIndex(Et*this._granularityCellSize,ot))}_generateOutline(e){const n=[];for(const l of e){const f=io(l,this._granularity,!0),m=this._pointArrayToIndices(f),y=[];for(let w=1;w<m.length;w++)y.push(m[w-1]),y.push(m[w]);n.push(y)}return n}_handlePoles(e){let n=!1,l=!1;this._canonical&&(this._canonical.y===0&&(n=!0),this._canonical.y===(1<<this._canonical.z)-1&&(l=!0)),(n||l)&&this._fillPoles(e,n,l)}_ensureNoPoleVertices(){const e=this._vertexBuffer;for(let n=0;n<e.length;n+=2){const l=e[n+1];l===oh&&(e[n+1]=-32767),l===Ea&&(e[n+1]=32766)}}_generatePoleQuad(e,n,l,f,m,y){f>m!=(y===oh)?(e.push(n),e.push(l),e.push(this._vertexToIndex(f,y)),e.push(l),e.push(this._vertexToIndex(m,y)),e.push(this._vertexToIndex(f,y))):(e.push(l),e.push(n),e.push(this._vertexToIndex(f,y)),e.push(this._vertexToIndex(m,y)),e.push(l),e.push(this._vertexToIndex(f,y)))}_fillPoles(e,n,l){const f=this._vertexBuffer,m=tt,y=e.length;for(let w=2;w<y;w+=3){const E=e[w-2],R=e[w-1],N=e[w],j=f[2*E],q=f[2*E+1],Z=f[2*R],$=f[2*R+1],Q=f[2*N],ee=f[2*N+1];n&&(q===0&&$===0&&this._generatePoleQuad(e,E,R,j,Z,oh),$===0&&ee===0&&this._generatePoleQuad(e,R,N,Z,Q,oh),ee===0&&q===0&&this._generatePoleQuad(e,N,E,Q,j,oh)),l&&(q===m&&$===m&&this._generatePoleQuad(e,E,R,j,Z,Ea),$===m&&ee===m&&this._generatePoleQuad(e,R,N,Z,Q,Ea),ee===m&&q===m&&this._generatePoleQuad(e,N,E,Q,j,Ea))}}_initializeVertices(e){for(let n=0;n<e.length;n+=2)this._vertexToIndex(e[n],e[n+1])}subdividePolygonInternal(e,n){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:l,holeIndices:f}=(function(w){const E=[],R=[];for(const N of w)if(N.length!==0){N!==w[0]&&E.push(R.length/2);for(let j=0;j<N.length;j++)R.push(N[j].x),R.push(N[j].y)}return{flattened:R,holeIndices:E}})(e);let m;this._initializeVertices(l);try{const w=(function(R,N,j=2){const q=N&&N.length,Z=q?N[0]*j:R.length;let $=Jh(R,0,Z,j,!0);const Q=[];if(!$||$.next===$.prev)return Q;let ee,se,Te;if(q&&($=(function(ue,pe,ke,ze){const ot=[];for(let Et=0,xt=pe.length;Et<xt;Et++){const Lt=Jh(ue,pe[Et]*ze,Et<xt-1?pe[Et+1]*ze:ue.length,ze,!1);Lt===Lt.next&&(Lt.steiner=!0),ot.push(Hp(Lt))}ot.sort(Ud);for(let Et=0;Et<ot.length;Et++)ke=ag(ot[Et],ke);return ke})(R,N,$,j)),R.length>80*j){ee=R[0],se=R[1];let ue=ee,pe=se;for(let ke=j;ke<Z;ke+=j){const ze=R[ke],ot=R[ke+1];ze<ee&&(ee=ze),ot<se&&(se=ot),ze>ue&&(ue=ze),ot>pe&&(pe=ot)}Te=Math.max(ue-ee,pe-se),Te=Te!==0?32767/Te:0}return ef($,Q,j,ee,se,Te,0),Q})(l,f),E=this._convertIndices(l,w);m=this._subdivideTrianglesScanline(E)}catch(w){console.error(w)}let y=[];return n&&(y=this._generateOutline(e)),this._ensureNoPoleVertices(),this._handlePoles(m),{verticesFlattened:this._vertexBuffer,indicesTriangles:m,indicesLineList:y}}_convertIndices(e,n){const l=[];for(let f=0;f<n.length;f++)l.push(this._vertexToIndex(e[2*n[f]],e[2*n[f]+1]));return l}_pointArrayToIndices(e){const n=[];for(let l=0;l<e.length;l++){const f=e[l];n.push(this._vertexToIndex(f.x,f.y))}return n}}function Yl(i,e,n,l=!0){return new sg(n,e).subdividePolygonInternal(i,l)}function io(i,e,n=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const l=i[0],f=i[i.length-1],m=n&&(l.x!==f.x||l.y!==f.y);if(e<2)return m?[...i,i[0]]:[...i];const y=Math.floor(tt/e),w=[];w.push(new X(i[0].x,i[0].y));const E=i.length,R=m?E:E-1;for(let N=0;N<R;N++){const j=i[N],q=N<E-1?i[N+1]:i[0],Z=j.x,$=j.y,Q=q.x,ee=q.y,se=Z!==Q,Te=$!==ee;if(!se&&!Te)continue;const ue=Q-Z,pe=ee-$,ke=Math.abs(ue),ze=Math.abs(pe);let ot=Z,Et=$;for(;;){const Lt=ue>0?(Math.floor(ot/y)+1)*y:(Math.ceil(ot/y)-1)*y,Ht=pe>0?(Math.floor(Et/y)+1)*y:(Math.ceil(Et/y)-1)*y,zt=Math.abs(ot-Lt),Tt=Math.abs(Et-Ht),mt=Math.abs(ot-Q),en=Math.abs(Et-ee),Kt=se?zt/ke:Number.POSITIVE_INFINITY,nn=Te?Tt/ze:Number.POSITIVE_INFINITY;if((mt<=zt||!se)&&(en<=Tt||!Te))break;if(Kt<nn&&se||!Te){ot=Lt,Et+=pe*Kt;const $t=new X(ot,Math.round(Et));w[w.length-1].x===$t.x&&w[w.length-1].y===$t.y||w.push($t)}else{ot+=ue*nn,Et=Ht;const $t=new X(Math.round(ot),Et);w[w.length-1].x===$t.x&&w[w.length-1].y===$t.y||w.push($t)}}const xt=new X(Q,ee);w[w.length-1].x===xt.x&&w[w.length-1].y===xt.y||w.push(xt)}return w}function Cu(i,e,n){if(e.length===0)throw new Error("Subdivision vertex ring is empty.");let l=0,f=i[2*e[0]];for(let E=1;E<e.length;E++){const R=i[2*e[E]];R<f&&(f=R,l=E)}const m=e.length;let y=l,w=(y+1)%m;for(;;){const E=y-1>=0?y-1:m-1,R=(w+1)%m,N=i[2*e[E]],j=i[2*e[R]],q=i[2*e[y]],Z=i[2*e[y]+1],$=i[2*e[w]+1];let Q=!1;if(N<j)Q=!0;else if(N>j)Q=!1;else{const ee=$-Z,se=-(i[2*e[w]]-q),Te=Z<$?1:-1;((N-q)*ee+(i[2*e[E]+1]-Z)*se)*Te>((j-q)*ee+(i[2*e[R]+1]-Z)*se)*Te&&(Q=!0)}if(Q){const ee=e[E],se=e[y],Te=e[w];ee!==se&&ee!==Te&&se!==Te&&n.push(Te,se,ee),y--,y<0&&(y=m-1)}else{const ee=e[R],se=e[y],Te=e[w];ee!==se&&ee!==Te&&se!==Te&&n.push(Te,se,ee),w++,w>=m&&(w=0)}if(E===R)break}}function Vd(i,e,n,l,f,m,y,w,E){const R=f.length/2,N=y&&w&&E;if(R<Dt.MAX_VERTEX_ARRAY_LENGTH){const j=e.prepareSegment(R,n,l),q=j.vertexLength;for(let Q=0;Q<m.length;Q+=3)l.emplaceBack(q+m[Q],q+m[Q+1],q+m[Q+2]);let Z,$;j.vertexLength+=R,j.primitiveLength+=m.length/3,N&&($=y.prepareSegment(R,n,w),Z=$.vertexLength,$.vertexLength+=R);for(let Q=0;Q<f.length;Q+=2)i(f[Q],f[Q+1]);if(N)for(let Q=0;Q<E.length;Q++){const ee=E[Q];for(let se=1;se<ee.length;se+=2)w.emplaceBack(Z+ee[se-1],Z+ee[se]);$.primitiveLength+=ee.length/2}}else(function(j,q,Z,$,Q,ee){const se=[];for(let ze=0;ze<$.length/2;ze++)se.push(-1);const Te={count:0};let ue=0,pe=j.getOrCreateLatestSegment(q,Z),ke=pe.vertexLength;for(let ze=2;ze<Q.length;ze+=3){const ot=Q[ze-2],Et=Q[ze-1],xt=Q[ze];let Lt=se[ot]<ue,Ht=se[Et]<ue,zt=se[xt]<ue;pe.vertexLength+((Lt?1:0)+(Ht?1:0)+(zt?1:0))>Dt.MAX_VERTEX_ARRAY_LENGTH&&(pe=j.createNewSegment(q,Z),ue=Te.count,Lt=!0,Ht=!0,zt=!0,ke=0);const Tt=lh(se,$,ee,Te,ot,Lt,pe),mt=lh(se,$,ee,Te,Et,Ht,pe),en=lh(se,$,ee,Te,xt,zt,pe);Z.emplaceBack(ke+Tt-ue,ke+mt-ue,ke+en-ue),pe.primitiveLength++}})(e,n,l,f,m,i),N&&(function(j,q,Z,$,Q,ee){const se=[];for(let ze=0;ze<$.length/2;ze++)se.push(-1);const Te={count:0};let ue=0,pe=j.getOrCreateLatestSegment(q,Z),ke=pe.vertexLength;for(let ze=0;ze<Q.length;ze++){const ot=Q[ze];for(let Et=1;Et<Q[ze].length;Et+=2){const xt=ot[Et-1],Lt=ot[Et];let Ht=se[xt]<ue,zt=se[Lt]<ue;pe.vertexLength+((Ht?1:0)+(zt?1:0))>Dt.MAX_VERTEX_ARRAY_LENGTH&&(pe=j.createNewSegment(q,Z),ue=Te.count,Ht=!0,zt=!0,ke=0);const Tt=lh(se,$,ee,Te,xt,Ht,pe),mt=lh(se,$,ee,Te,Lt,zt,pe);Z.emplaceBack(ke+Tt-ue,ke+mt-ue),pe.primitiveLength++}}})(y,n,w,f,E,i),e.forceNewSegmentOnNextPrepare(),y?.forceNewSegmentOnNextPrepare()}function lh(i,e,n,l,f,m,y){if(m){const w=l.count;return n(e[2*f],e[2*f+1]),i[f]=l.count,l.count++,y.vertexLength++,w}return i[f]}class ro{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new ae,this.indexArray=new ht,this.indexArray2=new st,this.programConfigurations=new Gi(e.layers,e.zoom),this.segments=new Dt,this.segments2=new Dt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=Hf("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),m=!f.isConstant(),y=[];for(const{feature:w,id:E,index:R,sourceLayerIndex:N}of e){const j=this.layers[0]._featureFilter.needGeometry,q=Gl(w,j);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),q,l))continue;const Z=m?f.evaluate(q,{},l,n.availableImages):void 0,$={id:E,properties:w.properties,type:w.type,sourceLayerIndex:N,index:R,geometry:j?q.geometry:xs(w),patterns:{},sortKey:Z};y.push($)}m&&y.sort(((w,E)=>w.sortKey-E.sortKey));for(const w of y){const{geometry:E,index:R,sourceLayerIndex:N}=w;if(this.hasDependencies){const j=jd("fill",this.layers,w,{zoom:this.zoom},n);this.patternFeatures.push(j)}else this.addFeature(w,E,R,l,{},n.subdivisionGranularity);n.featureIndex.insert(e[R].feature,E,R,N,this.index)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}addFeatures(e,n,l){for(const f of this.patternFeatures)this.addFeature(f,f.geometry,f.index,n,l,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,dc),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,l,f,m,y){for(const w of Il(n,500)){const E=Yl(w,f,y.fill.getGranularityForZoomLevel(f.z)),R=this.layoutVertexArray;Vd(((N,j)=>{R.emplaceBack(N,j)}),this.segments,this.layoutVertexArray,this.indexArray,E.verticesFlattened,E.indicesTriangles,this.segments2,this.indexArray2,E.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:m,canonical:f})}}let Kp,uh;Xt("FillBucket",ro,{omit:["layers","patternFeatures"]});var $f={get paint(){return uh=uh||new fr({"fill-antialias":new on(it.paint_fill["fill-antialias"]),"fill-opacity":new mn(it.paint_fill["fill-opacity"]),"fill-color":new mn(it.paint_fill["fill-color"]),"fill-outline-color":new mn(it.paint_fill["fill-outline-color"]),"fill-translate":new on(it.paint_fill["fill-translate"]),"fill-translate-anchor":new on(it.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ul(it.paint_fill["fill-pattern"])})},get layout(){return Kp=Kp||new fr({"fill-sort-key":new mn(it.layout_fill["fill-sort-key"])})}};class Wf extends Ba{constructor(e,n){super(e,$f,n)}recalculate(e,n){super.recalculate(e,n);const l=this.paint._values["fill-outline-color"];l.value.kind==="constant"&&l.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new ro(e)}queryRadius(){return fc(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:e,geometry:n,transform:l,pixelsToTileUnits:f}){return Wh(Uf(e,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-l.bearingInRadians,f),n)}isTileClipped(){return!0}}const rf=fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),og=fn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:lg}=rf;class Iu{constructor(e,n,l,f,m){this.properties={},this.extent=l,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=m,e.readFields(ug,this,n)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos,l=[];let f,m=1,y=0,w=0,E=0;for(;e.pos<n;){if(y<=0){const R=e.readVarint();m=7&R,y=R>>3}if(y--,m===1||m===2)w+=e.readSVarint(),E+=e.readSVarint(),m===1&&(f&&l.push(f),f=[]),f&&f.push(new X(w,E));else{if(m!==7)throw new Error(`unknown command ${m}`);f&&f.push(f[0].clone())}}return f&&l.push(f),l}bbox(){const e=this._pbf;e.pos=this._geometry;const n=e.readVarint()+e.pos;let l=1,f=0,m=0,y=0,w=1/0,E=-1/0,R=1/0,N=-1/0;for(;e.pos<n;){if(f<=0){const j=e.readVarint();l=7&j,f=j>>3}if(f--,l===1||l===2)m+=e.readSVarint(),y+=e.readSVarint(),m<w&&(w=m),m>E&&(E=m),y<R&&(R=y),y>N&&(N=y);else if(l!==7)throw new Error(`unknown command ${l}`)}return[w,R,E,N]}toGeoJSON(e,n,l){const f=this.extent*Math.pow(2,l),m=this.extent*e,y=this.extent*n,w=this.loadGeometry();function E(q){return[360*(q.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((1-2*(q.y+y)/f)*Math.PI))-90]}function R(q){return q.map(E)}let N;if(this.type===1){const q=[];for(const $ of w)q.push($[0]);const Z=R(q);N=q.length===1?{type:"Point",coordinates:Z[0]}:{type:"MultiPoint",coordinates:Z}}else if(this.type===2){const q=w.map(R);N=q.length===1?{type:"LineString",coordinates:q[0]}:{type:"MultiLineString",coordinates:q}}else{if(this.type!==3)throw new Error("unknown feature type");{const q=Kf(w),Z=[];for(const $ of q)Z.push($.map(R));N=Z.length===1?{type:"Polygon",coordinates:Z[0]}:{type:"MultiPolygon",coordinates:Z}}}const j={type:"Feature",geometry:N,properties:this.properties};return this.id!=null&&(j.id=this.id),j}}function ug(i,e,n){i===1?e.id=n.readVarint():i===2?(function(l,f){const m=l.readVarint()+l.pos;for(;l.pos<m;){const y=f._keys[l.readVarint()],w=f._values[l.readVarint()];f.properties[y]=w}})(n,e):i===3?e.type=n.readVarint():i===4&&(e._geometry=n.pos)}function Kf(i){const e=i.length;if(e<=1)return[i];const n=[];let l,f;for(let m=0;m<e;m++){const y=cg(i[m]);y!==0&&(f===void 0&&(f=y<0),f===y<0?(l&&n.push(l),l=[i[m]]):l&&l.push(i[m]))}return l&&n.push(l),n}function cg(i){let e=0;for(let n,l,f=0,m=i.length,y=m-1;f<m;y=f++)n=i[f],l=i[y],e+=(l.x-n.x)*(n.y+l.y);return e}Iu.types=["Unknown","Point","LineString","Polygon"];class S_{constructor(e,n){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(E_,this,n),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const n=this._pbf.readVarint()+this._pbf.pos;return new Iu(this._pbf,n,this.extent,this._keys,this._values)}}function E_(i,e,n){i===15?e.version=n.readVarint():i===1?e.name=n.readString():i===5?e.extent=n.readVarint():i===2?e._features.push(n.pos):i===3?e._keys.push(n.readString()):i===4&&e._values.push((function(l){let f=null;const m=l.readVarint()+l.pos;for(;l.pos<m;){const y=l.readVarint()>>3;f=y===1?l.readString():y===2?l.readFloat():y===3?l.readDouble():y===4?l.readVarint64():y===5?l.readVarint():y===6?l.readSVarint():y===7?l.readBoolean():null}if(f==null)throw new Error("unknown feature value");return f})(n))}class yi{constructor(e,n){this.layers=e.readFields(Zi,{},n)}}function Zi(i,e,n){if(i===3){const l=new S_(n,n.readVarint()+n.pos);l.length&&(e[l.name]=l)}}const Xn=Math.pow(2,13);function Yn(i,e,n,l,f,m,y,w){i.emplaceBack(e,n,2*Math.floor(l*Xn)+y,f*Xn*2,m*Xn*2,Math.round(w))}class Ii{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.layoutVertexArray=new ge,this.centroidVertexArray=new Y,this.indexArray=new ht,this.programConfigurations=new Gi(e.layers,e.zoom),this.segments=new Dt,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.features=[],this.hasDependencies=Hf("fill-extrusion",this.layers,n);for(const{feature:f,id:m,index:y,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,R=Gl(f,E);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),R,l))continue;const N={id:m,sourceLayerIndex:w,index:y,geometry:E?R.geometry:xs(f),properties:f.properties,type:f.type,patterns:{}};this.hasDependencies?this.features.push(jd("fill-extrusion",this.layers,N,{zoom:this.zoom},n)):this.addFeature(N,N.geometry,y,l,{},n.subdivisionGranularity),n.featureIndex.insert(f,N.geometry,y,w,this.index,!0)}}addFeatures(e,n,l){for(const f of this.features){const{geometry:m}=f;this.addFeature(f,m,f.index,n,l,e.subdivisionGranularity)}}update(e,n,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lg),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,og.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,n,l,f,m,y){for(const w of Il(n,500)){const E={x:0,y:0,sampleCount:0},R=this.layoutVertexArray.length;this.processPolygon(E,f,e,w,y);const N=this.layoutVertexArray.length-R,j=Math.floor(E.x/E.sampleCount),q=Math.floor(E.y/E.sampleCount);for(let Z=0;Z<N;Z++)this.centroidVertexArray.emplaceBack(j,q)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:m,canonical:f})}processPolygon(e,n,l,f,m){if(f.length<1||ch(f[0]))return;for(const j of f)j.length!==0&&ao(e,j);const y={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},w=m.fill.getGranularityForZoomLevel(n.z),E=Iu.types[l.type]==="Polygon";for(const j of f){if(j.length===0||ch(j))continue;const q=io(j,w,E);this._generateSideFaces(q,y)}if(!E)return;const R=Yl(f,n,w,!1),N=this.layoutVertexArray;Vd(((j,q)=>{Yn(N,j,q,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,R.verticesFlattened,R.indicesTriangles)}_generateSideFaces(e,n){let l=0;for(let f=1;f<e.length;f++){const m=e[f],y=e[f-1];if(pc(m,y))continue;n.segment.vertexLength+4>Dt.MAX_VERTEX_ARRAY_LENGTH&&(n.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const w=m.sub(y)._perp()._unit(),E=y.dist(m);l+E>32768&&(l=0),Yn(this.layoutVertexArray,m.x,m.y,w.x,w.y,0,0,l),Yn(this.layoutVertexArray,m.x,m.y,w.x,w.y,0,1,l),l+=E,Yn(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,0,l),Yn(this.layoutVertexArray,y.x,y.y,w.x,w.y,0,1,l);const R=n.segment.vertexLength;this.indexArray.emplaceBack(R,R+2,R+1),this.indexArray.emplaceBack(R+1,R+2,R+3),n.segment.vertexLength+=4,n.segment.primitiveLength+=2}}}function ao(i,e){for(let n=0;n<e.length;n++){const l=e[n];n===e.length-1&&e[0].x===l.x&&e[0].y===l.y||(i.x+=l.x,i.y+=l.y,i.sampleCount++)}}function pc(i,e){return i.x===e.x&&(i.x<0||i.x>tt)||i.y===e.y&&(i.y<0||i.y>tt)}function ch(i){return i.every((e=>e.x<0))||i.every((e=>e.x>tt))||i.every((e=>e.y<0))||i.every((e=>e.y>tt))}let Gd;Xt("FillExtrusionBucket",Ii,{omit:["layers","features"]});var Au={get paint(){return Gd=Gd||new fr({"fill-extrusion-opacity":new on(it["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mn(it["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new on(it["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new on(it["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ul(it["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mn(it["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mn(it["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new on(it["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Dr extends Ba{constructor(e,n){super(e,Au,n)}createBucket(e){return new Ii(e)}queryRadius(){return fc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:f,transform:m,pixelsToTileUnits:y,pixelPosMatrix:w}){const E=Uf(e,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-m.bearingInRadians,y),R=this.paint.get("fill-extrusion-height").evaluate(n,l),N=this.paint.get("fill-extrusion-base").evaluate(n,l),j=(function(Z,$){const Q=[];for(const ee of Z){const se=[ee.x,ee.y,0,1];Fe(se,se,$),Q.push(new X(se[0]/se[3],se[1]/se[3]))}return Q})(E,w),q=(function(Z,$,Q,ee){const se=[],Te=[],ue=ee[8]*$,pe=ee[9]*$,ke=ee[10]*$,ze=ee[11]*$,ot=ee[8]*Q,Et=ee[9]*Q,xt=ee[10]*Q,Lt=ee[11]*Q;for(const Ht of Z){const zt=[],Tt=[];for(const mt of Ht){const en=mt.x,Kt=mt.y,nn=ee[0]*en+ee[4]*Kt+ee[12],$t=ee[1]*en+ee[5]*Kt+ee[13],hn=ee[2]*en+ee[6]*Kt+ee[14],ti=ee[3]*en+ee[7]*Kt+ee[15],Gn=hn+ke,lr=ti+ze,is=nn+ot,la=$t+Et,ur=hn+xt,nr=ti+Lt,wi=new X((nn+ue)/lr,($t+pe)/lr);wi.z=Gn/lr,zt.push(wi);const wr=new X(is/nr,la/nr);wr.z=ur/nr,Tt.push(wr)}se.push(zt),Te.push(Tt)}return[se,Te]})(f,N,R,w);return(function(Z,$,Q){let ee=1/0;Wh(Q,$)&&(ee=mc(Q,$[0]));for(let se=0;se<$.length;se++){const Te=$[se],ue=Z[se];for(let pe=0;pe<Te.length-1;pe++){const ke=Te[pe],ze=[ke,Te[pe+1],ue[pe+1],ue[pe],ke];$h(Q,ze)&&(ee=Math.min(ee,mc(Q,ze)))}}return ee!==1/0&&ee})(q[0],q[1],j)}}function No(i,e){return i.x*e.x+i.y*e.y}function mc(i,e){if(i.length===1){let n=0;const l=e[n++];let f;for(;!f||l.equals(f);)if(f=e[n++],!f)return 1/0;for(;n<e.length;n++){const m=e[n],y=i[0],w=f.sub(l),E=m.sub(l),R=y.sub(l),N=No(w,w),j=No(w,E),q=No(E,E),Z=No(R,w),$=No(R,E),Q=N*q-j*j,ee=(q*Z-j*$)/Q,se=(N*$-j*Z)/Q,Te=l.z*(1-ee-se)+f.z*ee+m.z*se;if(isFinite(Te))return Te}return 1/0}{let n=1/0;for(const l of e)n=Math.min(n,l.z);return n}}const Qp=fn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:so}=Qp,af=fn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Qf}=af,Fs=Math.cos(Math.PI/180*37.5),qd=Math.pow(2,14)/.5;class sf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((n=>n.id)),this.index=e.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((n=>{this.gradients[n.id]={}})),this.layoutVertexArray=new ve,this.layoutVertexArray2=new ye,this.indexArray=new ht,this.programConfigurations=new Gi(e.layers,e.zoom),this.segments=new Dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((n=>n.isStateDependent())).map((n=>n.id))}populate(e,n,l){this.hasDependencies=Hf("line",this.layers,n)||this.hasLineDasharray(this.layers);const f=this.layers[0].layout.get("line-sort-key"),m=!f.isConstant(),y=[];for(const{feature:w,id:E,index:R,sourceLayerIndex:N}of e){const j=this.layers[0]._featureFilter.needGeometry,q=Gl(w,j);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),q,l))continue;const Z=m?f.evaluate(q,{},l):void 0,$={id:E,properties:w.properties,type:w.type,sourceLayerIndex:N,index:R,geometry:j?q.geometry:xs(w),patterns:{},dashes:{},sortKey:Z};y.push($)}m&&y.sort(((w,E)=>w.sortKey-E.sortKey));for(const w of y){const{geometry:E,index:R,sourceLayerIndex:N}=w;this.hasDependencies?(Hf("line",this.layers,n)?jd("line",this.layers,w,{zoom:this.zoom},n):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,w,this.zoom,n),this.patternFeatures.push(w)):this.addFeature(w,E,R,l,{},{},n.subdivisionGranularity),n.featureIndex.insert(e[R].feature,E,R,N,this.index)}}update(e,n,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,{imagePositions:l,dashPositions:f})}addFeatures(e,n,l,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,l,f,e.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Qf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,so),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,l,f,m,y,w){const E=this.layers[0].layout,R=E.get("line-join").evaluate(e,{}),N=E.get("line-cap"),j=E.get("line-miter-limit"),q=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const Z of n)this.addLine(Z,e,R,N,j,q,f,w);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{imagePositions:m,dashPositions:y,canonical:f})}addLine(e,n,l,f,m,y,w,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,e=io(e,w?E.line.getGranularityForZoomLevel(w.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ue=0;ue<e.length-1;ue++)this.totalDistance+=e[ue].dist(e[ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const R=Iu.types[n.type]==="Polygon";let N=e.length;for(;N>=2&&e[N-1].equals(e[N-2]);)N--;let j=0;for(;j<N-1&&e[j].equals(e[j+1]);)j++;if(N<(R?3:2))return;l==="bevel"&&(m=1.05);const q=this.overscaling<=16?122880/(512*this.overscaling):0,Z=this.segments.prepareSegment(10*N,this.layoutVertexArray,this.indexArray);let $,Q,ee,se,Te;this.e1=this.e2=-1,R&&($=e[N-2],Te=e[j].sub($)._unit()._perp());for(let ue=j;ue<N;ue++){if(ee=ue===N-1?R?e[j+1]:void 0:e[ue+1],ee&&e[ue].equals(ee))continue;Te&&(se=Te),$&&(Q=$),$=e[ue],Te=ee?ee.sub($)._unit()._perp():se,se=se||Te;let pe=se.add(Te);pe.x===0&&pe.y===0||pe._unit();const ke=se.x*Te.x+se.y*Te.y,ze=pe.x*Te.x+pe.y*Te.y,ot=ze!==0?1/ze:1/0,Et=2*Math.sqrt(2-2*ze),xt=ze<Fs&&Q&&ee,Lt=se.x*Te.y-se.y*Te.x>0;if(xt&&ue>j){const Tt=$.dist(Q);if(Tt>2*q){const mt=$.sub($.sub(Q)._mult(q/Tt)._round());this.updateDistance(Q,mt),this.addCurrentVertex(mt,se,0,0,Z),Q=mt}}const Ht=Q&&ee;let zt=Ht?l:R?"butt":f;if(Ht&&zt==="round"&&(ot<y?zt="miter":ot<=2&&(zt="fakeround")),zt==="miter"&&ot>m&&(zt="bevel"),zt==="bevel"&&(ot>2&&(zt="flipbevel"),ot<m&&(zt="miter")),Q&&this.updateDistance(Q,$),zt==="miter")pe._mult(ot),this.addCurrentVertex($,pe,0,0,Z);else if(zt==="flipbevel"){if(ot>100)pe=Te.mult(-1);else{const Tt=ot*se.add(Te).mag()/se.sub(Te).mag();pe._perp()._mult(Tt*(Lt?-1:1))}this.addCurrentVertex($,pe,0,0,Z),this.addCurrentVertex($,pe.mult(-1),0,0,Z)}else if(zt==="bevel"||zt==="fakeround"){const Tt=-Math.sqrt(ot*ot-1),mt=Lt?Tt:0,en=Lt?0:Tt;if(Q&&this.addCurrentVertex($,se,mt,en,Z),zt==="fakeround"){const Kt=Math.round(180*Et/Math.PI/20);for(let nn=1;nn<Kt;nn++){let $t=nn/Kt;if($t!==.5){const ti=$t-.5;$t+=$t*ti*($t-1)*((1.0904+ke*(ke*(3.55645-1.43519*ke)-3.2452))*ti*ti+(.848013+ke*(.215638*ke-1.06021)))}const hn=Te.sub(se)._mult($t)._add(se)._unit()._mult(Lt?-1:1);this.addHalfVertex($,hn.x,hn.y,!1,Lt,0,Z)}}ee&&this.addCurrentVertex($,Te,-mt,-en,Z)}else if(zt==="butt")this.addCurrentVertex($,pe,0,0,Z);else if(zt==="square"){const Tt=Q?1:-1;this.addCurrentVertex($,pe,Tt,Tt,Z)}else zt==="round"&&(Q&&(this.addCurrentVertex($,se,0,0,Z),this.addCurrentVertex($,se,1,1,Z,!0)),ee&&(this.addCurrentVertex($,Te,-1,-1,Z,!0),this.addCurrentVertex($,Te,0,0,Z)));if(xt&&ue<N-1){const Tt=$.dist(ee);if(Tt>2*q){const mt=$.add(ee.sub($)._mult(q/Tt)._round());this.updateDistance($,mt),this.addCurrentVertex(mt,Te,0,0,Z),$=mt}}}}addCurrentVertex(e,n,l,f,m,y=!1){const w=n.y*f-n.x,E=-n.y-n.x*f;this.addHalfVertex(e,n.x+n.y*l,n.y-n.x*l,y,!1,l,m),this.addHalfVertex(e,w,E,y,!0,-f,m),this.distance>qd/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(e,n,l,f,m,y))}addHalfVertex({x:e,y:n},l,f,m,y,w,E){const R=.5*(this.lineClips?this.scaledDistance*(qd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(n<<1)+(y?1:0),Math.round(63*l)+128,Math.round(63*f)+128,1+(w===0?0:w<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,N,this.e2),E.primitiveLength++),y?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}hasLineDasharray(e){for(const n of e){const l=n.paint.get("line-dasharray");if(l&&!l.isConstant())return!0}return!1}addLineDashDependencies(e,n,l,f){for(const m of e){const y=m.paint.get("line-dasharray");if(!y||y.value.kind==="constant")continue;const w=m.layout.get("line-cap")==="round",E={dasharray:y.value.evaluate({zoom:l-1},n,{}),round:w},R={dasharray:y.value.evaluate({zoom:l},n,{}),round:w},N={dasharray:y.value.evaluate({zoom:l+1},n,{}),round:w},j=`${E.dasharray.join(",")},${E.round}`,q=`${R.dasharray.join(",")},${R.round}`,Z=`${N.dasharray.join(",")},${N.round}`;f.dashDependencies[j]=E,f.dashDependencies[q]=R,f.dashDependencies[Z]=N,n.dashes[m.id]={min:j,mid:q,max:Z}}}}let Jp,Jf;Xt("LineBucket",sf,{omit:["layers","patternFeatures"]});var ed={get paint(){return Jf=Jf||new fr({"line-opacity":new mn(it.paint_line["line-opacity"]),"line-color":new mn(it.paint_line["line-color"]),"line-translate":new on(it.paint_line["line-translate"]),"line-translate-anchor":new on(it.paint_line["line-translate-anchor"]),"line-width":new mn(it.paint_line["line-width"]),"line-gap-width":new mn(it.paint_line["line-gap-width"]),"line-offset":new mn(it.paint_line["line-offset"]),"line-blur":new mn(it.paint_line["line-blur"]),"line-dasharray":new Ul(it.paint_line["line-dasharray"]),"line-pattern":new Ul(it.paint_line["line-pattern"]),"line-gradient":new ia(it.paint_line["line-gradient"])})},get layout(){return Jp=Jp||new fr({"line-cap":new on(it.layout_line["line-cap"]),"line-join":new mn(it.layout_line["line-join"]),"line-miter-limit":new on(it.layout_line["line-miter-limit"]),"line-round-limit":new on(it.layout_line["line-round-limit"]),"line-sort-key":new mn(it.layout_line["line-sort-key"])})}};class gc extends mn{possiblyEvaluate(e,n){return n=new Hn(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(e,n)}evaluate(e,n,l,f){return n=Qe({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(e,n,l,f)}}let Lr;class _c extends Ba{constructor(e,n){super(e,ed,n),this.gradientVersion=0,Lr||(Lr=new gc(ed.paint.properties["line-width"].specification),Lr.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!(function(l){return l._styleExpression!==void 0})(n)&&n._styleExpression.expression instanceof jr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(e,n){super.recalculate(e,n),this.paint._values["line-floorwidth"]=Lr.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new sf(e)}queryRadius(e){const n=e,l=hh(ah("line-width",this,n),ah("line-gap-width",this,n)),f=ah("line-offset",this,n);return l/2+Math.abs(f)+fc(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:e,feature:n,featureState:l,geometry:f,transform:m,pixelsToTileUnits:y}){const w=Uf(e,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-m.bearingInRadians,y),E=y/2*hh(this.paint.get("line-width").evaluate(n,l),this.paint.get("line-gap-width").evaluate(n,l)),R=this.paint.get("line-offset").evaluate(n,l);return R&&(f=(function(N,j){const q=[];for(let Z=0;Z<N.length;Z++){const $=Dd(N[Z]),Q=[];for(let ee=0;ee<$.length;ee++){const se=$[ee],Te=$[ee-1],ue=$[ee+1],pe=ee===0?new X(0,0):se.sub(Te)._unit()._perp(),ke=ee===$.length-1?new X(0,0):ue.sub(se)._unit()._perp(),ze=pe._add(ke)._unit(),ot=ze.x*ke.x+ze.y*ke.y;ot!==0&&ze._mult(1/ot),Q.push(ze._mult(j)._add(se))}q.push(Q)}return q})(f,R*y)),(function(N,j,q){for(let Z=0;Z<j.length;Z++){const $=j[Z];if(N.length>=3){for(let Q=0;Q<$.length;Q++)if(rh(N,$[Q]))return!0}if(Kh(N,$,q))return!0}return!1})(w,f,E)}isTileClipped(){return!0}}function hh(i,e){return e>0?e+2*i:i}const ku=fn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),em=fn([{name:"a_projected_pos",components:3,type:"Float32"}],4);fn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const tm=fn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);fn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const nm=fn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),td=fn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function im(i,e,n){return i.sections.forEach((l=>{l.text=(function(f,m,y){const w=m.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?f=f.toLocaleUpperCase():w==="lowercase"&&(f=f.toLocaleLowerCase()),Js.applyArabicShaping&&(f=Js.applyArabicShaping(f)),f})(l.text,e,n)})),i}fn([{name:"triangle",components:3,type:"Uint16"}]),fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),fn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),fn([{type:"Float32",name:"offsetX"}]),fn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),fn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);var vi=24;const of={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},js={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},hg={40:!0};function rm(i,e,n,l,f,m){if("fontStack"in e){const y=n[e.fontStack],w=y&&y[i];return w?w.metrics.advance*e.scale+f:0}{const y=l[e.imageName];return y?y.displaySize[0]*e.scale*vi/m+f:0}}function fg(i,e,n,l){const f=Math.pow(i-e,2);return l?i<e?f/2:2*f:f+Math.abs(n)*n}function yc(i,e,n){let l=0;return i===10&&(l-=1e4),n&&(l+=150),i!==40&&i!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function nd(i,e,n,l,f,m){let y=null,w=fg(e,n,f,m);for(const E of l){const R=fg(e-E.x,n,f,m)+E.badness;R<=w&&(y=E,w=R)}return{index:i,x:e,priorBreak:y,badness:w}}function Zd(i){return i?Zd(i.priorBreak).concat(i.index):[]}class pl{constructor(e="",n=[],l=[]){this.text=e,this.sections=n,this.sectionIndex=l,this.imageSectionID=null}static fromFeature(e,n){const l=new pl;for(let f=0;f<e.sections.length;f++){const m=e.sections[f];m.image?l.addImageSection(m):l.addTextSection(m,n)}return l}length(){return[...this.text].length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}verticalizePunctuation(){this.text=(function(e){let n="",l={premature:!0,value:void 0};const f=e[Symbol.iterator]();let m=f.next();const y=e[Symbol.iterator]();y.next();let w=y.next();for(;!m.done;)n+=!w.done&&Jc(w.value.codePointAt(0))&&!of[w.value]||!l.premature&&Jc(l.value.codePointAt(0))&&!of[l.value]||!of[m.value]?m.value:of[m.value],l={value:m.value,premature:!1},m=f.next(),w=y.next();return n})(this.text)}hasZeroWidthSpaces(){return this.text.includes("")}trim(){const e=this.text.match(/^\s*/),n=e?e[0].length:0,l=this.text.match(/\S\s*$/),f=l?l[0].length-1:0;this.text=this.text.substring(n,this.text.length-f),this.sectionIndex=this.sectionIndex.slice(n,this.sectionIndex.length-f)}substring(e,n){const l=[...this.text].slice(e,n).join(""),f=this.sectionIndex.slice(e,n);return new pl(l,this.sections,f)}toCodeUnitIndex(e){return[...this.text].slice(0,e).join("").length}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,n)=>Math.max(e,this.sections[n].scale)),0)}getMaxImageSize(e){let n=0,l=0;for(let f=0;f<this.length();f++){const m=this.getSection(f);if("imageName"in m){const y=e[m.imageName];if(!y)continue;const w=y.displaySize;n=Math.max(n,w[0]),l=Math.max(l,w[1])}}return{maxImageWidth:n,maxImageHeight:l}}addTextSection(e,n){this.text+=e.text,this.sections.push({scale:e.scale||1,verticalAlign:e.verticalAlign||"bottom",fontStack:e.fontStack||n});const l=this.sections.length-1;this.sectionIndex.push(...[...e.text].map((()=>l)))}addImageSection(e){const n=e.image?e.image.name:"";if(n.length===0)return void Dn("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push({scale:1,verticalAlign:e.verticalAlign||"bottom",imageName:n}),this.sectionIndex.push(this.sections.length-1)):Dn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}determineLineBreaks(e,n,l,f,m){const y=[],w=this.determineAverageLineWidth(e,n,l,f,m),E=this.hasZeroWidthSpaces();let R=0,N=0;const j=this.text[Symbol.iterator]();let q=j.next();const Z=this.text[Symbol.iterator]();Z.next();let $=Z.next();const Q=this.text[Symbol.iterator]();Q.next(),Q.next();let ee=Q.next();for(;!q.done;){const se=this.getSection(N),Te=q.value.codePointAt(0);if(Lf(Te)||(R+=rm(Te,se,l,f,e,m)),!$.done){const ue=_u(Te),pe=$.value.codePointAt(0);(js[Te]||ue||"imageName"in se||!ee.done&&hg[pe])&&y.push(nd(N+1,R,w,y,yc(Te,pe,ue&&E),!1))}N++,q=j.next(),$=Z.next(),ee=Q.next()}return Zd(nd(this.length(),R,w,y,0,!0))}determineAverageLineWidth(e,n,l,f,m){let y=0,w=0;for(const E of this.text){const R=this.getSection(w);y+=rm(E.codePointAt(0),R,l,f,e,m),w++}return y/Math.max(1,Math.ceil(y/n))}}const Yd=4294967296,am=1/Yd,sm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class id{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,n,l=this.length){for(;this.pos<l;){const f=this.readVarint(),m=f>>3,y=this.pos;this.type=7&f,e(m,n,this),this.pos===y&&this.skip(f)}return n}readMessage(e,n){return this.readFields(e,n,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Yd;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Yd;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const n=this.buf;let l,f;return f=n[this.pos++],l=127&f,f<128?l:(f=n[this.pos++],l|=(127&f)<<7,f<128?l:(f=n[this.pos++],l|=(127&f)<<14,f<128?l:(f=n[this.pos++],l|=(127&f)<<21,f<128?l:(f=n[this.pos],l|=(15&f)<<28,(function(m,y,w){const E=w.buf;let R,N;if(N=E[w.pos++],R=(112&N)>>4,N<128||(N=E[w.pos++],R|=(127&N)<<3,N<128)||(N=E[w.pos++],R|=(127&N)<<10,N<128)||(N=E[w.pos++],R|=(127&N)<<17,N<128)||(N=E[w.pos++],R|=(127&N)<<24,N<128)||(N=E[w.pos++],R|=(1&N)<<31,N<128))return Pu(m,R,y);throw new Error("Expected varint not more than 10 bytes")})(l,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){const e=this.readVarint()+this.pos,n=this.pos;return this.pos=e,e-n>=12&&sm?sm.decode(this.buf.subarray(n,e)):(function(l,f,m){let y="",w=f;for(;w<m;){const E=l[w];let R,N,j,q=null,Z=E>239?4:E>223?3:E>191?2:1;if(w+Z>m)break;Z===1?E<128&&(q=E):Z===2?(R=l[w+1],(192&R)==128&&(q=(31&E)<<6|63&R,q<=127&&(q=null))):Z===3?(R=l[w+1],N=l[w+2],(192&R)==128&&(192&N)==128&&(q=(15&E)<<12|(63&R)<<6|63&N,(q<=2047||q>=55296&&q<=57343)&&(q=null))):Z===4&&(R=l[w+1],N=l[w+2],j=l[w+3],(192&R)==128&&(192&N)==128&&(192&j)==128&&(q=(15&E)<<18|(63&R)<<12|(63&N)<<6|63&j,(q<=65535||q>=1114112)&&(q=null))),q===null?(q=65533,Z=1):q>65535&&(q-=65536,y+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),y+=String.fromCharCode(q),w+=Z}return y})(this.buf,n,e)}readBytes(){const e=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,e);return this.pos=e,n}readPackedVarint(e=[],n){const l=this.readPackedEnd();for(;this.pos<l;)e.push(this.readVarint(n));return e}readPackedSVarint(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFloat());return e}readPackedDouble(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){const n=this.readPackedEnd();for(;this.pos<n;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(e){const n=7&e;if(n===0)for(;this.buf[this.pos++]>127;);else if(n===2)this.pos=this.readVarint()+this.pos;else if(n===5)this.pos+=4;else{if(n!==1)throw new Error(`Unimplemented type: ${n}`);this.pos+=8}}writeTag(e,n){this.writeVarint(e<<3|n)}realloc(e){let n=this.length||16;for(;n<this.pos+e;)n*=2;if(n!==this.length){const l=new Uint8Array(n);l.set(this.buf),this.buf=l,this.dataView=new DataView(l.buffer),this.length=n}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*am),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*am),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?(function(n,l){let f,m;if(n>=0?(f=n%4294967296|0,m=n/4294967296|0):(f=~(-n%4294967296),m=~(-n/4294967296),4294967295^f?f=f+1|0:(f=0,m=m+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),(function(y,w,E){E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,E.buf[E.pos]=127&(y>>>=7)})(f,0,l),(function(y,w){const E=(7&y)<<4;w.buf[w.pos++]|=E|((y>>>=3)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y|((y>>>=7)?128:0),y&&(w.buf[w.pos++]=127&y)))))})(m,l)})(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const n=this.pos;this.pos=(function(f,m,y){for(let w,E,R=0;R<m.length;R++){if(w=m.charCodeAt(R),w>55295&&w<57344){if(!E){w>56319||R+1===m.length?(f[y++]=239,f[y++]=191,f[y++]=189):E=w;continue}if(w<56320){f[y++]=239,f[y++]=191,f[y++]=189,E=w;continue}w=E-55296<<10|w-56320|65536,E=null}else E&&(f[y++]=239,f[y++]=191,f[y++]=189,E=null);w<128?f[y++]=w:(w<2048?f[y++]=w>>6|192:(w<65536?f[y++]=w>>12|224:(f[y++]=w>>18|240,f[y++]=w>>12&63|128),f[y++]=w>>6&63|128),f[y++]=63&w|128)}return y})(this.buf,e,this.pos);const l=this.pos-n;l>=128&&Hd(n,l,this),this.pos=n-1,this.writeVarint(l),this.pos+=l}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const n=e.length;this.writeVarint(n),this.realloc(n);for(let l=0;l<n;l++)this.buf[this.pos++]=e[l]}writeRawMessage(e,n){this.pos++;const l=this.pos;e(n,this);const f=this.pos-l;f>=128&&Hd(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f}writeMessage(e,n,l){this.writeTag(e,2),this.writeRawMessage(n,l)}writePackedVarint(e,n){n.length&&this.writeMessage(e,M_,n)}writePackedSVarint(e,n){n.length&&this.writeMessage(e,C_,n)}writePackedBoolean(e,n){n.length&&this.writeMessage(e,pg,n)}writePackedFloat(e,n){n.length&&this.writeMessage(e,I_,n)}writePackedDouble(e,n){n.length&&this.writeMessage(e,dg,n)}writePackedFixed32(e,n){n.length&&this.writeMessage(e,lf,n)}writePackedSFixed32(e,n){n.length&&this.writeMessage(e,Xd,n)}writePackedFixed64(e,n){n.length&&this.writeMessage(e,mg,n)}writePackedSFixed64(e,n){n.length&&this.writeMessage(e,gg,n)}writeBytesField(e,n){this.writeTag(e,2),this.writeBytes(n)}writeFixed32Field(e,n){this.writeTag(e,5),this.writeFixed32(n)}writeSFixed32Field(e,n){this.writeTag(e,5),this.writeSFixed32(n)}writeFixed64Field(e,n){this.writeTag(e,1),this.writeFixed64(n)}writeSFixed64Field(e,n){this.writeTag(e,1),this.writeSFixed64(n)}writeVarintField(e,n){this.writeTag(e,0),this.writeVarint(n)}writeSVarintField(e,n){this.writeTag(e,0),this.writeSVarint(n)}writeStringField(e,n){this.writeTag(e,2),this.writeString(n)}writeFloatField(e,n){this.writeTag(e,5),this.writeFloat(n)}writeDoubleField(e,n){this.writeTag(e,1),this.writeDouble(n)}writeBooleanField(e,n){this.writeVarintField(e,+n)}}function Pu(i,e,n){return n?4294967296*e+(i>>>0):4294967296*(e>>>0)+(i>>>0)}function Hd(i,e,n){const l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(l);for(let f=n.pos-1;f>=i;f--)n.buf[f+l]=n.buf[f]}function M_(i,e){for(let n=0;n<i.length;n++)e.writeVarint(i[n])}function C_(i,e){for(let n=0;n<i.length;n++)e.writeSVarint(i[n])}function I_(i,e){for(let n=0;n<i.length;n++)e.writeFloat(i[n])}function dg(i,e){for(let n=0;n<i.length;n++)e.writeDouble(i[n])}function pg(i,e){for(let n=0;n<i.length;n++)e.writeBoolean(i[n])}function lf(i,e){for(let n=0;n<i.length;n++)e.writeFixed32(i[n])}function Xd(i,e){for(let n=0;n<i.length;n++)e.writeSFixed32(i[n])}function mg(i,e){for(let n=0;n<i.length;n++)e.writeFixed64(i[n])}function gg(i,e){for(let n=0;n<i.length;n++)e.writeSFixed64(i[n])}function _g(i,e,n){i===1&&n.readMessage(yg,e)}function yg(i,e,n){if(i===3){const{id:l,bitmap:f,width:m,height:y,left:w,top:E,advance:R}=n.readMessage(vg,{});e.push({id:l,bitmap:new Qh({width:m+6,height:y+6},f),metrics:{width:m,height:y,left:w,top:E,advance:R}})}}function vg(i,e,n){i===1?e.id=n.readVarint():i===2?e.bitmap=n.readBytes():i===3?e.width=n.readVarint():i===4?e.height=n.readVarint():i===5?e.left=n.readSVarint():i===6?e.top=n.readSVarint():i===7&&(e.advance=n.readVarint())}function om(i){let e=0,n=0;for(const y of i)e+=y.w*y.h,n=Math.max(n,y.w);i.sort(((y,w)=>w.h-y.h));const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let f=0,m=0;for(const y of i)for(let w=l.length-1;w>=0;w--){const E=l[w];if(!(y.w>E.w||y.h>E.h)){if(y.x=E.x,y.y=E.y,m=Math.max(m,y.y+y.h),f=Math.max(f,y.x+y.w),y.w===E.w&&y.h===E.h){const R=l.pop();R&&w<l.length&&(l[w]=R)}else y.h===E.h?(E.x+=y.w,E.w-=y.w):y.w===E.w?(E.y+=y.h,E.h-=y.h):(l.push({x:E.x+y.w,y:E.y,w:E.w-y.w,h:y.h}),E.y+=y.h,E.h-=y.h);break}}return{w:f,h:m,fill:e/(f*m)||0}}class uf{constructor(e,{pixelRatio:n,version:l,stretchX:f,stretchY:m,content:y,textFitWidth:w,textFitHeight:E}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=f,this.stretchY=m,this.content=y,this.version=l,this.textFitWidth=w,this.textFitHeight=E}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class lm{constructor(e,n){const l={},f={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,l,m),this.addImages(n,f,m);const{w:y,h:w}=om(m),E=new br({width:y||1,height:w||1});for(const R in e){const N=e[R],j=l[R].paddedRect;br.copy(N.data,E,{x:0,y:0},{x:j.x+1,y:j.y+1},N.data)}for(const R in n){const N=n[R],j=f[R].paddedRect,q=j.x+1,Z=j.y+1,$=N.data.width,Q=N.data.height;br.copy(N.data,E,{x:0,y:0},{x:q,y:Z},N.data),br.copy(N.data,E,{x:0,y:Q-1},{x:q,y:Z-1},{width:$,height:1}),br.copy(N.data,E,{x:0,y:0},{x:q,y:Z+Q},{width:$,height:1}),br.copy(N.data,E,{x:$-1,y:0},{x:q-1,y:Z},{width:1,height:Q}),br.copy(N.data,E,{x:0,y:0},{x:q+$,y:Z},{width:1,height:Q})}this.image=E,this.iconPositions=l,this.patternPositions=f}addImages(e,n,l){for(const f in e){const m=e[f],y={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(y),n[f]=new uf(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(f)}}patchUpdatedImages(e,n){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),n)}patchUpdatedImage(e,n,l){if(!e||!n||e.version===n.version)return;e.version=n.version;const[f,m]=e.tl;l.update(n.data,void 0,{x:f,y:m})}}var Ru;function xi(i,e,n,l,f,m,y,w,E,R,N,j,q,Z,$){const Q=pl.fromFeature(i,f);let ee;j===L.aA.vertical&&Q.verticalizePunctuation();let se=Q.determineLineBreaks(R,m,e,l,Z);const{processBidirectionalText:Te,processStyledBidirectionalText:ue}=Js;if(Te&&Q.sections.length===1){ee=[],se=se.map((ot=>Q.toCodeUnitIndex(ot)));const ze=Te(Q.toString(),se);for(const ot of ze){const Et=[...ot].map((()=>0));ee.push(new pl(ot,Q.sections,Et))}}else if(ue){ee=[],se=se.map((xt=>Q.toCodeUnitIndex(xt)));let ze=0;const ot=[];for(const xt of Q.text)ot.push(...Array(xt.length).fill(Q.sectionIndex[ze])),ze++;const Et=ue(Q.text,ot,se);for(const xt of Et){const Lt=[];let Ht="";for(const zt of xt[0])Lt.push(xt[1][Ht.length]),Ht+=zt;ee.push(new pl(xt[0],Q.sections,Lt))}}else ee=(function(ze,ot){const Et=[];let xt=0;for(const Lt of ot)Et.push(ze.substring(xt,Lt)),xt=Lt;return xt<ze.length()&&Et.push(ze.substring(xt,ze.length())),Et})(Q,se);const pe=[],ke={positionedLines:pe,text:Q.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:j,iconsInText:!1,verticalizable:!1};return(function(ze,ot,Et,xt,Lt,Ht,zt,Tt,mt,en,Kt,nn){let $t=0,hn=0,ti=0,Gn=0;const lr=Tt==="right"?1:Tt==="left"?0:.5,is=vi/nn;let la=0;for(const wi of Lt){wi.trim();const wr=wi.getMaxScale(),Or={positionedGlyphs:[],lineOffset:0};ze.positionedLines[la]=Or;const Yi=Or.positionedGlyphs;let lo=0;if(!wi.length()){hn+=Ht,++la;continue}const rs=A_(xt,wi,is);let uo=0;for(const Ma of wi.text){const mr=wi.getSection(uo),ua=Ma.codePointAt(0),Tr=k_(mt,Kt,ua),Ca={glyph:ua,imageName:null,x:$t,y:hn+-17,vertical:Tr,scale:1,fontStack:"",sectionIndex:wi.getSectionIndex(uo),metrics:null,rect:null};let _h;if("fontStack"in mr){if(_h=P_(mr,ua,Tr,rs,ot,Et),!_h)continue;Ca.fontStack=mr.fontStack}else{if(ze.iconsInText=!0,mr.scale*=is,_h=R_(mr,Tr,wr,rs,xt),!_h)continue;lo=Math.max(lo,_h.imageOffset),Ca.imageName=mr.imageName}const{rect:Fu,metrics:zm,baselineOffset:Sf}=_h;Ca.y+=Sf,Ca.scale=mr.scale,Ca.metrics=zm,Ca.rect=Fu,Yi.push(Ca),Tr?(ze.verticalizable=!0,$t+=("imageName"in mr?zm.advance:vi)*mr.scale+en):$t+=zm.advance*mr.scale+en,uo++}Yi.length!==0&&(ti=Math.max($t-en,ti),$d(Yi,0,Yi.length-1,lr)),$t=0,Or.lineOffset=Math.max(lo,(wr-1)*vi);const Xl=Ht*wr+lo;hn+=Xl,Gn=Math.max(Xl,Gn),++la}const{horizontalAlign:ur,verticalAlign:nr}=rd(zt);(function(wi,wr,Or,Yi,lo,rs,uo,Xl,Ma){const mr=(wr-Or)*lo;let ua=0;ua=rs!==uo?-Xl*Yi- -17:-Yi*Ma*uo+.5*uo;for(const Tr of wi)for(const Ca of Tr.positionedGlyphs)Ca.x+=mr,Ca.y+=ua})(ze.positionedLines,lr,ur,nr,ti,Gn,Ht,hn,Lt.length),ze.top+=-nr*hn,ze.bottom=ze.top+hn,ze.left+=-ur*ti,ze.right=ze.left+ti})(ke,e,n,l,ee,y,w,E,j,R,q,$),!(function(ze){for(const ot of ze)if(ot.positionedGlyphs.length!==0)return!1;return!0})(pe)&&ke}function rd(i){let e=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function A_(i,e,n){const l=e.getMaxScale()*vi,{maxImageWidth:f,maxImageHeight:m}=e.getMaxImageSize(i),y=Math.max(l,m*n);return{verticalLineContentWidth:Math.max(l,f*n),horizontalLineContentHeight:y}}function um(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function k_(i,e,n){return!(i===L.aA.horizontal||!e&&!Uh(n)||e&&(Lf(n)||(l=n,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(l)))));var l}function P_(i,e,n,l,f,m){const y=m[i.fontStack],w=(function(R,N,j,q){if(R&&R.rect)return R;const Z=N[j.fontStack],$=Z&&Z[q];return $?{rect:null,metrics:$.metrics}:null})(y&&y[e],f,i,e);if(w===null)return null;let E;if(n)E=l.verticalLineContentWidth-i.scale*vi;else{const R=um(i.verticalAlign);E=(l.horizontalLineContentHeight-i.scale*vi)*R}return{rect:w.rect,metrics:w.metrics,baselineOffset:E}}function R_(i,e,n,l,f){const m=f[i.imageName];if(!m)return null;const y=m.paddedRect,w=m.displaySize,E={width:w[0],height:w[1],left:1,top:-3,advance:e?w[1]:w[0]};let R;if(e)R=l.verticalLineContentWidth-w[1]*i.scale;else{const N=um(i.verticalAlign);R=(l.horizontalLineContentHeight-w[1]*i.scale)*N}return{rect:y,metrics:E,baselineOffset:R,imageOffset:(e?w[0]:w[1])*i.scale-vi*n}}function $d(i,e,n,l){if(l===0)return;const f=i[n],m=(i[n].x+f.metrics.advance*f.scale)*l;for(let y=e;y<=n;y++)i[y].x-=m}function cf(i,e,n){const{horizontalAlign:l,verticalAlign:f}=rd(n),m=e[0]-i.displaySize[0]*l,y=e[1]-i.displaySize[1]*f;return{image:i,top:y,bottom:y+i.displaySize[1],left:m,right:m+i.displaySize[0]}}function Wd(i){var e,n;let l=i.left,f=i.top,m=i.right-l,y=i.bottom-f;const w=(e=i.image.textFitWidth)!==null&&e!==void 0?e:"stretchOrShrink",E=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",R=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(E==="proportional"){if(w==="stretchOnly"&&m/y<R||w==="proportional"){const N=Math.ceil(y*R);l*=N/m,m=N}}else if(w==="proportional"&&E==="stretchOnly"&&R!==0&&m/y>R){const N=Math.ceil(m/R);f*=N/y,y=N}return{x1:l,y1:f,x2:l+m,y2:f+y}}function ad(i,e,n,l,f,m){const y=i.image;let w;if(y.content){const ee=y.content,se=y.pixelRatio||1;w=[ee[0]/se,ee[1]/se,y.displaySize[0]-ee[2]/se,y.displaySize[1]-ee[3]/se]}const E=e.left*m,R=e.right*m;let N,j,q,Z;n==="width"||n==="both"?(Z=f[0]+E-l[3],j=f[0]+R+l[1]):(Z=f[0]+(E+R-y.displaySize[0])/2,j=Z+y.displaySize[0]);const $=e.top*m,Q=e.bottom*m;return n==="height"||n==="both"?(N=f[1]+$-l[0],q=f[1]+Q+l[2]):(N=f[1]+($+Q-y.displaySize[1])/2,q=N+y.displaySize[1]),{image:y,top:N,right:j,bottom:q,left:Z,collisionPadding:w}}Xt("ImagePosition",uf),Xt("ImageAtlas",lm),L.aA=void 0,(Ru=L.aA||(L.aA={}))[Ru.none=0]="none",Ru[Ru.horizontal=1]="horizontal",Ru[Ru.vertical=2]="vertical",Ru[Ru.horizontalOnly=3]="horizontalOnly";const ml=128,bs=32640;function gl(i,e){const{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Hn(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:f}=n;let m=0;for(;m<l.length&&l[m]<=i;)m++;m=Math.max(0,m-1);let y=m;for(;y<l.length&&l[y]<i+1;)y++;y=Math.min(l.length-1,y);const w=l[m],E=l[y];return n.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:E,minSize:n.evaluate(new Hn(w)),maxSize:n.evaluate(new Hn(E)),interpolationType:f}}}function fh(i,e,n){let l="never";const f=i.get(e);return f?l=f:i.get(n)&&(l="always"),l}const D_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sd(i,e,n,l,f,m,y,w,E,R,N,j,q){const Z=w?Math.min(bs,Math.round(w[0])):0,$=w?Math.min(bs,Math.round(w[1])):0;i.emplaceBack(e,n,Math.round(32*l),Math.round(32*f),m,y,(Z<<1)+(E?1:0),$,16*R,16*N,256*j,256*q)}function Kd(i,e,n){i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n),i.emplaceBack(e.x,e.y,n)}function xg(i){for(const e of i.sections)if(qh(e.text))return!0;return!1}class Qd{constructor(e){this.layoutVertexArray=new we,this.indexArray=new ht,this.programConfigurations=e,this.segments=new Dt,this.dynamicLayoutVertexArray=new Oe,this.opacityVertexArray=new je,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,n,l,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ku.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,em.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,D_,!0),this.opacityVertexBuffer.itemSize=1),(l||f)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Xt("SymbolBuffers",Qd);class cm{constructor(e,n,l){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new l,this.segments=new Dt,this.collisionVertexArray=new $e}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,tm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Xt("CollisionBuffers",cm);class vc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((y=>y.id)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=gl(this.zoom,n["text-size"]),this.iconSizeData=gl(this.zoom,n["icon-size"]);const l=this.layers[0].layout,f=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=fh(l,"text-overlap","text-allow-overlap")!=="never"||fh(l,"icon-overlap","icon-allow-overlap")!=="never"||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!f.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,l.get("symbol-placement")==="point"&&(this.writingModes=l.get("text-writing-mode").map((y=>L.aA[y]))),this.stateDependentLayerIds=this.layers.filter((y=>y.isStateDependent())).map((y=>y.id)),this.sourceID=e.sourceID}createArrays(){this.text=new Qd(new Gi(this.layers,this.zoom,(e=>/^text/.test(e)))),this.icon=new Qd(new Gi(this.layers,this.zoom,(e=>/^icon/.test(e)))),this.glyphOffsetArray=new T,this.lineVertexArray=new k,this.symbolInstances=new b,this.textAnchorOffsets=new F}calculateGlyphDependencies(e,n,l,f,m){for(const y of e)if(n[y.codePointAt(0)]=!0,(l||f)&&m){const w=of[y];w&&(n[w.codePointAt(0)]=!0)}}populate(e,n,l){const f=this.layers[0],m=f.layout,y=m.get("text-font"),w=m.get("text-field"),E=m.get("icon-image"),R=(w.value.kind!=="constant"||w.value.value instanceof $i&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),N=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,j=m.get("symbol-sort-key");if(this.features=[],!R&&!N)return;const q=n.iconDependencies,Z=n.glyphDependencies,$=n.availableImages,Q=new Hn(this.zoom);for(const{feature:ee,id:se,index:Te,sourceLayerIndex:ue}of e){const pe=f._featureFilter.needGeometry,ke=Gl(ee,pe);if(!f._featureFilter.filter(Q,ke,l))continue;let ze,ot;if(pe||(ke.geometry=xs(ee)),R){const xt=f.getValueAndResolveTokens("text-field",ke,l,$),Lt=$i.factory(xt),Ht=this.hasRTLText=this.hasRTLText||xg(Lt);(!Ht||Js.getRTLTextPluginStatus()==="unavailable"||Ht&&Js.isParsed())&&(ze=im(Lt,f,ke))}if(N){const xt=f.getValueAndResolveTokens("icon-image",ke,l,$);ot=xt instanceof kn?xt:kn.fromString(xt)}if(!ze&&!ot)continue;const Et=this.sortFeaturesByKey?j.evaluate(ke,{},l):void 0;if(this.features.push({id:se,text:ze,icon:ot,index:Te,sourceLayerIndex:ue,geometry:ke.geometry,properties:ee.properties,type:Iu.types[ee.type],sortKey:Et}),ot&&(q[ot.name]=!0),ze){const xt=y.evaluate(ke,{},l).join(","),Lt=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(L.aA.vertical)>=0;for(const Ht of ze.sections)if(Ht.image)q[Ht.image.name]=!0;else{const zt=Ns(ze.toString()),Tt=Ht.fontStack||xt,mt=Z[Tt]=Z[Tt]||{};this.calculateGlyphDependencies(Ht.text,mt,Lt,this.allowVerticalPlacement,zt)}}}m.get("symbol-placement")==="line"&&(this.features=(function(ee){const se={},Te={},ue=[];let pe=0;function ke(xt){ue.push(ee[xt]),pe++}function ze(xt,Lt,Ht){const zt=Te[xt];return delete Te[xt],Te[Lt]=zt,ue[zt].geometry[0].pop(),ue[zt].geometry[0]=ue[zt].geometry[0].concat(Ht[0]),zt}function ot(xt,Lt,Ht){const zt=se[Lt];return delete se[Lt],se[xt]=zt,ue[zt].geometry[0].shift(),ue[zt].geometry[0]=Ht[0].concat(ue[zt].geometry[0]),zt}function Et(xt,Lt,Ht){const zt=Ht?Lt[0][Lt[0].length-1]:Lt[0][0];return`${xt}:${zt.x}:${zt.y}`}for(let xt=0;xt<ee.length;xt++){const Lt=ee[xt],Ht=Lt.geometry,zt=Lt.text?Lt.text.toString():null;if(!zt){ke(xt);continue}const Tt=Et(zt,Ht),mt=Et(zt,Ht,!0);if(Tt in Te&&mt in se&&Te[Tt]!==se[mt]){const en=ot(Tt,mt,Ht),Kt=ze(Tt,mt,ue[en].geometry);delete se[Tt],delete Te[mt],Te[Et(zt,ue[Kt].geometry,!0)]=Kt,ue[en].geometry=null}else Tt in Te?ze(Tt,mt,Ht):mt in se?ot(Tt,mt,Ht):(ke(xt),se[Tt]=pe-1,Te[mt]=pe-1)}return ue.filter((xt=>xt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((ee,se)=>ee.sortKey-se.sortKey))}update(e,n,l){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,{imagePositions:l}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const l=this.lineVertexArray.length;if(e.segment!==void 0){let f=e.dist(n[e.segment+1]),m=e.dist(n[e.segment]);const y={};for(let w=e.segment+1;w<n.length;w++)y[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:f},w<n.length-1&&(f+=n[w+1].dist(n[w]));for(let w=e.segment||0;w>=0;w--)y[w]={x:n[w].x,y:n[w].y,tileUnitDistanceFromAnchor:m},w>0&&(m+=n[w-1].dist(n[w]));for(let w=0;w<n.length;w++){const E=y[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,n,l,f,m,y,w,E,R,N,j,q){const Z=e.indexArray,$=e.layoutVertexArray,Q=e.segments.prepareSegment(4*n.length,$,Z,this.canOverlap?y.sortKey:void 0),ee=this.glyphOffsetArray.length,se=Q.vertexLength,Te=this.allowVerticalPlacement&&w===L.aA.vertical?Math.PI/2:0,ue=y.text&&y.text.sections;for(let pe=0;pe<n.length;pe++){const{tl:ke,tr:ze,bl:ot,br:Et,tex:xt,pixelOffsetTL:Lt,pixelOffsetBR:Ht,minFontScaleX:zt,minFontScaleY:Tt,glyphOffset:mt,isSDF:en,sectionIndex:Kt}=n[pe],nn=Q.vertexLength,$t=mt[1];sd($,E.x,E.y,ke.x,$t+ke.y,xt.x,xt.y,l,en,Lt.x,Lt.y,zt,Tt),sd($,E.x,E.y,ze.x,$t+ze.y,xt.x+xt.w,xt.y,l,en,Ht.x,Lt.y,zt,Tt),sd($,E.x,E.y,ot.x,$t+ot.y,xt.x,xt.y+xt.h,l,en,Lt.x,Ht.y,zt,Tt),sd($,E.x,E.y,Et.x,$t+Et.y,xt.x+xt.w,xt.y+xt.h,l,en,Ht.x,Ht.y,zt,Tt),Kd(e.dynamicLayoutVertexArray,E,Te),Z.emplaceBack(nn,nn+2,nn+1),Z.emplaceBack(nn+1,nn+2,nn+3),Q.vertexLength+=4,Q.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(mt[0]),pe!==n.length-1&&Kt===n[pe+1].sectionIndex||e.programConfigurations.populatePaintArrays($.length,y,y.index,{imagePositions:{},canonical:q,formattedSection:ue&&ue[Kt]})}e.placedSymbolArray.emplaceBack(E.x,E.y,ee,this.glyphOffsetArray.length-ee,se,R,N,E.segment,l?l[0]:0,l?l[1]:0,f[0],f[1],w,0,!1,0,j)}_addCollisionDebugVertex(e,n,l,f,m,y){return n.emplaceBack(0,0),e.emplaceBack(l.x,l.y,f,m,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,n,l,f,m,y,w){const E=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),R=E.vertexLength,N=m.layoutVertexArray,j=m.collisionVertexArray,q=w.anchorX,Z=w.anchorY;this._addCollisionDebugVertex(N,j,y,q,Z,new X(e,n)),this._addCollisionDebugVertex(N,j,y,q,Z,new X(l,n)),this._addCollisionDebugVertex(N,j,y,q,Z,new X(l,f)),this._addCollisionDebugVertex(N,j,y,q,Z,new X(e,f)),E.vertexLength+=4;const $=m.indexArray;$.emplaceBack(R,R+1),$.emplaceBack(R+1,R+2),$.emplaceBack(R+2,R+3),$.emplaceBack(R+3,R),E.primitiveLength+=4}addDebugCollisionBoxes(e,n,l,f){for(let m=e;m<n;m++){const y=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,f?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,l)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new cm(Ae,nm.members,st),this.iconCollisionBox=new cm(Ae,nm.members,st);for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(e,n,l,f,m,y,w,E,R){const N={};for(let j=n;j<l;j++){const q=e.get(j);N.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},N.textFeatureIndex=q.featureIndex;break}for(let j=f;j<m;j++){const q=e.get(j);N.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},N.verticalTextFeatureIndex=q.featureIndex;break}for(let j=y;j<w;j++){const q=e.get(j);N.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},N.iconFeatureIndex=q.featureIndex;break}for(let j=E;j<R;j++){const q=e.get(j);N.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},N.verticalIconFeatureIndex=q.featureIndex;break}return N}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const l=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const l=e.placedSymbolArray.get(n),f=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<f;m+=4)e.indexArray.emplaceBack(m,m+2,m+1),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(e),l=Math.cos(e),f=[],m=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const E=this.symbolInstances.get(w);f.push(0|Math.round(n*E.anchorX+l*E.anchorY)),m.push(E.featureIndex)}return y.sort(((w,E)=>f[w]-f[E]||m[E]-m[w])),y}addToSortKeyRanges(e,n){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===n?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const l=this.symbolInstances.get(n);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach(((f,m,y)=>{f>=0&&y.indexOf(f)===m&&this.addIndicesForPlacedSymbol(this.text,f)})),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let hm,fm;Xt("SymbolBucket",vc,{omit:["layers","collisionBoxArray","features","compareText"]}),vc.MAX_GLYPHS=65535,vc.addDynamicAttributes=Kd;var dm={get paint(){return fm=fm||new fr({"icon-opacity":new mn(it.paint_symbol["icon-opacity"]),"icon-color":new mn(it.paint_symbol["icon-color"]),"icon-halo-color":new mn(it.paint_symbol["icon-halo-color"]),"icon-halo-width":new mn(it.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mn(it.paint_symbol["icon-halo-blur"]),"icon-translate":new on(it.paint_symbol["icon-translate"]),"icon-translate-anchor":new on(it.paint_symbol["icon-translate-anchor"]),"text-opacity":new mn(it.paint_symbol["text-opacity"]),"text-color":new mn(it.paint_symbol["text-color"],{runtimeType:yr,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new mn(it.paint_symbol["text-halo-color"]),"text-halo-width":new mn(it.paint_symbol["text-halo-width"]),"text-halo-blur":new mn(it.paint_symbol["text-halo-blur"]),"text-translate":new on(it.paint_symbol["text-translate"]),"text-translate-anchor":new on(it.paint_symbol["text-translate-anchor"])})},get layout(){return hm=hm||new fr({"symbol-placement":new on(it.layout_symbol["symbol-placement"]),"symbol-spacing":new on(it.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new on(it.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mn(it.layout_symbol["symbol-sort-key"]),"symbol-z-order":new on(it.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new on(it.layout_symbol["icon-allow-overlap"]),"icon-overlap":new on(it.layout_symbol["icon-overlap"]),"icon-ignore-placement":new on(it.layout_symbol["icon-ignore-placement"]),"icon-optional":new on(it.layout_symbol["icon-optional"]),"icon-rotation-alignment":new on(it.layout_symbol["icon-rotation-alignment"]),"icon-size":new mn(it.layout_symbol["icon-size"]),"icon-text-fit":new on(it.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new on(it.layout_symbol["icon-text-fit-padding"]),"icon-image":new mn(it.layout_symbol["icon-image"]),"icon-rotate":new mn(it.layout_symbol["icon-rotate"]),"icon-padding":new mn(it.layout_symbol["icon-padding"]),"icon-keep-upright":new on(it.layout_symbol["icon-keep-upright"]),"icon-offset":new mn(it.layout_symbol["icon-offset"]),"icon-anchor":new mn(it.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new on(it.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new on(it.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new on(it.layout_symbol["text-rotation-alignment"]),"text-field":new mn(it.layout_symbol["text-field"]),"text-font":new mn(it.layout_symbol["text-font"]),"text-size":new mn(it.layout_symbol["text-size"]),"text-max-width":new mn(it.layout_symbol["text-max-width"]),"text-line-height":new on(it.layout_symbol["text-line-height"]),"text-letter-spacing":new mn(it.layout_symbol["text-letter-spacing"]),"text-justify":new mn(it.layout_symbol["text-justify"]),"text-radial-offset":new mn(it.layout_symbol["text-radial-offset"]),"text-variable-anchor":new on(it.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new mn(it.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new mn(it.layout_symbol["text-anchor"]),"text-max-angle":new on(it.layout_symbol["text-max-angle"]),"text-writing-mode":new on(it.layout_symbol["text-writing-mode"]),"text-rotate":new mn(it.layout_symbol["text-rotate"]),"text-padding":new on(it.layout_symbol["text-padding"]),"text-keep-upright":new on(it.layout_symbol["text-keep-upright"]),"text-transform":new mn(it.layout_symbol["text-transform"]),"text-offset":new mn(it.layout_symbol["text-offset"]),"text-allow-overlap":new on(it.layout_symbol["text-allow-overlap"]),"text-overlap":new on(it.layout_symbol["text-overlap"]),"text-ignore-placement":new on(it.layout_symbol["text-ignore-placement"]),"text-optional":new on(it.layout_symbol["text-optional"])})}};class Jd{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:di,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xt("FormatSectionOverride",Jd,{omit:["defaultValue"]});class hf extends Ba{constructor(e,n){super(e,dm,n)}recalculate(e,n){if(super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const l=this.layout.get("text-writing-mode");if(l){const f=[];for(const m of l)f.indexOf(m)<0&&f.push(m);this.layout._values["text-writing-mode"]=f}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,n,l,f){const m=this.layout.get(e).evaluate(n,{},l,f),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Pl(y.value)||!m?m:(function(w,E){return E.replace(/{([^{}]+)}/g,((R,N)=>w&&N in w?String(w[N]):""))})(n.properties,m)}createBucket(e){return new vc(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of dm.paint.overridableProperties){if(!hf.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),l=new Jd(n),f=new Oh(l,n.property.specification);let m=null;m=n.value.kind==="constant"||n.value.kind==="source"?new La("source",f):new Rl("composite",f,n.value.zoomStops),this.paint._values[e]=new Oa(n.property,m,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,l){return!(!this.layout||n.isDataDriven()||l.isDataDriven())&&hf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const l=e.get("text-field"),f=dm.paint.properties[n];let m=!1;const y=w=>{for(const E of w)if(f.overrides&&f.overrides.hasOverride(E))return void(m=!0)};if(l.value.kind==="constant"&&l.value.value instanceof $i)y(l.value.value.sections);else if(l.value.kind==="source"||l.value.kind==="composite"){const w=R=>{m||(R instanceof Si&&ci(R.value)===pi?y(R.value.sections):R instanceof $s?y(R.sections):R.eachChild(w))},E=l.value;E._styleExpression&&w(E._styleExpression.expression)}return m}}let bg;var L_={get paint(){return bg=bg||new fr({"background-color":new on(it.paint_background["background-color"]),"background-pattern":new Na(it.paint_background["background-pattern"]),"background-opacity":new on(it.paint_background["background-opacity"])})}};class od extends Ba{constructor(e,n){super(e,L_,n)}}class z_ extends Ba{constructor(e,n){super(e,{},n),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class wg{constructor(e){this._methodToThrottle=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Jn={once:!0},ld=63710088e-1;class _l{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _l(_n(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,l=this.lat*n,f=e.lat*n,m=Math.sin(l)*Math.sin(f)+Math.cos(l)*Math.cos(f)*Math.cos((e.lng-this.lng)*n);return ld*Math.acos(Math.min(m,1))}static convert(e){if(e instanceof _l)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new _l(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new _l(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ep=2*Math.PI*ld;function pm(i){return ep*Math.cos(i*Math.PI/180)}function tp(i){return(180+i)/360}function ff(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function ud(i,e){return i/pm(e)}function Tg(i){return 360*i-180}function cd(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function Sg(i,e){return i*pm(cd(e))}class hd{constructor(e,n,l=0){this.x=+e,this.y=+n,this.z=+l}static fromLngLat(e,n=0){const l=_l.convert(e);return new hd(tp(l.lng),ff(l.lat),ud(n,l.lat))}toLngLat(){return new _l(Tg(this.x),cd(this.y))}toAltitude(){return Sg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ep*(e=cd(this.y),1/Math.cos(e*Math.PI/180));var e}}function mm(i,e,n){var l=2*Math.PI*6378137/256/Math.pow(2,n);return[i*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class np{constructor(e,n,l){if(!(function(f,m,y){return!(f<0||f>25||y<0||y>=Math.pow(2,f)||m<0||m>=Math.pow(2,f))})(e,n,l))throw new Error(`x=${n}, y=${l}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=n,this.y=l,this.key=zr(0,e,e,n,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n,l){const f=(function(y,w,E){var R=mm(256*y,256*(w=Math.pow(2,E)-w-1),E),N=mm(256*(y+1),256*(w+1),E);return R[0]+","+R[1]+","+N[0]+","+N[1]})(this.x,this.y,this.z),m=(function(y,w,E){let R,N="";for(let j=y;j>0;j--)R=1<<j-1,N+=(w&R?1:0)+(E&R?2:0);return N})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(l==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,m).replace(/{bbox-epsg-3857}/g,f)}isChildOf(e){const n=this.z-e.z;return n>0&&e.x===this.x>>n&&e.y===this.y>>n}getTilePoint(e){const n=Math.pow(2,this.z);return new X((e.x*n-this.x)*tt,(e.y*n-this.y)*tt)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oi{constructor(e,n){this.wrap=e,this.canonical=n,this.key=zr(e,n.z,n.z,n.x,n.y)}}class ws{constructor(e,n,l,f,m){if(this.terrainRttPosMatrix32f=null,e<l)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${l}`);this.overscaledZ=e,this.wrap=n,this.canonical=new np(l,+f,+m),this.key=zr(n,e,l,f,m)}clone(){return new ws(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-e;return e>this.canonical.z?new ws(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ws(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(e,n){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-e;return e>this.canonical.z?zr(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y):zr(this.wrap*+n,e,e,this.canonical.x>>l,this.canonical.y>>l)}isChildOf(e){if(e.wrap!==this.wrap||this.overscaledZ-e.overscaledZ<=0)return!1;if(e.overscaledZ===0)return this.overscaledZ>0;const n=this.canonical.z-e.canonical.z;return!(n<0)&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ws(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,l=2*this.canonical.x,f=2*this.canonical.y;return[new ws(n,this.wrap,n,l,f),new ws(n,this.wrap,n,l+1,f),new ws(n,this.wrap,n,l,f+1),new ws(n,this.wrap,n,l+1,f+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ws(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ws(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new hd(e.x-this.wrap,e.y))}}function zr(i,e,n,l,f){(i*=2)<0&&(i=-1*i-1);const m=1<<n;return(m*m*i+m*f+l).toString(36)+n.toString(36)+e.toString(36)}function fd(i,e){return e?i.properties[e]:i.id}function Eg(i,e){const n={id:i.id};if(e.removeAllProperties&&(delete i.removeProperties,delete i.addOrUpdateProperties,delete e.removeProperties),e.removeProperties)for(const l of e.removeProperties){const f=i.addOrUpdateProperties.findIndex((m=>m.key===l));f>-1&&i.addOrUpdateProperties.splice(f,1)}return(i.removeAllProperties||e.removeAllProperties)&&(n.removeAllProperties=!0),(i.removeProperties||e.removeProperties)&&(n.removeProperties=[...i.removeProperties||[],...e.removeProperties||[]]),(i.addOrUpdateProperties||e.addOrUpdateProperties)&&(n.addOrUpdateProperties=[...i.addOrUpdateProperties||[],...e.addOrUpdateProperties||[]]),(i.newGeometry||e.newGeometry)&&(n.newGeometry=e.newGeometry||i.newGeometry),n}function Mg(i){var e,n;if(!i)return{};const l={};return l.removeAll=i.removeAll,l.remove=new Set(i.remove||[]),l.add=new Map((e=i.add)===null||e===void 0?void 0:e.map((f=>[f.id,f]))),l.update=new Map((n=i.update)===null||n===void 0?void 0:n.map((f=>[f.id,f]))),l}Xt("CanonicalTileID",np),Xt("OverscaledTileID",ws,{omit:["terrainRttPosMatrix32f"]});class ip{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const l=e[n];this._stringToNumber[l]=n,this._numberToString[n]=l}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class rp{constructor(e,n,l,f,m){this.type="Feature",this._vectorTileFeature=e,this._x=l,this._y=f,this._z=n,this.properties=e.properties,this.id=m}projectPoint(e,n,l,f){return[360*(e.x+n)/f-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+l)/f)*Math.PI))-90]}projectLine(e,n,l,f){return e.map((m=>this.projectPoint(m,n,l,f)))}get geometry(){if(this._geometry)return this._geometry;const e=this._vectorTileFeature,n=e.extent*Math.pow(2,this._z),l=e.extent*this._x,f=e.extent*this._y,m=e.loadGeometry();switch(e.type){case 1:{const y=[];for(const E of m)y.push(E[0]);const w=this.projectLine(y,l,f,n);this._geometry=y.length===1?{type:"Point",coordinates:w[0]}:{type:"MultiPoint",coordinates:w};break}case 2:{const y=m.map((w=>this.projectLine(w,l,f,n)));this._geometry=y.length===1?{type:"LineString",coordinates:y[0]}:{type:"MultiLineString",coordinates:y};break}case 3:{const y=Kf(m),w=[];for(const E of y)w.push(E.map((R=>this.projectLine(R,l,f,n))));this._geometry=w.length===1?{type:"Polygon",coordinates:w[0]}:{type:"MultiPolygon",coordinates:w};break}default:throw new Error(`unknown feature type: ${e.type}`)}return this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&n!=="_x"&&n!=="_y"&&n!=="_z"&&(e[n]=this[n]);return e}}class Du{_name;dataBuffer;nullabilityBuffer;_size;constructor(e,n,l){this._name=e,this.dataBuffer=n,typeof l=="number"?this._size=l:(this.nullabilityBuffer=l,this._size=l.size())}getValue(e){return this.nullabilityBuffer&&!this.nullabilityBuffer.get(e)?null:this.getValueFromBuffer(e)}has(e){return this.nullabilityBuffer&&this.nullabilityBuffer.get(e)||!this.nullabilityBuffer}get name(){return this._name}get size(){return this._size}}class dd extends Du{}class ap extends dd{getValueFromBuffer(e){return this.dataBuffer[e]}}class pd extends dd{getValueFromBuffer(e){return this.dataBuffer[e]}}class sp extends Du{delta;constructor(e,n,l,f){super(e,n,f),this.delta=l}}class gm extends sp{constructor(e,n,l,f){super(e,Int32Array.of(n),l,f)}getValueFromBuffer(e){return this.dataBuffer[0]+e*this.delta}}class op extends Du{constructor(e,n,l){super(e,Int32Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}class O_{_name;_geometryVector;_idVector;_propertyVectors;_extent;propertyVectorsMap;constructor(e,n,l,f,m=4096){this._name=e,this._geometryVector=n,this._idVector=l,this._propertyVectors=f,this._extent=m}get name(){return this._name}get idVector(){return this._idVector}get geometryVector(){return this._geometryVector}get propertyVectors(){return this._propertyVectors}getPropertyVector(e){return this.propertyVectorsMap||(this.propertyVectorsMap=new Map(this._propertyVectors.map((n=>[n.name,n])))),this.propertyVectorsMap.get(e)}*[Symbol.iterator](){const e=this.geometryVector[Symbol.iterator]();let n=0;for(;n<this.numFeatures;){let l;this.idVector&&(l=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(n)):this.idVector.getValue(n));const f=e?.next().value,m={};for(const y of this.propertyVectors){if(!y)continue;const w=y.name,E=y.getValue(n);E!==null&&(m[w]=E)}n++,yield{id:l,geometry:f,properties:m}}}get numFeatures(){return this.geometryVector.numGeometries}get extent(){return this._extent}getFeatures(){const e=[],n=this.geometryVector.getGeometries();for(let l=0;l<this.numFeatures;l++){let f;this.idVector&&(f=this.containsMaxSaveIntegerValues(this.idVector)?Number(this.idVector.getValue(l)):this.idVector.getValue(l));const m={coordinates:n[l],type:this.geometryVector.geometryType(l)},y={};for(const w of this.propertyVectors){if(!w)continue;const E=w.name,R=w.getValue(l);R!==null&&(y[E]=R)}e.push({id:f,geometry:m,properties:y})}return e}containsMaxSaveIntegerValues(e){return e instanceof ap||e instanceof op&&e instanceof gm||e instanceof pd}}class Cg{value;constructor(e){this.value=e}get(){return this.value}set(e){this.value=e}increment(){return this.value++}add(e){this.value+=e}}var Bn,Lu,or,Bo,xc,es,sa,oa,_m,Ts;function qr(i,e,n){const l=new Int32Array(n);let f=0,m=e.get();for(let y=0;y<l.length;y++){let w=i[m++],E=127&w;w<128||(w=i[m++],E|=(127&w)<<7,w<128||(w=i[m++],E|=(127&w)<<14,w<128||(w=i[m++],E|=(127&w)<<21,w<128||(w=i[m++],E|=(15&w)<<28)))),l[f++]=E}return e.set(m),l}function lp(i,e,n){const l=new BigInt64Array(n);for(let f=0;f<l.length;f++)l[f]=Ig(i,e);return l}function Fo(i,e){let n,l;return l=i[e.get()],e.increment(),n=127&l,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<7,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<14,l<128?n:(l=i[e.get()],e.increment(),n|=(127&l)<<21,l<128?n:(l=i[e.get()],n|=(15&l)<<28,(function(f,m,y){let w,E;if(E=m[y.get()],y.increment(),w=(112&E)>>4,E<128||(E=m[y.get()],y.increment(),w|=(127&E)<<3,E<128)||(E=m[y.get()],y.increment(),w|=(127&E)<<10,E<128)||(E=m[y.get()],y.increment(),w|=(127&E)<<17,E<128)||(E=m[y.get()],y.increment(),w|=(127&E)<<24,E<128)||(E=m[y.get()],y.increment(),w|=(1&E)<<31,E<128))return 4294967296*w+(f>>>0);throw new Error("Expected varint not more than 10 bytes")})(n,i,e)))))}function up(i,e,n,l){throw new Error("FastPFor is not implemented yet.")}function bc(i){return i>>>1^-(1&i)}function dh(i){return i>>1n^-(1n&i)}function Ig(i,e){let n=0n,l=0,f=e.get();for(;f<i.length;){const m=i[f++];if(n|=BigInt(127&m)<<BigInt(l),!(128&m))break;if(l+=7,l>=64)throw new Error("Varint too long")}return e.set(f),n}function df(i,e,n){const l=new Int32Array(n);let f=0;for(let m=0;m<e;m++){const y=i[m];l.fill(i[m+e],f,f+y),f+=y}return l}function oo(i,e,n){const l=new BigInt64Array(n);let f=0;for(let m=0;m<e;m++){const y=Number(i[m]);l.fill(i[m+e],f,f+y),f+=y}return l}function ym(i,e,n){const l=new Float64Array(n);let f=0;for(let m=0;m<e;m++){const y=i[m];l.fill(i[m+e],f,f+y),f+=y}return l}function pf(i){const e=i.length/4*4;let n=1;if(e>=4)for(let l=i[0];n<e-4;n+=4)l=i[n]+=l,l=i[n+1]+=l,l=i[n+2]+=l,l=i[n+3]+=l;for(;n!=i.length;)i[n]+=i[n-1],++n}function Hl(i){i[0]=i[0]>>>1^-(1&i[0]),i[1]=i[1]>>>1^-(1&i[1]);const e=i.length/4*4;let n=2;if(e>=4)for(;n<e-4;n+=4){const l=i[n],f=i[n+1],m=i[n+2],y=i[n+3];i[n]=(l>>>1^-(1&l))+i[n-2],i[n+1]=(f>>>1^-(1&f))+i[n-1],i[n+2]=(m>>>1^-(1&m))+i[n],i[n+3]=(y>>>1^-(1&y))+i[n+1]}for(;n!=i.length;n+=2)i[n]=(i[n]>>>1^-(1&i[n]))+i[n-2],i[n+1]=(i[n+1]>>>1^-(1&i[n+1]))+i[n-1]}(function(i){i.NONE="NONE",i.DELTA="DELTA",i.COMPONENTWISE_DELTA="COMPONENTWISE_DELTA",i.RLE="RLE",i.MORTON="MORTON",i.PDE="PDE"})(Bn||(Bn={})),(function(i){i.NONE="NONE",i.FAST_PFOR="FAST_PFOR",i.VARINT="VARINT",i.ALP="ALP"})(Lu||(Lu={})),(function(i){i.PRESENT="PRESENT",i.DATA="DATA",i.OFFSET="OFFSET",i.LENGTH="LENGTH"})(or||(or={}));class vm{_dictionaryType;_offsetType;_lengthType;constructor(e,n,l){this._dictionaryType=e,this._offsetType=n,this._lengthType=l}get dictionaryType(){return this._dictionaryType}get offsetType(){return this._offsetType}get lengthType(){return this._lengthType}}function ts(i,e){const n=(function(l,f){const m=l[f.get()],y=Object.values(or)[m>>4];let w=null;switch(y){case or.DATA:w=new vm(Object.values(Bo)[15&m]);break;case or.OFFSET:w=new vm(null,Object.values(xc)[15&m]);break;case or.LENGTH:w=new vm(null,null,Object.values(es)[15&m])}f.increment();const E=l[f.get()],R=Object.values(Bn)[E>>5],N=Object.values(Bn)[E>>2&7],j=Object.values(Lu)[3&E];f.increment();const q=qr(l,f,2),Z=q[0];return{physicalStreamType:y,logicalStreamType:w,logicalLevelTechnique1:R,logicalLevelTechnique2:N,physicalLevelTechnique:j,numValues:Z,byteLength:q[1],decompressedCount:Z}})(i,e);return n.logicalLevelTechnique1===Bn.MORTON?(function(l,f,m){const y=qr(f,m,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:l.decompressedCount,numBits:y[0],coordinateShift:y[1]}})(n,i,e):Bn.RLE!==n.logicalLevelTechnique1&&Bn.RLE!==n.logicalLevelTechnique2||Lu.NONE===n.physicalLevelTechnique?n:(function(l,f,m){const y=qr(f,m,2);return{physicalStreamType:l.physicalStreamType,logicalStreamType:l.logicalStreamType,logicalLevelTechnique1:l.logicalLevelTechnique1,logicalLevelTechnique2:l.logicalLevelTechnique2,physicalLevelTechnique:l.physicalLevelTechnique,numValues:l.numValues,byteLength:l.byteLength,decompressedCount:y[1],runs:y[0],numRleValues:y[1]}})(n,i,e)}(function(i){i.NONE="NONE",i.SINGLE="SINGLE",i.SHARED="SHARED",i.VERTEX="VERTEX",i.MORTON="MORTON",i.FSST="FSST"})(Bo||(Bo={})),(function(i){i.VERTEX="VERTEX",i.INDEX="INDEX",i.STRING="STRING",i.KEY="KEY"})(xc||(xc={})),(function(i){i.VAR_BINARY="VAR_BINARY",i.GEOMETRIES="GEOMETRIES",i.PARTS="PARTS",i.RINGS="RINGS",i.TRIANGLES="TRIANGLES",i.SYMBOL="SYMBOL",i.DICTIONARY="DICTIONARY"})(es||(es={})),(function(i){i[i.FLAT=0]="FLAT",i[i.CONST=1]="CONST",i[i.SEQUENCE=2]="SEQUENCE",i[i.DICTIONARY=3]="DICTIONARY",i[i.FSST_DICTIONARY=4]="FSST_DICTIONARY"})(sa||(sa={}));class ns{values;_size;constructor(e,n){this.values=e,this._size=n}get(e){const n=Math.floor(e/8);return(this.values[n]>>e%8&1)==1}set(e,n){const l=Math.floor(e/8);this.values[l]=this.values[l]|(n?1:0)<<e%8}getInt(e){const n=Math.floor(e/8);return this.values[n]>>e%8&1}size(){return this._size}getBuffer(){return this.values}}function Ua(i,e,n,l,f){return(function(m,y,w){switch(y.logicalLevelTechnique1){case Bn.DELTA:return y.logicalLevelTechnique2===Bn.RLE?(function(E,R,N){const j=new Int32Array(N);let q=0,Z=0;for(let $=0;$<R;$++){const Q=E[$],ee=bc(E[$+R]);for(let se=0;se<Q;se++)Z+=ee,j[q++]=Z}return j})(m,y.runs,y.numRleValues):((function(E){E[0]=E[0]>>>1^-(1&E[0]);const R=E.length/4*4;let N=1;if(R>=4)for(;N<R-4;N+=4){const j=E[N],q=E[N+1],Z=E[N+2],$=E[N+3];E[N]=(j>>>1^-(1&j))+E[N-1],E[N+1]=(q>>>1^-(1&q))+E[N],E[N+2]=(Z>>>1^-(1&Z))+E[N+1],E[N+3]=($>>>1^-(1&$))+E[N+2]}for(;N!=E.length;++N)E[N]=(E[N]>>>1^-(1&E[N]))+E[N-1]})(m),m);case Bn.RLE:return(function(E,R,N){return N?(function(j,q,Z){const $=new Int32Array(Z);let Q=0;for(let ee=0;ee<q;ee++){const se=j[ee];let Te=j[ee+q];Te=Te>>>1^-(1&Te),$.fill(Te,Q,Q+se),Q+=se}return $})(E,R.runs,R.numRleValues):df(E,R.runs,R.numRleValues)})(m,y,w);case Bn.MORTON:return pf(m),m;case Bn.COMPONENTWISE_DELTA:return Hl(m),m;case Bn.NONE:return w&&(function(E){for(let R=0;R<E.length;R++){const N=E[R];E[R]=N>>>1^-(1&N)}})(m),m;default:throw new Error(`The specified Logical level technique is not supported: ${y.logicalLevelTechnique1}`)}})(cp(i,e,n),n,l)}function wc(i,e,n){return(function(l,f){if(f.logicalLevelTechnique1===Bn.DELTA&&f.logicalLevelTechnique2===Bn.NONE)return(function(y){const w=new Int32Array(y.length+1);w[0]=0,w[1]=bc(y[0]);let E=w[1],R=2;for(;R!=w.length;++R){const N=y[R-1];E+=N>>>1^-(1&N),w[R]=w[R-1]+E}return w})(l);if(f.logicalLevelTechnique1===Bn.RLE&&f.logicalLevelTechnique2===Bn.NONE)return(function(y,w,E){const R=new Int32Array(E+1);R[0]=0;let N=1,j=R[0];for(let q=0;q<w;q++){const Z=y[q],$=y[q+w];for(let Q=N;Q<N+Z;Q++)R[Q]=$+j,j=R[Q];N+=Z}return R})(l,f.runs,f.numRleValues);if(f.logicalLevelTechnique1===Bn.NONE&&f.logicalLevelTechnique2===Bn.NONE){(function(y){let w=0;for(let E=0;E<y.length;E++)y[E]+=w,w=y[E]})(l);const m=new Int32Array(f.numValues+1);return m[0]=0,m.set(l,1),m}if(f.logicalLevelTechnique1===Bn.DELTA&&f.logicalLevelTechnique2===Bn.RLE){const m=(function(y,w,E){const R=new Int32Array(E+1);R[0]=0;let N=1,j=R[0];for(let q=0;q<w;q++){const Z=y[q];let $=y[q+w];$=$>>>1^-(1&$);for(let Q=N;Q<N+Z;Q++)R[Q]=$+j,j=R[Q];N+=Z}return R})(l,f.runs,f.numRleValues);return pf(m),m}throw new Error("Only delta encoding is supported for transforming length to offset streams yet.")})(cp(i,e,n),n)}function cp(i,e,n){const l=n.physicalLevelTechnique;if(l===Lu.FAST_PFOR)return up();if(l===Lu.VARINT)return qr(i,e,n.numValues);if(l===Lu.NONE){const f=e.get();e.add(n.byteLength);const m=i.subarray(f,e.get());return new Int32Array(m)}throw new Error("Specified physicalLevelTechnique is not supported (yet).")}function xm(i,e,n,l){const f=cp(i,e,n);if(f.length===1){const m=f[0];return l?bc(m):m}return l?(function(m){return bc(m[1])})(f):(function(m){return m[1]})(f)}function Ag(i,e,n){return(function(l){if(l.length==2){const f=bc(l[1]);return[f,f]}return[bc(l[2]),bc(l[3])]})(cp(i,e,n))}function kg(i,e,n){return(function(l){if(l.length==2){const f=dh(l[1]);return[f,f]}return[dh(l[2]),dh(l[3])]})(lp(i,e,n.numValues))}function Pg(i,e,n,l){return(function(f,m,y){switch(m.logicalLevelTechnique1){case Bn.DELTA:return m.logicalLevelTechnique2===Bn.RLE?(function(w,E,R){const N=new BigInt64Array(R);let j=0,q=0n;for(let Z=0;Z<E;Z++){const $=Number(w[Z]),Q=dh(w[Z+E]);for(let ee=0;ee<$;ee++)q+=Q,N[j++]=q}return N})(f,m.runs,m.numRleValues):((function(w){w[0]=w[0]>>1n^-(1n&w[0]);const E=w.length/4*4;let R=1;if(E>=4)for(;R<E-4;R+=4){const N=w[R],j=w[R+1],q=w[R+2],Z=w[R+3];w[R]=(N>>1n^-(1n&N))+w[R-1],w[R+1]=(j>>1n^-(1n&j))+w[R],w[R+2]=(q>>1n^-(1n&q))+w[R+1],w[R+3]=(Z>>1n^-(1n&Z))+w[R+2]}for(;R!=w.length;++R)w[R]=(w[R]>>1n^-(1n&w[R]))+w[R-1]})(f),f);case Bn.RLE:return(function(w,E,R){return R?(function(N,j,q){const Z=new BigInt64Array(q);let $=0;for(let Q=0;Q<j;Q++){const ee=Number(N[Q]);let se=N[Q+j];se=se>>1n^-(1n&se),Z.fill(se,$,$+ee),$+=ee}return Z})(w,E.runs,E.numRleValues):oo(w,E.runs,E.numRleValues)})(f,m,y);case Bn.NONE:return y&&(function(w){for(let E=0;E<w.length;E++){const R=w[E];w[E]=R>>1n^-(1n&R)}})(f),f;default:throw new Error(`The specified Logical level technique is not supported: ${m.logicalLevelTechnique1}`)}})(lp(i,e,n.numValues),n,l)}function Rg(i,e,n,l){const f=lp(i,e,n.numValues);if(f.length===1){const m=f[0];return l?dh(m):m}return l?(function(m){return dh(m[1])})(f):(function(m){return m[1]})(f)}function hp(i,e,n,l,f){return(function(m,y,w,E){switch(y.logicalLevelTechnique1){case Bn.DELTA:return y.logicalLevelTechnique2===Bn.RLE&&(m=df(m,y.runs,y.numRleValues)),(function(R,N){const j=new Int32Array(R.size());let q=0;R.get(0)?(j[0]=R.get(0)?N[0]>>>1^-(1&N[0]):0,q=1):j[0]=0;let Z=1;for(;Z!=j.length;++Z)j[Z]=R.get(Z)?j[Z-1]+(N[q]>>>1^-(1&N[q++])):j[Z-1];return j})(E,m);case Bn.RLE:return(function(R,N,j,q){const Z=N;return j?(function($,Q,ee){const se=new Int32Array($.size());let Te=0;for(let ue=0;ue<ee;ue++){const pe=Q[ue];let ke=Q[ue+ee];ke=ke>>>1^-(1&ke);for(let ze=Te;ze<Te+pe;ze++)$.get(ze)?se[ze]=ke:(se[ze]=0,Te++);Te+=pe}return se})(q,R,Z.runs):(function($,Q,ee){const se=new Int32Array($.size());let Te=0;for(let ue=0;ue<ee;ue++){const pe=Q[ue],ke=Q[ue+ee];for(let ze=Te;ze<Te+pe;ze++)$.get(ze)?se[ze]=ke:(se[ze]=0,Te++);Te+=pe}return se})(q,R,Z.runs)})(m,y,w,E);case Bn.MORTON:return pf(m),m;case Bn.COMPONENTWISE_DELTA:return Hl(m),m;case Bn.NONE:return m=w?(function(R,N){const j=new Int32Array(R.size());let q=0,Z=0;for(;Z!=j.length;++Z)if(R.get(Z)){const $=N[q++];j[Z]=$>>>1^-(1&$)}else j[Z]=0;return j})(E,m):(function(R,N){const j=new Int32Array(R.size());let q=0,Z=0;for(;Z!=j.length;++Z)j[Z]=R.get(Z)?N[q++]:0;return j})(E,m),m;default:throw new Error("The specified Logical level technique is not supported")}})(n.physicalLevelTechnique===Lu.FAST_PFOR?up():qr(i,e,n.numValues),n,l,f)}function zu(i,e,n,l){const f=i.logicalLevelTechnique1;if(f===Bn.RLE)return i.runs===1?sa.CONST:sa.FLAT;const m=e instanceof ns?e.size():e;if(f===Bn.DELTA&&i.logicalLevelTechnique2===Bn.RLE){const y=i.runs,w=2;if(i.numRleValues!==m)return sa.FLAT;if(y===1)return sa.SEQUENCE;if(y===2){const E=l.get();let R;if(i.physicalLevelTechnique===Lu.VARINT)R=qr(n,l,4);else{const N=l.get();R=new Int32Array(n.buffer,n.byteOffset+N,4)}if(l.set(E),R[2]===w&&R[3]===w)return sa.SEQUENCE}}return i.numValues===1?sa.CONST:sa.FLAT}class mf extends dd{getValueFromBuffer(e){return this.dataBuffer[e]}}class bm extends sp{constructor(e,n,l,f){super(e,BigInt64Array.of(n),l,f)}getValueFromBuffer(e){return this.dataBuffer[0]+BigInt(e)*this.delta}}class gf{_geometryOffsets;_partOffsets;_ringOffsets;constructor(e,n,l){this._geometryOffsets=e,this._partOffsets=n,this._ringOffsets=l}get geometryOffsets(){return this._geometryOffsets}get partOffsets(){return this._partOffsets}get ringOffsets(){return this._ringOffsets}}function Tc(i,e,n){return{x:_f(i,e)-n,y:_f(i>>1,e)-n}}function _f(i,e){let n=0;for(let l=0;l<e;l++)n|=(i&1<<2*l)>>l;return n}(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON",i[i.MULTIPOINT=3]="MULTIPOINT",i[i.MULTILINESTRING=4]="MULTILINESTRING",i[i.MULTIPOLYGON=5]="MULTIPOLYGON"})(oa||(oa={})),(function(i){i[i.POINT=0]="POINT",i[i.LINESTRING=1]="LINESTRING",i[i.POLYGON=2]="POLYGON"})(_m||(_m={})),(function(i){i[i.MORTON=0]="MORTON",i[i.VEC_2=1]="VEC_2",i[i.VEC_3=2]="VEC_3"})(Ts||(Ts={}));class Dg{createPoint(e){return[[e]]}createMultiPoint(e){return e.map((n=>[n]))}createLineString(e){return[e]}createMultiLineString(e){return e}createPolygon(e,n){return[e].concat(n)}createMultiPolygon(e){return e.flat()}}function md(i){const e=new Array(i.numGeometries);let n=1,l=1,f=1,m=0;const y=new Dg;let w=0,E=0;const R=i.mortonSettings,N=i.topologyVector,j=N.geometryOffsets,q=N.partOffsets,Z=N.ringOffsets,$=i.vertexOffsets,Q=i.containsPolygonGeometry(),ee=i.vertexBuffer;for(let se=0;se<i.numGeometries;se++){const Te=i.geometryType(se);if(Te===oa.POINT){if($&&$.length!==0)if(i.vertexBufferType===Ts.VEC_2){const ue=2*$[E++],pe=new X(ee[ue],ee[ue+1]);e[m++]=y.createPoint(pe)}else{const ue=Tc(ee[$[E++]],R.numBits,R.coordinateShift),pe=new X(ue.x,ue.y);e[m++]=y.createPoint(pe)}else{const ue=new X(ee[w++],ee[w++]);e[m++]=y.createPoint(ue)}j&&f++,q&&n++,Z&&l++}else if(Te===oa.MULTIPOINT){const ue=j[f]-j[f-1];f++;const pe=new Array(ue);if($&&$.length!==0){for(let ke=0;ke<ue;ke++){const ze=2*$[E++];pe[ke]=new X(ee[ze],ee[ze+1])}e[m++]=y.createMultiPoint(pe)}else{for(let ke=0;ke<ue;ke++){const ze=ee[w++],ot=ee[w++];pe[ke]=new X(ze,ot)}e[m++]=y.createMultiPoint(pe)}}else if(Te===oa.LINESTRING){let ue,pe=0;Q?(pe=Z[l]-Z[l-1],l++):pe=q[n]-q[n-1],n++,$&&$.length!==0?(ue=i.vertexBufferType===Ts.VEC_2?dp(ee,$,E,pe,!1):wm(ee,$,E,pe,!1,R),E+=pe):(ue=fp(ee,w,pe,!1),w+=2*pe),e[m++]=y.createLineString(ue),j&&f++}else if(Te===oa.POLYGON){const ue=q[n]-q[n-1];n++;const pe=new Array(ue-1);let ke=Z[l]-Z[l-1];if(l++,$&&$.length!==0){const ze=i.vertexBufferType===Ts.VEC_2?vf(ee,$,E,ke):ph(ee,$,E,ke,0,R);E+=ke;for(let ot=0;ot<pe.length;ot++)ke=Z[l]-Z[l-1],l++,pe[ot]=i.vertexBufferType===Ts.VEC_2?vf(ee,$,E,ke):ph(ee,$,E,ke,0,R),E+=ke;e[m++]=y.createPolygon(ze,pe)}else{const ze=yf(ee,w,ke);w+=2*ke;for(let ot=0;ot<pe.length;ot++)ke=Z[l]-Z[l-1],l++,pe[ot]=yf(ee,w,ke),w+=2*ke;e[m++]=y.createPolygon(ze,pe)}j&&f++}else if(Te===oa.MULTILINESTRING){const ue=j[f]-j[f-1];f++;const pe=new Array(ue);if($&&$.length!==0){for(let ke=0;ke<ue;ke++){let ze=0;Q?(ze=Z[l]-Z[l-1],l++):ze=q[n]-q[n-1],n++;const ot=i.vertexBufferType===Ts.VEC_2?dp(ee,$,E,ze,!1):wm(ee,$,E,ze,!1,R);pe[ke]=ot,E+=ze}e[m++]=y.createMultiLineString(pe)}else{for(let ke=0;ke<ue;ke++){let ze=0;Q?(ze=Z[l]-Z[l-1],l++):ze=q[n]-q[n-1],n++,pe[ke]=fp(ee,w,ze,!1),w+=2*ze}e[m++]=y.createMultiLineString(pe)}}else{if(Te!==oa.MULTIPOLYGON)throw new Error("The specified geometry type is currently not supported.");{const ue=j[f]-j[f-1];f++;const pe=new Array(ue);let ke=0;if($&&$.length!==0){for(let ze=0;ze<ue;ze++){const ot=q[n]-q[n-1];n++;const Et=new Array(ot-1);ke=Z[l]-Z[l-1],l++;const xt=i.vertexBufferType===Ts.VEC_2?vf(ee,$,E,ke):ph(ee,$,E,ke,0,R);E+=ke;for(let Lt=0;Lt<Et.length;Lt++)ke=Z[l]-Z[l-1],l++,Et[Lt]=i.vertexBufferType===Ts.VEC_2?vf(ee,$,E,ke):ph(ee,$,E,ke,0,R),E+=ke;pe[ze]=y.createPolygon(xt,Et)}e[m++]=y.createMultiPolygon(pe)}else{for(let ze=0;ze<ue;ze++){const ot=q[n]-q[n-1];n++;const Et=new Array(ot-1);ke=Z[l]-Z[l-1],l++;const xt=yf(ee,w,ke);w+=2*ke;for(let Lt=0;Lt<Et.length;Lt++){const Ht=Z[l]-Z[l-1];l++,Et[Lt]=yf(ee,w,Ht),w+=2*Ht}pe[ze]=y.createPolygon(xt,Et)}e[m++]=y.createMultiPolygon(pe)}}}}return e}function yf(i,e,n){return fp(i,e,n,!0)}function vf(i,e,n,l){return dp(i,e,n,l,!0)}function ph(i,e,n,l,f,m){return wm(i,e,n,l,!0,m)}function fp(i,e,n,l){const f=new Array(l?n+1:n);for(let m=0;m<2*n;m+=2)f[m/2]=new X(i[e+m],i[e+m+1]);return l&&(f[f.length-1]=f[0]),f}function dp(i,e,n,l,f){const m=new Array(f?l+1:l);for(let y=0;y<2*l;y+=2){const w=2*e[n+y/2];m[y/2]=new X(i[w],i[w+1])}return f&&(m[m.length-1]=m[0]),m}function wm(i,e,n,l,f,m){const y=new Array(f?l+1:l);for(let w=0;w<l;w++){const E=Tc(i[e[n+w]],m.numBits,m.coordinateShift);y[w]=new X(E.x,E.y)}return f&&(y[y.length-1]=y[0]),y}class Tm{_vertexBufferType;_topologyVector;_vertexOffsets;_vertexBuffer;_mortonSettings;constructor(e,n,l,f,m){this._vertexBufferType=e,this._topologyVector=n,this._vertexOffsets=l,this._vertexBuffer=f,this._mortonSettings=m}get vertexBufferType(){return this._vertexBufferType}get topologyVector(){return this._topologyVector}get vertexOffsets(){return this._vertexOffsets}get vertexBuffer(){return this._vertexBuffer}*[Symbol.iterator](){const e=md(this);let n=0;for(;n<this.numGeometries;)yield{coordinates:e[n],type:this.geometryType(n)},n++}getSimpleEncodedVertex(e){const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getVertex(e){if(this.vertexOffsets&&this.mortonSettings){const l=Tc(this.vertexBuffer[this.vertexOffsets[e]],this.mortonSettings.numBits,this.mortonSettings.coordinateShift);return[l.x,l.y]}const n=this.vertexOffsets?2*this.vertexOffsets[e]:2*e;return[this.vertexBuffer[n],this.vertexBuffer[n+1]]}getGeometries(){return md(this)}get mortonSettings(){return this._mortonSettings}}class Lg extends Tm{_numGeometries;_geometryType;constructor(e,n,l,f,m,y,w){super(l,f,m,y,w),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsPolygonGeometry(){return this._geometryType===oa.POLYGON||this._geometryType===oa.MULTIPOLYGON}containsSingleGeometryType(){return!0}}class pp extends Tm{_geometryTypes;constructor(e,n,l,f,m,y){super(e,l,f,m,y),this._geometryTypes=n}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsPolygonGeometry(){for(let e=0;e<this.numGeometries;e++)if(this.geometryType(e)===oa.POLYGON||this.geometryType(e)===oa.MULTIPOLYGON)return!0;return!1}containsSingleGeometryType(){return!1}}class zg{_triangleOffsets;_indexBuffer;_vertexBuffer;_topologyVector;constructor(e,n,l,f){this._triangleOffsets=e,this._indexBuffer=n,this._vertexBuffer=l,this._topologyVector=f}get triangleOffsets(){return this._triangleOffsets}get indexBuffer(){return this._indexBuffer}get vertexBuffer(){return this._vertexBuffer}get topologyVector(){return this._topologyVector}getGeometries(){if(!this._topologyVector)throw new Error("Cannot convert GpuVector to coordinates without topology information");const e=new Array(this.numGeometries),n=this._topologyVector,l=n.partOffsets,f=n.ringOffsets,m=n.geometryOffsets;let y=0,w=1,E=1,R=1;for(let N=0;N<this.numGeometries;N++)switch(this.geometryType(N)){case oa.POLYGON:{const j=l[w]-l[w-1];w++;const q=[];for(let Z=0;Z<j;Z++){const $=f[E]-f[E-1];E++;const Q=[];for(let ee=0;ee<$;ee++){const se=this._vertexBuffer[y++],Te=this._vertexBuffer[y++];Q.push(new X(se,Te))}Q.length>0&&Q.push(Q[0]),q.push(Q)}e[N]=q,m&&R++}break;case oa.MULTIPOLYGON:{const j=m[R]-m[R-1];R++;const q=[];for(let Z=0;Z<j;Z++){const $=l[w]-l[w-1];w++;for(let Q=0;Q<$;Q++){const ee=f[E]-f[E-1];E++;const se=[];for(let Te=0;Te<ee;Te++){const ue=this._vertexBuffer[y++],pe=this._vertexBuffer[y++];se.push(new X(ue,pe))}se.length>0&&se.push(se[0]),q.push(se)}}e[N]=q}}return e}[Symbol.iterator](){return null}}function gd(i,e,n,l,f,m){return new mp(i,e,n,l,f,m)}class mp extends zg{_numGeometries;_geometryType;constructor(e,n,l,f,m,y){super(l,f,m,y),this._numGeometries=e,this._geometryType=n}geometryType(e){return this._geometryType}get numGeometries(){return this._numGeometries}containsSingleGeometryType(){return!0}}function _d(i,e,n,l,f){return new N_(i,e,n,l,f)}class N_ extends zg{_geometryTypes;constructor(e,n,l,f,m){super(n,l,f,m),this._geometryTypes=e}geometryType(e){return this._geometryTypes[e]}get numGeometries(){return this._geometryTypes.length}containsSingleGeometryType(){return!1}}function yd(i,e,n,l,f){const m=ts(i,n);let y=null,w=null,E=null,R=null,N=null,j=null,q=null,Z=null;if(zu(m,l,i,n)===sa.CONST){const Q=xm(i,n,m,!1);for(let ee=0;ee<e-1;ee++){const se=ts(i,n);switch(se.physicalStreamType){case or.LENGTH:switch(se.logicalStreamType.lengthType){case es.GEOMETRIES:y=wc(i,n,se);break;case es.PARTS:w=wc(i,n,se);break;case es.RINGS:E=wc(i,n,se);break;case es.TRIANGLES:q=wc(i,n,se)}break;case or.OFFSET:switch(se.logicalStreamType.offsetType){case xc.VERTEX:R=Ua(i,n,se,!1);break;case xc.INDEX:Z=Ua(i,n,se,!1)}break;case or.DATA:Bo.VERTEX===se.logicalStreamType.dictionaryType?N=Ua(i,n,se,!0):(j={numBits:se.numBits,coordinateShift:se.coordinateShift},N=Ua(i,n,se,!1))}}return Z!==null?y!=null||w!=null?gd(l,Q,q,Z,N,new gf(y,w,E)):gd(l,Q,q,Z,N):j===null?(function(ee,se,Te,ue,pe){return new Lg(ee,se,Ts.VEC_2,Te,ue,pe)})(l,Q,new gf(y,w,E),R,N):(function(ee,se,Te,ue,pe,ke){return new Lg(ee,se,Ts.MORTON,Te,ue,pe,ke)})(l,Q,new gf(y,w,E),R,N,j)}const $=Ua(i,n,m,!1);for(let Q=0;Q<e-1;Q++){const ee=ts(i,n);switch(ee.physicalStreamType){case or.LENGTH:switch(ee.logicalStreamType.lengthType){case es.GEOMETRIES:y=Ua(i,n,ee,!1);break;case es.PARTS:w=Ua(i,n,ee,!1);break;case es.RINGS:E=Ua(i,n,ee,!1);break;case es.TRIANGLES:q=wc(i,n,ee)}break;case or.OFFSET:switch(ee.logicalStreamType.offsetType){case xc.VERTEX:R=Ua(i,n,ee,!1);break;case xc.INDEX:Z=Ua(i,n,ee,!1)}break;case or.DATA:Bo.VERTEX===ee.logicalStreamType.dictionaryType?N=Ua(i,n,ee,!0):(j={numBits:ee.numBits,coordinateShift:ee.coordinateShift},N=Ua(i,n,ee,!1))}}return Z!==null&&w===null?_d($,q,Z,N):(y!==null?(y=Sm($,y,2),w!==null&&E!==null?(w=Em($,y,w,!1),E=(function(Q,ee,se,Te){const ue=new Int32Array(se[se.length-1]+1);let pe=0;ue[0]=pe;let ke=1,ze=1,ot=0;for(let Et=0;Et<Q.length;Et++){const xt=Q[Et],Lt=ee[Et+1]-ee[Et];if(xt!==0&&xt!==3)for(let Ht=0;Ht<Lt;Ht++){const zt=se[ke]-se[ke-1];ke++;for(let Tt=0;Tt<zt;Tt++)pe=ue[ze++]=pe+Te[ot++]}else for(let Ht=0;Ht<Lt;Ht++)ue[ze++]=++pe,ke++}return ue})($,y,w,E)):w!==null&&(w=(function(Q,ee,se){const Te=new Int32Array(ee[ee.length-1]+1);let ue=0;Te[0]=ue;let pe=1,ke=0;for(let ze=0;ze<Q.length;ze++){const ot=Q[ze],Et=ee[ze+1]-ee[ze];if(ot===4||ot===1)for(let xt=0;xt<Et;xt++)ue=Te[pe++]=ue+se[ke++];else for(let xt=0;xt<Et;xt++)Te[pe++]=++ue}return Te})($,y,w))):w!==null&&E!==null?(w=Sm($,w,1),E=Em($,w,E,!0)):w!==null&&(w=Sm($,w,0)),Z!==null?_d($,q,Z,N,new gf(y,w,E)):j===null?(function(Q,ee,se,Te){return new pp(Ts.VEC_2,Q,ee,se,Te)})($,new gf(y,w,E),R,N):(function(Q,ee,se,Te,ue){return new pp(Ts.MORTON,Q,ee,se,Te,ue)})($,new gf(y,w,E),R,N,j))}function Sm(i,e,n){const l=new Int32Array(i.length+1);let f=0;l[0]=f;let m=0;for(let y=0;y<i.length;y++)f=l[y+1]=f+(i[y]>n?e[m++]:1);return l}function Em(i,e,n,l){const f=new Int32Array(e[e.length-1]+1);let m=0;f[0]=m;let y=1,w=0;for(let E=0;E<i.length;E++){const R=i[E],N=e[E+1]-e[E];if(R===5||R===2||l&&(R===4||R===1))for(let j=0;j<N;j++)m=f[y++]=m+n[w++];else for(let j=0;j<N;j++)f[y++]=++m}return f}class Og extends Du{dataVector;constructor(e,n,l){super(e,n.getBuffer(),l),this.dataVector=n}getValueFromBuffer(e){return this.dataVector.get(e)}}class Ng extends dd{getValueFromBuffer(e){return this.dataBuffer[e]}}class Mm extends Du{constructor(e,n,l){super(e,BigInt64Array.of(n),l)}getValueFromBuffer(e){return this.dataBuffer[0]}}function mh(i,e,n){return Cm(i,Math.ceil(e/8),n)}function Cm(i,e,n){const l=new Uint8Array(e);let f=0;for(;f<e;){const m=i[n.increment()];if(m<=127){const y=m+3,w=i[n.increment()],E=f+y;l.fill(w,f,E),f=E}else{const y=256-m;for(let w=0;w<y;w++)l[f++]=i[n.increment()]}}return l}const Bg=new TextDecoder;function xf(i,e,n){return n-e>=12?Bg.decode(i.subarray(e,n)):(function(l,f,m){let y="",w=f;for(;w<m;){const E=l[w];let R,N,j,q=null,Z=E>239?4:E>223?3:E>191?2:1;if(w+Z>m)break;Z===1?E<128&&(q=E):Z===2?(R=l[w+1],(192&R)==128&&(q=(31&E)<<6|63&R,q<=127&&(q=null))):Z===3?(R=l[w+1],N=l[w+2],(192&R)==128&&(192&N)==128&&(q=(15&E)<<12|(63&R)<<6|63&N,(q<=2047||q>=55296&&q<=57343)&&(q=null))):Z===4&&(R=l[w+1],N=l[w+2],j=l[w+3],(192&R)==128&&(192&N)==128&&(192&j)==128&&(q=(15&E)<<18|(63&R)<<12|(63&N)<<6|63&j,(q<=65535||q>=1114112)&&(q=null))),q===null?(q=65533,Z=1):q>65535&&(q-=65536,y+=String.fromCharCode(q>>>10&1023|55296),q=56320|1023&q),y+=String.fromCharCode(q),w+=Z}return y})(i,e,n)}class Im extends Du{offsetBuffer;constructor(e,n,l,f){super(e,l,f),this.offsetBuffer=n}}class Fg extends Im{textEncoder;constructor(e,n,l,f){super(e,n,l,f??n.length-1),this.textEncoder=new TextEncoder}getValueFromBuffer(e){return xf(this.dataBuffer,this.offsetBuffer[e],this.offsetBuffer[e+1])}}class Sc extends Im{indexBuffer;textEncoder;constructor(e,n,l,f,m){super(e,l,f,m??n.length),this.indexBuffer=n,this.indexBuffer=n,this.textEncoder=new TextEncoder}getValueFromBuffer(e){const n=this.indexBuffer[e];return xf(this.dataBuffer,this.offsetBuffer[n],this.offsetBuffer[n+1])}}class gp extends Im{indexBuffer;symbolOffsetBuffer;symbolTableBuffer;textEncoder;symbolLengthBuffer;lengthBuffer;decodedDictionary;constructor(e,n,l,f,m,y,w){super(e,l,f,w),this.indexBuffer=n,this.symbolOffsetBuffer=m,this.symbolTableBuffer=y,this.textEncoder=new TextEncoder}getValueFromBuffer(e){this.decodedDictionary==null&&(this.symbolLengthBuffer==null&&(this.symbolLengthBuffer=this.offsetToLengthBuffer(this.symbolOffsetBuffer),this.lengthBuffer=this.offsetToLengthBuffer(this.offsetBuffer)),this.decodedDictionary=(function(l,f,m){const y=[],w=new Array(f.length).fill(0);for(let E=1;E<f.length;E++)w[E]=w[E-1]+f[E-1];for(let E=0;E<m.length;E++)if(m[E]===255)y.push(m[++E]);else{const R=f[m[E]],N=w[m[E]];for(let j=0;j<R;j++)y.push(l[N+j])}return new Uint8Array(y)})(this.symbolTableBuffer,this.symbolLengthBuffer,this.dataBuffer));const n=this.indexBuffer[e];return xf(this.decodedDictionary,this.offsetBuffer[n],this.offsetBuffer[n+1])}offsetToLengthBuffer(e){const n=new Uint32Array(e.length-1);let l=e[0];for(let f=1;f<e.length;f++){const m=e[f];n[f-1]=m-l,l=m}return n}}function _p(i,e,n,l,f,m){return n.type==="scalarType"?(function(y,w,E,R,N,j){let q=null,Z=0;if(y===0)return null;if(j.nullable){const Q=ts(w,E);Z=Q.numValues;const ee=E.get(),se=mh(w,Z,E);E.set(ee+Q.byteLength),q=new ns(se,Q.numValues)}const $=q??R;switch(N.physicalType){case 4:case 3:return(function(Q,ee,se,Te,ue){const pe=ts(Q,ee),ke=zu(pe,ue,Q,ee),ze=Te.physicalType===3;if(ke===sa.FLAT){const ot=gh(ue)?hp(Q,ee,pe,ze,ue):Ua(Q,ee,pe,ze);return new ap(se.name,ot,ue)}if(ke===sa.SEQUENCE){const ot=Ag(Q,ee,pe);return new gm(se.name,ot[0],ot[1],pe.numRleValues)}{const ot=xm(Q,ee,pe,ze);return new op(se.name,ot,ue)}})(w,E,j,N,$);case 9:return(function(Q,ee,se,Te,ue){let pe=null,ke=null,ze=null,ot=null,Et=null,xt=null,Lt=null,Ht=null;for(let zt=0;zt<Te;zt++){const Tt=ts(ee,se);if(Tt.byteLength!==0)switch(Tt.physicalStreamType){case or.PRESENT:{const mt=mh(ee,Tt.numValues,se);xt=new ns(mt,Tt.numValues);break}case or.OFFSET:ke=ue!=null||xt!=null?hp(ee,se,Tt,!1,ue??xt):Ua(ee,se,Tt,!1);break;case or.LENGTH:{const mt=wc(ee,se,Tt);es.DICTIONARY===Tt.logicalStreamType.lengthType?pe=mt:es.SYMBOL===Tt.logicalStreamType.lengthType?ot=mt:Lt=mt;break}case or.DATA:{const mt=ee.subarray(se.get(),se.get()+Tt.byteLength);se.add(Tt.byteLength);const en=Tt.logicalStreamType.dictionaryType;Bo.FSST===en?Et=mt:Bo.SINGLE===en||Bo.SHARED===en?ze=mt:Bo.NONE===en&&(Ht=mt);break}}}return(function(zt,Tt,mt,en,Kt,nn,$t){return Tt?new gp(zt,mt,en,Kt,nn,Tt,$t):null})(Q,Et,ke,pe,ze,ot,ue??xt)??(function(zt,Tt,mt,en,Kt){return Tt?Kt?new Sc(zt,mt,en,Tt,Kt):new Sc(zt,mt,en,Tt):null})(Q,ze,ke,pe,ue??xt)??(function(zt,Tt,mt,en,Kt){if(!Tt||!mt)return null;if(en)return Kt?new Sc(zt,en,Tt,mt,Kt):new Sc(zt,en,Tt,mt);if(Kt&&Kt.size()!==Tt.length-1){const nn=new Int32Array(Kt.size());let $t=0;for(let hn=0;hn<Kt.size();hn++)nn[hn]=Kt.get(hn)?$t++:0;return new Sc(zt,nn,Tt,mt,Kt)}return Kt?new Fg(zt,Tt,mt,Kt):new Fg(zt,Tt,mt)})(Q,Lt,Ht,ke,ue??xt)})(j.name,w,E,j.nullable?y-1:y,q);case 0:return(function(Q,ee,se,Te,ue){const pe=ts(Q,ee),ke=pe.numValues,ze=ee.get(),ot=gh(ue)?(function(xt,Lt,Ht,zt){const Tt=Cm(xt,Math.ceil(Lt/8),Ht),mt=new ns(Tt,Lt),en=zt.size(),Kt=new ns(new Uint8Array(en),en);let nn=0;for(let $t=0;$t<zt.size();$t++){const hn=!!zt.get($t)&&mt.get(nn++);Kt.set($t,hn)}return Kt.getBuffer()})(Q,ke,ee,ue):mh(Q,ke,ee);ee.set(ze+pe.byteLength);const Et=new ns(ot,ke);return new Og(se.name,Et,ue)})(w,E,j,0,$);case 6:case 5:return(function(Q,ee,se,Te,ue){const pe=ts(Q,ee),ke=zu(pe,Te,Q,ee),ze=ue.physicalType===5;if(ke===sa.FLAT){const ot=gh(Te)?(function(Et,xt,Lt,Ht,zt){return(function(Tt,mt,en,Kt){switch(mt.logicalLevelTechnique1){case Bn.DELTA:return mt.logicalLevelTechnique2===Bn.RLE&&(Tt=oo(Tt,mt.runs,mt.numRleValues)),(function(nn,$t){const hn=new BigInt64Array(nn.size());let ti=0;nn.get(0)?(hn[0]=nn.get(0)?$t[0]>>1n^-(1n&$t[0]):0n,ti=1):hn[0]=0n;let Gn=1;for(;Gn!=hn.length;++Gn)hn[Gn]=nn.get(Gn)?hn[Gn-1]+($t[ti]>>1n^-(1n&$t[ti++])):hn[Gn-1];return hn})(Kt,Tt);case Bn.RLE:return(function(nn,$t,hn,ti){const Gn=$t;return hn?(function(lr,is,la){const ur=new BigInt64Array(lr.size());let nr=0;for(let wi=0;wi<la;wi++){const wr=Number(is[wi]);let Or=is[wi+la];Or=Or>>1n^-(1n&Or);for(let Yi=nr;Yi<nr+wr;Yi++)lr.get(Yi)?ur[Yi]=Or:(ur[Yi]=0n,nr++);nr+=wr}return ur})(ti,nn,Gn.runs):(function(lr,is,la){const ur=new BigInt64Array(lr.size());let nr=0;for(let wi=0;wi<la;wi++){const wr=Number(is[wi]),Or=is[wi+la];for(let Yi=nr;Yi<nr+wr;Yi++)lr.get(Yi)?ur[Yi]=Or:(ur[Yi]=0n,nr++);nr+=wr}return ur})(ti,nn,Gn.runs)})(Tt,mt,en,Kt);case Bn.NONE:return Tt=en?(function(nn,$t){const hn=new BigInt64Array(nn.size());let ti=0,Gn=0;for(;Gn!=hn.length;++Gn)if(nn.get(Gn)){const lr=$t[ti++];hn[Gn]=lr>>1n^-(1n&lr)}else hn[Gn]=0n;return hn})(Kt,Tt):(function(nn,$t){const hn=new BigInt64Array(nn.size());let ti=0,Gn=0;for(;Gn!=hn.length;++Gn)hn[Gn]=nn.get(Gn)?$t[ti++]:0n;return hn})(Kt,Tt),Tt;default:throw new Error("The specified Logical level technique is not supported")}})(lp(Et,xt,Lt.numValues),Lt,Ht,zt)})(Q,ee,pe,ze,Te):Pg(Q,ee,pe,ze);return new mf(se.name,ot,Te)}if(ke===sa.SEQUENCE){const ot=kg(Q,ee,pe);return new bm(se.name,ot[0],ot[1],pe.numRleValues)}{const ot=Rg(Q,ee,pe,ze);return new Mm(se.name,ot,Te)}})(w,E,j,$,N);case 7:return(function(Q,ee,se,Te){const ue=ts(Q,ee),pe=gh(Te)?(function(ke,ze,ot,Et){const xt=ze.get(),Lt=xt+Et*Float32Array.BYTES_PER_ELEMENT,Ht=new Uint8Array(ke.subarray(xt,Lt)).buffer,zt=new Float32Array(Ht);ze.set(Lt);const Tt=ot.size(),mt=new Float32Array(Tt);let en=0;for(let Kt=0;Kt<Tt;Kt++)mt[Kt]=ot.get(Kt)?zt[en++]:0;return mt})(Q,ee,Te,ue.numValues):(function(ke,ze,ot){const Et=ze.get(),xt=Et+ot*Float32Array.BYTES_PER_ELEMENT,Lt=new Uint8Array(ke.subarray(Et,xt)).buffer,Ht=new Float32Array(Lt);return ze.set(xt),Ht})(Q,ee,ue.numValues);return new Ng(se.name,pe,Te)})(w,E,j,$);case 8:return(function(Q,ee,se,Te){const ue=ts(Q,ee),pe=gh(Te)?(function(ke,ze,ot,Et){const xt=ze.get(),Lt=xt+Et*Float64Array.BYTES_PER_ELEMENT,Ht=new Uint8Array(ke.subarray(xt,Lt)).buffer,zt=new Float64Array(Ht);ze.set(Lt);const Tt=ot.size(),mt=new Float64Array(Tt);let en=0;for(let Kt=0;Kt<Tt;Kt++)mt[Kt]=ot.get(Kt)?zt[en++]:0;return mt})(Q,ee,Te,ue.numValues):(function(ke,ze,ot){const Et=ze.get(),xt=Et+ot*Float64Array.BYTES_PER_ELEMENT,Lt=new Uint8Array(ke.subarray(Et,xt)).buffer,Ht=new Float64Array(Lt);return ze.set(xt),Ht})(Q,ee,ue.numValues);return new pd(se.name,pe,Te)})(w,E,j,$);default:throw new Error(`The specified data type for the field is currently not supported: ${N}`)}})(l,i,e,f,n.scalarType,n):l!=1?null:(function(y,w,E,R){let N=null,j=null,q=null,Z=null,$=!1;for(;!$;){const Te=ts(y,w);switch(Te.physicalStreamType){case or.LENGTH:es.DICTIONARY===Te.logicalStreamType.lengthType?N=wc(y,w,Te):q=wc(y,w,Te);break;case or.DATA:Bo.SINGLE===Te.logicalStreamType.dictionaryType||Bo.SHARED===Te.logicalStreamType.dictionaryType?(j=y.subarray(w.get(),w.get()+Te.byteLength),$=!0):Z=y.subarray(w.get(),w.get()+Te.byteLength),w.add(Te.byteLength)}}const Q=E.complexType.children,ee=[];let se=0;for(const Te of Q){const ue=qr(y,w,1)[0];if(ue==0)continue;const pe=`${E.name}${Te.name==="default"?"":":"+Te.name}`;if(ue!==2||Te.type!=="scalarField"||Te.scalarField.physicalType!==9)throw new Error("Currently only optional string fields are implemented for a struct.");const ke=ts(y,w),ze=mh(y,ke.numValues,w),ot=ts(y,w),Et=ot.decompressedCount!==R?hp(y,w,ot,!1,new ns(ze,ke.numValues)):Ua(y,w,ot,!1);ee[se++]=Z?new gp(pe,Et,N,j,q,Z,new ns(ze,ke.numValues)):new Sc(pe,Et,N,j,new ns(ze,ke.numValues))}return ee})(i,e,n,f)}function gh(i){return i instanceof ns}function jg(i){if(i.name==="id")return!1;if(i.type==="scalarType"){const e=i.scalarType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:default:return!1;case 9:return!0}else if(e.type==="logicalType")return!1}else if(i.type==="complexType"){const e=i.complexType;if(e.type==="physicalType")switch(e.physicalType){case 0:case 1:return!0;default:return!1}}return console.warn("Unexpected column type in hasStreamCount",i),!1}const Am=new TextDecoder;function Ou(i,e){const n=qr(i,e,1)[0];if(n===0)return"";const l=e.get(),f=i.subarray(l,l+n);return e.add(n),Am.decode(f)}function Nu(i,e){const n=qr(i,e,1)[0]>>>0,l=!!(4&n),f=!!(2&n),m=qr(i,e,1)[0]>>>0,y={};if(1&n&&(y.nullable=!0),f){const w={};if(l?(w.type="logicalType",w.logicalType=m):(w.type="physicalType",w.physicalType=m),8&n){const E=qr(i,e,1)[0]>>>0;w.children=new Array(E);for(let R=0;R<E;R++)w.children[R]=Nu(i,e)}y.type="complexField",y.complexField=w}else{const w={};l?(w.type="logicalType",w.logicalType=m):(w.type="physicalType",w.physicalType=m),y.type="scalarField",y.scalarField=w}return y}function Ec(i,e){const n=qr(i,e,1)[0]>>>0,l=(function(f){switch(f){case 0:case 1:case 2:case 3:{const m={};m.nullable=!!(1&f),m.columnScope=0;const y={};return y.physicalType=f>1?6:4,y.type="physicalType",m.scalarType=y,m.type="scalarType",m}case 4:{const m={nullable:!1,columnScope:0},y={type:"physicalType",physicalType:0};return m.type="complexType",m.complexType=y,m}case 30:{const m={nullable:!1,columnScope:0},y={type:"physicalType",physicalType:1};return m.type="complexType",m.complexType=y,m}default:return(function(m){let y=null;switch(m){case 10:case 11:y=0;break;case 12:case 13:y=1;break;case 14:case 15:y=2;break;case 16:case 17:y=3;break;case 18:case 19:y=4;break;case 20:case 21:y=5;break;case 22:case 23:y=6;break;case 24:case 25:y=7;break;case 26:case 27:y=8;break;case 28:case 29:y=9;break;default:return null}const w={};w.nullable=!!(1&m),w.columnScope=0;const E={type:"physicalType"};return E.physicalType=y,w.type="scalarType",w.scalarType=E,w})(f)}})(n);if(!l)throw new Error(`Unsupported column type code: ${n}`);if((function(f){return f>=10})(n)?l.name=Ou(i,e):n>=0&&n<=3?l.name="id":n===4&&(l.name="geometry"),(function(f){return f===30})(n)){const f=qr(i,e,1)[0]>>>0,m=l.complexType;m.children=new Array(f);for(let y=0;y<f;y++)m.children[y]=Nu(i,e)}return l}function vd(i,e){const n={featureTables:[]},l={};l.name=Ou(i,e);const f=qr(i,e,1)[0]>>>0,m=qr(i,e,1)[0]>>>0;l.columns=new Array(m);for(let y=0;y<m;y++)l.columns[y]=Ec(i,e);return n.featureTables.push(l),[n,f]}function xd(i,e,n,l,f,m,y=!1){const w=e.scalarType.physicalType,E=zu(f,m,i,n);if(w===4)switch(E){case sa.FLAT:{const R=Ua(i,n,f,!1);return new ap(l,R,m)}case sa.SEQUENCE:{const R=Ag(i,n,f);return new gm(l,R[0],R[1],f.numRleValues)}case sa.CONST:{const R=xm(i,n,f,!1);return new op(l,R,m)}}else switch(E){case sa.FLAT:{if(y){const N=(function(j,q,Z,$){const Q=(function(ee,se,Te){const ue=new Float64Array(se);for(let pe=0;pe<se;pe++)ue[pe]=Fo(ee,Te);return ue})(j,Z.numValues,q);return(function(ee,se,Te){switch(se.logicalLevelTechnique1){case Bn.DELTA:return se.logicalLevelTechnique2===Bn.RLE&&(ee=ym(ee,se.runs,se.numRleValues)),(function(ue){ue[0]=ue[0]%2==1?(ue[0]+1)/-2:ue[0]/2;const pe=ue.length/4*4;let ke=1;if(pe>=4)for(;ke<pe-4;ke+=4){const ze=ue[ke],ot=ue[ke+1],Et=ue[ke+2],xt=ue[ke+3];ue[ke]=(ze%2==1?(ze+1)/-2:ze/2)+ue[ke-1],ue[ke+1]=(ot%2==1?(ot+1)/-2:ot/2)+ue[ke],ue[ke+2]=(Et%2==1?(Et+1)/-2:Et/2)+ue[ke+1],ue[ke+3]=(xt%2==1?(xt+1)/-2:xt/2)+ue[ke+2]}for(;ke!=ue.length;++ke)ue[ke]=(ue[ke]%2==1?(ue[ke]+1)/-2:ue[ke]/2)+ue[ke-1]})(ee),ee;case Bn.RLE:return(function(ue,pe,ke){return ym(ue,pe.runs,pe.numRleValues)})(ee,se);case Bn.NONE:return ee;default:throw new Error(`The specified Logical level technique is not supported: ${se.logicalLevelTechnique1}`)}})(Q,Z)})(i,n,f);return new pd(l,N,m)}const R=Pg(i,n,f,!1);return new mf(l,R,m)}case sa.SEQUENCE:{const R=kg(i,n,f);return new bm(l,R[0],R[1],f.numRleValues)}case sa.CONST:{const R=Rg(i,n,f,!1);return new Mm(l,R,m)}}throw new Error("Vector type not supported for id column.")}class Mc{constructor(e,n){var l;switch(this._featureData=e,this.properties=this._featureData.properties||{},(l=this._featureData.geometry)===null||l===void 0?void 0:l.type){case oa.POINT:case oa.MULTIPOINT:this.type=1;break;case oa.LINESTRING:case oa.MULTILINESTRING:this.type=2;break;case oa.POLYGON:case oa.MULTIPOLYGON:this.type=3;break;default:this.type=0}this.extent=n,this.id=Number(this._featureData.id)}loadGeometry(){const e=[];for(const n of this._featureData.geometry.coordinates){const l=[];for(const f of n)l.push(new X(f.x,f.y));e.push(l)}return e}}class B_{constructor(e){this.features=[],this.featureTable=e,this.name=e.name,this.extent=e.extent,this.version=2,this.features=e.getFeatures(),this.length=this.features.length}feature(e){return new Mc(this.features[e],this.extent)}}class km{constructor(e){this.layers={};const n=(function(l,f,m=!0){const y=new Cg(0),w=[];for(;y.get()<l.length;){const E=qr(l,y,1)[0]>>>0,R=y.get()+E;if(R>l.length)throw new Error(`Block overruns tile: ${R} > ${l.length}`);if(qr(l,y,1)[0]>>>0!=1){y.set(R);continue}const N=vd(l,y),j=N[1],q=N[0].featureTables[0];let Z=null,$=null;const Q=[];let ee=0;for(const Te of q.columns){const ue=Te.name;if(ue==="id"){let pe=null;if(Te.nullable){const ze=ts(l,y),ot=y.get(),Et=mh(l,ze.numValues,y);y.set(ot+ze.byteLength),pe=new ns(Et,ze.numValues)}const ke=ts(l,y);ee=ke.decompressedCount,Z=xd(l,Te,y,ue,ke,pe??ee,m)}else if(ue==="geometry"){const pe=qr(l,y,1)[0];if(ee===0){const ke=y.get();ee=ts(l,y).decompressedCount,y.set(ke)}$=yd(l,pe,y,ee)}else{const pe=jg(Te)?qr(l,y,1)[0]:1;if(pe===0&&Te.type==="scalarType")continue;const ke=_p(l,y,Te,pe,ee);if(ke)if(Array.isArray(ke))for(const ze of ke)Q.push(ze);else Q.push(ke)}}const se=new O_(q.name,$,Z,Q,j);w.push(se),y.set(R)}return w})(new Uint8Array(e));this.layers=n.reduce(((l,f)=>Object.assign(Object.assign({},l),{[f.name]:new B_(f)})),{})}}class yl{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(e){return this.minX=Math.min(this.minX,e.x),this.minY=Math.min(this.minY,e.y),this.maxX=Math.max(this.maxX,e.x),this.maxY=Math.max(this.maxY,e.y),this}expandBy(e){return this.minX-=e,this.minY-=e,this.maxX+=e,this.maxY+=e,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(e){return this.expandBy(-e)}map(e){const n=new yl;return n.extend(e(new X(this.minX,this.minY))),n.extend(e(new X(this.maxX,this.minY))),n.extend(e(new X(this.minX,this.maxY))),n.extend(e(new X(this.maxX,this.maxY))),n}static fromPoints(e){const n=new yl;for(const l of e)n.extend(l);return n}contains(e){return e.x>=this.minX&&e.x<=this.maxX&&e.y>=this.minY&&e.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(e){return!this.empty()&&!e.empty()&&e.minX>=this.minX&&e.maxX<=this.maxX&&e.minY>=this.minY&&e.maxY<=this.maxY}intersects(e){return!this.empty()&&!e.empty()&&e.minX<=this.maxX&&e.maxX>=this.minX&&e.minY<=this.maxY&&e.maxY>=this.minY}}class F_{constructor(e,n){this.feature=e,this.type=e.type,this.properties=e.tags?e.tags:{},this.extent=n,"id"in e&&(typeof e.id=="string"?this.id=parseInt(e.id,10):typeof e.id!="number"||isNaN(e.id)||(this.id=e.id))}loadGeometry(){const e=[],n=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const l of n){const f=[];for(const m of l)f.push(new X(m[0],m[1]));e.push(f)}return e}}const bf="_geojsonTileLayer";function yp(i,e){e.writeVarintField(15,i.version||1),e.writeStringField(1,i.name||""),e.writeVarintField(5,i.extent||4096);const n={keys:[],values:[],keycache:{},valuecache:{}};for(let m=0;m<i.length;m++)n.feature=i.feature(m),e.writeMessage(2,Ug,n);const l=n.keys;for(const m of l)e.writeStringField(3,m);const f=n.values;for(const m of f)e.writeMessage(4,Tf,m)}function Ug(i,e){if(!i.feature)return;const n=i.feature;n.id!==void 0&&e.writeVarintField(1,n.id),e.writeMessage(2,j_,i),e.writeVarintField(3,n.type),e.writeMessage(4,Vg,n)}function j_(i,e){for(const n in i.feature?.properties){let l=i.feature.properties[n],f=i.keycache[n];if(l===null)continue;f===void 0&&(i.keys.push(n),f=i.keys.length-1,i.keycache[n]=f),e.writeVarint(f),typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"&&(l=JSON.stringify(l));const m=typeof l+":"+l;let y=i.valuecache[m];y===void 0&&(i.values.push(l),y=i.values.length-1,i.valuecache[m]=y),e.writeVarint(y)}}function wf(i,e){return(e<<3)+(7&i)}function bd(i){return i<<1^i>>31}function Vg(i,e){const n=i.loadGeometry(),l=i.type;let f=0,m=0;for(const y of n){let w=1;l===1&&(w=y.length),e.writeVarint(wf(1,w));const E=l===3?y.length-1:y.length;for(let R=0;R<E;R++){R===1&&l!==1&&e.writeVarint(wf(2,E-1));const N=y[R].x-f,j=y[R].y-m;e.writeVarint(bd(N)),e.writeVarint(bd(j)),f+=N,m+=j}i.type===3&&e.writeVarint(wf(7,1))}}function Tf(i,e){const n=typeof i;n==="string"?e.writeStringField(1,i):n==="boolean"?e.writeBooleanField(7,i):n==="number"&&(i%1!=0?e.writeDoubleField(3,i):i<0?e.writeSVarintField(6,i):e.writeVarintField(5,i))}class Pm{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ol(tt,16,0),this.grid3D=new Ol(tt,16,0),this.featureIndexArray=new H,this.promoteId=n}insert(e,n,l,f,m,y){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,f,m);const E=y?this.grid3D:this.grid;for(let R=0;R<n.length;R++){const N=n[R],j=[1/0,1/0,-1/0,-1/0];for(let q=0;q<N.length;q++){const Z=N[q];j[0]=Math.min(j[0],Z.x),j[1]=Math.min(j[1],Z.y),j[2]=Math.max(j[2],Z.x),j[3]=Math.max(j[3],Z.y)}j[0]<tt&&j[1]<tt&&j[2]>=0&&j[3]>=0&&E.insert(w,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=this.encoding!=="mlt"?new yi(new id(this.rawTileData)).layers:new km(this.rawTileData).layers,this.sourceLayerCoder=new ip(this.vtLayers?Object.keys(this.vtLayers).sort():[bf])),this.vtLayers}query(e,n,l,f){this.loadVTLayers();const m=e.params,y=tt/e.tileSize/e.scale,w=Xa(m.filter,m.globalState),E=e.queryGeometry,R=e.queryPadding*y,N=yl.fromPoints(E),j=this.grid.query(N.minX-R,N.minY-R,N.maxX+R,N.maxY+R),q=yl.fromPoints(e.cameraQueryGeometry).expandBy(R),Z=this.grid3D.query(q.minX,q.minY,q.maxX,q.maxY,((ee,se,Te,ue)=>(function(pe,ke,ze,ot,Et){for(const Lt of pe)if(ke<=Lt.x&&ze<=Lt.y&&ot>=Lt.x&&Et>=Lt.y)return!0;const xt=[new X(ke,ze),new X(ke,Et),new X(ot,Et),new X(ot,ze)];if(pe.length>2){for(const Lt of xt)if(rh(pe,Lt))return!0}for(let Lt=0;Lt<pe.length-1;Lt++)if(Km(pe[Lt],pe[Lt+1],xt))return!0;return!1})(e.cameraQueryGeometry,ee-R,se-R,Te+R,ue+R)));for(const ee of Z)j.push(ee);j.sort(xp);const $={};let Q;for(let ee=0;ee<j.length;ee++){const se=j[ee];if(se===Q)continue;Q=se;const Te=this.featureIndexArray.get(se);let ue=null;this.loadMatchingFeature($,Te.bucketIndex,Te.sourceLayerIndex,Te.featureIndex,w,m.layers,m.availableImages,n,l,f,((pe,ke,ze)=>(ue||(ue=xs(pe)),ke.queryIntersectsFeature({queryGeometry:E,feature:pe,featureState:ze,geometry:ue,zoom:this.z,transform:e.transform,pixelsToTileUnits:y,pixelPosMatrix:e.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:e.getElevation}))))}return $}loadMatchingFeature(e,n,l,f,m,y,w,E,R,N,j){const q=this.bucketLayerIDs[n];if(y&&!q.some((ee=>y.has(ee))))return;const Z=this.sourceLayerCoder.decode(l),$=this.vtLayers[Z].feature(f);if(m.needGeometry){const ee=Gl($,!0);if(!m.filter(new Hn(this.tileID.overscaledZ),ee,this.tileID.canonical))return}else if(!m.filter(new Hn(this.tileID.overscaledZ),$))return;const Q=this.getId($,Z);for(let ee=0;ee<q.length;ee++){const se=q[ee];if(y&&!y.has(se))continue;const Te=E[se];if(!Te)continue;let ue={};Q&&N&&(ue=N.getState(Te.sourceLayer||bf,Q));const pe=Qe({},R[se]);pe.paint=vp(pe.paint,Te.paint,$,ue,w),pe.layout=vp(pe.layout,Te.layout,$,ue,w);const ke=!j||j($,Te,ue);if(!ke)continue;const ze=new rp($,this.z,this.x,this.y,Q);ze.layer=pe;let ot=e[se];ot===void 0&&(ot=e[se]=[]),ot.push({featureIndex:f,feature:ze,intersectionZ:ke})}}lookupSymbolFeatures(e,n,l,f,m,y,w,E){const R={};this.loadVTLayers();const N=Xa(m.filterSpec,m.globalState);for(const j of e)this.loadMatchingFeature(R,l,f,j,N,y,w,E,n);return R}hasLayer(e){for(const n of this.bucketLayerIDs)for(const l of n)if(e===l)return!0;return!1}getId(e,n){var l;let f=e.id;return this.promoteId&&(f=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof f=="boolean"&&(f=Number(f)),f===void 0&&(!((l=e.properties)===null||l===void 0)&&l.cluster)&&this.promoteId&&(f=Number(e.properties.cluster_id))),f}}function vp(i,e,n,l,f){return Rn(i,((m,y)=>{const w=e instanceof xu?e.get(y):null;return w&&w.evaluate?w.evaluate(n,l,f):w}))}function xp(i,e){return e-i}function Rm(i,e,n,l,f){const m=[];for(let y=0;y<i.length;y++){const w=i[y];let E;for(let R=0;R<w.length-1;R++){let N=w[R],j=w[R+1];N.x<e&&j.x<e||(N.x<e?N=new X(e,N.y+(e-N.x)/(j.x-N.x)*(j.y-N.y))._round():j.x<e&&(j=new X(e,N.y+(e-N.x)/(j.x-N.x)*(j.y-N.y))._round()),N.y<n&&j.y<n||(N.y<n?N=new X(N.x+(n-N.y)/(j.y-N.y)*(j.x-N.x),n)._round():j.y<n&&(j=new X(N.x+(n-N.y)/(j.y-N.y)*(j.x-N.x),n)._round()),N.x>=l&&j.x>=l||(N.x>=l?N=new X(l,N.y+(l-N.x)/(j.x-N.x)*(j.y-N.y))._round():j.x>=l&&(j=new X(l,N.y+(l-N.x)/(j.x-N.x)*(j.y-N.y))._round()),N.y>=f&&j.y>=f||(N.y>=f?N=new X(N.x+(f-N.y)/(j.y-N.y)*(j.x-N.x),f)._round():j.y>=f&&(j=new X(N.x+(f-N.y)/(j.y-N.y)*(j.x-N.x),f)._round()),E&&N.equals(E[E.length-1])||(E=[N],m.push(E)),E.push(j)))))}}return m}function Gg(i,e,n,l,f){switch(e){case 1:return(function(m,y,w,E){const R=[];for(const N of m)for(const j of N){const q=E===0?j.x:j.y;q>=y&&q<=w&&R.push([j])}return R})(i,n,l,f);case 2:return r(i,n,l,f,!1);case 3:return r(i,n,l,f,!0)}return[]}function bp(i,e,n,l,f){const m=l===0?s:d;let y=[];const w=[];for(let N=0;N<i.length-1;N++){const j=i[N],q=i[N+1],Z=l===0?j.x:j.y,$=l===0?q.x:q.y;let Q=!1;Z<e?$>e&&y.push(m(j,q,e)):Z>n?$<n&&y.push(m(j,q,n)):y.push(j),$<e&&Z>=e&&(y.push(m(j,q,e)),Q=!0),$>n&&Z<=n&&(y.push(m(j,q,n)),Q=!0),!f&&Q&&(w.push(y),y=[])}const E=i.length-1,R=l===0?i[E].x:i[E].y;return R>=e&&R<=n&&y.push(i[E]),f&&y.length>0&&!y[0].equals(y[y.length-1])&&y.push(new X(y[0].x,y[0].y)),y.length>0&&w.push(y),w}function r(i,e,n,l,f){const m=[];for(const y of i){const w=bp(y,e,n,l,f);w.length>0&&m.push(...w)}return m}function s(i,e,n){return new X(n,i.y+(n-i.x)/(e.x-i.x)*(e.y-i.y))}function d(i,e,n){return new X(i.x+(n-i.y)/(e.y-i.y)*(e.x-i.x),n)}Xt("FeatureIndex",Pm,{omit:["rawTileData","sourceLayerCoder"]});class x extends X{constructor(e,n,l,f){super(e,n),this.angle=l,f!==void 0&&(this.segment=f)}clone(){return new x(this.x,this.y,this.angle,this.segment)}}function A(i,e,n,l,f){if(e.segment===void 0||n===0)return!0;let m=e,y=e.segment+1,w=0;for(;w>-n/2;){if(y--,y<0)return!1;w-=i[y].dist(m),m=i[y]}w+=i[y].dist(i[y+1]),y++;const E=[];let R=0;for(;w<n/2;){const N=i[y],j=i[y+1];if(!j)return!1;let q=i[y-1].angleTo(N)-N.angleTo(j);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:q}),R+=q;w-E[0].distance>l;)R-=E.shift().angleDelta;if(R>f)return!1;y++,w+=N.dist(j)}return!0}function O(i){let e=0;for(let n=0;n<i.length-1;n++)e+=i[n].dist(i[n+1]);return e}function W(i,e,n){return i?.6*e*n:0}function ce(i,e){return Math.max(i?i.right-i.left:0,e?e.right-e.left:0)}function Ve(i,e,n,l,f,m){const y=W(n,f,m),w=ce(n,l)*m;let E=0;const R=O(i)/2;for(let N=0;N<i.length-1;N++){const j=i[N],q=i[N+1],Z=j.dist(q);if(E+Z>R){const $=(R-E)/Z,Q=Li.number(j.x,q.x,$),ee=Li.number(j.y,q.y,$),se=new x(Q,ee,q.angleTo(j),N);return se._round(),!y||A(i,se,w,y,e)?se:void 0}E+=Z}}function _t(i,e,n,l,f,m,y,w,E){const R=W(l,m,y),N=ce(l,f),j=N*y,q=i[0].x===0||i[0].x===E||i[0].y===0||i[0].y===E;return e-j<e/4&&(e=j+e/4),kt(i,q?e/2*w%e:(N/2+2*m)*y*w%e,e,R,n,j,q,!1,E)}function kt(i,e,n,l,f,m,y,w,E){const R=m/2,N=O(i);let j=0,q=e-n,Z=[];for(let $=0;$<i.length-1;$++){const Q=i[$],ee=i[$+1],se=Q.dist(ee),Te=ee.angleTo(Q);for(;q+n<j+se;){q+=n;const ue=(q-j)/se,pe=Li.number(Q.x,ee.x,ue),ke=Li.number(Q.y,ee.y,ue);if(pe>=0&&pe<E&&ke>=0&&ke<E&&q-R>=0&&q+R<=N){const ze=new x(pe,ke,Te,$);ze._round(),l&&!A(i,ze,m,l,f)||Z.push(ze)}}j+=se}return w||Z.length||y||(Z=kt(i,j/2,n,l,f,m,y,!0,E)),Z}function Ft(i,e,n,l){const f=[],m=i.image,y=m.pixelRatio,w=m.paddedRect.w-2,E=m.paddedRect.h-2;let R={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const N=m.stretchX||[[0,w]],j=m.stretchY||[[0,E]],q=(mt,en)=>mt+en[1]-en[0],Z=N.reduce(q,0),$=j.reduce(q,0),Q=w-Z,ee=E-$;let se=0,Te=Z,ue=0,pe=$,ke=0,ze=Q,ot=0,Et=ee;if(m.content&&l){const mt=m.content,en=mt[2]-mt[0],Kt=mt[3]-mt[1];(m.textFitWidth||m.textFitHeight)&&(R=Wd(i)),se=yt(N,0,mt[0]),ue=yt(j,0,mt[1]),Te=yt(N,mt[0],mt[2]),pe=yt(j,mt[1],mt[3]),ke=mt[0]-se,ot=mt[1]-ue,ze=en-Te,Et=Kt-pe}const xt=R.x1,Lt=R.y1,Ht=R.x2-xt,zt=R.y2-Lt,Tt=(mt,en,Kt,nn)=>{const $t=un(mt.stretch-se,Te,Ht,xt),hn=En(mt.fixed-ke,ze,mt.stretch,Z),ti=un(en.stretch-ue,pe,zt,Lt),Gn=En(en.fixed-ot,Et,en.stretch,$),lr=un(Kt.stretch-se,Te,Ht,xt),is=En(Kt.fixed-ke,ze,Kt.stretch,Z),la=un(nn.stretch-ue,pe,zt,Lt),ur=En(nn.fixed-ot,Et,nn.stretch,$),nr=new X($t,ti),wi=new X(lr,ti),wr=new X(lr,la),Or=new X($t,la),Yi=new X(hn/y,Gn/y),lo=new X(is/y,ur/y),rs=e*Math.PI/180;if(rs){const Ma=Math.sin(rs),mr=Math.cos(rs),ua=[mr,-Ma,Ma,mr];nr._matMult(ua),wi._matMult(ua),Or._matMult(ua),wr._matMult(ua)}const uo=mt.stretch+mt.fixed,Xl=en.stretch+en.fixed;return{tl:nr,tr:wi,bl:Or,br:wr,tex:{x:m.paddedRect.x+1+uo,y:m.paddedRect.y+1+Xl,w:Kt.stretch+Kt.fixed-uo,h:nn.stretch+nn.fixed-Xl},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yi,pixelOffsetBR:lo,minFontScaleX:ze/y/Ht,minFontScaleY:Et/y/zt,isSDF:n}};if(l&&(m.stretchX||m.stretchY)){const mt=bt(N,Q,Z),en=bt(j,ee,$);for(let Kt=0;Kt<mt.length-1;Kt++){const nn=mt[Kt],$t=mt[Kt+1];for(let hn=0;hn<en.length-1;hn++)f.push(Tt(nn,en[hn],$t,en[hn+1]))}}else f.push(Tt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return f}function yt(i,e,n){let l=0;for(const f of i)l+=Math.max(e,Math.min(n,f[1]))-Math.max(e,Math.min(n,f[0]));return l}function bt(i,e,n){const l=[{fixed:-1,stretch:0}];for(const[f,m]of i){const y=l[l.length-1];l.push({fixed:f-y.stretch,stretch:y.stretch}),l.push({fixed:f-y.stretch,stretch:y.stretch+(m-f)})}return l.push({fixed:e+1,stretch:n}),l}function un(i,e,n,l){return i/e*n+l}function En(i,e,n,l){return i-e*n/l}Xt("Anchor",x);class Ai{constructor(e,n,l,f,m,y,w,E,R,N){var j;if(this.boxStartIndex=e.length,R){let q=y.top,Z=y.bottom;const $=y.collisionPadding;$&&(q-=$[1],Z+=$[3]);let Q=Z-q;Q>0&&(Q=Math.max(10,Q),this.circleDiameter=Q)}else{const q=!((j=y.image)===null||j===void 0)&&j.content&&(y.image.textFitWidth||y.image.textFitHeight)?Wd(y):{x1:y.left,y1:y.top,x2:y.right,y2:y.bottom};q.y1=q.y1*w-E[0],q.y2=q.y2*w+E[2],q.x1=q.x1*w-E[3],q.x2=q.x2*w+E[1];const Z=y.collisionPadding;if(Z&&(q.x1-=Z[0]*w,q.y1-=Z[1]*w,q.x2+=Z[2]*w,q.y2+=Z[3]*w),N){const $=new X(q.x1,q.y1),Q=new X(q.x2,q.y1),ee=new X(q.x1,q.y2),se=new X(q.x2,q.y2),Te=N*Math.PI/180;$._rotate(Te),Q._rotate(Te),ee._rotate(Te),se._rotate(Te),q.x1=Math.min($.x,Q.x,ee.x,se.x),q.x2=Math.max($.x,Q.x,ee.x,se.x),q.y1=Math.min($.y,Q.y,ee.y,se.y),q.y2=Math.max($.y,Q.y,ee.y,se.y)}e.emplaceBack(n.x,n.y,q.x1,q.y1,q.x2,q.y2,l,f,m)}this.boxEndIndex=e.length}}class rt{constructor(e=[],n=(l,f)=>l<f?-1:l>f?1:0){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:l}=this,f=n[e];for(;e>0;){const m=e-1>>1,y=n[m];if(l(f,y)>=0)break;n[e]=y,e=m}n[e]=f}_down(e){const{data:n,compare:l}=this,f=this.length>>1,m=n[e];for(;e<f;){let y=1+(e<<1);const w=y+1;if(w<this.length&&l(n[w],n[y])<0&&(y=w),l(n[y],m)>=0)break;n[e]=n[y],e=y}n[e]=m}}function We(i,e=1,n=!1){const l=yl.fromPoints(i[0]),f=Math.min(l.width(),l.height());let m=f/2;const y=new rt([],gt),{minX:w,minY:E,maxX:R,maxY:N}=l;if(f===0)return new X(w,E);for(let Z=w;Z<R;Z+=f)for(let $=E;$<N;$+=f)y.push(new Rt(Z+m,$+m,m,i));let j=(function(Z){let $=0,Q=0,ee=0;const se=Z[0];for(let Te=0,ue=se.length,pe=ue-1;Te<ue;pe=Te++){const ke=se[Te],ze=se[pe],ot=ke.x*ze.y-ze.x*ke.y;Q+=(ke.x+ze.x)*ot,ee+=(ke.y+ze.y)*ot,$+=3*ot}return new Rt(Q/$,ee/$,0,Z)})(i),q=y.length;for(;y.length;){const Z=y.pop();(Z.d>j.d||!j.d)&&(j=Z,n&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,q)),Z.max-j.d<=e||(m=Z.h/2,y.push(new Rt(Z.p.x-m,Z.p.y-m,m,i)),y.push(new Rt(Z.p.x+m,Z.p.y-m,m,i)),y.push(new Rt(Z.p.x-m,Z.p.y+m,m,i)),y.push(new Rt(Z.p.x+m,Z.p.y+m,m,i)),q+=4)}return n&&(console.log(`num probes: ${q}`),console.log(`best distance: ${j.d}`)),j.p}function gt(i,e){return e.max-i.max}function Rt(i,e,n,l){this.p=new X(i,e),this.h=n,this.d=(function(f,m){let y=!1,w=1/0;for(let E=0;E<m.length;E++){const R=m[E];for(let N=0,j=R.length,q=j-1;N<j;q=N++){const Z=R[N],$=R[q];Z.y>f.y!=$.y>f.y&&f.x<($.x-Z.x)*(f.y-Z.y)/($.y-Z.y)+Z.x&&(y=!y),w=Math.min(w,Sa(f,Z,$))}}return(y?1:-1)*Math.sqrt(w)})(this.p,l),this.max=this.d+this.h*Math.SQRT2}var ln;L.aQ=void 0,(ln=L.aQ||(L.aQ={}))[ln.center=1]="center",ln[ln.left=2]="left",ln[ln.right=3]="right",ln[ln.top=4]="top",ln[ln.bottom=5]="bottom",ln[ln["top-left"]=6]="top-left",ln[ln["top-right"]=7]="top-right",ln[ln["bottom-left"]=8]="bottom-left",ln[ln["bottom-right"]=9]="bottom-right";const ui=Number.POSITIVE_INFINITY;function gn(i,e){return e[1]!==ui?(function(n,l,f){let m=0,y=0;switch(l=Math.abs(l),f=Math.abs(f),n){case"top-right":case"top-left":case"top":y=f-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-f}switch(n){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}return[m,y]})(i,e[0],e[1]):(function(n,l){let f=0,m=0;l<0&&(l=0);const y=l/Math.SQRT2;switch(n){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-l;break;case"top":m=l-7}switch(n){case"top-right":case"bottom-right":f=-y;break;case"top-left":case"bottom-left":f=y;break;case"left":f=l;break;case"right":f=-l}return[f,m]})(i,e[0])}function Fn(i,e,n){var l;const f=i.layout,m=(l=f.get("text-variable-anchor-offset"))===null||l===void 0?void 0:l.evaluate(e,{},n);if(m){const w=m.values,E=[];for(let R=0;R<w.length;R+=2){const N=E[R]=w[R],j=w[R+1].map((q=>q*vi));N.startsWith("top")?j[1]-=7:N.startsWith("bottom")&&(j[1]+=7),E[R+1]=j}return new Ni(E)}const y=f.get("text-variable-anchor");if(y){let w;w=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[f.get("text-radial-offset").evaluate(e,{},n)*vi,ui]:f.get("text-offset").evaluate(e,{},n).map((R=>R*vi));const E=[];for(const R of y)E.push(R,gn(R,w));return new Ni(E)}return null}function Wn(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bi(i,e,n,l,f,m,y,w,E,R,N,j){let q=m.textMaxSize.evaluate(e,{});q===void 0&&(q=y);const Z=i.layers[0].layout,$=Z.get("icon-offset").evaluate(e,{},N),Q=qg(n.horizontal),ee=y/24,se=i.tilePixelRatio*ee,Te=i.tilePixelRatio*q/24,ue=i.tilePixelRatio*w,pe=i.tilePixelRatio*Z.get("symbol-spacing"),ke=Z.get("text-padding")*i.tilePixelRatio,ze=(function(Kt,nn,$t,hn=1){const ti=Kt.get("icon-padding").evaluate(nn,{},$t),Gn=ti&&ti.values;return[Gn[0]*hn,Gn[1]*hn,Gn[2]*hn,Gn[3]*hn]})(Z,e,N,i.tilePixelRatio),ot=Z.get("text-max-angle")/180*Math.PI,Et=Z.get("text-rotation-alignment")!=="viewport"&&Z.get("symbol-placement")!=="point",xt=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",Lt=Z.get("symbol-placement"),Ht=pe/2,zt=Z.get("icon-text-fit");let Tt;l&&zt!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(Tt=ad(l,n.vertical,zt,Z.get("icon-text-fit-padding"),$,ee)),Q&&(l=ad(l,Q,zt,Z.get("icon-text-fit-padding"),$,ee)));const mt=N?j.line.getGranularityForZoomLevel(N.z):1,en=(Kt,nn)=>{nn.x<0||nn.x>=tt||nn.y<0||nn.y>=tt||(function($t,hn,ti,Gn,lr,is,la,ur,nr,wi,wr,Or,Yi,lo,rs,uo,Xl,Ma,mr,ua,Tr,Ca,_h,Fu,zm){const Sf=$t.addToLineVertexArray(hn,ti);let wd,wp,Tp,Sp,Py=0,Ry=0,Dy=0,Ly=0,X_=-1,$_=-1;const yh={};let zy=zi("");if($t.allowVerticalPlacement&&Gn.vertical){const Ss=ur.layout.get("text-rotate").evaluate(Tr,{},Fu)+90;Tp=new Ai(nr,hn,wi,wr,Or,Gn.vertical,Yi,lo,rs,Ss),la&&(Sp=new Ai(nr,hn,wi,wr,Or,la,Xl,Ma,rs,Ss))}if(lr){const Ss=ur.layout.get("icon-rotate").evaluate(Tr,{}),vl=ur.layout.get("icon-text-fit")!=="none",Td=Ft(lr,Ss,_h,vl),Uu=la?Ft(la,Ss,_h,vl):void 0;wp=new Ai(nr,hn,wi,wr,Or,lr,Xl,Ma,!1,Ss),Py=4*Td.length;const Sd=$t.iconSizeData;let Cc=null;Sd.kind==="source"?(Cc=[ml*ur.layout.get("icon-size").evaluate(Tr,{})],Cc[0]>bs&&Dn(`${$t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Sd.kind==="composite"&&(Cc=[ml*Ca.compositeIconSizes[0].evaluate(Tr,{},Fu),ml*Ca.compositeIconSizes[1].evaluate(Tr,{},Fu)],(Cc[0]>bs||Cc[1]>bs)&&Dn(`${$t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),$t.addSymbols($t.icon,Td,Cc,ua,mr,Tr,L.aA.none,hn,Sf.lineStartIndex,Sf.lineLength,-1,Fu),X_=$t.icon.placedSymbolArray.length-1,Uu&&(Ry=4*Uu.length,$t.addSymbols($t.icon,Uu,Cc,ua,mr,Tr,L.aA.vertical,hn,Sf.lineStartIndex,Sf.lineLength,-1,Fu),$_=$t.icon.placedSymbolArray.length-1)}const Oy=Object.keys(Gn.horizontal);for(const Ss of Oy){const vl=Gn.horizontal[Ss];if(!wd){zy=zi(vl.text);const Uu=ur.layout.get("text-rotate").evaluate(Tr,{},Fu);wd=new Ai(nr,hn,wi,wr,Or,vl,Yi,lo,rs,Uu)}const Td=vl.positionedLines.length===1;if(Dy+=Bu($t,hn,vl,is,ur,rs,Tr,uo,Sf,Gn.vertical?L.aA.horizontal:L.aA.horizontalOnly,Td?Oy:[Ss],yh,X_,Ca,Fu),Td)break}Gn.vertical&&(Ly+=Bu($t,hn,Gn.vertical,is,ur,rs,Tr,uo,Sf,L.aA.vertical,["vertical"],yh,$_,Ca,Fu));const M0=wd?wd.boxStartIndex:$t.collisionBoxArray.length,C0=wd?wd.boxEndIndex:$t.collisionBoxArray.length,I0=Tp?Tp.boxStartIndex:$t.collisionBoxArray.length,A0=Tp?Tp.boxEndIndex:$t.collisionBoxArray.length,k0=wp?wp.boxStartIndex:$t.collisionBoxArray.length,P0=wp?wp.boxEndIndex:$t.collisionBoxArray.length,R0=Sp?Sp.boxStartIndex:$t.collisionBoxArray.length,D0=Sp?Sp.boxEndIndex:$t.collisionBoxArray.length;let ju=-1;const Yg=(Ss,vl)=>Ss&&Ss.circleDiameter?Math.max(Ss.circleDiameter,vl):vl;ju=Yg(wd,ju),ju=Yg(Tp,ju),ju=Yg(wp,ju),ju=Yg(Sp,ju);const Ny=ju>-1?1:0;Ny&&(ju*=zm/vi),$t.glyphOffsetArray.length>=vc.MAX_GLYPHS&&Dn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Tr.sortKey!==void 0&&$t.addToSortKeyRanges($t.symbolInstances.length,Tr.sortKey);const L0=Fn(ur,Tr,Fu),[z0,O0]=(function(Ss,vl){const Td=Ss.length,Uu=vl?.values;if(Uu?.length>0)for(let Sd=0;Sd<Uu.length;Sd+=2){const Cc=Uu[Sd+1];Ss.emplaceBack(L.aQ[Uu[Sd]],Cc[0],Cc[1])}return[Td,Ss.length]})($t.textAnchorOffsets,L0);$t.symbolInstances.emplaceBack(hn.x,hn.y,yh.right>=0?yh.right:-1,yh.center>=0?yh.center:-1,yh.left>=0?yh.left:-1,yh.vertical||-1,X_,$_,zy,M0,C0,I0,A0,k0,P0,R0,D0,wi,Dy,Ly,Py,Ry,Ny,0,Yi,ju,z0,O0)})(i,nn,Kt,n,l,f,Tt,i.layers[0],i.collisionBoxArray,e.index,e.sourceLayerIndex,i.index,se,[ke,ke,ke,ke],Et,E,ue,ze,xt,$,e,m,R,N,y)};if(Lt==="line")for(const Kt of Rm(e.geometry,0,0,tt,tt)){const nn=io(Kt,mt),$t=_t(nn,pe,ot,n.vertical||Q,l,24,Te,i.overscaling,tt);for(const hn of $t)Q&&S0(i,Q.text,Ht,hn)||en(nn,hn)}else if(Lt==="line-center"){for(const Kt of e.geometry)if(Kt.length>1){const nn=io(Kt,mt),$t=Ve(nn,ot,n.vertical||Q,l,24,Te);$t&&en(nn,$t)}}else if(e.type==="Polygon")for(const Kt of Il(e.geometry,0)){const nn=We(Kt,16);en(io(Kt[0],mt,!0),new x(nn.x,nn.y,0))}else if(e.type==="LineString")for(const Kt of e.geometry){const nn=io(Kt,mt);en(nn,new x(nn[0].x,nn[0].y,0))}else if(e.type==="Point")for(const Kt of e.geometry)for(const nn of Kt)en([nn],new x(nn.x,nn.y,0))}function Bu(i,e,n,l,f,m,y,w,E,R,N,j,q,Z,$){const Q=(function(Te,ue,pe,ke,ze,ot,Et,xt){const Lt=ke.layout.get("text-rotate").evaluate(ot,{})*Math.PI/180,Ht=[];for(const zt of ue.positionedLines)for(const Tt of zt.positionedGlyphs){if(!Tt.rect)continue;const mt=Tt.rect||{};let en=4,Kt=!0,nn=1,$t=0;const hn=(ze||xt)&&Tt.vertical,ti=Tt.metrics.advance*Tt.scale/2;if(xt&&ue.verticalizable&&($t=zt.lineOffset/2-(Tt.imageName?-(vi-Tt.metrics.width*Tt.scale)/2:(Tt.scale-1)*vi)),Tt.imageName){const Ma=Et[Tt.imageName];Kt=Ma.sdf,nn=Ma.pixelRatio,en=1/nn}const Gn=ze?[Tt.x+ti,Tt.y]:[0,0];let lr=ze?[0,0]:[Tt.x+ti+pe[0],Tt.y+pe[1]-$t],is=[0,0];hn&&(is=lr,lr=[0,0]);const la=Tt.metrics.isDoubleResolution?2:1,ur=(Tt.metrics.left-en)*Tt.scale-ti+lr[0],nr=(-Tt.metrics.top-en)*Tt.scale+lr[1],wi=ur+mt.w/la*Tt.scale/nn,wr=nr+mt.h/la*Tt.scale/nn,Or=new X(ur,nr),Yi=new X(wi,nr),lo=new X(ur,wr),rs=new X(wi,wr);if(hn){const Ma=new X(-ti,ti- -17),mr=-Math.PI/2,ua=12-ti,Tr=new X(22-ua,-(Tt.imageName?ua:0)),Ca=new X(...is);Or._rotateAround(mr,Ma)._add(Tr)._add(Ca),Yi._rotateAround(mr,Ma)._add(Tr)._add(Ca),lo._rotateAround(mr,Ma)._add(Tr)._add(Ca),rs._rotateAround(mr,Ma)._add(Tr)._add(Ca)}if(Lt){const Ma=Math.sin(Lt),mr=Math.cos(Lt),ua=[mr,-Ma,Ma,mr];Or._matMult(ua),Yi._matMult(ua),lo._matMult(ua),rs._matMult(ua)}const uo=new X(0,0),Xl=new X(0,0);Ht.push({tl:Or,tr:Yi,bl:lo,br:rs,tex:mt,writingMode:ue.writingMode,glyphOffset:Gn,sectionIndex:Tt.sectionIndex,isSDF:Kt,pixelOffsetTL:uo,pixelOffsetBR:Xl,minFontScaleX:0,minFontScaleY:0})}return Ht})(0,n,w,f,m,y,l,i.allowVerticalPlacement),ee=i.textSizeData;let se=null;ee.kind==="source"?(se=[ml*f.layout.get("text-size").evaluate(y,{})],se[0]>bs&&Dn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):ee.kind==="composite"&&(se=[ml*Z.compositeTextSizes[0].evaluate(y,{},$),ml*Z.compositeTextSizes[1].evaluate(y,{},$)],(se[0]>bs||se[1]>bs)&&Dn(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,Q,se,w,m,y,R,e,E.lineStartIndex,E.lineLength,q,$);for(const Te of N)j[Te]=i.text.placedSymbolArray.length-1;return 4*Q.length}function qg(i){for(const e in i)return i[e];return null}function S0(i,e,n,l){const f=i.compareText;if(e in f){const m=f[e];for(let y=m.length-1;y>=0;y--)if(l.dist(m[y])<n)return!0}else f[e]=[];return f[e].push(l),!1}const Iy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class U_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,l]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const f=l>>4;if(f!==1)throw new Error(`Got v${f} data when expected v1.`);const m=Iy[15&l];if(!m)throw new Error("Unrecognized array type.");const[y]=new Uint16Array(e,2,1),[w]=new Uint32Array(e,4,1);return new U_(w,y,m,e)}constructor(e,n=64,l=Float64Array,f){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const m=Iy.indexOf(this.ArrayType),y=2*e*this.ArrayType.BYTES_PER_ELEMENT,w=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(m<0)throw new Error(`Unexpected typed array class: ${l}.`);f&&f instanceof ArrayBuffer?(this.data=f,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+y+w+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+w+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+m]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=n,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return V_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:m,coords:y,nodeSize:w}=this,E=[0,m.length-1,0],R=[];for(;E.length;){const N=E.pop()||0,j=E.pop()||0,q=E.pop()||0;if(j-q<=w){for(let ee=q;ee<=j;ee++){const se=y[2*ee],Te=y[2*ee+1];se>=e&&se<=l&&Te>=n&&Te<=f&&R.push(m[ee])}continue}const Z=q+j>>1,$=y[2*Z],Q=y[2*Z+1];$>=e&&$<=l&&Q>=n&&Q<=f&&R.push(m[Z]),(N===0?e<=$:n<=Q)&&(E.push(q),E.push(Z-1),E.push(1-N)),(N===0?l>=$:f>=Q)&&(E.push(Z+1),E.push(j),E.push(1-N))}return R}within(e,n,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,w=[0,f.length-1,0],E=[],R=l*l;for(;w.length;){const N=w.pop()||0,j=w.pop()||0,q=w.pop()||0;if(j-q<=y){for(let ee=q;ee<=j;ee++)ky(m[2*ee],m[2*ee+1],e,n)<=R&&E.push(f[ee]);continue}const Z=q+j>>1,$=m[2*Z],Q=m[2*Z+1];ky($,Q,e,n)<=R&&E.push(f[Z]),(N===0?e-l<=$:n-l<=Q)&&(w.push(q),w.push(Z-1),w.push(1-N)),(N===0?e+l>=$:n+l>=Q)&&(w.push(Z+1),w.push(j),w.push(1-N))}return E}}function V_(i,e,n,l,f,m){if(f-l<=n)return;const y=l+f>>1;Ay(i,e,y,l,f,m),V_(i,e,n,l,y-1,1-m),V_(i,e,n,y+1,f,1-m)}function Ay(i,e,n,l,f,m){for(;f>l;){if(f-l>600){const R=f-l+1,N=n-l+1,j=Math.log(R),q=.5*Math.exp(2*j/3),Z=.5*Math.sqrt(j*q*(R-q)/R)*(N-R/2<0?-1:1);Ay(i,e,n,Math.max(l,Math.floor(n-N*q/R+Z)),Math.min(f,Math.floor(n+(R-N)*q/R+Z)),m)}const y=e[2*n+m];let w=l,E=f;for(Dm(i,e,l,n),e[2*f+m]>y&&Dm(i,e,l,f);w<E;){for(Dm(i,e,w,E),w++,E--;e[2*w+m]<y;)w++;for(;e[2*E+m]>y;)E--}e[2*l+m]===y?Dm(i,e,l,E):(E++,Dm(i,e,E,f)),E<=n&&(l=E+1),n<=E&&(f=E-1)}}function Dm(i,e,n,l){G_(i,n,l),G_(e,2*n,2*l),G_(e,2*n+1,2*l+1)}function G_(i,e,n){const l=i[e];i[e]=i[n],i[n]=l}function ky(i,e,n,l){const f=i-n,m=e-l;return f*f+m*m}var q_;L.cI=void 0,(q_=L.cI||(L.cI={})).create="create",q_.load="load",q_.fullLoad="fullLoad";let Zg=null,Lm=[];const Z_=1e3/60,Y_="loadTime",H_="fullLoadTime",E0={mark(i){performance.mark(i)},frame(i){const e=i;Zg!=null&&Lm.push(e-Zg),Zg=e},clearMetrics(){Zg=null,Lm=[],performance.clearMeasures(Y_),performance.clearMeasures(H_);for(const i in L.cI)performance.clearMarks(L.cI[i])},getPerformanceMetrics(){performance.measure(Y_,L.cI.create,L.cI.load),performance.measure(H_,L.cI.create,L.cI.fullLoad);const i=performance.getEntriesByName(Y_)[0].duration,e=performance.getEntriesByName(H_)[0].duration,n=Lm.length,l=1/(Lm.reduce(((m,y)=>m+y),0)/n/1e3),f=Lm.filter((m=>m>Z_)).reduce(((m,y)=>m+(y-Z_)/Z_),0);return{loadTime:i,fullLoadTime:e,fps:l,percentDroppedFrames:f/(n+f)*100,totalFrames:n}}};L.$=Ce,L.A=at,L.B=Xc,L.C=ic,L.D=on,L.E=Un,L.F=function([i,e,n]){return e+=90,e*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(e)*Math.sin(n),y:i*Math.sin(e)*Math.sin(n),z:i*Math.cos(n)}},L.G=Li,L.H=Hn,L.I=uf,L.J=Hc,L.K=function(i){if(Ri==null){const e=i.navigator?i.navigator.userAgent:null;Ri=!!i.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Ri},L.L=class{constructor(i,e){this.target=i,this.mapId=e,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new wg((()=>this.process())),this.subscription=wl(this.target,"message",(n=>this.receive(n)),!1),this.globalScope=Ia(self)?i:window}registerMessageHandler(i,e){this.messageHandlers[i]=e}unregisterMessageHandler(i){delete this.messageHandlers[i]}sendAsync(i,e){return new Promise(((n,l)=>{const f=Math.round(1e18*Math.random()).toString(36).substring(0,10),m=e?wl(e.signal,"abort",(()=>{m?.unsubscribe(),delete this.resolveRejects[f];const E={id:f,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)}),Jn):null;this.resolveRejects[f]={resolve:E=>{m?.unsubscribe(),n(E)},reject:E=>{m?.unsubscribe(),l(E)}};const y=[],w=Object.assign(Object.assign({},i),{id:f,sourceMapId:this.mapId,origin:location.origin,data:Bl(i.data,y)});this.target.postMessage(w,{transfer:y})}))}receive(i){const e=i.data,n=e.id;if(!(e.origin!=="file://"&&location.origin!=="file://"&&e.origin!=="resource://android"&&location.origin!=="resource://android"&&e.origin!==location.origin||e.targetMapId&&this.mapId!==e.targetMapId)){if(e.type==="<cancel>"){delete this.tasks[n];const l=this.abortControllers[n];return delete this.abortControllers[n],void(l&&l.abort())}if(Ia(self)||e.mustQueue)return this.tasks[n]=e,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,e)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),e=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),e&&this.processTask(i,e)}processTask(i,e){return c(this,void 0,void 0,(function*(){if(e.type==="<response>"){const f=this.resolveRejects[i];return delete this.resolveRejects[i],f?void(e.error?f.reject(ac(e.error)):f.resolve(ac(e.data))):void 0}if(!this.messageHandlers[e.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${e.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=ac(e.data),l=new AbortController;this.abortControllers[i]=l;try{const f=yield this.messageHandlers[e.type](e.sourceMapId,n,l);this.completeTask(i,null,f)}catch(f){this.completeTask(i,f)}}))}completeTask(i,e,n){const l=[];delete this.abortControllers[i];const f={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:e?Bl(e):null,data:Bl(n,l)};this.target.postMessage(f,{transfer:l})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},L.M=Je,L.N=function(){var i=new at(16);return at!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},L.O=function(i,e,n){var l,f,m,y,w,E,R,N,j,q,Z,$,Q=n[0],ee=n[1],se=n[2];return e===i?(i[12]=e[0]*Q+e[4]*ee+e[8]*se+e[12],i[13]=e[1]*Q+e[5]*ee+e[9]*se+e[13],i[14]=e[2]*Q+e[6]*ee+e[10]*se+e[14],i[15]=e[3]*Q+e[7]*ee+e[11]*se+e[15]):(f=e[1],m=e[2],y=e[3],w=e[4],E=e[5],R=e[6],N=e[7],j=e[8],q=e[9],Z=e[10],$=e[11],i[0]=l=e[0],i[1]=f,i[2]=m,i[3]=y,i[4]=w,i[5]=E,i[6]=R,i[7]=N,i[8]=j,i[9]=q,i[10]=Z,i[11]=$,i[12]=l*Q+w*ee+j*se+e[12],i[13]=f*Q+E*ee+q*se+e[13],i[14]=m*Q+R*ee+Z*se+e[14],i[15]=y*Q+N*ee+$*se+e[15]),i},L.P=X,L.Q=function(i,e,n){var l=n[0],f=n[1],m=n[2];return i[0]=e[0]*l,i[1]=e[1]*l,i[2]=e[2]*l,i[3]=e[3]*l,i[4]=e[4]*f,i[5]=e[5]*f,i[6]=e[6]*f,i[7]=e[7]*f,i[8]=e[8]*m,i[9]=e[9]*m,i[10]=e[10]*m,i[11]=e[11]*m,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},L.R=br,L.S=function(i,e,n){var l=e[0],f=e[1],m=e[2],y=e[3],w=e[4],E=e[5],R=e[6],N=e[7],j=e[8],q=e[9],Z=e[10],$=e[11],Q=e[12],ee=e[13],se=e[14],Te=e[15],ue=n[0],pe=n[1],ke=n[2],ze=n[3];return i[0]=ue*l+pe*w+ke*j+ze*Q,i[1]=ue*f+pe*E+ke*q+ze*ee,i[2]=ue*m+pe*R+ke*Z+ze*se,i[3]=ue*y+pe*N+ke*$+ze*Te,i[4]=(ue=n[4])*l+(pe=n[5])*w+(ke=n[6])*j+(ze=n[7])*Q,i[5]=ue*f+pe*E+ke*q+ze*ee,i[6]=ue*m+pe*R+ke*Z+ze*se,i[7]=ue*y+pe*N+ke*$+ze*Te,i[8]=(ue=n[8])*l+(pe=n[9])*w+(ke=n[10])*j+(ze=n[11])*Q,i[9]=ue*f+pe*E+ke*q+ze*ee,i[10]=ue*m+pe*R+ke*Z+ze*se,i[11]=ue*y+pe*N+ke*$+ze*Te,i[12]=(ue=n[12])*l+(pe=n[13])*w+(ke=n[14])*j+(ze=n[15])*Q,i[13]=ue*f+pe*E+ke*q+ze*ee,i[14]=ue*m+pe*R+ke*Z+ze*se,i[15]=ue*y+pe*N+ke*$+ze*Te,i},L.T=qi,L.U=function(i,e){const n={};for(let l=0;l<e.length;l++){const f=e[l];f in i&&(n[f]=i[f])}return n},L.V=_l,L.W=_n,L.X=ff,L.Y=tp,L.Z=Se,L._=c,L.a=he,L.a$=Sg,L.a0=It,L.a1=qs,L.a2=ws,L.a3=Tg,L.a4=cd,L.a5=tt,L.a6=function(i,e,n){if(!i)return e||{};if(!e)return i||{};const l=Mg(i),f=Mg(e);(function(y,w){w.removeAll&&(y.add.clear(),y.update.clear(),y.remove.clear(),w.remove.clear());for(const E of w.remove)y.add.delete(E),y.update.delete(E);for(const[E,R]of w.update){const N=y.update.get(E);N&&(w.update.set(E,Eg(N,R)),y.update.delete(E))}})(l,f);const m={};if((l.removeAll||f.removeAll)&&(m.removeAll=!0),m.remove=new Set([...l.remove,...f.remove]),m.add=new Map([...l.add,...f.add]),m.update=new Map([...l.update,...f.update]),m.remove.size&&m.add.size)for(const y of m.add.keys())m.remove.delete(y);return(function(y){const w={};return y.removeAll&&(w.removeAll=y.removeAll),y.remove&&(w.remove=Array.from(y.remove)),y.add&&(w.add=Array.from(y.add.values())),y.update&&(w.update=Array.from(y.update.values())),w})(m)},L.a7=function(i,e){if(i==null||i.type==null)return!0;if(i.type==="Feature")return fd(i,e)!=null;if(i.type==="FeatureCollection"){const n=new Set;for(const l of i.features){const f=fd(l,e);if(f==null||n.has(f))return!1;n.add(f)}return!0}return!1},L.a8=function(i,e){const n=new Map;if(!(i==null||i.type==null))if(i.type==="Feature")n.set(fd(i,e),i);else for(const l of i.features)n.set(fd(l,e),l);return n},L.a9=function(i,e,n){var l,f;if(e.removeAll)i.clear();else if(e.remove)for(const m of e.remove)i.delete(m);if(e.add)for(const m of e.add){const y=fd(m,n);y!=null&&i.set(y,m)}if(e.update)for(const m of e.update){let y=i.get(m.id);if(!y)continue;const w=!!m.newGeometry,E=m.removeAllProperties||((l=m.removeProperties)===null||l===void 0?void 0:l.length)>0||((f=m.addOrUpdateProperties)===null||f===void 0?void 0:f.length)>0;if((w||E)&&(y=Object.assign({},y),i.set(m.id,y),w&&(y.geometry=m.newGeometry),E)){if(y.properties=m.removeAllProperties?{}:Object.assign({},y.properties||{}),m.removeProperties)for(const R of m.removeProperties)delete y.properties[R];if(m.addOrUpdateProperties)for(const{key:R,value:N}of m.addOrUpdateProperties)y.properties[R]=N}}},L.aB=function(i,{uSize:e,uSizeT:n},{lowerSize:l,upperSize:f}){return i.kind==="source"?l/ml:i.kind==="composite"?Li.number(l/ml,f/ml,n):e},L.aC=function(i,e){var n=e[0],l=e[1],f=e[2],m=e[3],y=e[4],w=e[5],E=e[6],R=e[7],N=e[8],j=e[9],q=e[10],Z=e[11],$=e[12],Q=e[13],ee=e[14],se=e[15],Te=n*w-l*y,ue=n*E-f*y,pe=n*R-m*y,ke=l*E-f*w,ze=l*R-m*w,ot=f*R-m*E,Et=N*Q-j*$,xt=N*ee-q*$,Lt=N*se-Z*$,Ht=j*ee-q*Q,zt=j*se-Z*Q,Tt=q*se-Z*ee,mt=Te*Tt-ue*zt+pe*Ht+ke*Lt-ze*xt+ot*Et;return mt?(i[0]=(w*Tt-E*zt+R*Ht)*(mt=1/mt),i[1]=(f*zt-l*Tt-m*Ht)*mt,i[2]=(Q*ot-ee*ze+se*ke)*mt,i[3]=(q*ze-j*ot-Z*ke)*mt,i[4]=(E*Lt-y*Tt-R*xt)*mt,i[5]=(n*Tt-f*Lt+m*xt)*mt,i[6]=(ee*pe-$*ot-se*ue)*mt,i[7]=(N*ot-q*pe+Z*ue)*mt,i[8]=(y*zt-w*Lt+R*Et)*mt,i[9]=(l*Lt-n*zt-m*Et)*mt,i[10]=($*ze-Q*pe+se*Te)*mt,i[11]=(j*pe-N*ze-Z*Te)*mt,i[12]=(w*xt-y*Ht-E*Et)*mt,i[13]=(n*Ht-l*xt+f*Et)*mt,i[14]=(Q*ue-$*ke-ee*Te)*mt,i[15]=(N*ke-j*ue+q*Te)*mt,i):null},L.aD=Pe,L.aE=function(i){var e=i[0],n=i[1];return Math.sqrt(e*e+n*n)},L.aF=function(i){return i[0]=0,i[1]=0,i},L.aG=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i},L.aH=Kd,L.aI=Fe,L.aJ=function(i,e,n,l){const f=e.y-i.y,m=e.x-i.x,y=l.y-n.y,w=l.x-n.x,E=y*m-w*f;if(E===0)return null;const R=(w*(i.y-n.y)-y*(i.x-n.x))/E;return new X(i.x+R*m,i.y+R*f)},L.aK=Rm,L.aL=$h,L.aM=function(i){let e=1/0,n=1/0,l=-1/0,f=-1/0;for(const m of i)e=Math.min(e,m.x),n=Math.min(n,m.y),l=Math.max(l,m.x),f=Math.max(f,m.y);return[e,n,l,f]},L.aN=vi,L.aO=vt,L.aP=function(i,e,n,l,f=!1){if(!n[0]&&!n[1])return[0,0];const m=f?l==="map"?-i.bearingInRadians:0:l==="viewport"?i.bearingInRadians:0;if(m){const y=Math.sin(m),w=Math.cos(m);n=[n[0]*w-n[1]*y,n[0]*y+n[1]*w]}return[f?n[0]:vt(e,n[0],i.zoom),f?n[1]:vt(e,n[1],i.zoom)]},L.aR=fh,L.aS=Wn,L.aT=rd,L.aU=U_,L.aV=fn,L.aW=Bs,L.aX=Y,L.aY=Dt,L.aZ=ht,L.a_=Sr,L.aa=bf,L.ab=hd,L.ac=yl,L.ad=25,L.ae=np,L.af=i=>{const e=window.document.createElement("video");return e.muted=!0,new Promise((n=>{e.onloadstart=()=>{n(e)};for(const l of i){const f=window.document.createElement("source");Mt(l)||(e.crossOrigin="Anonymous"),f.src=l,e.appendChild(f)}}))},L.ag=Gt,L.ah=function(){return ni++},L.ai=t,L.aj=vc,L.ak=Xa,L.al=Gl,L.am=rp,L.an=function(i){const e={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((n,l,f,m)=>{const y=f||m;return e[l]=!y||y.toLowerCase(),""})),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e},L.ao=tn,L.ap=85.051129,L.aq=dn,L.ar=function(i){return Math.pow(2,i)},L.as=At,L.at=ud,L.au=function(i){return Math.log(i)/Math.LN2},L.av=function(i){var e=i[0],n=i[1];return e*e+n*n},L.aw=function(i){if(!i.length)return new Set;const e=Math.max(...i.map((E=>E.canonical.z)));let n=1/0,l=-1/0,f=1/0,m=-1/0;const y=[];for(const E of i){const{x:R,y:N,z:j}=E.canonical,q=Math.pow(2,e-j),Z=R*q,$=N*q;y.push({id:E,x:Z,y:$}),Z<n&&(n=Z),Z>l&&(l=Z),$<f&&(f=$),$>m&&(m=$)}const w=new Set;for(const E of y)E.x!==n&&E.x!==l&&E.y!==f&&E.y!==m||w.add(E.id);return w},L.ax=function(i,e){const n=Math.abs(2*i.wrap)-+(i.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return i.overscaledZ-e.overscaledZ||l-n||e.canonical.y-i.canonical.y||e.canonical.x-i.canonical.x},L.ay=class{constructor(i,e){this.max=i,this.onRemove=e,this.reset()}reset(){for(const i in this.data)for(const e of this.data[i])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(i,e,n){const l=i.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);const f={value:e,timeout:void 0};if(n!==void 0&&(f.timeout=setTimeout((()=>{this.remove(i,f)}),n)),this.data[l].push(f),this.order.push(l),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const e=this.data[i].shift();return e.timeout&&clearTimeout(e.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),e.value}getByKey(i){const e=this.data[i];return e?e[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,e){if(!this.has(i))return this;const n=i.wrapped().key,l=e===void 0?0:this.data[n].indexOf(e),f=this.data[n][l];return this.data[n].splice(l,1),f.timeout&&clearTimeout(f.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(f.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(i){const e=[];for(const n in this.data)for(const l of this.data[n])i(l.value)||e.push(l);for(const n of e)this.remove(n.value.tileID,n)}},L.az=function(i,e){let n=0,l=0;if(i.kind==="constant")l=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:f,minZoom:m,maxZoom:y}=i,w=f?tn(fa.interpolationFactor(f,e,m,y),0,1):0;i.kind==="camera"?l=Li.number(i.minSize,i.maxSize,w):n=w}return{uSizeT:n,uSize:l}},L.b=Gs,L.b$=class extends ga{constructor(i,e){super(i,e),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},L.b0=Ie,L.b1=de,L.b2=function(i){var e=new at(3);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e},L.b3=function(i,e,n){return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],i},L.b4=function(i,e){var n=e[0],l=e[1],f=e[2],m=n*n+l*l+f*f;return m>0&&(m=1/Math.sqrt(m)),i[0]=e[0]*m,i[1]=e[1]*m,i[2]=e[2]*m,i},L.b5=Xe,L.b6=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]},L.b7=function(i,e,n){return i[0]=e[0]*n[0],i[1]=e[1]*n[1],i[2]=e[2]*n[2],i[3]=e[3]*n[3],i},L.b8=wt,L.b9=function(i,e,n){const l=e[0]*n[0]+e[1]*n[1]+e[2]*n[2];return l===0?null:(-(i[0]*n[0]+i[1]*n[1]+i[2]*n[2])-n[3])/l},L.bA=function(){return new Float64Array(3)},L.bB=function(i,e,n,l){return i[0]=e[0]+n[0]*l,i[1]=e[1]+n[1]*l,i[2]=e[2]+n[2]*l,i},L.bC=me,L.bD=function(i,e,n){var l=n[0],f=n[1],m=n[2],y=n[3],w=e[0],E=e[1],R=e[2],N=f*R-m*E,j=m*w-l*R,q=l*E-f*w;return i[0]=w+y*(N+=N)+f*(q+=q)-m*(j+=j),i[1]=E+y*j+m*N-l*q,i[2]=R+y*q+l*j-f*N,i},L.bE=function(i,e,n){const l=(function(E){var R=E[3],N=E[4],j=E[5],q=E[6],Z=E[7],$=E[8];return E[0]*($*N-j*Z)+E[1]*(-$*R+j*q)+E[2]*(Z*R-N*q)})([i[0],i[1],i[2],e[0],e[1],e[2],n[0],n[1],n[2]]);if(l===0)return null;const f=Xe([],[e[0],e[1],e[2]],[n[0],n[1],n[2]]),m=Xe([],[n[0],n[1],n[2]],[i[0],i[1],i[2]]),y=Xe([],[i[0],i[1],i[2]],[e[0],e[1],e[2]]),w=Ie([],f,-i[3]);return de(w,w,Ie([],m,-e[3])),de(w,w,Ie([],y,-n[3])),Ie(w,w,1/l),w},L.bF=ld,L.bG=function(){return new Float64Array(4)},L.bH=function(i,e,n,l){var f=[],m=[];return f[0]=e[0]-n[0],f[1]=e[1]-n[1],f[2]=e[2]-n[2],m[0]=f[0]*Math.cos(l)-f[1]*Math.sin(l),m[1]=f[0]*Math.sin(l)+f[1]*Math.cos(l),m[2]=f[2],i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},L.bI=function(i,e,n,l){var f=[],m=[];return f[0]=e[0]-n[0],f[1]=e[1]-n[1],f[2]=e[2]-n[2],m[0]=f[0],m[1]=f[1]*Math.cos(l)-f[2]*Math.sin(l),m[2]=f[1]*Math.sin(l)+f[2]*Math.cos(l),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},L.bJ=function(i,e,n,l){var f=[],m=[];return f[0]=e[0]-n[0],f[1]=e[1]-n[1],f[2]=e[2]-n[2],m[0]=f[2]*Math.sin(l)+f[0]*Math.cos(l),m[1]=f[1],m[2]=f[2]*Math.cos(l)-f[0]*Math.sin(l),i[0]=m[0]+n[0],i[1]=m[1]+n[1],i[2]=m[2]+n[2],i},L.bK=function(i,e,n){var l=Math.sin(n),f=Math.cos(n),m=e[0],y=e[1],w=e[2],E=e[3],R=e[8],N=e[9],j=e[10],q=e[11];return e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*f-R*l,i[1]=y*f-N*l,i[2]=w*f-j*l,i[3]=E*f-q*l,i[8]=m*l+R*f,i[9]=y*l+N*f,i[10]=w*l+j*f,i[11]=E*l+q*f,i},L.bL=function(i,e){const n=Me(i,360),l=Me(e,360),f=l-n,m=l>n?f-360:f+360;return Math.abs(f)<Math.abs(m)?f:m},L.bM=function(i){return i[0]=0,i[1]=0,i[2]=0,i},L.bN=function(i,e,n,l){const f=Math.sqrt(i*i+e*e),m=Math.sqrt(n*n+l*l);i/=f,e/=f,n/=m,l/=m;const y=Math.acos(i*n+e*l);return-e*n+i*l>0?y:-y},L.bO=function(i,e){const n=Me(i,2*Math.PI),l=Me(e,2*Math.PI);return Math.min(Math.abs(n-l),Math.abs(n-l+2*Math.PI),Math.abs(n-l-2*Math.PI))},L.bP=function(){const i={},e=it.$version;for(const n in it.$root){const l=it.$root[n];if(l.required){let f=null;f=n==="version"?e:l.type==="array"?[]:{},f!=null&&(i[n]=f)}}return i},L.bQ=Ze,L.bR=_s,L.bS=function i(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let l=0;l<e.length;l++)if(!i(e[l],n[l]))return!1;return!0}if(typeof e=="object"&&e!==null&&n!==null){if(typeof n!="object"||Object.keys(e).length!==Object.keys(n).length)return!1;for(const l in e)if(!i(e[l],n[l]))return!1;return!0}return e===n},L.bT=function(i){i=i.slice();const e=Object.create(null);for(let n=0;n<i.length;n++)e[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=Hi(i[n],e[i[n].ref]));return i},L.bU=function(i,e){if(i.type==="custom")return new z_(i,e);switch(i.type){case"background":return new od(i,e);case"circle":return new Fp(i,e);case"color-relief":return new ig(i,e);case"fill":return new Wf(i,e);case"fill-extrusion":return new Dr(i,e);case"heatmap":return new Jm(i,e);case"hillshade":return new eg(i,e);case"line":return new _c(i,e);case"raster":return new Ka(i,e);case"symbol":return new hf(i,e)}},L.bV=i=>i.type==="raster",L.bW=Re,L.bX=function(i,e){if(!i)return[{command:"setStyle",args:[e]}];let n=[];try{if(!xn(i.version,e.version))return[{command:"setStyle",args:[e]}];xn(i.center,e.center)||n.push({command:"setCenter",args:[e.center]}),xn(i.state,e.state)||n.push({command:"setGlobalState",args:[e.state]}),xn(i.centerAltitude,e.centerAltitude)||n.push({command:"setCenterAltitude",args:[e.centerAltitude]}),xn(i.zoom,e.zoom)||n.push({command:"setZoom",args:[e.zoom]}),xn(i.bearing,e.bearing)||n.push({command:"setBearing",args:[e.bearing]}),xn(i.pitch,e.pitch)||n.push({command:"setPitch",args:[e.pitch]}),xn(i.roll,e.roll)||n.push({command:"setRoll",args:[e.roll]}),xn(i.sprite,e.sprite)||n.push({command:"setSprite",args:[e.sprite]}),xn(i.glyphs,e.glyphs)||n.push({command:"setGlyphs",args:[e.glyphs]}),xn(i.transition,e.transition)||n.push({command:"setTransition",args:[e.transition]}),xn(i.light,e.light)||n.push({command:"setLight",args:[e.light]}),xn(i.terrain,e.terrain)||n.push({command:"setTerrain",args:[e.terrain]}),xn(i.sky,e.sky)||n.push({command:"setSky",args:[e.sky]}),xn(i.projection,e.projection)||n.push({command:"setProjection",args:[e.projection]});const l={},f=[];(function(y,w,E,R){let N;for(N in w=w||{},y=y||{})Object.prototype.hasOwnProperty.call(y,N)&&(Object.prototype.hasOwnProperty.call(w,N)||Kn(N,E,R));for(N in w)Object.prototype.hasOwnProperty.call(w,N)&&(Object.prototype.hasOwnProperty.call(y,N)?xn(y[N],w[N])||(y[N].type==="geojson"&&w[N].type==="geojson"&&si(y,w,N)?Nt(E,{command:"setGeoJSONSourceData",args:[N,w[N].data]}):ki(N,w,E,R)):Xi(N,w,E))})(i.sources,e.sources,f,l);const m=[];i.layers&&i.layers.forEach((y=>{"source"in y&&l[y.source]?n.push({command:"removeLayer",args:[y.id]}):m.push(y)})),n=n.concat(f),(function(y,w,E){w=w||[];const R=(y=y||[]).map(qo),N=w.map(qo),j=y.reduce(Aa,{}),q=w.reduce(Aa,{}),Z=R.slice(),$=Object.create(null);let Q,ee,se,Te,ue;for(let pe=0,ke=0;pe<R.length;pe++)Q=R[pe],Object.prototype.hasOwnProperty.call(q,Q)?ke++:(Nt(E,{command:"removeLayer",args:[Q]}),Z.splice(Z.indexOf(Q,ke),1));for(let pe=0,ke=0;pe<N.length;pe++)Q=N[N.length-1-pe],Z[Z.length-1-pe]!==Q&&(Object.prototype.hasOwnProperty.call(j,Q)?(Nt(E,{command:"removeLayer",args:[Q]}),Z.splice(Z.lastIndexOf(Q,Z.length-ke),1)):ke++,Te=Z[Z.length-pe],Nt(E,{command:"addLayer",args:[q[Q],Te]}),Z.splice(Z.length-pe,0,Q),$[Q]=!0);for(let pe=0;pe<N.length;pe++)if(Q=N[pe],ee=j[Q],se=q[Q],!$[Q]&&!xn(ee,se))if(xn(ee.source,se.source)&&xn(ee["source-layer"],se["source-layer"])&&xn(ee.type,se.type)){for(ue in ji(ee.layout,se.layout,E,Q,null,"setLayoutProperty"),ji(ee.paint,se.paint,E,Q,null,"setPaintProperty"),xn(ee.filter,se.filter)||Nt(E,{command:"setFilter",args:[Q,se.filter]}),xn(ee.minzoom,se.minzoom)&&xn(ee.maxzoom,se.maxzoom)||Nt(E,{command:"setLayerZoomRange",args:[Q,se.minzoom,se.maxzoom]}),ee)Object.prototype.hasOwnProperty.call(ee,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?ji(ee[ue],se[ue],E,Q,ue.slice(6),"setPaintProperty"):xn(ee[ue],se[ue])||Nt(E,{command:"setLayerProperty",args:[Q,ue,se[ue]]}));for(ue in se)Object.prototype.hasOwnProperty.call(se,ue)&&!Object.prototype.hasOwnProperty.call(ee,ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&(ue.indexOf("paint.")===0?ji(ee[ue],se[ue],E,Q,ue.slice(6),"setPaintProperty"):xn(ee[ue],se[ue])||Nt(E,{command:"setLayerProperty",args:[Q,ue,se[ue]]}))}else Nt(E,{command:"removeLayer",args:[Q]}),Te=Z[Z.lastIndexOf(Q)+1],Nt(E,{command:"addLayer",args:[se,Te]})})(m,e.layers,n)}catch(l){console.warn("Unable to compute style diff:",l),n=[{command:"setStyle",args:[e]}]}return n},L.bY=function(i){const e=[],n=i.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},L.bZ=Rn,L.b_=rn,L.ba=He,L.bb=function(i,e,n){return i[0]=e[0]*n,i[1]=e[1]*n,i[2]=e[2]*n,i[3]=e[3]*n,i},L.bc=function(i,e){return i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]},L.bd=Oi,L.be=zr,L.bf=function(i,e,n,l,f){var m=1/Math.tan(e/2);if(i[0]=m/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,f!=null&&f!==1/0){var y=1/(l-f);i[10]=(f+l)*y,i[14]=2*f*l*y}else i[10]=-1,i[14]=-2*l;return i},L.bg=function(i){var e=new at(16);return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e},L.bh=function(i,e,n){var l=Math.sin(n),f=Math.cos(n),m=e[0],y=e[1],w=e[2],E=e[3],R=e[4],N=e[5],j=e[6],q=e[7];return e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[0]=m*f+R*l,i[1]=y*f+N*l,i[2]=w*f+j*l,i[3]=E*f+q*l,i[4]=R*f-m*l,i[5]=N*f-y*l,i[6]=j*f-w*l,i[7]=q*f-E*l,i},L.bi=function(i,e,n){var l=Math.sin(n),f=Math.cos(n),m=e[4],y=e[5],w=e[6],E=e[7],R=e[8],N=e[9],j=e[10],q=e[11];return e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]),i[4]=m*f+R*l,i[5]=y*f+N*l,i[6]=w*f+j*l,i[7]=E*f+q*l,i[8]=R*f-m*l,i[9]=N*f-y*l,i[10]=j*f-w*l,i[11]=q*f-E*l,i},L.bj=function(){const i=new Float32Array(16);return At(i),i},L.bk=function(){const i=new Float64Array(16);return At(i),i},L.bl=function(){return new Float64Array(16)},L.bm=function(i,e,n){const l=new Float64Array(4);return me(l,i,e-90,n),l},L.bn=function(i,e,n,l){var f,m,y,w,E,R=e[0],N=e[1],j=e[2],q=e[3],Z=n[0],$=n[1],Q=n[2],ee=n[3];return(m=R*Z+N*$+j*Q+q*ee)<0&&(m=-m,Z=-Z,$=-$,Q=-Q,ee=-ee),1-m>Ye?(f=Math.acos(m),y=Math.sin(f),w=Math.sin((1-l)*f)/y,E=Math.sin(l*f)/y):(w=1-l,E=l),i[0]=w*R+E*Z,i[1]=w*N+E*$,i[2]=w*j+E*Q,i[3]=w*q+E*ee,i},L.bo=function(i){const e=new Float64Array(9);(function(m,y){var w=y[0],E=y[1],R=y[2],N=y[3],j=w+w,q=E+E,Z=R+R,$=w*j,Q=E*j,ee=E*q,se=R*j,Te=R*q,ue=R*Z,pe=N*j,ke=N*q,ze=N*Z;m[0]=1-ee-ue,m[3]=Q-ze,m[6]=se+ke,m[1]=Q+ze,m[4]=1-$-ue,m[7]=Te-pe,m[2]=se-ke,m[5]=Te+pe,m[8]=1-$-ee})(e,i);const n=Sr(-Math.asin(tn(e[2],-1,1)));let l,f;return Math.hypot(e[5],e[8])<.001?(l=0,f=-Sr(Math.atan2(e[3],e[4]))):(l=Sr(e[5]===0&&e[8]===0?0:Math.atan2(e[5],e[8])),f=Sr(e[1]===0&&e[0]===0?0:Math.atan2(e[1],e[0]))),{roll:l,pitch:n+90,bearing:f}},L.bp=function(i,e){return i.roll==e.roll&&i.pitch==e.pitch&&i.bearing==e.bearing},L.bq=An,L.br=no,L.bs=oh,L.bt=Ea,L.bu=_a,L.bv=ut,L.bw=Ot,L.bx=mi,L.by=function(i,e,n,l,f){return ut(l,f,tn((i-e)/(n-e),0,1))},L.bz=Me,L.c=Ee,L.c$=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},L.c0=Tu,L.c1=class extends ga{constructor(i,e){super(i,e),this.current=Yh}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let e=1;e<16;e++)if(i[e]!==this.current[e]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},L.c2=fl,L.c3=class extends ga{constructor(i,e){super(i,e),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},L.c4=class extends ga{constructor(i,e){super(i,e),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},L.c5=jt,L.c6=function(i,e){var n=Math.sin(e),l=Math.cos(e);return i[0]=l,i[1]=n,i[2]=0,i[3]=-n,i[4]=l,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},L.c7=function(i,e,n){var l=e[0],f=e[1],m=e[2];return i[0]=l*n[0]+f*n[3]+m*n[6],i[1]=l*n[1]+f*n[4]+m*n[7],i[2]=l*n[2]+f*n[5]+m*n[8],i},L.c8=function(i,e,n,l,f,m,y){var w=1/(e-n),E=1/(l-f),R=1/(m-y);return i[0]=-2*w,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*E,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*R,i[11]=0,i[12]=(e+n)*w,i[13]=(f+l)*E,i[14]=(y+m)*R,i[15]=1,i},L.c9=class extends ga{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(4*i.length);for(let n=0;n<i.length;n++)e[4*n]=i[n].r,e[4*n+1]=i[n].g,e[4*n+2]=i[n].b,e[4*n+3]=i[n].a;this.gl.uniform4fv(this.location,e)}}},L.cA=function(i,e){return re[e]&&(i instanceof MouseEvent||i instanceof WheelEvent)},L.cB=function(i,e){return nt[e]&&"touches"in i},L.cC=function(i){return nt[i]||re[i]},L.cD=function(i,e,n){var l=e[0],f=e[1];return i[0]=n[0]*l+n[4]*f+n[12],i[1]=n[1]*l+n[5]*f+n[13],i},L.cE=function(i,e){const{x:n,y:l}=hd.fromLngLat(e);return!(i<0||i>25||l<0||l>=1||n<0||n>=1)},L.cF=function(i,e){return i[0]=e[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=e[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=e[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},L.cG=class extends bu{},L.cH=E0,L.cJ=qe,L.cK=function(i,e){Ee.REGISTERED_PROTOCOLS[i]=e},L.cL=function(i){delete Ee.REGISTERED_PROTOCOLS[i]},L.cM=function(i,e){const n={};for(let f=0;f<i.length;f++){const m=e&&e[i[f].id]||Jo(i[f]);e&&(e[i[f].id]=m);let y=n[m];y||(y=n[m]=[]),y.push(i[f])}const l=[];for(const f in n)l.push(n[f]);return l},L.cN=Xt,L.cO=ip,L.cP=Pm,L.cQ=lm,L.cR=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=tt/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const e=i.bucket.layers[0],n=e.layout,l=e._unevaluatedLayout._values,f={layoutIconSize:l["icon-size"].possiblyEvaluate(new Hn(i.bucket.zoom+1),i.canonical),layoutTextSize:l["text-size"].possiblyEvaluate(new Hn(i.bucket.zoom+1),i.canonical),textMaxSize:l["text-size"].possiblyEvaluate(new Hn(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:R,maxZoom:N}=i.bucket.textSizeData;f.compositeTextSizes=[l["text-size"].possiblyEvaluate(new Hn(R),i.canonical),l["text-size"].possiblyEvaluate(new Hn(N),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:R,maxZoom:N}=i.bucket.iconSizeData;f.compositeIconSizes=[l["icon-size"].possiblyEvaluate(new Hn(R),i.canonical),l["icon-size"].possiblyEvaluate(new Hn(N),i.canonical)]}const m=n.get("text-line-height")*vi,y=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",w=n.get("text-keep-upright"),E=n.get("text-size");for(const R of i.bucket.features){const N=n.get("text-font").evaluate(R,{},i.canonical).join(","),j=E.evaluate(R,{},i.canonical),q=f.layoutTextSize.evaluate(R,{},i.canonical),Z=f.layoutIconSize.evaluate(R,{},i.canonical),$={horizontal:{},vertical:void 0},Q=R.text;let ee,se=[0,0];if(Q){const pe=Q.toString(),ke=n.get("text-letter-spacing").evaluate(R,{},i.canonical)*vi,ze=Kc(pe)?ke:0,ot=n.get("text-anchor").evaluate(R,{},i.canonical),Et=Fn(e,R,i.canonical);if(!Et){const zt=n.get("text-radial-offset").evaluate(R,{},i.canonical);se=zt?gn(ot,[zt*vi,ui]):n.get("text-offset").evaluate(R,{},i.canonical).map((Tt=>Tt*vi))}let xt=y?"center":n.get("text-justify").evaluate(R,{},i.canonical);const Lt=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(R,{},i.canonical)*vi:1/0,Ht=()=>{i.bucket.allowVerticalPlacement&&Ns(pe)&&($.vertical=xi(Q,i.glyphMap,i.glyphPositions,i.imagePositions,N,Lt,m,ot,"left",ze,se,L.aA.vertical,!0,q,j))};if(!y&&Et){const zt=new Set;if(xt==="auto")for(let mt=0;mt<Et.values.length;mt+=2)zt.add(Wn(Et.values[mt]));else zt.add(xt);let Tt=!1;for(const mt of zt)if(!$.horizontal[mt])if(Tt)$.horizontal[mt]=$.horizontal[0];else{const en=xi(Q,i.glyphMap,i.glyphPositions,i.imagePositions,N,Lt,m,"center",mt,ze,se,L.aA.horizontal,!1,q,j);en&&($.horizontal[mt]=en,Tt=en.positionedLines.length===1)}Ht()}else{xt==="auto"&&(xt=Wn(ot));const zt=xi(Q,i.glyphMap,i.glyphPositions,i.imagePositions,N,Lt,m,ot,xt,ze,se,L.aA.horizontal,!1,q,j);zt&&($.horizontal[xt]=zt),Ht(),Ns(pe)&&y&&w&&($.vertical=xi(Q,i.glyphMap,i.glyphPositions,i.imagePositions,N,Lt,m,ot,xt,ze,se,L.aA.vertical,!1,q,j))}}let Te=!1;if(R.icon&&R.icon.name){const pe=i.imageMap[R.icon.name];pe&&(ee=cf(i.imagePositions[R.icon.name],n.get("icon-offset").evaluate(R,{},i.canonical),n.get("icon-anchor").evaluate(R,{},i.canonical)),Te=!!pe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=Te:i.bucket.sdfIcons!==Te&&Dn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pe.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ue=qg($.horizontal)||$.vertical;i.bucket.iconsInText=!!ue&&ue.iconsInText,(ue||ee)&&bi(i.bucket,R,$,ee,i.imageMap,f,q,Z,se,Te,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},L.cS=ro,L.cT=Ii,L.cU=sf,L.cV=function(i){const e=new id;return(function(n,l){for(const f in n.layers)l.writeMessage(3,yp,n.layers[f])})(i,e),e.finish()},L.cW=function(i,e,n,l,f,m){let y=Gg(i,e,n,f,0);return y=Gg(y,e,l,m,1),y},L.cX=class{constructor(i){this.maxEntries=i,this.map=new Map}get(i){const e=this.map.get(i);return e!==void 0&&(this.map.delete(i),this.map.set(i,e)),e}set(i,e){if(this.map.has(i))this.map.delete(i);else if(this.map.size>=this.maxEntries){const n=this.map.keys().next().value;this.map.delete(n)}this.map.set(i,e)}clear(){this.map.clear()}},L.cY=yi,L.cZ=id,L.c_=km,L.ca=class extends ga{constructor(i,e){super(i,e),this.current=new Array}set(i){if(i!=this.current){this.current=i;const e=new Float32Array(i);this.gl.uniform1fv(this.location,e)}}},L.cb=class extends nh{},L.cc=td,L.cd=class extends cl{},L.ce=Vp,L.cf=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},L.cg=Fd,L.ch=function(i,e,n){var l=e[0],f=e[1],m=e[2],y=n[3]*l+n[7]*f+n[11]*m+n[15];return i[0]=(n[0]*l+n[4]*f+n[8]*m+n[12])/(y=y||1),i[1]=(n[1]*l+n[5]*f+n[9]*m+n[13])/y,i[2]=(n[2]*l+n[6]*f+n[10]*m+n[14])/y,i},L.ci=class extends ys{},L.cj=class extends hc{},L.ck=function(i,e){return i[0]===e[0]&&i[1]===e[1]&&i[2]===e[2]&&i[3]===e[3]&&i[4]===e[4]&&i[5]===e[5]&&i[6]===e[6]&&i[7]===e[7]&&i[8]===e[8]&&i[9]===e[9]&&i[10]===e[10]&&i[11]===e[11]&&i[12]===e[12]&&i[13]===e[13]&&i[14]===e[14]&&i[15]===e[15]},L.cl=function(i,e){var n=i[0],l=i[1],f=i[2],m=i[3],y=i[4],w=i[5],E=i[6],R=i[7],N=i[8],j=i[9],q=i[10],Z=i[11],$=i[12],Q=i[13],ee=i[14],se=i[15],Te=e[0],ue=e[1],pe=e[2],ke=e[3],ze=e[4],ot=e[5],Et=e[6],xt=e[7],Lt=e[8],Ht=e[9],zt=e[10],Tt=e[11],mt=e[12],en=e[13],Kt=e[14],nn=e[15];return Math.abs(n-Te)<=Ye*Math.max(1,Math.abs(n),Math.abs(Te))&&Math.abs(l-ue)<=Ye*Math.max(1,Math.abs(l),Math.abs(ue))&&Math.abs(f-pe)<=Ye*Math.max(1,Math.abs(f),Math.abs(pe))&&Math.abs(m-ke)<=Ye*Math.max(1,Math.abs(m),Math.abs(ke))&&Math.abs(y-ze)<=Ye*Math.max(1,Math.abs(y),Math.abs(ze))&&Math.abs(w-ot)<=Ye*Math.max(1,Math.abs(w),Math.abs(ot))&&Math.abs(E-Et)<=Ye*Math.max(1,Math.abs(E),Math.abs(Et))&&Math.abs(R-xt)<=Ye*Math.max(1,Math.abs(R),Math.abs(xt))&&Math.abs(N-Lt)<=Ye*Math.max(1,Math.abs(N),Math.abs(Lt))&&Math.abs(j-Ht)<=Ye*Math.max(1,Math.abs(j),Math.abs(Ht))&&Math.abs(q-zt)<=Ye*Math.max(1,Math.abs(q),Math.abs(zt))&&Math.abs(Z-Tt)<=Ye*Math.max(1,Math.abs(Z),Math.abs(Tt))&&Math.abs($-mt)<=Ye*Math.max(1,Math.abs($),Math.abs(mt))&&Math.abs(Q-en)<=Ye*Math.max(1,Math.abs(Q),Math.abs(en))&&Math.abs(ee-Kt)<=Ye*Math.max(1,Math.abs(ee),Math.abs(Kt))&&Math.abs(se-nn)<=Ye*Math.max(1,Math.abs(se),Math.abs(nn))},L.cm=function(i,e){return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},L.cn=i=>i.type==="symbol",L.co=i=>i.type==="circle",L.cp=i=>i.type==="heatmap",L.cq=i=>i.type==="line",L.cr=i=>i.type==="fill",L.cs=i=>i.type==="fill-extrusion",L.ct=i=>i.type==="hillshade",L.cu=i=>i.type==="color-relief",L.cv=i=>i.type==="background",L.cw=i=>i.type==="custom",L.cx=Ct,L.cy=function(i,e,n){const l=Ue(e.x-n.x,e.y-n.y),f=Ue(i.x-n.x,i.y-n.y),m=Math.atan2(l[0]*f[1]-l[1]*f[0],(function(y,w){return y[0]*w[0]+y[1]*w[1]})(l,f));return Sr(m)},L.cz=Zt,L.d=Mt,L.d0=function(i,e,n,l,f){return c(this,void 0,void 0,(function*(){if(It())try{return yield qs(i,e,n,l,f)}catch{}return(function(m,y,w,E,R){const N=m.width,j=m.height;os&&Nr||(os=new OffscreenCanvas(N,j),Nr=os.getContext("2d",{willReadFrequently:!0})),os.width=N,os.height=j,Nr.drawImage(m,0,0,N,j);const q=Nr.getImageData(y,w,E,R);return Nr.clearRect(0,0,N,j),q.data})(i,e,n,l,f)}))},L.d1=tg,L.d2=ne,L.d3=class{constructor(i,e){this.layers={[bf]:this},this.name=bf,this.version=e?e.version:1,this.extent=e?e.extent:4096,this.length=i.length,this.features=i}feature(i){return new F_(this.features[i],this.extent)}},L.d4=qc,L.d5=Js,L.e=Qe,L.f=i=>c(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const e=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(e)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),L.g=lt,L.h=i=>new Promise(((e,n)=>{const l=new Image;l.onload=()=>{e(l),URL.revokeObjectURL(l.src),l.onload=null,window.requestAnimationFrame((()=>{l.src=Yt}))},l.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const f=new Blob([new Uint8Array(i)],{type:"image/png"});l.src=i.byteLength?URL.createObjectURL(f):Yt})),L.i=Ia,L.j=(i,e)=>St(Qe(i,{type:"json"}),e),L.k=zn,L.l=yn,L.m=St,L.n=(i,e)=>St(Qe(i,{type:"arrayBuffer"}),e),L.o=function(i){return new id(i).readFields(_g,[])},L.p=om,L.q=function(i){return/[\u02EA\u02EB\u1100-\u11FF\u2E80-\u2FDF\u3000-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u4DBF\u4E00-\uA48C\uA490-\uA4C6\uA960-\uA97C\uAC00-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFE10-\uFE1F\uFE30-\uFE4F\uFF00-\uFFEF]|\uD81B[\uDFE0-\uDFFF]|[\uD81C-\uD822\uD840-\uD868\uD86A-\uD86D\uD86F-\uD872\uD874-\uD879\uD880-\uD883\uD885-\uD88C][\uDC00-\uDFFF]|\uD823[\uDC00-\uDCD5\uDCFF-\uDD1E\uDD80-\uDDF2]|\uD82B[\uDFF0-\uDFFF]|\uD82C[\uDC00-\uDEFB]|\uD83C[\uDE00-\uDEFF]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEAD\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0\uDFF0-\uDFFF]|\uD87B[\uDC00-\uDE5D]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A\uDF50-\uDFFF]|\uD88D[\uDC00-\uDC79]/gim.test(String.fromCodePoint(i))},L.r=Qh,L.s=wl,L.t=fr,L.u=it,L.v=nc,L.w=Dn,L.x=vu,L.y=rc,L.z=jl})),D("worker",["./shared"],(function(L){class c{constructor(re,te){this.keyCache={},re&&this.replace(re,te)}replace(re,te){this._layerConfigs={},this._layers={},this.update(re,[],te)}update(re,te,he){for(const Ee of re){this._layerConfigs[Ee.id]=Ee;const lt=this._layers[Ee.id]=L.bU(Ee,he);lt._featureFilter=L.ak(lt.filter,he),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id]}for(const Ee of te)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const Se=L.cM(Object.values(this._layerConfigs),this.keyCache);for(const Ee of Se){const lt=Ee.map((Wt=>this._layers[Wt.id])),Je=lt[0];if(Je.visibility==="none")continue;const qe=Je.source||"";let Ze=this.familiesBySource[qe];Ze||(Ze=this.familiesBySource[qe]={});const St=Je.sourceLayer||L.aa;let Mt=Ze[St];Mt||(Mt=Ze[St]=[]),Mt.push(lt)}}}class X{constructor(re){const te={},he=[];for(const Je in re){const qe=re[Je],Ze=te[Je]={};for(const St in qe){const Mt=qe[+St];if(!Mt||Mt.bitmap.width===0||Mt.bitmap.height===0)continue;const Wt={x:0,y:0,w:Mt.bitmap.width+2,h:Mt.bitmap.height+2};he.push(Wt),Ze[St]={rect:Wt,metrics:Mt.metrics}}}const{w:Se,h:Ee}=L.p(he),lt=new L.r({width:Se||1,height:Ee||1});for(const Je in re){const qe=re[Je];for(const Ze in qe){const St=qe[+Ze];if(!St||St.bitmap.width===0||St.bitmap.height===0)continue;const Mt=te[Je][Ze].rect;L.r.copy(St.bitmap,lt,{x:0,y:0},{x:Mt.x+1,y:Mt.y+1},St.bitmap)}}this.image=lt,this.positions=te}}L.cN("GlyphAtlas",X);class ne{constructor(re){this.tileID=new L.a2(re.tileID.overscaledZ,re.tileID.wrap,re.tileID.canonical.z,re.tileID.canonical.x,re.tileID.canonical.y),this.uid=re.uid,this.zoom=re.zoom,this.pixelRatio=re.pixelRatio,this.tileSize=re.tileSize,this.source=re.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=re.showCollisionBoxes,this.collectResourceTiming=!!re.collectResourceTiming,this.returnDependencies=!!re.returnDependencies,this.promoteId=re.promoteId,this.inFlightDependencies=[]}parse(re,te,he,Se,Ee){return L._(this,void 0,void 0,(function*(){this.status="parsing",this.data=re,this.collisionBoxArray=new L.ai;const lt=new L.cO(Object.keys(re.layers).sort()),Je=new L.cP(this.tileID,this.promoteId);Je.bucketLayerIDs=[];const qe={},Ze={featureIndex:Je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:he,subdivisionGranularity:Ee},St=te.familiesBySource[this.source];for(const si in St){const ji=re.layers[si];if(!ji)continue;ji.version===1&&L.w(`Vector tile source "${this.source}" layer "${si}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const qo=lt.encode(si),Aa=[];for(let Gt=0;Gt<ji.length;Gt++){const _r=ji.feature(Gt),Xr=Je.getId(_r,si);Aa.push({feature:_r,id:Xr,index:Gt,sourceLayerIndex:qo})}for(const Gt of St[si]){const _r=Gt[0];_r.source!==this.source&&L.w(`layer.source = ${_r.source} does not equal this.source = ${this.source}`),_r.isHidden(this.zoom,!0)||(fe(Gt,this.zoom,he),(qe[_r.id]=_r.createBucket({index:Je.bucketLayerIDs.length,layers:Gt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qo,sourceID:this.source})).populate(Aa,Ze,this.tileID.canonical),Je.bucketLayerIDs.push(Gt.map((Xr=>Xr.id))))}}const Mt=L.bZ(Ze.glyphDependencies,(si=>Object.keys(si).map(Number)));this.inFlightDependencies.forEach((si=>si?.abort())),this.inFlightDependencies=[];let Wt=Promise.resolve({});if(Object.keys(Mt).length){const si=new AbortController;this.inFlightDependencies.push(si),Wt=Se.sendAsync({type:"GG",data:{stacks:Mt,source:this.source,tileID:this.tileID,type:"glyphs"}},si)}const Qt=Object.keys(Ze.iconDependencies);let yn=Promise.resolve({});if(Qt.length){const si=new AbortController;this.inFlightDependencies.push(si),yn=Se.sendAsync({type:"GI",data:{icons:Qt,source:this.source,tileID:this.tileID,type:"icons"}},si)}const zn=Object.keys(Ze.patternDependencies);let Un=Promise.resolve({});if(zn.length){const si=new AbortController;this.inFlightDependencies.push(si),Un=Se.sendAsync({type:"GI",data:{icons:zn,source:this.source,tileID:this.tileID,type:"patterns"}},si)}const it=Ze.dashDependencies;let ii=Promise.resolve({});if(Object.keys(it).length){const si=new AbortController;this.inFlightDependencies.push(si),ii=Se.sendAsync({type:"GDA",data:{dashes:it}},si)}const[Hi,xn,Nt,Xi]=yield Promise.all([Wt,yn,Un,ii]),Kn=new X(Hi),ki=new L.cQ(xn,Nt);for(const si in qe){const ji=qe[si];ji instanceof L.aj?(fe(ji.layers,this.zoom,he),L.cR({bucket:ji,glyphMap:Hi,glyphPositions:Kn.positions,imageMap:xn,imagePositions:ki.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Ze.subdivisionGranularity})):ji.hasDependencies&&(ji instanceof L.cS||ji instanceof L.cT||ji instanceof L.cU)&&(fe(ji.layers,this.zoom,he),ji.addFeatures(Ze,this.tileID.canonical,ki.patternPositions,Xi))}return this.status="done",{buckets:Object.values(qe).filter((si=>!si.isEmpty())),featureIndex:Je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Kn.image,imageAtlas:ki,dashPositions:Xi,glyphMap:this.returnDependencies?Hi:null,iconMap:this.returnDependencies?xn:null,glyphPositions:this.returnDependencies?Kn.positions:null}}))}}function fe(nt,re,te){const he=new L.H(re);for(const Se of nt)Se.recalculate(he,te)}class ie{constructor(re,te,he,Se,Ee){this.type=re,this.properties=he||{},this.extent=Ee,this.pointsArray=te,this.id=Se}loadGeometry(){return this.pointsArray.map((re=>re.map((te=>new L.P(te.x,te.y)))))}}class xe{constructor(re,te,he){this.version=2,this._myFeatures=re,this.name=te,this.length=re.length,this.extent=he}feature(re){return this._myFeatures[re]}}class Be{constructor(){this.layers={}}addLayer(re){this.layers[re.name]=re}}function Ge(nt){let re=L.cV(nt);return re.byteOffset===0&&re.byteLength===re.buffer.byteLength||(re=new Uint8Array(re)),{vectorTile:nt,rawData:re.buffer}}function dt(nt,re,te){const{extent:he}=nt,Se=Math.pow(2,te.z-re.z),Ee=(te.x-re.x*Se)*he,lt=(te.y-re.y*Se)*he,Je=[];for(let qe=0;qe<nt.length;qe++){const Ze=nt.feature(qe);let St=Ze.loadGeometry();for(const Wt of St)for(const Qt of Wt)Qt.x=Qt.x*Se-Ee,Qt.y=Qt.y*Se-lt;const Mt=128;St=L.cW(St,Ze.type,-Mt,-Mt,he+Mt,he+Mt),St.length!==0&&Je.push(new ie(Ze.type,St,Ze.properties,Ze.id,he))}return new xe(Je,nt.name,he)}class Ce{constructor(re,te,he){this.actor=re,this.layerIndex=te,this.availableImages=he,this.fetching={},this.loading={},this.loaded={},this.overzoomedTileResultCache=new L.cX(1e3)}loadVectorTile(re,te){return L._(this,void 0,void 0,(function*(){const he=yield L.n(re.request,te);try{return{vectorTile:re.encoding!=="mlt"?new L.cY(new L.cZ(he.data)):new L.c_(he.data),rawData:he.data,cacheControl:he.cacheControl,expires:he.expires}}catch(Se){const Ee=new Uint8Array(he.data);let lt=`Unable to parse the tile at ${re.request.url}, `;throw lt+=Ee[0]===31&&Ee[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Se.message}`,new Error(lt)}}))}loadTile(re){return L._(this,void 0,void 0,(function*(){const{uid:te,overzoomParameters:he}=re;he&&(re.request=he.overzoomRequest);const Se=!!(re&&re.request&&re.request.collectResourceTiming)&&new L.c$(re.request),Ee=new ne(re);this.loading[te]=Ee;const lt=new AbortController;Ee.abort=lt;try{const Je=yield this.loadVectorTile(re,lt);if(delete this.loading[te],!Je)return null;if(he){const Wt=this._getOverzoomTile(re,Je.vectorTile);Je.rawData=Wt.rawData,Je.vectorTile=Wt.vectorTile}const qe=Je.rawData,Ze={};Je.expires&&(Ze.expires=Je.expires),Je.cacheControl&&(Ze.cacheControl=Je.cacheControl);const St={};if(Se){const Wt=Se.finish();Wt&&(St.resourceTiming=JSON.parse(JSON.stringify(Wt)))}Ee.vectorTile=Je.vectorTile;const Mt=Ee.parse(Je.vectorTile,this.layerIndex,this.availableImages,this.actor,re.subdivisionGranularity);this.loaded[te]=Ee,this.fetching[te]={rawTileData:qe,cacheControl:Ze,resourceTiming:St};try{const Wt=yield Mt;return L.e({rawTileData:qe.slice(0),encoding:re.encoding},Wt,Ze,St)}finally{delete this.fetching[te]}}catch(Je){throw delete this.loading[te],Ee.status="done",this.loaded[te]=Ee,Je}}))}_getOverzoomTile(re,te){const{tileID:he,source:Se,overzoomParameters:Ee}=re,{maxZoomTileID:lt}=Ee,Je=`${lt.key}_${he.key}`,qe=this.overzoomedTileResultCache.get(Je);if(qe)return qe;const Ze=new Be,St=this.layerIndex.familiesBySource[Se];for(const Wt in St){const Qt=te.layers[Wt];if(!Qt)continue;const yn=dt(Qt,lt,he.canonical);yn.length>0&&Ze.addLayer(yn)}const Mt=Ge(Ze);return this.overzoomedTileResultCache.set(Je,Mt),Mt}reloadTile(re){return L._(this,void 0,void 0,(function*(){const te=re.uid;if(!this.loaded||!this.loaded[te])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const he=this.loaded[te];if(he.showCollisionBoxes=re.showCollisionBoxes,he.status==="parsing"){const Se=yield he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,re.subdivisionGranularity);let Ee;if(this.fetching[te]){const{rawTileData:lt,cacheControl:Je,resourceTiming:qe}=this.fetching[te];delete this.fetching[te],Ee=L.e({rawTileData:lt.slice(0),encoding:re.encoding},Se,Je,qe)}else Ee=Se;return Ee}if(he.status==="done"&&he.vectorTile)return he.parse(he.vectorTile,this.layerIndex,this.availableImages,this.actor,re.subdivisionGranularity)}))}abortTile(re){return L._(this,void 0,void 0,(function*(){const te=this.loading,he=re.uid;te&&te[he]&&te[he].abort&&(te[he].abort.abort(),delete te[he])}))}removeTile(re){return L._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[re.uid]&&delete this.loaded[re.uid]}))}}class It{constructor(){this.loaded={}}loadTile(re){return L._(this,void 0,void 0,(function*(){const{uid:te,encoding:he,rawImageData:Se,redFactor:Ee,greenFactor:lt,blueFactor:Je,baseShift:qe}=re,Ze=Se.width+2,St=Se.height+2,Mt=L.b(Se)?new L.R({width:Ze,height:St},yield L.d0(Se,-1,-1,Ze,St)):Se,Wt=new L.d1(te,Mt,he,Ee,lt,Je,qe);return this.loaded=this.loaded||{},this.loaded[te]=Wt,Wt}))}removeTile(re){const te=this.loaded,he=re.uid;te&&te[he]&&delete te[he]}}var Ye,at,jt=(function(){if(at)return Ye;function nt(te,he){if(te.length!==0){re(te[0],he);for(var Se=1;Se<te.length;Se++)re(te[Se],!he)}}function re(te,he){for(var Se=0,Ee=0,lt=0,Je=te.length,qe=Je-1;lt<Je;qe=lt++){var Ze=(te[lt][0]-te[qe][0])*(te[qe][1]+te[lt][1]),St=Se+Ze;Ee+=Math.abs(Se)>=Math.abs(Ze)?Se-St+Ze:Ze-St+Se,Se=St}Se+Ee>=0!=!!he&&te.reverse()}return at=1,Ye=function te(he,Se){var Ee,lt=he&&he.type;if(lt==="FeatureCollection")for(Ee=0;Ee<he.features.length;Ee++)te(he.features[Ee],Se);else if(lt==="GeometryCollection")for(Ee=0;Ee<he.geometries.length;Ee++)te(he.geometries[Ee],Se);else if(lt==="Feature")te(he.geometry,Se);else if(lt==="Polygon")nt(he.coordinates,Se);else if(lt==="MultiPolygon")for(Ee=0;Ee<he.coordinates.length;Ee++)nt(he.coordinates[Ee],Se);return he}})(),At=L.d2(jt);const Vt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:nt=>nt},wt=Math.fround||(oe=new Float32Array(1),nt=>(oe[0]=+nt,oe[0]));var oe;class de{constructor(re){this.options=Object.assign(Object.create(Vt),re),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(re){const{log:te,minZoom:he,maxZoom:Se}=this.options;te&&console.time("total time");const Ee=`prepare ${re.length} points`;te&&console.time(Ee),this.points=re;const lt=[];for(let qe=0;qe<re.length;qe++){const Ze=re[qe];if(!Ze.geometry)continue;const[St,Mt]=Ze.geometry.coordinates,Wt=wt(Ne(St)),Qt=wt(He(Mt));lt.push(Wt,Qt,1/0,qe,-1,1),this.options.reduce&&lt.push(0)}let Je=this.trees[Se+1]=this._createTree(lt);te&&console.timeEnd(Ee);for(let qe=Se;qe>=he;qe--){const Ze=+Date.now();Je=this.trees[qe]=this._createTree(this._cluster(Je,qe)),te&&console.log("z%d: %d clusters in %dms",qe,Je.numItems,+Date.now()-Ze)}return te&&console.timeEnd("total time"),this}getClusters(re,te){let he=((re[0]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,re[1]));let Ee=re[2]===180?180:((re[2]+180)%360+360)%360-180;const lt=Math.max(-90,Math.min(90,re[3]));if(re[2]-re[0]>=360)he=-180,Ee=180;else if(he>Ee){const Mt=this.getClusters([he,Se,180,lt],te),Wt=this.getClusters([-180,Se,Ee,lt],te);return Mt.concat(Wt)}const Je=this.trees[this._limitZoom(te)],qe=Je.range(Ne(he),He(lt),Ne(Ee),He(Se)),Ze=Je.data,St=[];for(const Mt of qe){const Wt=this.stride*Mt;St.push(Ze[Wt+5]>1?Ie(Ze,Wt,this.clusterProps):this.points[Ze[Wt+3]])}return St}getChildren(re){const te=this._getOriginId(re),he=this._getOriginZoom(re),Se="No cluster with the specified id.",Ee=this.trees[he];if(!Ee)throw new Error(Se);const lt=Ee.data;if(te*this.stride>=lt.length)throw new Error(Se);const Je=this.options.radius/(this.options.extent*Math.pow(2,he-1)),qe=Ee.within(lt[te*this.stride],lt[te*this.stride+1],Je),Ze=[];for(const St of qe){const Mt=St*this.stride;lt[Mt+4]===re&&Ze.push(lt[Mt+5]>1?Ie(lt,Mt,this.clusterProps):this.points[lt[Mt+3]])}if(Ze.length===0)throw new Error(Se);return Ze}getLeaves(re,te,he){const Se=[];return this._appendLeaves(Se,re,te=te||10,he=he||0,0),Se}getTile(re,te,he){const Se=this.trees[this._limitZoom(re)],Ee=Math.pow(2,re),{extent:lt,radius:Je}=this.options,qe=Je/lt,Ze=(he-qe)/Ee,St=(he+1+qe)/Ee,Mt={features:[]};return this._addTileFeatures(Se.range((te-qe)/Ee,Ze,(te+1+qe)/Ee,St),Se.data,te,he,Ee,Mt),te===0&&this._addTileFeatures(Se.range(1-qe/Ee,Ze,1,St),Se.data,Ee,he,Ee,Mt),te===Ee-1&&this._addTileFeatures(Se.range(0,Ze,qe/Ee,St),Se.data,-1,he,Ee,Mt),Mt.features.length?Mt:null}getClusterExpansionZoom(re){let te=this._getOriginZoom(re)-1;for(;te<=this.options.maxZoom;){const he=this.getChildren(re);if(te++,he.length!==1)break;re=he[0].properties.cluster_id}return te}_appendLeaves(re,te,he,Se,Ee){const lt=this.getChildren(te);for(const Je of lt){const qe=Je.properties;if(qe&&qe.cluster?Ee+qe.point_count<=Se?Ee+=qe.point_count:Ee=this._appendLeaves(re,qe.cluster_id,he,Se,Ee):Ee<Se?Ee++:re.push(Je),re.length===he)break}return Ee}_createTree(re){const te=new L.aU(re.length/this.stride|0,this.options.nodeSize,Float32Array);for(let he=0;he<re.length;he+=this.stride)te.add(re[he],re[he+1]);return te.finish(),te.data=re,te}_addTileFeatures(re,te,he,Se,Ee,lt){for(const Je of re){const qe=Je*this.stride,Ze=te[qe+5]>1;let St,Mt,Wt;if(Ze)St=Xe(te,qe,this.clusterProps),Mt=te[qe],Wt=te[qe+1];else{const zn=this.points[te[qe+3]];St=zn.properties;const[Un,it]=zn.geometry.coordinates;Mt=Ne(Un),Wt=He(it)}const Qt={type:1,geometry:[[Math.round(this.options.extent*(Mt*Ee-he)),Math.round(this.options.extent*(Wt*Ee-Se))]],tags:St};let yn;yn=Ze||this.options.generateId?te[qe+3]:this.points[te[qe+3]].id,yn!==void 0&&(Qt.id=yn),lt.features.push(Qt)}}_limitZoom(re){return Math.max(this.options.minZoom,Math.min(Math.floor(+re),this.options.maxZoom+1))}_cluster(re,te){const{radius:he,extent:Se,reduce:Ee,minPoints:lt}=this.options,Je=he/(Se*Math.pow(2,te)),qe=re.data,Ze=[],St=this.stride;for(let Mt=0;Mt<qe.length;Mt+=St){if(qe[Mt+2]<=te)continue;qe[Mt+2]=te;const Wt=qe[Mt],Qt=qe[Mt+1],yn=re.within(qe[Mt],qe[Mt+1],Je),zn=qe[Mt+5];let Un=zn;for(const it of yn){const ii=it*St;qe[ii+2]>te&&(Un+=qe[ii+5])}if(Un>zn&&Un>=lt){let it,ii=Wt*zn,Hi=Qt*zn,xn=-1;const Nt=(Mt/St<<5)+(te+1)+this.points.length;for(const Xi of yn){const Kn=Xi*St;if(qe[Kn+2]<=te)continue;qe[Kn+2]=te;const ki=qe[Kn+5];ii+=qe[Kn]*ki,Hi+=qe[Kn+1]*ki,qe[Kn+4]=Nt,Ee&&(it||(it=this._map(qe,Mt,!0),xn=this.clusterProps.length,this.clusterProps.push(it)),Ee(it,this._map(qe,Kn)))}qe[Mt+4]=Nt,Ze.push(ii/Un,Hi/Un,1/0,Nt,-1,Un),Ee&&Ze.push(xn)}else{for(let it=0;it<St;it++)Ze.push(qe[Mt+it]);if(Un>1)for(const it of yn){const ii=it*St;if(!(qe[ii+2]<=te)){qe[ii+2]=te;for(let Hi=0;Hi<St;Hi++)Ze.push(qe[ii+Hi])}}}}return Ze}_getOriginId(re){return re-this.points.length>>5}_getOriginZoom(re){return(re-this.points.length)%32}_map(re,te,he){if(re[te+5]>1){const lt=this.clusterProps[re[te+6]];return he?Object.assign({},lt):lt}const Se=this.points[re[te+3]].properties,Ee=this.options.map(Se);return he&&Ee===Se?Object.assign({},Ee):Ee}}function Ie(nt,re,te){return{type:"Feature",id:nt[re+3],properties:Xe(nt,re,te),geometry:{type:"Point",coordinates:[(he=nt[re],360*(he-.5)),Fe(nt[re+1])]}};var he}function Xe(nt,re,te){const he=nt[re+5],Se=he>=1e4?`${Math.round(he/1e3)}k`:he>=1e3?Math.round(he/100)/10+"k":he,Ee=nt[re+6],lt=Ee===-1?{}:Object.assign({},te[Ee]);return Object.assign(lt,{cluster:!0,cluster_id:nt[re+3],point_count:he,point_count_abbreviated:Se})}function Ne(nt){return nt/360+.5}function He(nt){const re=Math.sin(nt*Math.PI/180),te=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return te<0?0:te>1?1:te}function Fe(nt){const re=(180-360*nt)*Math.PI/180;return 360*Math.atan(Math.exp(re))/Math.PI-90}function Le(nt,re,te,he){let Se=he;const Ee=re+(te-re>>1);let lt,Je=te-re;const qe=nt[re],Ze=nt[re+1],St=nt[te],Mt=nt[te+1];for(let Wt=re+3;Wt<te;Wt+=3){const Qt=me(nt[Wt],nt[Wt+1],qe,Ze,St,Mt);if(Qt>Se)lt=Wt,Se=Qt;else if(Qt===Se){const yn=Math.abs(Wt-Ee);yn<Je&&(lt=Wt,Je=yn)}}Se>he&&(lt-re>3&&Le(nt,re,lt,he),nt[lt+2]=Se,te-lt>3&&Le(nt,lt,te,he))}function me(nt,re,te,he,Se,Ee){let lt=Se-te,Je=Ee-he;if(lt!==0||Je!==0){const qe=((nt-te)*lt+(re-he)*Je)/(lt*lt+Je*Je);qe>1?(te=Se,he=Ee):qe>0&&(te+=lt*qe,he+=Je*qe)}return lt=nt-te,Je=re-he,lt*lt+Je*Je}function Pe(nt,re,te,he){const Se={id:nt??null,type:re,geometry:te,tags:he,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(re==="Point"||re==="MultiPoint"||re==="LineString")Ue(Se,te);else if(re==="Polygon")Ue(Se,te[0]);else if(re==="MultiLineString")for(const Ee of te)Ue(Se,Ee);else if(re==="MultiPolygon")for(const Ee of te)Ue(Se,Ee[0]);return Se}function Ue(nt,re){for(let te=0;te<re.length;te+=3)nt.minX=Math.min(nt.minX,re[te]),nt.minY=Math.min(nt.minY,re[te+1]),nt.maxX=Math.max(nt.maxX,re[te]),nt.maxY=Math.max(nt.maxY,re[te+1])}function tt(nt,re,te,he){if(!re.geometry)return;const Se=re.geometry.coordinates;if(Se&&Se.length===0)return;const Ee=re.geometry.type,lt=Math.pow(te.tolerance/((1<<te.maxZoom)*te.extent),2);let Je=[],qe=re.id;if(te.promoteId?qe=re.properties[te.promoteId]:te.generateId&&(qe=he||0),Ee==="Point")vt(Se,Je);else if(Ee==="MultiPoint")for(const Ze of Se)vt(Ze,Je);else if(Ee==="LineString")Me(Se,Je,lt,!1);else if(Ee==="MultiLineString"){if(te.lineMetrics){for(const Ze of Se)Je=[],Me(Ze,Je,lt,!1),nt.push(Pe(qe,"LineString",Je,re.properties));return}ut(Se,Je,lt,!1)}else if(Ee==="Polygon")ut(Se,Je,lt,!0);else{if(Ee!=="MultiPolygon"){if(Ee==="GeometryCollection"){for(const Ze of re.geometry.geometries)tt(nt,{id:qe,geometry:Ze,properties:re.properties},te,he);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Ze of Se){const St=[];ut(Ze,St,lt,!0),Je.push(St)}}nt.push(Pe(qe,Ee,Je,re.properties))}function vt(nt,re){re.push(Ot(nt[0]),Ct(nt[1]),0)}function Me(nt,re,te,he){let Se,Ee,lt=0;for(let qe=0;qe<nt.length;qe++){const Ze=Ot(nt[qe][0]),St=Ct(nt[qe][1]);re.push(Ze,St,0),qe>0&&(lt+=he?(Se*St-Ze*Ee)/2:Math.sqrt(Math.pow(Ze-Se,2)+Math.pow(St-Ee,2))),Se=Ze,Ee=St}const Je=re.length-3;re[2]=1,Le(re,0,Je,te),re[Je+2]=1,re.size=Math.abs(lt),re.start=0,re.end=re.size}function ut(nt,re,te,he){for(let Se=0;Se<nt.length;Se++){const Ee=[];Me(nt[Se],Ee,te,he),re.push(Ee)}}function Ot(nt){return nt/360+.5}function Ct(nt){const re=Math.sin(nt*Math.PI/180),te=.5-.25*Math.log((1+re)/(1-re))/Math.PI;return te<0?0:te>1?1:te}function Zt(nt,re,te,he,Se,Ee,lt,Je){if(he/=re,Ee>=(te/=re)&&lt<he)return nt;if(lt<te||Ee>=he)return null;const qe=[];for(const Ze of nt){const St=Ze.geometry;let Mt=Ze.type;const Wt=Se===0?Ze.minX:Ze.minY,Qt=Se===0?Ze.maxX:Ze.maxY;if(Wt>=te&&Qt<he){qe.push(Ze);continue}if(Qt<te||Wt>=he)continue;let yn=[];if(Mt==="Point"||Mt==="MultiPoint")tn(St,yn,te,he,Se);else if(Mt==="LineString")_n(St,yn,te,he,Se,!1,Je.lineMetrics);else if(Mt==="MultiLineString")ni(St,yn,te,he,Se,!1);else if(Mt==="Polygon")ni(St,yn,te,he,Se,!0);else if(Mt==="MultiPolygon")for(const zn of St){const Un=[];ni(zn,Un,te,he,Se,!0),Un.length&&yn.push(Un)}if(yn.length){if(Je.lineMetrics&&Mt==="LineString"){for(const zn of yn)qe.push(Pe(Ze.id,Mt,zn,Ze.tags));continue}Mt!=="LineString"&&Mt!=="MultiLineString"||(yn.length===1?(Mt="LineString",yn=yn[0]):Mt="MultiLineString"),Mt!=="Point"&&Mt!=="MultiPoint"||(Mt=yn.length===3?"Point":"MultiPoint"),qe.push(Pe(Ze.id,Mt,yn,Ze.tags))}}return qe.length?qe:null}function tn(nt,re,te,he,Se){for(let Ee=0;Ee<nt.length;Ee+=3){const lt=nt[Ee+Se];lt>=te&&lt<=he&&Rn(re,nt[Ee],nt[Ee+1],nt[Ee+2])}}function _n(nt,re,te,he,Se,Ee,lt){let Je=Qe(nt);const qe=Se===0?rn:Re;let Ze,St,Mt=nt.start;for(let Un=0;Un<nt.length-3;Un+=3){const it=nt[Un],ii=nt[Un+1],Hi=nt[Un+2],xn=nt[Un+3],Nt=nt[Un+4],Xi=Se===0?it:ii,Kn=Se===0?xn:Nt;let ki=!1;lt&&(Ze=Math.sqrt(Math.pow(it-xn,2)+Math.pow(ii-Nt,2))),Xi<te?Kn>te&&(St=qe(Je,it,ii,xn,Nt,te),lt&&(Je.start=Mt+Ze*St)):Xi>he?Kn<he&&(St=qe(Je,it,ii,xn,Nt,he),lt&&(Je.start=Mt+Ze*St)):Rn(Je,it,ii,Hi),Kn<te&&Xi>=te&&(St=qe(Je,it,ii,xn,Nt,te),ki=!0),Kn>he&&Xi<=he&&(St=qe(Je,it,ii,xn,Nt,he),ki=!0),!Ee&&ki&&(lt&&(Je.end=Mt+Ze*St),re.push(Je),Je=Qe(nt)),lt&&(Mt+=Ze)}let Wt=nt.length-3;const Qt=nt[Wt],yn=nt[Wt+1],zn=Se===0?Qt:yn;zn>=te&&zn<=he&&Rn(Je,Qt,yn,nt[Wt+2]),Wt=Je.length-3,Ee&&Wt>=3&&(Je[Wt]!==Je[0]||Je[Wt+1]!==Je[1])&&Rn(Je,Je[0],Je[1],Je[2]),Je.length&&re.push(Je)}function Qe(nt){const re=[];return re.size=nt.size,re.start=nt.start,re.end=nt.end,re}function ni(nt,re,te,he,Se,Ee){for(const lt of nt)_n(lt,re,te,he,Se,Ee,!1)}function Rn(nt,re,te,he){nt.push(re,te,he)}function rn(nt,re,te,he,Se,Ee){const lt=(Ee-re)/(he-re);return Rn(nt,Ee,te+(Se-te)*lt,1),lt}function Re(nt,re,te,he,Se,Ee){const lt=(Ee-te)/(Se-te);return Rn(nt,re+(he-re)*lt,Ee,1),lt}function fi(nt,re){const te=[];for(let he=0;he<nt.length;he++){const Se=nt[he],Ee=Se.type;let lt;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")lt=Dn(Se.geometry,re);else if(Ee==="MultiLineString"||Ee==="Polygon"){lt=[];for(const Je of Se.geometry)lt.push(Dn(Je,re))}else if(Ee==="MultiPolygon"){lt=[];for(const Je of Se.geometry){const qe=[];for(const Ze of Je)qe.push(Dn(Ze,re));lt.push(qe)}}te.push(Pe(Se.id,Ee,lt,Se.tags))}return te}function Dn(nt,re){const te=[];te.size=nt.size,nt.start!==void 0&&(te.start=nt.start,te.end=nt.end);for(let he=0;he<nt.length;he+=3)te.push(nt[he]+re,nt[he+1],nt[he+2]);return te}function Pn(nt,re){if(nt.transformed)return nt;const te=1<<nt.z,he=nt.x,Se=nt.y;for(const Ee of nt.features){const lt=Ee.geometry,Je=Ee.type;if(Ee.geometry=[],Je===1)for(let qe=0;qe<lt.length;qe+=2)Ee.geometry.push(Ia(lt[qe],lt[qe+1],re,te,he,Se));else for(let qe=0;qe<lt.length;qe++){const Ze=[];for(let St=0;St<lt[qe].length;St+=2)Ze.push(Ia(lt[qe][St],lt[qe][St+1],re,te,he,Se));Ee.geometry.push(Ze)}}return nt.transformed=!0,nt}function Ia(nt,re,te,he,Se,Ee){return[Math.round(te*(nt*he-Se)),Math.round(te*(re*he-Ee))]}function Ri(nt,re,te,he,Se){const Ee=re===Se.maxZoom?0:Se.tolerance/((1<<re)*Se.extent),lt={features:[],numPoints:0,numSimplified:0,numFeatures:nt.length,source:null,x:te,y:he,z:re,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Je of nt)Gs(lt,Je,Ee,Se);return lt}function Gs(nt,re,te,he){const Se=re.geometry,Ee=re.type,lt=[];if(nt.minX=Math.min(nt.minX,re.minX),nt.minY=Math.min(nt.minY,re.minY),nt.maxX=Math.max(nt.maxX,re.maxX),nt.maxY=Math.max(nt.maxY,re.maxY),Ee==="Point"||Ee==="MultiPoint")for(let Je=0;Je<Se.length;Je+=3)lt.push(Se[Je],Se[Je+1]),nt.numPoints++,nt.numSimplified++;else if(Ee==="LineString")Yt(lt,Se,nt,te,!1,!1);else if(Ee==="MultiLineString"||Ee==="Polygon")for(let Je=0;Je<Se.length;Je++)Yt(lt,Se[Je],nt,te,Ee==="Polygon",Je===0);else if(Ee==="MultiPolygon")for(let Je=0;Je<Se.length;Je++){const qe=Se[Je];for(let Ze=0;Ze<qe.length;Ze++)Yt(lt,qe[Ze],nt,te,!0,Ze===0)}if(lt.length){let Je=re.tags||null;if(Ee==="LineString"&&he.lineMetrics){Je={};for(const Ze in re.tags)Je[Ze]=re.tags[Ze];Je.mapbox_clip_start=Se.start/Se.size,Je.mapbox_clip_end=Se.end/Se.size}const qe={geometry:lt,type:Ee==="Polygon"||Ee==="MultiPolygon"?3:Ee==="LineString"||Ee==="MultiLineString"?2:1,tags:Je};re.id!==null&&(qe.id=re.id),nt.features.push(qe)}}function Yt(nt,re,te,he,Se,Ee){const lt=he*he;if(he>0&&re.size<(Se?lt:he))return void(te.numPoints+=re.length/3);const Je=[];for(let qe=0;qe<re.length;qe+=3)(he===0||re[qe+2]>lt)&&(te.numSimplified++,Je.push(re[qe],re[qe+1])),te.numPoints++;Se&&(function(qe,Ze){let St=0;for(let Mt=0,Wt=qe.length,Qt=Wt-2;Mt<Wt;Qt=Mt,Mt+=2)St+=(qe[Mt]-qe[Qt])*(qe[Mt+1]+qe[Qt+1]);if(St>0===Ze)for(let Mt=0,Wt=qe.length;Mt<Wt/2;Mt+=2){const Qt=qe[Mt],yn=qe[Mt+1];qe[Mt]=qe[Wt-2-Mt],qe[Mt+1]=qe[Wt-1-Mt],qe[Wt-2-Mt]=Qt,qe[Wt-1-Mt]=yn}})(Je,Ee),nt.push(Je)}const qs={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class os{constructor(re,te){const he=(te=this.options=(function(Ee,lt){for(const Je in lt)Ee[Je]=lt[Je];return Ee})(Object.create(qs),te)).debug;if(he&&console.time("preprocess data"),te.maxZoom<0||te.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(te.promoteId&&te.generateId)throw new Error("promoteId and generateId cannot be used together.");let Se=(function(Ee,lt){const Je=[];if(Ee.type==="FeatureCollection")for(let qe=0;qe<Ee.features.length;qe++)tt(Je,Ee.features[qe],lt,qe);else tt(Je,Ee.type==="Feature"?Ee:{geometry:Ee},lt);return Je})(re,te);this.tiles={},this.tileCoords=[],he&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",te.indexMaxZoom,te.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Se=(function(Ee,lt){const Je=lt.buffer/lt.extent;let qe=Ee;const Ze=Zt(Ee,1,-1-Je,Je,0,-1,2,lt),St=Zt(Ee,1,1-Je,2+Je,0,-1,2,lt);return(Ze||St)&&(qe=Zt(Ee,1,-Je,1+Je,0,-1,2,lt)||[],Ze&&(qe=fi(Ze,1).concat(qe)),St&&(qe=qe.concat(fi(St,-1)))),qe})(Se,te),Se.length&&this.splitTile(Se,0,0,0),he&&(Se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(re,te,he,Se,Ee,lt,Je){const qe=[re,te,he,Se],Ze=this.options,St=Ze.debug;for(;qe.length;){Se=qe.pop(),he=qe.pop(),te=qe.pop(),re=qe.pop();const Mt=1<<te,Wt=Nr(te,he,Se);let Qt=this.tiles[Wt];if(!Qt&&(St>1&&console.time("creation"),Qt=this.tiles[Wt]=Ri(re,te,he,Se,Ze),this.tileCoords.push({z:te,x:he,y:Se}),St)){St>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",te,he,Se,Qt.numFeatures,Qt.numPoints,Qt.numSimplified),console.timeEnd("creation"));const ki=`z${te}`;this.stats[ki]=(this.stats[ki]||0)+1,this.total++}if(Qt.source=re,Ee==null){if(te===Ze.indexMaxZoom||Qt.numPoints<=Ze.indexMaxPoints)continue}else{if(te===Ze.maxZoom||te===Ee)continue;if(Ee!=null){const ki=Ee-te;if(he!==lt>>ki||Se!==Je>>ki)continue}}if(Qt.source=null,re.length===0)continue;St>1&&console.time("clipping");const yn=.5*Ze.buffer/Ze.extent,zn=.5-yn,Un=.5+yn,it=1+yn;let ii=null,Hi=null,xn=null,Nt=null,Xi=Zt(re,Mt,he-yn,he+Un,0,Qt.minX,Qt.maxX,Ze),Kn=Zt(re,Mt,he+zn,he+it,0,Qt.minX,Qt.maxX,Ze);re=null,Xi&&(ii=Zt(Xi,Mt,Se-yn,Se+Un,1,Qt.minY,Qt.maxY,Ze),Hi=Zt(Xi,Mt,Se+zn,Se+it,1,Qt.minY,Qt.maxY,Ze),Xi=null),Kn&&(xn=Zt(Kn,Mt,Se-yn,Se+Un,1,Qt.minY,Qt.maxY,Ze),Nt=Zt(Kn,Mt,Se+zn,Se+it,1,Qt.minY,Qt.maxY,Ze),Kn=null),St>1&&console.timeEnd("clipping"),qe.push(ii||[],te+1,2*he,2*Se),qe.push(Hi||[],te+1,2*he,2*Se+1),qe.push(xn||[],te+1,2*he+1,2*Se),qe.push(Nt||[],te+1,2*he+1,2*Se+1)}}getTile(re,te,he){re=+re,te=+te,he=+he;const Se=this.options,{extent:Ee,debug:lt}=Se;if(re<0||re>24)return null;const Je=1<<re,qe=Nr(re,te=te+Je&Je-1,he);if(this.tiles[qe])return Pn(this.tiles[qe],Ee);lt>1&&console.log("drilling down to z%d-%d-%d",re,te,he);let Ze,St=re,Mt=te,Wt=he;for(;!Ze&&St>0;)St--,Mt>>=1,Wt>>=1,Ze=this.tiles[Nr(St,Mt,Wt)];return Ze&&Ze.source?(lt>1&&(console.log("found parent tile z%d-%d-%d",St,Mt,Wt),console.time("drilling down")),this.splitTile(Ze.source,St,Mt,Wt,re,te,he),lt>1&&console.timeEnd("drilling down"),this.tiles[qe]?Pn(this.tiles[qe],Ee):null):null}}function Nr(nt,re,te){return 32*((1<<nt)*te+re)+nt}class wl extends Ce{constructor(re,te,he,Se=dn){super(re,te,he),this._dataUpdateable=new Map,this._createGeoJSONIndex=Se}loadVectorTile(re,te){return L._(this,void 0,void 0,(function*(){const he=re.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Se=this._geoJSONIndex.getTile(he.z,he.x,he.y);return Se?Ge(new L.d3(Se.features,{version:2,extent:L.a5})):null}))}loadData(re){return L._(this,void 0,void 0,(function*(){var te;(te=this._pendingRequest)===null||te===void 0||te.abort();const he=this._startPerformance(re);this._pendingRequest=new AbortController;try{(!this._pendingData||re.request||re.data||re.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(re,this._pendingRequest));const Se=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(Se,re),this.loaded={};const Ee={};return this._finishPerformance(he,re,Ee),Ee}catch(Se){if(delete this._pendingRequest,L.Z(Se))return{abandoned:!0};throw Se}}))}_startPerformance(re){var te;if(!((te=re?.request)===null||te===void 0)&&te.collectResourceTiming)return new L.c$(re.request)}_finishPerformance(re,te,he){if(!re)return;const Se=re.finish();Se&&(he.resourceTiming={},he.resourceTiming[te.source]=JSON.parse(JSON.stringify(Se)))}getData(){return L._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(re){const te=this.loaded;return te&&te[re.uid]?super.reloadTile(re):this.loadTile(re)}loadAndProcessGeoJSON(re,te){return L._(this,void 0,void 0,(function*(){let he;if(re.request?he=yield this.loadGeoJSONFromUrl(re.request,re.promoteId,te):re.data?he=this._loadGeoJSONFromObject(re.data,re.promoteId):re.dataDiff&&(he=this._loadGeoJSONFromDiff(re.dataDiff,re.promoteId,re.source)),delete this._pendingRequest,typeof he!="object")throw new Error(`Input data given to '${re.source}' is not a valid GeoJSON object.`);return At(he,!0),re.filter&&(he=this._filterGeoJSON(he,re.filter)),he}))}loadGeoJSONFromUrl(re,te,he){return L._(this,void 0,void 0,(function*(){const Se=yield L.j(re,he);return this._dataUpdateable=L.a7(Se.data,te)?L.a8(Se.data,te):void 0,Se.data}))}_loadGeoJSONFromObject(re,te){return this._dataUpdateable=L.a7(re,te)?L.a8(re,te):void 0,re}_loadGeoJSONFromDiff(re,te,he){if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${he}`);L.a9(this._dataUpdateable,re,te);const Se=Array.from(this._dataUpdateable.values());return this._toFeatureCollection(Se)}_filterGeoJSON(re,te){const he=L.d4(te,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(he.result==="error")throw new Error(he.value.map((Ee=>`${Ee.key}: ${Ee.message}`)).join(", "));const Se=re.features.filter((Ee=>he.value.evaluate({zoom:0},Ee)));return this._toFeatureCollection(Se)}_toFeatureCollection(re){return{type:"FeatureCollection",features:re}}removeSource(re){return L._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(re){return this._geoJSONIndex.getClusterExpansionZoom(re.clusterId)}getClusterChildren(re){return this._geoJSONIndex.getChildren(re.clusterId)}getClusterLeaves(re){return this._geoJSONIndex.getLeaves(re.clusterId,re.limit,re.offset)}}function dn(nt,re){return re.cluster?new de((function({superclusterOptions:te,clusterProperties:he}){if(!he||!te)return te;const Se={},Ee={},lt={accumulated:null,zoom:0},Je={properties:null},qe=Object.keys(he);for(const Ze of qe){const[St,Mt]=he[Ze],Wt=L.d4(Mt),Qt=L.d4(typeof St=="string"?[St,["accumulated"],["get",Ze]]:St);Se[Ze]=Wt.value,Ee[Ze]=Qt.value}return te.map=Ze=>{Je.properties=Ze;const St={};for(const Mt of qe)St[Mt]=Se[Mt].evaluate(lt,Je);return St},te.reduce=(Ze,St)=>{Je.properties=St;for(const Mt of qe)lt.accumulated=Ze[Mt],Ze[Mt]=Ee[Mt].evaluate(lt,Je)},te})(re)).load(nt.features):(function(te,he){return new os(te,he)})(nt,re.geojsonVtOptions)}class Sr{constructor(re){this.self=re,this.actor=new L.L(re),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(te,he)=>{if(this.externalWorkerSourceTypes[te])throw new Error(`Worker source with name "${te}" already registered.`);this.externalWorkerSourceTypes[te]=he},this.self.addProtocol=L.cK,this.self.removeProtocol=L.cL,this.self.registerRTLTextPlugin=te=>{L.d5.setMethods(te)},this.actor.registerMessageHandler("LDT",((te,he)=>this._getDEMWorkerSource(te,he.source).loadTile(he))),this.actor.registerMessageHandler("RDT",((te,he)=>L._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(te,he.source).removeTile(he)})))),this.actor.registerMessageHandler("GCEZ",((te,he)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(te,he.type,he.source).getClusterExpansionZoom(he)})))),this.actor.registerMessageHandler("GCC",((te,he)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(te,he.type,he.source).getClusterChildren(he)})))),this.actor.registerMessageHandler("GCL",((te,he)=>L._(this,void 0,void 0,(function*(){return this._getWorkerSource(te,he.type,he.source).getClusterLeaves(he)})))),this.actor.registerMessageHandler("LD",((te,he)=>this._getWorkerSource(te,he.type,he.source).loadData(he))),this.actor.registerMessageHandler("GD",((te,he)=>this._getWorkerSource(te,he.type,he.source).getData())),this.actor.registerMessageHandler("LT",((te,he)=>this._getWorkerSource(te,he.type,he.source).loadTile(he))),this.actor.registerMessageHandler("RT",((te,he)=>this._getWorkerSource(te,he.type,he.source).reloadTile(he))),this.actor.registerMessageHandler("AT",((te,he)=>this._getWorkerSource(te,he.type,he.source).abortTile(he))),this.actor.registerMessageHandler("RMT",((te,he)=>this._getWorkerSource(te,he.type,he.source).removeTile(he))),this.actor.registerMessageHandler("RS",((te,he)=>L._(this,void 0,void 0,(function*(){if(!this.workerSources[te]||!this.workerSources[te][he.type]||!this.workerSources[te][he.type][he.source])return;const Se=this.workerSources[te][he.type][he.source];delete this.workerSources[te][he.type][he.source],Se.removeSource!==void 0&&Se.removeSource(he)})))),this.actor.registerMessageHandler("RM",(te=>L._(this,void 0,void 0,(function*(){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],this.globalStates.delete(te)})))),this.actor.registerMessageHandler("SR",((te,he)=>L._(this,void 0,void 0,(function*(){this.referrer=he})))),this.actor.registerMessageHandler("SRPS",((te,he)=>this._syncRTLPluginState(te,he))),this.actor.registerMessageHandler("IS",((te,he)=>L._(this,void 0,void 0,(function*(){this.self.importScripts(he)})))),this.actor.registerMessageHandler("SI",((te,he)=>this._setImages(te,he))),this.actor.registerMessageHandler("UL",((te,he)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(te).update(he.layers,he.removedIds,this._getGlobalState(te))})))),this.actor.registerMessageHandler("UGS",((te,he)=>L._(this,void 0,void 0,(function*(){const Se=this._getGlobalState(te);for(const Ee in he)Se[Ee]=he[Ee]})))),this.actor.registerMessageHandler("SL",((te,he)=>L._(this,void 0,void 0,(function*(){this._getLayerIndex(te).replace(he,this._getGlobalState(te))}))))}_getGlobalState(re){let te=this.globalStates.get(re);return te||(te={},this.globalStates.set(re,te)),te}_setImages(re,te){return L._(this,void 0,void 0,(function*(){this.availableImages[re]=te;for(const he in this.workerSources[re]){const Se=this.workerSources[re][he];for(const Ee in Se)Se[Ee].availableImages=te}}))}_syncRTLPluginState(re,te){return L._(this,void 0,void 0,(function*(){return yield L.d5.syncState(te,this.self.importScripts)}))}_getAvailableImages(re){let te=this.availableImages[re];return te||(te=[]),te}_getLayerIndex(re){let te=this.layerIndexes[re];return te||(te=this.layerIndexes[re]=new c),te}_getWorkerSource(re,te,he){if(this.workerSources[re]||(this.workerSources[re]={}),this.workerSources[re][te]||(this.workerSources[re][te]={}),!this.workerSources[re][te][he]){const Se={sendAsync:(Ee,lt)=>(Ee.targetMapId=re,this.actor.sendAsync(Ee,lt))};switch(te){case"vector":this.workerSources[re][te][he]=new Ce(Se,this._getLayerIndex(re),this._getAvailableImages(re));break;case"geojson":this.workerSources[re][te][he]=new wl(Se,this._getLayerIndex(re),this._getAvailableImages(re));break;default:this.workerSources[re][te][he]=new this.externalWorkerSourceTypes[te](Se,this._getLayerIndex(re),this._getAvailableImages(re))}}return this.workerSources[re][te][he]}_getDEMWorkerSource(re,te){return this.demWorkerSources[re]||(this.demWorkerSources[re]={}),this.demWorkerSources[re][te]||(this.demWorkerSources[re][te]=new It),this.demWorkerSources[re][te]}}return L.i(self)&&(self.worker=new Sr(self)),Sr})),D("index",["exports","./shared"],(function(L,c){var X="5.14.0";function ne(){var v=new c.A(4);return c.A!=Float32Array&&(v[1]=0,v[2]=0),v[0]=1,v[3]=1,v}let fe,ie,xe;const Be={frame(v,t,a){const h=requestAnimationFrame((b=>{p(),t(b)})),{unsubscribe:p}=c.s(v.signal,"abort",(()=>{p(),cancelAnimationFrame(h),a(new c.a(v.signal.reason))}),!1)},frameAsync(v){return new Promise(((t,a)=>{this.frame(v,t,a)}))},getImageData(v,t=0){return this.getImageCanvasContext(v).getImageData(-t,-t,v.width+2*t,v.height+2*t)},getImageCanvasContext(v){const t=window.document.createElement("canvas"),a=t.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return t.width=v.width,t.height=v.height,a.drawImage(v,0,0,v.width,v.height),a},resolveURL:v=>(fe||(fe=document.createElement("a")),fe.href=v,fe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return xe!==void 0?xe:!!matchMedia&&(ie==null&&(ie=matchMedia("(prefers-reduced-motion: reduce)")),ie.matches)},set prefersReducedMotion(v){xe=v}},Ge=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(v){this._frozenAt=v}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function dt(){return Ge.getCurrentTime()}class Ce{static testProp(t){if(!Ce.docStyle)return t[0];for(let a=0;a<t.length;a++)if(t[a]in Ce.docStyle)return t[a];return t[0]}static create(t,a,h){const p=window.document.createElement(t);return a!==void 0&&(p.className=a),h&&h.appendChild(p),p}static createNS(t,a){return window.document.createElementNS(t,a)}static disableDrag(){Ce.docStyle&&Ce.selectProp&&(Ce.userSelect=Ce.docStyle[Ce.selectProp],Ce.docStyle[Ce.selectProp]="none")}static enableDrag(){Ce.docStyle&&Ce.selectProp&&(Ce.docStyle[Ce.selectProp]=Ce.userSelect)}static setTransform(t,a){t.style[Ce.transformProp]=a}static addEventListener(t,a,h,p={}){t.addEventListener(a,h,"passive"in p?p:p.capture)}static removeEventListener(t,a,h,p={}){t.removeEventListener(a,h,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",Ce.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Ce.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",Ce.suppressClickInternal,!0)}),0)}static getScale(t){const a=t.getBoundingClientRect();return{x:a.width/t.offsetWidth||1,y:a.height/t.offsetHeight||1,boundingClientRect:a}}static getPoint(t,a,h){const p=a.boundingClientRect;return new c.P((h.clientX-p.left)/a.x-t.clientLeft,(h.clientY-p.top)/a.y-t.clientTop)}static mousePos(t,a){const h=Ce.getScale(t);return Ce.getPoint(t,h,a)}static touchPos(t,a){const h=[],p=Ce.getScale(t);for(let b=0;b<a.length;b++)h.push(Ce.getPoint(t,p,a[b]));return h}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}static sanitize(t){const a=new DOMParser().parseFromString(t,"text/html").body||document.createElement("body"),h=a.querySelectorAll("script");for(const p of h)p.remove();return Ce.clean(a),a.innerHTML}static isPossiblyDangerous(t,a){const h=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(t)||!h.includes("javascript:")&&!h.includes("data:"))||!!t.startsWith("on")||void 0}static clean(t){const a=t.children;for(const h of a)Ce.removeAttributes(h),Ce.clean(h)}static removeAttributes(t){for(const{name:a,value:h}of t.attributes)Ce.isPossiblyDangerous(a,h)&&t.removeAttribute(a)}}Ce.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Ce.selectProp=Ce.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Ce.transformProp=Ce.testProp(["transform","WebkitTransform"]);const It={supported:!1,testSupport:function(v){!jt&&at&&(At?Vt(v):Ye=v)}};let Ye,at,jt=!1,At=!1;function Vt(v){const t=v.createTexture();v.bindTexture(v.TEXTURE_2D,t);try{if(v.texImage2D(v.TEXTURE_2D,0,v.RGBA,v.RGBA,v.UNSIGNED_BYTE,at),v.isContextLost())return;It.supported=!0}catch{}v.deleteTexture(t),jt=!0}var wt;typeof document<"u"&&(at=document.createElement("img"),at.onload=()=>{Ye&&Vt(Ye),Ye=null,At=!0},at.onerror=()=>{jt=!0,Ye=null},at.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(v){let t,a,h,p;v.resetRequestQueue=()=>{t=[],a=0,h=0,p={}},v.addThrottleControl=z=>{const F=h++;return p[F]=z,F},v.removeThrottleControl=z=>{delete p[z],T()},v.getImage=(z,F,V=!0)=>new Promise(((H,Y)=>{It.supported&&(z.headers||(z.headers={}),z.headers.accept="image/webp,*/*"),c.e(z,{type:"image"}),t.push({abortController:F,requestParameters:z,supportImageRefresh:V,state:"queued",onError:J=>{Y(J)},onSuccess:J=>{H(J)}}),T()}));const b=z=>c._(this,void 0,void 0,(function*(){z.state="running";const{requestParameters:F,supportImageRefresh:V,onError:H,onSuccess:Y,abortController:J}=z,ae=V===!1&&!c.i(self)&&!c.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce(((ye,be)=>ye&&be==="accept"),!0));a++;const ge=ae?k(F,J):c.m(F,J);try{const ye=yield ge;delete z.abortController,z.state="completed",ye.data instanceof HTMLImageElement||c.b(ye.data)?Y(ye):ye.data&&Y({data:yield(ve=ye.data,typeof createImageBitmap=="function"?c.f(ve):c.h(ve)),cacheControl:ye.cacheControl,expires:ye.expires})}catch(ye){delete z.abortController,H(ye)}finally{a--,T()}var ve})),T=()=>{const z=(()=>{for(const F of Object.keys(p))if(p[F]())return!0;return!1})()?c.c.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.c.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=a;F<z&&t.length>0;F++){const V=t.shift();V.abortController.signal.aborted?F--:b(V)}},k=(z,F)=>new Promise(((V,H)=>{const Y=new Image,J=z.url,ae=z.credentials;ae&&ae==="include"?Y.crossOrigin="use-credentials":(ae&&ae==="same-origin"||!c.d(J))&&(Y.crossOrigin="anonymous"),F.signal.addEventListener("abort",(()=>{Y.src="",H(new c.a(F.signal.reason))})),Y.fetchPriority="high",Y.onload=()=>{Y.onerror=Y.onload=null,V({data:Y})},Y.onerror=()=>{Y.onerror=Y.onload=null,F.signal.aborted||H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Y.src=J}))})(wt||(wt={})),wt.resetRequestQueue();class oe{constructor(t){this._transformRequestFn=t??null}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}setTransformRequest(t){this._transformRequestFn=t}}function de(v){const t=[];if(typeof v=="string")t.push({id:"default",url:v});else if(v&&v.length>0){const a=[];for(const{id:h,url:p}of v){const b=`${h}${p}`;a.indexOf(b)===-1&&(a.push(b),t.push({id:h,url:p}))}}return t}function Ie(v,t,a){try{const h=new URL(v);return h.pathname+=`${t}${a}`,h.toString()}catch{throw new Error(`Invalid sprite URL "${v}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Xe(v){const{userImage:t}=v;return!!(t&&t.render&&t.render())&&(v.data.replace(new Uint8Array(t.data.buffer)),!0)}class Ne extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}destroy(){this.atlasTexture&&(this.atlasTexture.destroy(),this.atlasTexture=null);for(const t of Object.keys(this.images))this.removeImage(t);this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:a,promiseResolve:h}of this.requestors)h(this._getImagesForIds(a));this.requestors=[]}}getImage(t){const a=this.images[t];if(a&&!a.data&&a.spriteData){const h=a.spriteData;a.data=new c.R({width:h.width,height:h.height},h.context.getImageData(h.x,h.y,h.width,h.height).data),a.spriteData=null}return a}addImage(t,a){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,a)&&(this.images[t]=a)}_validate(t,a){let h=!0;const p=a.data||a.spriteData;return this._validateStretch(a.stretchX,p&&p.width)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchX" value`))),h=!1),this._validateStretch(a.stretchY,p&&p.height)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "stretchY" value`))),h=!1),this._validateContent(a.content,a)||(this.fire(new c.k(new Error(`Image "${t}" has invalid "content" value`))),h=!1),h}_validateStretch(t,a){if(!t)return!0;let h=0;for(const p of t){if(p[0]<h||p[1]<p[0]||a<p[1])return!1;h=p[1]}return!0}_validateContent(t,a){if(!t)return!0;if(t.length!==4)return!1;const h=a.spriteData,p=h&&h.width||a.data.width,b=h&&h.height||a.data.height;return!(t[0]<0||p<t[0]||t[1]<0||b<t[1]||t[2]<0||p<t[2]||t[3]<0||b<t[3]||t[2]<t[0]||t[3]<t[1])}updateImage(t,a,h=!0){const p=this.getImage(t);if(h&&(p.data.width!==a.data.width||p.data.height!==a.data.height))throw new Error(`size mismatch between old image (${p.data.width}x${p.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=p.version+1,this.images[t]=a,this.updatedImages[t]=!0}removeImage(t){const a=this.images[t];delete this.images[t],delete this.patterns[t],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t){return new Promise(((a,h)=>{let p=!0;if(!this.isLoaded())for(const b of t)this.images[b]||(p=!1);this.isLoaded()||p?a(this._getImagesForIds(t)):this.requestors.push({ids:t,promiseResolve:a})}))}_getImagesForIds(t){const a={};for(const h of t){let p=this.getImage(h);p||(this.fire(new c.l("styleimagemissing",{id:h})),p=this.getImage(h)),p?a[h]={data:p.data.clone(),pixelRatio:p.pixelRatio,sdf:p.sdf,version:p.version,stretchX:p.stretchX,stretchY:p.stretchY,content:p.content,textFitWidth:p.textFitWidth,textFitHeight:p.textFitHeight,hasRenderCallback:!!(p.userImage&&p.userImage.render)}:c.w(`Image "${h}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:t,height:a}=this.atlasImage;return{width:t,height:a}}getPattern(t){const a=this.patterns[t],h=this.getImage(t);if(!h)return null;if(a&&a.position.version===h.version)return a.position;if(a)a.position.version=h.version;else{const p={w:h.data.width+2,h:h.data.height+2,x:0,y:0},b=new c.I(p,h);this.patterns[t]={bin:p,position:b}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const a=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.T(t,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const b in this.patterns)t.push(this.patterns[b].bin);const{w:a,h}=c.p(t),p=this.atlasImage;p.resize({width:a||1,height:h||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],k=T.x+1,z=T.y+1,F=this.getImage(b).data,V=F.width,H=F.height;c.R.copy(F,p,{x:0,y:0},{x:k,y:z},{width:V,height:H}),c.R.copy(F,p,{x:0,y:H-1},{x:k,y:z-1},{width:V,height:1}),c.R.copy(F,p,{x:0,y:0},{x:k,y:z+H},{width:V,height:1}),c.R.copy(F,p,{x:V-1,y:0},{x:k-1,y:z},{width:1,height:H}),c.R.copy(F,p,{x:0,y:0},{x:k+V,y:z},{width:1,height:H})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const a of t){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const h=this.getImage(a);h||c.w(`Image with ID: "${a}" was not found`),Xe(h)&&this.updateImage(a,h)}}cloneImages(){const t={};for(const a in this.images){const h=this.images[a];t[a]=Object.assign(Object.assign({},h),{data:h.data?h.data.clone():null})}return t}}const He=1e20;function Fe(v,t,a,h,p,b,T,k,z){for(let F=t;F<t+h;F++)Le(v,a*b+F,b,p,T,k,z);for(let F=a;F<a+p;F++)Le(v,F*b+t,1,h,T,k,z)}function Le(v,t,a,h,p,b,T){b[0]=0,T[0]=-He,T[1]=He,p[0]=v[t];for(let k=1,z=0,F=0;k<h;k++){p[k]=v[t+k*a];const V=k*k;do{const H=b[z];F=(p[k]-p[H]+V-H*H)/(k-H)/2}while(F<=T[z]&&--z>-1);z++,b[z]=k,T[z]=F,T[z+1]=He}for(let k=0,z=0;k<h;k++){for(;T[z+1]<k;)z++;const F=b[z],V=k-F;v[t+k*a]=p[F]+V*V}}const me=c.v.layout_symbol["text-font"].default.join(",");class Pe{constructor(t,a,h){this.requestManager=t,this.localIdeographFontFamily=a,this.entries={},this.lang=h}setURL(t){this.url=t}getGlyphs(t){return c._(this,void 0,void 0,(function*(){const a=[];for(const b in t)for(const T of t[b])a.push(this._getAndCacheGlyphsPromise(b,T));const h=yield Promise.all(a),p={};for(const{stack:b,id:T,glyph:k}of h)p[b]||(p[b]={}),p[b][T]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};return p}))}_getAndCacheGlyphsPromise(t,a){return c._(this,void 0,void 0,(function*(){let h=this.entries[t];h||(h=this.entries[t]={glyphs:{},requests:{},ranges:{}});let p=h.glyphs[a];return p!==void 0?{stack:t,id:a,glyph:p}:!this.url||this._charUsesLocalIdeographFontFamily(a)?(p=h.glyphs[a]=this._drawGlyph(h,t,a),{stack:t,id:a,glyph:p}):yield this._downloadAndCacheRangePromise(t,a)}))}_downloadAndCacheRangePromise(t,a){return c._(this,void 0,void 0,(function*(){const h=this.entries[t],p=Math.floor(a/256);if(h.ranges[p])return{stack:t,id:a,glyph:null};if(!h.requests[p]){const b=Pe.loadGlyphRange(t,p,this.url,this.requestManager);h.requests[p]=b}try{const b=yield h.requests[p];for(const T in b)h.glyphs[+T]=b[+T];return h.ranges[p]=!0,{stack:t,id:a,glyph:b[a]||null}}catch(b){const T=h.glyphs[a]=this._drawGlyph(h,t,a);return this._warnOnMissingGlyphRange(T,p,a,b),{stack:t,id:a,glyph:T}}}))}_warnOnMissingGlyphRange(t,a,h,p){const b=256*a,T=b+255,k=h.toString(16).padStart(4,"0").toUpperCase();c.w(`Unable to load glyph range ${a}, ${b}-${T}. Rendering codepoint U+${k} locally instead. ${p}`)}_charUsesLocalIdeographFontFamily(t){return!!this.localIdeographFontFamily&&c.q(t)}_drawGlyph(t,a,h){const p=a===me&&this.localIdeographFontFamily!==""&&this._charUsesLocalIdeographFontFamily(h),b=p?"ideographTinySDF":"tinySDF";t[b]||(t[b]=this._createTinySDF(p?this.localIdeographFontFamily:a));const T=t[b].draw(String.fromCodePoint(h));return{id:h,bitmap:new c.r({width:T.width||60,height:T.height||60},T.data),metrics:{width:T.glyphWidth/2||24,height:T.glyphHeight/2||24,left:T.glyphLeft/2+.5||0,top:T.glyphTop/2-27.5||-8,advance:T.glyphAdvance/2||24,isDoubleResolution:!0}}}_createTinySDF(t){const a=t?t.split(","):[];a.push("sans-serif");const h=a.map((p=>/[-\w]+/.test(p)?p:`'${CSS.escape(p)}'`)).join(",");return new Pe.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:h,fontWeight:this._fontWeight(a[0]),fontStyle:this._fontStyle(a[0]),lang:this.lang})}_fontStyle(t){return/italic/i.test(t)?"italic":/oblique/i.test(t)?"oblique":"normal"}_fontWeight(t){const a={thin:100,hairline:100,"extra light":200,"ultra light":200,light:300,normal:400,regular:400,medium:500,semibold:600,demibold:600,bold:700,"extra bold":800,"ultra bold":800,black:900,heavy:900,"extra black":950,"ultra black":950};let h;for(const[p,b]of Object.entries(a))new RegExp(`\\b${p}\\b`,"i").test(t)&&(h=`${b}`);return h}destroy(){for(const t in this.entries){const a=this.entries[t];a.tinySDF&&(a.tinySDF=null),a.ideographTinySDF&&(a.ideographTinySDF=null),a.glyphs={},a.requests={},a.ranges={}}this.entries={}}}Pe.loadGlyphRange=function(v,t,a,h){return c._(this,void 0,void 0,(function*(){const p=256*t,b=p+255,T=h.transformRequest(a.replace("{fontstack}",v).replace("{range}",`${p}-${b}`),"Glyphs"),k=yield c.n(T,new AbortController);if(!k||!k.data)throw new Error(`Could not load glyph range. range: ${t}, ${p}-${b}`);const z={};for(const F of c.o(k.data))z[F.id]=F;return z}))},Pe.TinySDF=class{constructor({fontSize:v=24,buffer:t=3,radius:a=8,cutoff:h=.25,fontFamily:p="sans-serif",fontWeight:b="normal",fontStyle:T="normal",lang:k=null}={}){this.buffer=t,this.cutoff=h,this.radius=a,this.lang=k;const z=this.size=v+4*t,F=this._createCanvas(z),V=this.ctx=F.getContext("2d",{willReadFrequently:!0});V.font=`${T} ${b} ${v}px ${p}`,V.textBaseline="alphabetic",V.textAlign="left",V.fillStyle="black",this.gridOuter=new Float64Array(z*z),this.gridInner=new Float64Array(z*z),this.f=new Float64Array(z),this.z=new Float64Array(z+1),this.v=new Uint16Array(z)}_createCanvas(v){const t=document.createElement("canvas");return t.width=t.height=v,t}draw(v){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:p,actualBoundingBoxRight:b}=this.ctx.measureText(v),T=Math.ceil(a),k=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-p))),z=Math.min(this.size-this.buffer,T+Math.ceil(h)),F=k+2*this.buffer,V=z+2*this.buffer,H=Math.max(F*V,0),Y=new Uint8ClampedArray(H),J={data:Y,width:F,height:V,glyphWidth:k,glyphHeight:z,glyphTop:T,glyphLeft:0,glyphAdvance:t};if(k===0||z===0)return J;const{ctx:ae,buffer:ge,gridInner:ve,gridOuter:ye}=this;this.lang&&(ae.lang=this.lang),ae.clearRect(ge,ge,k,z),ae.fillText(v,ge,ge+T);const be=ae.getImageData(ge,ge,k,z);ye.fill(He,0,H),ve.fill(0,0,H);for(let De=0;De<z;De++)for(let we=0;we<k;we++){const Oe=be.data[4*(De*k+we)+3]/255;if(Oe===0)continue;const je=(De+ge)*F+we+ge;if(Oe===1)ye[je]=0,ve[je]=He;else{const Ae=.5-Oe;ye[je]=Ae>0?Ae*Ae:0,ve[je]=Ae<0?Ae*Ae:0}}Fe(ye,0,0,F,V,F,this.f,this.v,this.z),Fe(ve,ge,ge,k,z,F,this.f,this.v,this.z);for(let De=0;De<H;De++){const we=Math.sqrt(ye[De])-Math.sqrt(ve[De]);Y[De]=Math.round(255-255*(we/this.radius+this.cutoff))}return J}};class Ue{constructor(){this.specification=c.u.light.position}possiblyEvaluate(t,a){return c.F(t.expression.evaluate(a))}interpolate(t,a,h){return{x:c.G.number(t.x,a.x,h),y:c.G.number(t.y,a.y,h),z:c.G.number(t.z,a.z,h)}}}let tt;class vt extends c.E{constructor(t){super(),tt=tt||new c.t({anchor:new c.D(c.u.light.anchor),position:new Ue,color:new c.D(c.u.light.color),intensity:new c.D(c.u.light.intensity)}),this._transitionable=new c.x(tt,void 0),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a={}){if(!this._validate(c.y,t,a))for(const h in t){const p=t[h];h.endsWith(c.z)?this._transitionable.setTransition(h.slice(0,-c.z.length),p):this._transitionable.setValue(h,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,h){return(!h||h.validate!==!1)&&c.B(this,t.call(c.C,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.u}))}}const Me=new c.t({"sky-color":new c.D(c.u.sky["sky-color"]),"horizon-color":new c.D(c.u.sky["horizon-color"]),"fog-color":new c.D(c.u.sky["fog-color"]),"fog-ground-blend":new c.D(c.u.sky["fog-ground-blend"]),"horizon-fog-blend":new c.D(c.u.sky["horizon-fog-blend"]),"sky-horizon-blend":new c.D(c.u.sky["sky-horizon-blend"]),"atmosphere-blend":new c.D(c.u.sky["atmosphere-blend"])});class ut extends c.E{constructor(t){super(),this._transitionable=new c.x(Me,void 0),this.setSky(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0))}setSky(t,a={}){if(!this._validate(c.J,t,a)){t||(t={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const h in t){const p=t[h];h.endsWith(c.z)?this._transitionable.setTransition(h.slice(0,-c.z.length),p):this._transitionable.setValue(h,p)}}}getSky(){return this._transitionable.serialize()}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,h={}){return h?.validate!==!1&&c.B(this,t.call(c.C,c.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:c.u})))}calculateFogBlendOpacity(t){return t<60?0:t<70?(t-60)/10:1}}class Ot{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,a){const h=t.join(",")+String(a);return this.dashEntry[h]||(this.dashEntry[h]=this.addDash(t,a)),this.dashEntry[h]}getDashRanges(t,a,h){const p=[];let b=t.length%2==1?-t[t.length-1]*h:0,T=t[0]*h,k=!0;p.push({left:b,right:T,isDash:k,zeroLength:t[0]===0});let z=t[0];for(let F=1;F<t.length;F++){k=!k;const V=t[F];b=z*h,z+=V,T=z*h,p.push({left:b,right:T,isDash:k,zeroLength:V===0})}return p}addRoundDash(t,a,h){const p=a/2;for(let b=-h;b<=h;b++){const T=this.width*(this.nextRow+h+b);let k=0,z=t[k];for(let F=0;F<this.width;F++){F/z.right>1&&(z=t[++k]);const V=Math.abs(F-z.left),H=Math.abs(F-z.right),Y=Math.min(V,H);let J;const ae=b/h*(p+1);if(z.isDash){const ge=p-Math.abs(ae);J=Math.sqrt(Y*Y+ge*ge)}else J=p-Math.sqrt(Y*Y+ae*ae);this.data[T+F]=Math.max(0,Math.min(255,J+128))}}}addRegularDash(t){for(let k=t.length-1;k>=0;--k){const z=t[k],F=t[k+1];z.zeroLength?t.splice(k,1):F&&F.isDash===z.isDash&&(F.left=z.left,t.splice(k,1))}const a=t[0],h=t[t.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const p=this.width*this.nextRow;let b=0,T=t[b];for(let k=0;k<this.width;k++){k/T.right>1&&(T=t[++b]);const z=Math.abs(k-T.left),F=Math.abs(k-T.right),V=Math.min(z,F);this.data[p+k]=Math.max(0,Math.min(255,(T.isDash?V:-V)+128))}}addDash(t,a){const h=a?7:0,p=2*h+1;if(this.nextRow+p>this.height)return c.w("LineAtlas out of space"),null;let b=0;for(let k=0;k<t.length;k++)b+=t[k];if(b!==0){const k=this.width/b,z=this.getDashRanges(t,this.width,k);a?this.addRoundDash(z,k,h):this.addRegularDash(z)}const T={y:this.nextRow+h,height:2*h,width:b};return this.nextRow+=p,this.dirty=!0,T}bind(t){const a=t.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const Ct="maplibre_preloaded_worker_pool";class Zt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Zt.workerCount;)this.workers.push(new Worker(c.c.WORKER_URL));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Ct]}numActive(){return Object.keys(this.active).length}}const tn=Math.floor(Be.hardwareConcurrency/2);let _n,Qe;function ni(){return _n||(_n=new Zt),_n}Zt.workerCount=c.K(globalThis)?Math.max(Math.min(tn,3),1):1;class Rn{constructor(t,a){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=a;const h=this.workerPool.acquire(a);for(let p=0;p<h.length;p++){const b=new c.L(h[p],a);b.name=`Worker ${p}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,a){const h=[];for(const p of this.actors)h.push(p.sendAsync({type:t,data:a}));return Promise.all(h)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(t=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],t&&this.workerPool.release(this.id)}registerMessageHandler(t,a){for(const h of this.actors)h.registerMessageHandler(t,a)}unregisterMessageHandler(t){for(const a of this.actors)a.unregisterMessageHandler(t)}}function rn(){return Qe||(Qe=new Rn(ni(),c.M),Qe.registerMessageHandler("GR",((v,t,a)=>c.m(t,a)))),Qe}function Re(v,t){const a=c.N();return c.O(a,a,[1,1,0]),c.Q(a,a,[.5*v.width,.5*v.height,1]),v.calculatePosMatrix?c.S(a,a,v.calculatePosMatrix(t.toUnwrapped())):a}function fi(v,t,a,h,p,b,T){var k;const z=(function(Y,J,ae){if(Y)for(const ge of Y){const ve=J[ge];if(ve&&ve.source===ae&&ve.type==="fill-extrusion")return!0}else for(const ge in J){const ve=J[ge];if(ve.source===ae&&ve.type==="fill-extrusion")return!0}return!1})((k=p?.layers)!==null&&k!==void 0?k:null,t,v.id),F=b.maxPitchScaleFactor(),V=v.tilesIn(h,F,z);V.sort(Dn);const H=[];for(const Y of V)H.push({wrappedTileID:Y.tileID.wrapped().key,queryResults:Y.tile.queryRenderedFeatures(t,a,v.getState(),Y.queryGeometry,Y.cameraQueryGeometry,Y.scale,p,b,F,Re(b,Y.tileID),T?(J,ae)=>T(Y.tileID,J,ae):void 0)});return(function(Y,J){for(const ae in Y)for(const ge of Y[ae])Pn(ge,J);return Y})((function(Y){const J={},ae={};for(const ge of Y){const ve=ge.queryResults,ye=ge.wrappedTileID,be=ae[ye]=ae[ye]||{};for(const De in ve){const we=ve[De],Oe=be[De]=be[De]||{},je=J[De]=J[De]||[];for(const Ae of we)Oe[Ae.featureIndex]||(Oe[Ae.featureIndex]=!0,je.push(Ae))}}return J})(H),v)}function Dn(v,t){const a=v.tileID,h=t.tileID;return a.overscaledZ-h.overscaledZ||a.canonical.y-h.canonical.y||a.wrap-h.wrap||a.canonical.x-h.canonical.x}function Pn(v,t){const a=v.feature,h=t.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=h}function Ia(v,t,a){return c._(this,void 0,void 0,(function*(){let h=v;if(v.url?h=(yield c.j(t.transformRequest(v.url,"Source"),a)).data:yield Be.frameAsync(a),!h)return null;const p=c.U(c.e(h,v),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in h&&h.vector_layers&&(p.vectorLayerIds=h.vector_layers.map((b=>b.id))),p}))}class Ri{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&(t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}setNorthEast(t){return this._ne=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}setSouthWest(t){return this._sw=t instanceof c.V?new c.V(t.lng,t.lat):c.V.convert(t),this}extend(t){const a=this._sw,h=this._ne;let p,b;if(t instanceof c.V)p=t,b=t;else{if(!(t instanceof Ri))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ri.convert(t)):this.extend(c.V.convert(t)):t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(c.V.convert(t)):this;if(p=t._sw,b=t._ne,!p||!b)return this}return a||h?(a.lng=Math.min(p.lng,a.lng),a.lat=Math.min(p.lat,a.lat),h.lng=Math.max(b.lng,h.lng),h.lat=Math.max(b.lat,h.lat)):(this._sw=new c.V(p.lng,p.lat),this._ne=new c.V(b.lng,b.lat)),this}getCenter(){return new c.V((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.V(this.getWest(),this.getNorth())}getSouthEast(){return new c.V(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:h}=c.V.convert(t);let p=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&p}intersects(t){if(!((t=Ri.convert(t)).getNorth()>=this.getSouth()&&t.getSouth()<=this.getNorth()))return!1;const a=c.W(this.getWest(),-180,180),h=c.W(this.getEast(),-180,180),p=c.W(t.getWest(),-180,180),b=c.W(t.getEast(),-180,180),T=a>=h,k=p>=b;return!(!T||!k)||(T?b>=a||p<=h:k?h>=p||a<=b:p<=h&&b>=a)}static convert(t){return t instanceof Ri?t:t&&new Ri(t)}static fromLngLat(t,a=0){const h=360*a/40075017,p=h/Math.cos(Math.PI/180*t.lat);return new Ri(new c.V(t.lng-p,t.lat-h),new c.V(t.lng+p,t.lat+h))}adjustAntiMeridian(){const t=new c.V(this._sw.lng,this._sw.lat),a=new c.V(this._ne.lng,this._ne.lat);return new Ri(t,t.lng>a.lng?new c.V(a.lng+360,a.lat):a)}}class Gs{constructor(t,a,h){this.bounds=Ri.convert(this.validateBounds(t)),this.minzoom=a||0,this.maxzoom=h||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const a=Math.pow(2,t.z),h=Math.floor(c.Y(this.bounds.getWest())*a),p=Math.floor(c.X(this.bounds.getNorth())*a),b=Math.ceil(c.Y(this.bounds.getEast())*a),T=Math.ceil(c.X(this.bounds.getSouth())*a);return t.x>=h&&t.x<b&&t.y>=p&&t.y<T}}class Yt extends c.E{constructor(t,a,h,p){if(super(),this.id=t,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.U(a,["url","scheme","tileSize","promoteId","encoding"])),this._options=c.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const t=yield Ia(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.tileManagers[this.id].clearTiles(),t&&(c.e(this,t),t.bounds&&(this.tileBounds=new Gs(t.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})))}catch(t){this._tileJSONRequest=null,this._loaded=!0,c.Z(t)||this.fire(new c.k(t))}}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.abort(),t(),this.load()}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(t){return c._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h={request:this.map._requestManager.transformRequest(a,"Tile"),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,encoding:this.encoding,overzoomParameters:this._getOverzoomParameters(t)};h.request.collectResourceTiming=this._collectResourceTiming;let p="RT";if(t.actor&&t.state!=="expired"){if(t.state==="loading")return new Promise(((b,T)=>{t.reloadPromise={resolve:b,reject:T}}))}else t.actor=this.dispatcher.getActor(),p="LT";t.abortController=new AbortController;try{const b=yield t.actor.sendAsync({type:p,data:h},t.abortController);if(delete t.abortController,t.aborted)return;this._afterTileLoadWorkerResponse(t,b)}catch(b){if(delete t.abortController,t.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(t,null)}}))}_getOverzoomParameters(t){if(t.tileID.canonical.z<=this.maxzoom||this.map._zoomLevelsToOverscale===void 0)return;const a=t.tileID.scaledTo(this.maxzoom).canonical,h=a.url(this.tiles,this.map.getPixelRatio(),this.scheme);return{maxZoomTileID:a,overzoomRequest:this.map._requestManager.transformRequest(h,"Tile")}}_afterTileLoadWorkerResponse(t,a){if(a&&a.resourceTiming&&(t.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&t.setExpiryData(a),t.loadVectorData(a,this.map.painter),t.reloadPromise){const h=t.reloadPromise;t.reloadPromise=null,this.loadTile(t).then(h.resolve).catch(h.reject)}}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.actor&&(yield t.actor.sendAsync({type:"AT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),t.actor&&(yield t.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class qs extends c.E{constructor(t,a,h,p){super(),this.id=t,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},a),c.e(this,c.U(a,["url","scheme","tileSize"]))}load(){return c._(this,arguments,void 0,(function*(t=!1){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Ia(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(c.e(this,a),a.bounds&&(this.tileBounds=new Gs(a.bounds,this.minzoom,this.maxzoom)),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:t})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,c.Z(a)||this.fire(new c.k(a))}}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(t){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),t(),this.load(!0)}setTiles(t){return this.setSourceProperty((()=>{this._options.tiles=t})),this}setUrl(t){return this.setSourceProperty((()=>{this.url=t,this._options.url=t})),this}serialize(){return c.e({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t){return c._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.abortController=new AbortController;try{const h=yield wt.getImage(this.map._requestManager.transformRequest(a,"Tile"),t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(h&&h.data){this.map._refreshExpiredTiles&&(h.cacheControl||h.expires)&&t.setExpiryData({cacheControl:h.cacheControl,expires:h.expires});const p=this.map.painter.context,b=p.gl,T=h.data;t.texture=this.map.painter.getTileTexture(T.width),t.texture?t.texture.update(T,{useMipmap:!0}):(t.texture=new c.T(p,T,b.RGBA,{useMipmap:!0}),t.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST)),t.state="loaded"}}catch(h){if(delete t.abortController,t.aborted)t.state="unloaded";else if(h)throw t.state="errored",h}}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController)}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.texture&&this.map.painter.saveTileTexture(t.texture)}))}hasTransition(){return!1}}class os extends qs{constructor(t,a,h,p){super(t,a,h,p),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(t){return c._(this,void 0,void 0,(function*(){const a=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),h=this.map._requestManager.transformRequest(a,"Tile");t.neighboringTiles=this._getNeighboringTiles(t.tileID),t.abortController=new AbortController;try{const p=yield wt.getImage(h,t.abortController,this.map._refreshExpiredTiles);if(delete t.abortController,t.aborted)return void(t.state="unloaded");if(p&&p.data){const b=p.data;this.map._refreshExpiredTiles&&(p.cacheControl||p.expires)&&t.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const T=c.b(b)&&c.$()?b:yield this.readImageNow(b),k={type:this.type,uid:t.uid,source:this.id,rawImageData:T,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!t.actor||t.state==="expired"){t.actor=this.dispatcher.getActor();const z=yield t.actor.sendAsync({type:"LDT",data:k});t.dem=z,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded"}}}catch(p){if(delete t.abortController,t.aborted)t.state="unloaded";else if(p)throw t.state="errored",p}}))}readImageNow(t){return c._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&c.a0()){const a=t.width+2,h=t.height+2;try{return new c.R({width:a,height:h},yield c.a1(t,-1,-1,a,h))}catch{}}return Be.getImageData(t,1)}))}_getNeighboringTiles(t){const a=t.canonical,h=Math.pow(2,a.z),p=(a.x-1+h)%h,b=a.x===0?t.wrap-1:t.wrap,T=(a.x+1+h)%h,k=a.x+1===h?t.wrap+1:t.wrap,z={};return z[new c.a2(t.overscaledZ,b,a.z,p,a.y).key]={backfilled:!1},z[new c.a2(t.overscaledZ,k,a.z,T,a.y).key]={backfilled:!1},a.y>0&&(z[new c.a2(t.overscaledZ,b,a.z,p,a.y-1).key]={backfilled:!1},z[new c.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},z[new c.a2(t.overscaledZ,k,a.z,T,a.y-1).key]={backfilled:!1}),a.y+1<h&&(z[new c.a2(t.overscaledZ,b,a.z,p,a.y+1).key]={backfilled:!1},z[new c.a2(t.overscaledZ,t.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},z[new c.a2(t.overscaledZ,k,a.z,T,a.y+1).key]={backfilled:!1}),z}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&(yield t.actor.sendAsync({type:"RDT",data:{type:this.type,uid:t.uid,source:this.id}}))}))}}function Nr(v){return v.type==="GeometryCollection"?v.geometries.map((t=>t.coordinates)).flat(1/0):v.coordinates.flat(1/0)}function wl(v){const t=new Ri;let a;switch(v.type){case"FeatureCollection":a=v.features.map((h=>Nr(h.geometry))).flat(1/0);break;case"Feature":a=Nr(v.geometry);break;default:a=Nr(v)}if(a.length==0)return t;for(let h=0;h<a.length-1;h+=2)t.extend([a[h],a[h+1]]);return t}class dn extends c.E{constructor(t,a,h,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=h.getActor(),this.setEventedParent(p),this._data=typeof a.data=="string"?{url:a.data}:{geojson:a.data},this._options=c.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&c.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=c.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:c.a5,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:c.a5,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(t){return t*(c.a5/this.tileSize)}_getClusterMaxZoom(t){const a=t?Math.round(t):this.maxzoom-1;return Number.isInteger(t)||t===void 0||c.w(`Integer expected for option 'clusterMaxZoom': provided value "${t}" rounded to "${a}"`),a}load(){return c._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(t){this.map=t,this.load()}setData(t,a){this._data=typeof t=="string"?{url:t}:{geojson:t},this._pendingWorkerUpdate={data:t};const h=this._updateWorkerData();return a?h:this}updateData(t,a){this._pendingWorkerUpdate.diff=c.a6(this._pendingWorkerUpdate.diff,t);const h=this._updateWorkerData();return a?h:this}getData(){return c._(this,void 0,void 0,(function*(){const t=c.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:t})}))}getBounds(){return c._(this,void 0,void 0,(function*(){return wl(yield this.getData())}))}setClusterOptions(t){return this.workerOptions.cluster=t.cluster,t.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(t.clusterRadius)),t.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(t.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(t){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:t,source:this.id}})}getClusterChildren(t){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:t,source:this.id}})}getClusterLeaves(t,a,h){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:t,limit:a,offset:h}})}_updateWorkerData(){return c._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void c.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:t,diff:a}=this._pendingWorkerUpdate,h=c.e({type:this.type},this.workerOptions);t!==void 0?(typeof t=="string"?(h.request=this.map._requestManager.transformRequest(Be.resolveURL(t),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=t,this._pendingWorkerUpdate.data=void 0):a&&(h.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new c.l("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._isUpdatingWorker=!1,this._removed||p.abandoned)return void this.fire(new c.l("dataabort",{dataType:"source"}));a&&this._applyDiff(a);let b=null;p.resourceTiming&&p.resourceTiming[this.id]&&(b=p.resourceTiming[this.id].slice(0));const T={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&c.e(T,{resourceTiming:b}),this.fire(new c.l("data",Object.assign(Object.assign({},T),{sourceDataType:"metadata"}))),this.fire(new c.l("data",Object.assign(Object.assign({},T),{sourceDataType:"content",shouldReloadTileOptions:this._getShouldReloadTileOptions(a)})))}catch(p){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new c.l("dataabort",{dataType:"source"}));this.fire(new c.k(p))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}_applyDiff(t){const a=typeof this.promoteId=="string"?this.promoteId:void 0;if(!this._data.url&&!this._data.updateable){if(!c.a7(this._data.geojson,a))throw new Error(`GeoJSONSource "${this.id}": GeoJSON data is not compatible with updateData`);this._data={updateable:c.a8(this._data.geojson,a)}}this._data.updateable&&c.a9(this._data.updateable,t,a)}_getShouldReloadTileOptions(t){if(this._options.cluster||!t||t.removeAll)return;const{add:a=[],update:h=[],remove:p=[]}=t||{},b=new Set([...h.map((T=>T.id)),...p]);for(const T of b.values())if(typeof T!="number"&&this.promoteId==null)return void c.w(`GeoJSONSource "${this.id}": updateData is slower when using string GeoJSON feature IDs. Consider using promoteId or numeric IDs for better performance.`);return{nextBounds:[...h.map((T=>T.newGeometry)),...a.map((T=>T.geometry))].filter(Boolean).map((T=>wl(T))),prevIds:b}}shouldReloadTile(t,{nextBounds:a,prevIds:h}){if(!t.latestFeatureIndex)return t.state!=="unloaded";const p=t.latestFeatureIndex.loadVTLayers();for(let z=0;z<t.latestFeatureIndex.featureIndexArray.length;z++){const F=t.latestFeatureIndex.featureIndexArray.get(z),V=p[c.aa].feature(F.featureIndex),H=t.latestFeatureIndex.getId(V,c.aa);if(h.has(H))return!0}const{buffer:b,extent:T}=this.workerOptions.geojsonVtOptions,k=(function({x:z,y:F,z:V},H=0){const Y=c.a3((z-H)/Math.pow(2,V)),J=c.a4((F+1+H)/Math.pow(2,V)),ae=c.a3((z+1+H)/Math.pow(2,V)),ge=c.a4((F-H)/Math.pow(2,V));return new Ri([Y,J],[ae,ge])})(t.tileID.canonical,b/T);for(const z of a)if(k.intersects(z))return!0;return!1}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(t){return c._(this,void 0,void 0,(function*(){const a=t.actor?"RT":"LT";t.actor=this.actor;const h={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};t.abortController=new AbortController;const p=yield this.actor.sendAsync({type:a,data:h},t.abortController);delete t.abortController,t.unloadVectorData(),t.aborted||t.loadVectorData(p,this.map.painter,a==="RT")}))}abortTile(t){return c._(this,void 0,void 0,(function*(){t.abortController&&(t.abortController.abort(),delete t.abortController),t.aborted=!0}))}unloadTile(t){return c._(this,void 0,void 0,(function*(){t.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:t.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data.updateable?{type:"FeatureCollection",features:Array.from(this._data.updateable.values())}:this._data.url||this._data.geojson})}hasTransition(){return!1}}class Sr extends c.E{constructor(t,a,h,p){super(),this.flippedWindingOrder=!1,this.id=t,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=a}load(t){return c._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new c.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield wt.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,t&&(this.coordinates=t),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,c.Z(a)||this.fire(new c.k(a))}}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=t.url,this.load(t.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(t){this.coordinates=t;const a=t.map(c.ab.fromLngLat);var h;return this.tileID=(function(p){const b=c.ac.fromPoints(p),T=b.width(),k=b.height(),z=Math.max(T,k),F=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),V=Math.pow(2,F);return new c.ae(F,Math.floor((b.minX+b.maxX)/2*V),Math.floor((b.minY+b.maxY)/2*V))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((p=>this.tileID.getTilePoint(p)._round())),this.flippedWindingOrder=((h=this.tileCoords)[1].x-h[0].x)*(h[2].y-h[0].y)-(h[1].y-h[0].y)*(h[2].x-h[0].x)<0,this.fire(new c.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,a=t.gl;this.texture||(this.texture=new c.T(t,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const b=this.tiles[p];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,h=!0)}h&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(t){return c._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={}):t.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(t){const{minX:a,minY:h,maxX:p,maxY:b}=c.ac.fromPoints(t),T={};for(let k=0;k<=c.ad;k++){const z=Math.pow(2,k),F=Math.floor(a*z),V=Math.floor(h*z),H=Math.floor(p*z),Y=Math.floor(b*z);T[k]={minTileX:F,minTileY:V,maxTileX:H,maxTileY:Y}}return T}}class nt extends Sr{constructor(t,a,h,p){super(t,a,h,p),this.roundZoom=!0,this.type="video",this.options=a}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!1;const t=this.options;this.urls=[];for(const a of t.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield c.af(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new c.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const a=this.video.seekable;t<a.start(0)||t>a.end(0)?this.fire(new c.k(new c.ag(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,a=t.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(t,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let h=!1;for(const p in this.tiles){const b=this.tiles[p];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,h=!0)}h&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class re extends Sr{constructor(t,a,h,p){super(t,a,h,p),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((b=>!Array.isArray(b)||b.length!==2||b.some((T=>typeof T!="number"))))||this.fire(new c.k(new c.ag(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.k(new c.ag(`sources.${t}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new c.k(new c.ag(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new c.k(new c.ag(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.k(new c.ag(`sources.${t}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return c._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,h=a.gl;this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):(this.texture=new c.T(a,this.canvas,h.RGBA,{premultiply:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const b in this.tiles){const T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture,p=!0)}p&&this.fire(new c.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",animate:this.animate,canvas:this.options.canvas,coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const te={},he=v=>{switch(v){case"geojson":return dn;case"image":return Sr;case"raster":return qs;case"raster-dem":return os;case"vector":return Yt;case"video":return nt;case"canvas":return re}return te[v]},Se="RTLPluginLoaded";class Ee extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=rn()}_syncState(t){return this.status=t,this.dispatcher.broadcast("SRPS",{pluginStatus:t,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(t){return c._(this,arguments,void 0,(function*(a,h=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=Be.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!h)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return c._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.l(Se))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let lt=null;function Je(){return lt||(lt=new Ee),lt}var qe,Ze;(function(v){v[v.Base=0]="Base",v[v.Parent=1]="Parent"})(qe||(qe={})),(function(v){v[v.Departing=0]="Departing",v[v.Incoming=1]="Incoming"})(Ze||(Ze={}));class St{constructor(t,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=t,this.uid=c.ah(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(t){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(t||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:t,fadingDirection:a,fadingParentID:h,fadeEndTime:p}){this.resetFadeLogic(),this.fadingRole=t,this.fadingDirection=a,this.fadingParentID=h,this.fadeEndTime=p}setSelfFadeLogic(t){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=t}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=dt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(t,a,h){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData,this.latestFeatureIndex.encoding=t.encoding):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData,this.latestFeatureIndex.encoding=this.latestEncoding)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=(function(p,b){const T={};if(!b)return T;for(const k of p){const z=k.layerIds.map((F=>b.getLayer(F))).filter(Boolean);if(z.length!==0){k.layers=z,k.stateDependentLayerIds&&(k.stateDependentLayers=k.stateDependentLayerIds.map((F=>z.filter((V=>V.id===F))[0])));for(const F of z)T[F.id]=k}}return T})(t.buckets,a?.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const b=this.buckets[p];if(b instanceof c.aj){if(this.hasSymbolBuckets=!0,!h)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const b=this.buckets[p];if(b instanceof c.aj&&b.hasRTLText){this.hasRTLText=!0,Je().lazyLoad();break}}this.queryPadding=0;for(const p in this.buckets){const b=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(p).queryRadius(b))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),this.dashPositions=t.dashPositions}else this.collisionBoxArray=new c.ai}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(t)}const a=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new c.T(t,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(t,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,a,h,p,b,T,k,z,F,V,H){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:b,scale:T,tileSize:this.tileSize,pixelPosMatrix:V,transform:z,params:k,queryPadding:this.queryPadding*F,getElevation:H},t,a,h):{}}querySourceFeatures(t,a){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),b=a&&a.sourceLayer?a.sourceLayer:"",T=p[c.aa]||p[b];if(!T)return;const k=c.ak(a?.filter,a?.globalState),{z,x:F,y:V}=this.tileID.canonical,H={z,x:F,y:V};for(let Y=0;Y<T.length;Y++){const J=T.feature(Y);if(k.needGeometry){const ve=c.al(J,!0);if(!k.filter(new c.H(this.tileID.overscaledZ),ve,this.tileID.canonical))continue}else if(!k.filter(new c.H(this.tileID.overscaledZ),J))continue;const ae=h.getId(J,b),ge=new c.am(J,z,F,V,ae);ge.tile=H,t.push(ge)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const h=c.an(t.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(a)if(this.expirationTime<a)p=!0;else{const b=this.expirationTime-a;b?this.expirationTime=h+Math.max(b,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const h=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!a.style.hasLayer(p))continue;const b=this.buckets[p],T=b.layers[0].sourceLayer||c.aa,k=h[T],z=t[T];if(!k||!z||Object.keys(z).length===0)continue;b.update(z,k,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const F=a&&a.style&&a.style.getLayer(p);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(b)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<dt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(t){this.symbolFadeHoldUntil=dt()+t}setDependencies(t,a){const h={};for(const p of a)h[p]=!0;this.dependencies[t]=h}hasDependency(t,a){for(const h of t){const p=this.dependencies[h];if(p){for(const b of a)if(p[b])return!0}}return!1}}class Mt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,h){const p=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},c.e(this.stateChanges[t][p],h),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==p&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const b in this.state[t][p])h[b]||(this.deletedStates[t][p][b]=null)}else for(const b in h)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][b]===null&&delete this.deletedStates[t][p][b]}removeFeatureState(t,a,h){if(this.deletedStates[t]===null)return;const p=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},h&&a!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][h]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(h in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][h]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,a){const h=String(a),p=c.e({},(this.state[t]||{})[h],(this.stateChanges[t]||{})[h]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const b=this.deletedStates[t][a];if(b===null)return{};for(const T in b)delete p[T]}return p}initializeTileState(t,a){t.setFeatureState(this.state,a)}coalesceChanges(t,a){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const b={};for(const T in this.stateChanges[p])this.state[p][T]||(this.state[p][T]={}),c.e(this.state[p][T],this.stateChanges[p][T]),b[T]=this.state[p][T];h[p]=b}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const b={};if(this.deletedStates[p]===null)for(const T in this.state[p])b[T]={},this.state[p][T]={};else for(const T in this.deletedStates[p]){if(this.deletedStates[p][T]===null)this.state[p][T]={};else for(const k of Object.keys(this.deletedStates[p][T]))delete this.state[p][T][k];b[T]=this.state[p][T]}h[p]=h[p]||{},c.e(h[p],b)}this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0&&t.setFeatureState(h,a)}}const Wt=89.25;function Qt(v,t){const a=c.ao(t.lat,-c.ap,c.ap);return new c.P(c.Y(t.lng)*v,c.X(a)*v)}function yn(v,t){return new c.ab(t.x/v,t.y/v).toLngLat()}function zn(v){return v.cameraToCenterDistance*Math.min(.85*Math.tan(c.aq(90-v.pitch)),Math.tan(c.aq(Wt-v.pitch)))}function Un(v,t){const a=v.canonical,h=t/c.ar(a.z),p=a.x+Math.pow(2,a.z)*v.wrap,b=c.as(new Float64Array(16));return c.O(b,b,[p*h,a.y*h,0]),c.Q(b,b,[h/c.a5,h/c.a5,1]),b}function it(v,t,a,h,p){const b=c.ab.fromLngLat(v,t),T=p*c.at(1,v.lat),{x:k,y:z,z:F}=ii(a,h);return new c.ab(b.x+T*-k,b.y+T*-z,b.z+T*-F)}function ii(v,t){const a=c.aq(v),h=c.aq(t),p=Math.cos(-a),b=Math.sin(a);return{x:b*Math.sin(h),y:-b*Math.cos(h),z:p}}function Hi(v,t,a){const h=t.intersectsFrustum(v);if(!a||h===0)return h;const p=t.intersectsPlane(a);return p===0?0:h===2&&p===2?2:1}function xn(v,t,a){let h=0;const p=(a-t)/10;for(let b=0;b<10;b++)h+=p*Math.pow(Math.cos(t+(b+.5)/10*(a-t)),v);return h}function Nt(v,t){return function(a,h,p,b,T){const k=2*((v-1)/c.au(Math.cos(c.aq(Wt-T))/Math.cos(c.aq(Wt)))-1),z=Math.acos(p/b),F=2*xn(k-1,0,c.aq(T/2)),V=Math.min(c.aq(Wt),z+c.aq(T/2)),H=xn(k-1,Math.min(V,z-c.aq(T/2)),V),Y=Math.atan(h/p),J=Math.hypot(h,p);let ae=a;return ae+=c.au(b/J/Math.max(.5,Math.cos(c.aq(T/2)))),ae+=k*c.au(Math.cos(Y))/2,ae-=c.au(Math.max(1,H/F/t))/2,ae}}const Xi=Nt(9.314,3);function Kn(v,t){const a=(t.roundZoom?Math.round:Math.floor)(v.zoom+c.au(v.tileSize/t.tileSize));return Math.max(0,a)}function ki(v,t){const a=v.getCameraFrustum(),h=v.getClippingPlane(),p=v.screenPointToMercatorCoordinate(v.getCameraPoint()),b=c.ab.fromLngLat(v.center,v.elevation);p.z=b.z+Math.cos(v.pitchInRadians)*v.cameraToCenterDistance/v.worldSize;const T=v.getCoveringTilesDetailsProvider(),k=T.allowVariableZoom(v,t),z=Kn(v,t),F=t.minzoom||0,V=t.maxzoom!==void 0?t.maxzoom:v.maxZoom,H=Math.min(Math.max(0,z),V),Y=Math.pow(2,H),J=[Y*p.x,Y*p.y,0],ae=[Y*b.x,Y*b.y,0],ge=Math.hypot(b.x-p.x,b.y-p.y),ve=Math.abs(b.z-p.z),ye=Math.hypot(ge,ve),be=Oe=>({zoom:0,x:0,y:0,wrap:Oe,fullyVisible:!1}),De=[],we=[];if(v.renderWorldCopies&&T.allowWorldCopies())for(let Oe=1;Oe<=3;Oe++)De.push(be(-Oe)),De.push(be(Oe));for(De.push(be(0));De.length>0;){const Oe=De.pop(),je=Oe.x,Ae=Oe.y;let $e=Oe.fullyVisible;const ht={x:je,y:Ae,z:Oe.zoom},st=T.getTileBoundingVolume(ht,Oe.wrap,v.elevation,t);if(!$e){const qt=Hi(a,st,h);if(qt===0)continue;$e=qt===2}const ft=T.distanceToTile2d(p.x,p.y,ht,st);let pt=z;k&&(pt=(t.calculateTileZoom||Xi)(v.zoom+c.au(v.tileSize/t.tileSize),ft,ve,ye,v.fov)),pt=(t.roundZoom?Math.round:Math.floor)(pt),pt=Math.max(0,pt);const Dt=Math.min(pt,V);if(Oe.wrap=T.getWrap(b,ht,Oe.wrap),Oe.zoom>=Dt){if(Oe.zoom<F)continue;const qt=H-Oe.zoom,Pt=J[0]-.5-(je<<qt),an=J[1]-.5-(Ae<<qt),Cn=t.reparseOverscaled?Math.max(Oe.zoom,pt):Oe.zoom;we.push({tileID:new c.a2(Oe.zoom===V?Cn:Oe.zoom,Oe.wrap,Oe.zoom,je,Ae),distanceSq:c.av([ae[0]-.5-je,ae[1]-.5-Ae]),tileDistanceToCamera:Math.sqrt(Pt*Pt+an*an)})}else for(let qt=0;qt<4;qt++)De.push({zoom:Oe.zoom+1,x:(je<<1)+qt%2,y:(Ae<<1)+(qt>>1),wrap:Oe.wrap,fullyVisible:$e})}return we.sort(((Oe,je)=>Oe.distanceSq-je.distanceSq)).map((Oe=>Oe.tileID))}const si=c.ac.fromPoints([new c.P(0,0),new c.P(c.a5,c.a5)]);function ji(v){return v==="raster"||v==="image"||v==="video"}function qo(v,t,a,h,p,b,T){if(!t.hasData())return!1;const{tileID:k,fadingRole:z,fadingDirection:F,fadingParentID:V}=t;if(z===qe.Base&&F===Ze.Incoming&&V)return a[V.key]=V,!0;const H=Math.max(k.overscaledZ-p,b);for(let Y=k.overscaledZ-1;Y>=H;Y--){const J=k.scaledTo(Y),ae=v.getLoadedTile(J);if(ae)return t.setCrossFadeLogic({fadingRole:qe.Base,fadingDirection:Ze.Incoming,fadingParentID:ae.tileID,fadeEndTime:h+T}),ae.setCrossFadeLogic({fadingRole:qe.Parent,fadingDirection:Ze.Departing,fadeEndTime:h+T}),a[J.key]=J,!0}return!1}function Aa(v,t,a,h,p,b){if(!t.hasData())return!1;const T=t.tileID.children(p);let k=Gt(v,t,T,a,h,p,b);if(k)return!0;for(const z of T)Gt(v,t,z.children(p),a,h,p,b)&&(k=!0);return k}function Gt(v,t,a,h,p,b,T){if(a[0].overscaledZ>=b)return!1;let k=!1;for(const z of a){const F=v.getLoadedTile(z);if(!F)continue;const{fadingRole:V,fadingDirection:H,fadingParentID:Y}=F;V===qe.Base&&H===Ze.Departing&&Y||(F.setCrossFadeLogic({fadingRole:qe.Base,fadingDirection:Ze.Departing,fadingParentID:t.tileID,fadeEndTime:p+T}),t.setCrossFadeLogic({fadingRole:qe.Parent,fadingDirection:Ze.Incoming,fadeEndTime:p+T})),h[z.key]=z,k=!0}return k}function _r(v,t,a,h){const p=v.tileID;return!!v.selfFading||!v.hasData()&&!!t.has(p)&&(v.setSelfFadeLogic(a+h),!0)}function Xr(v,t){var a;v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let h=t.tileID.canonical.x-v.tileID.canonical.x;const p=t.tileID.canonical.y-v.tileID.canonical.y,b=Math.pow(2,v.tileID.canonical.z),T=t.tileID.key;h===0&&p===0||Math.abs(p)>1||(Math.abs(h)>1&&(Math.abs(h+b)===1?h+=b:Math.abs(h-b)===1&&(h-=b)),t.dem&&v.dem&&(v.dem.backfillBorder(t.dem,h,p),!((a=v.neighboringTiles)===null||a===void 0)&&a[T]&&(v.neighboringTiles[T].backfilled=!0)))}class Va{constructor(){this._tiles={}}handleWrapJump(t){const a={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+t),a[p.tileID.key]=p}this._tiles=a}setFeatureState(t,a){for(const h in this._tiles)this._tiles[h].setFeatureState(t,a)}getAllTiles(){return Object.values(this._tiles)}getAllIds(t=!1){return t?Object.values(this._tiles).map((a=>a.tileID)).sort(c.ax).map((a=>a.key)):Object.keys(this._tiles)}getTileById(t){return this._tiles[t]}setTile(t,a){this._tiles[t]=a}deleteTileById(t){delete this._tiles[t]}getLoadedTile(t){const a=this.getTileById(t.key);return a?.hasData()?a:null}isIdRenderable(t,a=!1){var h;return(h=this.getTileById(t))===null||h===void 0?void 0:h.isRenderable(a)}getRenderableIds(t=0,a){const h=[];for(const p of this.getAllIds())this.isIdRenderable(p,a)&&h.push(this.getTileById(p));return a?h.sort(((p,b)=>{const T=p.tileID,k=b.tileID,z=new c.P(T.canonical.x,T.canonical.y)._rotate(-t),F=new c.P(k.canonical.x,k.canonical.y)._rotate(-t);return T.overscaledZ-k.overscaledZ||F.y-z.y||F.x-z.x})).map((p=>p.tileID.key)):h.map((p=>p.tileID)).sort(c.ax).map((p=>p.key))}}class di extends c.E{constructor(t,a,h){super(),this.id=t,this.dispatcher=h,this.on("data",(p=>this._dataHandler(p))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((p,b,T,k)=>{const z=new(he(b.type))(p,b,T,k);if(z.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${z.id}`);return z})(t,a,h,this),this._inViewTiles=new Va,this._outOfViewCache=new c.ay(0,(p=>this._unloadTile(p))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new Mt,this._didEmitContent=!1,this._updated=!1}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._maxTileCacheZoomLevels=t?t._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){for(const a of this._inViewTiles.getAllTiles())a.unloadVectorData();this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t),this._inViewTiles=new Va}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}getSource(){return this._source}getState(){return this._state}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,a,h){return c._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(t),this._tileLoaded(t,a,h)}catch(p){t.state="errored",p.status!==404?this._source.fire(new c.k(p,{tile:t})):this.update(this.transform,this.terrain)}}))}_unloadTile(t){this._source.unloadTile&&this._source.unloadTile(t)}_abortTile(t){this._source.abortTile&&this._source.abortTile(t),this._source.fire(new c.l("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._inViewTiles,this.map?this.map.painter:null);for(const a of this._inViewTiles.getAllTiles())a.upload(t),a.prepare(this.map.style.imageManager)}getIds(){return this._inViewTiles.getAllIds(!0)}getRenderableIds(t){var a;return this._inViewTiles.getRenderableIds((a=this.transform)===null||a===void 0?void 0:a.bearingInRadians,t)}hasRenderableParent(t){const a=t.overscaledZ-1;if(a>=this._source.minzoom){const h=this.getLoadedTile(t.scaledTo(a));if(h)return this._inViewTiles.isIdRenderable(h.tileID.key)}return!1}reload(t,a=void 0){if(this._paused)this._shouldReloadOnResume=!0;else{this._outOfViewCache.reset();for(const h of this._inViewTiles.getAllIds()){const p=this._inViewTiles.getTileById(h);a&&!this._source.shouldReloadTile(p,a)||(t?this._reloadTile(h,"expired"):p.state!=="errored"&&this._reloadTile(h,"reloading"))}}}_reloadTile(t,a){return c._(this,void 0,void 0,(function*(){const h=this._inViewTiles.getTileById(t);h&&(h.state!=="loading"&&(h.state=a),yield this._loadTile(h,t,a))}))}_tileLoaded(t,a,h){t.timeAdded=dt(),t.selfFading&&(t.fadeEndTime=t.timeAdded+this._rasterFadeDuration),h==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this.getSource().type==="raster-dem"&&t.dem&&(function(p,b){var T,k;const z=b.getRenderableIds();for(const F of z){if(!p.neighboringTiles||!p.neighboringTiles[F])continue;const V=b.getTileById(F);p.neighboringTiles[F].backfilled||Xr(p,V),!((k=(T=V.neighboringTiles)===null||T===void 0?void 0:T[p.tileID.key])===null||k===void 0)&&k.backfilled||Xr(V,p)}})(t,this._inViewTiles),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new c.l("data",{dataType:"source",tile:t,coord:t.tileID}))}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._inViewTiles.getTileById(t)}_retainLoadedChildren(t,a){const h=this._getLoadedDescendents(a),p=new Set;for(const b of a){const T=h[b.key];if(!T?.length){p.add(b);continue}const k=b.overscaledZ+di.maxOverzooming,z=T.filter((H=>H.tileID.overscaledZ<=k));if(!z.length){p.add(b);continue}const F=Math.min(...z.map((H=>H.tileID.overscaledZ))),V=z.filter((H=>H.tileID.overscaledZ===F)).map((H=>H.tileID));for(const H of V)t[H.key]=H;this._areDescendentsComplete(V,F,b.overscaledZ)||p.add(b)}return p}_getLoadedDescendents(t){var a;const h={};for(const p of this._inViewTiles.getAllTiles().filter((b=>b.hasData())))for(const b of t)p.tileID.isChildOf(b)&&(h[a=b.key]||(h[a]=[])).push(p);return h}_areDescendentsComplete(t,a,h){return t.length===1&&t[0].isOverscaled()?t[0].overscaledZ===a:Math.pow(4,a-h)===t.length}getLoadedTile(t){return this._inViewTiles.getLoadedTile(t)}updateCacheSize(t){const a=Math.ceil(t.width/this._source.tileSize)+1,h=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(a*h*(this._maxTileCacheZoomLevels===null?c.c.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._outOfViewCache.setMaxSize(b)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);this._prevLng=t,a&&(this._inViewTiles.handleWrapJump(a),this._resetTileReloadTimers())}update(t,a){if(!this._sourceLoaded||this._paused)return;let h;this.transform=t,this.terrain=a,this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((z=>new c.a2(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y))):(h=ki(t,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.type==="vector"&&this.map._zoomLevelsToOverscale!==void 0?t.maxZoom-this.map._zoomLevelsToOverscale:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(h=h.filter((z=>this._source.hasTile(z))))):h=[],this.usedForTerrain&&(h=this._addTerrainIdealTiles(h));const p=h.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,p&&this.fire(new c.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=Kn(t,this._source),T=this._updateRetainedTiles(h,b),k=ji(this._source.type);k&&this._rasterFadeDuration>0&&!a&&(function(z,F,V,H,Y,J,ae){const ge=dt(),ve=c.aw(F);for(const ye of F){const be=z.getTileById(ye.key);be.fadingDirection!==Ze.Departing&&be.fadeOpacity!==0||be.resetFadeLogic(),qo(z,be,V,ge,H,Y,ae)||Aa(z,be,V,ge,J,ae)||_r(be,ve,ge,ae)||be.resetFadeLogic()}})(this._inViewTiles,h,T,this._maxFadingAncestorLevels,this._source.minzoom,this._source.maxzoom,this._rasterFadeDuration),k?this._cleanUpRasterTiles(T):this._cleanUpVectorTiles(T)}_cleanUpRasterTiles(t){for(const a of this._inViewTiles.getAllIds())t[a]||this._removeTile(a)}_cleanUpVectorTiles(t){for(const a of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(a);t[a]?h.clearSymbolFadeHold():h.hasSymbolBuckets?h.holdingForSymbolFade()?h.symbolFadeFinished()&&this._removeTile(a):h.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(t){const a=[];for(const h of t)if(h.canonical.z>this._source.minzoom){const p=h.scaledTo(h.canonical.z-1);a.push(p);const b=h.scaledTo(Math.max(this._source.minzoom,Math.min(h.canonical.z,5)));a.push(b)}return t.concat(a)}releaseSymbolFadeTiles(){for(const t of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(t).holdingForSymbolFade()&&this._removeTile(t)}_updateRetainedTiles(t,a){var h;const p=new Set;for(const F of t)this._addTile(F).hasData()||p.add(F);const b=t.reduce(((F,V)=>(F[V.key]=V,F)),{}),T=this._retainLoadedChildren(b,p),k={},z=Math.max(a-di.maxUnderzooming,this._source.minzoom);for(const F of T){let V=this._inViewTiles.getTileById(F.key),H=V?.wasRequested();for(let Y=F.overscaledZ-1;Y>=z;--Y){const J=F.scaledTo(Y);if(k[J.key])break;if(k[J.key]=!0,V=this.getTile(J),!V&&H&&(V=this._addTile(J)),V){const ae=V.hasData();if((ae||!(!((h=this.map)===null||h===void 0)&&h.cancelPendingTileRequestsWhileZooming)||H)&&(b[J.key]=J),H=V.wasRequested(),ae)break}}}return b}_addTile(t){let a=this._inViewTiles.getTileById(t.key);if(a)return a;a=this._outOfViewCache.getAndRemove(t),a&&(a.resetFadeLogic(),this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null));const h=a;return a||(a=new St(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(a,t.key,a.state)),a.uses++,this._inViewTiles.setTile(t.key,a),h||this._source.fire(new c.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){this._clearTileReloadTimer(t);const h=a.getExpiryTimeout();h&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),h))}_clearTileReloadTimer(t){const a=this._timers[t];a&&(clearTimeout(a),delete this._timers[t])}_resetTileReloadTimers(){for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t of this._inViewTiles.getAllIds()){const a=this._inViewTiles.getTileById(t);this._setTileReloadTimer(t,a)}}refreshTiles(t){for(const a of this._inViewTiles.getAllIds()){const h=this._inViewTiles.getTileById(a);(this._inViewTiles.isIdRenderable(a)||h.state=="errored")&&t.some((p=>p.equals(h.tileID.canonical)))&&this._reloadTile(a,"expired")}}_removeTile(t){const a=this._inViewTiles.getTileById(t);a&&(a.uses--,this._inViewTiles.deleteTileById(t),this._clearTileReloadTimer(t),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._outOfViewCache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(t){t.dataType==="source"&&(t.sourceDataType!=="metadata"?t.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(t.sourceDataChanged,t.shouldReloadTileOptions),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t of this._inViewTiles.getAllIds())this._removeTile(t);this._outOfViewCache.reset()}tilesIn(t,a,h){const p=[],b=this.transform;if(!b)return p;const T=b.getCoveringTilesDetailsProvider().allowWorldCopies(),k=h?b.getCameraQueryGeometry(t):t,z=J=>b.screenPointToMercatorCoordinate(J,this.terrain),F=this.transformBbox(t,z,!T),V=this.transformBbox(k,z,!T),H=this.getIds(),Y=c.ac.fromPoints(V);for(let J=0;J<H.length;J++){const ae=this._inViewTiles.getTileById(H[J]);if(ae.holdingForSymbolFade())continue;const ge=T?[ae.tileID]:[ae.tileID.unwrapTo(-1),ae.tileID.unwrapTo(0)],ve=Math.pow(2,b.zoom-ae.tileID.overscaledZ),ye=a*ae.queryPadding*c.a5/ae.tileSize/ve;for(const be of ge){const De=Y.map((we=>be.getTilePoint(new c.ab(we.x,we.y))));if(De.expandBy(ye),De.intersects(si)){const we=F.map((je=>be.getTilePoint(je))),Oe=V.map((je=>be.getTilePoint(je)));p.push({tile:ae,tileID:T?be:be.unwrapTo(0),queryGeometry:we,cameraQueryGeometry:Oe,scale:ve})}}}return p}transformBbox(t,a,h){let p=t.map(a);if(h){const b=c.ac.fromPoints(t);b.shrinkBy(.001*Math.min(b.width(),b.height()));const T=b.map(a);c.ac.fromPoints(p).covers(T)||(p=p.map((k=>k.x>.5?new c.ab(k.x-1,k.y,k.z):k)))}return p}getVisibleCoordinates(t){const a=this.getRenderableIds(t).map((h=>this._inViewTiles.getTileById(h).tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){return!!this._source.hasTransition()||!(!ji(this._source.type)||!(function(t,a){if(a<=0)return!1;const h=dt();for(const p of t.getAllTiles())if(p.fadeEndTime>=h)return!0;return!1})(this._inViewTiles,this._rasterFadeDuration))}setRasterFadeDuration(t){this._rasterFadeDuration=t}setFeatureState(t,a,h){this._state.updateState(t=t||c.aa,a,h)}removeFeatureState(t,a,h){this._state.removeFeatureState(t=t||c.aa,a,h)}getFeatureState(t,a){return this._state.getState(t=t||c.aa,a)}setDependencies(t,a,h){const p=this._inViewTiles.getTileById(t);p&&p.setDependencies(a,h)}reloadTilesForDependencies(t,a){for(const h of this._inViewTiles.getAllIds())this._inViewTiles.getTileById(h).hasDependency(t,a)&&this._reloadTile(h,"reloading");this._outOfViewCache.filter((h=>!h.hasDependency(t,a)))}areTilesLoaded(){for(const t of this._inViewTiles.getAllTiles())if(t.state!=="loaded"&&t.state!=="errored")return!1;return!0}}di.maxUnderzooming=10,di.maxOverzooming=3;class Ut{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=c.ao(t,0,1);let a=1,h=this._distances[a];const p=t*this.paddedLength+this.padding;for(;h<p&&a<this._distances.length;)h=this._distances[++a];const b=a-1,T=this._distances[b],k=h-T,z=k>0?(p-T)/k:0;return this.points[b].mult(1-z).add(this.points[a].mult(z))}}function Sn(v,t){let a=!0;return v==="always"||v!=="never"&&t!=="never"||(a=!1),a}class Mn{constructor(t,a,h){const p=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/h),this.yCellCount=Math.ceil(a/h);for(let T=0;T<this.xCellCount*this.yCellCount;T++)p.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,h,p,b){this._forEachCell(a,h,p,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(b)}insertCircle(t,a,h,p){this._forEachCell(a-p,h-p,a+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(h),this.circles.push(p)}_insertBoxCell(t,a,h,p,b,T){this.boxCells[b].push(T)}_insertCircleCell(t,a,h,p,b,T){this.circleCells[b].push(T)}_query(t,a,h,p,b,T,k){if(h<0||t>this.width||p<0||a>this.height)return[];const z=[];if(t<=0&&a<=0&&this.width<=h&&this.height<=p){if(b)return[{key:null,x1:t,y1:a,x2:h,y2:p}];for(let F=0;F<this.boxKeys.length;F++)z.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const V=this.circles[3*F],H=this.circles[3*F+1],Y=this.circles[3*F+2];z.push({key:this.circleKeys[F],x1:V-Y,y1:H-Y,x2:V+Y,y2:H+Y})}}else this._forEachCell(t,a,h,p,this._queryCell,z,{hitTest:b,overlapMode:T,seenUids:{box:{},circle:{}}},k);return z}query(t,a,h,p){return this._query(t,a,h,p,!1,null)}hitTest(t,a,h,p,b,T){return this._query(t,a,h,p,!0,b,T).length>0}hitTestCircle(t,a,h,p,b){const T=t-h,k=t+h,z=a-h,F=a+h;if(k<0||T>this.width||F<0||z>this.height)return!1;const V=[];return this._forEachCell(T,z,k,F,this._queryCellCircle,V,{hitTest:!0,overlapMode:p,circle:{x:t,y:a,radius:h},seenUids:{box:{},circle:{}}},b),V.length>0}_queryCell(t,a,h,p,b,T,k,z){const{seenUids:F,hitTest:V,overlapMode:H}=k,Y=this.boxCells[b];if(Y!==null){const ae=this.bboxes;for(const ge of Y)if(!F.box[ge]){F.box[ge]=!0;const ve=4*ge,ye=this.boxKeys[ge];if(t<=ae[ve+2]&&a<=ae[ve+3]&&h>=ae[ve+0]&&p>=ae[ve+1]&&(!z||z(ye))&&(!V||!Sn(H,ye.overlapMode))&&(T.push({key:ye,x1:ae[ve],y1:ae[ve+1],x2:ae[ve+2],y2:ae[ve+3]}),V))return!0}}const J=this.circleCells[b];if(J!==null){const ae=this.circles;for(const ge of J)if(!F.circle[ge]){F.circle[ge]=!0;const ve=3*ge,ye=this.circleKeys[ge];if(this._circleAndRectCollide(ae[ve],ae[ve+1],ae[ve+2],t,a,h,p)&&(!z||z(ye))&&(!V||!Sn(H,ye.overlapMode))){const be=ae[ve],De=ae[ve+1],we=ae[ve+2];if(T.push({key:ye,x1:be-we,y1:De-we,x2:be+we,y2:De+we}),V)return!0}}}return!1}_queryCellCircle(t,a,h,p,b,T,k,z){const{circle:F,seenUids:V,overlapMode:H}=k,Y=this.boxCells[b];if(Y!==null){const ae=this.bboxes;for(const ge of Y)if(!V.box[ge]){V.box[ge]=!0;const ve=4*ge,ye=this.boxKeys[ge];if(this._circleAndRectCollide(F.x,F.y,F.radius,ae[ve+0],ae[ve+1],ae[ve+2],ae[ve+3])&&(!z||z(ye))&&!Sn(H,ye.overlapMode))return T.push(!0),!0}}const J=this.circleCells[b];if(J!==null){const ae=this.circles;for(const ge of J)if(!V.circle[ge]){V.circle[ge]=!0;const ve=3*ge,ye=this.circleKeys[ge];if(this._circlesCollide(ae[ve],ae[ve+1],ae[ve+2],F.x,F.y,F.radius)&&(!z||z(ye))&&!Sn(H,ye.overlapMode))return T.push(!0),!0}}}_forEachCell(t,a,h,p,b,T,k,z){const F=this._convertToXCellCoord(t),V=this._convertToYCellCoord(a),H=this._convertToXCellCoord(h),Y=this._convertToYCellCoord(p);for(let J=F;J<=H;J++)for(let ae=V;ae<=Y;ae++)if(b.call(this,t,a,h,p,this.xCellCount*ae+J,T,k,z))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,h,p,b,T){const k=p-t,z=b-a,F=h+T;return F*F>k*k+z*z}_circleAndRectCollide(t,a,h,p,b,T,k){const z=(T-p)/2,F=Math.abs(t-(p+z));if(F>z+h)return!1;const V=(k-b)/2,H=Math.abs(a-(b+V));if(H>V+h)return!1;if(F<=z||H<=V)return!0;const Y=F-z,J=H-V;return Y*Y+J*J<=h*h}}function yr(v,t,a){const h=c.N();if(!v){const{vecSouth:H,vecEast:Y}=Ga(t),J=ne();J[0]=Y[0],J[1]=Y[1],J[2]=H[0],J[3]=H[1],p=J,(V=(T=(b=J)[0])*(F=b[3])-(z=b[2])*(k=b[1]))&&(p[0]=F*(V=1/V),p[1]=-k*V,p[2]=-z*V,p[3]=T*V),h[0]=J[0],h[1]=J[1],h[4]=J[2],h[5]=J[3]}var p,b,T,k,z,F,V;return c.Q(h,h,[1/a,1/a,1]),h}function Ms(v,t,a,h){if(v){const p=c.N();if(!t){const{vecSouth:b,vecEast:T}=Ga(a);p[0]=T[0],p[1]=T[1],p[4]=b[0],p[5]=b[1]}return c.Q(p,p,[h,h,1]),p}return a.pixelsToClipSpaceMatrix}function Ga(v){const t=Math.cos(v.rollInRadians),a=Math.sin(v.rollInRadians),h=Math.cos(v.pitchInRadians),p=Math.cos(v.bearingInRadians),b=Math.sin(v.bearingInRadians),T=c.aD();T[0]=-p*h*a-b*t,T[1]=-b*h*a+p*t;const k=c.aE(T);k<1e-9?c.aF(T):c.aG(T,T,1/k);const z=c.aD();z[0]=p*h*t-b*a,z[1]=b*h*t+p*a;const F=c.aE(z);return F<1e-9?c.aF(z):c.aG(z,z,1/F),{vecEast:z,vecSouth:T}}function wn(v,t,a,h){let p;h?(p=[v,t,h(v,t),1],c.aI(p,p,a)):(p=[v,t,0,1],qa(p,p,a));const b=p[3];return{point:new c.P(p[0]/b,p[1]/b),signedDistanceFromCamera:b,isOccluded:!1}}function ls(v,t){return .5+v/t*.5}function pi(v,t){return v.x>=-t[0]&&v.x<=t[0]&&v.y>=-t[1]&&v.y<=t[1]}function Zs(v,t,a,h,p,b,T,k,z,F,V,H,Y){const J=a?v.textSizeData:v.iconSizeData,ae=c.az(J,t.transform.zoom),ge=[256/t.width*2+1,256/t.height*2+1],ve=a?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;ve.clear();const ye=v.lineVertexArray,be=a?v.text.placedSymbolArray:v.icon.placedSymbolArray,De=t.transform.width/t.transform.height;let we=!1;for(let Oe=0;Oe<be.length;Oe++){const je=be.get(Oe);if(je.hidden||je.writingMode===c.aA.vertical&&!we){As(je.numGlyphs,ve);continue}we=!1;const Ae=new c.P(je.anchorX,je.anchorY),$e={getElevation:Y,pitchedLabelPlaneMatrix:h,lineVertexArray:ye,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:t.transform,tileAnchorPoint:Ae,unwrappedTileID:z,width:F,height:V,translation:H},ht=$r(je.anchorX,je.anchorY,$e);if(!pi(ht.point,ge)){As(je.numGlyphs,ve);continue}const st=ls(t.transform.cameraToCenterDistance,ht.signedDistanceFromCamera),ft=c.aB(J,ae,je),pt=b?ft*t.transform.getPitchedTextCorrection(je.anchorX,je.anchorY,z)/st:ft*st,Dt=Ti({projectionContext:$e,pitchedLabelPlaneMatrixInverse:p,symbol:je,fontSize:pt,flip:!1,keepUpright:T,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:ve,aspectRatio:De,rotateToLine:k});we=Dt.useVertical,(Dt.notEnoughRoom||we||Dt.needsFlipping&&Ti({projectionContext:$e,pitchedLabelPlaneMatrixInverse:p,symbol:je,fontSize:pt,flip:!0,keepUpright:T,glyphOffsetArray:v.glyphOffsetArray,dynamicLayoutVertexArray:ve,aspectRatio:De,rotateToLine:k}).notEnoughRoom)&&As(je.numGlyphs,ve)}a?v.text.dynamicLayoutVertexBuffer.updateData(ve):v.icon.dynamicLayoutVertexBuffer.updateData(ve)}function Cs(v,t,a,h,p,b,T,k){const z=b.glyphStartIndex+b.numGlyphs,F=b.lineStartIndex,V=b.lineStartIndex+b.lineLength,H=t.getoffsetX(b.glyphStartIndex),Y=t.getoffsetX(z-1),J=Wr(v*H,a,h,p,b.segment,F,V,k,T);if(!J)return null;const ae=Wr(v*Y,a,h,p,b.segment,F,V,k,T);return ae?k.projectionCache.anyProjectionOccluded?null:{first:J,last:ae}:null}function ka(v,t,a,h){return v===c.aA.horizontal&&Math.abs(a.y-t.y)>Math.abs(a.x-t.x)*h?{useVertical:!0}:(v===c.aA.vertical?t.y<a.y:t.x>a.x)?{needsFlipping:!0}:null}function Ti(v){const{projectionContext:t,pitchedLabelPlaneMatrixInverse:a,symbol:h,fontSize:p,flip:b,keepUpright:T,glyphOffsetArray:k,dynamicLayoutVertexArray:z,aspectRatio:F,rotateToLine:V}=v,H=p/24,Y=h.lineOffsetX*H,J=h.lineOffsetY*H;let ae;if(h.numGlyphs>1){const ge=h.glyphStartIndex+h.numGlyphs,ve=h.lineStartIndex,ye=h.lineStartIndex+h.lineLength,be=Cs(H,k,Y,J,b,h,V,t);if(!be)return{notEnoughRoom:!0};const De=Ys(be.first.point.x,be.first.point.y,t,a),we=Ys(be.last.point.x,be.last.point.y,t,a);if(T&&!b){const Oe=ka(h.writingMode,De,we,F);if(Oe)return Oe}ae=[be.first];for(let Oe=h.glyphStartIndex+1;Oe<ge-1;Oe++){const je=Wr(H*k.getoffsetX(Oe),Y,J,b,h.segment,ve,ye,t,V);if(!je)return{notEnoughRoom:!0};ae.push(je)}ae.push(be.last)}else{if(T&&!b){const ve=Vn(t.tileAnchorPoint.x,t.tileAnchorPoint.y,t).point,ye=h.lineStartIndex+h.segment+1,be=new c.P(t.lineVertexArray.getx(ye),t.lineVertexArray.gety(ye)),De=Vn(be.x,be.y,t),we=De.signedDistanceFromCamera>0?De.point:ho(t.tileAnchorPoint,be,ve,1,t),Oe=Ys(ve.x,ve.y,t,a),je=Ys(we.x,we.y,t,a),Ae=ka(h.writingMode,Oe,je,F);if(Ae)return Ae}const ge=Wr(H*k.getoffsetX(h.glyphStartIndex),Y,J,b,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,t,V);if(!ge||t.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ae=[ge]}for(const ge of ae)c.aH(z,ge.point,ge.angle);return{}}function ho(v,t,a,h,p){const b=v.add(v.sub(t)._unit()),T=Vn(b.x,b.y,p).point,k=a.sub(T);return a.add(k._mult(h/k.mag()))}function Er(v,t,a){const h=t.projectionCache;if(h.projections[v])return h.projections[v];const p=new c.P(t.lineVertexArray.getx(v),t.lineVertexArray.gety(v)),b=Vn(p.x,p.y,t);if(b.signedDistanceFromCamera>0)return h.projections[v]=b.point,h.anyProjectionOccluded=h.anyProjectionOccluded||b.isOccluded,b.point;const T=v-a.direction;return ho(a.distanceFromAnchor===0?t.tileAnchorPoint:new c.P(t.lineVertexArray.getx(T),t.lineVertexArray.gety(T)),p,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,t)}function Vn(v,t,a){const h=v+a.translation[0],p=t+a.translation[1];let b;return a.pitchWithMap?(b=wn(h,p,a.pitchedLabelPlaneMatrix,a.getElevation),b.isOccluded=!1):(b=a.transform.projectTileCoordinates(h,p,a.unwrappedTileID,a.getElevation),b.point.x=(.5*b.point.x+.5)*a.width,b.point.y=(.5*-b.point.y+.5)*a.height),b}function Ys(v,t,a,h){if(a.pitchWithMap){const p=[v,t,0,1];return c.aI(p,p,h),a.transform.projectTileCoordinates(p[0]/p[3],p[1]/p[3],a.unwrappedTileID,a.getElevation).point}return{x:v/a.width*2-1,y:1-t/a.height*2}}function $r(v,t,a){return a.transform.projectTileCoordinates(v,t,a.unwrappedTileID,a.getElevation)}function us(v,t,a){return v._unit()._perp()._mult(t*a)}function Is(v,t,a,h,p,b,T,k,z){if(k.projectionCache.offsets[v])return k.projectionCache.offsets[v];const F=a.add(t);if(v+z.direction<h||v+z.direction>=p)return k.projectionCache.offsets[v]=F,F;const V=Er(v+z.direction,k,z),H=us(V.sub(a),T,z.direction),Y=a.add(H),J=V.add(H);return k.projectionCache.offsets[v]=c.aJ(b,F,Y,J)||F,k.projectionCache.offsets[v]}function Wr(v,t,a,h,p,b,T,k,z){const F=h?v-t:v+t;let V=F>0?1:-1,H=0;h&&(V*=-1,H=Math.PI),V<0&&(H+=Math.PI);let Y,J=V>0?b+p:b+p+1;k.projectionCache.cachedAnchorPoint?Y=k.projectionCache.cachedAnchorPoint:(Y=Vn(k.tileAnchorPoint.x,k.tileAnchorPoint.y,k).point,k.projectionCache.cachedAnchorPoint=Y);let ae,ge,ve=Y,ye=Y,be=0,De=0;const we=Math.abs(F),Oe=[];let je;for(;be+De<=we;){if(J+=V,J<b||J>=T)return null;be+=De,ye=ve,ge=ae;const ht={absOffsetX:we,direction:V,distanceFromAnchor:be,previousVertex:ye};if(ve=Er(J,k,ht),a===0)Oe.push(ye),je=ve.sub(ye);else{let st;const ft=ve.sub(ye);st=ft.mag()===0?us(Er(J+V,k,ht).sub(ve),a,V):us(ft,a,V),ge||(ge=ye.add(st)),ae=Is(J,st,ve,b,T,ge,a,k,ht),Oe.push(ge),je=ae.sub(ge)}De=je.mag()}const Ae=je._mult((we-be)/De)._add(ge||ye),$e=H+Math.atan2(ve.y-ye.y,ve.x-ye.x);return Oe.push(Ae),{point:Ae,angle:z?$e:0,path:Oe}}const Zo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function As(v,t){for(let a=0;a<v;a++){const h=t.length;t.resize(h+4),t.float32.set(Zo,3*h)}}function qa(v,t,a){const h=t[0],p=t[1];return v[0]=a[0]*h+a[4]*p+a[12],v[1]=a[1]*h+a[5]*p+a[13],v[3]=a[3]*h+a[7]*p+a[15],v}const $n=100;class Yu{constructor(t,a=new Mn(t.width+200,t.height+200,25),h=new Mn(t.width+200,t.height+200,25)){this.transform=t,this.grid=a,this.ignoredGrid=h,this.pitchFactor=Math.cos(t.pitch*Math.PI/180)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+$n,this.screenBottomBoundary=t.height+$n,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,a,h,p,b,T,k,z,F,V,H,Y){const J=this.projectAndGetPerspectiveRatio(t.anchorPointX+z[0],t.anchorPointY+z[1],b,V,Y),ae=h*J.perspectiveRatio;let ge;if(T||k)ge=this._projectCollisionBox(t,ae,p,b,T,k,z,J,V,H,Y);else{const je=J.x+(H?H.x*ae:0),Ae=J.y+(H?H.y*ae:0);ge={allPointsOccluded:!1,box:[je+t.x1*ae,Ae+t.y1*ae,je+t.x2*ae,Ae+t.y2*ae]}}const[ve,ye,be,De]=ge.box,we=T?ge.allPointsOccluded:J.isOccluded;let Oe=we;return Oe||(Oe=J.perspectiveRatio<this.perspectiveRatioCutoff),Oe||(Oe=!this.isInsideGrid(ve,ye,be,De)),Oe||a!=="always"&&this.grid.hitTest(ve,ye,be,De,a,F)?{box:[ve,ye,be,De],placeable:!1,offscreen:!1,occluded:we}:{box:[ve,ye,be,De],placeable:!0,offscreen:this.isOffscreen(ve,ye,be,De),occluded:we}}placeCollisionCircles(t,a,h,p,b,T,k,z,F,V,H,Y,J,ae){const ge=[],ve=new c.P(a.anchorX,a.anchorY),ye=this.getPerspectiveRatio(ve.x,ve.y,T,ae),be=(F?b*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,T)/ye:b*ye)/c.aN,De={getElevation:ae,pitchedLabelPlaneMatrix:k,lineVertexArray:h,pitchWithMap:F,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:ve,unwrappedTileID:T,width:this.transform.width,height:this.transform.height,translation:J},we=Cs(be,p,a.lineOffsetX*be,a.lineOffsetY*be,!1,a,!1,De);let Oe=!1,je=!1,Ae=!0;if(we){const $e=.5*H*ye+Y,ht=new c.P(-100,-100),st=new c.P(this.screenRightBoundary,this.screenBottomBoundary),ft=new Ut,pt=we.first,Dt=we.last;let qt=[];for(let Cn=pt.path.length-1;Cn>=1;Cn--)qt.push(pt.path[Cn]);for(let Cn=1;Cn<Dt.path.length;Cn++)qt.push(Dt.path[Cn]);const Pt=2.5*$e;if(F){const Cn=this.projectPathToScreenSpace(qt,De);qt=Cn.some((ai=>ai.signedDistanceFromCamera<=0))?[]:Cn.map((ai=>ai.point))}let an=[];if(qt.length>0){const Cn=qt[0].clone(),ai=qt[0].clone();for(let Ci=1;Ci<qt.length;Ci++)Cn.x=Math.min(Cn.x,qt[Ci].x),Cn.y=Math.min(Cn.y,qt[Ci].y),ai.x=Math.max(ai.x,qt[Ci].x),ai.y=Math.max(ai.y,qt[Ci].y);an=Cn.x>=ht.x&&ai.x<=st.x&&Cn.y>=ht.y&&ai.y<=st.y?[qt]:ai.x<ht.x||Cn.x>st.x||ai.y<ht.y||Cn.y>st.y?[]:c.aK([qt],ht.x,ht.y,st.x,st.y)}for(const Cn of an){ft.reset(Cn,.25*$e);let ai=0;ai=ft.length<=.5*$e?1:Math.ceil(ft.paddedLength/Pt)+1;for(let Ci=0;Ci<ai;Ci++){const li=Ci/Math.max(ai-1,1),Fi=ft.lerp(li),_i=Fi.x+$n,Mr=Fi.y+$n;ge.push(_i,Mr,$e,0);const zi=_i-$e,Cr=Mr-$e,er=_i+$e,ar=Mr+$e;if(Ae=Ae&&this.isOffscreen(zi,Cr,er,ar),je=je||this.isInsideGrid(zi,Cr,er,ar),t!=="always"&&this.grid.hitTestCircle(_i,Mr,$e,t,V)&&(Oe=!0,!z))return{circles:[],offscreen:!1,collisionDetected:Oe}}}}return{circles:!z&&Oe||!je||ye<this.perspectiveRatioCutoff?[]:ge,offscreen:Ae,collisionDetected:Oe}}projectPathToScreenSpace(t,a){const h=(function(p,b){const T=c.N();return c.aC(T,b.pitchedLabelPlaneMatrix),p.map((k=>{const z=wn(k.x,k.y,T,b.getElevation),F=b.transform.projectTileCoordinates(z.point.x,z.point.y,b.unwrappedTileID,b.getElevation);return F.point.x=(.5*F.point.x+.5)*b.width,F.point.y=(.5*-F.point.y+.5)*b.height,F}))})(t,a);return(function(p){let b=0,T=0,k=0,z=0;for(let F=0;F<p.length;F++)p[F].isOccluded?(k=F+1,z=0):(z++,z>T&&(T=z,b=k));return p.slice(b,b+T)})(h)}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],h=new c.ac;for(const H of t){const Y=new c.P(H.x+$n,H.y+$n);h.extend(Y),a.push(Y)}const{minX:p,minY:b,maxX:T,maxY:k}=h,z=this.grid.query(p,b,T,k).concat(this.ignoredGrid.query(p,b,T,k)),F={},V={};for(const H of z){const Y=H.key;if(F[Y.bucketInstanceId]===void 0&&(F[Y.bucketInstanceId]={}),F[Y.bucketInstanceId][Y.featureIndex])continue;const J=[new c.P(H.x1,H.y1),new c.P(H.x2,H.y1),new c.P(H.x2,H.y2),new c.P(H.x1,H.y2)];c.aL(a,J)&&(F[Y.bucketInstanceId][Y.featureIndex]=!0,V[Y.bucketInstanceId]===void 0&&(V[Y.bucketInstanceId]=[]),V[Y.bucketInstanceId].push(Y.featureIndex))}return V}insertCollisionBox(t,a,h,p,b,T){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:b,collisionGroupID:T,overlapMode:a},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,h,p,b,T){const k=h?this.ignoredGrid:this.grid,z={bucketInstanceId:p,featureIndex:b,collisionGroupID:T,overlapMode:a};for(let F=0;F<t.length;F+=4)k.insertCircle(z,t[F],t[F+1],t[F+2])}projectAndGetPerspectiveRatio(t,a,h,p,b){if(b){let T;p?(T=[t,a,p(t,a),1],c.aI(T,T,b)):(T=[t,a,0,1],qa(T,T,b));const k=T[3];return{x:(T[0]/k+1)/2*this.transform.width+$n,y:(-T[1]/k+1)/2*this.transform.height+$n,perspectiveRatio:.5+this.transform.cameraToCenterDistance/k*.5,isOccluded:!1,signedDistanceFromCamera:k}}{const T=this.transform.projectTileCoordinates(t,a,h,p);return{x:(T.point.x+1)/2*this.transform.width+$n,y:(1-T.point.y)/2*this.transform.height+$n,perspectiveRatio:.5+this.transform.cameraToCenterDistance/T.signedDistanceFromCamera*.5,isOccluded:T.isOccluded,signedDistanceFromCamera:T.signedDistanceFromCamera}}}getPerspectiveRatio(t,a,h,p){const b=this.transform.projectTileCoordinates(t,a,h,p);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(t,a,h,p){return h<$n||t>=this.screenRightBoundary||p<$n||a>this.screenBottomBoundary}isInsideGrid(t,a,h,p){return h>=0&&t<this.gridRightBoundary&&p>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=c.as([]);return c.O(t,t,[-100,-100,0]),t}_projectCollisionBox(t,a,h,p,b,T,k,z,F,V,H){let Y=1,J=0,ae=0,ge=1;const ve=t.anchorPointX+k[0],ye=t.anchorPointY+k[1];if(T&&!b){const qt=this.projectAndGetPerspectiveRatio(ve+1,ye,p,F,H),Pt=qt.x-z.x,an=Math.atan((qt.y-z.y)/Pt)+(Pt<0?Math.PI:0),Cn=Math.sin(an),ai=Math.cos(an);Y=ai,J=Cn,ae=-Cn,ge=ai}else if(!T&&b){const qt=Ga(this.transform);Y=qt.vecEast[0],J=qt.vecEast[1],ae=qt.vecSouth[0],ge=qt.vecSouth[1]}let be=z.x,De=z.y,we=a;b&&(be=ve,De=ye,we=Math.pow(2,-(this.transform.zoom-h.overscaledZ)),we*=this.transform.getPitchedTextCorrection(ve,ye,p),V||(we*=c.ao(.5+z.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),V&&(be+=Y*V.x*we+ae*V.y*we,De+=J*V.x*we+ge*V.y*we);const Oe=t.x1*we,je=t.x2*we,Ae=(Oe+je)/2,$e=t.y1*we,ht=t.y2*we,st=($e+ht)/2,ft=[{offsetX:Oe,offsetY:$e},{offsetX:Ae,offsetY:$e},{offsetX:je,offsetY:$e},{offsetX:je,offsetY:st},{offsetX:je,offsetY:ht},{offsetX:Ae,offsetY:ht},{offsetX:Oe,offsetY:ht},{offsetX:Oe,offsetY:st}];let pt=[];for(const{offsetX:qt,offsetY:Pt}of ft)pt.push(new c.P(be+Y*qt+ae*Pt,De+J*qt+ge*Pt));let Dt=!1;if(b){const qt=pt.map((Pt=>this.projectAndGetPerspectiveRatio(Pt.x,Pt.y,p,F,H)));Dt=qt.some((Pt=>!Pt.isOccluded)),pt=qt.map((Pt=>new c.P(Pt.x,Pt.y)))}else Dt=!0;return{box:c.aM(pt),allPointsOccluded:!Dt}}}class Dc{constructor(t,a,h,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class ks{constructor(t,a,h,p,b){this.text=new Dc(t?t.text:null,a,h,b),this.icon=new Dc(t?t.icon:null,a,p,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class cs{constructor(t,a,h){this.text=t,this.icon=a,this.skipFade=h}}class Za{constructor(t,a,h,p,b){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=b}}class Lc{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:h=>h.collisionGroupID===a}}return this.collisionGroups[t]}}function cr(v,t,a,h,p){const{horizontalAlign:b,verticalAlign:T}=c.aT(v);return new c.P(-(b-.5)*t+h[0]*p,-(T-.5)*a+h[1]*p)}class nu{constructor(t,a,h,p,b){this.transform=t.clone(),this.terrain=a,this.collisionIndex=new Yu(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new Lc(p),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(t){const a=this.terrain;return a?(h,p)=>a.getElevation(t,h,p):null}getBucketParts(t,a,h,p){const b=h.getBucket(a),T=h.latestFeatureIndex;if(!b||!T||a.id!==b.layerIds[0])return;const k=h.collisionBoxArray,z=b.layers[0].layout,F=b.layers[0].paint,V=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),H=h.tileSize/c.a5,Y=h.tileID.toUnwrapped(),J=z.get("text-rotation-alignment")==="map",ae=c.aO(h,1,this.transform.zoom),ge=c.aP(this.collisionIndex.transform,h,F.get("text-translate"),F.get("text-translate-anchor")),ve=c.aP(this.collisionIndex.transform,h,F.get("icon-translate"),F.get("icon-translate-anchor")),ye=yr(J,this.transform,ae);this.retainedQueryData[b.bucketInstanceId]=new Za(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,h.tileID);const be={bucket:b,layout:z,translationText:ge,translationIcon:ve,unwrappedTileID:Y,pitchedLabelPlaneMatrix:ye,scale:V,textPixelRatio:H,holdingForFade:h.holdingForSymbolFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:c.az(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(p)for(const De of b.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Oe,symbolInstanceEnd:je}=De;t.push({sortKey:we,symbolInstanceStart:Oe,symbolInstanceEnd:je,parameters:be})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:be})}attemptAnchorPlacement(t,a,h,p,b,T,k,z,F,V,H,Y,J,ae,ge,ve,ye,be,De,we){const Oe=c.aQ[t.textAnchor],je=[t.textOffset0,t.textOffset1],Ae=cr(Oe,h,p,je,b),$e=this.collisionIndex.placeCollisionBox(a,Y,z,F,V,k,T,ve,H.predicate,De,Ae,we);if((!be||this.collisionIndex.placeCollisionBox(be,Y,z,F,V,k,T,ye,H.predicate,De,Ae,we).placeable)&&$e.placeable){let ht;if(this.prevPlacement&&this.prevPlacement.variableOffsets[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID]&&this.prevPlacement.placements[J.crossTileID].text&&(ht=this.prevPlacement.variableOffsets[J.crossTileID].anchor),J.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[J.crossTileID]={textOffset:je,width:h,height:p,anchor:Oe,textBoxScale:b,prevAnchor:ht},this.markUsedJustification(ae,Oe,J,ge),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,ge,J),this.placedOrientations[J.crossTileID]=ge),{shift:Ae,placedGlyphBoxes:$e}}}placeLayerBucketPart(t,a,h){const{bucket:p,layout:b,translationText:T,translationIcon:k,unwrappedTileID:z,pitchedLabelPlaneMatrix:F,textPixelRatio:V,holdingForFade:H,collisionBoxArray:Y,partiallyEvaluatedTextSize:J,collisionGroup:ae}=t.parameters,ge=b.get("text-optional"),ve=b.get("icon-optional"),ye=c.aR(b,"text-overlap","text-allow-overlap"),be=ye==="always",De=c.aR(b,"icon-overlap","icon-allow-overlap"),we=De==="always",Oe=b.get("text-rotation-alignment")==="map",je=b.get("text-pitch-alignment")==="map",Ae=b.get("icon-text-fit")!=="none",$e=b.get("symbol-z-order")==="viewport-y",ht=be&&(we||!p.hasIconData()||ve),st=we&&(be||!p.hasTextData()||ge);!p.collisionArrays&&Y&&p.deserializeCollisionBoxes(Y);const ft=this.retainedQueryData[p.bucketInstanceId].tileID,pt=this._getTerrainElevationFunc(ft),Dt=this.transform.getFastPathSimpleProjectionMatrix(ft),qt=(Pt,an,Cn)=>{var ai,Ci;if(a[Pt.crossTileID])return;if(H)return void(this.placements[Pt.crossTileID]=new cs(!1,!1,!1));let li=!1,Fi=!1,_i=!0,Mr=null,zi={box:null,placeable:!1,offscreen:null,occluded:!1},Cr={placeable:!1},er=null,ar=null,ra=null,ga=0,no=0,fl=0;an.textFeatureIndex?ga=an.textFeatureIndex:Pt.useRuntimeCollisionCircles&&(ga=Pt.featureIndex),an.verticalTextFeatureIndex&&(no=an.verticalTextFeatureIndex);const Tu=an.textBox;if(Tu){const Ir=tr=>{let Ar=c.aA.horizontal;if(p.allowVerticalPlacement&&!tr&&this.prevPlacement){const Fa=this.prevPlacement.placedOrientations[Pt.crossTileID];Fa&&(this.placedOrientations[Pt.crossTileID]=Fa,Ar=Fa,this.markUsedOrientation(p,Ar,Pt))}return Ar},Gr=(tr,Ar)=>{if(p.allowVerticalPlacement&&Pt.numVerticalGlyphVertices>0&&an.verticalTextBox){for(const Fa of p.writingModes)if(Fa===c.aA.vertical?(zi=Ar(),Cr=zi):zi=tr(),zi&&zi.placeable)break}else zi=tr()},aa=Pt.textAnchorOffsetStartIndex,vs=Pt.textAnchorOffsetEndIndex;if(vs===aa){const tr=(Ar,Fa)=>{const Gi=this.collisionIndex.placeCollisionBox(Ar,ye,V,ft,z,je,Oe,T,ae.predicate,pt,void 0,Dt);return Gi&&Gi.placeable&&(this.markUsedOrientation(p,Fa,Pt),this.placedOrientations[Pt.crossTileID]=Fa),Gi};Gr((()=>tr(Tu,c.aA.horizontal)),(()=>{const Ar=an.verticalTextBox;return p.allowVerticalPlacement&&Pt.numVerticalGlyphVertices>0&&Ar?tr(Ar,c.aA.vertical):{box:null,offscreen:null}})),Ir(zi&&zi.placeable)}else{let tr=c.aQ[(Ci=(ai=this.prevPlacement)===null||ai===void 0?void 0:ai.variableOffsets[Pt.crossTileID])===null||Ci===void 0?void 0:Ci.anchor];const Ar=(Gi,Bf,Hh)=>{const Xh=Gi.x2-Gi.x1,Ff=Gi.y2-Gi.y1,xs=Pt.textBoxScale,Gl=Ae&&De==="never"?Bf:null;let dl=null,jf=ye==="never"?1:2,Eu="never";tr&&jf++;for(let $h=0;$h<jf;$h++){for(let ql=aa;ql<vs;ql++){const Wh=p.textAnchorOffsets.get(ql);if(tr&&Wh.textAnchor!==tr)continue;const Kh=this.attemptAnchorPlacement(Wh,Gi,Xh,Ff,xs,Oe,je,V,ft,z,ae,Eu,Pt,p,Hh,T,k,Gl,pt);if(Kh&&(dl=Kh.placedGlyphBoxes,dl&&dl.placeable))return li=!0,Mr=Kh.shift,dl}tr?tr=null:Eu=ye}return h&&!dl&&(dl={box:this.collisionIndex.placeCollisionBox(Tu,"always",V,ft,z,je,Oe,T,ae.predicate,pt,void 0,Dt).box,offscreen:!1,placeable:!1,occluded:!1}),dl};Gr((()=>Ar(Tu,an.iconBox,c.aA.horizontal)),(()=>{const Gi=an.verticalTextBox;return p.allowVerticalPlacement&&(!zi||!zi.placeable)&&Pt.numVerticalGlyphVertices>0&&Gi?Ar(Gi,an.verticalIconBox,c.aA.vertical):{box:null,occluded:!0,offscreen:null}})),zi&&(li=zi.placeable,_i=zi.offscreen);const Fa=Ir(zi&&zi.placeable);if(!li&&this.prevPlacement){const Gi=this.prevPlacement.variableOffsets[Pt.crossTileID];Gi&&(this.variableOffsets[Pt.crossTileID]=Gi,this.markUsedJustification(p,Gi.anchor,Pt,Fa))}}}if(er=zi,li=er&&er.placeable,_i=er&&er.offscreen,Pt.useRuntimeCollisionCircles&&Pt.centerJustifiedTextSymbolIndex>=0){const Ir=p.text.placedSymbolArray.get(Pt.centerJustifiedTextSymbolIndex),Gr=c.aB(p.textSizeData,J,Ir),aa=b.get("text-padding");ar=this.collisionIndex.placeCollisionCircles(ye,Ir,p.lineVertexArray,p.glyphOffsetArray,Gr,z,F,h,je,ae.predicate,Pt.collisionCircleDiameter,aa,T,pt),ar.circles.length&&ar.collisionDetected&&!h&&c.w("Collisions detected, but collision boxes are not shown"),li=be||ar.circles.length>0&&!ar.collisionDetected,_i=_i&&ar.offscreen}if(an.iconFeatureIndex&&(fl=an.iconFeatureIndex),an.iconBox){const Ir=Gr=>this.collisionIndex.placeCollisionBox(Gr,De,V,ft,z,je,Oe,k,ae.predicate,pt,Ae&&Mr?Mr:void 0,Dt);Cr&&Cr.placeable&&an.verticalIconBox?(ra=Ir(an.verticalIconBox),Fi=ra.placeable):(ra=Ir(an.iconBox),Fi=ra.placeable),_i=_i&&ra.offscreen}const Yh=ge||Pt.numHorizontalGlyphVertices===0&&Pt.numVerticalGlyphVertices===0,Su=ve||Pt.numIconVertices===0;Yh||Su?Su?Yh||(Fi=Fi&&li):li=Fi&&li:Fi=li=Fi&&li;const Qa=Fi&&ra.placeable;if(li&&er.placeable&&this.collisionIndex.insertCollisionBox(er.box,ye,b.get("text-ignore-placement"),p.bucketInstanceId,Cr&&Cr.placeable&&no?no:ga,ae.ID),Qa&&this.collisionIndex.insertCollisionBox(ra.box,De,b.get("icon-ignore-placement"),p.bucketInstanceId,fl,ae.ID),ar&&li&&this.collisionIndex.insertCollisionCircles(ar.circles,ye,b.get("text-ignore-placement"),p.bucketInstanceId,ga,ae.ID),h&&this.storeCollisionData(p.bucketInstanceId,Cn,an,er,ra,ar),Pt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Pt.crossTileID]=new cs((li||ht)&&!er?.occluded,(Fi||st)&&!ra?.occluded,_i||p.justReloaded),a[Pt.crossTileID]=!0};if($e){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Pt=p.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let an=Pt.length-1;an>=0;--an){const Cn=Pt[an];qt(p.symbolInstances.get(Cn),p.collisionArrays[Cn],Cn)}}else for(let Pt=t.symbolInstanceStart;Pt<t.symbolInstanceEnd;Pt++)qt(p.symbolInstances.get(Pt),p.collisionArrays[Pt],Pt);p.justReloaded=!1}storeCollisionData(t,a,h,p,b,T){if(h.textBox||h.iconBox){let k,z;this.collisionBoxArrays.has(t)?k=this.collisionBoxArrays.get(t):(k=new Map,this.collisionBoxArrays.set(t,k)),k.has(a)?z=k.get(a):(z={text:null,icon:null},k.set(a,z)),h.textBox&&(z.text=p.box),h.iconBox&&(z.icon=b.box)}if(T){let k=this.collisionCircleArrays[t];k===void 0&&(k=this.collisionCircleArrays[t]=[]);for(let z=0;z<T.circles.length;z+=4)k.push(T.circles[z+0]-$n),k.push(T.circles[z+1]-$n),k.push(T.circles[z+2]),k.push(T.collisionDetected?1:0)}}markUsedJustification(t,a,h,p){let b;b=p===c.aA.vertical?h.verticalPlacedTextSymbolIndex:{left:h.leftJustifiedTextSymbolIndex,center:h.centerJustifiedTextSymbolIndex,right:h.rightJustifiedTextSymbolIndex}[c.aS(a)];const T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex,h.verticalPlacedTextSymbolIndex];for(const k of T)k>=0&&(t.text.placedSymbolArray.get(k).crossTileID=b>=0&&k!==b?0:h.crossTileID)}markUsedOrientation(t,a,h){const p=a===c.aA.horizontal||a===c.aA.horizontalOnly?a:0,b=a===c.aA.vertical?a:0,T=[h.leftJustifiedTextSymbolIndex,h.centerJustifiedTextSymbolIndex,h.rightJustifiedTextSymbolIndex];for(const k of T)t.text.placedSymbolArray.get(k).placedOrientation=p;h.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(h.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let h=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const p=a?a.symbolFadeChange(t):1,b=a?a.opacities:{},T=a?a.variableOffsets:{},k=a?a.placedOrientations:{};for(const z in this.placements){const F=this.placements[z],V=b[z];V?(this.opacities[z]=new ks(V,p,F.text,F.icon),h=h||F.text!==V.text.placed||F.icon!==V.icon.placed):(this.opacities[z]=new ks(null,p,F.text,F.icon,F.skipFade),h=h||F.text||F.icon)}for(const z in b){const F=b[z];if(!this.opacities[z]){const V=new ks(F,p,!1,!1);V.isHidden()||(this.opacities[z]=V,h=h||F.text.placed||F.icon.placed)}}for(const z in T)this.variableOffsets[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.variableOffsets[z]=T[z]);for(const z in k)this.placedOrientations[z]||!this.opacities[z]||this.opacities[z].isHidden()||(this.placedOrientations[z]=k[z]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");h?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a){const h={};for(const p of a){const b=p.getBucket(t);b&&p.latestFeatureIndex&&t.id===b.layerIds[0]&&this.updateBucketOpacities(b,p.tileID,h,p.collisionBoxArray)}}updateBucketOpacities(t,a,h,p){t.hasTextData()&&(t.text.opacityVertexArray.clear(),t.text.hasVisibleVertices=!1),t.hasIconData()&&(t.icon.opacityVertexArray.clear(),t.icon.hasVisibleVertices=!1),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const b=t.layers[0],T=b.layout,k=new ks(null,0,!1,!1,!0),z=T.get("text-allow-overlap"),F=T.get("icon-allow-overlap"),V=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),H=T.get("text-rotation-alignment")==="map",Y=T.get("text-pitch-alignment")==="map",J=T.get("icon-text-fit")!=="none",ae=new ks(null,0,z&&(F||!t.hasIconData()||T.get("icon-optional")),F&&(z||!t.hasTextData()||T.get("text-optional")),!0);!t.collisionArrays&&p&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(p);const ge=(ye,be,De)=>{for(let we=0;we<be/4;we++)ye.opacityVertexArray.emplaceBack(De);ye.hasVisibleVertices=ye.hasVisibleVertices||De!==Hs},ve=this.collisionBoxArrays.get(t.bucketInstanceId);for(let ye=0;ye<t.symbolInstances.length;ye++){const be=t.symbolInstances.get(ye),{numHorizontalGlyphVertices:De,numVerticalGlyphVertices:we,crossTileID:Oe}=be;let je=this.opacities[Oe];h[Oe]?je=k:je||(je=ae,this.opacities[Oe]=je),h[Oe]=!0;const Ae=be.numIconVertices>0,$e=this.placedOrientations[be.crossTileID],ht=$e===c.aA.vertical,st=$e===c.aA.horizontal||$e===c.aA.horizontalOnly;if(De>0||we>0){const pt=Xu(je.text);ge(t.text,De,ht?Hs:pt),ge(t.text,we,st?Hs:pt);const Dt=je.text.isHidden();[be.rightJustifiedTextSymbolIndex,be.centerJustifiedTextSymbolIndex,be.leftJustifiedTextSymbolIndex].forEach((an=>{an>=0&&(t.text.placedSymbolArray.get(an).hidden=Dt||ht?1:0)})),be.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(be.verticalPlacedTextSymbolIndex).hidden=Dt||st?1:0);const qt=this.variableOffsets[be.crossTileID];qt&&this.markUsedJustification(t,qt.anchor,be,$e);const Pt=this.placedOrientations[be.crossTileID];Pt&&(this.markUsedJustification(t,"left",be,Pt),this.markUsedOrientation(t,Pt,be))}if(Ae){const pt=Xu(je.icon),Dt=!(J&&be.verticalPlacedIconSymbolIndex&&ht);be.placedIconSymbolIndex>=0&&(ge(t.icon,be.numIconVertices,Dt?pt:Hs),t.icon.placedSymbolArray.get(be.placedIconSymbolIndex).hidden=je.icon.isHidden()),be.verticalPlacedIconSymbolIndex>=0&&(ge(t.icon,be.numVerticalIconVertices,Dt?Hs:pt),t.icon.placedSymbolArray.get(be.verticalPlacedIconSymbolIndex).hidden=je.icon.isHidden())}const ft=ve&&ve.has(ye)?ve.get(ye):{text:null,icon:null};if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const pt=t.collisionArrays[ye];if(pt){let Dt=new c.P(0,0);if(pt.textBox||pt.verticalTextBox){let qt=!0;if(V){const Pt=this.variableOffsets[Oe];Pt?(Dt=cr(Pt.anchor,Pt.width,Pt.height,Pt.textOffset,Pt.textBoxScale),H&&Dt._rotate(Y?-this.transform.bearingInRadians:this.transform.bearingInRadians)):qt=!1}if(pt.textBox||pt.verticalTextBox){let Pt;pt.textBox&&(Pt=ht),pt.verticalTextBox&&(Pt=st),Hu(t.textCollisionBox.collisionVertexArray,je.text.placed,!qt||Pt,ft.text,Dt.x,Dt.y)}}if(pt.iconBox||pt.verticalIconBox){const qt=!!(!st&&pt.verticalIconBox);let Pt;pt.iconBox&&(Pt=qt),pt.verticalIconBox&&(Pt=!qt),Hu(t.iconCollisionBox.collisionVertexArray,je.icon.placed,Pt,ft.icon,J?Dt.x:0,J?Dt.y:0)}}}}if(t.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);t.bucketInstanceId in this.collisionCircleArrays&&(t.collisionCircleArray=this.collisionCircleArrays[t.bucketInstanceId],delete this.collisionCircleArrays[t.bucketInstanceId])}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const h=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*h>t}setStale(){this.stale=!0}}function Hu(v,t,a,h,p,b){h&&h.length!==0||(h=[0,0,0,0]);const T=h[0]-$n,k=h[1]-$n,z=h[2]-$n,F=h[3]-$n;v.emplaceBack(t?1:0,a?1:0,p||0,b||0,T,k),v.emplaceBack(t?1:0,a?1:0,p||0,b||0,z,k),v.emplaceBack(t?1:0,a?1:0,p||0,b||0,z,F),v.emplaceBack(t?1:0,a?1:0,p||0,b||0,T,F)}const iu=Math.pow(2,25),fo=Math.pow(2,24),zc=Math.pow(2,17),Ps=Math.pow(2,16),Rs=Math.pow(2,9),Eh=Math.pow(2,8),po=Math.pow(2,1);function Xu(v){if(v.opacity===0&&!v.placed)return 0;if(v.opacity===1&&v.placed)return 4294967295;const t=v.placed?1:0,a=Math.floor(127*v.opacity);return a*iu+t*fo+a*zc+t*Ps+a*Rs+t*Eh+a*po+t}const Hs=0;class ri{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,a,h,p,b){const T=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(T,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort(((k,z)=>k.sortKey-z.sortKey)));this._currentPartIndex<T.length;)if(a.placeLayerBucketPart(T[this._currentPartIndex],this._seenCrossTileIDs,h),this._currentPartIndex++,b())return!0;return!1}}class Ya{constructor(t,a,h,p,b,T,k,z){this.placement=new nu(t,a,T,k,z),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(t,a,h){const p=dt(),b=()=>!this._forceFullPlacement&&dt()-p>2;for(;this._currentPlacementIndex>=0;){const T=a[t[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=k)&&(!T.maxzoom||T.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new ri(T)),this._inProgressLayer.continuePlacement(h[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const An=512/c.a5/2;class Pa{constructor(t,a,h){this.tileID=t,this.bucketInstanceId=h,this._symbolsByKey={};const p=new Map;for(let b=0;b<a.length;b++){const T=a.get(b),k=T.key,z=p.get(k);z?z.push(T):p.set(k,[T])}for(const[b,T]of p){const k={positions:T.map((z=>({x:Math.floor(z.anchorX*An),y:Math.floor(z.anchorY*An)}))),crossTileIDs:T.map((z=>z.crossTileID))};if(k.positions.length>128){const z=new c.aU(k.positions.length,16,Uint16Array);for(const{x:F,y:V}of k.positions)z.add(F,V);z.finish(),delete k.positions,k.index=z}this._symbolsByKey[b]=k}}getScaledCoordinates(t,a){const{x:h,y:p,z:b}=this.tileID.canonical,{x:T,y:k,z}=a.canonical,F=An/Math.pow(2,z-b),V=(k*c.a5+t.anchorY)*F,H=p*c.a5*An;return{x:Math.floor((T*c.a5+t.anchorX)*F-h*c.a5*An),y:Math.floor(V-H)}}findMatches(t,a,h){const p=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let b=0;b<t.length;b++){const T=t.get(b);if(T.crossTileID)continue;const k=this._symbolsByKey[T.key];if(!k)continue;const z=this.getScaledCoordinates(T,a);if(k.index){const F=k.index.range(z.x-p,z.y-p,z.x+p,z.y+p).sort();for(const V of F){const H=k.crossTileIDs[V];if(!h[H]){h[H]=!0,T.crossTileID=H;break}}}else if(k.positions)for(let F=0;F<k.positions.length;F++){const V=k.positions[F],H=k.crossTileIDs[F];if(Math.abs(V.x-z.x)<=p&&Math.abs(V.y-z.y)<=p&&!h[H]){h[H]=!0,T.crossTileID=H;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:t})=>t))}}class ya{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const h in this.indexes){const p=this.indexes[h],b={};for(const T in p){const k=p[T];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+a),b[k.tileID.key]=k}this.indexes[h]=b}this.lng=t}addBucket(t,a,h){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>t.overscaledZ)for(const k in T){const z=T[k];z.tileID.isChildOf(t)&&z.findMatches(a.symbolInstances,t,p)}else{const k=T[t.scaledTo(Number(b)).key];k&&k.findMatches(a.symbolInstances,t,p)}}for(let b=0;b<a.symbolInstances.length;b++){const T=a.symbolInstances.get(b);T.crossTileID||(T.crossTileID=h.generate(),p[T.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Pa(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const h of a.getCrossTileIDsLists())for(const p of h)delete this.usedCrossTileIDs[t][p]}removeStaleBuckets(t){let a=!1;for(const h in this.indexes){const p=this.indexes[h];for(const b in p)t[p[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[b]),delete p[b],a=!0)}return a}}class $i{constructor(){this.layerIndexes={},this.crossTileIDs=new ya,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,h){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new Kr);let b=!1;const T={};p.handleWrapJump(h);for(const k of a){const z=k.getBucket(t);z&&t.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(k.tileID,z,this.crossTileIDs)&&(b=!0),T[z.bucketInstanceId]=!0)}return p.removeStaleBuckets(T)&&(b=!0),b}pruneUnusedLayers(t){const a={};t.forEach((h=>{a[h]=!0}));for(const h in this.layerIndexes)a[h]||delete this.layerIndexes[h]}}var ir="void main() {fragColor=vec4(1.0);}";const Di={prelude:vn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:vn("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:vn("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:vn(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:vn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:vn(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:vn(ir,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:vn(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:vn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:vn("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:vn("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:vn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:vn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:vn(ir,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:vn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:vn(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:vn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:vn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:vn(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:vn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:vn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:vn(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:vn(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:vn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:vn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:vn(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:vn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:vn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:vn(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:vn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:vn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:vn("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:vn("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:vn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:vn("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:vn(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:vn("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function vn(v,t){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=t.match(/in ([\w]+) ([\w]+)/g),p=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=b?b.concat(p):p,k={};return{fragmentSource:v=v.replace(a,((z,F,V,H,Y)=>(k[Y]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
in ${V} ${H} ${Y};
#else
uniform ${V} ${H} u_${Y};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Y}
    ${V} ${H} ${Y} = u_${Y};
#endif
`))),vertexSource:t=t.replace(a,((z,F,V,H,Y)=>{const J=H==="float"?"vec2":"vec4",ae=Y.match(/color/)?"color":J;return k[Y]?F==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${V} ${J} a_${Y};
out ${V} ${H} ${Y};
#else
uniform ${V} ${H} u_${Y};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${V} ${H} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${ae}(a_${Y}, u_${Y}_t);
#else
    ${V} ${H} ${Y} = u_${Y};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
in ${V} ${J} a_${Y};
#else
uniform ${V} ${H} u_${Y};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${V} ${H} ${Y} = a_${Y};
#else
    ${V} ${H} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${V} ${H} ${Y} = unpack_mix_${ae}(a_${Y}, u_${Y}_t);
#else
    ${V} ${H} ${Y} = u_${Y};
#endif
`})),staticAttributes:h,staticUniforms:T}}class ei{constructor(t,a,h){this.vertexBuffer=t,this.indexBuffer=a,this.segments=h}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ha=c.aV([{name:"a_pos",type:"Int16",components:2}]);const Ni="#define PROJECTION_MERCATOR",kn="mercator";class mi{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return kn}get shaderDefine(){return Ni}get shaderPreludeCode(){return Di.projectionMercator}get vertexShaderPreludeCode(){return Di.projectionMercator.vertexSource}get subdivisionGranularity(){return c.aW.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(t){}getMeshFromTileID(t,a,h,p,b){if(this._cachedMesh)return this._cachedMesh;const T=new c.aX;T.emplaceBack(0,0),T.emplaceBack(c.a5,0),T.emplaceBack(0,c.a5),T.emplaceBack(c.a5,c.a5);const k=t.createVertexBuffer(T,Ha.members),z=c.aY.simpleSegment(0,0,4,2),F=new c.aZ;F.emplaceBack(1,0,2),F.emplaceBack(1,2,3);const V=t.createIndexBuffer(F);return this._cachedMesh=new ei(k,V,z),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(t){}}class ca{constructor(t=0,a=0,h=0,p=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=h,this.right=p}interpolate(t,a,h){return a.top!=null&&t.top!=null&&(this.top=c.G.number(t.top,a.top,h)),a.bottom!=null&&t.bottom!=null&&(this.bottom=c.G.number(t.bottom,a.bottom,h)),a.left!=null&&t.left!=null&&(this.left=c.G.number(t.left,a.left,h)),a.right!=null&&t.right!=null&&(this.right=c.G.number(t.right,a.right,h)),this}getCenter(t,a){const h=c.ao((this.left+t-this.right)/2,0,t),p=c.ao((this.top+a-this.bottom)/2,0,a);return new c.P(h,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function hs(v,t){if(!v.renderWorldCopies||v.lngRange)return;const a=t.lng-v.center.lng;t.lng+=a>180?-360:a<-180?360:0}function ci(v){return Math.max(0,Math.floor(v))}class Xs{constructor(t,a){var h;this.applyConstrain=(p,b)=>this._constrainOverride!==null?this._constrainOverride(p,b):this._callbacks.defaultConstrain(p,b),this._callbacks=t,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrainOverride=(h=a?.constrainOverride)!==null&&h!==void 0?h:null,this.setMaxBounds(),this._width=0,this._height=0,this._center=new c.V(0,0),this._elevation=0,this._zoom=0,this._tileZoom=ci(this._zoom),this._scale=c.ar(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ca,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(t,a,h){this._constrainOverride=t.constrainOverride,this._latRange=t.latRange,this._lngRange=t.lngRange,this._width=t.width,this._height=t.height,this._center=t.center,this._elevation=t.elevation,this._minElevationForCurrentTile=t.minElevationForCurrentTile,this._zoom=t.zoom,this._tileZoom=ci(this._zoom),this._scale=c.ar(this._zoom),this._bearingInRadians=t.bearingInRadians,this._fovInRadians=t.fovInRadians,this._pitchInRadians=t.pitchInRadians,this._rollInRadians=t.rollInRadians,this._unmodified=t.unmodified,this._edgeInsets=new ca(t.padding.top,t.padding.bottom,t.padding.left,t.padding.right),this._minZoom=t.minZoom,this._maxZoom=t.maxZoom,this._minPitch=t.minPitch,this._maxPitch=t.maxPitch,this._renderWorldCopies=t.renderWorldCopies,this._cameraToCenterDistance=t.cameraToCenterDistance,this._nearZ=t.nearZ,this._farZ=t.farZ,this._autoCalculateNearFarZ=!h&&t.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(t){this._minElevationForCurrentTile=t}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(t){this._minZoom!==t&&(this._minZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.setZoom(this.applyConstrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(t){this._minPitch!==t&&(this._minPitch=t,this.setPitch(Math.max(this.pitch,t)))}get maxPitch(){return this._maxPitch}setMaxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.setPitch(Math.min(this.pitch,t)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get constrainOverride(){return this._constrainOverride}setConstrainOverride(t){t===void 0&&(t=null),this._constrainOverride!==t&&(this._constrainOverride=t,this.constrainInternal(),this._calcMatrices())}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(t){const a=c.W(t,-180,180)*Math.PI/180;var h,p,b,T,k,z,F,V,H;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=ne(),h=this._rotationMatrix,b=-this._bearingInRadians,T=(p=this._rotationMatrix)[0],k=p[1],z=p[2],F=p[3],V=Math.sin(b),H=Math.cos(b),h[0]=T*H+z*V,h[1]=k*H+F*V,h[2]=T*-V+z*H,h[3]=k*-V+F*H)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(t){const a=c.ao(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(t){const a=t/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return c.a_(this._fovInRadians)}setFov(t){t=c.ao(t,.1,150),this.fov!==t&&(this._unmodified=!1,this._fovInRadians=c.aq(t),this._calcMatrices())}get zoom(){return this._zoom}setZoom(t){const a=this.applyConstrain(this._center,t).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=c.ar(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(t){t!==this._elevation&&(this._elevation=t,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(t,a){this._autoCalculateNearFarZ=!1,this._nearZ=t,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,h){this._unmodified=!1,this._edgeInsets.interpolate(t,a,h),this.constrainInternal(),this._calcMatrices()}resize(t,a,h=!0){this._width=t,this._height=a,h&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new Ri([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(t){t?(this._lngRange=[t.getWest(),t.getEast()],this._latRange=[t.getSouth(),t.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-c.ap,c.ap])}getCameraQueryGeometry(t,a){if(a.length===1)return[a[0],t];{const{minX:h,minY:p,maxX:b,maxY:T}=c.ac.fromPoints(a).extend(t);return[new c.P(h,p),new c.P(b,p),new c.P(b,T),new c.P(h,T),new c.P(h,p)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const t=this._unmodified,{center:a,zoom:h}=this.applyConstrain(this.center,this.zoom);this.setCenter(a),this.setZoom(h),this._unmodified=t,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let t=c.as(new Float64Array(16));c.Q(t,t,[this._width/2,-this._height/2,1]),c.O(t,t,[1,-1,0]),this._clipSpaceToPixelsMatrix=t,t=c.as(new Float64Array(16)),c.Q(t,t,[1,-1,1]),c.O(t,t,[-1,-1,0]),c.Q(t,t,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=t,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(t,a,h,p){const b=h!==void 0?h:this.bearing,T=p=p!==void 0?p:this.pitch,{distanceToCenter:k,clampedElevation:z}=this._distanceToCenterFromAltElevationPitch(a,this.elevation,T),{x:F,y:V}=ii(T,b),H=c.ab.fromLngLat(t,a);let Y,J,ae=c.a$(1,H.y),ge=0;do{if(ge+=1,ge>10)break;J=k/ae,Y=new c.ab(H.x+F*J,H.y+V*J),ae=1/Y.meterInMercatorCoordinateUnits()}while(Math.abs(k-J*ae)>1e-12);return{center:Y.toLngLat(),elevation:z,zoom:c.au(this.height/2/Math.tan(this.fovInRadians/2)/J/this.tileSize)}}recalculateZoomAndCenter(t){if(this.elevation-t==0)return;const a=1/this.worldSize,h=c.at(1,this.center.lat)*this.worldSize,p=c.ab.fromLngLat(this.center,this.elevation),b=p.x/a,T=p.y/a,k=p.z/a,z=this.pitch,F=this.bearing,{x:V,y:H,z:Y}=ii(z,F),J=this.cameraToCenterDistance,ae=b+J*-V,ge=T+J*-H,ve=k+J*Y,{distanceToCenter:ye,clampedElevation:be}=this._distanceToCenterFromAltElevationPitch(ve/h,t,z),De=ye*h,we=new c.ab((ae+V*De)*a,(ge+H*De)*a,0).toLngLat(),Oe=c.at(1,we.lat),je=c.au(this.height/2/Math.tan(this.fovInRadians/2)/ye/Oe/this.tileSize);this._elevation=be,this._center=we,this.setZoom(je)}_distanceToCenterFromAltElevationPitch(t,a,h){const p=-Math.cos(c.aq(h)),b=t-a;let T,k=a;return p*b>=0||Math.abs(p)<.1?(T=1e4,k=t+T*p):T=-b/p,{distanceToCenter:T,clampedElevation:k}}getCameraPoint(){const t=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(t*Math.sin(this.rollInRadians),t*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const t=c.at(1,this.center.lat)*this.worldSize;return it(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/t).toLngLat()}getMercatorTileCoordinates(t){if(!t)return[0,0,1,1];const a=t.canonical.z>=0?1<<t.canonical.z:Math.pow(2,t.canonical.z);return[t.canonical.x/a,t.canonical.y/a,1/a/c.a5,1/a/c.a5]}}class Si{constructor(t,a){this.min=t,this.max=a,this.center=c.b0([],c.b1([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],h=c.b2(this.min),p=c.b2(this.max);for(let b=0;b<a.length;b++)h[b]=a[b]?this.min[b]:this.center[b],p[b]=a[b]?this.center[b]:this.max[b];return p[2]=this.max[2],new Si(h,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersectsFrustum(t){let a=!0;for(let h=0;h<t.planes.length;h++){const p=this.intersectsPlane(t.planes[h]);if(p===0)return 0;p===1&&(a=!1)}return a?2:t.aabb.min[0]>this.max[0]||t.aabb.min[1]>this.max[1]||t.aabb.min[2]>this.max[2]||t.aabb.max[0]<this.min[0]||t.aabb.max[1]<this.min[1]||t.aabb.max[2]<this.min[2]?0:1}intersectsPlane(t){let a=t[3],h=t[3];for(let p=0;p<3;p++)t[p]>0?(a+=t[p]*this.min[p],h+=t[p]*this.max[p]):(h+=t[p]*this.min[p],a+=t[p]*this.max[p]);return a>=0?2:h<0?0:1}}class mo{distanceToTile2d(t,a,h,p){const b=p.distanceX([t,a]),T=p.distanceY([t,a]);return Math.hypot(b,T)}getWrap(t,a,h){return h}getTileBoundingVolume(t,a,h,p){var b,T;let k=0,z=0;if(p?.terrain){const V=new c.a2(t.z,a,t.z,t.x,t.y),H=p.terrain.getMinMaxElevation(V);k=(b=H.minElevation)!==null&&b!==void 0?b:Math.min(0,h),z=(T=H.maxElevation)!==null&&T!==void 0?T:Math.max(0,h)}const F=1<<t.z;return new Si([a+t.x/F,t.y/F,k],[a+(t.x+1)/F,(t.y+1)/F,z])}allowVariableZoom(t,a){const h=t.fov*(Math.abs(Math.cos(t.rollInRadians))*t.height+Math.abs(Math.sin(t.rollInRadians))*t.width)/t.height,p=c.ao(78.5-h/2,0,60);return!!a.terrain||t.pitch>p}allowWorldCopies(){return!0}prepareNextFrame(){}}class Br{constructor(t,a,h){this.points=t,this.planes=a,this.aabb=h}static fromInvProjectionMatrix(t,a=1,h=0,p,b){const T=b?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],k=Math.pow(2,h),z=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((Y=>(function(J,ae,ge,ve){const ye=c.aI([],J,ae),be=1/ye[3]/ge*ve;return c.b7(ye,ye,[be,be,1/ye[3],be])})(Y,t,a,k)));p&&(function(Y,J,ae,ge){const ve=ge?4:0,ye=ge?0:4;let be=0;const De=[],we=[];for(let Ae=0;Ae<4;Ae++){const $e=c.b3([],Y[Ae+ye],Y[Ae+ve]),ht=c.b8($e);c.b0($e,$e,1/ht),De.push(ht),we.push($e)}for(let Ae=0;Ae<4;Ae++){const $e=c.b9(Y[Ae+ve],we[Ae],ae);be=$e!==null&&$e>=0?Math.max(be,$e):Math.max(be,De[Ae])}const Oe=(function(Ae,$e){const ht=c.b3([],Ae[$e[0]],Ae[$e[1]]),st=c.b3([],Ae[$e[2]],Ae[$e[1]]),ft=[0,0,0,0];return c.b4(ft,c.b5([],ht,st)),ft[3]=-c.b6(ft,Ae[$e[0]]),ft})(Y,J),je=(function(Ae,$e){const ht=c.ba(Ae),st=c.bb([],Ae,1/ht),ft=c.b3([],$e,c.b0([],st,c.b6($e,st))),pt=c.ba(ft);if(pt>0){const Dt=Math.sqrt(1-st[3]*st[3]),qt=c.b0([],st,-st[3]),Pt=c.b1([],qt,c.b0([],ft,Dt/pt));return c.bc($e,Pt)}return null})(ae,Oe);if(je!==null){const Ae=je/c.b6(we[0],Oe);be=Math.min(be,Ae)}for(let Ae=0;Ae<4;Ae++){const $e=Math.min(be,De[Ae]);Y[Ae+ye]=[Y[Ae+ve][0]+we[Ae][0]*$e,Y[Ae+ve][1]+we[Ae][1]*$e,Y[Ae+ve][2]+we[Ae][2]*$e,1]}})(z,T[0],p,b);const F=T.map((Y=>{const J=c.b3([],z[Y[0]],z[Y[1]]),ae=c.b3([],z[Y[2]],z[Y[1]]),ge=c.b4([],c.b5([],J,ae)),ve=-c.b6(ge,z[Y[1]]);return ge.concat(ve)})),V=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],H=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const Y of z)for(let J=0;J<3;J++)V[J]=Math.min(V[J],Y[J]),H[J]=Math.max(H[J],Y[J]);return new Br(z,F,new Si(V,H))}}class rr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,h){return this._helper.interpolatePadding(t,a,h)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,h=!0){this._helper.resize(t,a,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t,a){}constructor(t){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,h)=>{h=c.ao(+h,this.minZoom,this.maxZoom);const p={center:new c.V(a.lng,a.lat),zoom:h};let b=this._helper._lngRange;if(!this._helper._renderWorldCopies&&b===null){const we=179.9999999999;b=[-we,we]}const T=this.tileSize*c.ar(p.zoom);let k=0,z=T,F=0,V=T,H=0,Y=0;const{x:J,y:ae}=this.size;if(this._helper._latRange){const we=this._helper._latRange;k=c.X(we[1])*T,z=c.X(we[0])*T,z-k<ae&&(H=ae/(z-k))}b&&(F=c.W(c.Y(b[0])*T,0,T),V=c.W(c.Y(b[1])*T,0,T),V<F&&(V+=T),V-F<J&&(Y=J/(V-F)));const{x:ge,y:ve}=Qt(T,a);let ye,be;const De=Math.max(Y||0,H||0);if(De){const we=new c.P(Y?(V+F)/2:ge,H?(z+k)/2:ve);return p.center=yn(T,we).wrap(),p.zoom+=c.au(De),p}if(this._helper._latRange){const we=ae/2;ve-we<k&&(be=k+we),ve+we>z&&(be=z-we)}if(b){const we=(F+V)/2;let Oe=ge;this._helper._renderWorldCopies&&(Oe=c.W(ge,we-T/2,we+T/2));const je=J/2;Oe-je<F&&(ye=F+je),Oe+je>V&&(ye=V-je)}if(ye!==void 0||be!==void 0){const we=new c.P(ye??ge,be??ve);p.center=yn(T,we).wrap()}return p},this.applyConstrain=(a,h)=>this._helper.applyConstrain(a,h),this._helper=new Xs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,h)=>this.defaultConstrain(a,h)},t),this._coveringTilesDetailsProvider=new mo}clone(){const t=new rr;return t.apply(this),t}apply(t,a,h){this._helper.apply(t,a,h)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(t){const a=[new c.bd(0,t)];if(this._helper._renderWorldCopies){const h=this.screenPointToMercatorCoordinate(new c.P(0,0)),p=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,0)),b=this.screenPointToMercatorCoordinate(new c.P(this._helper._width,this._helper._height)),T=this.screenPointToMercatorCoordinate(new c.P(0,this._helper._height)),k=Math.floor(Math.min(h.x,p.x,b.x,T.x)),z=Math.floor(Math.max(h.x,p.x,b.x,T.x)),F=1;for(let V=k-F;V<=z+F;V++)V!==0&&a.push(new c.bd(V,t))}return a}getCameraFrustum(){return Br.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){const a=this.screenPointToLocation(this.centerPoint,t),h=t?t.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(h)}setLocationAtPoint(t,a){const h=c.at(this.elevation,this.center.lat),p=this.screenPointToMercatorCoordinateAtZ(a,h),b=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,h),T=c.ab.fromLngLat(t),k=new c.ab(T.x-(p.x-b.x),T.y-(p.y-b.y));this.setCenter(k?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(t,a){return a?this.coordinatePoint(c.ab.fromLngLat(t),a.getElevationForLngLat(t),this._pixelMatrix3D):this.coordinatePoint(c.ab.fromLngLat(t))}screenPointToLocation(t,a){var h;return(h=this.screenPointToMercatorCoordinate(t,a))===null||h===void 0?void 0:h.toLngLat()}screenPointToMercatorCoordinate(t,a){if(a){const h=a.pointCoordinate(t);if(h!=null)return h}return this.screenPointToMercatorCoordinateAtZ(t)}screenPointToMercatorCoordinateAtZ(t,a){const h=a||0,p=[t.x,t.y,0,1],b=[t.x,t.y,1,1];c.aI(p,p,this._pixelMatrixInverse),c.aI(b,b,this._pixelMatrixInverse);const T=p[3],k=b[3],z=p[1]/T,F=b[1]/k,V=p[2]/T,H=b[2]/k,Y=V===H?0:(h-V)/(H-V);return new c.ab(c.G.number(p[0]/T,b[0]/k,Y)/this.worldSize,c.G.number(z,F,Y)/this.worldSize,h)}coordinatePoint(t,a=0,h=this._pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,a,1];return c.aI(p,p,h),new c.P(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this._helper._height/2-zn(this));return new Ri().extend(this.screenPointToLocation(new c.P(0,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,t))).extend(this.screenPointToLocation(new c.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new c.P(0,this._helper._height)))}isPointOnMapSurface(t,a){return a?a.pointCoordinate(t)!=null:t.y>this.height/2-zn(this)}calculatePosMatrix(t,a=!1,h){var p;const b=(p=t.key)!==null&&p!==void 0?p:c.be(t.wrap,t.canonical.z,t.canonical.z,t.canonical.x,t.canonical.y),T=a?this._alignedPosMatrixCache:this._posMatrixCache;if(T.has(b)){const F=T.get(b);return h?F.f32:F.f64}const k=Un(t,this.worldSize);c.S(k,a?this._alignedProjMatrix:this._viewProjMatrix,k);const z={f64:k,f32:new Float32Array(k)};return T.set(b,z),h?z.f32:z.f64}calculateFogMatrix(t){const a=t.key,h=this._fogMatrixCacheF32;if(h.has(a))return h.get(a);const p=Un(t,this.worldSize);return c.S(p,this._fogMatrix,p),h.set(a,new Float32Array(p)),h.get(a)}calculateCenterFromCameraLngLatAlt(t,a,h,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,h,p)}_calculateNearFarZIfNeeded(t,a,h){if(!this._helper.autoCalculateNearFarZ)return;const p=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),b=t-p*this._helper._pixelPerMeter/Math.cos(a),T=p<0?b:t,k=Math.PI/2+this.pitchInRadians,z=c.aq(this.fov)*(Math.abs(Math.cos(c.aq(this.roll)))*this.height+Math.abs(Math.sin(c.aq(this.roll)))*this.width)/this.height*(.5+h.y/this.height),F=Math.sin(z)*T/Math.sin(c.ao(Math.PI-k-z,.01,Math.PI-.01)),V=zn(this),H=Math.atan(V/this._helper.cameraToCenterDistance),Y=c.aq(.75),J=H>Y?2*H*(.5+h.y/(2*V)):Y,ae=Math.sin(J)*T/Math.sin(c.ao(Math.PI-k-J,.01,Math.PI-.01)),ge=Math.min(F,ae);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*ge+T),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const t=this.centerOffset,a=Qt(this.worldSize,this.center),h=a.x,p=a.y;this._helper._pixelPerMeter=c.at(1,this.center.lat)*this.worldSize;const b=c.aq(Math.min(this.pitch,Wt)),T=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(b));let k;this._calculateNearFarZIfNeeded(T,b,t),k=new Float64Array(16),c.bf(k,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),c.aC(this._invProjMatrix,k),k[8]=2*-t.x/this._helper._width,k[9]=2*t.y/this._helper._height,this._projectionMatrix=c.bg(k),c.Q(k,k,[1,-1,1]),c.O(k,k,[0,0,-this._helper.cameraToCenterDistance]),c.bh(k,k,-this.rollInRadians),c.bi(k,k,this.pitchInRadians),c.bh(k,k,-this.bearingInRadians),c.O(k,k,[-h,-p,0]),this._mercatorMatrix=c.Q([],k,[this.worldSize,this.worldSize,this.worldSize]),c.Q(k,k,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,k),c.O(k,k,[0,0,-this.elevation]),this._viewProjMatrix=k,this._invViewProjMatrix=c.aC([],k);const z=[0,0,-1,1];c.aI(z,z,this._invViewProjMatrix),this._cameraPosition=[z[0]/z[3],z[1]/z[3],z[2]/z[3]],this._fogMatrix=new Float64Array(16),c.bf(this._fogMatrix,this.fovInRadians,this.width/this.height,T,this._helper._farZ),this._fogMatrix[8]=2*-t.x/this.width,this._fogMatrix[9]=2*t.y/this.height,c.Q(this._fogMatrix,this._fogMatrix,[1,-1,1]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),c.bh(this._fogMatrix,this._fogMatrix,-this.rollInRadians),c.bi(this._fogMatrix,this._fogMatrix,this.pitchInRadians),c.bh(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),c.O(this._fogMatrix,this._fogMatrix,[-h,-p,0]),c.Q(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),c.O(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=c.S(new Float64Array(16),this.clipSpaceToPixelsMatrix,k);const F=this._helper._width%2/2,V=this._helper._height%2/2,H=Math.cos(this.bearingInRadians),Y=Math.sin(-this.bearingInRadians),J=h-Math.round(h)+H*F+Y*V,ae=p-Math.round(p)+H*V+Y*F,ge=new Float64Array(k);if(c.O(ge,ge,[J>.5?J-1:J,ae>.5?ae-1:ae,0]),this._alignedProjMatrix=ge,k=c.aC(new Float64Array(16),this._pixelMatrix),!k)throw new Error("failed to invert matrix");this._pixelMatrixInverse=k,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const t=this.screenPointToMercatorCoordinate(new c.P(0,0)),a=[t.x*this.worldSize,t.y*this.worldSize,0,1];return c.aI(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const t=c.at(1,this.center.lat)*this.worldSize;return it(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/t).toLngLat()}lngLatToCameraDepth(t,a){const h=c.ab.fromLngLat(t),p=[h.x*this.worldSize,h.y*this.worldSize,a,1];return c.aI(p,p,this._viewProjMatrix),p[2]/p[3]}getProjectionData(t){const{overscaledTileID:a,aligned:h,applyTerrainMatrix:p}=t,b=this._helper.getMercatorTileCoordinates(a),T=a?this.calculatePosMatrix(a,h,!0):null;let k;return k=a&&a.terrainRttPosMatrix32f&&p?a.terrainRttPosMatrix32f:T||c.bj(),{mainMatrix:k,tileMercatorCoords:b,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:k}}isLocationOccluded(t){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(t,a,h){return 1}transformLightDirection(t){return c.b2(t)}getRayDirectionFromPixel(t){throw new Error("Not implemented.")}projectTileCoordinates(t,a,h,p){const b=this.calculatePosMatrix(h);let T;p?(T=[t,a,p(t,a),1],c.aI(T,T,b)):(T=[t,a,0,1],qa(T,T,b));const k=T[3];return{point:new c.P(T[0]/k,T[1]/k),signedDistanceFromCamera:k,isOccluded:!1}}populateCache(t){for(const a of t)this.calculatePosMatrix(a)}getMatrixForModel(t,a){const h=c.ab.fromLngLat(t,a),p=h.meterInMercatorCoordinateUnits(),b=c.bk();return c.O(b,b,[h.x,h.y,h.z]),c.bh(b,b,Math.PI),c.bi(b,b,Math.PI/2),c.Q(b,b,[-p,p,p]),b}getProjectionDataForCustomLayer(t=!0){const a=new c.a2(0,0,0,0,0),h=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:t}),p=Un(a,this.worldSize);c.S(p,this._viewProjMatrix,p),h.tileMercatorCoords=[0,0,1,1];const b=[c.a5,c.a5,this.worldSize/this._helper.pixelsPerMeter],T=c.bl();return c.Q(T,p,b),h.fallbackMatrix=T,h.mainMatrix=T,h}getFastPathSimpleProjectionMatrix(t){return this.calculatePosMatrix(t)}}function Qr(){c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function ru(v){if(v.useSlerp)if(v.k<1){const t=c.bm(v.startEulerAngles.roll,v.startEulerAngles.pitch,v.startEulerAngles.bearing),a=c.bm(v.endEulerAngles.roll,v.endEulerAngles.pitch,v.endEulerAngles.bearing),h=new Float64Array(4);c.bn(h,t,a,v.k);const p=c.bo(h);v.tr.setRoll(p.roll),v.tr.setPitch(p.pitch),v.tr.setBearing(p.bearing)}else v.tr.setRoll(v.endEulerAngles.roll),v.tr.setPitch(v.endEulerAngles.pitch),v.tr.setBearing(v.endEulerAngles.bearing);else v.tr.setRoll(c.G.number(v.startEulerAngles.roll,v.endEulerAngles.roll,v.k)),v.tr.setPitch(c.G.number(v.startEulerAngles.pitch,v.endEulerAngles.pitch,v.k)),v.tr.setBearing(c.G.number(v.startEulerAngles.bearing,v.endEulerAngles.bearing,v.k))}function go(v,t,a,h,p){const b=p.padding,T=Qt(p.worldSize,a.getNorthWest()),k=Qt(p.worldSize,a.getNorthEast()),z=Qt(p.worldSize,a.getSouthEast()),F=Qt(p.worldSize,a.getSouthWest()),V=c.aq(-h),H=T.rotate(V),Y=k.rotate(V),J=z.rotate(V),ae=F.rotate(V),ge=new c.P(Math.max(H.x,Y.x,ae.x,J.x),Math.max(H.y,Y.y,ae.y,J.y)),ve=new c.P(Math.min(H.x,Y.x,ae.x,J.x),Math.min(H.y,Y.y,ae.y,J.y)),ye=ge.sub(ve),be=(p.width-(b.left+b.right+t.left+t.right))/ye.x,De=(p.height-(b.top+b.bottom+t.top+t.bottom))/ye.y;if(De<0||be<0)return void Qr();const we=Math.min(c.au(p.scale*Math.min(be,De)),v.maxZoom),Oe=c.P.convert(v.offset),je=new c.P((t.left-t.right)/2,(t.top-t.bottom)/2).rotate(c.aq(h)),Ae=Oe.add(je).mult(p.scale/c.ar(we));return{center:yn(p.worldSize,T.add(z).div(2).sub(Ae)),zoom:we,bearing:h}}class ha{get useGlobeControls(){return!1}handlePanInertia(t,a){const h=t.mag(),p=Math.abs(zn(a));return{easingOffset:t.mult(Math.min(.75*p/h,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(t,a){t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta),t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta)}handleMapControlsPan(t,a,h){t.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(h,t.around)}cameraForBoxAndBearing(t,a,h,p,b){return go(t,a,h,p,b)}handleJumpToCenterZoom(t,a){t.zoom!==(a.zoom!==void 0?+a.zoom:t.zoom)&&t.setZoom(+a.zoom),a.center!==void 0&&t.setCenter(c.V.convert(a.center))}handleEaseTo(t,a){const h=t.zoom,p=t.padding,b={roll:t.roll,pitch:t.pitch,bearing:t.bearing},T={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},k=a.zoom!==void 0,z=!t.isPaddingEqual(a.padding);let F=!1;const V=k?+a.zoom:t.zoom;let H=t.centerPoint.add(a.offsetAsPoint);const Y=t.screenPointToLocation(H),{center:J,zoom:ae}=t.applyConstrain(c.V.convert(a.center||Y),V??h);hs(t,J);const ge=Qt(t.worldSize,Y),ve=Qt(t.worldSize,J).sub(ge),ye=c.ar(ae-h);return F=ae!==h,{easeFunc:be=>{if(F&&t.setZoom(c.G.number(h,ae,be)),c.bp(b,T)||ru({startEulerAngles:b,endEulerAngles:T,tr:t,k:be,useSlerp:b.roll!=T.roll}),z&&(t.interpolatePadding(p,a.padding,be),H=t.centerPoint.add(a.offsetAsPoint)),a.around)t.setLocationAtPoint(a.around,a.aroundPoint);else{const De=c.ar(t.zoom-h),we=ae>h?Math.min(2,ye):Math.max(.5,ye),Oe=Math.pow(we,1-be),je=yn(t.worldSize,ge.add(ve.mult(be*Oe)).mult(De));t.setLocationAtPoint(t.renderWorldCopies?je.wrap():je,H)}},isZooming:F,elevationCenter:J}}handleFlyTo(t,a){const h=a.zoom!==void 0,p=t.zoom,b=t.applyConstrain(c.V.convert(a.center||a.locationAtOffset),h?+a.zoom:p),T=b.center,k=b.zoom;hs(t,T);const z=Qt(t.worldSize,a.locationAtOffset),F=Qt(t.worldSize,T).sub(z),V=F.mag(),H=c.ar(k-p);let Y;if(a.minZoom!==void 0){const J=Math.min(+a.minZoom,p,k),ae=t.applyConstrain(T,J).zoom;Y=c.ar(ae-p)}return{easeFunc:(J,ae,ge,ve)=>{t.setZoom(J===1?k:p+c.au(ae));const ye=J===1?T:yn(t.worldSize,z.add(F.mult(ge)).mult(ae));t.setLocationAtPoint(t.renderWorldCopies?ye.wrap():ye,ve)},scaleOfZoom:H,targetCenter:T,scaleOfMinZoom:Y,pixelPathLength:V}}}class Qn{constructor(t,a,h){this.blendFunction=t,this.blendColor=a,this.mask=h}}Qn.Replace=[1,0],Qn.disabled=new Qn(Qn.Replace,c.bq.transparent,[!1,!1,!1,!1]),Qn.unblended=new Qn(Qn.Replace,c.bq.transparent,[!0,!0,!0,!0]),Qn.alphaBlended=new Qn([1,771],c.bq.transparent,[!0,!0,!0,!0]);const _o=2305;class Tn{constructor(t,a,h){this.enable=t,this.mode=a,this.frontFace=h}}Tn.disabled=new Tn(!1,1029,_o),Tn.backCCW=new Tn(!0,1029,_o),Tn.frontCCW=new Tn(!0,1028,_o);class bn{constructor(t,a,h){this.func=t,this.mask=a,this.range=h}}bn.ReadOnly=!1,bn.ReadWrite=!0,bn.disabled=new bn(519,bn.ReadOnly,[0,1]);const Yo=7680;class On{constructor(t,a,h,p,b,T){this.test=t,this.ref=a,this.mask=h,this.fail=p,this.depthFail=b,this.pass=T}}On.disabled=new On({func:519,mask:0},0,0,Yo,Yo,Yo);const Tl=new WeakMap;function Fr(v){var t;if(Tl.has(v))return Tl.get(v);{const a=(t=v.getParameter(v.VERSION))===null||t===void 0?void 0:t.startsWith("WebGL 2.0");return Tl.set(v,a),a}}class yo{get awaitingQuery(){return!!this._readbackQueue}constructor(t){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=t;const a=t.context,h=a.gl;this._texFormat=h.RGBA,this._texType=h.UNSIGNED_BYTE;const p=new c.aX;p.emplaceBack(-1,-1),p.emplaceBack(2,-1),p.emplaceBack(-1,2);const b=new c.aZ;b.emplaceBack(0,1,2),this._fullscreenTriangle=new ei(a.createVertexBuffer(p,Ha.members),a.createIndexBuffer(b),c.aY.simpleSegment(0,0,p.length,b.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(h.TEXTURE1);const T=h.createTexture();h.bindTexture(h.TEXTURE_2D,T),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.NEAREST),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.NEAREST),h.texImage2D(h.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(T),Fr(h)&&(this._pbo=h.createBuffer(),h.bindBuffer(h.PIXEL_PACK_BUFFER,this._pbo),h.bufferData(h.PIXEL_PACK_BUFFER,4,h.STREAM_READ),h.bindBuffer(h.PIXEL_PACK_BUFFER,null))}destroy(){const t=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),t.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(t,a){const h=this._updateCount;return this._readbackQueue?h>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():h>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(t,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const t=this._cachedRenderContext.context,a=t.gl;t.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),t.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(t,a){const h=this._cachedRenderContext.context,p=h.gl;if(this._bindFramebuffer(),h.viewport.set([0,0,this._texWidth,this._texHeight]),h.clear({color:c.bq.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(h,p.TRIANGLES,bn.disabled,On.disabled,Qn.unblended,Tn.disabled,((b,T)=>({u_input:b,u_output_expected:T}))(t,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&Fr(p)){p.bindBuffer(p.PIXEL_PACK_BUFFER,this._pbo),p.readBuffer(p.COLOR_ATTACHMENT0),p.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),p.bindBuffer(p.PIXEL_PACK_BUFFER,null);const b=p.fenceSync(p.SYNC_GPU_COMMANDS_COMPLETE,0);p.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:b}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const t=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&Fr(t)){const a=t.clientWaitSync(this._readbackQueue.sync,0,0);if(a===t.WAIT_FAILED)return c.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===t.TIMEOUT_EXPIRED)return;t.bindBuffer(t.PIXEL_PACK_BUFFER,this._pbo),t.getBufferSubData(t.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),t.bindBuffer(t.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),t.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=yo._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(t){let a=0;return a+=t[0]/256,a+=t[1]/65536,a+=t[2]/16777216,t[3]<127&&(a=-a),a/128}}const jr=c.a5/128;function Oc(v,t){const a=v.granularity!==void 0?Math.max(v.granularity,1):1,h=a+(v.generateBorders?2:0),p=a+(v.extendToNorthPole||v.generateBorders?1:0)+(v.extendToSouthPole||v.generateBorders?1:0),b=h+1,T=p+1,k=v.generateBorders?-1:0,z=v.generateBorders||v.extendToNorthPole?-1:0,F=a+(v.generateBorders?1:0),V=a+(v.generateBorders||v.extendToSouthPole?1:0),H=b*T,Y=h*p*6,J=b*T>65536;if(J&&t==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ae=J||t==="32bit",ge=new Int16Array(2*H);let ve=0;for(let De=z;De<=V;De++)for(let we=k;we<=F;we++){let Oe=we/a*c.a5;we===-1&&(Oe=-jr),we===a+1&&(Oe=c.a5+jr);let je=De/a*c.a5;De===-1&&(je=v.extendToNorthPole?c.bs:-jr),De===a+1&&(je=v.extendToSouthPole?c.bt:c.a5+jr),ge[ve++]=Oe,ge[ve++]=je}const ye=ae?new Uint32Array(Y):new Uint16Array(Y);let be=0;for(let De=0;De<p;De++)for(let we=0;we<h;we++){const Oe=we+1+De*b,je=we+(De+1)*b,Ae=we+1+(De+1)*b;ye[be++]=we+De*b,ye[be++]=je,ye[be++]=Oe,ye[be++]=Oe,ye[be++]=je,ye[be++]=Ae}return{vertices:ge.buffer.slice(0),indices:ye.buffer.slice(0),uses32bitIndices:ae}}const au=new c.aW({fill:new c.bu(128,2),line:new c.bu(512,0),tile:new c.bu(128,32),stencil:new c.bu(128,1),circle:3});class Nc{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return Di.projectionGlobe}get vertexShaderPreludeCode(){return Di.projectionMercator.vertexSource}get subdivisionGranularity(){return au}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(t){this._errorMeasurement||(this._errorMeasurement=new yo(t));const a=c.X(this._errorQueryLatitudeDegrees),h=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,p=this._errorMeasurement.updateErrorLoop(a,h),b=dt();p!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=p,this._errorMeasurementLastChangeTime=b);const T=Math.min(Math.max((b-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=c.bv(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,c.bw(T))}_getMeshKey(t){return`${t.granularity.toString(36)}_${t.generateBorders?"b":""}${t.extendToNorthPole?"n":""}${t.extendToSouthPole?"s":""}`}getMeshFromTileID(t,a,h,p,b){const T=(b==="stencil"?au.stencil:au.tile).getGranularityForZoomLevel(a.z);return this._getMesh(t,{granularity:T,generateBorders:h,extendToNorthPole:a.y===0&&p,extendToSouthPole:a.y===(1<<a.z)-1&&p})}_getMesh(t,a){const h=this._getMeshKey(a);if(h in this._tileMeshCache)return this._tileMeshCache[h];const p=(function(b,T){const k=Oc(T,"16bit"),z=c.aX.deserialize({arrayBuffer:k.vertices,length:k.vertices.byteLength/2/2}),F=c.aZ.deserialize({arrayBuffer:k.indices,length:k.indices.byteLength/2/3});return new ei(b.createVertexBuffer(z,Ha.members),b.createIndexBuffer(F),c.aY.simpleSegment(0,0,z.length,F.length))})(t,a);return this._tileMeshCache[h]=p,p}recalculate(t){}hasTransition(){const t=dt();let a=!1;return a=a||(t-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(t){this._errorQueryLatitudeDegrees=t}}const If=new c.t({type:new c.D(c.u.projection.type)});class Bc extends c.E{constructor(t){super(),this._transitionable=new c.x(If,void 0),this.setProjection(t),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new c.H(0)),this._mercatorProjection=new mi,this._verticalPerspectiveProjection=new Nc}get transitionState(){const t=this.properties.get("type");if(typeof t=="string"&&t==="mercator")return 0;if(typeof t=="string"&&t==="vertical-perspective")return 1;if(t instanceof c.bx){if(t.from==="vertical-perspective"&&t.to==="mercator")return 1-t.transition;if(t.from==="mercator"&&t.to==="vertical-perspective")return t.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(t){this._mercatorProjection.updateGPUdependent(t),this._verticalPerspectiveProjection.updateGPUdependent(t)}getMeshFromTileID(t,a,h,p,b){return this.currentProjection.getMeshFromTileID(t,a,h,p,b)}setProjection(t){this._transitionable.setValue("type",t?.type||"mercator")}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}setErrorQueryLatitudeDegrees(t){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(t),this._mercatorProjection.setErrorQueryLatitudeDegrees(t)}}function fa(v){const t=Ra(v.worldSize,v.center.lat);return 2*Math.PI*t}function Ds(v,t,a,h,p){const b=1/(1<<p),T=t/c.a5*b+h*b,k=c.bz((v/c.a5*b+a*b)*Math.PI*2+Math.PI,2*Math.PI),z=2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI,F=Math.cos(z),V=new Float64Array(3);return V[0]=Math.sin(k)*F,V[1]=Math.sin(z),V[2]=Math.cos(k)*F,V}function Li(v){return(function(t,a){const h=Math.cos(a),p=new Float64Array(3);return p[0]=Math.sin(t)*h,p[1]=Math.sin(a),p[2]=Math.cos(t)*h,p})(v.lng*Math.PI/180,v.lat*Math.PI/180)}function Ra(v,t){return v/(2*Math.PI)/Math.cos(t*Math.PI/180)}function Ur(v){const t=Math.asin(v[1])/Math.PI*180,a=Math.sqrt(v[0]*v[0]+v[2]*v[2]);if(a>1e-6){const h=v[0]/a,p=Math.acos(v[2]/a),b=(h>0?p:-p)/Math.PI*180;return new c.V(c.W(b,-180,180),t)}return new c.V(0,t)}function su(v){return Math.cos(v*Math.PI/180)}function Bi(v,t){const a=su(v),h=su(t);return c.au(h/a)}function Mh(v,t){const a=v.rotate(t.bearingInRadians),h=t.zoom+Bi(t.center.lat,0),p=c.bv(1/su(t.center.lat),1/su(Math.min(Math.abs(t.center.lat),60)),c.by(h,7,3,0,1)),b=360/fa({worldSize:t.worldSize,center:{lat:t.center.lat}});return new c.V(t.center.lng-a.x*b*p,c.ao(t.center.lat+a.y*b,-c.ap,c.ap))}function Sl(v){const t=.5*v,a=Math.sin(t),h=Math.cos(t);return Math.log(a+h)-Math.log(h-a)}function Fc(v,t,a,h){const p=v.lat+a*h;if(Math.abs(a)>1){const b=(Math.sign(v.lat+a)!==Math.sign(v.lat)?-Math.abs(v.lat):Math.abs(v.lat))*Math.PI/180,T=Math.abs(v.lat+a)*Math.PI/180,k=Sl(b+h*(T-b)),z=Sl(b),F=Sl(T);return new c.V(v.lng+t*((k-z)/(F-z)),p)}return new c.V(v.lng+t*h,p)}class jc{constructor(t){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=t}swapBuffers(){if(!this._hadAnyChanges)return;const t=this._cachePrevious;this._cachePrevious=this._cache,this._cache=t,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(t,a,h,p){const b=`${t.z}_${t.x}_${t.y}_${p?.terrain?"t":""}`,T=this._cache.get(b);if(T)return T;const k=this._cachePrevious.get(b);if(k)return this._cache.set(b,k),k;const z=this._boundingVolumeFactory(t,a,h,p);return this._cache.set(b,z),this._hadAnyChanges=!0,z}}class Ho{constructor(t,a,h,p){this.min=h,this.max=p,this.points=t,this.planes=a}static fromAabb(t,a){const h=[];for(let p=0;p<8;p++)h.push([1&~p?t[0]:a[0],(p>>1&1)==1?a[1]:t[1],(p>>2&1)==1?a[2]:t[2]]);return new Ho(h,[[-1,0,0,a[0]],[1,0,0,-t[0]],[0,-1,0,a[1]],[0,1,0,-t[1]],[0,0,-1,a[2]],[0,0,1,-t[2]]],t,a)}static fromCenterSizeAngles(t,a,h){const p=c.bC([],h[0],h[1],h[2]),b=c.bD([],[a[0],0,0],p),T=c.bD([],[0,a[1],0],p),k=c.bD([],[0,0,a[2]],p),z=[...t],F=[...t];for(let H=0;H<8;H++)for(let Y=0;Y<3;Y++){const J=t[Y]+b[Y]*(1&~H?-1:1)+T[Y]*((H>>1&1)==1?1:-1)+k[Y]*((H>>2&1)==1?1:-1);z[Y]=Math.min(z[Y],J),F[Y]=Math.max(F[Y],J)}const V=[];for(let H=0;H<8;H++){const Y=[...t];c.b1(Y,Y,c.b0([],b,1&~H?-1:1)),c.b1(Y,Y,c.b0([],T,(H>>1&1)==1?1:-1)),c.b1(Y,Y,c.b0([],k,(H>>2&1)==1?1:-1)),V.push(Y)}return new Ho(V,[[...b,-c.b6(b,V[0])],[...T,-c.b6(T,V[0])],[...k,-c.b6(k,V[0])],[-b[0],-b[1],-b[2],-c.b6(b,V[7])],[-T[0],-T[1],-T[2],-c.b6(T,V[7])],[-k[0],-k[1],-k[2],-c.b6(k,V[7])]],z,F)}intersectsFrustum(t){let a=!0;const h=this.points.length,p=this.planes.length,b=t.planes.length,T=t.points.length;for(let k=0;k<b;k++){const z=t.planes[k];let F=0;for(let V=0;V<h;V++){const H=this.points[V];z[0]*H[0]+z[1]*H[1]+z[2]*H[2]+z[3]>=0&&F++}if(F===0)return 0;F<h&&(a=!1)}if(a)return 2;for(let k=0;k<p;k++){const z=this.planes[k];let F=0;for(let V=0;V<T;V++){const H=t.points[V];z[0]*H[0]+z[1]*H[1]+z[2]*H[2]+z[3]>=0&&F++}if(F===0)return 0}return 1}intersectsPlane(t){const a=this.points.length;let h=0;for(let p=0;p<a;p++){const b=this.points[p];t[0]*b[0]+t[1]*b[1]+t[2]*b[2]+t[3]>=0&&h++}return h===a?2:h===0?0:1}}function va(v,t,a){const h=v-t;return h<0?-h:Math.max(0,h-a)}function Xo(v,t,a,h,p){const b=v-a;let T;return T=b<0?Math.min(-b,1+b-p):b>1?Math.min(Math.max(b-p,0),1-b):0,Math.max(T,va(t,h,p))}class da{constructor(){this._boundingVolumeCache=new jc(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(t,a,h,p){const b=1<<h.z,T=1/b,k=h.x/b,z=h.y/b;let F=2;return F=Math.min(F,Xo(t,a,k,z,T)),F=Math.min(F,Xo(t,a,k+.5,-z-T,T)),F=Math.min(F,Xo(t,a,k+.5,2-z-T,T)),F}getWrap(t,a,h){const p=1<<a.z,b=1/p,T=a.x/p,k=va(t.x,T,b),z=va(t.x,T-1,b),F=va(t.x,T+1,b),V=Math.min(k,z,F);return V===F?1:V===z?-1:0}allowVariableZoom(t,a){return Kn(t,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(t,a,h,p){return this._boundingVolumeCache.getTileBoundingVolume(t,a,h,p)}_computeTileBoundingVolume(t,a,h,p){var b,T;let k=0,z=0;if(p?.terrain){const F=new c.a2(t.z,a,t.z,t.x,t.y),V=p.terrain.getMinMaxElevation(F);k=(b=V.minElevation)!==null&&b!==void 0?b:Math.min(0,h),z=(T=V.maxElevation)!==null&&T!==void 0?T:Math.max(0,h)}if(k/=c.bF,z/=c.bF,k+=1,z+=1,t.z<=0)return Ho.fromAabb([-z,-z,-z],[z,z,z]);if(t.z===1)return Ho.fromAabb([t.x===0?-z:0,t.y===0?0:-z,-z],[t.x===0?0:z,t.y===0?z:0,z]);{const F=[Ds(0,0,t.x,t.y,t.z),Ds(c.a5,0,t.x,t.y,t.z),Ds(c.a5,c.a5,t.x,t.y,t.z),Ds(0,c.a5,t.x,t.y,t.z)],V=[];for(const ft of F)V.push(c.b0([],ft,z));if(z!==k)for(const ft of F)V.push(c.b0([],ft,k));t.y===0&&V.push([0,1,0]),t.y===(1<<t.z)-1&&V.push([0,-1,0]);const H=[1,1,1],Y=[-1,-1,-1];for(const ft of V)for(let pt=0;pt<3;pt++)H[pt]=Math.min(H[pt],ft[pt]),Y[pt]=Math.max(Y[pt],ft[pt]);const J=Ds(c.a5/2,c.a5/2,t.x,t.y,t.z),ae=c.b5([],[0,1,0],J);c.b4(ae,ae);const ge=c.b5([],J,ae);c.b4(ge,ge);const ve=c.b5([],F[2],F[1]);c.b4(ve,ve);const ye=c.b5([],F[0],F[3]);c.b4(ye,ye),V.push(c.b0([],J,z)),t.y>=(1<<t.z)/2&&V.push(c.b0([],Ds(c.a5/2,0,t.x,t.y,t.z),z)),t.y<(1<<t.z)/2&&V.push(c.b0([],Ds(c.a5/2,c.a5,t.x,t.y,t.z),z));const be=$s(J,V),De=$s(ge,V),we=[-J[0],-J[1],-J[2],be.max],Oe=[J[0],J[1],J[2],-be.min],je=[-ge[0],-ge[1],-ge[2],De.max],Ae=[ge[0],ge[1],ge[2],-De.min],$e=[...ve,0],ht=[...ye,0],st=[];return t.y===0?st.push(c.bE(ht,$e,we),c.bE(ht,$e,Oe)):st.push(c.bE(je,$e,we),c.bE(je,$e,Oe),c.bE(je,ht,we),c.bE(je,ht,Oe)),t.y===(1<<t.z)-1?st.push(c.bE(ht,$e,we),c.bE(ht,$e,Oe)):st.push(c.bE(Ae,$e,we),c.bE(Ae,$e,Oe),c.bE(Ae,ht,we),c.bE(Ae,ht,Oe)),new Ho(st,[we,Oe,je,Ae,$e,ht],H,Y)}}}function $s(v,t){let a=1/0,h=-1/0;for(const p of t){const b=c.b6(v,p);a=Math.min(a,b),h=Math.max(h,b)}return{min:a,max:h}}class El{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,h){return this._helper.interpolatePadding(t,a,h)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a){this._helper.resize(t,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(t){}constructor(t){this._cachedClippingPlane=c.bG(),this._projectionMatrix=c.bk(),this._globeViewProjMatrix32f=c.bj(),this._globeViewProjMatrixNoCorrection=c.bk(),this._globeViewProjMatrixNoCorrectionInverted=c.bk(),this._globeProjMatrixInverted=c.bk(),this._cameraPosition=c.bA(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,h)=>{const p=c.ao(a.lat,-c.ap,c.ap),b=c.ao(+h,this.minZoom+Bi(0,p),this.maxZoom);return{center:new c.V(a.lng,p),zoom:b}},this.applyConstrain=(a,h)=>this._helper.applyConstrain(a,h),this._helper=new Xs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,h)=>this.defaultConstrain(a,h)},t),this._coveringTilesDetailsProvider=new da}clone(){const t=new El;return t.apply(this),t}apply(t,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(t)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const t=c.bA();return t[0]=this._cameraPosition[0],t[1]=this._cameraPosition[1],t[2]=this._cameraPosition[2],t}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(t){const{overscaledTileID:a,applyGlobeMatrix:h}=t,p=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:p,clippingPlane:this._cachedClippingPlane,projectionTransition:h?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(t){const a=this.pitchInRadians,h=this.cameraToCenterDistance/t,p=Math.sin(a)*h,b=Math.cos(a)*h+1,T=1/Math.sqrt(p*p+b*b)*1;let k=-p,z=b;const F=Math.sqrt(k*k+z*z);k/=F,z/=F;const V=[0,k,z];c.bH(V,V,[0,0,0],-this.bearingInRadians),c.bI(V,V,[0,0,0],-1*this.center.lat*Math.PI/180),c.bJ(V,V,[0,0,0],this.center.lng*Math.PI/180);const H=1/c.b8(V);return c.b0(V,V,H),[...V,-T*H]}isLocationOccluded(t){return!this.isSurfacePointVisible(Li(t))}transformLightDirection(t){const a=this._helper._center.lng*Math.PI/180,h=this._helper._center.lat*Math.PI/180,p=Math.cos(h),b=[Math.sin(a)*p,Math.sin(h),Math.cos(a)*p],T=[b[2],0,-b[0]],k=[0,0,0];c.b5(k,T,b),c.b4(T,T),c.b4(k,k);const z=[0,0,0];return c.b4(z,[T[0]*t[0]+k[0]*t[1]+b[0]*t[2],T[1]*t[0]+k[1]*t[1]+b[1]*t[2],T[2]*t[0]+k[2]*t[1]+b[2]*t[2]]),z}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(t,a,h){const p=(function(k,z,F){const V=1/(1<<F.z);return new c.ab(k/c.a5*V+F.x*V,z/c.a5*V+F.y*V)})(t,a,h.canonical),b=(T=p.y,[c.bz(p.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-T*Math.PI*2))-.5*Math.PI]);var T;return this.getCircleRadiusCorrection()/Math.cos(b[1])}projectTileCoordinates(t,a,h,p){const b=h.canonical,T=Ds(t,a,b.x,b.y,b.z),k=1+(p?p(t,a):0)/c.bF,z=[T[0]*k,T[1]*k,T[2]*k,1];c.aI(z,z,this._globeViewProjMatrixNoCorrection);const F=this._cachedClippingPlane,V=F[0]*T[0]+F[1]*T[1]+F[2]*T[2]+F[3]<0;return{point:new c.P(z[0]/z[3],z[1]/z[3]),signedDistanceFromCamera:z[3],isOccluded:V}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const t=Ra(this.worldSize,this.center.lat),a=c.bl(),h=c.bl();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*t),c.bf(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const p=this.centerOffset;a[8]=2*-p.x/this._helper._width,a[9]=2*p.y/this._helper._height,this._projectionMatrix=c.bg(a),this._globeProjMatrixInverted=c.bl(),c.aC(this._globeProjMatrixInverted,a),c.O(a,a,[0,0,-this.cameraToCenterDistance]),c.bh(a,a,this.rollInRadians),c.bi(a,a,-this.pitchInRadians),c.bh(a,a,this.bearingInRadians),c.O(a,a,[0,0,-t]);const b=c.bA();b[0]=t,b[1]=t,b[2]=t,c.bi(h,a,this.center.lat*Math.PI/180),c.bK(h,h,-this.center.lng*Math.PI/180),c.Q(h,h,b),this._globeViewProjMatrixNoCorrection=h,c.bi(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),c.bK(a,a,-this.center.lng*Math.PI/180),c.Q(a,a,b),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=c.bl(),c.aC(this._globeViewProjMatrixNoCorrectionInverted,h);const T=c.bA();this._cameraPosition=c.bA(),this._cameraPosition[2]=this.cameraToCenterDistance/t,c.bH(this._cameraPosition,this._cameraPosition,T,-this.rollInRadians),c.bI(this._cameraPosition,this._cameraPosition,T,this.pitchInRadians),c.bH(this._cameraPosition,this._cameraPosition,T,-this.bearingInRadians),c.b1(this._cameraPosition,this._cameraPosition,[0,0,1]),c.bI(this._cameraPosition,this._cameraPosition,T,-this.center.lat*Math.PI/180),c.bJ(this._cameraPosition,this._cameraPosition,T,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(t);const k=c.bg(this._globeViewProjMatrixNoCorrectionInverted);c.Q(k,k,[1,1,-1]),this._cachedFrustum=Br.fromInvProjectionMatrix(k,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(t){c.w("calculateFogMatrix is not supported on globe projection.");const a=c.bl();return c.as(a),a}getVisibleUnwrappedCoordinates(t){return[new c.bd(0,t)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(t){t&&c.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const h=Li(t);c.b0(h,h,1+a/c.bF);const p=c.bG();return c.aI(p,[h[0],h[1],h[2],1],this._globeViewProjMatrixNoCorrection),p[2]/p[3]}populateCache(t){}getBounds(){const t=.5*this.width,a=.5*this.height,h=[new c.P(0,0),new c.P(t,0),new c.P(this.width,0),new c.P(this.width,a),new c.P(this.width,this.height),new c.P(t,this.height),new c.P(0,this.height),new c.P(0,a)],p=[];for(const H of h)p.push(this.unprojectScreenPoint(H));let b=0,T=0,k=0,z=0;const F=this.center;for(const H of p){const Y=c.bL(F.lng,H.lng),J=c.bL(F.lat,H.lat);Y<T&&(T=Y),Y>b&&(b=Y),J<z&&(z=J),J>k&&(k=J)}const V=[F.lng+T,F.lat+z,F.lng+b,F.lat+k];return this.isSurfacePointOnScreen([0,1,0])&&(V[3]=90,V[0]=-180,V[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(V[1]=-90,V[0]=-180,V[2]=180),new Ri(V)}calculateCenterFromCameraLngLatAlt(t,a,h,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,h,p)}setLocationAtPoint(t,a){const h=Li(this.unprojectScreenPoint(a)),p=Li(t),b=c.bA();c.bM(b);const T=c.bA();c.bJ(T,h,b,-this.center.lng*Math.PI/180),c.bI(T,T,b,this.center.lat*Math.PI/180);const k=p[0]*p[0]+p[2]*p[2],z=T[0]*T[0];if(k<z)return;const F=Math.sqrt(k-z),V=-F,H=c.bN(p[0],p[2],T[0],F),Y=c.bN(p[0],p[2],T[0],V),J=c.bA();c.bJ(J,p,b,-H);const ae=c.bN(J[1],J[2],T[1],T[2]),ge=c.bA();c.bJ(ge,p,b,-Y);const ve=c.bN(ge[1],ge[2],T[1],T[2]),ye=.5*Math.PI,be=ae>=-ye&&ae<=ye,De=ve>=-ye&&ve<=ye;let we,Oe;if(be&&De){const ht=this.center.lng*Math.PI/180,st=this.center.lat*Math.PI/180;c.bO(H,ht)+c.bO(ae,st)<c.bO(Y,ht)+c.bO(ve,st)?(we=H,Oe=ae):(we=Y,Oe=ve)}else if(be)we=H,Oe=ae;else{if(!De)return;we=Y,Oe=ve}const je=we/Math.PI*180,Ae=Oe/Math.PI*180,$e=this.center.lat;this.setCenter(new c.V(je,c.ao(Ae,-90,90))),this.setZoom(this.zoom+Bi($e,this.center.lat))}locationToScreenPoint(t,a){const h=Li(t);if(a){const p=a.getElevationForLngLatZoom(t,this._helper._tileZoom);c.b0(h,h,1+p/c.bF)}return this._projectSurfacePointToScreen(h)}_projectSurfacePointToScreen(t){const a=c.bG();return c.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new c.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(t,a){if(a){const h=a.pointCoordinate(t);if(h)return h}return c.ab.fromLngLat(this.unprojectScreenPoint(t))}screenPointToLocation(t,a){var h;return(h=this.screenPointToMercatorCoordinate(t,a))===null||h===void 0?void 0:h.toLngLat()}isPointOnMapSurface(t,a){const h=this._cameraPosition,p=this.getRayDirectionFromPixel(t);return!!this.rayPlanetIntersection(h,p)}getRayDirectionFromPixel(t){const a=c.bG();a[0]=t.x/this.width*2-1,a[1]=-1*(t.y/this.height*2-1),a[2]=1,a[3]=1,c.aI(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const h=c.bA();h[0]=a[0]-this._cameraPosition[0],h[1]=a[1]-this._cameraPosition[1],h[2]=a[2]-this._cameraPosition[2];const p=c.bA();return c.b4(p,h),p}isSurfacePointVisible(t){const a=this._cachedClippingPlane;return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]+a[3]>=0}isSurfacePointOnScreen(t){if(!this.isSurfacePointVisible(t))return!1;const a=c.bG();return c.aI(a,[...t,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(t,a){const h=c.b6(t,a),p=c.bA(),b=c.bA();c.b0(b,a,h),c.b3(p,t,b);const T=1-c.b6(p,p);if(T<0)return null;const k=c.b6(t,t)-1,z=-h+(h<0?1:-1)*Math.sqrt(T),F=k/z,V=z;return{tMin:Math.min(F,V),tMax:Math.max(F,V)}}unprojectScreenPoint(t){const a=this._cameraPosition,h=this.getRayDirectionFromPixel(t),p=this.rayPlanetIntersection(a,h);if(p){const V=c.bA();c.b1(V,a,[h[0]*p.tMin,h[1]*p.tMin,h[2]*p.tMin]);const H=c.bA();return c.b4(H,V),Ur(H)}const b=this._cachedClippingPlane,T=b[0]*h[0]+b[1]*h[1]+b[2]*h[2],k=-c.bc(b,a)/T,z=c.bA();if(k>0)c.b1(z,a,[h[0]*k,h[1]*k,h[2]*k]);else{const V=c.bA();c.b1(V,a,[2*h[0],2*h[1],2*h[2]]);const H=c.bc(this._cachedClippingPlane,V);c.b3(z,V,[this._cachedClippingPlane[0]*H,this._cachedClippingPlane[1]*H,this._cachedClippingPlane[2]*H])}const F=(function(V){const H=c.bA();return H[0]=V[0]*-V[3],H[1]=V[1]*-V[3],H[2]=V[2]*-V[3],{center:H,radius:Math.sqrt(1-V[3]*V[3])}})(b);return Ur((function(V,H,Y){const J=c.bA();c.b3(J,Y,V);const ae=c.bA();return c.bB(ae,V,J,H/c.ba(J)),ae})(F.center,F.radius,z))}getMatrixForModel(t,a){const h=c.V.convert(t),p=1/c.bF,b=c.bk();return c.bK(b,b,h.lng/180*Math.PI),c.bi(b,b,-h.lat/180*Math.PI),c.O(b,b,[0,0,1+a/c.bF]),c.bi(b,b,.5*Math.PI),c.Q(b,b,[p,p,p]),b}getProjectionDataForCustomLayer(t=!0){const a=this.getProjectionData({overscaledTileID:new c.a2(0,0,0,0,0),applyGlobeMatrix:t});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(t){}}class $o{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(t){this._helper.setMinZoom(t)}setMaxZoom(t){this._helper.setMaxZoom(t)}setMinPitch(t){this._helper.setMinPitch(t)}setMaxPitch(t){this._helper.setMaxPitch(t)}setRenderWorldCopies(t){this._helper.setRenderWorldCopies(t)}setBearing(t){this._helper.setBearing(t)}setPitch(t){this._helper.setPitch(t)}setRoll(t){this._helper.setRoll(t)}setFov(t){this._helper.setFov(t)}setZoom(t){this._helper.setZoom(t)}setCenter(t){this._helper.setCenter(t)}setElevation(t){this._helper.setElevation(t)}setMinElevationForCurrentTile(t){this._helper.setMinElevationForCurrentTile(t)}setPadding(t){this._helper.setPadding(t)}interpolatePadding(t,a,h){return this._helper.interpolatePadding(t,a,h)}isPaddingEqual(t){return this._helper.isPaddingEqual(t)}resize(t,a,h=!0){this._helper.resize(t,a,h)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(t){this._helper.setMaxBounds(t)}setConstrainOverride(t){this._helper.setConstrainOverride(t)}overrideNearFarZ(t,a){this._helper.overrideNearFarZ(t,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(t){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),t)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrainOverride(){return this._helper.constrainOverride}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(t,a){this._globeness=t,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(t){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,h)=>this.currentTransform.defaultConstrain(a,h),this.applyConstrain=(a,h)=>this._helper.applyConstrain(a,h),this._helper=new Xs({calcMatrices:()=>{this._calcMatrices()},defaultConstrain:(a,h)=>this.defaultConstrain(a,h)},t),this._globeness=1,this._mercatorTransform=new rr,this._verticalPerspectiveTransform=new El}clone(){const t=new $o;return t._globeness=this._globeness,t._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,t.apply(this),t}apply(t){this._helper.apply(t),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(t){const a=this._mercatorTransform.getProjectionData(t),h=this._verticalPerspectiveTransform.getProjectionData(t);return{mainMatrix:this.isGlobeRendering?h.mainMatrix:a.mainMatrix,clippingPlane:h.clippingPlane,tileMercatorCoords:h.tileMercatorCoords,projectionTransition:t.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(t){return this.currentTransform.isLocationOccluded(t)}transformLightDirection(t){return this.currentTransform.transformLightDirection(t)}getPixelScale(){return c.bv(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return c.bv(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(t,a,h){const p=this._mercatorTransform.getPitchedTextCorrection(t,a,h),b=this._verticalPerspectiveTransform.getPitchedTextCorrection(t,a,h);return c.bv(p,b,this._globeness)}projectTileCoordinates(t,a,h,p){return this.currentTransform.projectTileCoordinates(t,a,h,p)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(t){return this.currentTransform.calculateFogMatrix(t)}getVisibleUnwrappedCoordinates(t){return this.currentTransform.getVisibleUnwrappedCoordinates(t)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(t){this._mercatorTransform.recalculateZoomAndCenter(t),this._verticalPerspectiveTransform.recalculateZoomAndCenter(t)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(t,a){return this.currentTransform.lngLatToCameraDepth(t,a)}populateCache(t){this._mercatorTransform.populateCache(t),this._verticalPerspectiveTransform.populateCache(t)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(t,a,h,p){return this._helper.calculateCenterFromCameraLngLatAlt(t,a,h,p)}setLocationAtPoint(t,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(t,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(t,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(t,a){return this.currentTransform.locationToScreenPoint(t,a)}screenPointToMercatorCoordinate(t,a){return this.currentTransform.screenPointToMercatorCoordinate(t,a)}screenPointToLocation(t,a){return this.currentTransform.screenPointToLocation(t,a)}isPointOnMapSurface(t,a){return this.currentTransform.isPointOnMapSurface(t,a)}getRayDirectionFromPixel(t){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(t)}getMatrixForModel(t,a){return this.currentTransform.getMatrixForModel(t,a)}getProjectionDataForCustomLayer(t=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(t);if(!this.isGlobeRendering)return a;const h=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(t);return h.fallbackMatrix=a.mainMatrix,h}getFastPathSimpleProjectionMatrix(t){return this.currentTransform.getFastPathSimpleProjectionMatrix(t)}}class Ui{get useGlobeControls(){return!0}handlePanInertia(t,a){const h=Mh(t,a);return Math.abs(h.lng-a.center.lng)>180&&(h.lng=a.center.lng+179.5*Math.sign(h.lng-a.center.lng)),{easingCenter:h,easingOffset:new c.P(0,0)}}handleMapControlsRollPitchBearingZoom(t,a){const h=t.around,p=a.screenPointToLocation(h);t.bearingDelta&&a.setBearing(a.bearing+t.bearingDelta),t.pitchDelta&&a.setPitch(a.pitch+t.pitchDelta),t.rollDelta&&a.setRoll(a.roll+t.rollDelta);const b=a.zoom;t.zoomDelta&&a.setZoom(a.zoom+t.zoomDelta);const T=a.zoom-b;if(T===0)return;const k=c.bL(a.center.lng,p.lng),z=k/(Math.abs(k/180)+1),F=c.bL(a.center.lat,p.lat),V=a.getRayDirectionFromPixel(h),H=a.cameraPosition,Y=-1*c.b6(H,V),J=c.bA();c.b1(J,H,[V[0]*Y,V[1]*Y,V[2]*Y]);const ae=c.b8(J)-1,ge=Math.exp(.5*-Math.max(ae-.3,0)),ve=Ra(a.worldSize,a.center.lat)/Math.min(a.width,a.height),ye=c.by(ve,.9,.5,1,.25),be=(1-c.ar(-T))*Math.min(ge,ye),De=a.center.lat,we=a.zoom,Oe=new c.V(a.center.lng+z*be,c.ao(a.center.lat+F*be,-c.ap,c.ap));a.setLocationAtPoint(p,h);const je=a.center,Ae=c.by(Math.abs(k),45,85,0,1),$e=c.by(ve,.75,.35,0,1),ht=Math.pow(Math.max(Ae,$e),.25),st=c.bL(je.lng,Oe.lng),ft=c.bL(je.lat,Oe.lat);a.setCenter(new c.V(je.lng+st*ht,je.lat+ft*ht).wrap()),a.setZoom(we+Bi(De,a.center.lat))}handleMapControlsPan(t,a,h){if(!t.panDelta)return;const p=a.center.lat,b=a.zoom;a.setCenter(Mh(t.panDelta,a).wrap()),a.setZoom(b+Bi(p,a.center.lat))}cameraForBoxAndBearing(t,a,h,p,b){const T=go(t,a,h,p,b),k=a.left/b.width*2-1,z=(b.width-a.right)/b.width*2-1,F=a.top/b.height*-2+1,V=(b.height-a.bottom)/b.height*-2+1,H=c.bL(h.getWest(),h.getEast())<0,Y=H?h.getEast():h.getWest(),J=H?h.getWest():h.getEast(),ae=Math.max(h.getNorth(),h.getSouth()),ge=Math.min(h.getNorth(),h.getSouth()),ve=Y+.5*c.bL(Y,J),ye=ae+.5*c.bL(ae,ge),be=b.clone();be.setCenter(T.center),be.setBearing(T.bearing),be.setPitch(0),be.setRoll(0),be.setZoom(T.zoom);const De=be.modelViewProjectionMatrix,we=[Li(h.getNorthWest()),Li(h.getNorthEast()),Li(h.getSouthWest()),Li(h.getSouthEast()),Li(new c.V(J,ye)),Li(new c.V(Y,ye)),Li(new c.V(ve,ae)),Li(new c.V(ve,ge))],Oe=Li(T.center);let je=Number.POSITIVE_INFINITY;for(const Ae of we)k<0&&(je=Ui.getLesserNonNegativeNonNull(je,Ui.solveVectorScale(Ae,Oe,De,"x",k))),z>0&&(je=Ui.getLesserNonNegativeNonNull(je,Ui.solveVectorScale(Ae,Oe,De,"x",z))),F>0&&(je=Ui.getLesserNonNegativeNonNull(je,Ui.solveVectorScale(Ae,Oe,De,"y",F))),V<0&&(je=Ui.getLesserNonNegativeNonNull(je,Ui.solveVectorScale(Ae,Oe,De,"y",V)));if(Number.isFinite(je)&&je!==0)return T.zoom=be.zoom+c.au(je),T;Qr()}handleJumpToCenterZoom(t,a){const h=t.center.lat,p=t.applyConstrain(a.center?c.V.convert(a.center):t.center,t.zoom).center;t.setCenter(p.wrap());const b=a.zoom!==void 0?+a.zoom:t.zoom+Bi(h,p.lat);t.zoom!==b&&t.setZoom(b)}handleEaseTo(t,a){const h=t.zoom,p=t.center,b=t.padding,T={roll:t.roll,pitch:t.pitch,bearing:t.bearing},k={roll:a.roll===void 0?t.roll:a.roll,pitch:a.pitch===void 0?t.pitch:a.pitch,bearing:a.bearing===void 0?t.bearing:a.bearing},z=a.zoom!==void 0,F=!t.isPaddingEqual(a.padding);let V=!1;const H=a.center?c.V.convert(a.center):p,Y=t.applyConstrain(H,h).center;hs(t,Y);const J=t.clone();J.setCenter(Y),J.setZoom(z?+a.zoom:h+Bi(p.lat,H.lat)),J.setBearing(a.bearing);const ae=new c.P(c.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),c.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));J.setLocationAtPoint(Y,ae);const ge=(a.offset&&a.offsetAsPoint.mag())>0?J.center:Y,ve=z?+a.zoom:h+Bi(p.lat,ge.lat),ye=h+Bi(p.lat,0),be=ve+Bi(ge.lat,0),De=c.bL(p.lng,ge.lng),we=c.bL(p.lat,ge.lat),Oe=c.ar(be-ye);return V=ve!==h,{easeFunc:je=>{if(c.bp(T,k)||ru({startEulerAngles:T,endEulerAngles:k,tr:t,k:je,useSlerp:T.roll!=k.roll}),F&&t.interpolatePadding(b,a.padding,je),a.around)c.w("Easing around a point is not supported under globe projection."),t.setLocationAtPoint(a.around,a.aroundPoint);else{const Ae=be>ye?Math.min(2,Oe):Math.max(.5,Oe),$e=Math.pow(Ae,1-je),ht=Fc(p,De,we,je*$e);t.setCenter(ht.wrap())}if(V){const Ae=c.G.number(ye,be,je)+Bi(0,t.center.lat);t.setZoom(Ae)}},isZooming:V,elevationCenter:ge}}handleFlyTo(t,a){const h=a.zoom!==void 0,p=t.center,b=t.zoom,T=t.padding,k=!t.isPaddingEqual(a.padding),z=t.applyConstrain(c.V.convert(a.center||a.locationAtOffset),b).center,F=h?+a.zoom:t.zoom+Bi(t.center.lat,z.lat),V=t.clone();V.setCenter(z),V.setZoom(F),V.setBearing(a.bearing);const H=new c.P(c.ao(t.centerPoint.x+a.offsetAsPoint.x,0,t.width),c.ao(t.centerPoint.y+a.offsetAsPoint.y,0,t.height));V.setLocationAtPoint(z,H);const Y=V.center;hs(t,Y);const J=(function(we,Oe,je){const Ae=Li(Oe),$e=Li(je),ht=c.b6(Ae,$e),st=Math.acos(ht),ft=fa(we);return st/(2*Math.PI)*ft})(t,p,Y),ae=b+Bi(p.lat,0),ge=F+Bi(Y.lat,0),ve=c.ar(ge-ae);let ye;if(typeof a.minZoom=="number"){const we=+a.minZoom+Bi(Y.lat,0),Oe=Math.min(we,ae,ge)+Bi(0,Y.lat),je=t.applyConstrain(Y,Oe).zoom+Bi(Y.lat,0);ye=c.ar(je-ae)}const be=c.bL(p.lng,Y.lng),De=c.bL(p.lat,Y.lat);return{easeFunc:(we,Oe,je,Ae)=>{const $e=Fc(p,be,De,je);k&&t.interpolatePadding(T,a.padding,we);const ht=we===1?Y:$e;t.setCenter(ht.wrap());const st=ae+c.au(Oe);t.setZoom(we===1?F:st+Bi(0,ht.lat))},scaleOfZoom:ve,targetCenter:Y,scaleOfMinZoom:ye,pixelPathLength:J}}static solveVectorScale(t,a,h,p,b){const T=p==="x"?[h[0],h[4],h[8],h[12]]:[h[1],h[5],h[9],h[13]],k=[h[3],h[7],h[11],h[15]],z=t[0]*T[0]+t[1]*T[1]+t[2]*T[2],F=t[0]*k[0]+t[1]*k[1]+t[2]*k[2],V=a[0]*T[0]+a[1]*T[1]+a[2]*T[2],H=a[0]*k[0]+a[1]*k[1]+a[2]*k[2];return V+b*F===z+b*H||k[3]*(z-V)+T[3]*(H-F)+z*H==V*F?null:(V+T[3]-b*H-b*k[3])/(V-z-b*H+b*F)}static getLesserNonNegativeNonNull(t,a){return a!==null&&a>=0&&a<t?a:t}}class Wo{constructor(t){this._globe=t,this._mercatorCameraHelper=new ha,this._verticalPerspectiveCameraHelper=new Ui}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(t,a){return this.currentHelper.handlePanInertia(t,a)}handleMapControlsRollPitchBearingZoom(t,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(t,a)}handleMapControlsPan(t,a,h){this.currentHelper.handleMapControlsPan(t,a,h)}cameraForBoxAndBearing(t,a,h,p,b){return this.currentHelper.cameraForBoxAndBearing(t,a,h,p,b)}handleJumpToCenterZoom(t,a){this.currentHelper.handleJumpToCenterZoom(t,a)}handleEaseTo(t,a){return this.currentHelper.handleEaseTo(t,a)}handleFlyTo(t,a){return this.currentHelper.handleFlyTo(t,a)}}const vo=(v,t)=>c.B(v,t&&t.filter((a=>a.identifier!=="source.canvas"))),Ml=c.bP();class xo extends c.E{constructor(t,a={}){var h,p;super(),this._rtlPluginLoaded=()=>{for(const T in this.tileManagers){const k=this.tileManagers[T].getSource().type;k!=="vector"&&k!=="geojson"||this.tileManagers[T].reload()}},this.map=t,this.dispatcher=new Rn(ni(),t._getMapId()),this.dispatcher.registerMessageHandler("GG",((T,k)=>this.getGlyphs(T,k))),this.dispatcher.registerMessageHandler("GI",((T,k)=>this.getImages(T,k))),this.dispatcher.registerMessageHandler("GDA",((T,k)=>this.getDashes(T,k))),this.imageManager=new Ne,this.imageManager.setEventedParent(this);const b=((h=t._container)===null||h===void 0?void 0:h.lang)||typeof document<"u"&&((p=document.documentElement)===null||p===void 0?void 0:p.lang)||void 0;this.glyphManager=new Pe(t._requestManager,a.localIdeographFontFamily,b),this.lineAtlas=new Ot(256,512),this.crossTileSymbolIndex=new $i,this._setInitialValues(),this._resetUpdates(),this.dispatcher.broadcast("SR",c.bQ()),Je().on(Se,this._rtlPluginLoaded),this.on("data",(T=>{if(T.dataType!=="source"||T.sourceDataType!=="metadata")return;const k=this.tileManagers[T.sourceId];if(!k)return;const z=k.getSource();if(z&&z.vectorLayerIds)for(const F in this._layers){const V=this._layers[F];V.source===z.id&&this._validateLayer(V)}}))}_setInitialValues(){var t;this._spritesImagesIds={},this._layers={},this._order=[],this.tileManagers={},this.zoomHistory=new c.bR,this._availableImages=[],this._globalState={},this._serializedLayers={},this.stylesheet=null,this.light=null,this.sky=null,this.projection&&(this.projection.destroy(),delete this.projection),this._loaded=!1,this._changed=!1,this._updatedLayers={},this._updatedSources={},this._changedImages={},this._glyphsDidChange=!1,this._updatedPaintProps={},this._layerOrderChanged=!1,this.crossTileSymbolIndex=new(((t=this.crossTileSymbolIndex)===null||t===void 0?void 0:t.constructor)||Object),this.pauseablePlacement=void 0,this.placement=void 0,this.z=0}setGlobalStateProperty(t,a){var h,p,b;this._checkLoaded();const T=a===null?(b=(p=(h=this.stylesheet.state)===null||h===void 0?void 0:h[t])===null||p===void 0?void 0:p.default)!==null&&b!==void 0?b:null:a;if(c.bS(T,this._globalState[t]))return this;this._globalState[t]=T,this._applyGlobalStateChanges([t])}getGlobalState(){return this._globalState}setGlobalState(t){this._checkLoaded();const a=[];for(const h in t)!c.bS(this._globalState[h],t[h].default)&&(a.push(h),this._globalState[h]=t[h].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(t){if(t.length===0)return;const a=new Set,h={};for(const p of t){h[p]=this._globalState[p];for(const b in this._layers){const T=this._layers[b],k=T.getLayoutAffectingGlobalStateRefs(),z=T.getPaintAffectingGlobalStateRefs();if(k.has(p)&&a.add(T.source),z.has(p))for(const{name:F,value:V}of z.get(p))this._updatePaintProperty(T,F,V)}}this.dispatcher.broadcast("UGS",h);for(const p in this.tileManagers)a.has(p)&&(this._reloadSource(p),this._changed=!0)}loadURL(t,a={},h){this.fire(new c.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const p=this.map._requestManager.transformRequest(t,"Style");this._loadStyleRequest=new AbortController;const b=this._loadStyleRequest;c.j(p,this._loadStyleRequest).then((T=>{this._loadStyleRequest=null,this._load(T.data,a,h)})).catch((T=>{this._loadStyleRequest=null,T&&!b.signal.aborted&&this.fire(new c.k(T))}))}loadJSON(t,a={},h){this.fire(new c.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,Be.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(t,a,h)})).catch((()=>{}))}loadEmpty(){this.fire(new c.l("dataloading",{dataType:"style"})),this._load(Ml,{validate:!1})}_load(t,a,h){var p,b;let T=a.transformStyle?a.transformStyle(h,t):t;if(!a.validate||!vo(this,c.C(T))){T=Object.assign({},T),this._loaded=!0,this.stylesheet=T;for(const k in T.sources)this.addSource(k,T.sources[k],{validate:!1});T.sprite?this._loadSprite(T.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(T.glyphs),this._createLayers(),this.light=new vt(this.stylesheet.light),this._setProjectionInternal(((p=this.stylesheet.projection)===null||p===void 0?void 0:p.type)||"mercator"),this.sky=new ut(this.stylesheet.sky),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new c.l("data",{dataType:"style"})),this.fire(new c.l("style.load"))}}_createLayers(){var t,a,h;const p=c.bT(this.stylesheet.layers);this.setGlobalState((t=this.stylesheet.state)!==null&&t!==void 0?t:null),this.dispatcher.broadcast("SL",p),this._order=p.map((b=>b.id)),this._layers={},this._serializedLayers=null;for(const b of p){const T=c.bU(b,this._globalState);if(T.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=T,c.bV(T)&&this.tileManagers[T.source]){const k=(h=(a=b.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&h!==void 0?h:T.paint.get("raster-fade-duration");this.tileManagers[T.source].setRasterFadeDuration(k)}}}_loadSprite(t,a=!1,h=void 0){this.imageManager.setLoaded(!1);const p=new AbortController;let b;this._spriteRequest=p,(function(T,k,z,F){return c._(this,void 0,void 0,(function*(){const V=de(T),H=z>1?"@2x":"",Y={},J={};for(const{id:ae,url:ge}of V){const ve=k.transformRequest(Ie(ge,H,".json"),"SpriteJSON");Y[ae]=c.j(ve,F);const ye=k.transformRequest(Ie(ge,H,".png"),"SpriteImage");J[ae]=wt.getImage(ye,F)}return yield Promise.all([...Object.values(Y),...Object.values(J)]),(function(ae,ge){return c._(this,void 0,void 0,(function*(){const ve={};for(const ye in ae){ve[ye]={};const be=Be.getImageCanvasContext((yield ge[ye]).data),De=(yield ae[ye]).data;for(const we in De){const{width:Oe,height:je,x:Ae,y:$e,sdf:ht,pixelRatio:st,stretchX:ft,stretchY:pt,content:Dt,textFitWidth:qt,textFitHeight:Pt}=De[we];ve[ye][we]={data:null,pixelRatio:st,sdf:ht,stretchX:ft,stretchY:pt,content:Dt,textFitWidth:qt,textFitHeight:Pt,spriteData:{width:Oe,height:je,x:Ae,y:$e,context:be}}}}return ve}))})(Y,J)}))})(t,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((T=>{if(this._spriteRequest=null,T)for(const k in T){this._spritesImagesIds[k]=[];const z=this._spritesImagesIds[k]?this._spritesImagesIds[k].filter((F=>!(F in T))):[];for(const F of z)this.imageManager.removeImage(F),this._changedImages[F]=!0;for(const F in T[k]){const V=k==="default"?F:`${k}:${F}`;this._spritesImagesIds[k].push(V),V in this.imageManager.images?this.imageManager.updateImage(V,T[k][F],!1):this.imageManager.addImage(V,T[k][F]),a&&(this._changedImages[V]=!0)}}})).catch((T=>{this._spriteRequest=null,b=T,p.signal.aborted||this.fire(new c.k(b))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"})),h&&h(b)}))}_unloadSprite(){for(const t of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(t),this._changedImages[t]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}_validateLayer(t){const a=this.tileManagers[t.source];if(!a)return;const h=t.sourceLayer;if(!h)return;const p=a.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(h)===-1)&&this.fire(new c.k(new Error(`Source layer "${h}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.tileManagers)if(!this.tileManagers[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(t,a=!1){const h=this._serializedAllLayers();if(!t||t.length===0)return Object.values(a?c.bW(h):h);const p=[];for(const b of t)if(h[b]){const T=a?c.bW(h[b]):h[b];p.push(T)}return p}_serializedAllLayers(){let t=this._serializedLayers;if(t)return t;t=this._serializedLayers={};const a=Object.keys(this._layers);for(const h of a){const p=this._layers[h];p.type!=="custom"&&(t[h]=p.serialize())}return t}hasTransitions(){var t,a,h;if(!((t=this.light)===null||t===void 0)&&t.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((h=this.projection)===null||h===void 0)&&h.hasTransition())return!0;for(const p in this.tileManagers)if(this.tileManagers[p].hasTransition())return!0;for(const p in this._layers)if(this._layers[p].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const a=this._changed;if(a){const p=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(p.length||b.length)&&this._updateWorkerLayers(p,b);for(const T in this._updatedSources){const k=this._updatedSources[T];if(k==="reload")this._reloadSource(T);else{if(k!=="clear")throw new Error(`Invalid action ${k}`);this._clearSource(T)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(t);this.light.updateTransitions(t),this.sky.updateTransitions(t),this._resetUpdates()}const h={};for(const p in this.tileManagers){const b=this.tileManagers[p];h[p]=b.used,b.used=!1}for(const p of this._order){const b=this._layers[p];b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)&&b.source&&(this.tileManagers[b.source].used=!0)}for(const p in h){const b=this.tileManagers[p];!!h[p]!=!!b.used&&b.fire(new c.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.sky.recalculate(t),this.projection.recalculate(t),this.z=t.zoom,a&&this.fire(new c.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const a in this.tileManagers)this.tileManagers[a].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const t in this.tileManagers)this.tileManagers[t].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(t,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(t,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(t,a={}){var h;this._checkLoaded();const p=this.serialize();if(t=a.transformStyle?a.transformStyle(p,t):t,((h=a.validate)===null||h===void 0||h)&&vo(this,c.C(t)))return!1;(t=c.bW(t)).layers=c.bT(t.layers);const b=c.bX(p,t),T=this._getOperationsToPerform(b);if(T.unimplemented.length>0)throw new Error(`Unimplemented: ${T.unimplemented.join(", ")}.`);if(T.operations.length===0)return!1;for(const k of T.operations)k();return this.stylesheet=t,this._serializedLayers=null,!0}_getOperationsToPerform(t){const a=[],h=[];for(const p of t)switch(p.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,p.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,p.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,p.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,p.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,p.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,p.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,p.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,p.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,p.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,p.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,p.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,p.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,p.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,p.args)));break;case"setProjection":this.setProjection.apply(this,p.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,p.args)));break;case"setTransition":a.push((()=>{}));break;default:h.push(p.command)}return{operations:a,unimplemented:h}}addImage(t,a){if(this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,a),this._afterImageUpdated(t)}updateImage(t,a){this.imageManager.updateImage(t,a)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new c.k(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,a,h={}){if(this._checkLoaded(),this.tileManagers[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(c.C.source,`sources.${t}`,a,null,h))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const p=this.tileManagers[t]=new di(t,a,this.dispatcher);p.style=this,p.setEventedParent(this,(()=>({isSourceLoaded:p.loaded(),source:p.serialize(),sourceId:t}))),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error("There is no source with this ID");for(const h in this._layers)if(this._layers[h].source===t)return this.fire(new c.k(new Error(`Source "${t}" cannot be removed while layer "${h}" is using it.`)));const a=this.tileManagers[t];delete this.tileManagers[t],delete this._updatedSources[t],a.fire(new c.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,a){if(this._checkLoaded(),this.tileManagers[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const h=this.tileManagers[t].getSource();if(h.type!=="geojson")throw new Error(`geojsonSource.type is ${h.type}, which is !== 'geojson`);h.setData(a),this._changed=!0}getSource(t){return this.tileManagers[t]&&this.tileManagers[t].getSource()}addLayer(t,a,h={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new c.k(new Error(`Layer "${p}" already exists on this map.`)));let b;if(t.type==="custom"){if(vo(this,c.bY(t)))return;b=c.bU(t,this._globalState)}else{if("source"in t&&typeof t.source=="object"&&(this.addSource(p,t.source),t=c.bW(t),t=c.e(t,{source:p})),this._validate(c.C.layer,`layers.${p}`,t,{arrayIndex:-1},h))return;b=c.bU(t,this._globalState),this._validateLayer(b),b.setEventedParent(this,{layer:{id:p}})}const T=a?this._order.indexOf(a):this._order.length;if(a&&T===-1)this.fire(new c.k(new Error(`Cannot add layer "${p}" before non-existing layer "${a}".`)));else{if(this._order.splice(T,0,p),this._layerOrderChanged=!0,this._layers[p]=b,this._removedLayers[p]&&b.source&&b.type!=="custom"){const k=this._removedLayers[p];delete this._removedLayers[p],k.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.tileManagers[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(t,a){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new c.k(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===a)return;const h=this._order.indexOf(t);this._order.splice(h,1);const p=a?this._order.indexOf(a):this._order.length;a&&p===-1?this.fire(new c.k(new Error(`Cannot move layer "${t}" before non-existing layer "${a}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const a=this._layers[t];if(!a)return void this.fire(new c.k(new Error(`Cannot remove non-existing layer "${t}".`)));a.setEventedParent(null);const h=this._order.indexOf(t);this._order.splice(h,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=a,delete this._layers[t],this._serializedLayers&&delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],a.onRemove&&a.onRemove(this.map)}getLayer(t){return this._layers[t]}getLayersOrder(){return[...this._order]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,a,h){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===a&&p.maxzoom===h||(a!=null&&(p.minzoom=a),h!=null&&(p.maxzoom=h),this._updateLayer(p)):this.fire(new c.k(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,a,h={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!c.bS(p.filter,a))return a==null?(p.setFilter(void 0),void this._updateLayer(p)):void(this._validate(c.C.filter,`layers.${p.id}.filter`,a,null,h)||(p.setFilter(c.bW(a)),this._updateLayer(p)))}else this.fire(new c.k(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return c.bW(this.getLayer(t).filter)}setLayoutProperty(t,a,h,p={}){this._checkLoaded();const b=this.getLayer(t);b?c.bS(b.getLayoutProperty(a),h)||(b.setLayoutProperty(a,h,p),this._updateLayer(b)):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,a){const h=this.getLayer(t);if(h)return h.getLayoutProperty(a);this.fire(new c.k(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,a,h,p={}){this._checkLoaded();const b=this.getLayer(t);b?c.bS(b.getPaintProperty(a),h)||this._updatePaintProperty(b,a,h,p):this.fire(new c.k(new Error(`Cannot style non-existing layer "${t}".`)))}_updatePaintProperty(t,a,h,p={}){t.setPaintProperty(a,h,p)&&this._updateLayer(t),c.bV(t)&&a==="raster-fade-duration"&&this.tileManagers[t.source].setRasterFadeDuration(h),this._changed=!0,this._updatedPaintProps[t.id]=!0,this._serializedLayers=null}getPaintProperty(t,a){return this.getLayer(t).getPaintProperty(a)}setFeatureState(t,a){this._checkLoaded();const h=t.source,p=t.sourceLayer,b=this.tileManagers[h];if(b===void 0)return void this.fire(new c.k(new Error(`The source '${h}' does not exist in the map's style.`)));const T=b.getSource().type;T==="geojson"&&p?this.fire(new c.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):T!=="vector"||p?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),b.setFeatureState(p,t.id,a)):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,a){this._checkLoaded();const h=t.source,p=this.tileManagers[h];if(p===void 0)return void this.fire(new c.k(new Error(`The source '${h}' does not exist in the map's style.`)));const b=p.getSource().type,T=b==="vector"?t.sourceLayer:void 0;b!=="vector"||T?a&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new c.k(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(T,t.id,a):this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const a=t.source,h=t.sourceLayer,p=this.tileManagers[a];if(p!==void 0)return p.getSource().type!=="vector"||h?(t.id===void 0&&this.fire(new c.k(new Error("The feature id parameter must be provided."))),p.getFeatureState(h,t.id)):void this.fire(new c.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const t=c.bZ(this.tileManagers,(b=>b.serialize())),a=this._serializeByIds(this._order,!0),h=this.map.getTerrain()||void 0,p=this.stylesheet;return c.b_({version:p.version,name:p.name,metadata:p.metadata,light:p.light,sky:p.sky,center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch,sprite:p.sprite,glyphs:p.glyphs,transition:p.transition,projection:p.projection,sources:t,layers:a,terrain:h},(b=>b!==void 0))}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.tileManagers[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.tileManagers[t.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(t){const a=T=>this._layers[T].type==="fill-extrusion",h={},p=[];for(let T=this._order.length-1;T>=0;T--){const k=this._order[T];if(a(k)){h[k]=T;for(const z of t){const F=z[k];if(F)for(const V of F)p.push(V)}}}p.sort(((T,k)=>k.intersectionZ-T.intersectionZ));const b=[];for(let T=this._order.length-1;T>=0;T--){const k=this._order[T];if(a(k))for(let z=p.length-1;z>=0;z--){const F=p[z].feature;if(h[F.layer.id]<T)break;b.push(F),p.pop()}else for(const z of t){const F=z[k];if(F)for(const V of F)b.push(V.feature)}}return b}queryRenderedFeatures(t,a,h){a&&a.filter&&this._validate(c.C.filter,"queryRenderedFeatures.filter",a.filter,null,a);const p={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new c.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const F of a.layers){const V=this._layers[F];if(!V)return this.fire(new c.k(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];p[V.source]=!0}}const b=[];a.availableImages=this._availableImages;const T=this._serializedAllLayers(),k=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,z=Object.assign(Object.assign({},a),{layers:k,globalState:this._globalState});for(const F in this.tileManagers)a.layers&&!p[F]||b.push(fi(this.tileManagers[F],this._layers,T,t,z,h,this.map.terrain?(V,H,Y)=>this.map.terrain.getElevation(V,H,Y):void 0));return this.placement&&b.push((function(F,V,H,Y,J,ae,ge){const ve={},ye=ae.queryRenderedSymbols(Y),be=[];for(const De of Object.keys(ye).map(Number))be.push(ge[De]);be.sort(Dn);for(const De of be){const we=De.featureIndex.lookupSymbolFeatures(ye[De.bucketInstanceId],V,De.bucketIndex,De.sourceLayerIndex,{filterSpec:J.filter,globalState:J.globalState},J.layers,J.availableImages,F);for(const Oe in we){const je=ve[Oe]=ve[Oe]||[],Ae=we[Oe];Ae.sort((($e,ht)=>{const st=De.featureSortOrder;if(st){const ft=st.indexOf($e.featureIndex);return st.indexOf(ht.featureIndex)-ft}return ht.featureIndex-$e.featureIndex}));for(const $e of Ae)je.push($e)}}return(function(De,we,Oe){for(const je in De)for(const Ae of De[je])Pn(Ae,Oe[we[je].source]);return De})(ve,F,H)})(this._layers,T,this.tileManagers,t,z,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(t,a){a?.filter&&this._validate(c.C.filter,"querySourceFeatures.filter",a.filter,null,a);const h=this.tileManagers[t];return h?(function(p,b){const T=p.getRenderableIds().map((F=>p.getTileByID(F))),k=[],z={};for(let F=0;F<T.length;F++){const V=T[F],H=V.tileID.canonical.key;z[H]||(z[H]=!0,V.querySourceFeatures(k,b))}return k})(h,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(t,a={}){this._checkLoaded();const h=this.light.getLight();let p=!1;for(const T in t)if(!c.bS(t[T],h[T])){p=!0;break}if(!p)return;const b={now:dt(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,a),this.light.updateTransitions(b)}getProjection(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.projection}setProjection(t){if(this._checkLoaded(),this.projection){if(this.projection.name===t.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=t,this._setProjectionInternal(t.type)}getSky(){var t;return(t=this.stylesheet)===null||t===void 0?void 0:t.sky}setSky(t,a={}){this._checkLoaded();const h=this.getSky();let p=!1;if(!t&&!h)return;if(t&&!h)p=!0;else if(!t&&h)p=!0;else for(const T in t)if(!c.bS(t[T],h[T])){p=!0;break}if(!p)return;const b={now:dt(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=t,this.sky.setSky(t,a),this.sky.updateTransitions(b)}_setProjectionInternal(t){const a=(function(h,p){const b={constrainOverride:p};if(Array.isArray(h)){const T=new Bc({type:h});return{projection:T,transform:new $o(b),cameraHelper:new Wo(T)}}switch(h){case"mercator":return{projection:new mi,transform:new rr(b),cameraHelper:new ha};case"globe":{const T=new Bc({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:T,transform:new $o(b),cameraHelper:new Wo(T)}}case"vertical-perspective":return{projection:new Nc,transform:new El(b),cameraHelper:new Ui};default:return c.w(`Unknown projection name: ${h}. Falling back to mercator projection.`),{projection:new mi,transform:new rr(b),cameraHelper:new ha}}})(t,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const h in this.tileManagers)this.tileManagers[h].reload()}_validate(t,a,h,p,b={}){return(!b||b.validate!==!1)&&vo(this,t.call(c.C,c.e({key:a,style:this.serialize(),value:h,styleSpec:c.u},p)))}_remove(t=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Je().off(Se,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.tileManagers){const h=this.tileManagers[a];h.setEventedParent(null),h.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),t&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(t)}_clearSource(t){this.tileManagers[t].clearTiles()}_reloadSource(t){this.tileManagers[t].resume(),this.tileManagers[t].reload()}_updateSources(t){for(const a in this.tileManagers)this.tileManagers[a].update(t,this.map.terrain)}_generateCollisionBoxes(){for(const t in this.tileManagers)this._reloadSource(t)}_updatePlacement(t,a,h,p,b=!1){let T=!1,k=!1;const z={};for(const F of this._order){const V=this._layers[F];if(V.type!=="symbol")continue;if(!z[V.source]){const Y=this.tileManagers[V.source];z[V.source]=Y.getRenderableIds(!0).map((J=>Y.getTileByID(J))).sort(((J,ae)=>ae.tileID.overscaledZ-J.tileID.overscaledZ||(J.tileID.isLessThan(ae.tileID)?-1:1)))}const H=this.crossTileSymbolIndex.addLayer(V,z[V.source],t.center.lng);T=T||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||h===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(dt(),t.zoom))&&(this.pauseablePlacement=new Ya(t,this.map.terrain,this._order,b,a,h,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(dt()),k=!0),T&&this.pauseablePlacement.placement.setStale()),k||T)for(const F of this._order){const V=this._layers[F];V.type==="symbol"&&this.placement.updateLayerOpacities(V,z[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(dt())}_releaseSymbolFadeTiles(){for(const t in this.tileManagers)this.tileManagers[t].releaseSymbolFadeTiles()}getImages(t,a){return c._(this,void 0,void 0,(function*(){const h=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const p=this.tileManagers[a.source];return p&&p.setDependencies(a.tileID.key,a.type,a.icons),h}))}getGlyphs(t,a){return c._(this,void 0,void 0,(function*(){const h=yield this.glyphManager.getGlyphs(a.stacks),p=this.tileManagers[a.source];return p&&p.setDependencies(a.tileID.key,a.type,[""]),h}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(t,a={}){this._checkLoaded(),t&&this._validate(c.C.glyphs,"glyphs",t,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=t,this.glyphManager.entries={},this.glyphManager.setURL(t))}getDashes(t,a){return c._(this,void 0,void 0,(function*(){const h={};for(const[p,b]of Object.entries(a.dashes))h[p]=this.lineAtlas.getDash(b.dasharray,b.round);return h}))}addSprite(t,a,h={},p){this._checkLoaded();const b=[{id:t,url:a}],T=[...de(this.stylesheet.sprite),...b];this._validate(c.C.sprite,"sprite",T,null,h)||(this.stylesheet.sprite=T,this._loadSprite(b,!0,p))}removeSprite(t){this._checkLoaded();const a=de(this.stylesheet.sprite);if(a.find((h=>h.id===t))){if(this._spritesImagesIds[t])for(const h of this._spritesImagesIds[t])this.imageManager.removeImage(h),this._changedImages[h]=!0;a.splice(a.findIndex((h=>h.id===t)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[t],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.l("data",{dataType:"style"}))}else this.fire(new c.k(new Error(`Sprite "${t}" doesn't exists on this map.`)))}getSprite(){return de(this.stylesheet.sprite)}setSprite(t,a={},h){this._checkLoaded(),t&&this._validate(c.C.sprite,"sprite",t,null,a)||(this.stylesheet.sprite=t,t?this._loadSprite(t,!0,h):(this._unloadSprite(),h&&h(null)))}destroy(){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null);for(const t in this.tileManagers){const a=this.tileManagers[t];a.setEventedParent(null),a.onRemove(this.map)}this.tileManagers={},this.imageManager&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this._availableImages=[],this._spritesImagesIds={}),this.glyphManager&&this.glyphManager.destroy();for(const t in this._layers){const a=this._layers[t];a.setEventedParent(null),a.onRemove&&a.onRemove(this.map)}this._setInitialValues(),this.setEventedParent(null),this.dispatcher.unregisterMessageHandler("GG"),this.dispatcher.unregisterMessageHandler("GI"),this.dispatcher.unregisterMessageHandler("GDA"),this.dispatcher.remove(!0),this._listeners={},this._oneTimeListeners={}}}var Ch=c.aV([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ou{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,a,h,p,b,T,k,z,F){this.context=t;let V=this.boundPaintVertexBuffers.length!==p.length;for(let H=0;!V&&H<p.length;H++)this.boundPaintVertexBuffers[H]!==p[H]&&(V=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==h||V||this.boundIndexBuffer!==b||this.boundVertexOffset!==T||this.boundDynamicVertexBuffer!==k||this.boundDynamicVertexBuffer2!==z||this.boundDynamicVertexBuffer3!==F?this.freshBind(a,h,p,b,T,k,z,F):(t.bindVertexArray.set(this.vao),k&&k.bind(),b&&b.dynamicDraw&&b.bind(),z&&z.bind(),F&&F.bind())}freshBind(t,a,h,p,b,T,k,z){const F=t.numAttributes,V=this.context,H=V.gl;this.vao&&this.destroy(),this.vao=V.createVertexArray(),V.bindVertexArray.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=k,this.boundDynamicVertexBuffer3=z,a.enableAttributes(H,t);for(const Y of h)Y.enableAttributes(H,t);T&&T.enableAttributes(H,t),k&&k.enableAttributes(H,t),z&&z.enableAttributes(H,t),a.bind(),a.setVertexAttribPointers(H,t,b);for(const Y of h)Y.bind(),Y.setVertexAttribPointers(H,t,b);T&&(T.bind(),T.setVertexAttribPointers(H,t,b)),p&&p.bind(),k&&(k.bind(),k.setVertexAttribPointers(H,t,b)),z&&(z.bind(),z.setVertexAttribPointers(H,t,b)),V.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ih=(v,t,a,h,p)=>({u_texture:0,u_ele_delta:v,u_fog_matrix:t,u_fog_color:a?a.properties.get("fog-color"):c.bq.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:p?0:a?a.calculateFogBlendOpacity(h):0,u_horizon_color:a?a.properties.get("horizon-color"):c.bq.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:p?1:0}),fs={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function $u(v){const t=[];for(let a=0;a<v.length;a++){if(v[a]===null)continue;const h=v[a].split(" ");t.push(h.pop())}return t}class Ah{constructor(t,a,h,p,b,T,k,z,F=[]){const V=t.gl;this.program=V.createProgram();const H=$u(a.staticAttributes),Y=h?h.getBinderAttributes():[],J=H.concat(Y),ae=Di.prelude.staticUniforms?$u(Di.prelude.staticUniforms):[],ge=k.staticUniforms?$u(k.staticUniforms):[],ve=a.staticUniforms?$u(a.staticUniforms):[],ye=h?h.getBinderUniforms():[],be=ae.concat(ge).concat(ve).concat(ye),De=[];for(const st of be)De.indexOf(st)<0&&De.push(st);const we=h?h.defines():[];Fr(V)&&we.unshift("#version 300 es"),b&&we.push("#define OVERDRAW_INSPECTOR;"),T&&we.push("#define TERRAIN3D;"),z&&we.push(z),F&&we.push(...F);let Oe=we.concat(Di.prelude.fragmentSource,k.fragmentSource,a.fragmentSource).join(`
`),je=we.concat(Di.prelude.vertexSource,k.vertexSource,a.vertexSource).join(`
`);Fr(V)||(Oe=(function(st){return st.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(Oe),je=(function(st){return st.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(je));const Ae=V.createShader(V.FRAGMENT_SHADER);if(V.isContextLost())return void(this.failedToCreate=!0);if(V.shaderSource(Ae,Oe),V.compileShader(Ae),!V.getShaderParameter(Ae,V.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${V.getShaderInfoLog(Ae)}`);V.attachShader(this.program,Ae);const $e=V.createShader(V.VERTEX_SHADER);if(V.isContextLost())return void(this.failedToCreate=!0);if(V.shaderSource($e,je),V.compileShader($e),!V.getShaderParameter($e,V.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${V.getShaderInfoLog($e)}`);V.attachShader(this.program,$e),this.attributes={};const ht={};this.numAttributes=J.length;for(let st=0;st<this.numAttributes;st++)J[st]&&(V.bindAttribLocation(this.program,st,J[st]),this.attributes[J[st]]=st);if(V.linkProgram(this.program),!V.getProgramParameter(this.program,V.LINK_STATUS))throw new Error(`Program failed to link: ${V.getProgramInfoLog(this.program)}`);V.deleteShader($e),V.deleteShader(Ae);for(let st=0;st<De.length;st++){const ft=De[st];if(ft&&!ht[ft]){const pt=V.getUniformLocation(this.program,ft);pt&&(ht[ft]=pt)}}this.fixedUniforms=p(t,ht),this.terrainUniforms=((st,ft)=>({u_depth:new c.b$(st,ft.u_depth),u_terrain:new c.b$(st,ft.u_terrain),u_terrain_dim:new c.br(st,ft.u_terrain_dim),u_terrain_matrix:new c.c1(st,ft.u_terrain_matrix),u_terrain_unpack:new c.c2(st,ft.u_terrain_unpack),u_terrain_exaggeration:new c.br(st,ft.u_terrain_exaggeration)}))(t,ht),this.projectionUniforms=((st,ft)=>({u_projection_matrix:new c.c1(st,ft.u_projection_matrix),u_projection_tile_mercator_coords:new c.c2(st,ft.u_projection_tile_mercator_coords),u_projection_clipping_plane:new c.c2(st,ft.u_projection_clipping_plane),u_projection_transition:new c.br(st,ft.u_projection_transition),u_projection_fallback_matrix:new c.c1(st,ft.u_projection_fallback_matrix)}))(t,ht),this.binderUniforms=h?h.getUniforms(t,ht):[]}draw(t,a,h,p,b,T,k,z,F,V,H,Y,J,ae,ge,ve,ye,be,De){const we=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(h),t.setStencilMode(p),t.setColorMode(b),t.setCullFace(T),z){t.activeTexture.set(we.TEXTURE2),we.bindTexture(we.TEXTURE_2D,z.depthTexture),t.activeTexture.set(we.TEXTURE3),we.bindTexture(we.TEXTURE_2D,z.texture);for(const je in this.terrainUniforms)this.terrainUniforms[je].set(z[je])}if(F)for(const je in F)this.projectionUniforms[fs[je]].set(F[je]);if(k)for(const je in this.fixedUniforms)this.fixedUniforms[je].set(k[je]);ve&&ve.setUniforms(t,this.binderUniforms,ae,{zoom:ge});let Oe=0;switch(a){case we.LINES:Oe=2;break;case we.TRIANGLES:Oe=3;break;case we.LINE_STRIP:Oe=1}for(const je of J.get()){const Ae=je.vaos||(je.vaos={});(Ae[V]||(Ae[V]=new ou)).bind(t,this,H,ve?ve.getPaintVertexBuffers():[],Y,je.vertexOffset,ye,be,De),we.drawElements(a,je.primitiveLength*Oe,we.UNSIGNED_SHORT,je.primitiveOffset*Oe*2)}}}function Uc(v,t,a){const h=1/c.aO(a,1,t.transform.tileZoom),p=Math.pow(2,a.tileID.overscaledZ),b=a.tileSize*Math.pow(2,t.transform.tileZoom)/p,T=b*(a.tileID.canonical.x+a.tileID.wrap*p),k=b*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[h,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[T>>16,k>>16],u_pixel_coord_lower:[65535&T,65535&k]}}const Wu=(v,t,a,h)=>{const p=v.style.light,b=p.properties.get("position"),T=[b.x,b.y,b.z],k=c.c5();p.properties.get("anchor")==="viewport"&&c.c6(k,v.transform.bearingInRadians),c.c7(T,T,k);const z=v.transform.transformLightDirection(T),F=p.properties.get("color");return{u_lightpos:T,u_lightpos_globe:z,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[F.r,F.g,F.b],u_vertical_gradient:+t,u_opacity:a,u_fill_translate:h}},lu=(v,t,a,h,p,b,T)=>c.e(Wu(v,t,a,h),Uc(b,v,T),{u_height_factor:-Math.pow(2,p.overscaledZ)/T.tileSize/8}),Ko=(v,t,a,h)=>c.e(Uc(t,v,a),{u_fill_translate:h}),Cl=(v,t)=>({u_world:v,u_fill_translate:t}),kh=(v,t,a,h,p)=>c.e(Ko(v,t,a,p),{u_world:h}),uu=(v,t,a,h,p)=>{const b=v.transform;let T,k,z=0;if(a.paint.get("circle-pitch-alignment")==="map"){const F=c.aO(t,1,b.zoom);T=!0,k=[F,F],z=F/(c.a5*Math.pow(2,t.tileID.overscaledZ))*2*Math.PI*p}else T=!1,k=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+T,u_device_pixel_ratio:v.pixelRatio,u_extrude_scale:k,u_globe_extrude_scale:z,u_translate:h}},bo=v=>({u_pixel_extrude_scale:[1/v.width,1/v.height]}),Vc=v=>({u_viewport_size:[v.width,v.height]}),cu=(v,t=1)=>({u_color:v,u_overlay:0,u_overlay_scale:t}),Ws=(v,t,a,h)=>{const p=c.aO(v,1,t)/(c.a5*Math.pow(2,v.tileID.overscaledZ))*2*Math.PI*h;return{u_extrude_scale:c.aO(v,1,t),u_intensity:a,u_globe_extrude_scale:p}},Ku=(v,t,a,h)=>{const p=c.N();c.c8(p,0,v.width,v.height,0,0,1);const b=v.context.gl;return{u_matrix:p,u_world:[b.drawingBufferWidth,b.drawingBufferHeight],u_image:a,u_color_ramp:h,u_opacity:t.paint.get("heatmap-opacity")}},Il=(v,t,a)=>{const h=a.paint.get("hillshade-accent-color");let p;switch(a.paint.get("hillshade-method")){case"basic":p=4;break;case"combined":p=1;break;case"igor":p=2;break;case"multidirectional":p=3;break;default:p=0}const b=a.getIlluminationProperties();for(let T=0;T<b.directionRadians.length;T++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(b.directionRadians[T]+=v.transform.bearingInRadians);return{u_image:0,u_latrange:Rh(0,t.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:b.altitudeRadians,u_azimuths:b.directionRadians,u_accent:h,u_method:p,u_highlights:b.highlightColor,u_shadows:b.shadowColor}},Ph=(v,t)=>{const a=t.stride,h=c.N();return c.c8(h,0,c.a5,-c.a5,0,0,1),c.O(h,h,[0,-c.a5,0]),{u_matrix:h,u_image:1,u_dimension:[a,a],u_zoom:v.overscaledZ,u_unpack:t.getUnpackVector()}};function Rh(v,t){const a=Math.pow(2,t.canonical.z),h=t.canonical.y;return[new c.ab(0,h/a).toLngLat().lat,new c.ab(0,(h+1)/a).toLngLat().lat]}const Qu=(v,t,a=0)=>({u_image:0,u_unpack:t.getUnpackVector(),u_dimension:[t.stride,t.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:v.paint.get("color-relief-opacity")}),hu=(v,t,a,h)=>{const p=v.transform;return{u_translation:fu(v,t,a),u_ratio:h/c.aO(t,1,p.zoom),u_device_pixel_ratio:v.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Gc=(v,t,a,h,p)=>c.e(hu(v,t,a,h),{u_image:0,u_image_height:p}),Ju=(v,t,a,h,p)=>{const b=v.transform,T=Vr(t,b);return{u_translation:fu(v,t,a),u_texsize:t.imageAtlasTexture.size,u_ratio:h/c.aO(t,1,b.zoom),u_device_pixel_ratio:v.pixelRatio,u_image:0,u_scale:[T,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},xa=(v,t,a,h,p)=>{const b=Vr(t,v.transform);return c.e(hu(v,t,a,h),{u_tileratio:b,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image:0,u_mix:p.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})},wo=(v,t,a,h,p,b)=>{const T=Vr(t,v.transform);return c.e(hu(v,t,a,h),{u_image:0,u_image_height:b,u_tileratio:T,u_crossfade_from:p.fromScale,u_crossfade_to:p.toScale,u_image_dash:1,u_mix:p.t,u_lineatlas_width:v.lineAtlas.width,u_lineatlas_height:v.lineAtlas.height})};function Vr(v,t){return 1/c.aO(v,1,t.tileZoom)}function fu(v,t,a){return c.aP(v.transform,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const du=(v,t,a,h,p)=>{return{u_tl_parent:v,u_scale_parent:t,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:(T=h.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=h.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:pa(h.paint.get("raster-hue-rotate")),u_coords_top:[p[0].x,p[0].y,p[1].x,p[1].y],u_coords_bottom:[p[3].x,p[3].y,p[2].x,p[2].y]};var b,T};function pa(v){v*=Math.PI/180;const t=Math.sin(v),a=Math.cos(v);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const ba=(v,t,a,h,p,b,T,k,z,F,V,H,Y)=>{const J=T.transform;return{u_is_size_zoom_constant:+(v==="constant"||v==="source"),u_is_size_feature_constant:+(v==="constant"||v==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:J.cameraToCenterDistance,u_pitch:J.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:J.width/J.height,u_fade_change:T.options.fadeDuration?T.symbolFadeChange:1,u_label_plane_matrix:k,u_coord_matrix:z,u_is_text:+V,u_pitch_with_map:+h,u_is_along_line:p,u_is_variable_anchor:b,u_texsize:H,u_texture:0,u_translation:F,u_pitched_scale:Y}},_=(v,t,a,h,p,b,T,k,z,F,V,H,Y,J)=>{const ae=T.transform;return c.e(ba(v,t,a,h,p,b,T,k,z,F,V,H,J),{u_gamma_scale:h?Math.cos(ae.pitch*Math.PI/180)*ae.cameraToCenterDistance:1,u_device_pixel_ratio:T.pixelRatio,u_is_halo:1})},o=(v,t,a,h,p,b,T,k,z,F,V,H,Y)=>c.e(_(v,t,a,h,p,b,T,k,z,F,!0,V,0,Y),{u_texsize_icon:H,u_texture_icon:1}),u=(v,t)=>({u_opacity:v,u_color:t}),g=(v,t,a,h,p)=>c.e((function(b,T,k,z){const F=k.imageManager.getPattern(b.from.toString()),V=k.imageManager.getPattern(b.to.toString()),{width:H,height:Y}=k.imageManager.getPixelSize(),J=Math.pow(2,z.tileID.overscaledZ),ae=z.tileSize*Math.pow(2,k.transform.tileZoom)/J,ge=ae*(z.tileID.canonical.x+z.tileID.wrap*J),ve=ae*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:F.tl,u_pattern_br_a:F.br,u_pattern_tl_b:V.tl,u_pattern_br_b:V.br,u_texsize:[H,Y],u_mix:T.t,u_pattern_size_a:F.displaySize,u_pattern_size_b:V.displaySize,u_scale_a:T.fromScale,u_scale_b:T.toScale,u_tile_units_to_pixels:1/c.aO(z,1,k.transform.tileZoom),u_pixel_coord_upper:[ge>>16,ve>>16],u_pixel_coord_lower:[65535&ge,65535&ve]}})(a,p,t,h),{u_opacity:v}),M=(v,t)=>{},B={fillExtrusion:(v,t)=>({u_lightpos:new c.c3(v,t.u_lightpos),u_lightpos_globe:new c.c3(v,t.u_lightpos_globe),u_lightintensity:new c.br(v,t.u_lightintensity),u_lightcolor:new c.c3(v,t.u_lightcolor),u_vertical_gradient:new c.br(v,t.u_vertical_gradient),u_opacity:new c.br(v,t.u_opacity),u_fill_translate:new c.c4(v,t.u_fill_translate)}),fillExtrusionPattern:(v,t)=>({u_lightpos:new c.c3(v,t.u_lightpos),u_lightpos_globe:new c.c3(v,t.u_lightpos_globe),u_lightintensity:new c.br(v,t.u_lightintensity),u_lightcolor:new c.c3(v,t.u_lightcolor),u_vertical_gradient:new c.br(v,t.u_vertical_gradient),u_height_factor:new c.br(v,t.u_height_factor),u_opacity:new c.br(v,t.u_opacity),u_fill_translate:new c.c4(v,t.u_fill_translate),u_image:new c.b$(v,t.u_image),u_texsize:new c.c4(v,t.u_texsize),u_pixel_coord_upper:new c.c4(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c4(v,t.u_pixel_coord_lower),u_scale:new c.c3(v,t.u_scale),u_fade:new c.br(v,t.u_fade)}),fill:(v,t)=>({u_fill_translate:new c.c4(v,t.u_fill_translate)}),fillPattern:(v,t)=>({u_image:new c.b$(v,t.u_image),u_texsize:new c.c4(v,t.u_texsize),u_pixel_coord_upper:new c.c4(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c4(v,t.u_pixel_coord_lower),u_scale:new c.c3(v,t.u_scale),u_fade:new c.br(v,t.u_fade),u_fill_translate:new c.c4(v,t.u_fill_translate)}),fillOutline:(v,t)=>({u_world:new c.c4(v,t.u_world),u_fill_translate:new c.c4(v,t.u_fill_translate)}),fillOutlinePattern:(v,t)=>({u_world:new c.c4(v,t.u_world),u_image:new c.b$(v,t.u_image),u_texsize:new c.c4(v,t.u_texsize),u_pixel_coord_upper:new c.c4(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c4(v,t.u_pixel_coord_lower),u_scale:new c.c3(v,t.u_scale),u_fade:new c.br(v,t.u_fade),u_fill_translate:new c.c4(v,t.u_fill_translate)}),circle:(v,t)=>({u_camera_to_center_distance:new c.br(v,t.u_camera_to_center_distance),u_scale_with_map:new c.b$(v,t.u_scale_with_map),u_pitch_with_map:new c.b$(v,t.u_pitch_with_map),u_extrude_scale:new c.c4(v,t.u_extrude_scale),u_device_pixel_ratio:new c.br(v,t.u_device_pixel_ratio),u_globe_extrude_scale:new c.br(v,t.u_globe_extrude_scale),u_translate:new c.c4(v,t.u_translate)}),collisionBox:(v,t)=>({u_pixel_extrude_scale:new c.c4(v,t.u_pixel_extrude_scale)}),collisionCircle:(v,t)=>({u_viewport_size:new c.c4(v,t.u_viewport_size)}),debug:(v,t)=>({u_color:new c.c0(v,t.u_color),u_overlay:new c.b$(v,t.u_overlay),u_overlay_scale:new c.br(v,t.u_overlay_scale)}),depth:M,clippingMask:M,heatmap:(v,t)=>({u_extrude_scale:new c.br(v,t.u_extrude_scale),u_intensity:new c.br(v,t.u_intensity),u_globe_extrude_scale:new c.br(v,t.u_globe_extrude_scale)}),heatmapTexture:(v,t)=>({u_matrix:new c.c1(v,t.u_matrix),u_world:new c.c4(v,t.u_world),u_image:new c.b$(v,t.u_image),u_color_ramp:new c.b$(v,t.u_color_ramp),u_opacity:new c.br(v,t.u_opacity)}),hillshade:(v,t)=>({u_image:new c.b$(v,t.u_image),u_latrange:new c.c4(v,t.u_latrange),u_exaggeration:new c.br(v,t.u_exaggeration),u_altitudes:new c.ca(v,t.u_altitudes),u_azimuths:new c.ca(v,t.u_azimuths),u_accent:new c.c0(v,t.u_accent),u_method:new c.b$(v,t.u_method),u_shadows:new c.c9(v,t.u_shadows),u_highlights:new c.c9(v,t.u_highlights)}),hillshadePrepare:(v,t)=>({u_matrix:new c.c1(v,t.u_matrix),u_image:new c.b$(v,t.u_image),u_dimension:new c.c4(v,t.u_dimension),u_zoom:new c.br(v,t.u_zoom),u_unpack:new c.c2(v,t.u_unpack)}),colorRelief:(v,t)=>({u_image:new c.b$(v,t.u_image),u_unpack:new c.c2(v,t.u_unpack),u_dimension:new c.c4(v,t.u_dimension),u_elevation_stops:new c.b$(v,t.u_elevation_stops),u_color_stops:new c.b$(v,t.u_color_stops),u_color_ramp_size:new c.b$(v,t.u_color_ramp_size),u_opacity:new c.br(v,t.u_opacity)}),line:(v,t)=>({u_translation:new c.c4(v,t.u_translation),u_ratio:new c.br(v,t.u_ratio),u_device_pixel_ratio:new c.br(v,t.u_device_pixel_ratio),u_units_to_pixels:new c.c4(v,t.u_units_to_pixels)}),lineGradient:(v,t)=>({u_translation:new c.c4(v,t.u_translation),u_ratio:new c.br(v,t.u_ratio),u_device_pixel_ratio:new c.br(v,t.u_device_pixel_ratio),u_units_to_pixels:new c.c4(v,t.u_units_to_pixels),u_image:new c.b$(v,t.u_image),u_image_height:new c.br(v,t.u_image_height)}),linePattern:(v,t)=>({u_translation:new c.c4(v,t.u_translation),u_texsize:new c.c4(v,t.u_texsize),u_ratio:new c.br(v,t.u_ratio),u_device_pixel_ratio:new c.br(v,t.u_device_pixel_ratio),u_image:new c.b$(v,t.u_image),u_units_to_pixels:new c.c4(v,t.u_units_to_pixels),u_scale:new c.c3(v,t.u_scale),u_fade:new c.br(v,t.u_fade)}),lineSDF:(v,t)=>({u_translation:new c.c4(v,t.u_translation),u_ratio:new c.br(v,t.u_ratio),u_device_pixel_ratio:new c.br(v,t.u_device_pixel_ratio),u_units_to_pixels:new c.c4(v,t.u_units_to_pixels),u_image:new c.b$(v,t.u_image),u_mix:new c.br(v,t.u_mix),u_tileratio:new c.br(v,t.u_tileratio),u_crossfade_from:new c.br(v,t.u_crossfade_from),u_crossfade_to:new c.br(v,t.u_crossfade_to),u_lineatlas_width:new c.br(v,t.u_lineatlas_width),u_lineatlas_height:new c.br(v,t.u_lineatlas_height)}),lineGradientSDF:(v,t)=>({u_translation:new c.c4(v,t.u_translation),u_ratio:new c.br(v,t.u_ratio),u_device_pixel_ratio:new c.br(v,t.u_device_pixel_ratio),u_units_to_pixels:new c.c4(v,t.u_units_to_pixels),u_image:new c.b$(v,t.u_image),u_image_height:new c.br(v,t.u_image_height),u_tileratio:new c.br(v,t.u_tileratio),u_crossfade_from:new c.br(v,t.u_crossfade_from),u_crossfade_to:new c.br(v,t.u_crossfade_to),u_image_dash:new c.b$(v,t.u_image_dash),u_mix:new c.br(v,t.u_mix),u_lineatlas_width:new c.br(v,t.u_lineatlas_width),u_lineatlas_height:new c.br(v,t.u_lineatlas_height)}),raster:(v,t)=>({u_tl_parent:new c.c4(v,t.u_tl_parent),u_scale_parent:new c.br(v,t.u_scale_parent),u_buffer_scale:new c.br(v,t.u_buffer_scale),u_fade_t:new c.br(v,t.u_fade_t),u_opacity:new c.br(v,t.u_opacity),u_image0:new c.b$(v,t.u_image0),u_image1:new c.b$(v,t.u_image1),u_brightness_low:new c.br(v,t.u_brightness_low),u_brightness_high:new c.br(v,t.u_brightness_high),u_saturation_factor:new c.br(v,t.u_saturation_factor),u_contrast_factor:new c.br(v,t.u_contrast_factor),u_spin_weights:new c.c3(v,t.u_spin_weights),u_coords_top:new c.c2(v,t.u_coords_top),u_coords_bottom:new c.c2(v,t.u_coords_bottom)}),symbolIcon:(v,t)=>({u_is_size_zoom_constant:new c.b$(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b$(v,t.u_is_size_feature_constant),u_size_t:new c.br(v,t.u_size_t),u_size:new c.br(v,t.u_size),u_camera_to_center_distance:new c.br(v,t.u_camera_to_center_distance),u_pitch:new c.br(v,t.u_pitch),u_rotate_symbol:new c.b$(v,t.u_rotate_symbol),u_aspect_ratio:new c.br(v,t.u_aspect_ratio),u_fade_change:new c.br(v,t.u_fade_change),u_label_plane_matrix:new c.c1(v,t.u_label_plane_matrix),u_coord_matrix:new c.c1(v,t.u_coord_matrix),u_is_text:new c.b$(v,t.u_is_text),u_pitch_with_map:new c.b$(v,t.u_pitch_with_map),u_is_along_line:new c.b$(v,t.u_is_along_line),u_is_variable_anchor:new c.b$(v,t.u_is_variable_anchor),u_texsize:new c.c4(v,t.u_texsize),u_texture:new c.b$(v,t.u_texture),u_translation:new c.c4(v,t.u_translation),u_pitched_scale:new c.br(v,t.u_pitched_scale)}),symbolSDF:(v,t)=>({u_is_size_zoom_constant:new c.b$(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b$(v,t.u_is_size_feature_constant),u_size_t:new c.br(v,t.u_size_t),u_size:new c.br(v,t.u_size),u_camera_to_center_distance:new c.br(v,t.u_camera_to_center_distance),u_pitch:new c.br(v,t.u_pitch),u_rotate_symbol:new c.b$(v,t.u_rotate_symbol),u_aspect_ratio:new c.br(v,t.u_aspect_ratio),u_fade_change:new c.br(v,t.u_fade_change),u_label_plane_matrix:new c.c1(v,t.u_label_plane_matrix),u_coord_matrix:new c.c1(v,t.u_coord_matrix),u_is_text:new c.b$(v,t.u_is_text),u_pitch_with_map:new c.b$(v,t.u_pitch_with_map),u_is_along_line:new c.b$(v,t.u_is_along_line),u_is_variable_anchor:new c.b$(v,t.u_is_variable_anchor),u_texsize:new c.c4(v,t.u_texsize),u_texture:new c.b$(v,t.u_texture),u_gamma_scale:new c.br(v,t.u_gamma_scale),u_device_pixel_ratio:new c.br(v,t.u_device_pixel_ratio),u_is_halo:new c.b$(v,t.u_is_halo),u_translation:new c.c4(v,t.u_translation),u_pitched_scale:new c.br(v,t.u_pitched_scale)}),symbolTextAndIcon:(v,t)=>({u_is_size_zoom_constant:new c.b$(v,t.u_is_size_zoom_constant),u_is_size_feature_constant:new c.b$(v,t.u_is_size_feature_constant),u_size_t:new c.br(v,t.u_size_t),u_size:new c.br(v,t.u_size),u_camera_to_center_distance:new c.br(v,t.u_camera_to_center_distance),u_pitch:new c.br(v,t.u_pitch),u_rotate_symbol:new c.b$(v,t.u_rotate_symbol),u_aspect_ratio:new c.br(v,t.u_aspect_ratio),u_fade_change:new c.br(v,t.u_fade_change),u_label_plane_matrix:new c.c1(v,t.u_label_plane_matrix),u_coord_matrix:new c.c1(v,t.u_coord_matrix),u_is_text:new c.b$(v,t.u_is_text),u_pitch_with_map:new c.b$(v,t.u_pitch_with_map),u_is_along_line:new c.b$(v,t.u_is_along_line),u_is_variable_anchor:new c.b$(v,t.u_is_variable_anchor),u_texsize:new c.c4(v,t.u_texsize),u_texsize_icon:new c.c4(v,t.u_texsize_icon),u_texture:new c.b$(v,t.u_texture),u_texture_icon:new c.b$(v,t.u_texture_icon),u_gamma_scale:new c.br(v,t.u_gamma_scale),u_device_pixel_ratio:new c.br(v,t.u_device_pixel_ratio),u_is_halo:new c.b$(v,t.u_is_halo),u_translation:new c.c4(v,t.u_translation),u_pitched_scale:new c.br(v,t.u_pitched_scale)}),background:(v,t)=>({u_opacity:new c.br(v,t.u_opacity),u_color:new c.c0(v,t.u_color)}),backgroundPattern:(v,t)=>({u_opacity:new c.br(v,t.u_opacity),u_image:new c.b$(v,t.u_image),u_pattern_tl_a:new c.c4(v,t.u_pattern_tl_a),u_pattern_br_a:new c.c4(v,t.u_pattern_br_a),u_pattern_tl_b:new c.c4(v,t.u_pattern_tl_b),u_pattern_br_b:new c.c4(v,t.u_pattern_br_b),u_texsize:new c.c4(v,t.u_texsize),u_mix:new c.br(v,t.u_mix),u_pattern_size_a:new c.c4(v,t.u_pattern_size_a),u_pattern_size_b:new c.c4(v,t.u_pattern_size_b),u_scale_a:new c.br(v,t.u_scale_a),u_scale_b:new c.br(v,t.u_scale_b),u_pixel_coord_upper:new c.c4(v,t.u_pixel_coord_upper),u_pixel_coord_lower:new c.c4(v,t.u_pixel_coord_lower),u_tile_units_to_pixels:new c.br(v,t.u_tile_units_to_pixels)}),terrain:(v,t)=>({u_texture:new c.b$(v,t.u_texture),u_ele_delta:new c.br(v,t.u_ele_delta),u_fog_matrix:new c.c1(v,t.u_fog_matrix),u_fog_color:new c.c0(v,t.u_fog_color),u_fog_ground_blend:new c.br(v,t.u_fog_ground_blend),u_fog_ground_blend_opacity:new c.br(v,t.u_fog_ground_blend_opacity),u_horizon_color:new c.c0(v,t.u_horizon_color),u_horizon_fog_blend:new c.br(v,t.u_horizon_fog_blend),u_is_globe_mode:new c.br(v,t.u_is_globe_mode)}),terrainDepth:(v,t)=>({u_ele_delta:new c.br(v,t.u_ele_delta)}),terrainCoords:(v,t)=>({u_texture:new c.b$(v,t.u_texture),u_terrain_coords_id:new c.br(v,t.u_terrain_coords_id),u_ele_delta:new c.br(v,t.u_ele_delta)}),projectionErrorMeasurement:(v,t)=>({u_input:new c.br(v,t.u_input),u_output_expected:new c.br(v,t.u_output_expected)}),atmosphere:(v,t)=>({u_sun_pos:new c.c3(v,t.u_sun_pos),u_atmosphere_blend:new c.br(v,t.u_atmosphere_blend),u_globe_position:new c.c3(v,t.u_globe_position),u_globe_radius:new c.br(v,t.u_globe_radius),u_inv_proj_matrix:new c.c1(v,t.u_inv_proj_matrix)}),sky:(v,t)=>({u_sky_color:new c.c0(v,t.u_sky_color),u_horizon_color:new c.c0(v,t.u_horizon_color),u_horizon:new c.c4(v,t.u_horizon),u_horizon_normal:new c.c4(v,t.u_horizon_normal),u_sky_horizon_blend:new c.br(v,t.u_sky_horizon_blend),u_sky_blend:new c.br(v,t.u_sky_blend)})};class G{constructor(t,a,h){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const K={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class le{constructor(t,a,h,p){this.length=a.length,this.attributes=h,this.itemSize=a.bytesPerElement,this.dynamicDraw=p,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),t.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let h=0;h<this.attributes.length;h++){const p=a.attributes[this.attributes[h].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,a,h){for(let p=0;p<this.attributes.length;p++){const b=this.attributes[p],T=a.attributes[b.name];T!==void 0&&t.vertexAttribPointer(T,b.components,t[K[b.type]],!1,this.itemSize,b.offset+this.itemSize*(h||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class _e{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ke extends _e{getDefault(){return c.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ct extends _e{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Bt extends _e{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Jt extends _e{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class sn extends _e{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class pn extends _e{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Nn extends _e{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class In extends _e{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class hi extends _e{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class hr extends _e{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class gi extends _e{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class Jr extends _e{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class vr extends _e{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Ls extends _e{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class To extends _e{getDefault(){return c.bq.transparent}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class So extends _e{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Al extends _e{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Ks extends _e{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Da extends _e{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class pu extends _e{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Eo extends _e{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ln extends _e{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Dh extends _e{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ds extends _e{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Lh extends _e{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class ps extends _e{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Pd extends _e{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class zh extends _e{getDefault(){return null}set(t){var a;if(t===this.current&&!this.dirty)return;const h=this.gl;Fr(h)?h.bindVertexArray(t):(a=h.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(t),this.current=t,this.dirty=!1}}class kl extends _e{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Af extends _e{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Oh extends _e{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Pl extends _e{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class qc extends Pl{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class La extends Pl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Rl extends Pl{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}const Dl="Framebuffer is not complete";class mu{constructor(t,a,h,p,b){this.context=t,this.width=a,this.height=h;const T=t.gl,k=this.framebuffer=T.createFramebuffer();if(this.colorAttachment=new qc(t,k),p)this.depthAttachment=b?new Rl(t,k):new La(t,k);else if(b)throw new Error("Stencil cannot be set without depth");if(T.checkFramebufferStatus(T.FRAMEBUFFER)!==T.FRAMEBUFFER_COMPLETE)throw new Error(Dl)}destroy(){const t=this.context.gl,a=this.colorAttachment.get();if(a&&t.deleteTexture(a),this.depthAttachment){const h=this.depthAttachment.get();h&&t.deleteRenderbuffer(h)}t.deleteFramebuffer(this.framebuffer)}}class Ll{constructor(t){var a,h;if(this.gl=t,this.clearColor=new Ke(this),this.clearDepth=new ct(this),this.clearStencil=new Bt(this),this.colorMask=new Jt(this),this.depthMask=new sn(this),this.stencilMask=new pn(this),this.stencilFunc=new Nn(this),this.stencilOp=new In(this),this.stencilTest=new hi(this),this.depthRange=new hr(this),this.depthTest=new gi(this),this.depthFunc=new Jr(this),this.blend=new vr(this),this.blendFunc=new Ls(this),this.blendColor=new To(this),this.blendEquation=new So(this),this.cullFace=new Al(this),this.cullFaceSide=new Ks(this),this.frontFace=new Da(this),this.program=new pu(this),this.activeTexture=new Eo(this),this.viewport=new Ln(this),this.bindFramebuffer=new Dh(this),this.bindRenderbuffer=new ds(this),this.bindTexture=new Lh(this),this.bindVertexBuffer=new ps(this),this.bindElementBuffer=new Pd(this),this.bindVertexArray=new zh(this),this.pixelStoreUnpack=new kl(this),this.pixelStoreUnpackPremultiplyAlpha=new Af(this),this.pixelStoreUnpackFlipY=new Oh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),Fr(t)){this.HALF_FLOAT=t.HALF_FLOAT;const p=t.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=t.RGBA16F)!==null&&a!==void 0?a:p?.RGBA16F_EXT,this.RGB16F=(h=t.RGB16F)!==null&&h!==void 0?h:p?.RGB16F_EXT,t.getExtension("EXT_color_buffer_float")}else{t.getExtension("EXT_color_buffer_half_float"),t.getExtension("OES_texture_half_float_linear");const p=t.getExtension("OES_texture_half_float");this.HALF_FLOAT=p?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a){return new G(this,t,a)}createVertexBuffer(t,a,h){return new le(this,t,a,h)}createRenderbuffer(t,a,h){const p=this.gl,b=p.createRenderbuffer();return this.bindRenderbuffer.set(b),p.renderbufferStorage(p.RENDERBUFFER,t,a,h),this.bindRenderbuffer.set(null),b}createFramebuffer(t,a,h,p){return new mu(this,t,a,h,p)}clear({color:t,depth:a,stencil:h}){const p=this.gl;let b=0;t&&(b|=p.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(b|=p.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),h!==void 0&&(b|=p.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),p.clear(b)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){c.bS(t.blendFunction,Qn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}createVertexArray(){var t;return Fr(this.gl)?this.gl.createVertexArray():(t=this.gl.getExtension("OES_vertex_array_object"))===null||t===void 0?void 0:t.createVertexArrayOES()}deleteVertexArray(t){var a;return Fr(this.gl)?this.gl.deleteVertexArray(t):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(t)}unbindVAO(){this.bindVertexArray.set(null)}}let ea;function ta(v,t,a,h,p){const b=v.context,T=v.transform,k=b.gl,z=v.useProgram("collisionBox"),F=[];let V=0,H=0;for(let ye=0;ye<h.length;ye++){const be=h[ye],De=t.getTile(be).getBucket(a);if(!De)continue;const we=p?De.textCollisionBox:De.iconCollisionBox,Oe=De.collisionCircleArray;Oe.length>0&&(F.push({circleArray:Oe,circleOffset:H,coord:be}),V+=Oe.length/4,H=V),we&&z.draw(b,k.LINES,bn.disabled,On.disabled,v.colorModeForRenderPass(),Tn.disabled,bo(v.transform),v.style.map.terrain&&v.style.map.terrain.getTerrainData(be),T.getProjectionData({overscaledTileID:be,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,null,v.transform.zoom,null,null,we.collisionVertexBuffer)}if(!p||!F.length)return;const Y=v.useProgram("collisionCircle"),J=new c.cb;J.resize(4*V),J._trim();let ae=0;for(const ye of F)for(let be=0;be<ye.circleArray.length/4;be++){const De=4*be,we=ye.circleArray[De+0],Oe=ye.circleArray[De+1],je=ye.circleArray[De+2],Ae=ye.circleArray[De+3];J.emplace(ae++,we,Oe,je,Ae,0),J.emplace(ae++,we,Oe,je,Ae,1),J.emplace(ae++,we,Oe,je,Ae,2),J.emplace(ae++,we,Oe,je,Ae,3)}(!ea||ea.length<2*V)&&(ea=(function(ye){const be=2*ye,De=new c.cd;De.resize(be),De._trim();for(let we=0;we<be;we++){const Oe=6*we;De.uint16[Oe+0]=4*we+0,De.uint16[Oe+1]=4*we+1,De.uint16[Oe+2]=4*we+2,De.uint16[Oe+3]=4*we+2,De.uint16[Oe+4]=4*we+3,De.uint16[Oe+5]=4*we+0}return De})(V));const ge=b.createIndexBuffer(ea,!0),ve=b.createVertexBuffer(J,c.cc.members,!0);for(const ye of F){const be=Vc(v.transform);Y.draw(b,k.TRIANGLES,bn.disabled,On.disabled,v.colorModeForRenderPass(),Tn.disabled,be,v.style.map.terrain&&v.style.map.terrain.getTerrainData(ye.coord),null,a.id,ve,ge,c.aY.simpleSegment(0,2*ye.circleOffset,ye.circleArray.length,ye.circleArray.length/2),null,v.transform.zoom,null,null,null)}ve.destroy(),ge.destroy()}const Mo=c.as(new Float32Array(16));function Co(v,t,a,h,p,b){const{horizontalAlign:T,verticalAlign:k}=c.aT(v);return new c.P((-(T-.5)*t/p+h[0])*b,(-(k-.5)*a/p+h[1])*b)}function Xa(v,t,a,h,p,b){const T=t.tileAnchorPoint.add(new c.P(t.translation[0],t.translation[1]));if(t.pitchWithMap){let k=h.mult(b);a||(k=k.rotate(-p));const z=T.add(k);return wn(z.x,z.y,t.pitchedLabelPlaneMatrix,t.getElevation).point}if(a){const k=Vn(t.tileAnchorPoint.x+1,t.tileAnchorPoint.y,t).point.sub(v),z=Math.atan(k.y/k.x)+(k.x<0?Math.PI:0);return v.add(h.rotate(z))}return v.add(h)}function Qo(v,t,a,h,p,b,T,k,z,F,V,H){const Y=v.text.placedSymbolArray,J=v.text.dynamicLayoutVertexArray,ae=v.icon.dynamicLayoutVertexArray,ge={};J.clear();for(let ve=0;ve<Y.length;ve++){const ye=Y.get(ve),be=ye.hidden||!ye.crossTileID||v.allowVerticalPlacement&&!ye.placedOrientation?null:h[ye.crossTileID];if(be){const De=new c.P(ye.anchorX,ye.anchorY),we={getElevation:H,width:p.width,height:p.height,pitchedLabelPlaneMatrix:b,pitchWithMap:a,transform:p,tileAnchorPoint:De,translation:F,unwrappedTileID:V},Oe=a?$r(De.x,De.y,we):Vn(De.x,De.y,we),je=ls(p.cameraToCenterDistance,Oe.signedDistanceFromCamera);let Ae=c.aB(v.textSizeData,k,ye)*je/c.aN;a&&(Ae*=v.tilePixelRatio/T);const{width:$e,height:ht,anchor:st,textOffset:ft,textBoxScale:pt}=be,Dt=Co(st,$e,ht,ft,pt,Ae),qt=p.getPitchedTextCorrection(De.x+F[0],De.y+F[1],V),Pt=Xa(Oe.point,we,t,Dt,-p.bearingInRadians,qt),an=v.allowVerticalPlacement&&ye.placedOrientation===c.aA.vertical?Math.PI/2:0;for(let Cn=0;Cn<ye.numGlyphs;Cn++)c.aH(J,Pt,an);z&&ye.associatedIconIndex>=0&&(ge[ye.associatedIconIndex]={shiftedAnchor:Pt,angle:an})}else As(ye.numGlyphs,J)}if(z){ae.clear();const ve=v.icon.placedSymbolArray;for(let ye=0;ye<ve.length;ye++){const be=ve.get(ye);if(be.hidden)As(be.numGlyphs,ae);else{const De=ge[ye];if(De)for(let we=0;we<be.numGlyphs;we++)c.aH(ae,De.shiftedAnchor,De.angle);else As(be.numGlyphs,ae)}}v.icon.dynamicLayoutVertexBuffer.updateData(ae)}v.text.dynamicLayoutVertexBuffer.updateData(J)}function kf(v,t,a){return a.iconsInText&&t?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function gu(v,t,a,h,p,b,T,k,z,F,V,H,Y){const J=v.context,ae=J.gl,ge=v.transform,ve=k==="map",ye=z==="map",be=k!=="viewport"&&a.layout.get("symbol-placement")!=="point",De=ve&&!ye&&!be,we=!a.layout.get("symbol-sort-key").isConstant();let Oe=!1;const je=v.getDepthModeForSublayer(0,bn.ReadOnly),Ae=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$e=[],ht=ge.getCircleRadiusCorrection();for(const st of h){const ft=t.getTile(st),pt=ft.getBucket(a);if(!pt)continue;const Dt=p?pt.text:pt.icon;if(!Dt||!Dt.segments.get().length||!Dt.hasVisibleVertices)continue;const qt=Dt.programConfigurations.get(a.id),Pt=p||pt.sdfIcons,an=p?pt.textSizeData:pt.iconSizeData,Cn=ye||ge.pitch!==0,ai=v.useProgram(kf(Pt,p,pt),qt),Ci=c.az(an,ge.zoom),li=v.style.map.terrain&&v.style.map.terrain.getTerrainData(st);let Fi,_i,Mr,zi,Cr=[0,0],er=null;if(p)_i=ft.glyphAtlasTexture,Mr=ae.LINEAR,Fi=ft.glyphAtlasTexture.size,pt.iconsInText&&(Cr=ft.imageAtlasTexture.size,er=ft.imageAtlasTexture,zi=Cn||v.options.rotating||v.options.zooming||an.kind==="composite"||an.kind==="camera"?ae.LINEAR:ae.NEAREST);else{const tr=a.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear;_i=ft.imageAtlasTexture,Mr=Pt||v.options.rotating||v.options.zooming||tr||Cn?ae.LINEAR:ae.NEAREST,Fi=ft.imageAtlasTexture.size}const ar=c.aO(ft,1,v.transform.zoom),ra=yr(ve,v.transform,ar),ga=c.N();c.aC(ga,ra);const no=Ms(ye,ve,v.transform,ar),fl=c.aP(ge,ft,b,T),Tu=ge.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!Y,applyTerrainMatrix:!0}),Yh=Ae&&pt.hasTextData(),Su=a.layout.get("icon-text-fit")!=="none"&&Yh&&pt.hasIconData();if(be){const tr=v.style.map.terrain?(Fa,Gi)=>v.style.map.terrain.getElevation(st,Fa,Gi):null,Ar=a.layout.get("text-rotation-alignment")==="map";Zs(pt,v,p,ra,ga,ye,F,Ar,st.toUnwrapped(),ge.width,ge.height,fl,tr)}const Qa=p&&Ae||Su,Ir=be||Qa?Mo:ye?ra:v.transform.clipSpaceToPixelsMatrix,Gr=Pt&&a.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let aa;aa=Pt?pt.iconsInText?o(an.kind,Ci,De,ye,be,Qa,v,Ir,no,fl,Fi,Cr,ht):_(an.kind,Ci,De,ye,be,Qa,v,Ir,no,fl,p,Fi,0,ht):ba(an.kind,Ci,De,ye,be,Qa,v,Ir,no,fl,p,Fi,ht);const vs={program:ai,buffers:Dt,uniformValues:aa,projectionData:Tu,atlasTexture:_i,atlasTextureIcon:er,atlasInterpolation:Mr,atlasInterpolationIcon:zi,isSDF:Pt,hasHalo:Gr};if(we&&pt.canOverlap){Oe=!0;const tr=Dt.segments.get();for(const Ar of tr)$e.push({segments:new c.aY([Ar]),sortKey:Ar.sortKey,state:vs,terrainData:li})}else $e.push({segments:Dt.segments,sortKey:0,state:vs,terrainData:li})}Oe&&$e.sort(((st,ft)=>st.sortKey-ft.sortKey));for(const st of $e){const ft=st.state;if(J.activeTexture.set(ae.TEXTURE0),ft.atlasTexture.bind(ft.atlasInterpolation,ae.CLAMP_TO_EDGE),ft.atlasTextureIcon&&(J.activeTexture.set(ae.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,ae.CLAMP_TO_EDGE)),ft.isSDF){const pt=ft.uniformValues;ft.hasHalo&&(pt.u_is_halo=1,ec(ft.buffers,st.segments,a,v,ft.program,je,V,H,pt,ft.projectionData,st.terrainData)),pt.u_is_halo=0}ec(ft.buffers,st.segments,a,v,ft.program,je,V,H,ft.uniformValues,ft.projectionData,st.terrainData)}}function ec(v,t,a,h,p,b,T,k,z,F,V){const H=h.context;p.draw(H,H.gl.TRIANGLES,b,T,k,Tn.backCCW,z,V,F,a.id,v.layoutVertexBuffer,v.indexBuffer,t,a.paint,h.transform.zoom,v.programConfigurations.get(a.id),v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer)}function Pf(v,t,a,h,p){const b=v.context,T=b.gl,k=On.disabled,z=new Qn([T.ONE,T.ONE],c.bq.transparent,[!0,!0,!0,!0]),F=t.getBucket(a);if(!F)return;const V=h.key;let H=a.heatmapFbos.get(V);H||(H=Ei(b,t.tileSize,t.tileSize),a.heatmapFbos.set(V,H)),b.bindFramebuffer.set(H.framebuffer),b.viewport.set([0,0,t.tileSize,t.tileSize]),b.clear({color:c.bq.transparent});const Y=F.programConfigurations.get(a.id),J=v.useProgram("heatmap",Y,!p),ae=v.transform.getProjectionData({overscaledTileID:t.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ge=v.style.map.terrain.getTerrainData(h);J.draw(b,T.TRIANGLES,bn.disabled,k,z,Tn.disabled,Ws(t,v.transform.zoom,a.paint.get("heatmap-intensity"),1),ge,ae,a.id,F.layoutVertexBuffer,F.indexBuffer,F.segments,a.paint,v.transform.zoom,Y)}function na(v,t,a,h,p){const b=v.context,T=b.gl,k=v.transform;b.setColorMode(v.colorModeForRenderPass());const z=Zn(b,t),F=a.key,V=t.heatmapFbos.get(F);if(!V)return;b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,V.colorAttachment.get()),b.activeTexture.set(T.TEXTURE1),z.bind(T.LINEAR,T.CLAMP_TO_EDGE);const H=k.getProjectionData({overscaledTileID:a,applyTerrainMatrix:p,applyGlobeMatrix:!h});v.useProgram("heatmapTexture").draw(b,T.TRIANGLES,bn.disabled,On.disabled,v.colorModeForRenderPass(),Tn.disabled,Ku(v,t,0,1),null,H,t.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments,t.paint,k.zoom),V.destroy(),t.heatmapFbos.delete(F)}function Ei(v,t,a){var h,p;const b=v.gl,T=b.createTexture();b.bindTexture(b.TEXTURE_2D,T),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);const k=(h=v.HALF_FLOAT)!==null&&h!==void 0?h:b.UNSIGNED_BYTE,z=(p=v.RGBA16F)!==null&&p!==void 0?p:b.RGBA;b.texImage2D(b.TEXTURE_2D,0,z,t,a,0,b.RGBA,k,null);const F=v.createFramebuffer(t,a,!1,!1);return F.colorAttachment.set(T),F}function Zn(v,t){return t.colorRampTexture||(t.colorRampTexture=new c.T(v,t.colorRamp,v.gl.RGBA)),t.colorRampTexture}function Jo(v,t,a,h,p,b,T,k){let z=256;if(p.stepInterpolant){const F=t.getSource().maxzoom,V=T.canonical.z===F?Math.ceil(1<<v.transform.maxZoom-T.canonical.z):1;z=c.ao(c.cf(b.maxLineLength/c.a5*1024*V),256,a.maxTextureSize)}return k.gradient=c.cg({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:z,image:k.gradient||void 0,clips:b.lineClipsArray}),k.texture?k.texture.update(k.gradient):k.texture=new c.T(a,k.gradient,h.RGBA),k.version=p.gradientVersion,k.texture}function ms(v,t,a,h,p){v.activeTexture.set(t.TEXTURE0),a.imageAtlasTexture.bind(t.LINEAR,t.CLAMP_TO_EDGE),h.updatePaintBuffers(p)}function Wi(v,t,a,h,p,b){(p||v.lineAtlas.dirty)&&(t.activeTexture.set(a.TEXTURE0),v.lineAtlas.bind(t)),h.updatePaintBuffers(b)}function $a(v,t,a,h,p,b,T){const k=b.gradients[p.id];let z=k.texture;p.gradientVersion!==k.version&&(z=Jo(v,t,a,h,p,b,T,k)),a.activeTexture.set(h.TEXTURE0),z.bind(p.stepInterpolant?h.NEAREST:h.LINEAR,h.CLAMP_TO_EDGE)}function gs(v,t,a,h,p,b,T,k,z){const F=b.gradients[p.id];let V=F.texture;p.gradientVersion!==F.version&&(V=Jo(v,t,a,h,p,b,T,F)),a.activeTexture.set(h.TEXTURE0),V.bind(p.stepInterpolant?h.NEAREST:h.LINEAR,h.CLAMP_TO_EDGE),a.activeTexture.set(h.TEXTURE1),v.lineAtlas.bind(a),k.updatePaintBuffers(z)}function Zc(v,t,a,h,p){if(!a||!h||!h.imageAtlas)return;const b=h.imageAtlas.patternPositions;let T=b[a.to.toString()],k=b[a.from.toString()];if(!T&&k&&(T=k),!k&&T&&(k=T),!T||!k){const z=p.getPaintProperty(t);T=b[z],k=b[z]}T&&k&&v.setConstantPatternPositions(T,k)}function Io(v,t,a,h,p,b,T,k){const z=v.context.gl,F="fill-pattern",V=a.paint.get(F),H=V&&V.constantOr(1),Y=a.getCrossfadeParameters();let J,ae,ge,ve,ye;const be=v.transform,De=a.paint.get("fill-translate"),we=a.paint.get("fill-translate-anchor");T?(ae=H&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=z.LINES):(ae=H?"fillPattern":"fill",J=z.TRIANGLES);const Oe=V.constantOr(null);for(const je of h){const Ae=t.getTile(je);if(H&&!Ae.patternsLoaded())continue;const $e=Ae.getBucket(a);if(!$e)continue;const ht=$e.programConfigurations.get(a.id),st=v.useProgram(ae,ht),ft=v.style.map.terrain&&v.style.map.terrain.getTerrainData(je);H&&(v.context.activeTexture.set(z.TEXTURE0),Ae.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ht.updatePaintBuffers(Y)),Zc(ht,F,Oe,Ae,a);const pt=be.getProjectionData({overscaledTileID:je,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),Dt=c.aP(be,Ae,De,we);if(T){ve=$e.indexBuffer2,ye=$e.segments2;const Pt=[z.drawingBufferWidth,z.drawingBufferHeight];ge=ae==="fillOutlinePattern"&&H?kh(v,Y,Ae,Pt,Dt):Cl(Pt,Dt)}else ve=$e.indexBuffer,ye=$e.segments,ge=H?Ko(v,Y,Ae,Dt):{u_fill_translate:Dt};const qt=v.stencilModeForClipping(je);st.draw(v.context,J,p,qt,b,Tn.backCCW,ge,ft,pt,a.id,$e.layoutVertexBuffer,ve,ye,a.paint,v.transform.zoom,ht)}}function Ao(v,t,a,h,p,b,T,k){const z=v.context,F=z.gl,V="fill-extrusion-pattern",H=a.paint.get(V),Y=H.constantOr(1),J=a.getCrossfadeParameters(),ae=a.paint.get("fill-extrusion-opacity"),ge=H.constantOr(null),ve=v.transform;for(const ye of h){const be=t.getTile(ye),De=be.getBucket(a);if(!De)continue;const we=v.style.map.terrain&&v.style.map.terrain.getTerrainData(ye),Oe=De.programConfigurations.get(a.id),je=v.useProgram(Y?"fillExtrusionPattern":"fillExtrusion",Oe);Y&&(v.context.activeTexture.set(F.TEXTURE0),be.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),Oe.updatePaintBuffers(J));const Ae=ve.getProjectionData({overscaledTileID:ye,applyGlobeMatrix:!k,applyTerrainMatrix:!0});Zc(Oe,V,ge,be,a);const $e=c.aP(ve,be,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),ht=a.paint.get("fill-extrusion-vertical-gradient"),st=Y?lu(v,ht,ae,$e,ye,J,be):Wu(v,ht,ae,$e);je.draw(z,z.gl.TRIANGLES,p,b,T,Tn.backCCW,st,we,Ae,a.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,a.paint,v.transform.zoom,Oe,v.style.map.terrain&&De.centroidVertexBuffer)}}function ko(v,t,a,h,p,b,T,k,z){var F;const V=v.style.projection,H=v.context,Y=v.transform,J=H.gl,ae=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],ge=v.useProgram("hillshade",null,!1,ae),ve=!v.options.moving;for(const ye of h){const be=t.getTile(ye),De=be.fbo;if(!De)continue;const we=V.getMeshFromTileID(H,ye.canonical,k,!0,"raster"),Oe=(F=v.style.map.terrain)===null||F===void 0?void 0:F.getTerrainData(ye);H.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_2D,De.colorAttachment.get());const je=Y.getProjectionData({overscaledTileID:ye,aligned:ve,applyGlobeMatrix:!z,applyTerrainMatrix:!0});ge.draw(H,J.TRIANGLES,b,p[ye.overscaledZ],T,Tn.backCCW,Il(v,be,a),Oe,je,a.id,we.vertexBuffer,we.indexBuffer,we.segments)}}function el(v,t,a,h,p,b,T,k,z){var F;const V=v.style.projection,H=v.context,Y=v.transform,J=H.gl,ae=v.useProgram("colorRelief"),ge=!v.options.moving;let ve=!0,ye=0;for(const be of h){const De=t.getTile(be),we=De.dem;if(ve){const st=J.getParameter(J.MAX_TEXTURE_SIZE),{elevationTexture:ft,colorTexture:pt}=a.getColorRampTextures(H,st,we.getUnpackVector());H.activeTexture.set(J.TEXTURE1),ft.bind(J.NEAREST,J.CLAMP_TO_EDGE),H.activeTexture.set(J.TEXTURE4),pt.bind(J.LINEAR,J.CLAMP_TO_EDGE),ve=!1,ye=ft.size[0]}if(!we||!we.data)continue;const Oe=we.stride,je=we.getPixels();if(H.activeTexture.set(J.TEXTURE0),H.pixelStoreUnpackPremultiplyAlpha.set(!1),De.demTexture=De.demTexture||v.getTileTexture(Oe),De.demTexture){const st=De.demTexture;st.update(je,{premultiply:!1}),st.bind(J.LINEAR,J.CLAMP_TO_EDGE)}else De.demTexture=new c.T(H,je,J.RGBA,{premultiply:!1}),De.demTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const Ae=V.getMeshFromTileID(H,be.canonical,k,!0,"raster"),$e=(F=v.style.map.terrain)===null||F===void 0?void 0:F.getTerrainData(be),ht=Y.getProjectionData({overscaledTileID:be,aligned:ge,applyGlobeMatrix:!z,applyTerrainMatrix:!0});ae.draw(H,J.TRIANGLES,b,p[be.overscaledZ],T,Tn.backCCW,Qu(a,De.dem,ye),$e,ht,a.id,Ae.vertexBuffer,Ae.indexBuffer,Ae.segments)}}const tl=[new c.P(0,0),new c.P(c.a5,0),new c.P(c.a5,c.a5),new c.P(0,c.a5)];function zs(v,t,a,h,p,b,T,k,z=!1,F=!1){const V=h[h.length-1].overscaledZ,H=v.context,Y=H.gl,J=v.useProgram("raster"),ae=v.transform,ge=v.style.projection,ve=v.colorModeForRenderPass(),ye=!v.options.moving,be=a.paint.get("raster-opacity"),De=a.paint.get("raster-resampling"),we=a.paint.get("raster-fade-duration"),Oe=!!v.style.map.terrain;for(const je of h){const Ae=v.getDepthModeForSublayer(je.overscaledZ-V,be===1?bn.ReadWrite:bn.ReadOnly,Y.LESS),$e=t.getTile(je),ht=De==="nearest"?Y.NEAREST:Y.LINEAR;H.activeTexture.set(Y.TEXTURE0),$e.texture.bind(ht,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),H.activeTexture.set(Y.TEXTURE1);const{parentTile:st,parentScaleBy:ft,parentTopLeft:pt,fadeValues:Dt}=Po($e,t,we,Oe);$e.fadeOpacity=Dt.tileOpacity,st?(st.fadeOpacity=Dt.parentTileOpacity,st.texture.bind(ht,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST)):$e.texture.bind(ht,Y.CLAMP_TO_EDGE,Y.LINEAR_MIPMAP_NEAREST),$e.texture.useMipmap&&H.extTextureFilterAnisotropic&&v.transform.pitch>20&&Y.texParameterf(Y.TEXTURE_2D,H.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,H.extTextureFilterAnisotropicMax);const qt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(je),Pt=ae.getProjectionData({overscaledTileID:je,aligned:ye,applyGlobeMatrix:!F,applyTerrainMatrix:!0}),an=du(pt,ft,Dt.fadeMix,a,k),Cn=ge.getMeshFromTileID(H,je.canonical,b,T,"raster");J.draw(H,Y.TRIANGLES,Ae,p?p[je.overscaledZ]:On.disabled,ve,z?Tn.frontCCW:Tn.backCCW,an,qt,Pt,a.id,Cn.vertexBuffer,Cn.indexBuffer,Cn.segments)}}function Po(v,t,a,h){const p={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||h)return p;if(v.fadingParentID){const b=t.getLoadedTile(v.fadingParentID);if(!b)return p;const T=Math.pow(2,b.tileID.overscaledZ-v.tileID.overscaledZ),k=[v.tileID.canonical.x*T%1,v.tileID.canonical.y*T%1],z=(function(F,V,H){const Y=dt(),J=(Y-V.timeAdded)/H,ae=F.fadingDirection===Ze.Incoming,ge=c.ao((Y-F.timeAdded)/H,0,1),ve=c.ao(1-J,0,1),ye=ae?ge:ve;return{tileOpacity:ye,parentTileOpacity:ae?ve:ge,fadeMix:{opacity:1,mix:1-ye}}})(v,b,a);return{parentTile:b,parentScaleBy:T,parentTopLeft:k,fadeValues:z}}if(v.selfFading){const b=(function(T,k){const z=(dt()-T.timeAdded)/k,F=c.ao(z,0,1);return{tileOpacity:F,fadeMix:{opacity:F,mix:0}}})(v,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:b}}return p}const nl=new c.bq(1,0,0,1),Ro=new c.bq(0,1,0,1),Nh=new c.bq(0,0,1,1),Bh=new c.bq(1,0,1,1),Os=new c.bq(0,1,1,1);function tc(v,t,a,h){xr(v,0,t+a/2,v.transform.width,a,h)}function il(v,t,a,h){xr(v,t-a/2,0,a,v.transform.height,h)}function xr(v,t,a,h,p,b){const T=v.context,k=T.gl;k.enable(k.SCISSOR_TEST),k.scissor(t*v.pixelRatio,a*v.pixelRatio,h*v.pixelRatio,p*v.pixelRatio),T.clear({color:b}),k.disable(k.SCISSOR_TEST)}function Yc(v,t,a){const h=v.context,p=h.gl,b=v.useProgram("debug"),T=bn.disabled,k=On.disabled,z=v.colorModeForRenderPass(),F="$debug",V=v.style.map.terrain&&v.style.map.terrain.getTerrainData(a);h.activeTexture.set(p.TEXTURE0);const H=t.getTileByID(a.key).latestRawTileData,Y=Math.floor((H&&H.byteLength||0)/1024),J=t.getTile(a).tileSize,ae=512/Math.min(J,512)*(a.overscaledZ/v.transform.zoom)*.5;let ge=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(ge+=` => ${a.overscaledZ}`),(function(ye,be){ye.initDebugOverlayCanvas();const De=ye.debugOverlayCanvas,we=ye.context.gl,Oe=ye.debugOverlayCanvas.getContext("2d");Oe.clearRect(0,0,De.width,De.height),Oe.shadowColor="white",Oe.shadowBlur=2,Oe.lineWidth=1.5,Oe.strokeStyle="white",Oe.textBaseline="top",Oe.font="bold 36px Open Sans, sans-serif",Oe.fillText(be,5,5),Oe.strokeText(be,5,5),ye.debugOverlayTexture.update(De),ye.debugOverlayTexture.bind(we.LINEAR,we.CLAMP_TO_EDGE)})(v,`${ge} ${Y}kB`);const ve=v.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(h,p.TRIANGLES,T,k,Qn.alphaBlended,Tn.disabled,cu(c.bq.transparent,ae),null,ve,F,v.debugBuffer,v.quadTriangleIndexBuffer,v.debugSegments),b.draw(h,p.LINE_STRIP,T,k,z,Tn.disabled,cu(c.bq.red),V,ve,F,v.debugBuffer,v.tileBorderIndexBuffer,v.debugSegments)}function Fh(v,t,a,h){const{isRenderingGlobe:p}=h,b=v.context,T=b.gl,k=v.transform,z=v.colorModeForRenderPass(),F=v.getDepthModeFor3D(),V=v.useProgram("terrain");b.bindFramebuffer.set(null),b.viewport.set([0,0,v.width,v.height]);for(const H of a){const Y=t.getTerrainMesh(H.tileID),J=v.renderToTexture.getTexture(H),ae=t.getTerrainData(H.tileID);b.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,J.texture);const ge=t.getMeshFrameDelta(k.zoom),ve=k.calculateFogMatrix(H.tileID.toUnwrapped()),ye=Ih(ge,ve,v.style.sky,k.pitch,p),be=k.getProjectionData({overscaledTileID:H.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});V.draw(b,T.TRIANGLES,F,On.disabled,z,Tn.backCCW,ye,ae,be,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}}function Rf(v,t){if(!t.mesh){const a=new c.aX;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const h=new c.aZ;h.emplaceBack(0,1,2),h.emplaceBack(0,2,3),t.mesh=new ei(v.createVertexBuffer(a,Ha.members),v.createIndexBuffer(h),c.aY.simpleSegment(0,0,a.length,h.length))}return t.mesh}class Rd{constructor(t,a){this.context=new Ll(t),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.as(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=di.maxOverzooming+di.maxUnderzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $i}resize(t,a,h){if(this.width=Math.floor(t*h),this.height=Math.floor(a*h),this.pixelRatio=h,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,a=new c.aX;a.emplaceBack(0,0),a.emplaceBack(c.a5,0),a.emplaceBack(0,c.a5),a.emplaceBack(c.a5,c.a5),this.tileExtentBuffer=t.createVertexBuffer(a,Ha.members),this.tileExtentSegments=c.aY.simpleSegment(0,0,4,2);const h=new c.aX;h.emplaceBack(0,0),h.emplaceBack(c.a5,0),h.emplaceBack(0,c.a5),h.emplaceBack(c.a5,c.a5),this.debugBuffer=t.createVertexBuffer(h,Ha.members),this.debugSegments=c.aY.simpleSegment(0,0,4,5);const p=new c.ci;p.emplaceBack(0,0,0,0),p.emplaceBack(c.a5,0,c.a5,0),p.emplaceBack(0,c.a5,0,c.a5),p.emplaceBack(c.a5,c.a5,c.a5,c.a5),this.rasterBoundsBuffer=t.createVertexBuffer(p,Ch.members),this.rasterBoundsSegments=c.aY.simpleSegment(0,0,4,2);const b=new c.aX;b.emplaceBack(0,0),b.emplaceBack(c.a5,0),b.emplaceBack(0,c.a5),b.emplaceBack(c.a5,c.a5),this.rasterBoundsBufferPosOnly=t.createVertexBuffer(b,Ha.members),this.rasterBoundsSegmentsPosOnly=c.aY.simpleSegment(0,0,4,5);const T=new c.aX;T.emplaceBack(0,0),T.emplaceBack(1,0),T.emplaceBack(0,1),T.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(T,Ha.members),this.viewportSegments=c.aY.simpleSegment(0,0,4,2);const k=new c.cj;k.emplaceBack(0),k.emplaceBack(1),k.emplaceBack(3),k.emplaceBack(2),k.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(k);const z=new c.aZ;z.emplaceBack(1,0,2),z.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(z);const F=this.context.gl;this.stencilClearMode=new On({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.tileExtentMesh=new ei(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const t=this.context,a=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const h=c.N();c.c8(h,0,this.width,this.height,0,0,1),c.Q(h,h,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const p={mainMatrix:h,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:h};this.useProgram("clippingMask",null,!0).draw(t,a.TRIANGLES,bn.disabled,this.stencilClearMode,Qn.disabled,Tn.disabled,null,null,p,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,a,h){if(this.currentStencilSource===t.source||!t.isTileClipped()||!a||!a.length)return;this.currentStencilSource=t.source,this.nextStencilID+a.length>256&&this.clearStencil();const p=this.context;p.setColorMode(Qn.disabled),p.setDepthMode(bn.disabled);const b={};for(const T of a)b[T.key]=this.nextStencilID++;this._renderTileMasks(b,a,h,!0),this._renderTileMasks(b,a,h,!1),this._tileClippingMaskIDs=b}_renderTileMasks(t,a,h,p){const b=this.context,T=b.gl,k=this.style.projection,z=this.transform,F=this.useProgram("clippingMask");for(const V of a){const H=t[V.key],Y=this.style.map.terrain&&this.style.map.terrain.getTerrainData(V),J=k.getMeshFromTileID(this.context,V.canonical,p,!0,"stencil"),ae=z.getProjectionData({overscaledTileID:V,applyGlobeMatrix:!h,applyTerrainMatrix:!0});F.draw(b,T.TRIANGLES,bn.disabled,new On({func:T.ALWAYS,mask:0},H,255,T.KEEP,T.KEEP,T.REPLACE),Qn.disabled,h?Tn.disabled:Tn.backCCW,null,Y,ae,"$clipping",J.vertexBuffer,J.indexBuffer,J.segments)}}_renderTilesDepthBuffer(){const t=this.context,a=t.gl,h=this.style.projection,p=this.transform,b=this.useProgram("depth"),T=this.getDepthModeFor3D(),k=ki(p,{tileSize:p.tileSize});for(const z of k){const F=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z),V=h.getMeshFromTileID(this.context,z.canonical,!0,!0,"raster"),H=p.getProjectionData({overscaledTileID:z,applyGlobeMatrix:!0,applyTerrainMatrix:!0});b.draw(t,a.TRIANGLES,T,On.disabled,Qn.disabled,Tn.backCCW,null,F,H,"$clipping",V.vertexBuffer,V.indexBuffer,V.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new On({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){const a=this.context.gl;return new On({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(t){const a=this.context.gl,h=t.sort(((T,k)=>k.overscaledZ-T.overscaledZ)),p=h[h.length-1].overscaledZ,b=h[0].overscaledZ-p+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let k=0;k<b;k++)T[k+p]=new On({func:a.GEQUAL,mask:255},k+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[T,h]}return[{[p]:On.disabled},h]}stencilConfigForOverlapTwoPass(t){const a=this.context.gl,h=t.sort(((T,k)=>k.overscaledZ-T.overscaledZ)),p=h[h.length-1].overscaledZ,b=h[0].overscaledZ-p+1;if(this.clearStencil(),b>1){const T={},k={};for(let z=0;z<b;z++)T[z+p]=new On({func:a.GREATER,mask:255},b+1+z,255,a.KEEP,a.KEEP,a.REPLACE),k[z+p]=new On({func:a.GREATER,mask:255},1+z,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*b+1,[T,k,h]}return this.nextStencilID=3,[{[p]:new On({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[p]:new On({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},h]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Qn([t.CONSTANT_COLOR,t.ONE],new c.bq(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Qn.unblended:Qn.alphaBlended}getDepthModeForSublayer(t,a,h){if(!this.opaquePassEnabledForLayer())return bn.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new bn(h||this.context.gl.LEQUAL,a,[p,p])}getDepthModeFor3D(){return new bn(this.context.gl.LEQUAL,bn.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,a){var h,p;this.style=t,this.options=a,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(dt()),this.imageManager.beginFrame();const b=this.style._order,T=this.style.tileManagers,k={},z={},F={},V={isRenderingToTexture:!1,isRenderingGlobe:((h=t.projection)===null||h===void 0?void 0:h.transitionState)>0};for(const Y in T){const J=T[Y];J.used&&J.prepare(this.context),k[Y]=J.getVisibleCoordinates(!1),z[Y]=k[Y].slice().reverse(),F[Y]=J.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let Y=0;Y<b.length;Y++)if(this.style._layers[b[Y]].is3D()){this.opaquePassCutoff=Y;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const Y of b){const J=this.style._layers[Y];if(!J.hasOffscreenPass()||J.isHidden(this.transform.zoom))continue;const ae=z[J.source];(J.type==="custom"||ae.length)&&this.renderLayer(this,T[J.source],J,ae,V)}if((p=this.style.projection)===null||p===void 0||p.updateGPUdependent({context:this.context,useProgram:Y=>this.useProgram(Y)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?c.bq.black:c.bq.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(Y,J){const ae=Y.context,ge=ae.gl,ve=((je,Ae,$e)=>{const ht=Math.cos(Ae.rollInRadians),st=Math.sin(Ae.rollInRadians),ft=zn(Ae),pt=Ae.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:je.properties.get("sky-color"),u_horizon_color:je.properties.get("horizon-color"),u_horizon:[(Ae.width/2-ft*st)*$e,(Ae.height/2+ft*ht)*$e],u_horizon_normal:[-st,ht],u_sky_horizon_blend:je.properties.get("sky-horizon-blend")*Ae.height/2*$e,u_sky_blend:pt}})(J,Y.style.map.transform,Y.pixelRatio),ye=new bn(ge.LEQUAL,bn.ReadWrite,[0,1]),be=On.disabled,De=Y.colorModeForRenderPass(),we=Y.useProgram("sky"),Oe=Rf(ae,J);we.draw(ae,ge.TRIANGLES,ye,be,De,Tn.disabled,ve,null,void 0,"sky",Oe.vertexBuffer,Oe.indexBuffer,Oe.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const Y=this.style._layers[b[this.currentLayer]],J=T[Y.source],ae=k[Y.source];this._renderTileClippingMasks(Y,ae,!1),this.renderLayer(this,J,Y,ae,V)}this.renderPass="translucent";let H=!1;for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const Y=this.style._layers[b[this.currentLayer]],J=T[Y.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(Y,V))continue;this.opaquePassEnabledForLayer()||H||(H=!0,V.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ae=(Y.type==="symbol"?F:z)[Y.source];this._renderTileClippingMasks(Y,k[Y.source],!!this.renderToTexture),this.renderLayer(this,J,Y,ae,V)}if(V.isRenderingGlobe&&(function(Y,J,ae){const ge=Y.context,ve=ge.gl,ye=Y.useProgram("atmosphere"),be=new bn(ve.LEQUAL,bn.ReadOnly,[0,1]),De=Y.transform,we=(function(pt,Dt){const qt=pt.properties.get("position"),Pt=[-qt.x,-qt.y,-qt.z],an=c.as(new Float64Array(16));return pt.properties.get("anchor")==="map"&&(c.bh(an,an,Dt.rollInRadians),c.bi(an,an,-Dt.pitchInRadians),c.bh(an,an,Dt.bearingInRadians),c.bi(an,an,Dt.center.lat*Math.PI/180),c.bK(an,an,-Dt.center.lng*Math.PI/180)),c.ch(Pt,Pt,an),Pt})(ae,Y.transform),Oe=De.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),je=J.properties.get("atmosphere-blend")*Oe.projectionTransition;if(je===0)return;const Ae=Ra(De.worldSize,De.center.lat),$e=De.inverseProjectionMatrix,ht=new Float64Array(4);ht[3]=1,c.aI(ht,ht,De.modelViewProjectionMatrix),ht[0]/=ht[3],ht[1]/=ht[3],ht[2]/=ht[3],ht[3]=1,c.aI(ht,ht,$e),ht[0]/=ht[3],ht[1]/=ht[3],ht[2]/=ht[3],ht[3]=1;const st=((pt,Dt,qt,Pt,an)=>({u_sun_pos:pt,u_atmosphere_blend:Dt,u_globe_position:qt,u_globe_radius:Pt,u_inv_proj_matrix:an}))(we,je,[ht[0],ht[1],ht[2]],Ae,$e),ft=Rf(ge,J);ye.draw(ge,ve.TRIANGLES,be,On.disabled,Qn.alphaBlended,Tn.disabled,st,null,null,"atmosphere",ft.vertexBuffer,ft.indexBuffer,ft.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const Y=(function(J,ae){let ge=null;const ve=Object.values(J._layers).flatMap((we=>we.source&&!we.isHidden(ae)?[J.tileManagers[we.source]]:[])),ye=ve.filter((we=>we.getSource().type==="vector")),be=ve.filter((we=>we.getSource().type!=="vector")),De=we=>{(!ge||ge.getSource().maxzoom<we.getSource().maxzoom)&&(ge=we)};return ye.forEach((we=>De(we))),ge||be.forEach((we=>De(we))),ge})(this.style,this.transform.zoom);Y&&(function(J,ae,ge){for(let ve=0;ve<ge.length;ve++)Yc(J,ae,ge[ve])})(this,Y,Y.getVisibleCoordinates())}this.options.showPadding&&(function(Y){const J=Y.transform.padding;tc(Y,Y.transform.height-(J.top||0),3,nl),tc(Y,J.bottom||0,3,Ro),il(Y,J.left||0,3,Nh),il(Y,Y.transform.width-(J.right||0),3,Bh);const ae=Y.transform.centerPoint;(function(ge,ve,ye,be){xr(ge,ve-1,ye-10,2,20,be),xr(ge,ve-10,ye-1,20,2,be)})(Y,ae.x,Y.transform.height-ae.y,Os)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(t){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,h=this.transform.modelViewProjectionMatrix;let p=this.terrainFacilitator.dirty;p||(p=t?!c.ck(a,h):!c.cl(a,h)),p||(p=this.style.map.terrain.tileManager.anyTilesAfterTime(this.terrainFacilitator.renderTime)),p&&(c.cm(a,h),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(b,T){const k=b.context,z=k.gl,F=b.transform,V=Qn.unblended,H=new bn(z.LEQUAL,bn.ReadWrite,[0,1]),Y=T.tileManager.getRenderableTiles(),J=b.useProgram("terrainDepth");k.bindFramebuffer.set(T.getFramebuffer("depth").framebuffer),k.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),k.clear({color:c.bq.transparent,depth:1});for(const ae of Y){const ge=T.getTerrainMesh(ae.tileID),ve=T.getTerrainData(ae.tileID),ye=F.getProjectionData({overscaledTileID:ae.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),be={u_ele_delta:T.getMeshFrameDelta(F.zoom)};J.draw(k,z.TRIANGLES,H,On.disabled,V,Tn.backCCW,be,ve,ye,"terrain",ge.vertexBuffer,ge.indexBuffer,ge.segments)}k.bindFramebuffer.set(null),k.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain),(function(b,T){const k=b.context,z=k.gl,F=b.transform,V=Qn.unblended,H=new bn(z.LEQUAL,bn.ReadWrite,[0,1]),Y=T.getCoordsTexture(),J=T.tileManager.getRenderableTiles(),ae=b.useProgram("terrainCoords");k.bindFramebuffer.set(T.getFramebuffer("coords").framebuffer),k.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),k.clear({color:c.bq.transparent,depth:1}),T.coordsIndex=[];for(const ge of J){const ve=T.getTerrainMesh(ge.tileID),ye=T.getTerrainData(ge.tileID);k.activeTexture.set(z.TEXTURE0),z.bindTexture(z.TEXTURE_2D,Y.texture);const be={u_terrain_coords_id:(255-T.coordsIndex.length)/255,u_texture:0,u_ele_delta:T.getMeshFrameDelta(F.zoom)},De=F.getProjectionData({overscaledTileID:ge.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ae.draw(k,z.TRIANGLES,H,On.disabled,V,Tn.backCCW,be,ye,De,"terrain",ve.vertexBuffer,ve.indexBuffer,ve.segments),T.coordsIndex.push(ge.tileID.key)}k.bindFramebuffer.set(null),k.viewport.set([0,0,b.width,b.height])})(this,this.style.map.terrain))}renderLayer(t,a,h,p,b){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="custom"||(p||[]).length)&&(this.id=h.id,c.cn(h)?(function(T,k,z,F,V,H){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:Y}=H,J=On.disabled,ae=T.colorModeForRenderPass();(z._unevaluatedLayout.hasValue("text-variable-anchor")||z._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(ge,ve,ye,be,De,we,Oe,je,Ae){const $e=ve.transform,ht=ve.style.map.terrain,st=De==="map",ft=we==="map";for(const pt of ge){const Dt=be.getTile(pt),qt=Dt.getBucket(ye);if(!qt||!qt.text||!qt.text.segments.get().length)continue;const Pt=c.az(qt.textSizeData,$e.zoom),an=c.aO(Dt,1,ve.transform.zoom),Cn=yr(st,ve.transform,an),ai=ye.layout.get("icon-text-fit")!=="none"&&qt.hasIconData();if(Pt){const Ci=Math.pow(2,$e.zoom-Dt.tileID.overscaledZ),li=ht?(Fi,_i)=>ht.getElevation(pt,Fi,_i):null;Qo(qt,st,ft,Ae,$e,Cn,Ci,Pt,ai,c.aP($e,Dt,Oe,je),pt.toUnwrapped(),li)}}})(F,T,z,k,z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),V),z.paint.get("icon-opacity").constantOr(1)!==0&&gu(T,k,z,F,!1,z.paint.get("icon-translate"),z.paint.get("icon-translate-anchor"),z.layout.get("icon-rotation-alignment"),z.layout.get("icon-pitch-alignment"),z.layout.get("icon-keep-upright"),J,ae,Y),z.paint.get("text-opacity").constantOr(1)!==0&&gu(T,k,z,F,!0,z.paint.get("text-translate"),z.paint.get("text-translate-anchor"),z.layout.get("text-rotation-alignment"),z.layout.get("text-pitch-alignment"),z.layout.get("text-keep-upright"),J,ae,Y),k.map.showCollisionBoxes&&(ta(T,k,z,F,!0),ta(T,k,z,F,!1))})(t,a,h,p,this.style.placement.variableOffsets,b):c.co(h)?(function(T,k,z,F,V){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:H}=V,Y=z.paint.get("circle-opacity"),J=z.paint.get("circle-stroke-width"),ae=z.paint.get("circle-stroke-opacity"),ge=!z.layout.get("circle-sort-key").isConstant();if(Y.constantOr(1)===0&&(J.constantOr(1)===0||ae.constantOr(1)===0))return;const ve=T.context,ye=ve.gl,be=T.transform,De=T.getDepthModeForSublayer(0,bn.ReadOnly),we=On.disabled,Oe=T.colorModeForRenderPass(),je=[],Ae=be.getCircleRadiusCorrection();for(let $e=0;$e<F.length;$e++){const ht=F[$e],st=k.getTile(ht),ft=st.getBucket(z);if(!ft)continue;const pt=z.paint.get("circle-translate"),Dt=z.paint.get("circle-translate-anchor"),qt=c.aP(be,st,pt,Dt),Pt=ft.programConfigurations.get(z.id),an=T.useProgram("circle",Pt),Cn=ft.layoutVertexBuffer,ai=ft.indexBuffer,Ci=T.style.map.terrain&&T.style.map.terrain.getTerrainData(ht),li={programConfiguration:Pt,program:an,layoutVertexBuffer:Cn,indexBuffer:ai,uniformValues:uu(T,st,z,qt,Ae),terrainData:Ci,projectionData:be.getProjectionData({overscaledTileID:ht,applyGlobeMatrix:!H,applyTerrainMatrix:!0})};if(ge){const Fi=ft.segments.get();for(const _i of Fi)je.push({segments:new c.aY([_i]),sortKey:_i.sortKey,state:li})}else je.push({segments:ft.segments,sortKey:0,state:li})}ge&&je.sort((($e,ht)=>$e.sortKey-ht.sortKey));for(const $e of je){const{programConfiguration:ht,program:st,layoutVertexBuffer:ft,indexBuffer:pt,uniformValues:Dt,terrainData:qt,projectionData:Pt}=$e.state;st.draw(ve,ye.TRIANGLES,De,we,Oe,Tn.backCCW,Dt,qt,Pt,z.id,ft,pt,$e.segments,z.paint,T.transform.zoom,ht)}})(t,a,h,p,b):c.cp(h)?(function(T,k,z,F,V){if(z.paint.get("heatmap-opacity")===0)return;const H=T.context,{isRenderingToTexture:Y,isRenderingGlobe:J}=V;if(T.style.map.terrain){for(const ae of F){const ge=k.getTile(ae);k.hasRenderableParent(ae)||(T.renderPass==="offscreen"?Pf(T,ge,z,ae,J):T.renderPass==="translucent"&&na(T,z,ae,Y,J))}H.viewport.set([0,0,T.width,T.height])}else T.renderPass==="offscreen"?(function(ae,ge,ve,ye){const be=ae.context,De=be.gl,we=ae.transform,Oe=On.disabled,je=new Qn([De.ONE,De.ONE],c.bq.transparent,[!0,!0,!0,!0]);(function(Ae,$e,ht){const st=Ae.gl;Ae.activeTexture.set(st.TEXTURE1),Ae.viewport.set([0,0,$e.width/4,$e.height/4]);let ft=ht.heatmapFbos.get(c.ce);ft?(st.bindTexture(st.TEXTURE_2D,ft.colorAttachment.get()),Ae.bindFramebuffer.set(ft.framebuffer)):(ft=Ei(Ae,$e.width/4,$e.height/4),ht.heatmapFbos.set(c.ce,ft))})(be,ae,ve),be.clear({color:c.bq.transparent});for(let Ae=0;Ae<ye.length;Ae++){const $e=ye[Ae];if(ge.hasRenderableParent($e))continue;const ht=ge.getTile($e),st=ht.getBucket(ve);if(!st)continue;const ft=st.programConfigurations.get(ve.id),pt=ae.useProgram("heatmap",ft),Dt=we.getProjectionData({overscaledTileID:$e,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),qt=we.getCircleRadiusCorrection();pt.draw(be,De.TRIANGLES,bn.disabled,Oe,je,Tn.backCCW,Ws(ht,we.zoom,ve.paint.get("heatmap-intensity"),qt),null,Dt,ve.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,ve.paint,we.zoom,ft)}be.viewport.set([0,0,ae.width,ae.height])})(T,k,z,F):T.renderPass==="translucent"&&(function(ae,ge){const ve=ae.context,ye=ve.gl;ve.setColorMode(ae.colorModeForRenderPass());const be=ge.heatmapFbos.get(c.ce);be&&(ve.activeTexture.set(ye.TEXTURE0),ye.bindTexture(ye.TEXTURE_2D,be.colorAttachment.get()),ve.activeTexture.set(ye.TEXTURE1),Zn(ve,ge).bind(ye.LINEAR,ye.CLAMP_TO_EDGE),ae.useProgram("heatmapTexture").draw(ve,ye.TRIANGLES,bn.disabled,On.disabled,ae.colorModeForRenderPass(),Tn.disabled,Ku(ae,ge,0,1),null,null,ge.id,ae.viewportBuffer,ae.quadTriangleIndexBuffer,ae.viewportSegments,ge.paint,ae.transform.zoom))})(T,z)})(t,a,h,p,b):c.cq(h)?(function(T,k,z,F,V){if(T.renderPass!=="translucent")return;const{isRenderingToTexture:H}=V,Y=z.paint.get("line-opacity"),J=z.paint.get("line-width");if(Y.constantOr(1)===0||J.constantOr(1)===0)return;const ae=T.getDepthModeForSublayer(0,bn.ReadOnly),ge=T.colorModeForRenderPass(),ve=z.paint.get("line-dasharray"),ye=ve.constantOr(1),be=z.paint.get("line-pattern"),De=be.constantOr(1),we=z.paint.get("line-gradient"),Oe=z.getCrossfadeParameters();let je;je=De?"linePattern":ye&&we?"lineGradientSDF":ye?"lineSDF":we?"lineGradient":"line";const Ae=T.context,$e=Ae.gl,ht=T.transform;let st=!0;for(const ft of F){const pt=k.getTile(ft);if(De&&!pt.patternsLoaded())continue;const Dt=pt.getBucket(z);if(!Dt)continue;const qt=Dt.programConfigurations.get(z.id),Pt=T.context.program.get(),an=T.useProgram(je,qt),Cn=st||an.program!==Pt,ai=T.style.map.terrain&&T.style.map.terrain.getTerrainData(ft),Ci=be.constantOr(null),li=ve&&ve.constantOr(null);if(Ci&&pt.imageAtlas){const Cr=pt.imageAtlas,er=Cr.patternPositions[Ci.to.toString()],ar=Cr.patternPositions[Ci.from.toString()];er&&ar&&qt.setConstantPatternPositions(er,ar)}else if(li){const Cr=z.layout.get("line-cap")==="round",er=T.lineAtlas.getDash(li.to,Cr),ar=T.lineAtlas.getDash(li.from,Cr);qt.setConstantDashPositions(er,ar)}const Fi=ht.getProjectionData({overscaledTileID:ft,applyGlobeMatrix:!H,applyTerrainMatrix:!0}),_i=ht.getPixelScale();let Mr;De?(Mr=Ju(T,pt,z,_i,Oe),ms(Ae,$e,pt,qt,Oe)):ye&&we?(Mr=wo(T,pt,z,_i,Oe,Dt.lineClipsArray.length),gs(T,k,Ae,$e,z,Dt,ft,qt,Oe)):ye?(Mr=xa(T,pt,z,_i,Oe),Wi(T,Ae,$e,qt,Cn,Oe)):we?(Mr=Gc(T,pt,z,_i,Dt.lineClipsArray.length),$a(T,k,Ae,$e,z,Dt,ft)):Mr=hu(T,pt,z,_i);const zi=T.stencilModeForClipping(ft);an.draw(Ae,$e.TRIANGLES,ae,zi,ge,Tn.disabled,Mr,ai,Fi,z.id,Dt.layoutVertexBuffer,Dt.indexBuffer,Dt.segments,z.paint,T.transform.zoom,qt,Dt.layoutVertexBuffer2),st=!1}})(t,a,h,p,b):c.cr(h)?(function(T,k,z,F,V){const H=z.paint.get("fill-color"),Y=z.paint.get("fill-opacity");if(Y.constantOr(1)===0)return;const{isRenderingToTexture:J}=V,ae=T.colorModeForRenderPass(),ge=z.paint.get("fill-pattern"),ve=T.opaquePassEnabledForLayer()&&!ge.constantOr(1)&&H.constantOr(c.bq.transparent).a===1&&Y.constantOr(0)===1?"opaque":"translucent";if(T.renderPass===ve){const ye=T.getDepthModeForSublayer(1,T.renderPass==="opaque"?bn.ReadWrite:bn.ReadOnly);Io(T,k,z,F,ye,ae,!1,J)}if(T.renderPass==="translucent"&&z.paint.get("fill-antialias")){const ye=T.getDepthModeForSublayer(z.getPaintProperty("fill-outline-color")?2:0,bn.ReadOnly);Io(T,k,z,F,ye,ae,!0,J)}})(t,a,h,p,b):c.cs(h)?(function(T,k,z,F,V){const H=z.paint.get("fill-extrusion-opacity");if(H===0)return;const{isRenderingToTexture:Y}=V;if(T.renderPass==="translucent"){const J=new bn(T.context.gl.LEQUAL,bn.ReadWrite,T.depthRangeFor3D);if(H!==1||z.paint.get("fill-extrusion-pattern").constantOr(1))Ao(T,k,z,F,J,On.disabled,Qn.disabled,Y),Ao(T,k,z,F,J,T.stencilModeFor3D(),T.colorModeForRenderPass(),Y);else{const ae=T.colorModeForRenderPass();Ao(T,k,z,F,J,On.disabled,ae,Y)}}})(t,a,h,p,b):c.ct(h)?(function(T,k,z,F,V){if(T.renderPass!=="offscreen"&&T.renderPass!=="translucent")return;const{isRenderingToTexture:H}=V,Y=T.context,J=T.style.projection.useSubdivision,ae=T.getDepthModeForSublayer(0,bn.ReadOnly),ge=T.colorModeForRenderPass();if(T.renderPass==="offscreen")(function(ve,ye,be,De,we,Oe,je){const Ae=ve.context,$e=Ae.gl;for(const ht of be){const st=ye.getTile(ht),ft=st.dem;if(!ft||!ft.data||!st.needsHillshadePrepare)continue;const pt=ft.dim,Dt=ft.stride,qt=ft.getPixels();if(Ae.activeTexture.set($e.TEXTURE1),Ae.pixelStoreUnpackPremultiplyAlpha.set(!1),st.demTexture=st.demTexture||ve.getTileTexture(Dt),st.demTexture){const an=st.demTexture;an.update(qt,{premultiply:!1}),an.bind($e.NEAREST,$e.CLAMP_TO_EDGE)}else st.demTexture=new c.T(Ae,qt,$e.RGBA,{premultiply:!1}),st.demTexture.bind($e.NEAREST,$e.CLAMP_TO_EDGE);Ae.activeTexture.set($e.TEXTURE0);let Pt=st.fbo;if(!Pt){const an=new c.T(Ae,{width:pt,height:pt,data:null},$e.RGBA);an.bind($e.LINEAR,$e.CLAMP_TO_EDGE),Pt=st.fbo=Ae.createFramebuffer(pt,pt,!0,!1),Pt.colorAttachment.set(an.texture)}Ae.bindFramebuffer.set(Pt.framebuffer),Ae.viewport.set([0,0,pt,pt]),ve.useProgram("hillshadePrepare").draw(Ae,$e.TRIANGLES,we,Oe,je,Tn.disabled,Ph(st.tileID,ft),null,null,De.id,ve.rasterBoundsBuffer,ve.quadTriangleIndexBuffer,ve.rasterBoundsSegments),st.needsHillshadePrepare=!1}})(T,k,F,z,ae,On.disabled,ge),Y.viewport.set([0,0,T.width,T.height]);else if(T.renderPass==="translucent")if(J){const[ve,ye,be]=T.stencilConfigForOverlapTwoPass(F);ko(T,k,z,be,ve,ae,ge,!1,H),ko(T,k,z,be,ye,ae,ge,!0,H)}else{const[ve,ye]=T.getStencilConfigForOverlapAndUpdateStencilID(F);ko(T,k,z,ye,ve,ae,ge,!1,H)}})(t,a,h,p,b):c.cu(h)?(function(T,k,z,F,V){if(T.renderPass!=="translucent"||!F.length)return;const{isRenderingToTexture:H}=V,Y=T.style.projection.useSubdivision,J=T.getDepthModeForSublayer(0,bn.ReadOnly),ae=T.colorModeForRenderPass();if(Y){const[ge,ve,ye]=T.stencilConfigForOverlapTwoPass(F);el(T,k,z,ye,ge,J,ae,!1,H),el(T,k,z,ye,ve,J,ae,!0,H)}else{const[ge,ve]=T.getStencilConfigForOverlapAndUpdateStencilID(F);el(T,k,z,ve,ge,J,ae,!1,H)}})(t,a,h,p,b):c.bV(h)?(function(T,k,z,F,V){if(T.renderPass!=="translucent"||z.paint.get("raster-opacity")===0||!F.length)return;const{isRenderingToTexture:H}=V,Y=k.getSource(),J=T.style.projection.useSubdivision;if(Y instanceof Sr)zs(T,k,z,F,null,!1,!1,Y.tileCoords,Y.flippedWindingOrder,H);else if(J){const[ae,ge,ve]=T.stencilConfigForOverlapTwoPass(F);zs(T,k,z,ve,ae,!1,!0,tl,!1,H),zs(T,k,z,ve,ge,!0,!0,tl,!1,H)}else{const[ae,ge]=T.getStencilConfigForOverlapAndUpdateStencilID(F);zs(T,k,z,ge,ae,!1,!0,tl,!1,H)}})(t,a,h,p,b):c.cv(h)?(function(T,k,z,F,V){const H=z.paint.get("background-color"),Y=z.paint.get("background-opacity");if(Y===0)return;const{isRenderingToTexture:J}=V,ae=T.context,ge=ae.gl,ve=T.style.projection,ye=T.transform,be=ye.tileSize,De=z.paint.get("background-pattern");if(T.isPatternMissing(De))return;const we=!De&&H.a===1&&Y===1&&T.opaquePassEnabledForLayer()?"opaque":"translucent";if(T.renderPass!==we)return;const Oe=On.disabled,je=T.getDepthModeForSublayer(0,we==="opaque"?bn.ReadWrite:bn.ReadOnly),Ae=T.colorModeForRenderPass(),$e=T.useProgram(De?"backgroundPattern":"background"),ht=F||ki(ye,{tileSize:be,terrain:T.style.map.terrain});De&&(ae.activeTexture.set(ge.TEXTURE0),T.imageManager.bind(T.context));const st=z.getCrossfadeParameters();for(const ft of ht){const pt=ye.getProjectionData({overscaledTileID:ft,applyGlobeMatrix:!J,applyTerrainMatrix:!0}),Dt=De?g(Y,T,De,{tileID:ft,tileSize:be},st):u(Y,H),qt=T.style.map.terrain&&T.style.map.terrain.getTerrainData(ft),Pt=ve.getMeshFromTileID(ae,ft.canonical,!1,!0,"raster");$e.draw(ae,ge.TRIANGLES,je,Oe,Ae,Tn.backCCW,Dt,qt,pt,z.id,Pt.vertexBuffer,Pt.indexBuffer,Pt.segments)}})(t,0,h,p,b):c.cw(h)&&(function(T,k,z,F){const{isRenderingGlobe:V}=F,H=T.context,Y=z.implementation,J=T.style.projection,ae=T.transform,ge=ae.getProjectionDataForCustomLayer(V),ve={farZ:ae.farZ,nearZ:ae.nearZ,fov:ae.fov*Math.PI/180,modelViewProjectionMatrix:ae.modelViewProjectionMatrix,projectionMatrix:ae.projectionMatrix,shaderData:{variantName:J.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${J.shaderPreludeCode.vertexSource}`,define:J.shaderDefine},defaultProjectionData:ge},ye=Y.renderingMode?Y.renderingMode:"2d";if(T.renderPass==="offscreen"){const be=Y.prerender;be&&(T.setCustomLayerDefaults(),H.setColorMode(T.colorModeForRenderPass()),be.call(Y,H.gl,ve),H.setDirty(),T.setBaseState())}else if(T.renderPass==="translucent"){T.setCustomLayerDefaults(),H.setColorMode(T.colorModeForRenderPass()),H.setStencilMode(On.disabled);const be=ye==="3d"?T.getDepthModeFor3D():T.getDepthModeForSublayer(0,bn.ReadOnly);H.setDepthMode(be),Y.render(H.gl,ve),H.setDirty(),T.setBaseState(),H.bindFramebuffer.set(null)}})(t,0,h,b))}saveTileTexture(t){const a=this._tileTextures[t.size[0]];a?a.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const a=this.imageManager.getPattern(t.from.toString()),h=this.imageManager.getPattern(t.to.toString());return!a||!h}useProgram(t,a,h=!1,p=[]){this.cache=this.cache||{};const b=!!this.style.map.terrain,T=this.style.projection,k=h?Di.projectionMercator:T.shaderPreludeCode,z=h?Ni:T.shaderDefine,F=t+(a?a.cacheKey:"")+`/${h?kn:T.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(b?"/terrain":"")+(p?`/${p.join("/")}`:"");return this.cache[F]||(this.cache[F]=new Ah(this.context,Di[t],a,B[t],this._showOverdrawInspector,b,k,z,p)),this.cache[F]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){var t,a;if(this._tileTextures){for(const h in this._tileTextures){const p=this._tileTextures[h];if(p)for(const b of p)b.destroy()}this._tileTextures={}}if(this.tileExtentBuffer&&this.tileExtentBuffer.destroy(),this.debugBuffer&&this.debugBuffer.destroy(),this.rasterBoundsBuffer&&this.rasterBoundsBuffer.destroy(),this.rasterBoundsBufferPosOnly&&this.rasterBoundsBufferPosOnly.destroy(),this.viewportBuffer&&this.viewportBuffer.destroy(),this.tileBorderIndexBuffer&&this.tileBorderIndexBuffer.destroy(),this.quadTriangleIndexBuffer&&this.quadTriangleIndexBuffer.destroy(),this.tileExtentMesh&&((t=this.tileExtentMesh.vertexBuffer)===null||t===void 0||t.destroy()),this.tileExtentMesh&&((a=this.tileExtentMesh.indexBuffer)===null||a===void 0||a.destroy()),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.cache){for(const h in this.cache){const p=this.cache[h];p&&p.program&&this.context.gl.deleteProgram(p.program)}this.cache={}}this.context&&this.context.setDefault()}overLimit(){const{drawingBufferWidth:t,drawingBufferHeight:a}=this.context.gl;return this.width!==t||this.height!==a}}function Df(v,t){let a,h=!1,p=null,b=null;const T=()=>{p=null,h&&(v.apply(b,a),p=setTimeout(T,t),h=!1)};return(...k)=>(h=!0,b=this,a=k,p||T(),p)}class Ki{constructor(t){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let h;return a.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(h=p)})),(h&&h[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const h=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:h,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const h=a.join("/");let p=h;p.split("&").length>0&&(p=p.split("&")[0]),this._hashName&&(p=`${this._hashName}=${h}`);let b=window.location.hash.replace(p,"");b.startsWith("#&")?b=b.slice(0,1)+b.slice(2):b==="#"&&(b="");let T=window.location.href.replace(/(#.+)?$/,b);T=T.replace("&&","&"),window.history.replaceState(window.history.state,null,T)},this._updateHash=Df(this._updateHashUnthrottled,300),this._hashName=t&&encodeURIComponent(t)}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(t){const a=this._map.getCenter(),h=Math.round(100*this._map.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,p),T=Math.round(a.lng*b)/b,k=Math.round(a.lat*b)/b,z=this._map.getBearing(),F=this._map.getPitch();let V="";if(V+=t?`/${T}/${k}/${h}`:`${h}/${k}/${T}`,(z||F)&&(V+="/"+Math.round(10*z)/10),F&&(V+=`/${Math.round(F)}`),this._hashName){const H=this._hashName;let Y=!1;const J=window.location.hash.slice(1).split("&").map((ae=>{const ge=ae.split("=")[0];return ge===H?(Y=!0,`${ge}=${V}`):ae})).filter((ae=>ae));return Y||J.push(`${H}=${V}`),`#${J.join("&")}`}return`#${V}`}_isValidHash(t){if(t.length<3||t.some(isNaN))return!1;try{new c.V(+t[2],+t[1])}catch{return!1}const a=+t[0],h=+(t[3]||0),p=+(t[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&h>=-180&&h<=180&&p>=this._map.getMinPitch()&&p<=this._map.getMaxPitch()}}const zl={linearity:.3,easing:c.cx(0,0,.3,1)},wa=c.e({deceleration:2500,maxSpeed:1400},zl),za=c.e({deceleration:20,maxSpeed:1400},zl),jh=c.e({deceleration:1e3,maxSpeed:360},zl),Ta=c.e({deceleration:1e3,maxSpeed:90},zl),nc=c.e({deceleration:1e3,maxSpeed:360},zl);class ic{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:dt(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=dt();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,a.roll+=b.rollDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(a.pan.mag()){const b=Hc(a.pan.mag(),h,c.e({},wa,t||{})),T=a.pan.mult(b.amount/a.pan.mag()),k=this._map.cameraHelper.handlePanInertia(T,this._map.transform);p.center=k.easingCenter,p.offset=k.easingOffset,rc(p,b)}if(a.zoom){const b=Hc(a.zoom,h,za);p.zoom=this._map.transform.zoom+b.amount,rc(p,b)}if(a.bearing){const b=Hc(a.bearing,h,jh);p.bearing=this._map.transform.bearing+c.ao(b.amount,-179,179),rc(p,b)}if(a.pitch){const b=Hc(a.pitch,h,Ta);p.pitch=this._map.transform.pitch+b.amount,rc(p,b)}if(a.roll){const b=Hc(a.roll,h,nc);p.roll=this._map.transform.roll+c.ao(b.amount,-179,179),rc(p,b)}if(p.zoom||p.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;p.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),c.e(p,{noMoveStart:!0})}}function rc(v,t){(!v.duration||v.duration<t.duration)&&(v.duration=t.duration,v.easing=t.easing)}function Hc(v,t,a){const{maxSpeed:h,linearity:p,deceleration:b}=a,T=c.ao(v*p/(t/1e3),-h,h),k=Math.abs(T)/(b*p);return{easing:a.easing,duration:1e3*k,amount:T*(k/2)}}class Wa extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,h,p={}){h=h instanceof MouseEvent?h:new MouseEvent(t,h);const b=Ce.mousePos(a.getCanvas(),h),T=a.unproject(b);super(t,c.e({point:b,lngLat:T,originalEvent:h},p)),this._defaultPrevented=!1,this.target=a}}class Qs extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,h){const p=t==="touchend"?h.changedTouches:h.touches,b=Ce.touchPos(a.getCanvasContainer(),p),T=b.map((z=>a.unproject(z))),k=b.reduce(((z,F,V,H)=>z.add(F.div(H.length))),new c.P(0,0));super(t,{points:b,point:k,lngLats:T,lngLat:a.unproject(k),originalEvent:h}),this._defaultPrevented=!1}}class Xc extends c.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,h){super(t,{originalEvent:h}),this._defaultPrevented=!1}}class Ol{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new Xc(t.type,this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Wa(t.type,this._map,t))}mouseup(t){this._map.fire(new Wa(t.type,this._map,t))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Wa(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Wa(t.type,this._map,t))}mouseover(t){this._map.fire(new Wa(t.type,this._map,t))}mouseout(t){this._map.fire(new Wa(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Qs(t.type,this._map,t))}touchmove(t){this._map.fire(new Qs(t.type,this._map,t))}touchend(t){this._map.fire(new Qs(t.type,this._map,t))}touchcancel(t){this._map.fire(new Qs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Do{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Wa(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Wa(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xt{constructor(t){this._map=t}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(t){return this.transform.screenPointToLocation(c.P.convert(t),this._map.terrain)}}class $c{constructor(t,a){this._map=t,this._tr=new Xt(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(Ce.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const h=a;if(this._lastPos.equals(h)||!this._box&&h.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=h,this._box||(this._box=Ce.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",t));const b=Math.min(p.x,h.x),T=Math.max(p.x,h.x),k=Math.min(p.y,h.y),z=Math.max(p.y,h.y);Ce.setTransform(this._box,`translate(${b}px,${k}px)`),this._box.style.width=T-b+"px",this._box.style.height=z-k+"px"}mouseupWindow(t,a){if(!this._active||t.button!==0)return;const h=this._startPos,p=a;if(this.reset(),Ce.suppressClick(),h.x!==p.x||h.y!==p.y)return this._map.fire(new c.l("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(h,p,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Ce.remove(this._box),this._box=null),Ce.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new c.l(t,{originalEvent:a}))}}function Nl(v,t){if(v.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${v.length}, points ${t.length}`);const a={};for(let h=0;h<v.length;h++)a[v[h].identifier]=t[h];return a}class Wc{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,a,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),h.length===this.numTouches&&(this.centroid=(function(p){const b=new c.P(0,0);for(const T of p)b._add(T);return b.div(p.length)})(a),this.touches=Nl(h,a)))}touchmove(t,a,h){if(this.aborted||!this.centroid)return;const p=Nl(h,a);for(const b in this.touches){const T=p[b];(!T||T.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,a,h){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Bl{constructor(t){this.singleTap=new Wc(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,a,h){this.singleTap.touchstart(t,a,h)}touchmove(t,a,h){this.singleTap.touchmove(t,a,h)}touchend(t,a,h){const p=this.singleTap.touchend(t,a,h);if(p){const b=t.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(p)<30;if(b&&T||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class ac{constructor(t){this._tr=new Xt(t),this._zoomIn=new Bl({numTouches:1,numTaps:2}),this._zoomOut=new Bl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,h){this._zoomIn.touchstart(t,a,h),this._zoomOut.touchstart(t,a,h)}touchmove(t,a,h){this._zoomIn.touchmove(t,a,h),this._zoomOut.touchmove(t,a,h)}touchend(t,a,h){const p=this._zoomIn.touchend(t,a,h),b=this._zoomOut.touchend(t,a,h),T=this._tr;return p?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:T.zoom+1,around:T.unproject(p)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:k=>k.easeTo({duration:300,zoom:T.zoom-1,around:T.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class _s{constructor(t){this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}reset(t){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(t)}_move(...t){const a=this._moveFunction(...t);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(t,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(t)&&(this._moveStateManager.startMove(t),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(t,a){if(!this.isEnabled())return;const h=this._lastPoint;if(!h)return;if(t.preventDefault(),!this._moveStateManager.isValidMoveEvent(t))return void this.reset(t);const p=Array.isArray(a)?a[0]:a;return!this._moved&&p.dist(h)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=p,this._move(h,p))}dragEnd(t){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(t)&&(this._moved&&Ce.suppressClick(),this.reset(t))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const _u=0,Uh=2,Lf={[_u]:1,[Uh]:2};class Ns{constructor(t){this._correctEvent=t.checkCorrectEvent}startMove(t){const a=Ce.mouseButton(t);this._eventButton=a}endMove(t){delete this._eventButton}isValidStartEvent(t){return this._correctEvent(t)}isValidMoveEvent(t){return!(function(a,h){const p=Lf[h];return a.buttons===void 0||(a.buttons&p)!==p})(t,this._eventButton)}isValidEndEvent(t){return Ce.mouseButton(t)===this._eventButton}}class Kc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(t){return t.targetTouches.length===1}_isSameTouchEvent(t){return t.targetTouches[0].identifier===this._firstTouch}startMove(t){this._firstTouch=t.targetTouches[0].identifier}endMove(t){delete this._firstTouch}isValidStartEvent(t){return this._isOneFingerTouch(t)}isValidMoveEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}isValidEndEvent(t){return this._isOneFingerTouch(t)&&this._isSameTouchEvent(t)}}class Qc{constructor(t=new Ns({checkCorrectEvent:()=>!0}),a=new Kc){this.mouseMoveStateManager=t,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(t,a,h){return t instanceof MouseEvent?a(t):typeof TouchEvent<"u"&&t instanceof TouchEvent?h(t):void 0}startMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(t){this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(t){return this._executeRelevantHandler(t,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Fl=v=>{v.mousedown=v.dragStart,v.mousemoveWindow=v.dragMove,v.mouseup=v.dragEnd,v.contextmenu=t=>{t.preventDefault()}};class Vh{constructor(t,a){this._clickTolerance=t.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}_shouldBePrevented(t){return t<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(t,a,h){return this._calculateTransform(t,a,h)}touchmove(t,a,h){if(this._active){if(!this._shouldBePrevented(h.length))return t.preventDefault(),this._calculateTransform(t,a,h);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",t)}}touchend(t,a,h){this._calculateTransform(t,a,h),this._active&&this._shouldBePrevented(h.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,h){h.length>0&&(this._active=!0);const p=Nl(h,a),b=new c.P(0,0),T=new c.P(0,0);let k=0;for(const F in p){const V=p[F],H=this._touches[F];H&&(b._add(V),T._add(V.sub(H)),k++,p[F]=V)}if(this._touches=p,this._shouldBePrevented(k)||!T.mag())return;const z=T.div(k);return this._sum._add(z),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(k),panDelta:z}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(t,a,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,h){if(!this._firstTwoTouches)return;t.preventDefault();const[p,b]=this._firstTwoTouches,T=Lo(h,a,p),k=Lo(h,a,b);if(!T||!k)return;const z=this._aroundCenter?null:T.add(k).div(2);return this._move([T,k],z,t)}touchend(t,a,h){if(!this._firstTwoTouches)return;const[p,b]=this._firstTwoTouches,T=Lo(h,a,p),k=Lo(h,a,b);T&&k||(this._active&&Ce.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Lo(v,t,a){for(let h=0;h<v.length;h++)if(v[h].identifier===a)return t[h]}function Gh(v,t){return Math.log(v/t)/Math.LN2}class rl extends Jc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const h=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Gh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gh(this._distance,h),pinchAround:a}}}function qh(v,t){return 180*v.angleWith(t)/Math.PI}class Js extends Jc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a,h){const p=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:qh(this._vector,p),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,h=qh(t,this._startVector);return Math.abs(h)<a}}function Hn(v){return Math.abs(v.y)>Math.abs(v.x)}class al extends Jc{constructor(t){super(),this._currentTouchCount=0,this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,a,h){super.touchstart(t,a,h),this._currentTouchCount=h.length}_start(t){this._lastPoints=t,Hn(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,h){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),b=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,b,h.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(t,a,h){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,b=a.mag()>=2;if(!p&&!b)return;if(!p||!b)return this._firstMove===void 0&&(this._firstMove=h),h-this._firstMove<100&&void 0;const T=t.y>0==a.y>0;return Hn(t)&&Hn(a)&&T}}const jl={panStep:100,bearingStep:15,pitchStep:10};class yu{constructor(t){this._tr=new Xt(t);const a=jl;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,h=0,p=0,b=0,T=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?h=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?h=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),T=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:k=>{const z=this._tr;k.easeTo({duration:300,easeId:"keyboardHandler",easing:eh,zoom:a?Math.round(z.zoom)+a*(t.shiftKey?2:1):z.zoom,bearing:z.bearing+h*this._bearingStep,pitch:z.pitch+p*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:z.center},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function eh(v){return v*(2-v)}const vu=4.000244140625,sc=1/450;class Zh{constructor(t,a){this._onTimeout=h=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},this._map=t,this._tr=new Xt(t),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=sc}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(t){return!!this._map.cooperativeGestures.isEnabled()&&!(t.ctrlKey||this._map.cooperativeGestures.isBypassed(t))}wheel(t){if(!this.isEnabled())return;if(this._shouldBePrevented(t))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",t);let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const h=dt(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,a!==0&&a%vu==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Ce.mousePos(this._map.getCanvas(),t),h=this._tr;this._aroundPoint=this._aroundCenter?h.transform.locationToScreenPoint(c.V.convert(h.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const k=t.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=k),typeof this._targetZoom=="number"&&(this._targetZoom+=k)}if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>vu?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&z!==0&&(z=1/z);const F=typeof this._targetZoom!="number"?t.scale:c.ar(this._targetZoom);this._targetZoom=t.applyConstrain(t.getCameraLngLat(),c.au(F*z)).zoom,this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?t.zoom:this._targetZoom,h=this._startZoom,p=this._easing;let b,T=!1;if(this._type==="wheel"&&h&&p){const k=dt()-this._lastWheelEventTime,z=Math.min((k+5)/200,1),F=p(z);b=c.G.number(h,a,F),z<1?this._frameId||(this._frameId=!0):T=!0}else b=a,T=!0;return this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=b,{noInertia:!0,needsRenderFrame:!T,zoomDelta:b-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=c.cz;if(this._prevEase){const h=this._prevEase,p=(dt()-h.start)/h.duration,b=h.easing(p+.01)-h.easing(p),T=.27/Math.sqrt(b*b+1e-4)*.01,k=Math.sqrt(.0729-T*T);a=c.cx(T,k,.25,1)}return this._prevEase={start:dt(),duration:t,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class zf{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Oa{constructor(t){this._tr=new Xt(t),this.reset()}reset(){this._active=!1}dblclick(t,a){return t.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:this._tr.zoom+(t.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xu{constructor(){this._tap=new Bl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(t,a,h){if(!this._swipePoint)if(this._tapTime){const p=a[0],b=t.timeStamp-this._tapTime<500,T=this._tapPoint.dist(p)<30;b&&T?h.length>0&&(this._swipePoint=p,this._swipeTouch=h[0].identifier):this.reset()}else this._tap.touchstart(t,a,h)}touchmove(t,a,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=a[0],b=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,a,h)}touchend(t,a,h){if(this._tapTime)this._swipePoint&&h.length===0&&this.reset();else{const p=this._tap.touchend(t,a,h);p&&(this._tapTime=t.timeStamp,this._tapPoint=p)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class on{constructor(t,a,h){this._el=t,this._mousePan=a,this._touchPan=h}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class mn{constructor(t,a,h,p){this._pitchWithRotate=t.pitchWithRotate,this._rollEnabled=t.rollEnabled,this._mouseRotate=a,this._mousePitch=h,this._mouseRoll=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Ul{constructor(t,a,h,p){this._el=t,this._touchZoom=a,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Na{constructor(t,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=t,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const t=this._map.getCanvasContainer();t.classList.add("maplibregl-cooperative-gestures"),this._container=Ce.create("div","maplibregl-cooperative-gesture-screen",t);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const h=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),p=document.createElement("div");p.className="maplibregl-desktop-message",p.textContent=a,this._container.appendChild(p);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=h,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Ce.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(t){return t[this._bypassKey]}notifyGestureBlocked(t,a){this._enabled&&(this._map.fire(new c.l("cooperativegestureprevented",{gestureType:t,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const ia=v=>v.zoom||v.drag||v.roll||v.pitch||v.rotate;class fr extends c.l{}function Ba(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta||v.rollDelta}class Of{constructor(t,a){this.handleWindowEvent=p=>{this.handleEvent(p,`${p.type}Window`)},this.handleEvent=(p,b)=>{if(p.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const T=p.type==="renderFrame"?void 0:p,k={needsRenderFrame:!1},z={},F={};for(const{handlerName:Y,handler:J,allowed:ae}of this._handlers){if(!J.isEnabled())continue;let ge;if(this._blockedByActive(F,ae,Y))J.reset();else if(J[b||p.type]){if(c.cA(p,b||p.type)){const ve=Ce.mousePos(this._map.getCanvas(),p);ge=J[b||p.type](p,ve)}else if(c.cB(p,b||p.type)){const ve=this._getMapTouches(p.touches),ye=Ce.touchPos(this._map.getCanvas(),ve);ge=J[b||p.type](p,ye,ve)}else c.cC(b||p.type)||(ge=J[b||p.type](p));this.mergeHandlerResult(k,z,ge,Y,T),ge&&ge.needsRenderFrame&&this._triggerRenderFrame()}(ge||J.isActive())&&(F[Y]=J)}const V={};for(const Y in this._previousActiveHandlers)F[Y]||(V[Y]=T);this._previousActiveHandlers=F,(Object.keys(V).length||Ba(k))&&(this._changes.push([k,z,V]),this._triggerRenderFrame()),(Object.keys(F).length||Ba(k))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=k;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ic(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,b,T]of this._listeners)Ce.addEventListener(p,b,p===document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[t,a,h]of this._listeners)Ce.removeEventListener(t,a,t===document?this.handleWindowEvent:this.handleEvent,h)}_addDefaultHandlers(t){const a=this._map,h=a.getCanvasContainer();this._add("mapEvent",new Ol(a,t));const p=a.boxZoom=new $c(a,t);this._add("boxZoom",p),t.interactive&&t.boxZoom&&p.enable();const b=a.cooperativeGestures=new Na(a,t.cooperativeGestures);this._add("cooperativeGestures",b),t.cooperativeGestures&&b.enable();const T=new ac(a),k=new Oa(a);a.doubleClickZoom=new zf(k,T),this._add("tapZoom",T),this._add("clickZoom",k),t.interactive&&t.doubleClickZoom&&a.doubleClickZoom.enable();const z=new xu;this._add("tapDragZoom",z);const F=a.touchPitch=new al(a);this._add("touchPitch",F),t.interactive&&t.touchPitch&&a.touchPitch.enable(t.touchPitch);const V=()=>a.project(a.getCenter()),H=(function({enable:we,clickTolerance:Oe,aroundCenter:je=!0,minPixelCenterThreshold:Ae=100,rotateDegreesPerPixelMoved:$e=.8},ht){const st=new Ns({checkCorrectEvent:ft=>Ce.mouseButton(ft)===0&&ft.ctrlKey||Ce.mouseButton(ft)===2&&!ft.ctrlKey});return new _s({clickTolerance:Oe,move:(ft,pt)=>{const Dt=ht();if(je&&Math.abs(Dt.y-ft.y)>Ae)return{bearingDelta:c.cy(new c.P(ft.x,pt.y),pt,Dt)};let qt=(pt.x-ft.x)*$e;return je&&pt.y<Dt.y&&(qt=-qt),{bearingDelta:qt}},moveStateManager:st,enable:we,assignEvents:Fl})})(t,V),Y=(function({enable:we,clickTolerance:Oe,pitchDegreesPerPixelMoved:je=-.5}){const Ae=new Ns({checkCorrectEvent:$e=>Ce.mouseButton($e)===0&&$e.ctrlKey||Ce.mouseButton($e)===2});return new _s({clickTolerance:Oe,move:($e,ht)=>({pitchDelta:(ht.y-$e.y)*je}),moveStateManager:Ae,enable:we,assignEvents:Fl})})(t),J=(function({enable:we,clickTolerance:Oe,rollDegreesPerPixelMoved:je=.3},Ae){const $e=new Ns({checkCorrectEvent:ht=>Ce.mouseButton(ht)===2&&ht.ctrlKey});return new _s({clickTolerance:Oe,move:(ht,st)=>{const ft=Ae();let pt=(st.x-ht.x)*je;return st.y<ft.y&&(pt=-pt),{rollDelta:pt}},moveStateManager:$e,enable:we,assignEvents:Fl})})(t,V);a.dragRotate=new mn(t,H,Y,J),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate","mouseRoll"]),this._add("mouseRoll",J,["mousePitch"]),t.interactive&&t.dragRotate&&a.dragRotate.enable();const ae=(function({enable:we,clickTolerance:Oe}){const je=new Ns({checkCorrectEvent:Ae=>Ce.mouseButton(Ae)===0&&!Ae.ctrlKey});return new _s({clickTolerance:Oe,move:(Ae,$e)=>({around:$e,panDelta:$e.sub(Ae)}),activateOnStart:!0,moveStateManager:je,enable:we,assignEvents:Fl})})(t),ge=new Vh(t,a);a.dragPan=new on(h,ae,ge),this._add("mousePan",ae),this._add("touchPan",ge,["touchZoom","touchRotate"]),t.interactive&&t.dragPan&&a.dragPan.enable(t.dragPan);const ve=new Js,ye=new rl;a.touchZoomRotate=new Ul(h,ye,ve,z),this._add("touchRotate",ve,["touchPan","touchZoom"]),this._add("touchZoom",ye,["touchPan","touchRotate"]),t.interactive&&t.touchZoomRotate&&a.touchZoomRotate.enable(t.touchZoomRotate),this._add("blockableMapEvent",new Do(a));const be=a.scrollZoom=new Zh(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",be,["mousePan"]),t.interactive&&t.scrollZoom&&a.scrollZoom.enable(t.scrollZoom);const De=a.keyboard=new yu(a);this._add("keyboard",De),t.interactive&&t.keyboard&&a.keyboard.enable()}_add(t,a,h){this._handlers.push({handlerName:t,handler:a,allowed:h}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ia(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,a,h){for(const p in t)if(p!==h&&(!a||a.indexOf(p)<0))return!0;return!1}_getMapTouches(t){const a=[];for(const h of t)this._el.contains(h.target)&&a.push(h);return a}mergeHandlerResult(t,a,h,p,b){if(!h)return;c.e(t,h);const T={handlerName:p,originalEvent:h.originalEvent||b};h.zoomDelta!==void 0&&(a.zoom=T),h.panDelta!==void 0&&(a.drag=T),h.rollDelta!==void 0&&(a.roll=T),h.pitchDelta!==void 0&&(a.pitch=T),h.bearingDelta!==void 0&&(a.rotate=T)}_applyChanges(){const t={},a={},h={};for(const[p,b,T]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new c.P(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.rollDelta&&(t.rollDelta=(t.rollDelta||0)+p.rollDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),c.e(a,b),c.e(h,T);this._updateMapTransform(t,a,h),this._changes=[]}_updateMapTransform(t,a,h){const p=this._map,b=p._getTransformForUpdate(),T=p.terrain;if(!(Ba(t)||T&&this._terrainMovement))return this._fireEvents(a,h,!0);p._stop(!0);let{panDelta:k,zoomDelta:z,bearingDelta:F,pitchDelta:V,rollDelta:H,around:Y,pinchAround:J}=t;J!==void 0&&(Y=J),Y=Y||p.transform.centerPoint,T&&!b.isPointOnMapSurface(Y)&&(Y=b.centerPoint);const ae={panDelta:k,zoomDelta:z,rollDelta:H,pitchDelta:V,bearingDelta:F,around:Y};this._map.cameraHelper.useGlobeControls&&!b.isPointOnMapSurface(Y)&&(Y=b.centerPoint);const ge=Y.distSqr(b.centerPoint)<.01?b.center:b.screenPointToLocation(k?Y.sub(k):Y);this._handleMapControls({terrain:T,tr:b,deltasForHelper:ae,preZoomAroundLoc:ge,combinedEventsInProgress:a,panDelta:k}),p._applyUpdatedTransform(b),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,h,!0)}_handleMapControls({terrain:t,tr:a,deltasForHelper:h,preZoomAroundLoc:p,combinedEventsInProgress:b,panDelta:T}){const k=this._map.cameraHelper;if(k.handleMapControlsRollPitchBearingZoom(h,a),t)return k.useGlobeControls?(this._terrainMovement||!b.drag&&!b.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void k.handleMapControlsPan(h,a,p)):this._terrainMovement||!b.drag&&!b.zoom?void(b.drag&&this._terrainMovement&&T?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(T))):k.handleMapControlsPan(h,a,p)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void k.handleMapControlsPan(h,a,p));k.handleMapControlsPan(h,a,p)}_fireEvents(t,a,h){const p=ia(this._eventsInProgress),b=ia(t),T={};for(const H in t){const{originalEvent:Y}=t[H];this._eventsInProgress[H]||(T[`${H}start`]=Y),this._eventsInProgress[H]=t[H]}!p&&b&&this._fireEvent("movestart",b.originalEvent);for(const H in T)this._fireEvent(H,T[H]);b&&this._fireEvent("move",b.originalEvent);for(const H in t){const{originalEvent:Y}=t[H];this._fireEvent(H,Y)}const k={};let z;for(const H in this._eventsInProgress){const{handlerName:Y,originalEvent:J}=this._eventsInProgress[H];this._handlersById[Y].isActive()||(delete this._eventsInProgress[H],z=a[Y]||J,k[`${H}end`]=z)}for(const H in k)this._fireEvent(H,k[H]);const F=ia(this._eventsInProgress),V=(p||b)&&!F;if(V&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const H=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&H.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(H)}if(h&&V){this._updatingCamera=!0;const H=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=J=>J!==0&&-this._bearingSnap<J&&J<this._bearingSnap;!H||!H.essential&&Be.prefersReducedMotion?(this._map.fire(new c.l("moveend",{originalEvent:z})),Y(this._map.getBearing())&&this._map.resetNorth()):(Y(H.bearing||this._map.getBearing())&&(H.bearing=0),H.freezeElevation=!0,this._map.easeTo(H,{originalEvent:z})),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new c.l(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{delete this._frameId,this.handleEvent(new fr("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Vl extends c.E{constructor(t,a,h){super(),this._renderFrameCallback=()=>{const p=Math.min((dt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=h.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(t,a){t.apply(this.transform),this.transform=t,this.cameraHelper=a}getCenter(){return new c.V(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(t,a){return this.jumpTo({elevation:t},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(t){this._centerClampedToGround=t}panBy(t,a,h){return t=c.P.convert(t).mult(-1),this.panTo(this.transform.center,c.e({offset:t},a),h)}panTo(t,a,h){return this.easeTo(c.e({center:t},a),h)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,h){return this.easeTo(c.e({zoom:t},a),h)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(t,a){return t!=this.transform.fov&&(this.transform.setFov(t),this.fire(new c.l("movestart",a)).fire(new c.l("move",a)).fire(new c.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,h){return this.easeTo(c.e({bearing:t},a),h)}resetNorth(t,a){return this.rotateTo(0,c.e({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(c.e({bearing:0,pitch:0,roll:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}getRoll(){return this.transform.roll}setRoll(t,a){return this.jumpTo({roll:t},a),this}cameraForBounds(t,a){t=Ri.convert(t).adjustAntiMeridian();const h=a&&a.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),h,a)}_cameraForBoxAndBearing(t,a,h,p){const b={top:0,bottom:0,right:0,left:0};if(typeof(p=c.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const F=p.padding;p.padding={top:F,bottom:F,right:F,left:F}}const T=c.e(b,p.padding);p.padding=T;const k=this.transform,z=new Ri(t,a);return this.cameraHelper.cameraForBoxAndBearing(p,T,z,h,k)}fitBounds(t,a,h){return this._fitInternal(this.cameraForBounds(t,a),a,h)}fitScreenCoordinates(t,a,h,p,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(c.P.convert(t)),this.transform.screenPointToLocation(c.P.convert(a)),h,p),p,b)}_fitInternal(t,a,h){return t?(delete(a=c.e(t,a)).padding,a.linear?this.easeTo(a,h):this.flyTo(a,h)):this}jumpTo(t,a){this.stop();const h=this._getTransformForUpdate();let p=!1,b=!1,T=!1;const k=h.zoom;this.cameraHelper.handleJumpToCenterZoom(h,t);const z=h.zoom!==k;return"elevation"in t&&h.elevation!==+t.elevation&&h.setElevation(+t.elevation),"bearing"in t&&h.bearing!==+t.bearing&&(p=!0,h.setBearing(+t.bearing)),"pitch"in t&&h.pitch!==+t.pitch&&(b=!0,h.setPitch(+t.pitch)),"roll"in t&&h.roll!==+t.roll&&(T=!0,h.setRoll(+t.roll)),t.padding==null||h.isPaddingEqual(t.padding)||h.setPadding(t.padding),this._applyUpdatedTransform(h),this.fire(new c.l("movestart",a)).fire(new c.l("move",a)),z&&this.fire(new c.l("zoomstart",a)).fire(new c.l("zoom",a)).fire(new c.l("zoomend",a)),p&&this.fire(new c.l("rotatestart",a)).fire(new c.l("rotate",a)).fire(new c.l("rotateend",a)),b&&this.fire(new c.l("pitchstart",a)).fire(new c.l("pitch",a)).fire(new c.l("pitchend",a)),T&&this.fire(new c.l("rollstart",a)).fire(new c.l("roll",a)).fire(new c.l("rollend",a)),this.fire(new c.l("moveend",a))}calculateCameraOptionsFromTo(t,a,h,p=0){const b=c.ab.fromLngLat(t,a),T=c.ab.fromLngLat(h,p),k=T.x-b.x,z=T.y-b.y,F=T.z-b.z,V=Math.hypot(k,z,F);if(V===0)throw new Error("Can't calculate camera options with same From and To");const H=Math.hypot(k,z),Y=c.au(this.transform.cameraToCenterDistance/V/this.transform.tileSize),J=180*Math.atan2(k,-z)/Math.PI;let ae=180*Math.acos(H/V)/Math.PI;return ae=F<0?90-ae:90+ae,{center:T.toLngLat(),elevation:p,zoom:Y,pitch:ae,bearing:J}}calculateCameraOptionsFromCameraLngLatAltRotation(t,a,h,p,b){const T=this.transform.calculateCenterFromCameraLngLatAlt(t,a,h,p);return{center:T.center,elevation:T.elevation,zoom:T.zoom,bearing:h,pitch:p,roll:b}}easeTo(t,a){this._stop(!1,t.easeId),((t=c.e({offset:[0,0],duration:500,easing:c.cz},t)).animate===!1||!t.essential&&Be.prefersReducedMotion)&&(t.duration=0);const h=this._getTransformForUpdate(),p=this.getBearing(),b=h.pitch,T=h.roll,k="bearing"in t?this._normalizeBearing(t.bearing,p):p,z="pitch"in t?+t.pitch:b,F="roll"in t?this._normalizeBearing(t.roll,T):T,V="padding"in t?t.padding:h.padding,H=c.P.convert(t.offset);let Y,J;t.around&&(Y=c.V.convert(t.around),J=h.locationToScreenPoint(Y));const ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},ge=this.cameraHelper.handleEaseTo(h,{bearing:k,pitch:z,roll:F,padding:V,around:Y,aroundPoint:J,offsetAsPoint:H,offset:t.offset,zoom:t.zoom,center:t.center});return this._rotating=this._rotating||p!==k,this._pitching=this._pitching||z!==b,this._rolling=this._rolling||F!==T,this._padding=!h.isPaddingEqual(V),this._zooming=this._zooming||ge.isZooming,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,ae),this.terrain&&this._prepareElevation(ge.elevationCenter),this._ease((ve=>{ge.easeFunc(ve),this.terrain&&!t.freezeElevation&&this._updateElevation(ve),this._applyUpdatedTransform(h),this._fireMoveEvents(a)}),(ve=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a,ve)}),t),this}_prepareEase(t,a,h={}){this._moving=!0,a||h.moving||this.fire(new c.l("movestart",t)),this._zooming&&!h.zooming&&this.fire(new c.l("zoomstart",t)),this._rotating&&!h.rotating&&this.fire(new c.l("rotatestart",t)),this._pitching&&!h.pitching&&this.fire(new c.l("pitchstart",t)),this._rolling&&!h.rolling&&this.fire(new c.l("rollstart",t))}_prepareElevation(t){this._elevationCenter=t,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(t,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(t){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(t<1&&a!==this._elevationTarget){const h=this._elevationTarget-this._elevationStart;this._elevationStart+=t*(h-(a-(h*t+this._elevationStart))/(1-t)),this._elevationTarget=a}this.transform.setElevation(c.G.number(this._elevationStart,this._elevationTarget,t))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(t){if(!this.terrain&&t.elevation>=0&&t.pitch<=90)return{};const a=t.getCameraLngLat(),h=t.getCameraAltitude(),p=this.terrain?this.terrain.getElevationForLngLatZoom(a,t.zoom):0;if(h<p){const b=this.calculateCameraOptionsFromTo(a,p,t.center,t.elevation);return{pitch:b.pitch,zoom:b.zoom}}return{}}_applyUpdatedTransform(t){const a=[];if(a.push((p=>this._elevateCameraIfInsideTerrain(p))),this.transformCameraUpdate&&a.push((p=>this.transformCameraUpdate(p))),!a.length)return;const h=t.clone();for(const p of a){const b=h.clone(),{center:T,zoom:k,roll:z,pitch:F,bearing:V,elevation:H}=p(b);T&&b.setCenter(T),H!==void 0&&b.setElevation(H),k!==void 0&&b.setZoom(k),z!==void 0&&b.setRoll(z),F!==void 0&&b.setPitch(F),V!==void 0&&b.setBearing(V),h.apply(b)}this.transform.apply(h)}_fireMoveEvents(t){this.fire(new c.l("move",t)),this._zooming&&this.fire(new c.l("zoom",t)),this._rotating&&this.fire(new c.l("rotate",t)),this._pitching&&this.fire(new c.l("pitch",t)),this._rolling&&this.fire(new c.l("roll",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const h=this._zooming,p=this._rotating,b=this._pitching,T=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,h&&this.fire(new c.l("zoomend",t)),p&&this.fire(new c.l("rotateend",t)),b&&this.fire(new c.l("pitchend",t)),T&&this.fire(new c.l("rollend",t)),this.fire(new c.l("moveend",t))}flyTo(t,a){if(!t.essential&&Be.prefersReducedMotion){const pt=c.U(t,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(pt,a)}this.stop(),t=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.cz},t);const h=this._getTransformForUpdate(),p=h.bearing,b=h.pitch,T=h.roll,k=h.padding,z="bearing"in t?this._normalizeBearing(t.bearing,p):p,F="pitch"in t?+t.pitch:b,V="roll"in t?this._normalizeBearing(t.roll,T):T,H="padding"in t?t.padding:h.padding,Y=c.P.convert(t.offset);let J=h.centerPoint.add(Y);const ae=h.screenPointToLocation(J),ge=this.cameraHelper.handleFlyTo(h,{bearing:z,pitch:F,roll:V,padding:H,locationAtOffset:ae,offsetAsPoint:Y,center:t.center,minZoom:t.minZoom,zoom:t.zoom});let ve=t.curve;const ye=Math.max(h.width,h.height),be=ye/ge.scaleOfZoom,De=ge.pixelPathLength;typeof ge.scaleOfMinZoom=="number"&&(ve=Math.sqrt(ye/ge.scaleOfMinZoom/De*2));const we=ve*ve;function Oe(pt){const Dt=(be*be-ye*ye+(pt?-1:1)*we*we*De*De)/(2*(pt?be:ye)*we*De);return Math.log(Math.sqrt(Dt*Dt+1)-Dt)}function je(pt){return(Math.exp(pt)-Math.exp(-pt))/2}function Ae(pt){return(Math.exp(pt)+Math.exp(-pt))/2}const $e=Oe(!1);let ht=function(pt){return Ae($e)/Ae($e+ve*pt)},st=function(pt){return ye*((Ae($e)*(je(Dt=$e+ve*pt)/Ae(Dt))-je($e))/we)/De;var Dt},ft=(Oe(!0)-$e)/ve;if(Math.abs(De)<2e-6||!isFinite(ft)){if(Math.abs(ye-be)<1e-6)return this.easeTo(t,a);const pt=be<ye?-1:1;ft=Math.abs(Math.log(be/ye))/ve,st=()=>0,ht=Dt=>Math.exp(pt*ve*Dt)}return t.duration="duration"in t?+t.duration:1e3*ft/("screenSpeed"in t?+t.screenSpeed/ve:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=p!==z,this._pitching=F!==b,this._rolling=V!==T,this._padding=!h.isPaddingEqual(H),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(ge.targetCenter),this._ease((pt=>{const Dt=pt*ft,qt=1/ht(Dt),Pt=st(Dt);this._rotating&&h.setBearing(c.G.number(p,z,pt)),this._pitching&&h.setPitch(c.G.number(b,F,pt)),this._rolling&&h.setRoll(c.G.number(T,V,pt)),this._padding&&(h.interpolatePadding(k,H,pt),J=h.centerPoint.add(Y)),ge.easeFunc(pt,qt,Pt,J),this.terrain&&!t.freezeElevation&&this._updateElevation(pt),this._applyUpdatedTransform(h),this._fireMoveEvents(a)}),(()=>{this.terrain&&t.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,a){var h;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,a)}return t||(h=this.handlers)===null||h===void 0||h.stop(!1),this}_ease(t,a,h){h.animate===!1||h.duration===0?(t(1),a()):(this._easeStart=dt(),this._easeOptions=h,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(t,a){t=c.W(t,-180,180);const h=Math.abs(t-a);return Math.abs(t-360-a)<h&&(t-=360),Math.abs(t+360-a)<h&&(t+=360),t}queryTerrainElevation(t){return this.terrain?this.terrain.getElevationForLngLat(c.V.convert(t)):null}}const Ka={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class dr{constructor(t=Ka){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=t}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options.compact,this._container=Ce.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Ce.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ce.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Ce.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,a){const h=this._map._getUIString(`AttributionControl.${a}`);t.title=h,t.setAttribute("aria-label",h)}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((p=>typeof p!="string"?"":p))):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const a=this._map.style.tileManagers;for(const p in a){const b=a[p];if(b.used||b.usedForTerrain){const T=b.getSource();T.attribution&&t.indexOf(T.attribution)<0&&t.push(T.attribution)}}t=t.filter((p=>String(p).trim())),t.sort(((p,b)=>p.length-b.length)),t=t.filter(((p,b)=>{for(let T=b+1;T<t.length;T++)if(t[T].indexOf(p)>=0)return!1;return!0}));const h=t.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,t.length?(this._innerContainer.innerHTML=Ce.sanitize(h),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class sl{constructor(t={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const h=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&h.classList.add("maplibregl-compact"):h.classList.remove("maplibregl-compact")}},this.options=t}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=Ce.create("div","maplibregl-ctrl");const a=Ce.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Ce.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class oi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,h=a?this._queue.concat(a):this._queue;for(const p of h)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const h of a)if(!h.cancelled&&(h.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var fn=c.aV([{name:"a_pos3d",type:"Int16",components:3}]);class Mi extends c.E{constructor(t){super(),this._lastTilesetChange=dt(),this.tileManager=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=t._source.tileSize*2**this.deltaZoom,t.usedForTerrain=!0,t.tileSize=this.tileSize}destruct(){this.tileManager.usedForTerrain=!1,this.tileManager.tileSize=null}getSource(){return this.tileManager._source}update(t,a){this.tileManager.update(t,a),this._renderableTilesKeys=[];const h={};for(const p of ki(t,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.tileManager._source.calculateTileZoom}))h[p.key]=!0,this._renderableTilesKeys.push(p.key),this._tiles[p.key]||(p.terrainRttPosMatrix32f=new Float64Array(16),c.c8(p.terrainRttPosMatrix32f,0,c.a5,c.a5,0,0,1),this._tiles[p.key]=new St(p,this.tileSize),this._lastTilesetChange=dt());for(const p in this._tiles)h[p]||delete this._tiles[p]}freeRtt(t){for(const a in this._tiles){const h=this._tiles[a];(!t||h.tileID.equals(t)||h.tileID.isChildOf(t)||t.isChildOf(h.tileID))&&(h.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((t=>this.getTileByID(t)))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t,a){return a?this._getTerrainCoordsForTileRanges(t,a):this._getTerrainCoordsForRegularTile(t)}_getTerrainCoordsForRegularTile(t){const a={};for(const h of this._renderableTilesKeys){const p=this._tiles[h].tileID,b=t.clone(),T=c.bl();if(p.canonical.equals(t.canonical))c.c8(T,0,c.a5,c.a5,0,0,1);else if(p.canonical.isChildOf(t.canonical)){const k=p.canonical.z-t.canonical.z,z=p.canonical.x-(p.canonical.x>>k<<k),F=p.canonical.y-(p.canonical.y>>k<<k),V=c.a5>>k;c.c8(T,0,V,V,0,0,1),c.O(T,T,[-z*V,-F*V,0])}else{if(!t.canonical.isChildOf(p.canonical))continue;{const k=t.canonical.z-p.canonical.z,z=t.canonical.x-(t.canonical.x>>k<<k),F=t.canonical.y-(t.canonical.y>>k<<k),V=c.a5>>k;c.c8(T,0,c.a5,c.a5,0,0,1),c.O(T,T,[z*V,F*V,0]),c.Q(T,T,[1/2**k,1/2**k,0])}}b.terrainRttPosMatrix32f=new Float32Array(T),a[h]=b}return a}_getTerrainCoordsForTileRanges(t,a){const h={};for(const p of this._renderableTilesKeys){const b=this._tiles[p].tileID;if(!this._isWithinTileRanges(b,a))continue;const T=t.clone(),k=c.bl();if(b.canonical.z===t.canonical.z){const z=t.canonical.x-b.canonical.x,F=t.canonical.y-b.canonical.y;c.c8(k,0,c.a5,c.a5,0,0,1),c.O(k,k,[z*c.a5,F*c.a5,0])}else if(b.canonical.z>t.canonical.z){const z=b.canonical.z-t.canonical.z,F=b.canonical.x-(b.canonical.x>>z<<z),V=b.canonical.y-(b.canonical.y>>z<<z),H=t.canonical.x-(b.canonical.x>>z),Y=t.canonical.y-(b.canonical.y>>z),J=c.a5>>z;c.c8(k,0,J,J,0,0,1),c.O(k,k,[-F*J+H*c.a5,-V*J+Y*c.a5,0])}else{const z=t.canonical.z-b.canonical.z,F=t.canonical.x-(t.canonical.x>>z<<z),V=t.canonical.y-(t.canonical.y>>z<<z),H=(t.canonical.x>>z)-b.canonical.x,Y=(t.canonical.y>>z)-b.canonical.y,J=c.a5<<z;c.c8(k,0,J,J,0,0,1),c.O(k,k,[F*c.a5+H*J,V*c.a5+Y*J,0])}T.terrainRttPosMatrix32f=new Float32Array(k),h[p]=T}return h}getSourceTile(t,a){const h=this.tileManager._source;let p=t.overscaledZ-this.deltaZoom;if(p>h.maxzoom&&(p=h.maxzoom),p<h.minzoom)return;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let b=this.findTileInCaches(this._sourceTileCache[t.key]);if(!b?.dem&&a)for(;p>=h.minzoom&&!b?.dem;)b=this.findTileInCaches(t.scaledTo(p--).key);return b}findTileInCaches(t){let a=this.tileManager.getTileByID(t);return a||(a=this.tileManager._outOfViewCache.getByKey(t),a)}anyTilesAfterTime(t=Date.now()){return this._lastTilesetChange>=t}_isWithinTileRanges(t,a){return a[t.canonical.z]&&t.canonical.x>=a[t.canonical.z].minTileX&&t.canonical.x<=a[t.canonical.z].maxTileX&&t.canonical.y>=a[t.canonical.z].minTileY&&t.canonical.y<=a[t.canonical.z].maxTileY}}class Qi{constructor(t,a,h){this._meshCache={},this.painter=t,this.tileManager=new Mi(a),this.options=h,this.exaggeration=typeof h.exaggeration=="number"?h.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(t,a,h,p=c.a5){var b;if(!(a>=0&&a<p&&h>=0&&h<p))return 0;const T=this.getTerrainData(t),k=(b=T.tile)===null||b===void 0?void 0:b.dem;if(!k)return 0;const z=c.cD([],[a/p*c.a5,h/p*c.a5],T.u_terrain_matrix),F=[z[0]*k.dim,z[1]*k.dim],V=Math.floor(F[0]),H=Math.floor(F[1]),Y=F[0]-V,J=F[1]-H;return k.get(V,H)*(1-Y)*(1-J)+k.get(V+1,H)*Y*(1-J)+k.get(V,H+1)*(1-Y)*J+k.get(V+1,H+1)*Y*J}getElevationForLngLatZoom(t,a){if(!c.cE(a,t.wrap()))return 0;const{tileID:h,mercatorX:p,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(t,a);return this.getElevation(h,p%c.a5,b%c.a5,c.a5)}getElevationForLngLat(t){return this.getElevationForLngLatZoom(t,this.tileManager.maxzoom)}getElevation(t,a,h,p=c.a5){return this.getDEMElevation(t,a,h,p)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.painter.context,b=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new c.T(p,b,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new c.T(p,new c.R({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.as([])}const a=this.tileManager.getSourceTile(t,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const p=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new c.T(p,a.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),a.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const h=a&&a+a.tileID.key+t.key;if(h&&!this._demMatrixCache[h]){const p=this.tileManager.getSource().maxzoom;let b=t.canonical.z-a.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?b=t.canonical.z-p:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const T=t.canonical.x-(t.canonical.x>>b<<b),k=t.canonical.y-(t.canonical.y>>b<<b),z=c.cF(new Float64Array(16),[1/(c.a5<<b),1/(c.a5<<b),0]);c.O(z,z,[T*c.a5,k*c.a5,0]),this._demMatrixCache[t.key]={matrix:z,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:h?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(t){const a=this.painter,h=a.width/devicePixelRatio,p=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===h&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new c.T(a.context,{width:h,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new c.T(a.context,{width:h,height:p,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(h,p,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,h,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,T=0;b<this._coordsTextureSize;b++)for(let k=0;k<this._coordsTextureSize;k++,T+=4)a[T+0]=255&k,a[T+1]=255&b,a[T+2]=k>>8<<4|b>>8,a[T+3]=0;const h=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),p=new c.T(t,h,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),h=this.painter.context,p=h.gl,b=Math.round(t.x*this.painter.pixelRatio/devicePixelRatio),T=Math.round(t.y*this.painter.pixelRatio/devicePixelRatio),k=Math.round(this.painter.height/devicePixelRatio);h.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),p.readPixels(b,k-T-1,1,1,p.RGBA,p.UNSIGNED_BYTE,a),h.bindFramebuffer.set(null);const z=a[0]+(a[2]>>4<<8),F=a[1]+((15&a[2])<<8),V=this.coordsIndex[255-a[3]],H=V&&this.tileManager.getTileByID(V);if(!H)return null;const Y=this._coordsTextureSize,J=(1<<H.tileID.canonical.z)*Y;return new c.ab((H.tileID.canonical.x*Y+z)/J+H.tileID.wrap,(H.tileID.canonical.y*Y+F)/J,this.getElevation(H.tileID,z,F,Y))}depthAtPoint(t){const a=new Uint8Array(4),h=this.painter.context,p=h.gl;return h.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),p.readPixels(t.x,this.painter.height/devicePixelRatio-t.y-1,1,1,p.RGBA,p.UNSIGNED_BYTE,a),h.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(t){var a;const h=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,p=h&&t.canonical.y===0,b=h&&t.canonical.y===(1<<t.canonical.z)-1,T=`m_${p?"n":""}_${b?"s":""}`;if(this._meshCache[T])return this._meshCache[T];const k=this.painter.context,z=new c.cG,F=new c.aZ,V=this.meshSize,H=c.a5/V,Y=V*V;for(let Ae=0;Ae<=V;Ae++)for(let $e=0;$e<=V;$e++)z.emplaceBack($e*H,Ae*H,0);for(let Ae=0;Ae<Y;Ae+=V+1)for(let $e=0;$e<V;$e++)F.emplaceBack($e+Ae,V+$e+Ae+1,V+$e+Ae+2),F.emplaceBack($e+Ae,V+$e+Ae+2,$e+Ae+1);const J=z.length,ae=J+(V+1),ge=(V+1)*V,ve=p?c.bs:0,ye=p?0:1,be=b?c.bt:c.a5,De=b?0:1;for(let Ae=0;Ae<=V;Ae++)z.emplaceBack(Ae*H,ve,ye);for(let Ae=0;Ae<=V;Ae++)z.emplaceBack(Ae*H,be,De);for(let Ae=0;Ae<V;Ae++)F.emplaceBack(ge+Ae,ae+Ae,ae+Ae+1),F.emplaceBack(ge+Ae,ae+Ae+1,ge+Ae+1),F.emplaceBack(0+Ae,J+Ae+1,J+Ae),F.emplaceBack(0+Ae,0+Ae+1,J+Ae+1);const we=z.length,Oe=we+2*(V+1);for(const Ae of[0,1])for(let $e=0;$e<=V;$e++)for(const ht of[0,1])z.emplaceBack(Ae*c.a5,$e*H,ht);for(let Ae=0;Ae<2*V;Ae+=2)F.emplaceBack(we+Ae,we+Ae+1,we+Ae+3),F.emplaceBack(we+Ae,we+Ae+3,we+Ae+2),F.emplaceBack(Oe+Ae,Oe+Ae+3,Oe+Ae+1),F.emplaceBack(Oe+Ae,Oe+Ae+2,Oe+Ae+3);const je=new ei(k.createVertexBuffer(z,fn.members),k.createIndexBuffer(F),c.aY.simpleSegment(0,0,z.length,F.length));return this._meshCache[T]=je,je}getMeshFrameDelta(t){return 2*Math.PI*c.bF/Math.pow(2,Math.max(t,0))/5}getMinTileElevationForLngLatZoom(t,a){var h;if(!c.cE(a,t.wrap()))return 0;const{tileID:p}=this._getOverscaledTileIDFromLngLatZoom(t,a);return(h=this.getMinMaxElevation(p).minElevation)!==null&&h!==void 0?h:0}getMinMaxElevation(t){const a=this.getTerrainData(t).tile,h={minElevation:null,maxElevation:null};return a&&a.dem&&(h.minElevation=a.dem.min*this.exaggeration,h.maxElevation=a.dem.max*this.exaggeration),h}_getOverscaledTileIDFromLngLatZoom(t,a){const h=c.ab.fromLngLat(t.wrap()),p=(1<<a)*c.a5,b=h.x*p,T=h.y*p,k=Math.floor(b/c.a5),z=Math.floor(T/c.a5);return{tileID:new c.a2(a,0,a,k,z),mercatorX:b,mercatorY:T}}}class bu{constructor(t,a,h){this._context=t,this._size=a,this._tileSize=h,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const t of this._objects)t.texture.destroy(),t.fbo.destroy()}_createObject(t){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),h=new c.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return h.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(h.texture),{id:t,fbo:a,texture:h,stamp:-1,inUse:!1}}getObjectForId(t){return this._objects[t]}useObject(t){t.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>t.id!==a)),this._recentlyUsed.push(t.id)}stampObject(t){t.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const t=this._createObject(this._objects.length);return this._objects.push(t),t}freeObject(t){t.inUse=!1}freeAllObjects(){for(const t of this._objects)this.freeObject(t)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((t=>!t.inUse))===!1}}const ys={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class ol{constructor(t,a){this.painter=t,this.terrain=a,this.pool=new bu(t.context,30,a.tileManager.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(t){return this.pool.getObjectForId(t.rtt[this._stacks.length-1].id).texture}prepareForRender(t,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.tileManager.getRenderableTiles(),this._renderableLayerIds=t._order.filter((h=>!t._layers[h].isHidden(a))),this._coordsAscending={};for(const h in t.tileManagers){this._coordsAscending[h]={};const p=t.tileManagers[h].getVisibleCoordinates(),b=t.tileManagers[h].getSource(),T=b instanceof Sr?b.terrainTileRanges:null;for(const k of p){const z=this.terrain.tileManager.getTerrainCoords(k,T);for(const F in z)this._coordsAscending[h][F]||(this._coordsAscending[h][F]=[]),this._coordsAscending[h][F].push(z[F])}}this._coordsAscendingStr={};for(const h of t._order){const p=t._layers[h],b=p.source;if(ys[p.type]&&!this._coordsAscendingStr[b]){this._coordsAscendingStr[b]={};for(const T in this._coordsAscending[b])this._coordsAscendingStr[b][T]=this._coordsAscending[b][T].map((k=>k.key)).sort().join()}}for(const h of this._renderableTiles)for(const p in this._coordsAscendingStr){const b=this._coordsAscendingStr[p][h.tileID.key];b&&b!==h.rttCoords[p]&&(h.rtt=[])}}renderLayer(t,a){if(t.isHidden(this.painter.transform.zoom))return!1;const h=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),p=t.type,b=this.painter,T=this._renderableLayerIds[this._renderableLayerIds.length-1]===t.id;if(ys[p]&&(this._prevType&&ys[this._prevType]||this._stacks.push([]),this._prevType=p,this._stacks[this._stacks.length-1].push(t.id),!T))return!0;if(ys[this._prevType]||ys[p]&&T){this._prevType=p;const k=this._stacks.length-1,z=this._stacks[k]||[];for(const F of this._renderableTiles){if(this.pool.isFull()&&(Fh(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(F),F.rtt[k]){const H=this.pool.getObjectForId(F.rtt[k].id);if(H.stamp===F.rtt[k].stamp){this.pool.useObject(H);continue}}const V=this.pool.getOrCreateFreeObject();this.pool.useObject(V),this.pool.stampObject(V),F.rtt[k]={id:V.id,stamp:V.stamp},b.context.bindFramebuffer.set(V.fbo.framebuffer),b.context.clear({color:c.bq.transparent,stencil:0}),b.currentStencilSource=void 0;for(let H=0;H<z.length;H++){const Y=b.style._layers[z[H]],J=Y.source?this._coordsAscending[Y.source][F.tileID.key]:[F.tileID];b.context.viewport.set([0,0,V.fbo.width,V.fbo.height]),b._renderTileClippingMasks(Y,J,!0),b.renderLayer(b,b.style.tileManagers[Y.source],Y,J,h),Y.source&&(F.rttCoords[Y.source]=this._coordsAscendingStr[Y.source][F.tileID.key])}}return Fh(this.painter,this.terrain,this._rttTiles,h),this._rttTiles=[],this.pool.freeAllObjects(),ys[p]}return!1}}const oc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},ll=X,ul={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ka,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.c.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,reduceMotion:void 0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0,experimentalZoomLevelsToOverscale:void 0},Nf={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ji{constructor(t,a,h=!1){this.mousedown=b=>{this.startMove(b,Ce.mousePos(this.element,b)),Ce.addEventListener(window,"mousemove",this.mousemove),Ce.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.move(b,Ce.mousePos(this.element,b))},this.mouseup=b=>{this._rotatePitchHandler.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ce.touchPos(this.element,b.targetTouches)[0],this.startMove(b,this._startPos),Ce.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ce.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=Ce.touchPos(this.element,b.targetTouches)[0],this.move(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const p=new Qc;this._rotatePitchHandler=new _s({clickTolerance:3,move:(b,T)=>{const k=a.getBoundingClientRect(),z=new c.P((k.bottom-k.top)/2,(k.right-k.left)/2);return{bearingDelta:c.cy(new c.P(b.x,T.y),T,z),pitchDelta:h?-.5*(T.y-b.y):void 0}},moveStateManager:p,enable:!0,assignEvents:()=>{}}),this.map=t,Ce.addEventListener(a,"mousedown",this.mousedown),Ce.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),Ce.addEventListener(a,"touchcancel",this.reset)}startMove(t,a){this._rotatePitchHandler.dragStart(t,a),Ce.disableDrag()}move(t,a){const h=this.map,{bearingDelta:p,pitchDelta:b}=this._rotatePitchHandler.dragMove(t,a)||{};p&&h.setBearing(h.getBearing()+p),b&&h.setPitch(h.getPitch()+b)}off(){const t=this.element;Ce.removeEventListener(t,"mousedown",this.mousedown),Ce.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),Ce.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ce.removeEventListener(window,"touchend",this.touchend),Ce.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){Ce.enableDrag(),Ce.removeEventListener(window,"mousemove",this.mousemove),Ce.removeEventListener(window,"mouseup",this.mouseup),Ce.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Ce.removeEventListener(window,"touchend",this.touchend)}}let eo;function lc(v,t,a,h=!1){if(h||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return v?.wrap();const p=new c.V(v.lng,v.lat);if(v=new c.V(v.lng,v.lat),t){const b=new c.V(v.lng-360,v.lat),T=new c.V(v.lng+360,v.lat),k=a.locationToScreenPoint(v).distSqr(t);a.locationToScreenPoint(b).distSqr(t)<k?v=b:a.locationToScreenPoint(T).distSqr(t)<k&&(v=T)}for(;Math.abs(v.lng-a.center.lng)>180;){const b=a.locationToScreenPoint(v);if(b.x>=0&&b.y>=0&&b.x<=a.width&&b.y<=a.height)break;v.lng>a.center.lng?v.lng-=360:v.lng+=360}return v.lng!==p.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(v))?v:p}const uc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function th(v,t,a){const h=v.classList;for(const p in uc)h.remove(`maplibregl-${a}-anchor-${p}`);h.add(`maplibregl-${a}-anchor-${t}`)}class nh extends c.E{constructor(t){if(super(),this._onKeyPress=a=>{const h=a.code,p=a.charCode||a.keyCode;h!=="Space"&&h!=="Enter"&&p!==32&&p!==13||this.togglePopup()},this._onMapClick=a=>{const h=a.originalEvent.target,p=this._element;this._popup&&(h===p||p.contains(h))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const h=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!h)&&this._map.once("render",this._update),this._lngLat=lc(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let p="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?p=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(p=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),Ce.setTransform(this._element,`${uc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${p}`),Be.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const h=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.l("dragstart"))),this.fire(new c.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._subpixelPositioning=t&&t.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,this.setOpacity(t?.opacity,t?.opacityWhenCovered),t&&t.element)this._element=t.element,this._offset=c.P.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ce.create("div");const a=Ce.createNS("http://www.w3.org/2000/svg","svg"),h=41,p=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${h}px`),a.setAttributeNS(null,"width",`${p}px`),a.setAttributeNS(null,"viewBox",`0 0 ${p} ${h}`);const b=Ce.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const T=Ce.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");const k=Ce.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");const z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ye of z){const be=Ce.createNS("http://www.w3.org/2000/svg","ellipse");be.setAttributeNS(null,"opacity","0.04"),be.setAttributeNS(null,"cx","10.5"),be.setAttributeNS(null,"cy","5.80029008"),be.setAttributeNS(null,"rx",ye.rx),be.setAttributeNS(null,"ry",ye.ry),k.appendChild(be)}const F=Ce.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const V=Ce.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild(V);const H=Ce.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"opacity","0.25"),H.setAttributeNS(null,"fill","#000000");const Y=Ce.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),H.appendChild(Y);const J=Ce.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(6.0, 7.0)"),J.setAttributeNS(null,"fill","#FFFFFF");const ae=Ce.createNS("http://www.w3.org/2000/svg","g");ae.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ge=Ce.createNS("http://www.w3.org/2000/svg","circle");ge.setAttributeNS(null,"fill","#000000"),ge.setAttributeNS(null,"opacity","0.25"),ge.setAttributeNS(null,"cx","5.5"),ge.setAttributeNS(null,"cy","5.5"),ge.setAttributeNS(null,"r","5.4999962");const ve=Ce.createNS("http://www.w3.org/2000/svg","circle");ve.setAttributeNS(null,"fill","#FFFFFF"),ve.setAttributeNS(null,"cx","5.5"),ve.setAttributeNS(null,"cy","5.5"),ve.setAttributeNS(null,"r","5.4999962"),ae.appendChild(ge),ae.appendChild(ve),T.appendChild(k),T.appendChild(F),T.appendChild(H),T.appendChild(J),T.appendChild(ae),a.appendChild(T),a.setAttributeNS(null,"height",h*this._scale+"px"),a.setAttributeNS(null,"width",p*this._scale+"px"),this._element.appendChild(a),this._offset=c.P.convert(t&&t.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),th(this._element,this._anchor,"marker"),t&&t.className)for(const a of t.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(t){return this.remove(),this._map=t,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",t._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),t.on("terrain",this._update),t.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Ce.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=c.V.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.abs(13.5)/Math.SQRT2;t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(t){return this._subpixelPositioning=t,this}getPopup(){return this._popup}togglePopup(){const t=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:t?(t.isOpen()?t.remove():(t.setLngLat(this._lngLat),t.addTo(this._map)),this):this}_updateOpacity(t=!1){var a,h;const p=(a=this._map)===null||a===void 0?void 0:a.terrain,b=this._map.transform.isLocationOccluded(this._lngLat);if(!p||b){const J=b?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==J&&(this._element.style.opacity=J))}if(t)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const T=this._map,k=T.terrain.depthAtPoint(this._pos),z=T.terrain.getElevationForLngLat(this._lngLat);if(T.transform.lngLatToCameraDepth(this._lngLat,z)-k<.006)return void(this._element.style.opacity=this._opacity);const F=-this._offset.y/T.transform.pixelsPerMeter,V=Math.sin(T.getPitch()*Math.PI/180)*F,H=T.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),Y=T.transform.lngLatToCameraDepth(this._lngLat,z+V)-H>.006;!((h=this._popup)===null||h===void 0)&&h.isOpen()&&Y&&this._popup.remove(),this._element.style.opacity=Y?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(t){return this._offset=c.P.convert(t),this._update(),this}addClassName(t){this._element.classList.add(t)}removeClassName(t){this._element.classList.remove(t)}toggleClassName(t){return this._element.classList.toggle(t)}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(t,a){return(this._opacity===void 0||t===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),t!==void 0&&(this._opacity=t),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const ih={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let cl=0,hl=!1;const ma={maxWidth:100,unit:"metric"};function Vi(v,t,a){const h=a&&a.maxWidth||100,p=v._container.clientHeight/2,b=v._container.clientWidth/2,T=v.unproject([b-h/2,p]),k=v.unproject([b+h/2,p]),z=Math.round(v.project(k).x-v.project(T).x),F=Math.min(h,z,v._container.clientWidth),V=T.distanceTo(k);if(a&&a.unit==="imperial"){const H=3.2808*V;H>5280?zo(t,F,H/5280,v._getUIString("ScaleControl.Miles")):zo(t,F,H,v._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?zo(t,F,V/1852,v._getUIString("ScaleControl.NauticalMiles")):V>=1e3?zo(t,F,V/1e3,v._getUIString("ScaleControl.Kilometers")):zo(t,F,V,v._getUIString("ScaleControl.Meters"))}function zo(v,t,a,h){const p=(function(b){const T=Math.pow(10,`${Math.floor(b)}`.length-1);let k=b/T;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:(function(z){const F=Math.pow(10,Math.ceil(-Math.log(z)/Math.LN10));return Math.round(z*F)/F})(k),T*k})(a);v.style.width=t*(p/a)+"px",v.innerHTML=`${p}&nbsp;${h}`}const wu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},cc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function hc(v){if(v){if(typeof v=="number"){const t=Math.round(Math.abs(v)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,v),"top-left":new c.P(t,t),"top-right":new c.P(-t,t),bottom:new c.P(0,-v),"bottom-left":new c.P(t,-t),"bottom-right":new c.P(-t,-t),left:new c.P(v,0),right:new c.P(-v,0)}}if(v instanceof c.P||Array.isArray(v)){const t=c.P.convert(v);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:c.P.convert(v.center||[0,0]),top:c.P.convert(v.top||[0,0]),"top-left":c.P.convert(v["top-left"]||[0,0]),"top-right":c.P.convert(v["top-right"]||[0,0]),bottom:c.P.convert(v.bottom||[0,0]),"bottom-left":c.P.convert(v["bottom-left"]||[0,0]),"bottom-right":c.P.convert(v["bottom-right"]||[0,0]),left:c.P.convert(v.left||[0,0]),right:c.P.convert(v.right||[0,0])}}return hc(new c.P(0,0))}const to=X;L.AJAXError=c.cJ,L.Event=c.l,L.Evented=c.E,L.LngLat=c.V,L.MercatorCoordinate=c.ab,L.Point=c.P,L.addProtocol=c.cK,L.config=c.c,L.removeProtocol=c.cL,L.AttributionControl=dr,L.BoxZoomHandler=$c,L.CanvasSource=re,L.CooperativeGesturesHandler=Na,L.DoubleClickZoomHandler=zf,L.DragPanHandler=on,L.DragRotateHandler=mn,L.EdgeInsets=ca,L.FullscreenControl=class extends c.E{constructor(v={}){super(),this._onFullscreenChange=()=>{var t;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((t=a?.shadowRoot)===null||t===void 0)&&t.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,v&&v.container&&(v.container instanceof HTMLElement?this._container=v.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Ce.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const v=this._fullscreenButton=Ce.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Ce.create("span","maplibregl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.title=v}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},L.GeoJSONSource=dn,L.GeolocateControl=class extends c.E{constructor(v){super(),this._onSuccess=t=>{if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new c.l("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.l("geolocate",t)),this._finish()}},this._updateCamera=t=>{const a=new c.V(t.coords.longitude,t.coords.latitude),h=t.coords.accuracy,p=this._map.getBearing(),b=c.e({bearing:p},this.options.fitBoundsOptions),T=Ri.fromLngLat(a,h);this._map.fitBounds(T,b,{geolocateSource:!0})},this._updateMarker=t=>{if(t){const a=new c.V(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=t.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=t=>{if(this._map){if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&hl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.l("error",t)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Ce.create("button","maplibregl-ctrl-geolocate",this._container),Ce.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=t=>{if(this._map){if(t===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ce.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new nh({element:this._dotElement}),this._circleElement=Ce.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new nh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const h=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.l("trackuserlocationend")),this.fire(new c.l("userlocationlostfocus")))}))}},this.options=c.e({},ih,v)}onAdd(v){return this._map=v,this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return c._(this,arguments,void 0,(function*(t=!1){if(eo!==void 0&&!t)return eo;if(window.navigator.permissions===void 0)return eo=!!window.navigator.geolocation,eo;try{eo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{eo=!!window.navigator.geolocation}return eo}))})().then((t=>this._finishSetupUI(t))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Ce.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,cl=0,hl=!1}_isOutOfMapMaxBounds(v){const t=this._map.getMaxBounds(),a=v.coords;return t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const v=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&v))return;const t=this._map.project(v),a=this._map.unproject([t.x+100,t.y]),h=v.distanceTo(a)/100,p=2*this._accuracy/h;this._circleElement.style.width=`${p.toFixed(2)}px`,this._circleElement.style.height=`${p.toFixed(2)}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":cl--,hl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.l("trackuserlocationstart")),this.fire(new c.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let v;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),cl++,cl>1?(v={maximumAge:6e5,timeout:0},hl=!0):(v=this.options.positionOptions,hl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,v)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},L.GlobeControl=class{constructor(){this._toggleProjection=()=>{var v;const t=(v=this._map.getProjection())===null||v===void 0?void 0:v.type;this._map.setProjection(t!=="mercator"&&t?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var v;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((v=this._map.getProjection())===null||v===void 0?void 0:v.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(v){return this._map=v,this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Ce.create("button","maplibregl-ctrl-globe",this._container),Ce.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Ce.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},L.Hash=Ki,L.ImageSource=Sr,L.KeyboardHandler=yu,L.LngLatBounds=Ri,L.LogoControl=sl,L.Map=class extends Vl{constructor(v){var t,a;c.cH.mark(c.cI.create);const h=Object.assign(Object.assign(Object.assign({},ul),v),{canvasContextAttributes:Object.assign(Object.assign({},ul.canvasContextAttributes),v.canvasContextAttributes)});if(h.minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const p=new rr,b=new ha;if(h.minZoom!==void 0&&p.setMinZoom(h.minZoom),h.maxZoom!==void 0&&p.setMaxZoom(h.maxZoom),h.minPitch!==void 0&&p.setMinPitch(h.minPitch),h.maxPitch!==void 0&&p.setMaxPitch(h.maxPitch),h.renderWorldCopies!==void 0&&p.setRenderWorldCopies(h.renderWorldCopies),h.transformConstrain!==null&&p.setConstrainOverride(h.transformConstrain),super(p,b,{bearingSnap:h.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new oi,this._controls=[],this._mapId=c.ah(),this._lostContextStyle={style:null,images:null},this._contextLost=k=>{k.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.painter.destroy();for(const z of Object.values(this.style._layers))if(z.type==="custom"&&console.warn(`Custom layer with id '${z.id}' cannot be restored after WebGL context loss. You will need to re-add it manually after context restoration.`),z._listeners)for(const[F]of Object.entries(z._listeners))console.warn(`Custom layer with id '${z.id}' had event listeners for event '${F}' which cannot be restored after WebGL context loss. You will need to re-add them manually after context restoration.`);this._lostContextStyle=this._getStyleAndImages(),this.style.destroy(),this.style=null,this.fire(new c.l("webglcontextlost",{originalEvent:k}))},this._contextRestored=k=>{this._lostContextStyle.style&&this.setStyle(this._lostContextStyle.style,{diff:!1}),this._lostContextStyle.images&&(this.style.imageManager.images=this._lostContextStyle.images),this._setupPainter(),this.resize(),this._update(),this.fire(new c.l("webglcontextrestored",{originalEvent:k}))},this._onMapScroll=k=>{if(k.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._maxTileCacheZoomLevels=h.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},h.canvasContextAttributes),this._trackResize=h.trackResize===!0,this._bearingSnap=h.bearingSnap,this._centerClampedToGround=h.centerClampedToGround,this._refreshExpiredTiles=h.refreshExpiredTiles===!0,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions===!0,this._collectResourceTiming=h.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},oc),h.locale),this._clickTolerance=h.clickTolerance,this._overridePixelRatio=h.pixelRatio,this._maxCanvasSize=h.maxCanvasSize,this._zoomLevelsToOverscale=h.experimentalZoomLevelsToOverscale,this.transformCameraUpdate=h.transformCameraUpdate,this.transformConstrain=h.transformConstrain,this.cancelPendingTileRequestsWhileZooming=h.cancelPendingTileRequestsWhileZooming===!0,h.reduceMotion!==void 0&&(Be.prefersReducedMotion=h.reduceMotion),this._imageQueueHandle=wt.addThrottleControl((()=>this.isMoving())),this._requestManager=new oe(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let k=!1;const z=Df((F=>{this._trackResize&&!this._removed&&(this.resize(F),this.redraw())}),50);this._resizeObserver=new ResizeObserver((F=>{k?z(F):k=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Of(this,h),this._hash=h.hash&&new Ki(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,elevation:h.elevation,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch,roll:h.roll}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,c.e({},h.fitBoundsOptions,{duration:0}))));const T=typeof h.style=="string"||((a=(t=h.style)===null||t===void 0?void 0:t.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,T),this._localIdeographFontFamily=h.localIdeographFontFamily,this._validateStyle=h.validateStyle,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new dr(typeof h.attributionControl=="boolean"?void 0:h.attributionControl)),h.maplibreLogo&&this.addControl(new sl,h.logoPosition),this.on("style.load",(()=>{if(T||this._resizeTransform(),this.transform.unmodified){const k=c.U(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(k)}})),this.on("data",(k=>{this._update(k.dataType==="style"),this.fire(new c.l(`${k.dataType}data`,k))})),this.on("dataloading",(k=>{this.fire(new c.l(`${k.dataType}dataloading`,k))})),this.on("dataabort",(k=>{this.fire(new c.l("sourcedataabort",k))}))}_getMapId(){return this._mapId}setGlobalStateProperty(v,t){return this.style.setGlobalStateProperty(v,t),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(v,t){if(t===void 0&&(t=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new c.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=v.onAdd(this);this._controls.push(v);const h=this._controlPositions[t];return t.indexOf("bottom")!==-1?h.insertBefore(a,h.firstChild):h.appendChild(a),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new c.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(v);return t>-1&&this._controls.splice(t,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}coveringTiles(v){return ki(this.transform,v)}calculateCameraOptionsFromTo(v,t,a,h){return h==null&&this.terrain&&(h=this.terrain.getElevationForLngLat(a)),super.calculateCameraOptionsFromTo(v,t,a,h)}resize(v,t=!0){const[a,h]=this._containerDimensions(),p=this._getClampedPixelRatio(a,h);if(this._resizeCanvas(a,h,p),this.painter.resize(a,h,p),this.painter.overLimit()){const T=this.painter.context.gl;this._maxCanvasSize=[T.drawingBufferWidth,T.drawingBufferHeight];const k=this._getClampedPixelRatio(a,h);this._resizeCanvas(a,h,k),this.painter.resize(a,h,k)}this._resizeTransform(t);const b=!this._moving;return b&&(this.stop(),this.fire(new c.l("movestart",v)).fire(new c.l("move",v))),this.fire(new c.l("resize",v)),b&&this.fire(new c.l("moveend",v)),this}_resizeTransform(v=!0){var t;const[a,h]=this._containerDimensions();this.transform.resize(a,h,v),(t=this._requestedCameraState)===null||t===void 0||t.resize(a,h,v)}_getClampedPixelRatio(v,t){const{0:a,1:h}=this._maxCanvasSize,p=this.getPixelRatio(),b=v*p,T=t*p;return Math.min(b>a?a/b:1,T>h?h/T:1)*p}getPixelRatio(){var v;return(v=this._overridePixelRatio)!==null&&v!==void 0?v:devicePixelRatio}setPixelRatio(v){this._overridePixelRatio=v,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(v){return this.transform.setMaxBounds(Ri.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.setMinZoom(v),this._update(),this.getZoom()<v&&this.setZoom(v),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.setMaxZoom(v),this._update(),this.getZoom()>v&&this.setZoom(v),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.setMinPitch(v),this._update(),this.getPitch()<v&&this.setPitch(v),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(v>=this.transform.minPitch)return this.transform.setMaxPitch(v),this._update(),this.getPitch()>v&&this.setPitch(v),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.setRenderWorldCopies(v),this._update()}setTransformConstrain(v){return this.transform.setConstrainOverride(v),this._update()}project(v){return this.transform.locationToScreenPoint(c.V.convert(v),this.style&&this.terrain)}unproject(v){return this.transform.screenPointToLocation(c.P.convert(v),this.terrain)}isMoving(){var v;return this._moving||((v=this.handlers)===null||v===void 0?void 0:v.isMoving())}isZooming(){var v;return this._zooming||((v=this.handlers)===null||v===void 0?void 0:v.isZooming())}isRotating(){var v;return this._rotating||((v=this.handlers)===null||v===void 0?void 0:v.isRotating())}_createDelegatedListener(v,t,a){if(v==="mouseenter"||v==="mouseover"){let h=!1;return{layers:t,listener:a,delegates:{mousemove:b=>{const T=t.filter((z=>this.getLayer(z))),k=T.length!==0?this.queryRenderedFeatures(b.point,{layers:T}):[];k.length?h||(h=!0,a.call(this,new Wa(v,this,b.originalEvent,{features:k}))):h=!1},mouseout:()=>{h=!1}}}}if(v==="mouseleave"||v==="mouseout"){let h=!1;return{layers:t,listener:a,delegates:{mousemove:T=>{const k=t.filter((z=>this.getLayer(z)));(k.length!==0?this.queryRenderedFeatures(T.point,{layers:k}):[]).length?h=!0:h&&(h=!1,a.call(this,new Wa(v,this,T.originalEvent)))},mouseout:T=>{h&&(h=!1,a.call(this,new Wa(v,this,T.originalEvent)))}}}}{const h=p=>{const b=t.filter((k=>this.getLayer(k))),T=b.length!==0?this.queryRenderedFeatures(p.point,{layers:b}):[];T.length&&(p.features=T,a.call(this,p),delete p.features)};return{layers:t,listener:a,delegates:{[v]:h}}}}_saveDelegatedListener(v,t){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(t)}_removeDelegatedListener(v,t,a){if(!this._delegatedListeners||!this._delegatedListeners[v])return;const h=this._delegatedListeners[v];for(let p=0;p<h.length;p++){const b=h[p];if(b.listener===a&&b.layers.length===t.length&&b.layers.every((T=>t.includes(T)))){for(const T in b.delegates)this.off(T,b.delegates[T]);return void h.splice(p,1)}}}on(v,t,a){if(a===void 0)return super.on(v,t);const h=typeof t=="string"?[t]:t,p=this._createDelegatedListener(v,h,a);this._saveDelegatedListener(v,p);for(const b in p.delegates)this.on(b,p.delegates[b]);return{unsubscribe:()=>{this._removeDelegatedListener(v,h,a)}}}once(v,t,a){if(a===void 0)return super.once(v,t);const h=typeof t=="string"?[t]:t,p=this._createDelegatedListener(v,h,a);for(const b in p.delegates){const T=p.delegates[b];p.delegates[b]=(...k)=>{this._removeDelegatedListener(v,h,a),T(...k)}}this._saveDelegatedListener(v,p);for(const b in p.delegates)this.once(b,p.delegates[b]);return this}off(v,t,a){return a===void 0?super.off(v,t):(this._removeDelegatedListener(v,typeof t=="string"?[t]:t,a),this)}queryRenderedFeatures(v,t){if(!this.style)return[];let a;const h=v instanceof c.P||Array.isArray(v),p=h?v:[[0,0],[this.transform.width,this.transform.height]];if(t=t||(h?{}:v)||{},p instanceof c.P||typeof p[0]=="number")a=[c.P.convert(p)];else{const b=c.P.convert(p[0]),T=c.P.convert(p[1]);a=[b,new c.P(T.x,b.y),T,new c.P(b.x,T.y),b]}return this.style.queryRenderedFeatures(a,t,this.transform)}querySourceFeatures(v,t){return this.style.querySourceFeatures(v,t)}setStyle(v,t){return(t=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&v?(this._diffStyle(v,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(v,t))}setTransformRequest(v){return this._requestManager.setTransformRequest(v),this}_getUIString(v){const t=this._locale[v];if(t==null)throw new Error(`Missing UI string '${v}'`);return t}_updateStyle(v,t){var a,h;if(t.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(v,t)));const p=this.style&&t.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!v)),v?(this.style=new xo(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof v=="string"?this.style.loadURL(v,t,p):this.style.loadJSON(v,t,p),this):((h=(a=this.style)===null||a===void 0?void 0:a.projection)===null||h===void 0||h.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new xo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,t){if(typeof v=="string"){const a=this._requestManager.transformRequest(v,"Style");c.j(a,new AbortController).then((h=>{this._updateDiff(h.data,t)})).catch((h=>{h&&this.fire(new c.k(h))}))}else typeof v=="object"&&this._updateDiff(v,t)}_updateDiff(v,t){try{this.style.setState(v,t)&&this._update(!0)}catch(a){c.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(v,t)}}getStyle(){if(this.style)return this.style.serialize()}_getStyleAndImages(){return this.style?{style:this.style.serialize(),images:this.style.imageManager.cloneImages()}:{style:null,images:{}}}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(v,t){return this._lazyInitEmptyStyle(),this.style.addSource(v,t),this._update(!0)}isSourceLoaded(v){const t=this.style&&this.style.tileManagers[v];if(t!==void 0)return t.loaded();this.fire(new c.k(new Error(`There is no tile manager with ID '${v}'`)))}setTerrain(v){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),v){const t=this.style.tileManagers[v.source];if(!t)throw new Error(`cannot load terrain, because there exists no source with ID: ${v.source}`);this.terrain===null&&t.reload();for(const a in this.style._layers){const h=this.style._layers[a];h.type==="hillshade"&&h.source===v.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),h.type==="color-relief"&&h.source===v.source&&c.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Qi(this.painter,t,v),this.painter.renderToTexture=new ol(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var h;a.dataType==="style"?this.terrain.tileManager.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==v.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((h=a.source)===null||h===void 0?void 0:h.type)==="image"?this.terrain.tileManager.freeRtt():this.terrain.tileManager.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.tileManager.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new c.l("terrain",{terrain:v})),this}getTerrain(){var v,t;return(t=(v=this.terrain)===null||v===void 0?void 0:v.options)!==null&&t!==void 0?t:null}areTilesLoaded(){const v=this.style&&this.style.tileManagers;for(const t of Object.values(v))if(!t.areTilesLoaded())return!1;return!0}removeSource(v){return this.style.removeSource(v),this._update(!0)}getSource(v){return this.style.getSource(v)}setSourceTileLodParams(v,t,a){if(a){const h=this.getSource(a);if(!h)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);h.calculateTileZoom=Nt(Math.max(1,v),Math.max(1,t))}else for(const h in this.style.tileManagers)this.style.tileManagers[h].getSource().calculateTileZoom=Nt(Math.max(1,v),Math.max(1,t));return this._update(!0),this}refreshTiles(v,t){const a=this.style.tileManagers[v];if(!a)throw new Error(`There is no tile manager with ID "${v}", cannot refresh tile`);t===void 0?a.reload(!0):a.refreshTiles(t.map((h=>new c.ae(h.z,h.x,h.y))))}addImage(v,t,a={}){const{pixelRatio:h=1,sdf:p=!1,stretchX:b,stretchY:T,content:k,textFitWidth:z,textFitHeight:F}=a;if(this._lazyInitEmptyStyle(),!(t instanceof HTMLImageElement||c.b(t))){if(t.width===void 0||t.height===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:V,height:H,data:Y}=t,J=t;return this.style.addImage(v,{data:new c.R({width:V,height:H},new Uint8Array(Y)),pixelRatio:h,stretchX:b,stretchY:T,content:k,textFitWidth:z,textFitHeight:F,sdf:p,version:0,userImage:J}),J.onAdd&&J.onAdd(this,v),this}}{const{width:V,height:H,data:Y}=Be.getImageData(t);this.style.addImage(v,{data:new c.R({width:V,height:H},Y),pixelRatio:h,stretchX:b,stretchY:T,content:k,textFitWidth:z,textFitHeight:F,sdf:p,version:0})}}updateImage(v,t){const a=this.style.getImage(v);if(!a)return this.fire(new c.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=t instanceof HTMLImageElement||c.b(t)?Be.getImageData(t):t,{width:p,height:b,data:T}=h;if(p===void 0||b===void 0)return this.fire(new c.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==a.data.width||b!==a.data.height)return this.fire(new c.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const k=!(t instanceof HTMLImageElement||c.b(t));return a.data.replace(T,k),this.style.updateImage(v,a),this}getImage(v){return this.style.getImage(v)}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new c.k(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v){return wt.getImage(this._requestManager.transformRequest(v,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(v,t){return this._lazyInitEmptyStyle(),this.style.addLayer(v,t),this._update(!0)}moveLayer(v,t){return this.style.moveLayer(v,t),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(v,t,a){return this.style.setLayerZoomRange(v,t,a),this._update(!0)}setFilter(v,t,a={}){return this.style.setFilter(v,t,a),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,t,a,h={}){return this.style.setPaintProperty(v,t,a,h),this._update(!0)}getPaintProperty(v,t){return this.style.getPaintProperty(v,t)}setLayoutProperty(v,t,a,h={}){return this.style.setLayoutProperty(v,t,a,h),this._update(!0)}getLayoutProperty(v,t){return this.style.getLayoutProperty(v,t)}setGlyphs(v,t={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(v,t),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(v,t,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(v,t,a,(h=>{h||this._update(!0)})),this}removeSprite(v){return this._lazyInitEmptyStyle(),this.style.removeSprite(v),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(v,t={}){return this._lazyInitEmptyStyle(),this.style.setSprite(v,t,(a=>{a||this._update(!0)})),this}setLight(v,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,t),this._update(!0)}getLight(){return this.style.getLight()}setSky(v,t={}){return this._lazyInitEmptyStyle(),this.style.setSky(v,t),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(v,t){return this.style.setFeatureState(v,t),this._update()}removeFeatureState(v,t){return this.style.removeFeatureState(v,t),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let v=0,t=0;return this._container&&(v=this._container.clientWidth||400,t=this._container.clientHeight||300),[v,t]}_setupContainer(){const v=this._container;v.classList.add("maplibregl-map");const t=this._canvasContainer=Ce.create("div","maplibregl-canvas-container",v);this._interactive&&t.classList.add("maplibregl-interactive"),this._canvas=Ce.create("canvas","maplibregl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),h=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],h);const p=this._controlContainer=Ce.create("div","maplibregl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((T=>{b[T]=Ce.create("div",`maplibregl-ctrl-${T} `,p)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,t,a){this._canvas.width=Math.floor(a*v),this._canvas.height=Math.floor(a*t),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const v=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let t=null;this._canvas.addEventListener("webglcontextcreationerror",(h=>{t={requestedAttributes:v},h&&(t.statusMessage=h.statusMessage,t.type=h.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,v):this._canvas.getContext("webgl2",v)||this._canvas.getContext("webgl",v),!a){const h="Failed to initialize WebGL";throw t?(t.message=h,new Error(JSON.stringify(t))):new Error(h)}this.painter=new Rd(a,this.transform),It.testSupport(a)}migrateProjection(v,t){super.migrateProjection(v,t),this.painter.transform=v,this.fire(new c.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_render(v){var t,a,h,p,b;const T=this._idleTriggered?this._fadeDuration:0,k=((t=this.style.projection)===null||t===void 0?void 0:t.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(v),this._removed)return;let z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const H=this.transform.zoom,Y=dt();this.style.zoomHistory.update(H,Y);const J=new c.H(H,{now:Y,fadeDuration:T,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ae=J.crossFadingFactor();ae===1&&ae===this._crossFadingFactor||(z=!0,this._crossFadingFactor=ae),this.style.update(J)}const F=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==k;(h=this.style.projection)===null||h===void 0||h.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((p=this.style.projection)===null||p===void 0?void 0:p.transitionState,(b=this.style.projection)===null||b===void 0?void 0:b.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||F)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.tileManager.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,T,this._crossSourceCollisions,F),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,showPadding:this.showPadding}),this.fire(new c.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.cH.mark(c.cI.load),this.fire(new c.l("load"))),this.style&&(this.style.hasTransitions()||z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const V=this._sourcesDirty||this._styleDirty||this._placementDirty;return V||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.l("idle")),!this._loaded||this._fullyLoaded||V||(this._fullyLoaded=!0,c.cH.mark(c.cI.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var v;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),wt.removeThrottleControl(this._imageQueueHandle),(v=this._resizeObserver)===null||v===void 0||v.disconnect();const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t?.loseContext&&t.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Ce.remove(this._canvasContainer),Ce.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),c.cH.clearMetrics(),this._removed=!0,this.fire(new c.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,Be.frame(this._frameRequest,(v=>{c.cH.frame(v),this._frameRequest=null;try{this._render(v)}catch(t){if(!c.Z(t)&&!(function(a){return a.message===Dl})(t))throw t}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get version(){return ll}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(v){return this._lazyInitEmptyStyle(),this.style.setProjection(v),this._update(!0)}},L.MapMouseEvent=Wa,L.MapTouchEvent=Qs,L.MapWheelEvent=Xc,L.Marker=nh,L.NavigationControl=class{constructor(v){this._updateZoomButtons=()=>{const t=this._map.getZoom(),a=t===this._map.getMaxZoom(),h=t===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(t,a)=>{const h=this._map._getUIString(`NavigationControl.${a}`);t.title=h,t.setAttribute("aria-label",h)},this.options=c.e({},Nf,v),this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(t=>this._map.zoomIn({},{originalEvent:t}))),Ce.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(t=>this._map.zoomOut({},{originalEvent:t}))),Ce.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})})),this._compassIcon=Ce.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ji(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Ce.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(v,t){const a=Ce.create("button",v,this._container);return a.type="button",a.addEventListener("click",t),a}},L.Popup=class extends c.E{constructor(v){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&Ce.remove(this._content),this._container&&(Ce.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.l("close"))),this),this._onMouseUp=t=>{this._update(t.point)},this._onMouseMove=t=>{this._update(t.point)},this._onDrag=t=>{this._update(t.point)},this._update=t=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Ce.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Ce.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const T of this.options.className.split(" "))this._container.classList.add(T);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=lc(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!t)return;const a=this._flatPos=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&t?t:this._map.transform.locationToScreenPoint(this._lngLat));let h=this.options.anchor;const p=hc(this.options.offset);if(!h){const T=this._container.offsetWidth,k=this._container.offsetHeight;let z;z=a.y+p.bottom.y<k?["top"]:a.y>this._map.transform.height-k?["bottom"]:[],a.x<T/2?z.push("left"):a.x>this._map.transform.width-T/2&&z.push("right"),h=z.length===0?"bottom":z.join("-")}let b=a.add(p[h]);this.options.subpixelPositioning||(b=b.round()),Ce.setTransform(this._container,`${uc[h]} translate(${b.x}px,${b.y}px)`),th(this._container,h,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(wu),v)}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(v){return this._lngLat=c.V.convert(v),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(document.createTextNode(v))}setHTML(v){const t=document.createDocumentFragment(),a=document.createElement("body");let h;for(a.innerHTML=v;h=a.firstChild,h;)t.appendChild(h);return this.setDOMContent(t)}getMaxWidth(){var v;return(v=this._container)===null||v===void 0?void 0:v.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Ce.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(v),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(v){return this._container&&this._container.classList.add(v),this}removeClassName(v){return this._container&&this._container.classList.remove(v),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){if(this._container)return this._container.classList.toggle(v)}setSubpixelPositioning(v){this.options.subpixelPositioning=v}_createCloseButton(){this.options.closeButton&&(this._closeButton=Ce.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(cc);v&&v.focus()}},L.RasterDEMTileSource=os,L.RasterTileSource=qs,L.ScaleControl=class{constructor(v){this._onMove=()=>{Vi(this._map,this._container,this.options)},this.setUnit=t=>{this.options.unit=t,Vi(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ma),v)}getDefaultPosition(){return"bottom-left"}onAdd(v){return this._map=v,this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-scale",v.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Ce.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},L.ScrollZoomHandler=Zh,L.Style=xo,L.TerrainControl=class{constructor(v){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=v}onAdd(v){return this._map=v,this._container=Ce.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Ce.create("button","maplibregl-ctrl-terrain",this._container),Ce.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Ce.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},L.TwoFingersTouchPitchHandler=al,L.TwoFingersTouchRotateHandler=Js,L.TwoFingersTouchZoomHandler=rl,L.TwoFingersTouchZoomRotateHandler=Ul,L.VectorTileSource=Yt,L.VideoSource=nt,L.addSourceType=(v,t)=>c._(void 0,void 0,void 0,(function*(){if(he(v))throw new Error(`A source type called "${v}" already exists.`);((a,h)=>{te[a]=h})(v,t)})),L.clearPrewarmedResources=function(){const v=_n;v&&(v.isPreloaded()&&v.numActive()===1?(v.release(Ct),_n=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},L.createTileMesh=Oc,L.getMaxParallelImageRequests=function(){return c.c.MAX_PARALLEL_IMAGE_REQUESTS},L.getRTLTextPluginStatus=function(){return Je().getRTLTextPluginStatus()},L.getVersion=function(){return to},L.getWorkerCount=function(){return Zt.workerCount},L.getWorkerUrl=function(){return c.c.WORKER_URL},L.importScriptInWorkers=function(v){return rn().broadcast("IS",v)},L.isTimeFrozen=function(){return Ge.isFrozen()},L.now=dt,L.prewarm=function(){ni().acquire(Ct)},L.restoreNow=function(){Ge.restoreNow()},L.setMaxParallelImageRequests=function(v){c.c.MAX_PARALLEL_IMAGE_REQUESTS=v},L.setNow=function(v){Ge.setNow(v)},L.setRTLTextPlugin=function(v,t){return Je().setRTLTextPlugin(v,t)},L.setWorkerCount=function(v){Zt.workerCount=v},L.setWorkerUrl=function(v){c.c.WORKER_URL=v}}));var U=P;return U}))})(n_)),n_.exports}var Zm=X0();const $0=Vv(Zm),W0=N0({__proto__:null,default:$0},[Zm]);var Es=63710088e-1,Zv={centimeters:Es*100,centimetres:Es*100,degrees:360/(2*Math.PI),feet:Es*3.28084,inches:Es*39.37,kilometers:Es/1e3,kilometres:Es/1e3,meters:Es,metres:Es,miles:Es/1609.344,millimeters:Es*1e3,millimetres:Es*1e3,nauticalmiles:Es/1852,radians:1,yards:Es*1.0936};function Ad(S,C,P={}){const I={type:"Feature"};return(P.id===0||P.id)&&(I.id=P.id),P.bbox&&(I.bbox=P.bbox),I.properties=C||{},I.geometry=S,I}function Zu(S,C,P={}){if(!S)throw new Error("coordinates is required");if(!Array.isArray(S))throw new Error("coordinates must be an Array");if(S.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wy(S[0])||!Wy(S[1]))throw new Error("coordinates must contain numbers");return Ad({type:"Point",coordinates:S},C,P)}function xl(S,C,P={}){for(const D of S){if(D.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(D[D.length-1].length!==D[0].length)throw new Error("First and last Position are not equivalent.");for(let U=0;U<D[D.length-1].length;U++)if(D[D.length-1][U]!==D[0][U])throw new Error("First and last Position are not equivalent.")}return Ad({type:"Polygon",coordinates:S},C,P)}function Cd(S,C,P={}){if(S.length<2)throw new Error("coordinates must be an array of two or more positions");return Ad({type:"LineString",coordinates:S},C,P)}function bl(S,C={}){const P={type:"FeatureCollection"};return C.id&&(P.id=C.id),C.bbox&&(P.bbox=C.bbox),P.features=S,P}function K0(S,C,P={}){return Ad({type:"MultiLineString",coordinates:S},C,P)}function x_(S,C,P={}){return Ad({type:"MultiPolygon",coordinates:S},C,P)}function Ty(S,C="kilometers"){const P=Zv[C];if(!P)throw new Error(C+" units is invalid");return S*P}function Sy(S,C="kilometers"){const P=Zv[C];if(!P)throw new Error(C+" units is invalid");return S/P}function $y(S){return S%(2*Math.PI)*180/Math.PI}function Md(S){return S%360*Math.PI/180}function Q0(S,C="kilometers",P="kilometers"){if(!(S>=0))throw new Error("length must be a positive number");return Ty(Sy(S,C),P)}function Wy(S){return!isNaN(S)&&S!==null&&!Array.isArray(S)}function Yv(S){return S!==null&&typeof S=="object"&&!Array.isArray(S)}function bh(S){if(!S)throw new Error("coord is required");if(!Array.isArray(S)){if(S.type==="Feature"&&S.geometry!==null&&S.geometry.type==="Point")return[...S.geometry.coordinates];if(S.type==="Point")return[...S.coordinates]}if(Array.isArray(S)&&S.length>=2&&!Array.isArray(S[0])&&!Array.isArray(S[1]))return[...S];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Ac(S){if(Array.isArray(S))return S;if(S.type==="Feature"){if(S.geometry!==null)return S.geometry.coordinates}else if(S.coordinates)return S.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function b_(S){return S.type==="Feature"?S.geometry:S}function J0(S,C){return S.type==="FeatureCollection"?"FeatureCollection":S.type==="GeometryCollection"?"GeometryCollection":S.type==="Feature"&&S.geometry!==null?S.geometry.type:S.type}function ex(S,C,P,I={}){const D=bh(S),U=Md(D[0]),L=Md(D[1]),c=Md(P),X=Sy(C,I.units),ne=Math.asin(Math.sin(L)*Math.cos(X)+Math.cos(L)*Math.sin(X)*Math.cos(c)),fe=U+Math.atan2(Math.sin(c)*Math.sin(X)*Math.cos(L),Math.cos(X)-Math.sin(L)*Math.sin(ne)),ie=$y(fe),xe=$y(ne);return D[2]!==void 0?Zu([ie,xe,D[2]],I.properties):Zu([ie,xe],I.properties)}function tx(S,C,P={}){var I=bh(S),D=bh(C),U=Md(D[1]-I[1]),L=Md(D[0]-I[0]),c=Md(I[1]),X=Md(D[1]),ne=Math.pow(Math.sin(U/2),2)+Math.pow(Math.sin(L/2),2)*Math.cos(c)*Math.cos(X);return Ty(2*Math.atan2(Math.sqrt(ne),Math.sqrt(1-ne)),P.units)}function Hv(S,C,P){if(S!==null)for(var I,D,U,L,c,X,ne,fe=0,ie=0,xe,Be=S.type,Ge=Be==="FeatureCollection",dt=Be==="Feature",Ce=Ge?S.features.length:1,It=0;It<Ce;It++){ne=Ge?S.features[It].geometry:dt?S.geometry:S,xe=ne?ne.type==="GeometryCollection":!1,c=xe?ne.geometries.length:1;for(var Ye=0;Ye<c;Ye++){var at=0,jt=0;if(L=xe?ne.geometries[Ye]:ne,L!==null){X=L.coordinates;var At=L.type;switch(fe=0,At){case null:break;case"Point":if(C(X,ie,It,at,jt)===!1)return!1;ie++,at++;break;case"LineString":case"MultiPoint":for(I=0;I<X.length;I++){if(C(X[I],ie,It,at,jt)===!1)return!1;ie++,At==="MultiPoint"&&at++}At==="LineString"&&at++;break;case"Polygon":case"MultiLineString":for(I=0;I<X.length;I++){for(D=0;D<X[I].length-fe;D++){if(C(X[I][D],ie,It,at,jt)===!1)return!1;ie++}At==="MultiLineString"&&at++,At==="Polygon"&&jt++}At==="Polygon"&&at++;break;case"MultiPolygon":for(I=0;I<X.length;I++){for(jt=0,D=0;D<X[I].length;D++){for(U=0;U<X[I][D].length-fe;U++){if(C(X[I][D][U],ie,It,at,jt)===!1)return!1;ie++}jt++}at++}break;case"GeometryCollection":for(I=0;I<L.geometries.length;I++)if(Hv(L.geometries[I],C)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function u_(S,C){if(S.type==="Feature")C(S,0);else if(S.type==="FeatureCollection")for(var P=0;P<S.features.length&&C(S.features[P],P)!==!1;P++);}function Th(S,C){var P,I,D,U,L,c,X,ne,fe,ie,xe=0,Be=S.type==="FeatureCollection",Ge=S.type==="Feature",dt=Be?S.features.length:1;for(P=0;P<dt;P++){for(c=Be?S.features[P].geometry:Ge?S.geometry:S,ne=Be?S.features[P].properties:Ge?S.properties:{},fe=Be?S.features[P].bbox:Ge?S.bbox:void 0,ie=Be?S.features[P].id:Ge?S.id:void 0,X=c?c.type==="GeometryCollection":!1,L=X?c.geometries.length:1,D=0;D<L;D++){if(U=X?c.geometries[D]:c,U===null){if(C(null,xe,ne,fe,ie)===!1)return!1;continue}switch(U.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(C(U,xe,ne,fe,ie)===!1)return!1;break}case"GeometryCollection":{for(I=0;I<U.geometries.length;I++)if(C(U.geometries[I],xe,ne,fe,ie)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}xe++}}function nx(S,C,P){var I=P;return Th(S,function(D,U,L,c,X){I=C(I,D,U,L,c,X)}),I}function Ky(S){return nx(S,(C,P)=>C+ix(P),0)}function ix(S){let C=0,P;switch(S.type){case"Polygon":return Qy(S.coordinates);case"MultiPolygon":for(P=0;P<S.coordinates.length;P++)C+=Qy(S.coordinates[P]);return C;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function Qy(S){let C=0;if(S&&S.length>0){C+=Math.abs(Jy(S[0]));for(let P=1;P<S.length;P++)C-=Math.abs(Jy(S[P]))}return C}var rx=Es*Es/2,ny=Math.PI/180;function Jy(S){const C=S.length-1;if(C<=2)return 0;let P=0,I=0;for(;I<C;){const D=S[I],U=S[I+1===C?0:I+1],L=S[I+2>=C?(I+2)%C:I+2],c=D[0]*ny,X=U[1]*ny,ne=L[0]*ny;P+=(ne-c)*Math.sin(X),I++}return P*rx}function ax(S,C={}){if(S.bbox!=null&&C.recompute!==!0)return S.bbox;const P=[1/0,1/0,-1/0,-1/0];return Hv(S,I=>{P[0]>I[0]&&(P[0]=I[0]),P[1]>I[1]&&(P[1]=I[1]),P[2]<I[0]&&(P[2]=I[0]),P[3]<I[1]&&(P[3]=I[1])}),P}function hy(S){const C=Ac(S);let P=0,I=1,D,U;for(;I<C.length;)D=U||C[0],U=C[I],P+=(U[0]-D[0])*(U[1]+D[1]),I++;return P>0}const xh=11102230246251565e-32,Vs=134217729,sx=(3+8*xh)*xh;function iy(S,C,P,I,D){let U,L,c,X,ne=C[0],fe=I[0],ie=0,xe=0;fe>ne==fe>-ne?(U=ne,ne=C[++ie]):(U=fe,fe=I[++xe]);let Be=0;if(ie<S&&xe<P)for(fe>ne==fe>-ne?(L=ne+U,c=U-(L-ne),ne=C[++ie]):(L=fe+U,c=U-(L-fe),fe=I[++xe]),U=L,c!==0&&(D[Be++]=c);ie<S&&xe<P;)fe>ne==fe>-ne?(L=U+ne,X=L-U,c=U-(L-X)+(ne-X),ne=C[++ie]):(L=U+fe,X=L-U,c=U-(L-X)+(fe-X),fe=I[++xe]),U=L,c!==0&&(D[Be++]=c);for(;ie<S;)L=U+ne,X=L-U,c=U-(L-X)+(ne-X),ne=C[++ie],U=L,c!==0&&(D[Be++]=c);for(;xe<P;)L=U+fe,X=L-U,c=U-(L-X)+(fe-X),fe=I[++xe],U=L,c!==0&&(D[Be++]=c);return(U!==0||Be===0)&&(D[Be++]=U),Be}function ox(S,C){let P=C[0];for(let I=1;I<S;I++)P+=C[I];return P}function Wm(S){return new Float64Array(S)}const lx=(3+16*xh)*xh,ux=(2+12*xh)*xh,cx=(9+64*xh)*xh*xh,Ep=Wm(4),ev=Wm(8),tv=Wm(12),nv=Wm(16),co=Wm(4);function hx(S,C,P,I,D,U,L){let c,X,ne,fe,ie,xe,Be,Ge,dt,Ce,It,Ye,at,jt,At,Vt,wt,oe;const de=S-D,Ie=P-D,Xe=C-U,Ne=I-U;jt=de*Ne,xe=Vs*de,Be=xe-(xe-de),Ge=de-Be,xe=Vs*Ne,dt=xe-(xe-Ne),Ce=Ne-dt,At=Ge*Ce-(jt-Be*dt-Ge*dt-Be*Ce),Vt=Xe*Ie,xe=Vs*Xe,Be=xe-(xe-Xe),Ge=Xe-Be,xe=Vs*Ie,dt=xe-(xe-Ie),Ce=Ie-dt,wt=Ge*Ce-(Vt-Be*dt-Ge*dt-Be*Ce),It=At-wt,ie=At-It,Ep[0]=At-(It+ie)+(ie-wt),Ye=jt+It,ie=Ye-jt,at=jt-(Ye-ie)+(It-ie),It=at-Vt,ie=at-It,Ep[1]=at-(It+ie)+(ie-Vt),oe=Ye+It,ie=oe-Ye,Ep[2]=Ye-(oe-ie)+(It-ie),Ep[3]=oe;let He=ox(4,Ep),Fe=ux*L;if(He>=Fe||-He>=Fe||(ie=S-de,c=S-(de+ie)+(ie-D),ie=P-Ie,ne=P-(Ie+ie)+(ie-D),ie=C-Xe,X=C-(Xe+ie)+(ie-U),ie=I-Ne,fe=I-(Ne+ie)+(ie-U),c===0&&X===0&&ne===0&&fe===0)||(Fe=cx*L+sx*Math.abs(He),He+=de*fe+Ne*c-(Xe*ne+Ie*X),He>=Fe||-He>=Fe))return He;jt=c*Ne,xe=Vs*c,Be=xe-(xe-c),Ge=c-Be,xe=Vs*Ne,dt=xe-(xe-Ne),Ce=Ne-dt,At=Ge*Ce-(jt-Be*dt-Ge*dt-Be*Ce),Vt=X*Ie,xe=Vs*X,Be=xe-(xe-X),Ge=X-Be,xe=Vs*Ie,dt=xe-(xe-Ie),Ce=Ie-dt,wt=Ge*Ce-(Vt-Be*dt-Ge*dt-Be*Ce),It=At-wt,ie=At-It,co[0]=At-(It+ie)+(ie-wt),Ye=jt+It,ie=Ye-jt,at=jt-(Ye-ie)+(It-ie),It=at-Vt,ie=at-It,co[1]=at-(It+ie)+(ie-Vt),oe=Ye+It,ie=oe-Ye,co[2]=Ye-(oe-ie)+(It-ie),co[3]=oe;const Le=iy(4,Ep,4,co,ev);jt=de*fe,xe=Vs*de,Be=xe-(xe-de),Ge=de-Be,xe=Vs*fe,dt=xe-(xe-fe),Ce=fe-dt,At=Ge*Ce-(jt-Be*dt-Ge*dt-Be*Ce),Vt=Xe*ne,xe=Vs*Xe,Be=xe-(xe-Xe),Ge=Xe-Be,xe=Vs*ne,dt=xe-(xe-ne),Ce=ne-dt,wt=Ge*Ce-(Vt-Be*dt-Ge*dt-Be*Ce),It=At-wt,ie=At-It,co[0]=At-(It+ie)+(ie-wt),Ye=jt+It,ie=Ye-jt,at=jt-(Ye-ie)+(It-ie),It=at-Vt,ie=at-It,co[1]=at-(It+ie)+(ie-Vt),oe=Ye+It,ie=oe-Ye,co[2]=Ye-(oe-ie)+(It-ie),co[3]=oe;const me=iy(Le,ev,4,co,tv);jt=c*fe,xe=Vs*c,Be=xe-(xe-c),Ge=c-Be,xe=Vs*fe,dt=xe-(xe-fe),Ce=fe-dt,At=Ge*Ce-(jt-Be*dt-Ge*dt-Be*Ce),Vt=X*ne,xe=Vs*X,Be=xe-(xe-X),Ge=X-Be,xe=Vs*ne,dt=xe-(xe-ne),Ce=ne-dt,wt=Ge*Ce-(Vt-Be*dt-Ge*dt-Be*Ce),It=At-wt,ie=At-It,co[0]=At-(It+ie)+(ie-wt),Ye=jt+It,ie=Ye-jt,at=jt-(Ye-ie)+(It-ie),It=at-Vt,ie=at-It,co[1]=at-(It+ie)+(ie-Vt),oe=Ye+It,ie=oe-Ye,co[2]=Ye-(oe-ie)+(It-ie),co[3]=oe;const Pe=iy(me,tv,4,co,nv);return nv[Pe-1]}function fx(S,C,P,I,D,U){const L=(C-U)*(P-D),c=(S-D)*(I-U),X=L-c,ne=Math.abs(L+c);return Math.abs(X)>=lx*ne?X:-hx(S,C,P,I,D,U,ne)}function dx(S,C){var P,I,D=0,U,L,c,X,ne,fe,ie,xe=S[0],Be=S[1],Ge=C.length;for(P=0;P<Ge;P++){I=0;var dt=C[P],Ce=dt.length-1;if(fe=dt[0],fe[0]!==dt[Ce][0]&&fe[1]!==dt[Ce][1])throw new Error("First and last coordinates in a ring must be the same");for(L=fe[0]-xe,c=fe[1]-Be,I;I<Ce;I++){if(ie=dt[I+1],X=ie[0]-xe,ne=ie[1]-Be,c===0&&ne===0){if(X<=0&&L>=0||L<=0&&X>=0)return 0}else if(ne>=0&&c<=0||ne<=0&&c>=0){if(U=fx(L,X,c,ne,0,0),U===0)return 0;(U>0&&ne>0&&c<=0||U<0&&ne<=0&&c>0)&&D++}fe=ie,c=ne,L=X}}return D%2!==0}function Hg(S,C,P={}){if(!S)throw new Error("point is required");if(!C)throw new Error("polygon is required");const I=bh(S),D=b_(C),U=D.type,L=C.bbox;let c=D.coordinates;if(L&&px(I,L)===!1)return!1;U==="Polygon"&&(c=[c]);let X=!1;for(var ne=0;ne<c.length;++ne){const fe=dx(I,c[ne]);if(fe===0)return!P.ignoreBoundary;fe&&(X=!0)}return X}function px(S,C){return C[0]<=S[0]&&C[1]<=S[1]&&C[2]>=S[0]&&C[3]>=S[1]}function Ym(S,C,P={}){const I=bh(S),D=Ac(C);for(let U=0;U<D.length-1;U++){let L=!1;if(P.ignoreEndVertices&&(U===0&&(L="start"),U===D.length-2&&(L="end"),U===0&&U+1===D.length-1&&(L="both")),mx(D[U],D[U+1],I,L,typeof P.epsilon>"u"?null:P.epsilon))return!0}return!1}function mx(S,C,P,I,D){const U=P[0],L=P[1],c=S[0],X=S[1],ne=C[0],fe=C[1],ie=P[0]-c,xe=P[1]-X,Be=ne-c,Ge=fe-X,dt=ie*Ge-xe*Be;if(D!==null){if(Math.abs(dt)>D)return!1}else if(dt!==0)return!1;if(Math.abs(Be)===Math.abs(Ge)&&Math.abs(Be)===0)return I?!1:P[0]===S[0]&&P[1]===S[1];if(I){if(I==="start")return Math.abs(Be)>=Math.abs(Ge)?Be>0?c<U&&U<=ne:ne<=U&&U<c:Ge>0?X<L&&L<=fe:fe<=L&&L<X;if(I==="end")return Math.abs(Be)>=Math.abs(Ge)?Be>0?c<=U&&U<ne:ne<U&&U<=c:Ge>0?X<=L&&L<fe:fe<L&&L<=X;if(I==="both")return Math.abs(Be)>=Math.abs(Ge)?Be>0?c<U&&U<ne:ne<U&&U<c:Ge>0?X<L&&L<fe:fe<L&&L<X}else return Math.abs(Be)>=Math.abs(Ge)?Be>0?c<=U&&U<=ne:ne<=U&&U<=c:Ge>0?X<=L&&L<=fe:fe<=L&&L<=X;return!1}function gx(S,C={}){const P=b_(S);switch(!C.properties&&S.type==="Feature"&&(C.properties=S.properties),P.type){case"Polygon":return _x(P,C);case"MultiPolygon":return yx(P,C);default:throw new Error("invalid poly")}}function _x(S,C={}){const I=b_(S).coordinates,D=C.properties?C.properties:S.type==="Feature"?S.properties:{};return Xv(I,D)}function yx(S,C={}){const I=b_(S).coordinates,D=C.properties?C.properties:S.type==="Feature"?S.properties:{},U=[];return I.forEach(L=>{U.push(Xv(L,D))}),bl(U)}function Xv(S,C){return S.length>1?K0(S,C):Cd(S[0],C)}function vx(S,C={}){var P=typeof C=="object"?C.mutate:C;if(!S)throw new Error("geojson is required");var I=J0(S),D=[];switch(I){case"LineString":D=ry(S,I);break;case"MultiLineString":case"Polygon":Ac(S).forEach(function(L){D.push(ry(L,I))});break;case"MultiPolygon":Ac(S).forEach(function(L){var c=[];L.forEach(function(X){c.push(ry(X,I))}),D.push(c)});break;case"Point":return S;case"MultiPoint":var U={};Ac(S).forEach(function(L){var c=L.join("-");Object.prototype.hasOwnProperty.call(U,c)||(D.push(L),U[c]=!0)});break;default:throw new Error(I+" geometry not supported")}return S.coordinates?P===!0?(S.coordinates=D,S):{type:I,coordinates:D}:P===!0?(S.geometry.coordinates=D,S):Ad({type:I,coordinates:D},S.properties,{bbox:S.bbox,id:S.id})}function ry(S,C){const P=Ac(S);if(P.length===2&&!iv(P[0],P[1]))return P;const I=[];let D=0,U=1,L=2;for(I.push(P[D]);L<P.length;)Ym(P[U],Cd([P[D],P[L]]))?U=L:(I.push(P[U]),D=U,U++,L=U),L++;if(I.push(P[U]),C==="Polygon"||C==="MultiPolygon"){if(Ym(I[0],Cd([I[1],I[I.length-2]]))&&(I.shift(),I.pop(),I.push(I[0])),I.length<4)throw new Error("invalid polygon, fewer than 4 points");if(!iv(I[0],I[I.length-1]))throw new Error("invalid polygon, first and last points not equal")}return I}function iv(S,C){return S[0]===C[0]&&S[1]===C[1]}function xx(S,C={}){const P=ax(S),I=(P[0]+P[2])/2,D=(P[1]+P[3])/2;return Zu([I,D],C.properties,C)}var i_={exports:{}},bx=i_.exports,rv;function wx(){return rv||(rv=1,(function(S,C){(function(P,I){S.exports=I()})(bx,(function(){function P(_,o){(o==null||o>_.length)&&(o=_.length);for(var u=0,g=Array(o);u<o;u++)g[u]=_[u];return g}function I(_,o,u){return o=fe(o),(function(g,M){if(M&&(typeof M=="object"||typeof M=="function"))return M;if(M!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(B){if(B===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B})(g)})(_,xe()?Reflect.construct(o,u||[],fe(_).constructor):o.apply(_,u))}function D(_,o){if(!(_ instanceof o))throw new TypeError("Cannot call a class as a function")}function U(_,o,u){if(xe())return Reflect.construct.apply(null,arguments);var g=[null];g.push.apply(g,o);var M=new(_.bind.apply(_,g));return u&&Be(M,u.prototype),M}function L(_,o){for(var u=0;u<o.length;u++){var g=o[u];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(_,Ce(g.key),g)}}function c(_,o,u){return o&&L(_.prototype,o),u&&L(_,u),Object.defineProperty(_,"prototype",{writable:!1}),_}function X(_,o){var u=typeof Symbol<"u"&&_[Symbol.iterator]||_["@@iterator"];if(!u){if(Array.isArray(_)||(u=It(_))||o){u&&(_=u);var g=0,M=function(){};return{s:M,n:function(){return g>=_.length?{done:!0}:{done:!1,value:_[g++]}},e:function(le){throw le},f:M}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var B,G=!0,K=!1;return{s:function(){u=u.call(_)},n:function(){var le=u.next();return G=le.done,le},e:function(le){K=!0,B=le},f:function(){try{G||u.return==null||u.return()}finally{if(K)throw B}}}}function ne(){return ne=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(_,o,u){var g=(function(B,G){for(;!{}.hasOwnProperty.call(B,G)&&(B=fe(B))!==null;);return B})(_,o);if(g){var M=Object.getOwnPropertyDescriptor(g,o);return M.get?M.get.call(arguments.length<3?_:u):M.value}},ne.apply(null,arguments)}function fe(_){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},fe(_)}function ie(_,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");_.prototype=Object.create(o&&o.prototype,{constructor:{value:_,writable:!0,configurable:!0}}),Object.defineProperty(_,"prototype",{writable:!1}),o&&Be(_,o)}function xe(){try{var _=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(xe=function(){return!!_})()}function Be(_,o){return Be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,g){return u.__proto__=g,u},Be(_,o)}function Ge(_,o,u,g){var M=ne(fe(1&g?_.prototype:_),o,u);return 2&g&&typeof M=="function"?function(B){return M.apply(u,B)}:M}function dt(_){return(function(o){if(Array.isArray(o))return P(o)})(_)||(function(o){if(typeof Symbol<"u"&&o[Symbol.iterator]!=null||o["@@iterator"]!=null)return Array.from(o)})(_)||It(_)||(function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function Ce(_){var o=(function(u,g){if(typeof u!="object"||!u)return u;var M=u[Symbol.toPrimitive];if(M!==void 0){var B=M.call(u,g);if(typeof B!="object")return B;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(u)})(_,"string");return typeof o=="symbol"?o:o+""}function It(_,o){if(_){if(typeof _=="string")return P(_,o);var u={}.toString.call(_).slice(8,-1);return u==="Object"&&_.constructor&&(u=_.constructor.name),u==="Map"||u==="Set"?Array.from(_):u==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(u)?P(_,o):void 0}}function Ye(_){var o=typeof Map=="function"?new Map:void 0;return Ye=function(u){if(u===null||!(function(M){try{return Function.toString.call(M).indexOf("[native code]")!==-1}catch{return typeof M=="function"}})(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(u))return o.get(u);o.set(u,g)}function g(){return U(u,arguments,fe(this).constructor)}return g.prototype=Object.create(u.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),Be(g,u)},Ye(_)}var at=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getEndCapStyle",value:function(){return this._endCapStyle}},{key:"isSingleSided",value:function(){return this._isSingleSided}},{key:"setQuadrantSegments",value:function(o){this._quadrantSegments=o,this._quadrantSegments===0&&(this._joinStyle=_.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=_.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),o<=0&&(this._quadrantSegments=1),this._joinStyle!==_.JOIN_ROUND&&(this._quadrantSegments=_.DEFAULT_QUADRANT_SEGMENTS)}},{key:"getJoinStyle",value:function(){return this._joinStyle}},{key:"setJoinStyle",value:function(o){this._joinStyle=o}},{key:"setSimplifyFactor",value:function(o){this._simplifyFactor=o<0?0:o}},{key:"getSimplifyFactor",value:function(){return this._simplifyFactor}},{key:"getQuadrantSegments",value:function(){return this._quadrantSegments}},{key:"setEndCapStyle",value:function(o){this._endCapStyle=o}},{key:"getMitreLimit",value:function(){return this._mitreLimit}},{key:"setMitreLimit",value:function(o){this._mitreLimit=o}},{key:"setSingleSided",value:function(o){this._isSingleSided=o}}],[{key:"constructor_",value:function(){if(this._quadrantSegments=_.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=_.CAP_ROUND,this._joinStyle=_.JOIN_ROUND,this._mitreLimit=_.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=_.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var o=arguments[0];this.setQuadrantSegments(o)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.setQuadrantSegments(u),this.setEndCapStyle(g)}else if(arguments.length===4){var M=arguments[0],B=arguments[1],G=arguments[2],K=arguments[3];this.setQuadrantSegments(M),this.setEndCapStyle(B),this.setJoinStyle(G),this.setMitreLimit(K)}}}},{key:"bufferDistanceError",value:function(o){var u=Math.PI/2/o;return 1-Math.cos(u/2)}}])})();at.CAP_ROUND=1,at.CAP_FLAT=2,at.CAP_SQUARE=3,at.JOIN_ROUND=1,at.JOIN_MITRE=2,at.JOIN_BEVEL=3,at.DEFAULT_QUADRANT_SEGMENTS=8,at.DEFAULT_MITRE_LIMIT=5,at.DEFAULT_SIMPLIFY_FACTOR=.01;var jt=(function(_){function o(u){var g;return D(this,o),(g=I(this,o,[u])).name=Object.keys({Exception:o})[0],g}return ie(o,_),c(o,[{key:"toString",value:function(){return this.message}}])})(Ye(Error)),At=(function(_){function o(u){var g;return D(this,o),(g=I(this,o,[u])).name=Object.keys({IllegalArgumentException:o})[0],g}return ie(o,_),c(o)})(jt),Vt=(function(){return c((function _(){D(this,_)}),[{key:"filter",value:function(_){}}])})();function wt(){}function oe(){}function de(){}var Ie,Xe,Ne,He,Fe,Le,me,Pe,Ue=(function(){return c((function _(){D(this,_)}),null,[{key:"equalsWithTolerance",value:function(_,o,u){return Math.abs(_-o)<=u}}])})(),tt=(function(){return c((function _(o,u){D(this,_),this.low=u||0,this.high=o||0}),null,[{key:"toBinaryString",value:function(_){var o,u="";for(o=2147483648;o>0;o>>>=1)u+=(_.high&o)===o?"1":"0";for(o=2147483648;o>0;o>>>=1)u+=(_.low&o)===o?"1":"0";return u}}])})();function vt(){}function Me(){}vt.NaN=NaN,vt.isNaN=function(_){return Number.isNaN(_)},vt.isInfinite=function(_){return!Number.isFinite(_)},vt.MAX_VALUE=Number.MAX_VALUE,vt.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,vt.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,typeof Float64Array=="function"&&typeof Int32Array=="function"?(Le=2146435072,me=new Float64Array(1),Pe=new Int32Array(me.buffer),vt.doubleToLongBits=function(_){me[0]=_;var o=0|Pe[0],u=0|Pe[1];return(u&Le)===Le&&1048575&u&&o!==0&&(o=0,u=2146959360),new tt(u,o)},vt.longBitsToDouble=function(_){return Pe[0]=_.low,Pe[1]=_.high,me[0]}):(Ie=1023,Xe=Math.log2,Ne=Math.floor,He=Math.pow,Fe=(function(){for(var _=53;_>0;_--){var o=He(2,_)-1;if(Ne(Xe(o))+1===_)return o}return 0})(),vt.doubleToLongBits=function(_){var o,u,g,M,B,G,K,le,_e;if(_<0||1/_===Number.NEGATIVE_INFINITY?(G=1<<31,_=-_):G=0,_===0)return new tt(le=G,_e=0);if(_===1/0)return new tt(le=2146435072|G,_e=0);if(_!=_)return new tt(le=2146959360,_e=0);if(M=0,_e=0,(o=Ne(_))>1)if(o<=Fe)(M=Ne(Xe(o)))<=20?(_e=0,le=o<<20-M&1048575):(_e=o%(u=He(2,g=M-20))<<32-g,le=o/u&1048575);else for(g=o,_e=0;(g=Ne(u=g/2))!==0;)M++,_e>>>=1,_e|=(1&le)<<31,le>>>=1,u!==g&&(le|=524288);if(K=M+Ie,B=o===0,o=_-o,M<52&&o!==0)for(g=0;;){if((u=2*o)>=1?(o=u-1,B?(K--,B=!1):(g<<=1,g|=1,M++)):(o=u,B?--K==0&&(M++,B=!1):(g<<=1,M++)),M===20)le|=g,g=0;else if(M===52){_e|=g;break}if(u===1){M<20?le|=g<<20-M:M<52&&(_e|=g<<52-M);break}}return le|=K<<20,new tt(le|=G,_e)},vt.longBitsToDouble=function(_){var o,u,g,M,B=_.high,G=_.low,K=B&1<<31?-1:1;for(g=((2146435072&B)>>20)-Ie,M=0,u=1<<19,o=1;o<=20;o++)B&u&&(M+=He(2,-o)),u>>>=1;for(u=1<<31,o=21;o<=52;o++)G&u&&(M+=He(2,-o)),u>>>=1;if(g===-1023){if(M===0)return 0*K;g=-1022}else{if(g===1024)return M===0?K/0:NaN;M+=1}return K*M*He(2,g)});var ut=(function(_){function o(u){var g;return D(this,o),(g=I(this,o,[u])).name=Object.keys({RuntimeException:o})[0],g}return ie(o,_),c(o)})(jt),Ot=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,null,[{key:"constructor_",value:function(){if(arguments.length===0)ut.constructor_.call(this);else if(arguments.length===1){var u=arguments[0];ut.constructor_.call(this,u)}}}])})(ut),Ct=(function(){function _(){D(this,_)}return c(_,null,[{key:"shouldNeverReachHere",value:function(){if(arguments.length===0)_.shouldNeverReachHere(null);else if(arguments.length===1){var o=arguments[0];throw new Ot("Should never reach here"+(o!==null?": "+o:""))}}},{key:"isTrue",value:function(){if(arguments.length===1){var o=arguments[0];_.isTrue(o,null)}else if(arguments.length===2){var u=arguments[1];if(!arguments[0])throw u===null?new Ot:new Ot(u)}}},{key:"equals",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];_.equals(o,u,null)}else if(arguments.length===3){var g=arguments[0],M=arguments[1],B=arguments[2];if(!M.equals(g))throw new Ot("Expected "+g+" but encountered "+M+(B!==null?": "+B:""))}}}])})(),Zt=new ArrayBuffer(8),tn=new Float64Array(Zt),_n=new Int32Array(Zt),Qe=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getM",value:function(){return vt.NaN}},{key:"setOrdinate",value:function(o,u){switch(o){case _.X:this.x=u;break;case _.Y:this.y=u;break;case _.Z:this.setZ(u);break;default:throw new At("Invalid ordinate index: "+o)}}},{key:"equals2D",value:function(){if(arguments.length===1){var o=arguments[0];return this.x===o.x&&this.y===o.y}if(arguments.length===2){var u=arguments[0],g=arguments[1];return!!Ue.equalsWithTolerance(this.x,u.x,g)&&!!Ue.equalsWithTolerance(this.y,u.y,g)}}},{key:"setM",value:function(o){throw new At("Invalid ordinate index: "+_.M)}},{key:"getZ",value:function(){return this.z}},{key:"getOrdinate",value:function(o){switch(o){case _.X:return this.x;case _.Y:return this.y;case _.Z:return this.getZ()}throw new At("Invalid ordinate index: "+o)}},{key:"equals3D",value:function(o){return this.x===o.x&&this.y===o.y&&(this.getZ()===o.getZ()||vt.isNaN(this.getZ())&&vt.isNaN(o.getZ()))}},{key:"equals",value:function(o){return o instanceof _&&this.equals2D(o)}},{key:"equalInZ",value:function(o,u){return Ue.equalsWithTolerance(this.getZ(),o.getZ(),u)}},{key:"setX",value:function(o){this.x=o}},{key:"compareTo",value:function(o){var u=o;return this.x<u.x?-1:this.x>u.x?1:this.y<u.y?-1:this.y>u.y?1:0}},{key:"getX",value:function(){return this.x}},{key:"setZ",value:function(o){this.z=o}},{key:"clone",value:function(){try{return null}catch(o){if(o instanceof CloneNotSupportedException)return Ct.shouldNeverReachHere("this shouldn't happen because this class is Cloneable"),null;throw o}}},{key:"copy",value:function(){return new _(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+")"}},{key:"distance3D",value:function(o){var u=this.x-o.x,g=this.y-o.y,M=this.getZ()-o.getZ();return Math.sqrt(u*u+g*g+M*M)}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(o){this.y=o}},{key:"distance",value:function(o){var u=this.x-o.x,g=this.y-o.y;return Math.sqrt(u*u+g*g)}},{key:"hashCode",value:function(){var o=17;return o=37*(o=37*o+_.hashCode(this.x))+_.hashCode(this.y)}},{key:"setCoordinate",value:function(o){this.x=o.x,this.y=o.y,this.z=o.getZ()}},{key:"interfaces_",get:function(){return[wt,oe,de]}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)_.constructor_.call(this,0,0);else if(arguments.length===1){var o=arguments[0];_.constructor_.call(this,o.x,o.y,o.getZ())}else if(arguments.length===2){var u=arguments[0],g=arguments[1];_.constructor_.call(this,u,g,_.NULL_ORDINATE)}else if(arguments.length===3){var M=arguments[0],B=arguments[1],G=arguments[2];this.x=M,this.y=B,this.z=G}}},{key:"hashCode",value:function(o){return tn[0]=o,_n[0]^_n[1]}}])})(),ni=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"compare",value:function(o,u){var g=_.compare(o.x,u.x);if(g!==0)return g;var M=_.compare(o.y,u.y);return M!==0?M:this._dimensionsToTest<=2?0:_.compare(o.getZ(),u.getZ())}},{key:"interfaces_",get:function(){return[Me]}}],[{key:"constructor_",value:function(){if(this._dimensionsToTest=2,arguments.length===0)_.constructor_.call(this,2);else if(arguments.length===1){var o=arguments[0];if(o!==2&&o!==3)throw new At("only 2 or 3 dimensions may be specified");this._dimensionsToTest=o}}},{key:"compare",value:function(o,u){return o<u?-1:o>u?1:vt.isNaN(o)?vt.isNaN(u)?0:-1:vt.isNaN(u)?1:0}}])})();Qe.DimensionalComparator=ni,Qe.NULL_ORDINATE=vt.NaN,Qe.X=0,Qe.Y=1,Qe.Z=2,Qe.M=3;var Rn=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getArea",value:function(){return this.getWidth()*this.getHeight()}},{key:"equals",value:function(o){if(!(o instanceof _))return!1;var u=o;return this.isNull()?u.isNull():this._maxx===u.getMaxX()&&this._maxy===u.getMaxY()&&this._minx===u.getMinX()&&this._miny===u.getMinY()}},{key:"intersection",value:function(o){if(this.isNull()||o.isNull()||!this.intersects(o))return new _;var u=this._minx>o._minx?this._minx:o._minx,g=this._miny>o._miny?this._miny:o._miny;return new _(u,this._maxx<o._maxx?this._maxx:o._maxx,g,this._maxy<o._maxy?this._maxy:o._maxy)}},{key:"isNull",value:function(){return this._maxx<this._minx}},{key:"getMaxX",value:function(){return this._maxx}},{key:"covers",value:function(){if(arguments.length===1){if(arguments[0]instanceof Qe){var o=arguments[0];return this.covers(o.x,o.y)}if(arguments[0]instanceof _){var u=arguments[0];return!this.isNull()&&!u.isNull()&&u.getMinX()>=this._minx&&u.getMaxX()<=this._maxx&&u.getMinY()>=this._miny&&u.getMaxY()<=this._maxy}}else if(arguments.length===2){var g=arguments[0],M=arguments[1];return!this.isNull()&&g>=this._minx&&g<=this._maxx&&M>=this._miny&&M<=this._maxy}}},{key:"intersects",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return!this.isNull()&&!o.isNull()&&!(o._minx>this._maxx||o._maxx<this._minx||o._miny>this._maxy||o._maxy<this._miny)}if(arguments[0]instanceof Qe){var u=arguments[0];return this.intersects(u.x,u.y)}}else if(arguments.length===2){if(arguments[0]instanceof Qe&&arguments[1]instanceof Qe){var g=arguments[0],M=arguments[1];return!this.isNull()&&!((g.x<M.x?g.x:M.x)>this._maxx)&&!((g.x>M.x?g.x:M.x)<this._minx)&&!((g.y<M.y?g.y:M.y)>this._maxy)&&!((g.y>M.y?g.y:M.y)<this._miny)}if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var B=arguments[0],G=arguments[1];return!this.isNull()&&!(B>this._maxx||B<this._minx||G>this._maxy||G<this._miny)}}}},{key:"getMinY",value:function(){return this._miny}},{key:"getDiameter",value:function(){if(this.isNull())return 0;var o=this.getWidth(),u=this.getHeight();return Math.sqrt(o*o+u*u)}},{key:"getMinX",value:function(){return this._minx}},{key:"expandToInclude",value:function(){if(arguments.length===1){if(arguments[0]instanceof Qe){var o=arguments[0];this.expandToInclude(o.x,o.y)}else if(arguments[0]instanceof _){var u=arguments[0];if(u.isNull())return null;this.isNull()?(this._minx=u.getMinX(),this._maxx=u.getMaxX(),this._miny=u.getMinY(),this._maxy=u.getMaxY()):(u._minx<this._minx&&(this._minx=u._minx),u._maxx>this._maxx&&(this._maxx=u._maxx),u._miny<this._miny&&(this._miny=u._miny),u._maxy>this._maxy&&(this._maxy=u._maxy))}}else if(arguments.length===2){var g=arguments[0],M=arguments[1];this.isNull()?(this._minx=g,this._maxx=g,this._miny=M,this._maxy=M):(g<this._minx&&(this._minx=g),g>this._maxx&&(this._maxx=g),M<this._miny&&(this._miny=M),M>this._maxy&&(this._maxy=M))}}},{key:"minExtent",value:function(){if(this.isNull())return 0;var o=this.getWidth(),u=this.getHeight();return o<u?o:u}},{key:"getWidth",value:function(){return this.isNull()?0:this._maxx-this._minx}},{key:"compareTo",value:function(o){var u=o;return this.isNull()?u.isNull()?0:-1:u.isNull()?1:this._minx<u._minx?-1:this._minx>u._minx?1:this._miny<u._miny?-1:this._miny>u._miny?1:this._maxx<u._maxx?-1:this._maxx>u._maxx?1:this._maxy<u._maxy?-1:this._maxy>u._maxy?1:0}},{key:"translate",value:function(o,u){if(this.isNull())return null;this.init(this.getMinX()+o,this.getMaxX()+o,this.getMinY()+u,this.getMaxY()+u)}},{key:"copy",value:function(){return new _(this)}},{key:"toString",value:function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"}},{key:"setToNull",value:function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1}},{key:"disjoint",value:function(o){return!(!this.isNull()&&!o.isNull())||o._minx>this._maxx||o._maxx<this._minx||o._miny>this._maxy||o._maxy<this._miny}},{key:"getHeight",value:function(){return this.isNull()?0:this._maxy-this._miny}},{key:"maxExtent",value:function(){if(this.isNull())return 0;var o=this.getWidth(),u=this.getHeight();return o>u?o:u}},{key:"expandBy",value:function(){if(arguments.length===1){var o=arguments[0];this.expandBy(o,o)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];if(this.isNull())return null;this._minx-=u,this._maxx+=u,this._miny-=g,this._maxy+=g,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}}},{key:"contains",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return this.covers(o)}if(arguments[0]instanceof Qe){var u=arguments[0];return this.covers(u)}}else if(arguments.length===2){var g=arguments[0],M=arguments[1];return this.covers(g,M)}}},{key:"centre",value:function(){return this.isNull()?null:new Qe((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)}},{key:"init",value:function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof Qe){var o=arguments[0];this.init(o.x,o.x,o.y,o.y)}else if(arguments[0]instanceof _){var u=arguments[0];this._minx=u._minx,this._maxx=u._maxx,this._miny=u._miny,this._maxy=u._maxy}}else if(arguments.length===2){var g=arguments[0],M=arguments[1];this.init(g.x,M.x,g.y,M.y)}else if(arguments.length===4){var B=arguments[0],G=arguments[1],K=arguments[2],le=arguments[3];B<G?(this._minx=B,this._maxx=G):(this._minx=G,this._maxx=B),K<le?(this._miny=K,this._maxy=le):(this._miny=le,this._maxy=K)}}},{key:"getMaxY",value:function(){return this._maxy}},{key:"distance",value:function(o){if(this.intersects(o))return 0;var u=0;this._maxx<o._minx?u=o._minx-this._maxx:this._minx>o._maxx&&(u=this._minx-o._maxx);var g=0;return this._maxy<o._miny?g=o._miny-this._maxy:this._miny>o._maxy&&(g=this._miny-o._maxy),u===0?g:g===0?u:Math.sqrt(u*u+g*g)}},{key:"hashCode",value:function(){var o=17;return o=37*(o=37*(o=37*(o=37*o+Qe.hashCode(this._minx))+Qe.hashCode(this._maxx))+Qe.hashCode(this._miny))+Qe.hashCode(this._maxy)}},{key:"interfaces_",get:function(){return[wt,de]}}],[{key:"constructor_",value:function(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof Qe){var o=arguments[0];this.init(o.x,o.x,o.y,o.y)}else if(arguments[0]instanceof _){var u=arguments[0];this.init(u)}}else if(arguments.length===2){var g=arguments[0],M=arguments[1];this.init(g.x,M.x,g.y,M.y)}else if(arguments.length===4){var B=arguments[0],G=arguments[1],K=arguments[2],le=arguments[3];this.init(B,G,K,le)}}},{key:"intersects",value:function(){if(arguments.length===3){var o=arguments[0],u=arguments[1],g=arguments[2];return g.x>=(o.x<u.x?o.x:u.x)&&g.x<=(o.x>u.x?o.x:u.x)&&g.y>=(o.y<u.y?o.y:u.y)&&g.y<=(o.y>u.y?o.y:u.y)}if(arguments.length===4){var M=arguments[0],B=arguments[1],G=arguments[2],K=arguments[3],le=Math.min(G.x,K.x),_e=Math.max(G.x,K.x),Ke=Math.min(M.x,B.x),ct=Math.max(M.x,B.x);return!(Ke>_e)&&!(ct<le)&&(le=Math.min(G.y,K.y),_e=Math.max(G.y,K.y),Ke=Math.min(M.y,B.y),ct=Math.max(M.y,B.y),!(Ke>_e)&&!(ct<le))}}}])})(),rn=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"isGeometryCollection",value:function(){return this.getTypeCode()===_.TYPECODE_GEOMETRYCOLLECTION}},{key:"getFactory",value:function(){return this._factory}},{key:"getGeometryN",value:function(o){return this}},{key:"getArea",value:function(){return 0}},{key:"isRectangle",value:function(){return!1}},{key:"equalsExact",value:function(o){return this===o||this.equalsExact(o,0)}},{key:"geometryChanged",value:function(){this.apply(_.geometryChangedFilter)}},{key:"geometryChangedAction",value:function(){this._envelope=null}},{key:"equalsNorm",value:function(o){return o!==null&&this.norm().equalsExact(o.norm())}},{key:"getLength",value:function(){return 0}},{key:"getNumGeometries",value:function(){return 1}},{key:"compareTo",value:function(){var o;if(arguments.length===1){var u=arguments[0];return o=u,this.getTypeCode()!==o.getTypeCode()?this.getTypeCode()-o.getTypeCode():this.isEmpty()&&o.isEmpty()?0:this.isEmpty()?-1:o.isEmpty()?1:this.compareToSameClass(u)}if(arguments.length===2){var g=arguments[0],M=arguments[1];return o=g,this.getTypeCode()!==o.getTypeCode()?this.getTypeCode()-o.getTypeCode():this.isEmpty()&&o.isEmpty()?0:this.isEmpty()?-1:o.isEmpty()?1:this.compareToSameClass(g,M)}}},{key:"getUserData",value:function(){return this._userData}},{key:"getSRID",value:function(){return this._SRID}},{key:"getEnvelope",value:function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())}},{key:"checkNotGeometryCollection",value:function(o){if(o.getTypeCode()===_.TYPECODE_GEOMETRYCOLLECTION)throw new At("This method does not support GeometryCollection arguments")}},{key:"equal",value:function(o,u,g){return g===0?o.equals(u):o.distance(u)<=g}},{key:"norm",value:function(){var o=this.copy();return o.normalize(),o}},{key:"reverse",value:function(){var o=this.reverseInternal();return this.envelope!=null&&(o.envelope=this.envelope.copy()),o.setSRID(this.getSRID()),o}},{key:"copy",value:function(){var o=this.copyInternal();return o.envelope=this._envelope==null?null:this._envelope.copy(),o._SRID=this._SRID,o._userData=this._userData,o}},{key:"getPrecisionModel",value:function(){return this._factory.getPrecisionModel()}},{key:"getEnvelopeInternal",value:function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new Rn(this._envelope)}},{key:"setSRID",value:function(o){this._SRID=o}},{key:"setUserData",value:function(o){this._userData=o}},{key:"compare",value:function(o,u){for(var g=o.iterator(),M=u.iterator();g.hasNext()&&M.hasNext();){var B=g.next(),G=M.next(),K=B.compareTo(G);if(K!==0)return K}return g.hasNext()?1:M.hasNext()?-1:0}},{key:"hashCode",value:function(){return this.getEnvelopeInternal().hashCode()}},{key:"isEquivalentClass",value:function(o){return this.getClass()===o.getClass()}},{key:"isGeometryCollectionOrDerived",value:function(){return this.getTypeCode()===_.TYPECODE_GEOMETRYCOLLECTION||this.getTypeCode()===_.TYPECODE_MULTIPOINT||this.getTypeCode()===_.TYPECODE_MULTILINESTRING||this.getTypeCode()===_.TYPECODE_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[oe,wt,de]}},{key:"getClass",value:function(){return _}}],[{key:"hasNonEmptyElements",value:function(o){for(var u=0;u<o.length;u++)if(!o[u].isEmpty())return!0;return!1}},{key:"hasNullElements",value:function(o){for(var u=0;u<o.length;u++)if(o[u]===null)return!0;return!1}}])})();rn.constructor_=function(_){_&&(this._envelope=null,this._userData=null,this._factory=_,this._SRID=_.getSRID())},rn.TYPECODE_POINT=0,rn.TYPECODE_MULTIPOINT=1,rn.TYPECODE_LINESTRING=2,rn.TYPECODE_LINEARRING=3,rn.TYPECODE_MULTILINESTRING=4,rn.TYPECODE_POLYGON=5,rn.TYPECODE_MULTIPOLYGON=6,rn.TYPECODE_GEOMETRYCOLLECTION=7,rn.TYPENAME_POINT="Point",rn.TYPENAME_MULTIPOINT="MultiPoint",rn.TYPENAME_LINESTRING="LineString",rn.TYPENAME_LINEARRING="LinearRing",rn.TYPENAME_MULTILINESTRING="MultiLineString",rn.TYPENAME_POLYGON="Polygon",rn.TYPENAME_MULTIPOLYGON="MultiPolygon",rn.TYPENAME_GEOMETRYCOLLECTION="GeometryCollection",rn.geometryChangedFilter={get interfaces_(){return[Vt]},filter:function(_){_.geometryChangedAction()}};var Re=(function(){function _(){D(this,_)}return c(_,null,[{key:"toLocationSymbol",value:function(o){switch(o){case _.EXTERIOR:return"e";case _.BOUNDARY:return"b";case _.INTERIOR:return"i";case _.NONE:return"-"}throw new At("Unknown location value: "+o)}}])})();Re.INTERIOR=0,Re.BOUNDARY=1,Re.EXTERIOR=2,Re.NONE=-1;var fi=(function(){return c((function _(){D(this,_)}),[{key:"add",value:function(){}},{key:"addAll",value:function(){}},{key:"isEmpty",value:function(){}},{key:"iterator",value:function(){}},{key:"size",value:function(){}},{key:"toArray",value:function(){}},{key:"remove",value:function(){}}])})(),Dn=(function(_){function o(u){var g;return D(this,o),(g=I(this,o,[u])).name=Object.keys({NoSuchElementException:o})[0],g}return ie(o,_),c(o)})(jt),Pn=(function(_){function o(u){var g;return D(this,o),(g=I(this,o,[u])).name=Object.keys({UnsupportedOperationException:o})[0],g}return ie(o,_),c(o)})(jt),Ia=(function(_){function o(){return D(this,o),I(this,o,arguments)}return ie(o,_),c(o,[{key:"contains",value:function(){}}])})(fi),Ri=(function(_){function o(u){var g;return D(this,o),(g=I(this,o)).map=new Map,u instanceof fi&&g.addAll(u),g}return ie(o,_),c(o,[{key:"contains",value:function(u){var g=u.hashCode?u.hashCode():u;return!!this.map.has(g)}},{key:"add",value:function(u){var g=u.hashCode?u.hashCode():u;return!this.map.has(g)&&!!this.map.set(g,u)}},{key:"addAll",value:function(u){var g,M=X(u);try{for(M.s();!(g=M.n()).done;){var B=g.value;this.add(B)}}catch(G){M.e(G)}finally{M.f()}return!0}},{key:"remove",value:function(){throw new Pn}},{key:"size",value:function(){return this.map.size}},{key:"isEmpty",value:function(){return this.map.size===0}},{key:"toArray",value:function(){return Array.from(this.map.values())}},{key:"iterator",value:function(){return new Gs(this.map)}},{key:Symbol.iterator,value:function(){return this.map}}])})(Ia),Gs=(function(){return c((function _(o){D(this,_),this.iterator=o.values();var u=this.iterator.next(),g=u.done,M=u.value;this.done=g,this.value=M}),[{key:"next",value:function(){if(this.done)throw new Dn;var _=this.value,o=this.iterator.next(),u=o.done,g=o.value;return this.done=u,this.value=g,_}},{key:"hasNext",value:function(){return!this.done}},{key:"remove",value:function(){throw new Pn}}])})(),Yt=(function(){function _(){D(this,_)}return c(_,null,[{key:"opposite",value:function(o){return o===_.LEFT?_.RIGHT:o===_.RIGHT?_.LEFT:o}}])})();Yt.ON=0,Yt.LEFT=1,Yt.RIGHT=2;var qs=(function(_){function o(u){var g;return D(this,o),(g=I(this,o,[u])).name=Object.keys({EmptyStackException:o})[0],g}return ie(o,_),c(o)})(jt),os=(function(_){function o(u){var g;return D(this,o),(g=I(this,o,[u])).name=Object.keys({IndexOutOfBoundsException:o})[0],g}return ie(o,_),c(o)})(jt),Nr=(function(_){function o(){return D(this,o),I(this,o,arguments)}return ie(o,_),c(o,[{key:"get",value:function(){}},{key:"set",value:function(){}},{key:"isEmpty",value:function(){}}])})(fi),wl=(function(_){function o(){var u;return D(this,o),(u=I(this,o)).array=[],u}return ie(o,_),c(o,[{key:"add",value:function(u){return this.array.push(u),!0}},{key:"get",value:function(u){if(u<0||u>=this.size())throw new os;return this.array[u]}},{key:"push",value:function(u){return this.array.push(u),u}},{key:"pop",value:function(){if(this.array.length===0)throw new qs;return this.array.pop()}},{key:"peek",value:function(){if(this.array.length===0)throw new qs;return this.array[this.array.length-1]}},{key:"empty",value:function(){return this.array.length===0}},{key:"isEmpty",value:function(){return this.empty()}},{key:"search",value:function(u){return this.array.indexOf(u)}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}}])})(Nr);function dn(_,o){return _.interfaces_&&_.interfaces_.indexOf(o)>-1}var Sr=(function(){return c((function _(o){D(this,_),this.str=o}),[{key:"append",value:function(_){this.str+=_}},{key:"setCharAt",value:function(_,o){this.str=this.str.substr(0,_)+o+this.str.substr(_+1)}},{key:"toString",value:function(){return this.str}}])})(),nt=(function(){function _(o){D(this,_),this.value=o}return c(_,[{key:"intValue",value:function(){return this.value}},{key:"compareTo",value:function(o){return this.value<o?-1:this.value>o?1:0}}],[{key:"compare",value:function(o,u){return o<u?-1:o>u?1:0}},{key:"isNan",value:function(o){return Number.isNaN(o)}},{key:"valueOf",value:function(o){return new _(o)}}])})(),re=(function(){return c((function _(){D(this,_)}),null,[{key:"isWhitespace",value:function(_){return _<=32&&_>=0||_===127}},{key:"toUpperCase",value:function(_){return _.toUpperCase()}}])})(),te=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"le",value:function(o){return this._hi<o._hi||this._hi===o._hi&&this._lo<=o._lo}},{key:"extractSignificantDigits",value:function(o,u){var g=this.abs(),M=_.magnitude(g._hi),B=_.TEN.pow(M);(g=g.divide(B)).gt(_.TEN)?(g=g.divide(_.TEN),M+=1):g.lt(_.ONE)&&(g=g.multiply(_.TEN),M-=1);for(var G=M+1,K=new Sr,le=_.MAX_PRINT_DIGITS-1,_e=0;_e<=le;_e++){o&&_e===G&&K.append(".");var Ke=Math.trunc(g._hi);if(Ke<0)break;var ct=!1,Bt=0;Ke>9?(ct=!0,Bt="9"):Bt="0"+Ke,K.append(Bt),g=g.subtract(_.valueOf(Ke)).multiply(_.TEN),ct&&g.selfAdd(_.TEN);var Jt=!0,sn=_.magnitude(g._hi);if(sn<0&&Math.abs(sn)>=le-_e&&(Jt=!1),!Jt)break}return u[0]=M,K.toString()}},{key:"sqr",value:function(){return this.multiply(this)}},{key:"doubleValue",value:function(){return this._hi+this._lo}},{key:"subtract",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return this.add(o.negate())}if(typeof arguments[0]=="number"){var u=arguments[0];return this.add(-u)}}},{key:"equals",value:function(){if(arguments.length===1&&arguments[0]instanceof _){var o=arguments[0];return this._hi===o._hi&&this._lo===o._lo}}},{key:"isZero",value:function(){return this._hi===0&&this._lo===0}},{key:"selfSubtract",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return this.isNaN()?this:this.selfAdd(-o._hi,-o._lo)}if(typeof arguments[0]=="number"){var u=arguments[0];return this.isNaN()?this:this.selfAdd(-u,0)}}},{key:"getSpecialNumberString",value:function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null}},{key:"min",value:function(o){return this.le(o)?this:o}},{key:"selfDivide",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return this.selfDivide(o._hi,o._lo)}if(typeof arguments[0]=="number"){var u=arguments[0];return this.selfDivide(u,0)}}else if(arguments.length===2){var g,M,B,G,K=arguments[0],le=arguments[1],_e=null,Ke=null,ct=null,Bt=null;return B=this._hi/K,Bt=(_e=(ct=_.SPLIT*B)-(_e=ct-B))*(Ke=(Bt=_.SPLIT*K)-(Ke=Bt-K))-(G=B*K)+_e*(M=K-Ke)+(g=B-_e)*Ke+g*M,Bt=B+(ct=(this._hi-G-Bt+this._lo-B*le)/K),this._hi=Bt,this._lo=B-Bt+ct,this}}},{key:"dump",value:function(){return"DD<"+this._hi+", "+this._lo+">"}},{key:"divide",value:function(){if(arguments[0]instanceof _){var o,u,g,M,B=arguments[0],G=null,K=null,le=null,_e=null;return o=(g=this._hi/B._hi)-(G=(le=_.SPLIT*g)-(G=le-g)),_e=G*(K=(_e=_.SPLIT*B._hi)-(K=_e-B._hi))-(M=g*B._hi)+G*(u=B._hi-K)+o*K+o*u,new _(_e=g+(le=(this._hi-M-_e+this._lo-g*B._lo)/B._hi),g-_e+le)}if(typeof arguments[0]=="number"){var Ke=arguments[0];return vt.isNaN(Ke)?_.createNaN():_.copy(this).selfDivide(Ke,0)}}},{key:"ge",value:function(o){return this._hi>o._hi||this._hi===o._hi&&this._lo>=o._lo}},{key:"pow",value:function(o){if(o===0)return _.valueOf(1);var u=new _(this),g=_.valueOf(1),M=Math.abs(o);if(M>1)for(;M>0;)M%2==1&&g.selfMultiply(u),(M/=2)>0&&(u=u.sqr());else g=u;return o<0?g.reciprocal():g}},{key:"ceil",value:function(){if(this.isNaN())return _.NaN;var o=Math.ceil(this._hi),u=0;return o===this._hi&&(u=Math.ceil(this._lo)),new _(o,u)}},{key:"compareTo",value:function(o){var u=o;return this._hi<u._hi?-1:this._hi>u._hi?1:this._lo<u._lo?-1:this._lo>u._lo?1:0}},{key:"rint",value:function(){return this.isNaN()?this:this.add(.5).floor()}},{key:"setValue",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return this.init(o),this}if(typeof arguments[0]=="number"){var u=arguments[0];return this.init(u),this}}},{key:"max",value:function(o){return this.ge(o)?this:o}},{key:"sqrt",value:function(){if(this.isZero())return _.valueOf(0);if(this.isNegative())return _.NaN;var o=1/Math.sqrt(this._hi),u=this._hi*o,g=_.valueOf(u),M=this.subtract(g.sqr())._hi*(.5*o);return g.add(M)}},{key:"selfAdd",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return this.selfAdd(o._hi,o._lo)}if(typeof arguments[0]=="number"){var u,g,M,B,G,K=arguments[0],le=null;return le=(M=this._hi+K)-(B=M-this._hi),g=(G=(le=K-B+(this._hi-le))+this._lo)+(M-(u=M+G)),this._hi=u+g,this._lo=g+(u-this._hi),this}}else if(arguments.length===2){var _e,Ke,ct,Bt,Jt=arguments[0],sn=arguments[1],pn=null,Nn=null,In=null;ct=this._hi+Jt,Ke=this._lo+sn,Nn=ct-(In=ct-this._hi),pn=Ke-(Bt=Ke-this._lo);var hi=(_e=ct+(In=(Nn=Jt-In+(this._hi-Nn))+Ke))+(In=(pn=sn-Bt+(this._lo-pn))+(In+(ct-_e))),hr=In+(_e-hi);return this._hi=hi,this._lo=hr,this}}},{key:"selfMultiply",value:function(){if(arguments.length===1){if(arguments[0]instanceof _){var o=arguments[0];return this.selfMultiply(o._hi,o._lo)}if(typeof arguments[0]=="number"){var u=arguments[0];return this.selfMultiply(u,0)}}else if(arguments.length===2){var g,M,B=arguments[0],G=arguments[1],K=null,le=null,_e=null,Ke=null;K=(_e=_.SPLIT*this._hi)-this._hi,Ke=_.SPLIT*B,K=_e-K,g=this._hi-K,le=Ke-B;var ct=(_e=this._hi*B)+(Ke=K*(le=Ke-le)-_e+K*(M=B-le)+g*le+g*M+(this._hi*G+this._lo*B)),Bt=Ke+(K=_e-ct);return this._hi=ct,this._lo=Bt,this}}},{key:"selfSqr",value:function(){return this.selfMultiply(this)}},{key:"floor",value:function(){if(this.isNaN())return _.NaN;var o=Math.floor(this._hi),u=0;return o===this._hi&&(u=Math.floor(this._lo)),new _(o,u)}},{key:"negate",value:function(){return this.isNaN()?this:new _(-this._hi,-this._lo)}},{key:"clone",value:function(){try{return null}catch(o){if(o instanceof CloneNotSupportedException)return null;throw o}}},{key:"multiply",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return o.isNaN()?_.createNaN():_.copy(this).selfMultiply(o)}if(typeof arguments[0]=="number"){var u=arguments[0];return vt.isNaN(u)?_.createNaN():_.copy(this).selfMultiply(u,0)}}},{key:"isNaN",value:function(){return vt.isNaN(this._hi)}},{key:"intValue",value:function(){return Math.trunc(this._hi)}},{key:"toString",value:function(){var o=_.magnitude(this._hi);return o>=-3&&o<=20?this.toStandardNotation():this.toSciNotation()}},{key:"toStandardNotation",value:function(){var o=this.getSpecialNumberString();if(o!==null)return o;var u=new Array(1).fill(null),g=this.extractSignificantDigits(!0,u),M=u[0]+1,B=g;if(g.charAt(0)===".")B="0"+g;else if(M<0)B="0."+_.stringOfChar("0",-M)+g;else if(g.indexOf(".")===-1){var G=M-g.length;B=g+_.stringOfChar("0",G)+".0"}return this.isNegative()?"-"+B:B}},{key:"reciprocal",value:function(){var o,u,g,M,B=null,G=null,K=null,le=null;o=(g=1/this._hi)-(B=(K=_.SPLIT*g)-(B=K-g)),G=(le=_.SPLIT*this._hi)-this._hi;var _e=g+(K=(1-(M=g*this._hi)-(le=B*(G=le-G)-M+B*(u=this._hi-G)+o*G+o*u)-g*this._lo)/this._hi);return new _(_e,g-_e+K)}},{key:"toSciNotation",value:function(){if(this.isZero())return _.SCI_NOT_ZERO;var o=this.getSpecialNumberString();if(o!==null)return o;var u=new Array(1).fill(null),g=this.extractSignificantDigits(!1,u),M=_.SCI_NOT_EXPONENT_CHAR+u[0];if(g.charAt(0)==="0")throw new IllegalStateException("Found leading zero: "+g);var B="";g.length>1&&(B=g.substring(1));var G=g.charAt(0)+"."+B;return this.isNegative()?"-"+G+M:G+M}},{key:"abs",value:function(){return this.isNaN()?_.NaN:this.isNegative()?this.negate():new _(this)}},{key:"isPositive",value:function(){return this._hi>0||this._hi===0&&this._lo>0}},{key:"lt",value:function(o){return this._hi<o._hi||this._hi===o._hi&&this._lo<o._lo}},{key:"add",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return _.copy(this).selfAdd(o)}if(typeof arguments[0]=="number"){var u=arguments[0];return _.copy(this).selfAdd(u)}}},{key:"init",value:function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var o=arguments[0];this._hi=o,this._lo=0}else if(arguments[0]instanceof _){var u=arguments[0];this._hi=u._hi,this._lo=u._lo}}else if(arguments.length===2){var g=arguments[0],M=arguments[1];this._hi=g,this._lo=M}}},{key:"gt",value:function(o){return this._hi>o._hi||this._hi===o._hi&&this._lo>o._lo}},{key:"isNegative",value:function(){return this._hi<0||this._hi===0&&this._lo<0}},{key:"trunc",value:function(){return this.isNaN()?_.NaN:this.isPositive()?this.floor():this.ceil()}},{key:"signum",value:function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0}},{key:"interfaces_",get:function(){return[de,wt,oe]}}],[{key:"constructor_",value:function(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var o=arguments[0];this.init(o)}else if(arguments[0]instanceof _){var u=arguments[0];this.init(u)}else if(typeof arguments[0]=="string"){var g=arguments[0];_.constructor_.call(this,_.parse(g))}}else if(arguments.length===2){var M=arguments[0],B=arguments[1];this.init(M,B)}}},{key:"determinant",value:function(){if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],u=arguments[1],g=arguments[2],M=arguments[3];return _.determinant(_.valueOf(o),_.valueOf(u),_.valueOf(g),_.valueOf(M))}if(arguments[3]instanceof _&&arguments[2]instanceof _&&arguments[0]instanceof _&&arguments[1]instanceof _){var B=arguments[1],G=arguments[2],K=arguments[3];return arguments[0].multiply(K).selfSubtract(B.multiply(G))}}},{key:"sqr",value:function(o){return _.valueOf(o).selfMultiply(o)}},{key:"valueOf",value:function(){if(typeof arguments[0]=="string"){var o=arguments[0];return _.parse(o)}if(typeof arguments[0]=="number")return new _(arguments[0])}},{key:"sqrt",value:function(o){return _.valueOf(o).sqrt()}},{key:"parse",value:function(o){for(var u=0,g=o.length;re.isWhitespace(o.charAt(u));)u++;var M=!1;if(u<g){var B=o.charAt(u);B!=="-"&&B!=="+"||(u++,B==="-"&&(M=!0))}for(var G=new _,K=0,le=0,_e=0,Ke=!1;!(u>=g);){var ct=o.charAt(u);if(u++,re.isDigit(ct)){var Bt=ct-"0";G.selfMultiply(_.TEN),G.selfAdd(Bt),K++}else{if(ct!=="."){if(ct==="e"||ct==="E"){var Jt=o.substring(u);try{_e=nt.parseInt(Jt)}catch(hi){throw hi instanceof NumberFormatException?new NumberFormatException("Invalid exponent "+Jt+" in string "+o):hi}break}throw new NumberFormatException("Unexpected character '"+ct+"' at position "+u+" in string "+o)}le=K,Ke=!0}}var sn=G;Ke||(le=K);var pn=K-le-_e;if(pn===0)sn=G;else if(pn>0){var Nn=_.TEN.pow(pn);sn=G.divide(Nn)}else if(pn<0){var In=_.TEN.pow(-pn);sn=G.multiply(In)}return M?sn.negate():sn}},{key:"createNaN",value:function(){return new _(vt.NaN,vt.NaN)}},{key:"copy",value:function(o){return new _(o)}},{key:"magnitude",value:function(o){var u=Math.abs(o),g=Math.log(u)/Math.log(10),M=Math.trunc(Math.floor(g));return 10*Math.pow(10,M)<=u&&(M+=1),M}},{key:"stringOfChar",value:function(o,u){for(var g=new Sr,M=0;M<u;M++)g.append(o);return g.toString()}}])})();te.PI=new te(3.141592653589793,12246467991473532e-32),te.TWO_PI=new te(6.283185307179586,24492935982947064e-32),te.PI_2=new te(1.5707963267948966,6123233995736766e-32),te.E=new te(2.718281828459045,14456468917292502e-32),te.NaN=new te(vt.NaN,vt.NaN),te.EPS=123259516440783e-46,te.SPLIT=134217729,te.MAX_PRINT_DIGITS=32,te.TEN=te.valueOf(10),te.ONE=te.valueOf(1),te.SCI_NOT_EXPONENT_CHAR="E",te.SCI_NOT_ZERO="0.0E0";var he=(function(){function _(){D(this,_)}return c(_,null,[{key:"orientationIndex",value:function(o,u,g){var M=_.orientationIndexFilter(o,u,g);if(M<=1)return M;var B=te.valueOf(u.x).selfAdd(-o.x),G=te.valueOf(u.y).selfAdd(-o.y),K=te.valueOf(g.x).selfAdd(-u.x),le=te.valueOf(g.y).selfAdd(-u.y);return B.selfMultiply(le).selfSubtract(G.selfMultiply(K)).signum()}},{key:"signOfDet2x2",value:function(){if(arguments[3]instanceof te&&arguments[2]instanceof te&&arguments[0]instanceof te&&arguments[1]instanceof te){var o=arguments[1],u=arguments[2],g=arguments[3];return arguments[0].multiply(g).selfSubtract(o.multiply(u)).signum()}if(typeof arguments[3]=="number"&&typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var M=arguments[0],B=arguments[1],G=arguments[2],K=arguments[3],le=te.valueOf(M),_e=te.valueOf(B),Ke=te.valueOf(G),ct=te.valueOf(K);return le.multiply(ct).selfSubtract(_e.multiply(Ke)).signum()}}},{key:"intersection",value:function(o,u,g,M){var B=new te(o.y).selfSubtract(u.y),G=new te(u.x).selfSubtract(o.x),K=new te(o.x).selfMultiply(u.y).selfSubtract(new te(u.x).selfMultiply(o.y)),le=new te(g.y).selfSubtract(M.y),_e=new te(M.x).selfSubtract(g.x),Ke=new te(g.x).selfMultiply(M.y).selfSubtract(new te(M.x).selfMultiply(g.y)),ct=G.multiply(Ke).selfSubtract(_e.multiply(K)),Bt=le.multiply(K).selfSubtract(B.multiply(Ke)),Jt=B.multiply(_e).selfSubtract(le.multiply(G)),sn=ct.selfDivide(Jt).doubleValue(),pn=Bt.selfDivide(Jt).doubleValue();return vt.isNaN(sn)||vt.isInfinite(sn)||vt.isNaN(pn)||vt.isInfinite(pn)?null:new Qe(sn,pn)}},{key:"orientationIndexFilter",value:function(o,u,g){var M=null,B=(o.x-g.x)*(u.y-g.y),G=(o.y-g.y)*(u.x-g.x),K=B-G;if(B>0){if(G<=0)return _.signum(K);M=B+G}else{if(!(B<0)||G>=0)return _.signum(K);M=-B-G}var le=_.DP_SAFE_EPSILON*M;return K>=le||-K>=le?_.signum(K):2}},{key:"signum",value:function(o){return o>0?1:o<0?-1:0}}])})();he.DP_SAFE_EPSILON=1e-15;var Se=(function(){return c((function _(){D(this,_)}),[{key:"getM",value:function(_){if(this.hasM()){var o=this.getDimension()-this.getMeasures();return this.getOrdinate(_,o)}return vt.NaN}},{key:"setOrdinate",value:function(_,o,u){}},{key:"getZ",value:function(_){return this.hasZ()?this.getOrdinate(_,2):vt.NaN}},{key:"size",value:function(){}},{key:"getOrdinate",value:function(_,o){}},{key:"getCoordinate",value:function(){}},{key:"getCoordinateCopy",value:function(_){}},{key:"createCoordinate",value:function(){}},{key:"getDimension",value:function(){}},{key:"hasM",value:function(){return this.getMeasures()>0}},{key:"getX",value:function(_){}},{key:"hasZ",value:function(){return this.getDimension()-this.getMeasures()>2}},{key:"getMeasures",value:function(){return 0}},{key:"expandEnvelope",value:function(_){}},{key:"copy",value:function(){}},{key:"getY",value:function(_){}},{key:"toCoordinateArray",value:function(){}},{key:"interfaces_",get:function(){return[oe]}}])})();Se.X=0,Se.Y=1,Se.Z=2,Se.M=3;var Ee=(function(){function _(){D(this,_)}return c(_,null,[{key:"index",value:function(o,u,g){return he.orientationIndex(o,u,g)}},{key:"isCCW",value:function(){if(arguments[0]instanceof Array){var o=arguments[0],u=o.length-1;if(u<3)throw new At("Ring has fewer than 4 points, so orientation cannot be determined");for(var g=o[0],M=0,B=1;B<=u;B++){var G=o[B];G.y>g.y&&(g=G,M=B)}var K=M;do(K-=1)<0&&(K=u);while(o[K].equals2D(g)&&K!==M);var le=M;do le=(le+1)%u;while(o[le].equals2D(g)&&le!==M);var _e=o[K],Ke=o[le];if(_e.equals2D(g)||Ke.equals2D(g)||_e.equals2D(Ke))return!1;var ct=_.index(_e,g,Ke);return ct===0?_e.x>Ke.x:ct>0}if(dn(arguments[0],Se)){var Bt=arguments[0],Jt=Bt.size()-1;if(Jt<3)throw new At("Ring has fewer than 4 points, so orientation cannot be determined");for(var sn=Bt.getCoordinate(0),pn=0,Nn=1;Nn<=Jt;Nn++){var In=Bt.getCoordinate(Nn);In.y>sn.y&&(sn=In,pn=Nn)}var hi=null,hr=pn;do(hr-=1)<0&&(hr=Jt),hi=Bt.getCoordinate(hr);while(hi.equals2D(sn)&&hr!==pn);var gi=null,Jr=pn;do Jr=(Jr+1)%Jt,gi=Bt.getCoordinate(Jr);while(gi.equals2D(sn)&&Jr!==pn);if(hi.equals2D(sn)||gi.equals2D(sn)||hi.equals2D(gi))return!1;var vr=_.index(hi,sn,gi);return vr===0?hi.x>gi.x:vr>0}}}])})();Ee.CLOCKWISE=-1,Ee.RIGHT=Ee.CLOCKWISE,Ee.COUNTERCLOCKWISE=1,Ee.LEFT=Ee.COUNTERCLOCKWISE,Ee.COLLINEAR=0,Ee.STRAIGHT=Ee.COLLINEAR;var lt=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this._minCoord}},{key:"getRightmostSide",value:function(_,o){var u=this.getRightmostSideOfSegment(_,o);return u<0&&(u=this.getRightmostSideOfSegment(_,o-1)),u<0&&(this._minCoord=null,this.checkForRightmostCoordinate(_)),u}},{key:"findRightmostEdgeAtVertex",value:function(){var _=this._minDe.getEdge().getCoordinates();Ct.isTrue(this._minIndex>0&&this._minIndex<_.length,"rightmost point expected to be interior vertex of edge");var o=_[this._minIndex-1],u=_[this._minIndex+1],g=Ee.index(this._minCoord,u,o),M=!1;(o.y<this._minCoord.y&&u.y<this._minCoord.y&&g===Ee.COUNTERCLOCKWISE||o.y>this._minCoord.y&&u.y>this._minCoord.y&&g===Ee.CLOCKWISE)&&(M=!0),M&&(this._minIndex=this._minIndex-1)}},{key:"getRightmostSideOfSegment",value:function(_,o){var u=_.getEdge().getCoordinates();if(o<0||o+1>=u.length||u[o].y===u[o+1].y)return-1;var g=Yt.LEFT;return u[o].y<u[o+1].y&&(g=Yt.RIGHT),g}},{key:"getEdge",value:function(){return this._orientedDe}},{key:"checkForRightmostCoordinate",value:function(_){for(var o=_.getEdge().getCoordinates(),u=0;u<o.length-1;u++)(this._minCoord===null||o[u].x>this._minCoord.x)&&(this._minDe=_,this._minIndex=u,this._minCoord=o[u])}},{key:"findRightmostEdgeAtNode",value:function(){var _=this._minDe.getNode().getEdges();this._minDe=_.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)}},{key:"findEdge",value:function(_){for(var o=_.iterator();o.hasNext();){var u=o.next();u.isForward()&&this.checkForRightmostCoordinate(u)}Ct.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===Yt.LEFT&&(this._orientedDe=this._minDe.getSym())}}],[{key:"constructor_",value:function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null}}])})(),Je=(function(_){function o(u,g){var M;return D(this,o),(M=I(this,o,[g?u+" [ "+g+" ]":u])).pt=g?new Qe(g):void 0,M.name=Object.keys({TopologyException:o})[0],M}return ie(o,_),c(o,[{key:"getCoordinate",value:function(){return this.pt}}])})(ut),qe=(function(){return c((function _(){D(this,_),this.array=[]}),[{key:"addLast",value:function(_){this.array.push(_)}},{key:"removeFirst",value:function(){return this.array.shift()}},{key:"isEmpty",value:function(){return this.array.length===0}}])})(),Ze=(function(_){function o(u){var g;return D(this,o),(g=I(this,o)).array=[],u instanceof fi&&g.addAll(u),g}return ie(o,_),c(o,[{key:"interfaces_",get:function(){return[Nr,fi]}},{key:"ensureCapacity",value:function(){}},{key:"add",value:function(u){return arguments.length===1?this.array.push(u):this.array.splice(arguments[0],0,arguments[1]),!0}},{key:"clear",value:function(){this.array=[]}},{key:"addAll",value:function(u){var g,M=X(u);try{for(M.s();!(g=M.n()).done;){var B=g.value;this.array.push(B)}}catch(G){M.e(G)}finally{M.f()}}},{key:"set",value:function(u,g){var M=this.array[u];return this.array[u]=g,M}},{key:"iterator",value:function(){return new St(this)}},{key:"get",value:function(u){if(u<0||u>=this.size())throw new os;return this.array[u]}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"sort",value:function(u){u?this.array.sort((function(g,M){return u.compare(g,M)})):this.array.sort()}},{key:"size",value:function(){return this.array.length}},{key:"toArray",value:function(){return this.array.slice()}},{key:"remove",value:function(u){for(var g=0,M=this.array.length;g<M;g++)if(this.array[g]===u)return!!this.array.splice(g,1);return!1}},{key:Symbol.iterator,value:function(){return this.array.values()}}])})(Nr),St=(function(){return c((function _(o){D(this,_),this.arrayList=o,this.position=0}),[{key:"next",value:function(){if(this.position===this.arrayList.size())throw new Dn;return this.arrayList.get(this.position++)}},{key:"hasNext",value:function(){return this.position<this.arrayList.size()}},{key:"set",value:function(_){return this.arrayList.set(this.position-1,_)}},{key:"remove",value:function(){this.arrayList.remove(this.arrayList.get(this.position))}}])})(),Mt=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"clearVisitedEdges",value:function(){for(var _=this._dirEdgeList.iterator();_.hasNext();)_.next().setVisited(!1)}},{key:"getRightmostCoordinate",value:function(){return this._rightMostCoord}},{key:"computeNodeDepth",value:function(_){for(var o=null,u=_.getEdges().iterator();u.hasNext();){var g=u.next();if(g.isVisited()||g.getSym().isVisited()){o=g;break}}if(o===null)throw new Je("unable to find edge to compute depths at "+_.getCoordinate());_.getEdges().computeDepths(o);for(var M=_.getEdges().iterator();M.hasNext();){var B=M.next();B.setVisited(!0),this.copySymDepths(B)}}},{key:"computeDepth",value:function(_){this.clearVisitedEdges();var o=this._finder.getEdge();o.getNode(),o.getLabel(),o.setEdgeDepths(Yt.RIGHT,_),this.copySymDepths(o),this.computeDepths(o)}},{key:"create",value:function(_){this.addReachable(_),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()}},{key:"findResultEdges",value:function(){for(var _=this._dirEdgeList.iterator();_.hasNext();){var o=_.next();o.getDepth(Yt.RIGHT)>=1&&o.getDepth(Yt.LEFT)<=0&&!o.isInteriorAreaEdge()&&o.setInResult(!0)}}},{key:"computeDepths",value:function(_){var o=new Ri,u=new qe,g=_.getNode();for(u.addLast(g),o.add(g),_.setVisited(!0);!u.isEmpty();){var M=u.removeFirst();o.add(M),this.computeNodeDepth(M);for(var B=M.getEdges().iterator();B.hasNext();){var G=B.next().getSym();if(!G.isVisited()){var K=G.getNode();o.contains(K)||(u.addLast(K),o.add(K))}}}}},{key:"compareTo",value:function(_){var o=_;return this._rightMostCoord.x<o._rightMostCoord.x?-1:this._rightMostCoord.x>o._rightMostCoord.x?1:0}},{key:"getEnvelope",value:function(){if(this._env===null){for(var _=new Rn,o=this._dirEdgeList.iterator();o.hasNext();)for(var u=o.next().getEdge().getCoordinates(),g=0;g<u.length-1;g++)_.expandToInclude(u[g]);this._env=_}return this._env}},{key:"addReachable",value:function(_){var o=new wl;for(o.add(_);!o.empty();){var u=o.pop();this.add(u,o)}}},{key:"copySymDepths",value:function(_){var o=_.getSym();o.setDepth(Yt.LEFT,_.getDepth(Yt.RIGHT)),o.setDepth(Yt.RIGHT,_.getDepth(Yt.LEFT))}},{key:"add",value:function(_,o){_.setVisited(!0),this._nodes.add(_);for(var u=_.getEdges().iterator();u.hasNext();){var g=u.next();this._dirEdgeList.add(g);var M=g.getSym().getNode();M.isVisited()||o.push(M)}}},{key:"getNodes",value:function(){return this._nodes}},{key:"getDirectedEdges",value:function(){return this._dirEdgeList}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._finder=null,this._dirEdgeList=new Ze,this._nodes=new Ze,this._rightMostCoord=null,this._env=null,this._finder=new lt}}])})(),Wt=(function(){return c((function _(){D(this,_)}),null,[{key:"intersection",value:function(_,o,u,g){var M=_.x<o.x?_.x:o.x,B=_.y<o.y?_.y:o.y,G=_.x>o.x?_.x:o.x,K=_.y>o.y?_.y:o.y,le=u.x<g.x?u.x:g.x,_e=u.y<g.y?u.y:g.y,Ke=u.x>g.x?u.x:g.x,ct=u.y>g.y?u.y:g.y,Bt=((M>le?M:le)+(G<Ke?G:Ke))/2,Jt=((B>_e?B:_e)+(K<ct?K:ct))/2,sn=_.x-Bt,pn=_.y-Jt,Nn=o.x-Bt,In=o.y-Jt,hi=u.x-Bt,hr=u.y-Jt,gi=g.x-Bt,Jr=g.y-Jt,vr=pn-In,Ls=Nn-sn,To=sn*In-Nn*pn,So=hr-Jr,Al=gi-hi,Ks=hi*Jr-gi*hr,Da=vr*Al-So*Ls,pu=(Ls*Ks-Al*To)/Da,Eo=(So*To-vr*Ks)/Da;return vt.isNaN(pu)||vt.isInfinite(pu)||vt.isNaN(Eo)||vt.isInfinite(Eo)?null:new Qe(pu+Bt,Eo+Jt)}}])})(),Qt=(function(){return c((function _(){D(this,_)}),null,[{key:"arraycopy",value:function(_,o,u,g,M){for(var B=0,G=o;G<o+M;G++)u[g+B]=_[G],B++}},{key:"getProperty",value:function(_){return{"line.separator":`
`}[_]}}])})(),yn=(function(){function _(){D(this,_)}return c(_,null,[{key:"log10",value:function(o){var u=Math.log(o);return vt.isInfinite(u)||vt.isNaN(u)?u:u/_.LOG_10}},{key:"min",value:function(o,u,g,M){var B=o;return u<B&&(B=u),g<B&&(B=g),M<B&&(B=M),B}},{key:"clamp",value:function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],u=arguments[1],g=arguments[2];return o<u?u:o>g?g:o}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var M=arguments[0],B=arguments[1],G=arguments[2];return M<B?B:M>G?G:M}}},{key:"wrap",value:function(o,u){return o<0?u- -o%u:o%u}},{key:"max",value:function(){if(arguments.length===3){var o=arguments[1],u=arguments[2],g=arguments[0];return o>g&&(g=o),u>g&&(g=u),g}if(arguments.length===4){var M=arguments[1],B=arguments[2],G=arguments[3],K=arguments[0];return M>K&&(K=M),B>K&&(K=B),G>K&&(K=G),K}}},{key:"average",value:function(o,u){return(o+u)/2}}])})();yn.LOG_10=Math.log(10);var zn=(function(){function _(){D(this,_)}return c(_,null,[{key:"segmentToSegment",value:function(o,u,g,M){if(o.equals(u))return _.pointToSegment(o,g,M);if(g.equals(M))return _.pointToSegment(M,o,u);var B=!1;if(Rn.intersects(o,u,g,M)){var G=(u.x-o.x)*(M.y-g.y)-(u.y-o.y)*(M.x-g.x);if(G===0)B=!0;else{var K=(o.y-g.y)*(M.x-g.x)-(o.x-g.x)*(M.y-g.y),le=((o.y-g.y)*(u.x-o.x)-(o.x-g.x)*(u.y-o.y))/G,_e=K/G;(_e<0||_e>1||le<0||le>1)&&(B=!0)}}else B=!0;return B?yn.min(_.pointToSegment(o,g,M),_.pointToSegment(u,g,M),_.pointToSegment(g,o,u),_.pointToSegment(M,o,u)):0}},{key:"pointToSegment",value:function(o,u,g){if(u.x===g.x&&u.y===g.y)return o.distance(u);var M=(g.x-u.x)*(g.x-u.x)+(g.y-u.y)*(g.y-u.y),B=((o.x-u.x)*(g.x-u.x)+(o.y-u.y)*(g.y-u.y))/M;if(B<=0)return o.distance(u);if(B>=1)return o.distance(g);var G=((u.y-o.y)*(g.x-u.x)-(u.x-o.x)*(g.y-u.y))/M;return Math.abs(G)*Math.sqrt(M)}},{key:"pointToLinePerpendicular",value:function(o,u,g){var M=(g.x-u.x)*(g.x-u.x)+(g.y-u.y)*(g.y-u.y),B=((u.y-o.y)*(g.x-u.x)-(u.x-o.x)*(g.y-u.y))/M;return Math.abs(B)*Math.sqrt(M)}},{key:"pointToSegmentString",value:function(o,u){if(u.length===0)throw new At("Line array must contain at least one vertex");for(var g=o.distance(u[0]),M=0;M<u.length-1;M++){var B=_.pointToSegment(o,u[M],u[M+1]);B<g&&(g=B)}return g}}])})(),Un=(function(){return c((function _(){D(this,_)}),[{key:"create",value:function(){if(arguments.length===1)arguments[0]instanceof Array||dn(arguments[0],Se);else if(arguments.length!==2){if(arguments.length===3){var _=arguments[0],o=arguments[1];return this.create(_,o)}}}}])})(),it=(function(){return c((function _(){D(this,_)}),[{key:"filter",value:function(_){}}])})(),ii=(function(){return c((function _(){D(this,_)}),null,[{key:"ofLine",value:function(_){var o=_.size();if(o<=1)return 0;var u=0,g=new Qe;_.getCoordinate(0,g);for(var M=g.x,B=g.y,G=1;G<o;G++){_.getCoordinate(G,g);var K=g.x,le=g.y,_e=K-M,Ke=le-B;u+=Math.sqrt(_e*_e+Ke*Ke),M=K,B=le}return u}}])})(),Hi=c((function _(){D(this,_)})),xn=(function(){function _(){D(this,_)}return c(_,null,[{key:"copyCoord",value:function(o,u,g,M){for(var B=Math.min(o.getDimension(),g.getDimension()),G=0;G<B;G++)g.setOrdinate(M,G,o.getOrdinate(u,G))}},{key:"isRing",value:function(o){var u=o.size();return u===0||!(u<=3)&&o.getOrdinate(0,Se.X)===o.getOrdinate(u-1,Se.X)&&o.getOrdinate(0,Se.Y)===o.getOrdinate(u-1,Se.Y)}},{key:"scroll",value:function(){if(arguments.length===2){if(dn(arguments[0],Se)&&Number.isInteger(arguments[1])){var o=arguments[0],u=arguments[1];_.scroll(o,u,_.isRing(o))}else if(dn(arguments[0],Se)&&arguments[1]instanceof Qe){var g=arguments[0],M=arguments[1],B=_.indexOf(M,g);if(B<=0)return null;_.scroll(g,B)}}else if(arguments.length===3){var G=arguments[0],K=arguments[1],le=arguments[2];if(K<=0)return null;for(var _e=G.copy(),Ke=le?G.size()-1:G.size(),ct=0;ct<Ke;ct++)for(var Bt=0;Bt<G.getDimension();Bt++)G.setOrdinate(ct,Bt,_e.getOrdinate((K+ct)%Ke,Bt));if(le)for(var Jt=0;Jt<G.getDimension();Jt++)G.setOrdinate(Ke,Jt,G.getOrdinate(0,Jt))}}},{key:"isEqual",value:function(o,u){var g=o.size();if(g!==u.size())return!1;for(var M=Math.min(o.getDimension(),u.getDimension()),B=0;B<g;B++)for(var G=0;G<M;G++){var K=o.getOrdinate(B,G),le=u.getOrdinate(B,G);if(o.getOrdinate(B,G)!==u.getOrdinate(B,G)&&(!vt.isNaN(K)||!vt.isNaN(le)))return!1}return!0}},{key:"minCoordinateIndex",value:function(){if(arguments.length===1){var o=arguments[0];return _.minCoordinateIndex(o,0,o.size()-1)}if(arguments.length===3){for(var u=arguments[0],g=arguments[2],M=-1,B=null,G=arguments[1];G<=g;G++){var K=u.getCoordinate(G);(B===null||B.compareTo(K)>0)&&(B=K,M=G)}return M}}},{key:"extend",value:function(o,u,g){var M=o.create(g,u.getDimension()),B=u.size();if(_.copy(u,0,M,0,B),B>0)for(var G=B;G<g;G++)_.copy(u,B-1,M,G,1);return M}},{key:"reverse",value:function(o){for(var u=o.size()-1,g=Math.trunc(u/2),M=0;M<=g;M++)_.swap(o,M,u-M)}},{key:"swap",value:function(o,u,g){if(u===g)return null;for(var M=0;M<o.getDimension();M++){var B=o.getOrdinate(u,M);o.setOrdinate(u,M,o.getOrdinate(g,M)),o.setOrdinate(g,M,B)}}},{key:"copy",value:function(o,u,g,M,B){for(var G=0;G<B;G++)_.copyCoord(o,u+G,g,M+G)}},{key:"ensureValidRing",value:function(o,u){var g=u.size();return g===0?u:g<=3?_.createClosedRing(o,u,4):u.getOrdinate(0,Se.X)===u.getOrdinate(g-1,Se.X)&&u.getOrdinate(0,Se.Y)===u.getOrdinate(g-1,Se.Y)?u:_.createClosedRing(o,u,g+1)}},{key:"indexOf",value:function(o,u){for(var g=0;g<u.size();g++)if(o.x===u.getOrdinate(g,Se.X)&&o.y===u.getOrdinate(g,Se.Y))return g;return-1}},{key:"createClosedRing",value:function(o,u,g){var M=o.create(g,u.getDimension()),B=u.size();_.copy(u,0,M,0,B);for(var G=B;G<g;G++)_.copy(u,0,M,G,1);return M}},{key:"minCoordinate",value:function(o){for(var u=null,g=0;g<o.size();g++){var M=o.getCoordinate(g);(u===null||u.compareTo(M)>0)&&(u=M)}return u}}])})(),Nt=(function(){function _(){D(this,_)}return c(_,null,[{key:"toDimensionSymbol",value:function(o){switch(o){case _.FALSE:return _.SYM_FALSE;case _.TRUE:return _.SYM_TRUE;case _.DONTCARE:return _.SYM_DONTCARE;case _.P:return _.SYM_P;case _.L:return _.SYM_L;case _.A:return _.SYM_A}throw new At("Unknown dimension value: "+o)}},{key:"toDimensionValue",value:function(o){switch(re.toUpperCase(o)){case _.SYM_FALSE:return _.FALSE;case _.SYM_TRUE:return _.TRUE;case _.SYM_DONTCARE:return _.DONTCARE;case _.SYM_P:return _.P;case _.SYM_L:return _.L;case _.SYM_A:return _.A}throw new At("Unknown dimension symbol: "+o)}}])})();Nt.P=0,Nt.L=1,Nt.A=2,Nt.FALSE=-1,Nt.TRUE=-2,Nt.DONTCARE=-3,Nt.SYM_FALSE="F",Nt.SYM_TRUE="T",Nt.SYM_DONTCARE="*",Nt.SYM_P="0",Nt.SYM_L="1",Nt.SYM_A="2";var Xi=(function(){return c((function _(){D(this,_)}),[{key:"filter",value:function(_){}}])})(),Kn=(function(){return c((function _(){D(this,_)}),[{key:"filter",value:function(_,o){}},{key:"isDone",value:function(){}},{key:"isGeometryChanged",value:function(){}}])})(),ki=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"computeEnvelopeInternal",value:function(){return this.isEmpty()?new Rn:this._points.expandEnvelope(new Rn)}},{key:"isRing",value:function(){return this.isClosed()&&this.isSimple()}},{key:"getCoordinates",value:function(){return this._points.toCoordinateArray()}},{key:"copyInternal",value:function(){return new o(this._points.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];if(!this.isEquivalentClass(u))return!1;var M=u;if(this._points.size()!==M._points.size())return!1;for(var B=0;B<this._points.size();B++)if(!this.equal(this._points.getCoordinate(B),M._points.getCoordinate(B),g))return!1;return!0}return Ge(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var u=0;u<Math.trunc(this._points.size()/2);u++){var g=this._points.size()-1-u;if(!this._points.getCoordinate(u).equals(this._points.getCoordinate(g))){if(this._points.getCoordinate(u).compareTo(this._points.getCoordinate(g))>0){var M=this._points.copy();xn.reverse(M),this._points=M}return null}}}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._points.getCoordinate(0)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Nt.FALSE:0}},{key:"isClosed",value:function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))}},{key:"reverseInternal",value:function(){var u=this._points.copy();return xn.reverse(u),this.getFactory().createLineString(u)}},{key:"getEndPoint",value:function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)}},{key:"getTypeCode",value:function(){return rn.TYPECODE_LINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getLength",value:function(){return ii.ofLine(this._points)}},{key:"getNumPoints",value:function(){return this._points.size()}},{key:"compareToSameClass",value:function(){if(arguments.length===1){for(var u=arguments[0],g=0,M=0;g<this._points.size()&&M<u._points.size();){var B=this._points.getCoordinate(g).compareTo(u._points.getCoordinate(M));if(B!==0)return B;g++,M++}return g<this._points.size()?1:M<u._points.size()?-1:0}if(arguments.length===2){var G=arguments[0];return arguments[1].compare(this._points,G._points)}}},{key:"apply",value:function(){if(dn(arguments[0],it))for(var u=arguments[0],g=0;g<this._points.size();g++)u.filter(this._points.getCoordinate(g));else if(dn(arguments[0],Kn)){var M=arguments[0];if(this._points.size()===0)return null;for(var B=0;B<this._points.size()&&(M.filter(this._points,B),!M.isDone());B++);M.isGeometryChanged()&&this.geometryChanged()}else dn(arguments[0],Xi)?arguments[0].filter(this):dn(arguments[0],Vt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){throw new Pn}},{key:"isEquivalentClass",value:function(u){return u instanceof o}},{key:"getCoordinateN",value:function(u){return this._points.getCoordinate(u)}},{key:"getGeometryType",value:function(){return rn.TYPENAME_LINESTRING}},{key:"getCoordinateSequence",value:function(){return this._points}},{key:"isEmpty",value:function(){return this._points.size()===0}},{key:"init",value:function(u){if(u===null&&(u=this.getFactory().getCoordinateSequenceFactory().create([])),u.size()===1)throw new At("Invalid number of points in LineString (found "+u.size()+" - must be 0 or >= 2)");this._points=u}},{key:"isCoordinate",value:function(u){for(var g=0;g<this._points.size();g++)if(this._points.getCoordinate(g).equals(u))return!0;return!1}},{key:"getStartPoint",value:function(){return this.isEmpty()?null:this.getPointN(0)}},{key:"getPointN",value:function(u){return this.getFactory().createPoint(this._points.getCoordinate(u))}},{key:"interfaces_",get:function(){return[Hi]}}],[{key:"constructor_",value:function(){if(this._points=null,arguments.length!==0){if(arguments.length===2){var u=arguments[0],g=arguments[1];rn.constructor_.call(this,g),this.init(u)}}}}])})(rn),si=c((function _(){D(this,_)})),ji=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"computeEnvelopeInternal",value:function(){if(this.isEmpty())return new Rn;var u=new Rn;return u.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),u}},{key:"getCoordinates",value:function(){return this.isEmpty()?[]:[this.getCoordinate()]}},{key:"copyInternal",value:function(){return new o(this._coordinates.copy(),this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];return!!this.isEquivalentClass(u)&&(!(!this.isEmpty()||!u.isEmpty())||this.isEmpty()===u.isEmpty()&&this.equal(u.getCoordinate(),this.getCoordinate(),g))}return Ge(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){}},{key:"getCoordinate",value:function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null}},{key:"getBoundaryDimension",value:function(){return Nt.FALSE}},{key:"reverseInternal",value:function(){return this.getFactory().createPoint(this._coordinates.copy())}},{key:"getTypeCode",value:function(){return rn.TYPECODE_POINT}},{key:"getDimension",value:function(){return 0}},{key:"getNumPoints",value:function(){return this.isEmpty()?0:1}},{key:"getX",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getX called on empty Point");return this.getCoordinate().x}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var u=arguments[0];return this.getCoordinate().compareTo(u.getCoordinate())}if(arguments.length===2){var g=arguments[0];return arguments[1].compare(this._coordinates,g._coordinates)}}},{key:"apply",value:function(){if(dn(arguments[0],it)){var u=arguments[0];if(this.isEmpty())return null;u.filter(this.getCoordinate())}else if(dn(arguments[0],Kn)){var g=arguments[0];if(this.isEmpty())return null;g.filter(this._coordinates,0),g.isGeometryChanged()&&this.geometryChanged()}else dn(arguments[0],Xi)?arguments[0].filter(this):dn(arguments[0],Vt)&&arguments[0].filter(this)}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return rn.TYPENAME_POINT}},{key:"getCoordinateSequence",value:function(){return this._coordinates}},{key:"getY",value:function(){if(this.getCoordinate()===null)throw new IllegalStateException("getY called on empty Point");return this.getCoordinate().y}},{key:"isEmpty",value:function(){return this._coordinates.size()===0}},{key:"init",value:function(u){u===null&&(u=this.getFactory().getCoordinateSequenceFactory().create([])),Ct.isTrue(u.size()<=1),this._coordinates=u}},{key:"isSimple",value:function(){return!0}},{key:"interfaces_",get:function(){return[si]}}],[{key:"constructor_",value:function(){this._coordinates=null;var u=arguments[0],g=arguments[1];rn.constructor_.call(this,g),this.init(u)}}])})(rn),qo=(function(){function _(){D(this,_)}return c(_,null,[{key:"ofRing",value:function(){if(arguments[0]instanceof Array){var o=arguments[0];return Math.abs(_.ofRingSigned(o))}if(dn(arguments[0],Se)){var u=arguments[0];return Math.abs(_.ofRingSigned(u))}}},{key:"ofRingSigned",value:function(){if(arguments[0]instanceof Array){var o=arguments[0];if(o.length<3)return 0;for(var u=0,g=o[0].x,M=1;M<o.length-1;M++){var B=o[M].x-g,G=o[M+1].y;u+=B*(o[M-1].y-G)}return u/2}if(dn(arguments[0],Se)){var K=arguments[0],le=K.size();if(le<3)return 0;var _e=new Qe,Ke=new Qe,ct=new Qe;K.getCoordinate(0,Ke),K.getCoordinate(1,ct);var Bt=Ke.x;ct.x-=Bt;for(var Jt=0,sn=1;sn<le-1;sn++)_e.y=Ke.y,Ke.x=ct.x,Ke.y=ct.y,K.getCoordinate(sn+1,ct),ct.x-=Bt,Jt+=Ke.x*(_e.y-ct.y);return Jt/2}}}])})(),Aa=(function(){return c((function _(){D(this,_)}),null,[{key:"sort",value:function(){var _=arguments,o=arguments[0];if(arguments.length===1)o.sort((function(Bt,Jt){return Bt.compareTo(Jt)}));else if(arguments.length===2)o.sort((function(Bt,Jt){return _[1].compare(Bt,Jt)}));else if(arguments.length===3){var u=o.slice(arguments[1],arguments[2]);u.sort();var g=o.slice(0,arguments[1]).concat(u,o.slice(arguments[2],o.length));o.splice(0,o.length);var M,B=X(g);try{for(B.s();!(M=B.n()).done;){var G=M.value;o.push(G)}}catch(Bt){B.e(Bt)}finally{B.f()}}else if(arguments.length===4){var K=o.slice(arguments[1],arguments[2]);K.sort((function(Bt,Jt){return _[3].compare(Bt,Jt)}));var le=o.slice(0,arguments[1]).concat(K,o.slice(arguments[2],o.length));o.splice(0,o.length);var _e,Ke=X(le);try{for(Ke.s();!(_e=Ke.n()).done;){var ct=_e.value;o.push(ct)}}catch(Bt){Ke.e(Bt)}finally{Ke.f()}}}},{key:"asList",value:function(_){var o,u=new Ze,g=X(_);try{for(g.s();!(o=g.n()).done;){var M=o.value;u.add(M)}}catch(B){g.e(B)}finally{g.f()}return u}},{key:"copyOf",value:function(_,o){return _.slice(0,o)}}])})(),Gt=c((function _(){D(this,_)})),_r=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"computeEnvelopeInternal",value:function(){return this._shell.getEnvelopeInternal()}},{key:"getCoordinates",value:function(){if(this.isEmpty())return[];for(var u=new Array(this.getNumPoints()).fill(null),g=-1,M=this._shell.getCoordinates(),B=0;B<M.length;B++)u[++g]=M[B];for(var G=0;G<this._holes.length;G++)for(var K=this._holes[G].getCoordinates(),le=0;le<K.length;le++)u[++g]=K[le];return u}},{key:"getArea",value:function(){var u=0;u+=qo.ofRing(this._shell.getCoordinateSequence());for(var g=0;g<this._holes.length;g++)u-=qo.ofRing(this._holes[g].getCoordinateSequence());return u}},{key:"copyInternal",value:function(){for(var u=this._shell.copy(),g=new Array(this._holes.length).fill(null),M=0;M<this._holes.length;M++)g[M]=this._holes[M].copy();return new o(u,g,this._factory)}},{key:"isRectangle",value:function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var u=this._shell.getCoordinateSequence(),g=this.getEnvelopeInternal(),M=0;M<5;M++){var B=u.getX(M);if(B!==g.getMinX()&&B!==g.getMaxX())return!1;var G=u.getY(M);if(G!==g.getMinY()&&G!==g.getMaxY())return!1}for(var K=u.getX(0),le=u.getY(0),_e=1;_e<=4;_e++){var Ke=u.getX(_e),ct=u.getY(_e);if(Ke!==K==(ct!==le))return!1;K=Ke,le=ct}return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];if(!this.isEquivalentClass(u))return!1;var M=u,B=this._shell,G=M._shell;if(!B.equalsExact(G,g)||this._holes.length!==M._holes.length)return!1;for(var K=0;K<this._holes.length;K++)if(!this._holes[K].equalsExact(M._holes[K],g))return!1;return!0}return Ge(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){if(arguments.length===0){this._shell=this.normalized(this._shell,!0);for(var u=0;u<this._holes.length;u++)this._holes[u]=this.normalized(this._holes[u],!1);Aa.sort(this._holes)}else if(arguments.length===2){var g=arguments[0],M=arguments[1];if(g.isEmpty())return null;var B=g.getCoordinateSequence(),G=xn.minCoordinateIndex(B,0,B.size()-2);xn.scroll(B,G,!0),Ee.isCCW(B)===M&&xn.reverse(B)}}},{key:"getCoordinate",value:function(){return this._shell.getCoordinate()}},{key:"getNumInteriorRing",value:function(){return this._holes.length}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"reverseInternal",value:function(){for(var u=this.getExteriorRing().reverse(),g=new Array(this.getNumInteriorRing()).fill(null),M=0;M<g.length;M++)g[M]=this.getInteriorRingN(M).reverse();return this.getFactory().createPolygon(u,g)}},{key:"getTypeCode",value:function(){return rn.TYPECODE_POLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getLength",value:function(){var u=0;u+=this._shell.getLength();for(var g=0;g<this._holes.length;g++)u+=this._holes[g].getLength();return u}},{key:"getNumPoints",value:function(){for(var u=this._shell.getNumPoints(),g=0;g<this._holes.length;g++)u+=this._holes[g].getNumPoints();return u}},{key:"convexHull",value:function(){return this.getExteriorRing().convexHull()}},{key:"normalized",value:function(u,g){var M=u.copy();return this.normalize(M,g),M}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var u=arguments[0],g=this._shell,M=u._shell;return g.compareToSameClass(M)}if(arguments.length===2){var B=arguments[1],G=arguments[0],K=this._shell,le=G._shell,_e=K.compareToSameClass(le,B);if(_e!==0)return _e;for(var Ke=this.getNumInteriorRing(),ct=G.getNumInteriorRing(),Bt=0;Bt<Ke&&Bt<ct;){var Jt=this.getInteriorRingN(Bt),sn=G.getInteriorRingN(Bt),pn=Jt.compareToSameClass(sn,B);if(pn!==0)return pn;Bt++}return Bt<Ke?1:Bt<ct?-1:0}}},{key:"apply",value:function(){if(dn(arguments[0],it)){var u=arguments[0];this._shell.apply(u);for(var g=0;g<this._holes.length;g++)this._holes[g].apply(u)}else if(dn(arguments[0],Kn)){var M=arguments[0];if(this._shell.apply(M),!M.isDone())for(var B=0;B<this._holes.length&&(this._holes[B].apply(M),!M.isDone());B++);M.isGeometryChanged()&&this.geometryChanged()}else if(dn(arguments[0],Xi))arguments[0].filter(this);else if(dn(arguments[0],Vt)){var G=arguments[0];G.filter(this),this._shell.apply(G);for(var K=0;K<this._holes.length;K++)this._holes[K].apply(G)}}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var u=new Array(this._holes.length+1).fill(null);u[0]=this._shell;for(var g=0;g<this._holes.length;g++)u[g+1]=this._holes[g];return u.length<=1?this.getFactory().createLinearRing(u[0].getCoordinateSequence()):this.getFactory().createMultiLineString(u)}},{key:"getGeometryType",value:function(){return rn.TYPENAME_POLYGON}},{key:"getExteriorRing",value:function(){return this._shell}},{key:"isEmpty",value:function(){return this._shell.isEmpty()}},{key:"getInteriorRingN",value:function(u){return this._holes[u]}},{key:"interfaces_",get:function(){return[Gt]}}],[{key:"constructor_",value:function(){this._shell=null,this._holes=null;var u=arguments[0],g=arguments[1],M=arguments[2];if(rn.constructor_.call(this,M),u===null&&(u=this.getFactory().createLinearRing()),g===null&&(g=[]),rn.hasNullElements(g))throw new At("holes must not contain null elements");if(u.isEmpty()&&rn.hasNonEmptyElements(g))throw new At("shell is empty but holes are not");this._shell=u,this._holes=g}}])})(rn),Xr=(function(_){function o(){return D(this,o),I(this,o,arguments)}return ie(o,_),c(o)})(Ia),Va=(function(_){function o(u){var g;return D(this,o),(g=I(this,o)).array=[],u instanceof fi&&g.addAll(u),g}return ie(o,_),c(o,[{key:"contains",value:function(u){var g,M=X(this.array);try{for(M.s();!(g=M.n()).done;)if(g.value.compareTo(u)===0)return!0}catch(B){M.e(B)}finally{M.f()}return!1}},{key:"add",value:function(u){if(this.contains(u))return!1;for(var g=0,M=this.array.length;g<M;g++)if(this.array[g].compareTo(u)===1)return!!this.array.splice(g,0,u);return this.array.push(u),!0}},{key:"addAll",value:function(u){var g,M=X(u);try{for(M.s();!(g=M.n()).done;){var B=g.value;this.add(B)}}catch(G){M.e(G)}finally{M.f()}return!0}},{key:"remove",value:function(){throw new Pn}},{key:"size",value:function(){return this.array.length}},{key:"isEmpty",value:function(){return this.array.length===0}},{key:"toArray",value:function(){return this.array.slice()}},{key:"iterator",value:function(){return new di(this.array)}}])})(Xr),di=(function(){return c((function _(o){D(this,_),this.array=o,this.position=0}),[{key:"next",value:function(){if(this.position===this.array.length)throw new Dn;return this.array[this.position++]}},{key:"hasNext",value:function(){return this.position<this.array.length}},{key:"remove",value:function(){throw new Pn}}])})(),Ut=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"computeEnvelopeInternal",value:function(){for(var u=new Rn,g=0;g<this._geometries.length;g++)u.expandToInclude(this._geometries[g].getEnvelopeInternal());return u}},{key:"getGeometryN",value:function(u){return this._geometries[u]}},{key:"getCoordinates",value:function(){for(var u=new Array(this.getNumPoints()).fill(null),g=-1,M=0;M<this._geometries.length;M++)for(var B=this._geometries[M].getCoordinates(),G=0;G<B.length;G++)u[++g]=B[G];return u}},{key:"getArea",value:function(){for(var u=0,g=0;g<this._geometries.length;g++)u+=this._geometries[g].getArea();return u}},{key:"copyInternal",value:function(){for(var u=new Array(this._geometries.length).fill(null),g=0;g<u.length;g++)u[g]=this._geometries[g].copy();return new o(u,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];if(!this.isEquivalentClass(u))return!1;var M=u;if(this._geometries.length!==M._geometries.length)return!1;for(var B=0;B<this._geometries.length;B++)if(!this._geometries[B].equalsExact(M._geometries[B],g))return!1;return!0}return Ge(o,"equalsExact",this,1).apply(this,arguments)}},{key:"normalize",value:function(){for(var u=0;u<this._geometries.length;u++)this._geometries[u].normalize();Aa.sort(this._geometries)}},{key:"getCoordinate",value:function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()}},{key:"getBoundaryDimension",value:function(){for(var u=Nt.FALSE,g=0;g<this._geometries.length;g++)u=Math.max(u,this._geometries[g].getBoundaryDimension());return u}},{key:"reverseInternal",value:function(){for(var u=this._geometries.length,g=new Ze(u),M=0;M<u;M++)g.add(this._geometries[M].reverse());return this.getFactory().buildGeometry(g)}},{key:"getTypeCode",value:function(){return rn.TYPECODE_GEOMETRYCOLLECTION}},{key:"getDimension",value:function(){for(var u=Nt.FALSE,g=0;g<this._geometries.length;g++)u=Math.max(u,this._geometries[g].getDimension());return u}},{key:"getLength",value:function(){for(var u=0,g=0;g<this._geometries.length;g++)u+=this._geometries[g].getLength();return u}},{key:"getNumPoints",value:function(){for(var u=0,g=0;g<this._geometries.length;g++)u+=this._geometries[g].getNumPoints();return u}},{key:"getNumGeometries",value:function(){return this._geometries.length}},{key:"compareToSameClass",value:function(){if(arguments.length===1){var u=arguments[0],g=new Va(Aa.asList(this._geometries)),M=new Va(Aa.asList(u._geometries));return this.compare(g,M)}if(arguments.length===2){for(var B=arguments[1],G=arguments[0],K=this.getNumGeometries(),le=G.getNumGeometries(),_e=0;_e<K&&_e<le;){var Ke=this.getGeometryN(_e),ct=G.getGeometryN(_e),Bt=Ke.compareToSameClass(ct,B);if(Bt!==0)return Bt;_e++}return _e<K?1:_e<le?-1:0}}},{key:"apply",value:function(){if(dn(arguments[0],it))for(var u=arguments[0],g=0;g<this._geometries.length;g++)this._geometries[g].apply(u);else if(dn(arguments[0],Kn)){var M=arguments[0];if(this._geometries.length===0)return null;for(var B=0;B<this._geometries.length&&(this._geometries[B].apply(M),!M.isDone());B++);M.isGeometryChanged()&&this.geometryChanged()}else if(dn(arguments[0],Xi)){var G=arguments[0];G.filter(this);for(var K=0;K<this._geometries.length;K++)this._geometries[K].apply(G)}else if(dn(arguments[0],Vt)){var le=arguments[0];le.filter(this);for(var _e=0;_e<this._geometries.length;_e++)this._geometries[_e].apply(le)}}},{key:"getBoundary",value:function(){return rn.checkNotGeometryCollection(this),Ct.shouldNeverReachHere(),null}},{key:"getGeometryType",value:function(){return rn.TYPENAME_GEOMETRYCOLLECTION}},{key:"isEmpty",value:function(){for(var u=0;u<this._geometries.length;u++)if(!this._geometries[u].isEmpty())return!1;return!0}}],[{key:"constructor_",value:function(){if(this._geometries=null,arguments.length!==0){if(arguments.length===2){var u=arguments[0],g=arguments[1];if(rn.constructor_.call(this,g),u===null&&(u=[]),rn.hasNullElements(u))throw new At("geometries must not contain null elements");this._geometries=u}}}}])})(rn),Sn=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"copyInternal",value:function(){for(var u=new Array(this._geometries.length).fill(null),g=0;g<u.length;g++)u[g]=this._geometries[g].copy();return new o(u,this._factory)}},{key:"isValid",value:function(){return!0}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];return!!this.isEquivalentClass(u)&&Ge(o,"equalsExact",this,1).call(this,u,g)}return Ge(o,"equalsExact",this,1).apply(this,arguments)}},{key:"getCoordinate",value:function(){if(arguments.length===1&&Number.isInteger(arguments[0])){var u=arguments[0];return this._geometries[u].getCoordinate()}return Ge(o,"getCoordinate",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return Nt.FALSE}},{key:"getTypeCode",value:function(){return rn.TYPECODE_MULTIPOINT}},{key:"getDimension",value:function(){return 0}},{key:"getBoundary",value:function(){return this.getFactory().createGeometryCollection()}},{key:"getGeometryType",value:function(){return rn.TYPENAME_MULTIPOINT}},{key:"interfaces_",get:function(){return[si]}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];Ut.constructor_.call(this,u,g)}}])})(Ut),Mn=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"copyInternal",value:function(){return new o(this._points.copy(),this._factory)}},{key:"getBoundaryDimension",value:function(){return Nt.FALSE}},{key:"isClosed",value:function(){return!!this.isEmpty()||Ge(o,"isClosed",this,1).call(this)}},{key:"reverseInternal",value:function(){var u=this._points.copy();return xn.reverse(u),this.getFactory().createLinearRing(u)}},{key:"getTypeCode",value:function(){return rn.TYPECODE_LINEARRING}},{key:"validateConstruction",value:function(){if(!this.isEmpty()&&!Ge(o,"isClosed",this,1).call(this))throw new At("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<o.MINIMUM_VALID_SIZE)throw new At("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")}},{key:"getGeometryType",value:function(){return rn.TYPENAME_LINEARRING}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];ki.constructor_.call(this,u,g),this.validateConstruction()}}])})(ki);Mn.MINIMUM_VALID_SIZE=4;var yr=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"setOrdinate",value:function(u,g){switch(u){case o.X:this.x=g;break;case o.Y:this.y=g;break;default:throw new At("Invalid ordinate index: "+u)}}},{key:"getZ",value:function(){return Qe.NULL_ORDINATE}},{key:"getOrdinate",value:function(u){switch(u){case o.X:return this.x;case o.Y:return this.y}throw new At("Invalid ordinate index: "+u)}},{key:"setZ",value:function(u){throw new At("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+")"}},{key:"setCoordinate",value:function(u){this.x=u.x,this.y=u.y,this.z=u.getZ()}}],[{key:"constructor_",value:function(){if(arguments.length===0)Qe.constructor_.call(this);else if(arguments.length===1){if(arguments[0]instanceof o){var u=arguments[0];Qe.constructor_.call(this,u.x,u.y)}else if(arguments[0]instanceof Qe){var g=arguments[0];Qe.constructor_.call(this,g.x,g.y)}}else if(arguments.length===2){var M=arguments[0],B=arguments[1];Qe.constructor_.call(this,M,B,Qe.NULL_ORDINATE)}}}])})(Qe);yr.X=0,yr.Y=1,yr.Z=-1,yr.M=-1;var Ms=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(u,g){switch(u){case o.X:this.x=g;break;case o.Y:this.y=g;break;case o.M:this._m=g;break;default:throw new At("Invalid ordinate index: "+u)}}},{key:"setM",value:function(u){this._m=u}},{key:"getZ",value:function(){return Qe.NULL_ORDINATE}},{key:"getOrdinate",value:function(u){switch(u){case o.X:return this.x;case o.Y:return this.y;case o.M:return this._m}throw new At("Invalid ordinate index: "+u)}},{key:"setZ",value:function(u){throw new At("CoordinateXY dimension 2 does not support z-ordinate")}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(u){this.x=u.x,this.y=u.y,this.z=u.getZ(),this._m=u.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Qe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof o){var u=arguments[0];Qe.constructor_.call(this,u.x,u.y),this._m=u._m}else if(arguments[0]instanceof Qe){var g=arguments[0];Qe.constructor_.call(this,g.x,g.y),this._m=this.getM()}}else if(arguments.length===3){var M=arguments[0],B=arguments[1],G=arguments[2];Qe.constructor_.call(this,M,B,Qe.NULL_ORDINATE),this._m=G}}}])})(Qe);Ms.X=0,Ms.Y=1,Ms.Z=-1,Ms.M=2;var Ga=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"getM",value:function(){return this._m}},{key:"setOrdinate",value:function(u,g){switch(u){case Qe.X:this.x=g;break;case Qe.Y:this.y=g;break;case Qe.Z:this.z=g;break;case Qe.M:this._m=g;break;default:throw new At("Invalid ordinate index: "+u)}}},{key:"setM",value:function(u){this._m=u}},{key:"getOrdinate",value:function(u){switch(u){case Qe.X:return this.x;case Qe.Y:return this.y;case Qe.Z:return this.getZ();case Qe.M:return this.getM()}throw new At("Invalid ordinate index: "+u)}},{key:"copy",value:function(){return new o(this)}},{key:"toString",value:function(){return"("+this.x+", "+this.y+", "+this.getZ()+" m="+this.getM()+")"}},{key:"setCoordinate",value:function(u){this.x=u.x,this.y=u.y,this.z=u.getZ(),this._m=u.getM()}}],[{key:"constructor_",value:function(){if(this._m=null,arguments.length===0)Qe.constructor_.call(this),this._m=0;else if(arguments.length===1){if(arguments[0]instanceof o){var u=arguments[0];Qe.constructor_.call(this,u),this._m=u._m}else if(arguments[0]instanceof Qe){var g=arguments[0];Qe.constructor_.call(this,g),this._m=this.getM()}}else if(arguments.length===4){var M=arguments[0],B=arguments[1],G=arguments[2],K=arguments[3];Qe.constructor_.call(this,M,B,G),this._m=K}}}])})(Qe),wn=(function(){function _(){D(this,_)}return c(_,null,[{key:"measures",value:function(o){return o instanceof yr?0:o instanceof Ms||o instanceof Ga?1:0}},{key:"dimension",value:function(o){return o instanceof yr?2:o instanceof Ms?3:o instanceof Ga?4:3}},{key:"create",value:function(){if(arguments.length===1){var o=arguments[0];return _.create(o,0)}if(arguments.length===2){var u=arguments[0],g=arguments[1];return u===2?new yr:u===3&&g===0?new Qe:u===3&&g===1?new Ms:u===4&&g===1?new Ga:new Qe}}}])})(),ls=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"getCoordinate",value:function(u){return this.get(u)}},{key:"addAll",value:function(){if(arguments.length===2&&typeof arguments[1]=="boolean"&&dn(arguments[0],fi)){for(var u=arguments[1],g=!1,M=arguments[0].iterator();M.hasNext();)this.add(M.next(),u),g=!0;return g}return Ge(o,"addAll",this,1).apply(this,arguments)}},{key:"clone",value:function(){for(var u=Ge(o,"clone",this,1).call(this),g=0;g<this.size();g++)u.add(g,this.get(g).clone());return u}},{key:"toCoordinateArray",value:function(){if(arguments.length===0)return this.toArray(o.coordArrayType);if(arguments.length===1){if(arguments[0])return this.toArray(o.coordArrayType);for(var u=this.size(),g=new Array(u).fill(null),M=0;M<u;M++)g[M]=this.get(u-M-1);return g}}},{key:"add",value:function(){if(arguments.length===1){var u=arguments[0];return Ge(o,"add",this,1).call(this,u)}if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var g=arguments[0],M=arguments[1];return this.add(g,M,!0),!0}if(arguments[0]instanceof Qe&&typeof arguments[1]=="boolean"){var B=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(B))return null;Ge(o,"add",this,1).call(this,B)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var G=arguments[0],K=arguments[1];return this.add(G,K),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var le=arguments[0],_e=arguments[1];if(arguments[2])for(var Ke=0;Ke<le.length;Ke++)this.add(le[Ke],_e);else for(var ct=le.length-1;ct>=0;ct--)this.add(le[ct],_e);return!0}if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof Qe){var Bt=arguments[0],Jt=arguments[1];if(!arguments[2]){var sn=this.size();if(sn>0&&(Bt>0&&this.get(Bt-1).equals2D(Jt)||Bt<sn&&this.get(Bt).equals2D(Jt)))return null}Ge(o,"add",this,1).call(this,Bt,Jt)}}else if(arguments.length===4){var pn=arguments[0],Nn=arguments[1],In=arguments[2],hi=arguments[3],hr=1;In>hi&&(hr=-1);for(var gi=In;gi!==hi;gi+=hr)this.add(pn[gi],Nn);return!0}}},{key:"closeRing",value:function(){if(this.size()>0){var u=this.get(0).copy();this.add(u,!1)}}}],[{key:"constructor_",value:function(){if(arguments.length!==0){if(arguments.length===1){var u=arguments[0];this.ensureCapacity(u.length),this.add(u,!0)}else if(arguments.length===2){var g=arguments[0],M=arguments[1];this.ensureCapacity(g.length),this.add(g,M)}}}}])})(Ze);ls.coordArrayType=new Array(0).fill(null);var pi=(function(){function _(){D(this,_)}return c(_,null,[{key:"isRing",value:function(o){return!(o.length<4)&&!!o[0].equals2D(o[o.length-1])}},{key:"ptNotInList",value:function(o,u){for(var g=0;g<o.length;g++){var M=o[g];if(_.indexOf(M,u)<0)return M}return null}},{key:"scroll",value:function(o,u){var g=_.indexOf(u,o);if(g<0)return null;var M=new Array(o.length).fill(null);Qt.arraycopy(o,g,M,0,o.length-g),Qt.arraycopy(o,0,M,o.length-g,g),Qt.arraycopy(M,0,o,0,o.length)}},{key:"equals",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];if(o===u)return!0;if(o===null||u===null||o.length!==u.length)return!1;for(var g=0;g<o.length;g++)if(!o[g].equals(u[g]))return!1;return!0}if(arguments.length===3){var M=arguments[0],B=arguments[1],G=arguments[2];if(M===B)return!0;if(M===null||B===null||M.length!==B.length)return!1;for(var K=0;K<M.length;K++)if(G.compare(M[K],B[K])!==0)return!1;return!0}}},{key:"intersection",value:function(o,u){for(var g=new ls,M=0;M<o.length;M++)u.intersects(o[M])&&g.add(o[M],!0);return g.toCoordinateArray()}},{key:"measures",value:function(o){if(o===null||o.length===0)return 0;var u,g=0,M=X(o);try{for(M.s();!(u=M.n()).done;){var B=u.value;g=Math.max(g,wn.measures(B))}}catch(G){M.e(G)}finally{M.f()}return g}},{key:"hasRepeatedPoints",value:function(o){for(var u=1;u<o.length;u++)if(o[u-1].equals(o[u]))return!0;return!1}},{key:"removeRepeatedPoints",value:function(o){return _.hasRepeatedPoints(o)?new ls(o,!1).toCoordinateArray():o}},{key:"reverse",value:function(o){for(var u=o.length-1,g=Math.trunc(u/2),M=0;M<=g;M++){var B=o[M];o[M]=o[u-M],o[u-M]=B}}},{key:"removeNull",value:function(o){for(var u=0,g=0;g<o.length;g++)o[g]!==null&&u++;var M=new Array(u).fill(null);if(u===0)return M;for(var B=0,G=0;G<o.length;G++)o[G]!==null&&(M[B++]=o[G]);return M}},{key:"copyDeep",value:function(){if(arguments.length===1){for(var o=arguments[0],u=new Array(o.length).fill(null),g=0;g<o.length;g++)u[g]=o[g].copy();return u}if(arguments.length===5)for(var M=arguments[0],B=arguments[1],G=arguments[2],K=arguments[3],le=arguments[4],_e=0;_e<le;_e++)G[K+_e]=M[B+_e].copy()}},{key:"isEqualReversed",value:function(o,u){for(var g=0;g<o.length;g++){var M=o[g],B=u[o.length-g-1];if(M.compareTo(B)!==0)return!1}return!0}},{key:"envelope",value:function(o){for(var u=new Rn,g=0;g<o.length;g++)u.expandToInclude(o[g]);return u}},{key:"toCoordinateArray",value:function(o){return o.toArray(_.coordArrayType)}},{key:"dimension",value:function(o){if(o===null||o.length===0)return 3;var u,g=0,M=X(o);try{for(M.s();!(u=M.n()).done;){var B=u.value;g=Math.max(g,wn.dimension(B))}}catch(G){M.e(G)}finally{M.f()}return g}},{key:"atLeastNCoordinatesOrNothing",value:function(o,u){return u.length>=o?u:[]}},{key:"indexOf",value:function(o,u){for(var g=0;g<u.length;g++)if(o.equals(u[g]))return g;return-1}},{key:"increasingDirection",value:function(o){for(var u=0;u<Math.trunc(o.length/2);u++){var g=o.length-1-u,M=o[u].compareTo(o[g]);if(M!==0)return M}return 1}},{key:"compare",value:function(o,u){for(var g=0;g<o.length&&g<u.length;){var M=o[g].compareTo(u[g]);if(M!==0)return M;g++}return g<u.length?-1:g<o.length?1:0}},{key:"minCoordinate",value:function(o){for(var u=null,g=0;g<o.length;g++)(u===null||u.compareTo(o[g])>0)&&(u=o[g]);return u}},{key:"extract",value:function(o,u,g){u=yn.clamp(u,0,o.length);var M=(g=yn.clamp(g,-1,o.length))-u+1;g<0&&(M=0),u>=o.length&&(M=0),g<u&&(M=0);var B=new Array(M).fill(null);if(M===0)return B;for(var G=0,K=u;K<=g;K++)B[G++]=o[K];return B}}])})(),Zs=(function(){return c((function _(){D(this,_)}),[{key:"compare",value:function(_,o){var u=_,g=o;return pi.compare(u,g)}},{key:"interfaces_",get:function(){return[Me]}}])})(),Cs=(function(){return c((function _(){D(this,_)}),[{key:"compare",value:function(_,o){var u=_,g=o;if(u.length<g.length)return-1;if(u.length>g.length)return 1;if(u.length===0)return 0;var M=pi.compare(u,g);return pi.isEqualReversed(u,g)?0:M}},{key:"OLDcompare",value:function(_,o){var u=_,g=o;if(u.length<g.length)return-1;if(u.length>g.length)return 1;if(u.length===0)return 0;for(var M=pi.increasingDirection(u),B=pi.increasingDirection(g),G=M>0?0:u.length-1,K=B>0?0:u.length-1,le=0;le<u.length;le++){var _e=u[G].compareTo(g[K]);if(_e!==0)return _e;G+=M,K+=B}return 0}},{key:"interfaces_",get:function(){return[Me]}}])})();pi.ForwardComparator=Zs,pi.BidirectionalComparator=Cs,pi.coordArrayType=new Array(0).fill(null);var ka=(function(){return c((function _(o){D(this,_),this.str=o}),[{key:"append",value:function(_){this.str+=_}},{key:"setCharAt",value:function(_,o){this.str=this.str.substr(0,_)+o+this.str.substr(_+1)}},{key:"toString",value:function(){return this.str}}])})(),Ti=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getM",value:function(o){return this.hasM()?this._coordinates[o].getM():vt.NaN}},{key:"setOrdinate",value:function(o,u,g){switch(u){case Se.X:this._coordinates[o].x=g;break;case Se.Y:this._coordinates[o].y=g;break;default:this._coordinates[o].setOrdinate(u,g)}}},{key:"getZ",value:function(o){return this.hasZ()?this._coordinates[o].getZ():vt.NaN}},{key:"size",value:function(){return this._coordinates.length}},{key:"getOrdinate",value:function(o,u){switch(u){case Se.X:return this._coordinates[o].x;case Se.Y:return this._coordinates[o].y;default:return this._coordinates[o].getOrdinate(u)}}},{key:"getCoordinate",value:function(){if(arguments.length===1){var o=arguments[0];return this._coordinates[o]}if(arguments.length===2){var u=arguments[0];arguments[1].setCoordinate(this._coordinates[u])}}},{key:"getCoordinateCopy",value:function(o){var u=this.createCoordinate();return u.setCoordinate(this._coordinates[o]),u}},{key:"createCoordinate",value:function(){return wn.create(this.getDimension(),this.getMeasures())}},{key:"getDimension",value:function(){return this._dimension}},{key:"getX",value:function(o){return this._coordinates[o].x}},{key:"getMeasures",value:function(){return this._measures}},{key:"expandEnvelope",value:function(o){for(var u=0;u<this._coordinates.length;u++)o.expandToInclude(this._coordinates[u]);return o}},{key:"copy",value:function(){for(var o=new Array(this.size()).fill(null),u=0;u<this._coordinates.length;u++){var g=this.createCoordinate();g.setCoordinate(this._coordinates[u]),o[u]=g}return new _(o,this._dimension,this._measures)}},{key:"toString",value:function(){if(this._coordinates.length>0){var o=new ka(17*this._coordinates.length);o.append("("),o.append(this._coordinates[0]);for(var u=1;u<this._coordinates.length;u++)o.append(", "),o.append(this._coordinates[u]);return o.append(")"),o.toString()}return"()"}},{key:"getY",value:function(o){return this._coordinates[o].y}},{key:"toCoordinateArray",value:function(){return this._coordinates}},{key:"interfaces_",get:function(){return[Se,de]}}],[{key:"constructor_",value:function(){if(this._dimension=3,this._measures=0,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];_.constructor_.call(this,o,pi.dimension(o),pi.measures(o))}else if(Number.isInteger(arguments[0])){var u=arguments[0];this._coordinates=new Array(u).fill(null);for(var g=0;g<u;g++)this._coordinates[g]=new Qe}else if(dn(arguments[0],Se)){var M=arguments[0];if(M===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=M.getDimension(),this._measures=M.getMeasures(),this._coordinates=new Array(M.size()).fill(null);for(var B=0;B<this._coordinates.length;B++)this._coordinates[B]=M.getCoordinateCopy(B)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var G=arguments[0],K=arguments[1];_.constructor_.call(this,G,K,pi.measures(G))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var le=arguments[0],_e=arguments[1];this._coordinates=new Array(le).fill(null),this._dimension=_e;for(var Ke=0;Ke<le;Ke++)this._coordinates[Ke]=wn.create(_e)}}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var ct=arguments[0],Bt=arguments[1],Jt=arguments[2];this._dimension=Bt,this._measures=Jt,this._coordinates=ct===null?new Array(0).fill(null):ct}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var sn=arguments[0],pn=arguments[1],Nn=arguments[2];this._coordinates=new Array(sn).fill(null),this._dimension=pn,this._measures=Nn;for(var In=0;In<sn;In++)this._coordinates[In]=this.createCoordinate()}}}}])})(),ho=(function(){function _(){D(this,_)}return c(_,[{key:"readResolve",value:function(){return _.instance()}},{key:"create",value:function(){if(arguments.length===1){if(arguments[0]instanceof Array)return new Ti(arguments[0]);if(dn(arguments[0],Se))return new Ti(arguments[0])}else{if(arguments.length===2){var o=arguments[1];return o>3&&(o=3),o<2&&(o=2),new Ti(arguments[0],o)}if(arguments.length===3){var u=arguments[2],g=arguments[1]-u;return u>1&&(u=1),g>3&&(g=3),g<2&&(g=2),new Ti(arguments[0],g+u,u)}}}},{key:"interfaces_",get:function(){return[Un,de]}}],[{key:"instance",value:function(){return _.instanceObject}}])})();ho.instanceObject=new ho;var Er=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"copyInternal",value:function(){for(var u=new Array(this._geometries.length).fill(null),g=0;g<u.length;g++)u[g]=this._geometries[g].copy();return new o(u,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];return!!this.isEquivalentClass(u)&&Ge(o,"equalsExact",this,1).call(this,u,g)}return Ge(o,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return 1}},{key:"getTypeCode",value:function(){return rn.TYPECODE_MULTIPOLYGON}},{key:"getDimension",value:function(){return 2}},{key:"getBoundary",value:function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var u=new Ze,g=0;g<this._geometries.length;g++)for(var M=this._geometries[g].getBoundary(),B=0;B<M.getNumGeometries();B++)u.add(M.getGeometryN(B));var G=new Array(u.size()).fill(null);return this.getFactory().createMultiLineString(u.toArray(G))}},{key:"getGeometryType",value:function(){return rn.TYPENAME_MULTIPOLYGON}},{key:"interfaces_",get:function(){return[Gt]}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];Ut.constructor_.call(this,u,g)}}])})(Ut),Vn=(function(){return c((function _(){D(this,_)}),[{key:"get",value:function(){}},{key:"put",value:function(){}},{key:"size",value:function(){}},{key:"values",value:function(){}},{key:"entrySet",value:function(){}}])})(),Ys=(function(_){function o(){var u;return D(this,o),(u=I(this,o)).map=new Map,u}return ie(o,_),c(o,[{key:"get",value:function(u){return this.map.get(u)||null}},{key:"put",value:function(u,g){return this.map.set(u,g),g}},{key:"values",value:function(){for(var u=new Ze,g=this.map.values(),M=g.next();!M.done;)u.add(M.value),M=g.next();return u}},{key:"entrySet",value:function(){var u=new Ri;return this.map.entries().forEach((function(g){return u.add(g)})),u}},{key:"size",value:function(){return this.map.size()}}])})(Vn),$r=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"equals",value:function(o){if(!(o instanceof _))return!1;var u=o;return this._modelType===u._modelType&&this._scale===u._scale}},{key:"compareTo",value:function(o){var u=o,g=this.getMaximumSignificantDigits(),M=u.getMaximumSignificantDigits();return nt.compare(g,M)}},{key:"getScale",value:function(){return this._scale}},{key:"isFloating",value:function(){return this._modelType===_.FLOATING||this._modelType===_.FLOATING_SINGLE}},{key:"getType",value:function(){return this._modelType}},{key:"toString",value:function(){var o="UNKNOWN";return this._modelType===_.FLOATING?o="Floating":this._modelType===_.FLOATING_SINGLE?o="Floating-Single":this._modelType===_.FIXED&&(o="Fixed (Scale="+this.getScale()+")"),o}},{key:"makePrecise",value:function(){if(typeof arguments[0]=="number"){var o=arguments[0];return vt.isNaN(o)||this._modelType===_.FLOATING_SINGLE?o:this._modelType===_.FIXED?Math.round(o*this._scale)/this._scale:o}if(arguments[0]instanceof Qe){var u=arguments[0];if(this._modelType===_.FLOATING)return null;u.x=this.makePrecise(u.x),u.y=this.makePrecise(u.y)}}},{key:"getMaximumSignificantDigits",value:function(){var o=16;return this._modelType===_.FLOATING?o=16:this._modelType===_.FLOATING_SINGLE?o=6:this._modelType===_.FIXED&&(o=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),o}},{key:"setScale",value:function(o){this._scale=Math.abs(o)}},{key:"interfaces_",get:function(){return[de,wt]}}],[{key:"constructor_",value:function(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=_.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof us){var o=arguments[0];this._modelType=o,o===_.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var u=arguments[0];this._modelType=_.FIXED,this.setScale(u)}else if(arguments[0]instanceof _){var g=arguments[0];this._modelType=g._modelType,this._scale=g._scale}}}},{key:"mostPrecise",value:function(o,u){return o.compareTo(u)>=0?o:u}}])})(),us=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"readResolve",value:function(){return _.nameToTypeMap.get(this._name)}},{key:"toString",value:function(){return this._name}},{key:"interfaces_",get:function(){return[de]}}],[{key:"constructor_",value:function(){this._name=null;var o=arguments[0];this._name=o,_.nameToTypeMap.put(o,this)}}])})();us.nameToTypeMap=new Ys,$r.Type=us,$r.FIXED=new us("FIXED"),$r.FLOATING=new us("FLOATING"),$r.FLOATING_SINGLE=new us("FLOATING SINGLE"),$r.maximumPreciseValue=9007199254740992;var Is=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"copyInternal",value:function(){for(var u=new Array(this._geometries.length).fill(null),g=0;g<u.length;g++)u[g]=this._geometries[g].copy();return new o(u,this._factory)}},{key:"equalsExact",value:function(){if(arguments.length===2&&typeof arguments[1]=="number"&&arguments[0]instanceof rn){var u=arguments[0],g=arguments[1];return!!this.isEquivalentClass(u)&&Ge(o,"equalsExact",this,1).call(this,u,g)}return Ge(o,"equalsExact",this,1).apply(this,arguments)}},{key:"getBoundaryDimension",value:function(){return this.isClosed()?Nt.FALSE:0}},{key:"isClosed",value:function(){if(this.isEmpty())return!1;for(var u=0;u<this._geometries.length;u++)if(!this._geometries[u].isClosed())return!1;return!0}},{key:"getTypeCode",value:function(){return rn.TYPECODE_MULTILINESTRING}},{key:"getDimension",value:function(){return 1}},{key:"getBoundary",value:function(){throw new Pn}},{key:"getGeometryType",value:function(){return rn.TYPENAME_MULTILINESTRING}},{key:"interfaces_",get:function(){return[Hi]}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];Ut.constructor_.call(this,u,g)}}])})(Ut),Wr=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"createEmpty",value:function(o){switch(o){case-1:return this.createGeometryCollection();case 0:return this.createPoint();case 1:return this.createLineString();case 2:return this.createPolygon();default:throw new At("Invalid dimension: "+o)}}},{key:"toGeometry",value:function(o){return o.isNull()?this.createPoint():o.getMinX()===o.getMaxX()&&o.getMinY()===o.getMaxY()?this.createPoint(new Qe(o.getMinX(),o.getMinY())):o.getMinX()===o.getMaxX()||o.getMinY()===o.getMaxY()?this.createLineString([new Qe(o.getMinX(),o.getMinY()),new Qe(o.getMaxX(),o.getMaxY())]):this.createPolygon(this.createLinearRing([new Qe(o.getMinX(),o.getMinY()),new Qe(o.getMinX(),o.getMaxY()),new Qe(o.getMaxX(),o.getMaxY()),new Qe(o.getMaxX(),o.getMinY()),new Qe(o.getMinX(),o.getMinY())]),null)}},{key:"createLineString",value:function(){if(arguments.length===0)return this.createLineString(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];return this.createLineString(o!==null?this.getCoordinateSequenceFactory().create(o):null)}if(dn(arguments[0],Se))return new ki(arguments[0],this)}}},{key:"createMultiLineString",value:function(){return arguments.length===0?new Is(null,this):arguments.length===1?new Is(arguments[0],this):void 0}},{key:"buildGeometry",value:function(o){for(var u=null,g=!1,M=!1,B=o.iterator();B.hasNext();){var G=B.next(),K=G.getTypeCode();u===null&&(u=K),K!==u&&(g=!0),G instanceof Ut&&(M=!0)}if(u===null)return this.createGeometryCollection();if(g||M)return this.createGeometryCollection(_.toGeometryArray(o));var le=o.iterator().next();if(o.size()>1){if(le instanceof _r)return this.createMultiPolygon(_.toPolygonArray(o));if(le instanceof ki)return this.createMultiLineString(_.toLineStringArray(o));if(le instanceof ji)return this.createMultiPoint(_.toPointArray(o));Ct.shouldNeverReachHere("Unhandled geometry type: "+le.getGeometryType())}return le}},{key:"createMultiPointFromCoords",value:function(o){return this.createMultiPoint(o!==null?this.getCoordinateSequenceFactory().create(o):null)}},{key:"createPoint",value:function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Qe){var o=arguments[0];return this.createPoint(o!==null?this.getCoordinateSequenceFactory().create([o]):null)}if(dn(arguments[0],Se))return new ji(arguments[0],this)}}},{key:"getCoordinateSequenceFactory",value:function(){return this._coordinateSequenceFactory}},{key:"createPolygon",value:function(){if(arguments.length===0)return this.createPolygon(null,null);if(arguments.length===1){if(dn(arguments[0],Se)){var o=arguments[0];return this.createPolygon(this.createLinearRing(o))}if(arguments[0]instanceof Array){var u=arguments[0];return this.createPolygon(this.createLinearRing(u))}if(arguments[0]instanceof Mn){var g=arguments[0];return this.createPolygon(g,null)}}else if(arguments.length===2)return new _r(arguments[0],arguments[1],this)}},{key:"getSRID",value:function(){return this._SRID}},{key:"createGeometryCollection",value:function(){return arguments.length===0?new Ut(null,this):arguments.length===1?new Ut(arguments[0],this):void 0}},{key:"getPrecisionModel",value:function(){return this._precisionModel}},{key:"createLinearRing",value:function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];return this.createLinearRing(o!==null?this.getCoordinateSequenceFactory().create(o):null)}if(dn(arguments[0],Se))return new Mn(arguments[0],this)}}},{key:"createMultiPolygon",value:function(){return arguments.length===0?new Er(null,this):arguments.length===1?new Er(arguments[0],this):void 0}},{key:"createMultiPoint",value:function(){if(arguments.length===0)return new Sn(null,this);if(arguments.length===1){if(arguments[0]instanceof Array)return new Sn(arguments[0],this);if(dn(arguments[0],Se)){var o=arguments[0];if(o===null)return this.createMultiPoint(new Array(0).fill(null));for(var u=new Array(o.size()).fill(null),g=0;g<o.size();g++){var M=this.getCoordinateSequenceFactory().create(1,o.getDimension(),o.getMeasures());xn.copy(o,g,M,0,1),u[g]=this.createPoint(M)}return this.createMultiPoint(u)}}}},{key:"interfaces_",get:function(){return[de]}}],[{key:"constructor_",value:function(){if(this._precisionModel=null,this._coordinateSequenceFactory=null,this._SRID=null,arguments.length===0)_.constructor_.call(this,new $r,0);else if(arguments.length===1){if(dn(arguments[0],Un)){var o=arguments[0];_.constructor_.call(this,new $r,0,o)}else if(arguments[0]instanceof $r){var u=arguments[0];_.constructor_.call(this,u,0,_.getDefaultCoordinateSequenceFactory())}}else if(arguments.length===2){var g=arguments[0],M=arguments[1];_.constructor_.call(this,g,M,_.getDefaultCoordinateSequenceFactory())}else if(arguments.length===3){var B=arguments[0],G=arguments[1],K=arguments[2];this._precisionModel=B,this._coordinateSequenceFactory=K,this._SRID=G}}},{key:"toMultiPolygonArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toGeometryArray",value:function(o){if(o===null)return null;var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"getDefaultCoordinateSequenceFactory",value:function(){return ho.instance()}},{key:"toMultiLineStringArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toLineStringArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toMultiPointArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toLinearRingArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toPointArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"toPolygonArray",value:function(o){var u=new Array(o.size()).fill(null);return o.toArray(u)}},{key:"createPointFromInternalCoord",value:function(o,u){return u.getPrecisionModel().makePrecise(o),u.getFactory().createPoint(o)}}])})(),Zo="XY",As="XYZ",qa="XYM",$n="XYZM",Yu={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"},Dc="EMPTY",ks=1,cs=2,Za=3,Lc=4,cr=5,nu=6;for(var Hu in Yu)Yu[Hu].toUpperCase();var iu=(function(){return c((function _(o){D(this,_),this.wkt=o,this.index_=-1}),[{key:"isAlpha_",value:function(_){return _>="a"&&_<="z"||_>="A"&&_<="Z"}},{key:"isNumeric_",value:function(_,o){return _>="0"&&_<="9"||_=="."&&!(o!==void 0&&o)}},{key:"isWhiteSpace_",value:function(_){return _==" "||_=="	"||_=="\r"||_==`
`}},{key:"nextChar_",value:function(){return this.wkt.charAt(++this.index_)}},{key:"nextToken",value:function(){var _,o=this.nextChar_(),u=this.index_,g=o;if(o=="(")_=cs;else if(o==",")_=cr;else if(o==")")_=Za;else if(this.isNumeric_(o)||o=="-")_=Lc,g=this.readNumber_();else if(this.isAlpha_(o))_=ks,g=this.readText_();else{if(this.isWhiteSpace_(o))return this.nextToken();if(o!=="")throw new Error("Unexpected character: "+o);_=nu}return{position:u,value:g,type:_}}},{key:"readNumber_",value:function(){var _,o=this.index_,u=!1,g=!1;do _=="."?u=!0:_!="e"&&_!="E"||(g=!0),_=this.nextChar_();while(this.isNumeric_(_,u)||!g&&(_=="e"||_=="E")||g&&(_=="-"||_=="+"));return parseFloat(this.wkt.substring(o,this.index_--))}},{key:"readText_",value:function(){var _,o=this.index_;do _=this.nextChar_();while(this.isAlpha_(_));return this.wkt.substring(o,this.index_--).toUpperCase()}}])})(),fo=(function(){return c((function _(o,u){D(this,_),this.lexer_=o,this.token_,this.layout_=Zo,this.factory=u}),[{key:"consume_",value:function(){this.token_=this.lexer_.nextToken()}},{key:"isTokenType",value:function(_){return this.token_.type==_}},{key:"match",value:function(_){var o=this.isTokenType(_);return o&&this.consume_(),o}},{key:"parse",value:function(){return this.consume_(),this.parseGeometry_()}},{key:"parseGeometryLayout_",value:function(){var _=Zo,o=this.token_;if(this.isTokenType(ks)){var u=o.value;u==="Z"?_=As:u==="M"?_=qa:u==="ZM"&&(_=$n),_!==Zo&&this.consume_()}return _}},{key:"parseGeometryCollectionText_",value:function(){if(this.match(cs)){var _=[];do _.push(this.parseGeometry_());while(this.match(cr));if(this.match(Za))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePointText_",value:function(){if(this.match(cs)){var _=this.parsePoint_();if(this.match(Za))return _}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())}},{key:"parseLineStringText_",value:function(){if(this.match(cs)){var _=this.parsePointList_();if(this.match(Za))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePolygonText_",value:function(){if(this.match(cs)){var _=this.parseLineStringTextList_();if(this.match(Za))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPointText_",value:function(){var _;if(this.match(cs)){if(_=this.token_.type==cs?this.parsePointTextList_():this.parsePointList_(),this.match(Za))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiLineStringText_",value:function(){if(this.match(cs)){var _=this.parseLineStringTextList_();if(this.match(Za))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parseMultiPolygonText_",value:function(){if(this.match(cs)){var _=this.parsePolygonTextList_();if(this.match(Za))return _}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())}},{key:"parsePoint_",value:function(){for(var _=[],o=this.layout_.length,u=0;u<o;++u){var g=this.token_;if(!this.match(Lc))break;_.push(g.value)}if(_.length==o)return _;throw new Error(this.formatErrorMessage_())}},{key:"parsePointList_",value:function(){for(var _=[this.parsePoint_()];this.match(cr);)_.push(this.parsePoint_());return _}},{key:"parsePointTextList_",value:function(){for(var _=[this.parsePointText_()];this.match(cr);)_.push(this.parsePointText_());return _}},{key:"parseLineStringTextList_",value:function(){for(var _=[this.parseLineStringText_()];this.match(cr);)_.push(this.parseLineStringText_());return _}},{key:"parsePolygonTextList_",value:function(){for(var _=[this.parsePolygonText_()];this.match(cr);)_.push(this.parsePolygonText_());return _}},{key:"isEmptyGeometry_",value:function(){var _=this.isTokenType(ks)&&this.token_.value==Dc;return _&&this.consume_(),_}},{key:"formatErrorMessage_",value:function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"}},{key:"parseGeometry_",value:function(){var _=this.factory,o=function(pn){return U(Qe,dt(pn))},u=function(pn){var Nn=pn.map((function(In){return _.createLinearRing(In.map(o))}));return Nn.length>1?_.createPolygon(Nn[0],Nn.slice(1)):_.createPolygon(Nn[0])},g=this.token_;if(this.match(ks)){var M=g.value;if(this.layout_=this.parseGeometryLayout_(),M=="GEOMETRYCOLLECTION"){var B=this.parseGeometryCollectionText_();return _.createGeometryCollection(B)}switch(M){case"POINT":var G=this.parsePointText_();return G?_.createPoint(U(Qe,dt(G))):_.createPoint();case"LINESTRING":var K=this.parseLineStringText_().map(o);return _.createLineString(K);case"LINEARRING":var le=this.parseLineStringText_().map(o);return _.createLinearRing(le);case"POLYGON":var _e=this.parsePolygonText_();return _e&&_e.length!==0?u(_e):_.createPolygon();case"MULTIPOINT":var Ke=this.parseMultiPointText_();if(!Ke||Ke.length===0)return _.createMultiPoint();var ct=Ke.map(o).map((function(pn){return _.createPoint(pn)}));return _.createMultiPoint(ct);case"MULTILINESTRING":var Bt=this.parseMultiLineStringText_().map((function(pn){return _.createLineString(pn.map(o))}));return _.createMultiLineString(Bt);case"MULTIPOLYGON":var Jt=this.parseMultiPolygonText_();if(!Jt||Jt.length===0)return _.createMultiPolygon();var sn=Jt.map(u);return _.createMultiPolygon(sn);default:throw new Error("Invalid geometry type: "+M)}}throw new Error(this.formatErrorMessage_())}}])})();function zc(_){if(_.isEmpty())return"";var o=_.getCoordinate(),u=[o.x,o.y];return o.z===void 0||Number.isNaN(o.z)||u.push(o.z),o.m===void 0||Number.isNaN(o.m)||u.push(o.m),u.join(" ")}function Ps(_){for(var o=_.getCoordinates().map((function(B){var G=[B.x,B.y];return B.z===void 0||Number.isNaN(B.z)||G.push(B.z),B.m===void 0||Number.isNaN(B.m)||G.push(B.m),G})),u=[],g=0,M=o.length;g<M;++g)u.push(o[g].join(" "));return u.join(", ")}function Rs(_){var o=[];o.push("("+Ps(_.getExteriorRing())+")");for(var u=0,g=_.getNumInteriorRing();u<g;++u)o.push("("+Ps(_.getInteriorRingN(u))+")");return o.join(", ")}var Eh={Point:zc,LineString:Ps,LinearRing:Ps,Polygon:Rs,MultiPoint:function(_){for(var o=[],u=0,g=_.getNumGeometries();u<g;++u)o.push("("+zc(_.getGeometryN(u))+")");return o.join(", ")},MultiLineString:function(_){for(var o=[],u=0,g=_.getNumGeometries();u<g;++u)o.push("("+Ps(_.getGeometryN(u))+")");return o.join(", ")},MultiPolygon:function(_){for(var o=[],u=0,g=_.getNumGeometries();u<g;++u)o.push("("+Rs(_.getGeometryN(u))+")");return o.join(", ")},GeometryCollection:function(_){for(var o=[],u=0,g=_.getNumGeometries();u<g;++u)o.push(po(_.getGeometryN(u)));return o.join(", ")}};function po(_){var o=_.getGeometryType(),u=Eh[o];o=o.toUpperCase();var g=(function(M){var B="";if(M.isEmpty())return B;var G=M.getCoordinate();return G.z===void 0||Number.isNaN(G.z)||(B+="Z"),G.m===void 0||Number.isNaN(G.m)||(B+="M"),B})(_);return g.length>0&&(o+=" "+g),_.isEmpty()?o+" "+Dc:o+" ("+u(_)+")"}var Xu=(function(){return c((function _(o){D(this,_),this.geometryFactory=o||new Wr,this.precisionModel=this.geometryFactory.getPrecisionModel()}),[{key:"read",value:function(_){var o=new iu(_);return new fo(o,this.geometryFactory).parse()}},{key:"write",value:function(_){return po(_)}}])})(),Hs=(function(){return c((function _(o){D(this,_),this.parser=new Xu(o)}),[{key:"write",value:function(_){return this.parser.write(_)}}],[{key:"toLineString",value:function(_,o){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+_.x+" "+_.y+", "+o.x+" "+o.y+" )"}}])})(),ri=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getIndexAlongSegment",value:function(o,u){return this.computeIntLineIndex(),this._intLineIndex[o][u]}},{key:"getTopologySummary",value:function(){var o=new ka;return this.isEndPoint()&&o.append(" endpoint"),this._isProper&&o.append(" proper"),this.isCollinear()&&o.append(" collinear"),o.toString()}},{key:"computeIntersection",value:function(o,u,g,M){this._inputLines[0][0]=o,this._inputLines[0][1]=u,this._inputLines[1][0]=g,this._inputLines[1][1]=M,this._result=this.computeIntersect(o,u,g,M)}},{key:"getIntersectionNum",value:function(){return this._result}},{key:"computeIntLineIndex",value:function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var o=arguments[0];this.getEdgeDistance(o,0)>this.getEdgeDistance(o,1)?(this._intLineIndex[o][0]=0,this._intLineIndex[o][1]=1):(this._intLineIndex[o][0]=1,this._intLineIndex[o][1]=0)}}},{key:"isProper",value:function(){return this.hasIntersection()&&this._isProper}},{key:"setPrecisionModel",value:function(o){this._precisionModel=o}},{key:"isInteriorIntersection",value:function(){if(arguments.length===0)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(arguments.length===1){for(var o=arguments[0],u=0;u<this._result;u++)if(!this._intPt[u].equals2D(this._inputLines[o][0])&&!this._intPt[u].equals2D(this._inputLines[o][1]))return!0;return!1}}},{key:"getIntersection",value:function(o){return this._intPt[o]}},{key:"isEndPoint",value:function(){return this.hasIntersection()&&!this._isProper}},{key:"hasIntersection",value:function(){return this._result!==_.NO_INTERSECTION}},{key:"getEdgeDistance",value:function(o,u){return _.computeEdgeDistance(this._intPt[u],this._inputLines[o][0],this._inputLines[o][1])}},{key:"isCollinear",value:function(){return this._result===_.COLLINEAR_INTERSECTION}},{key:"toString",value:function(){return Hs.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+Hs.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()}},{key:"getEndpoint",value:function(o,u){return this._inputLines[o][u]}},{key:"isIntersection",value:function(o){for(var u=0;u<this._result;u++)if(this._intPt[u].equals2D(o))return!0;return!1}},{key:"getIntersectionAlongSegment",value:function(o,u){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[o][u]]}}],[{key:"constructor_",value:function(){this._result=null,this._inputLines=Array(2).fill().map((function(){return Array(2)})),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new Qe,this._intPt[1]=new Qe,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0}},{key:"computeEdgeDistance",value:function(o,u,g){var M=Math.abs(g.x-u.x),B=Math.abs(g.y-u.y),G=-1;if(o.equals(u))G=0;else if(o.equals(g))G=M>B?M:B;else{var K=Math.abs(o.x-u.x),le=Math.abs(o.y-u.y);(G=M>B?K:le)!==0||o.equals(u)||(G=Math.max(K,le))}return Ct.isTrue(!(G===0&&!o.equals(u)),"Bad distance calculation"),G}},{key:"nonRobustComputeEdgeDistance",value:function(o,u,g){var M=o.x-u.x,B=o.y-u.y,G=Math.sqrt(M*M+B*B);return Ct.isTrue(!(G===0&&!o.equals(u)),"Invalid distance calculation"),G}}])})();ri.DONT_INTERSECT=0,ri.DO_INTERSECT=1,ri.COLLINEAR=2,ri.NO_INTERSECTION=0,ri.POINT_INTERSECTION=1,ri.COLLINEAR_INTERSECTION=2;var Ya=(function(_){function o(){return D(this,o),I(this,o)}return ie(o,_),c(o,[{key:"isInSegmentEnvelopes",value:function(u){var g=new Rn(this._inputLines[0][0],this._inputLines[0][1]),M=new Rn(this._inputLines[1][0],this._inputLines[1][1]);return g.contains(u)&&M.contains(u)}},{key:"computeIntersection",value:function(){if(arguments.length!==3)return Ge(o,"computeIntersection",this,1).apply(this,arguments);var u=arguments[0],g=arguments[1],M=arguments[2];if(this._isProper=!1,Rn.intersects(g,M,u)&&Ee.index(g,M,u)===0&&Ee.index(M,g,u)===0)return this._isProper=!0,(u.equals(g)||u.equals(M))&&(this._isProper=!1),this._result=ri.POINT_INTERSECTION,null;this._result=ri.NO_INTERSECTION}},{key:"intersection",value:function(u,g,M,B){var G=this.intersectionSafe(u,g,M,B);return this.isInSegmentEnvelopes(G)||(G=new Qe(o.nearestEndpoint(u,g,M,B))),this._precisionModel!==null&&this._precisionModel.makePrecise(G),G}},{key:"checkDD",value:function(u,g,M,B,G){var K=he.intersection(u,g,M,B),le=this.isInSegmentEnvelopes(K);Qt.out.println("DD in env = "+le+"  --------------------- "+K),G.distance(K)>1e-4&&Qt.out.println("Distance = "+G.distance(K))}},{key:"intersectionSafe",value:function(u,g,M,B){var G=Wt.intersection(u,g,M,B);return G===null&&(G=o.nearestEndpoint(u,g,M,B)),G}},{key:"computeCollinearIntersection",value:function(u,g,M,B){var G=Rn.intersects(u,g,M),K=Rn.intersects(u,g,B),le=Rn.intersects(M,B,u),_e=Rn.intersects(M,B,g);return G&&K?(this._intPt[0]=M,this._intPt[1]=B,ri.COLLINEAR_INTERSECTION):le&&_e?(this._intPt[0]=u,this._intPt[1]=g,ri.COLLINEAR_INTERSECTION):G&&le?(this._intPt[0]=M,this._intPt[1]=u,!M.equals(u)||K||_e?ri.COLLINEAR_INTERSECTION:ri.POINT_INTERSECTION):G&&_e?(this._intPt[0]=M,this._intPt[1]=g,!M.equals(g)||K||le?ri.COLLINEAR_INTERSECTION:ri.POINT_INTERSECTION):K&&le?(this._intPt[0]=B,this._intPt[1]=u,!B.equals(u)||G||_e?ri.COLLINEAR_INTERSECTION:ri.POINT_INTERSECTION):K&&_e?(this._intPt[0]=B,this._intPt[1]=g,!B.equals(g)||G||le?ri.COLLINEAR_INTERSECTION:ri.POINT_INTERSECTION):ri.NO_INTERSECTION}},{key:"computeIntersect",value:function(u,g,M,B){if(this._isProper=!1,!Rn.intersects(u,g,M,B))return ri.NO_INTERSECTION;var G=Ee.index(u,g,M),K=Ee.index(u,g,B);if(G>0&&K>0||G<0&&K<0)return ri.NO_INTERSECTION;var le=Ee.index(M,B,u),_e=Ee.index(M,B,g);return le>0&&_e>0||le<0&&_e<0?ri.NO_INTERSECTION:G===0&&K===0&&le===0&&_e===0?this.computeCollinearIntersection(u,g,M,B):(G===0||K===0||le===0||_e===0?(this._isProper=!1,u.equals2D(M)||u.equals2D(B)?this._intPt[0]=u:g.equals2D(M)||g.equals2D(B)?this._intPt[0]=g:G===0?this._intPt[0]=new Qe(M):K===0?this._intPt[0]=new Qe(B):le===0?this._intPt[0]=new Qe(u):_e===0&&(this._intPt[0]=new Qe(g))):(this._isProper=!0,this._intPt[0]=this.intersection(u,g,M,B)),ri.POINT_INTERSECTION)}}],[{key:"nearestEndpoint",value:function(u,g,M,B){var G=u,K=zn.pointToSegment(u,M,B),le=zn.pointToSegment(g,M,B);return le<K&&(K=le,G=g),(le=zn.pointToSegment(M,u,g))<K&&(K=le,G=M),(le=zn.pointToSegment(B,u,g))<K&&(K=le,G=B),G}}])})(ri),An=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"countSegment",value:function(o,u){if(o.x<this._p.x&&u.x<this._p.x)return null;if(this._p.x===u.x&&this._p.y===u.y)return this._isPointOnSegment=!0,null;if(o.y===this._p.y&&u.y===this._p.y){var g=o.x,M=u.x;return g>M&&(g=u.x,M=o.x),this._p.x>=g&&this._p.x<=M&&(this._isPointOnSegment=!0),null}if(o.y>this._p.y&&u.y<=this._p.y||u.y>this._p.y&&o.y<=this._p.y){var B=Ee.index(o,u,this._p);if(B===Ee.COLLINEAR)return this._isPointOnSegment=!0,null;u.y<o.y&&(B=-B),B===Ee.LEFT&&this._crossingCount++}}},{key:"isPointInPolygon",value:function(){return this.getLocation()!==Re.EXTERIOR}},{key:"getLocation",value:function(){return this._isPointOnSegment?Re.BOUNDARY:this._crossingCount%2==1?Re.INTERIOR:Re.EXTERIOR}},{key:"isOnSegment",value:function(){return this._isPointOnSegment}}],[{key:"constructor_",value:function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var o=arguments[0];this._p=o}},{key:"locatePointInRing",value:function(){if(arguments[0]instanceof Qe&&dn(arguments[1],Se)){for(var o=arguments[1],u=new _(arguments[0]),g=new Qe,M=new Qe,B=1;B<o.size();B++)if(o.getCoordinate(B,g),o.getCoordinate(B-1,M),u.countSegment(g,M),u.isOnSegment())return u.getLocation();return u.getLocation()}if(arguments[0]instanceof Qe&&arguments[1]instanceof Array){for(var G=arguments[1],K=new _(arguments[0]),le=1;le<G.length;le++){var _e=G[le],Ke=G[le-1];if(K.countSegment(_e,Ke),K.isOnSegment())return K.getLocation()}return K.getLocation()}}}])})(),Pa=(function(){function _(){D(this,_)}return c(_,null,[{key:"isOnLine",value:function(){if(arguments[0]instanceof Qe&&dn(arguments[1],Se)){for(var o=arguments[0],u=arguments[1],g=new Ya,M=new Qe,B=new Qe,G=u.size(),K=1;K<G;K++)if(u.getCoordinate(K-1,M),u.getCoordinate(K,B),g.computeIntersection(o,M,B),g.hasIntersection())return!0;return!1}if(arguments[0]instanceof Qe&&arguments[1]instanceof Array){for(var le=arguments[0],_e=arguments[1],Ke=new Ya,ct=1;ct<_e.length;ct++){var Bt=_e[ct-1],Jt=_e[ct];if(Ke.computeIntersection(le,Bt,Jt),Ke.hasIntersection())return!0}return!1}}},{key:"locateInRing",value:function(o,u){return An.locatePointInRing(o,u)}},{key:"isInRing",value:function(o,u){return _.locateInRing(o,u)!==Re.EXTERIOR}}])})(),ya=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"setAllLocations",value:function(o){for(var u=0;u<this.location.length;u++)this.location[u]=o}},{key:"isNull",value:function(){for(var o=0;o<this.location.length;o++)if(this.location[o]!==Re.NONE)return!1;return!0}},{key:"setAllLocationsIfNull",value:function(o){for(var u=0;u<this.location.length;u++)this.location[u]===Re.NONE&&(this.location[u]=o)}},{key:"isLine",value:function(){return this.location.length===1}},{key:"merge",value:function(o){if(o.location.length>this.location.length){var u=new Array(3).fill(null);u[Yt.ON]=this.location[Yt.ON],u[Yt.LEFT]=Re.NONE,u[Yt.RIGHT]=Re.NONE,this.location=u}for(var g=0;g<this.location.length;g++)this.location[g]===Re.NONE&&g<o.location.length&&(this.location[g]=o.location[g])}},{key:"getLocations",value:function(){return this.location}},{key:"flip",value:function(){if(this.location.length<=1)return null;var o=this.location[Yt.LEFT];this.location[Yt.LEFT]=this.location[Yt.RIGHT],this.location[Yt.RIGHT]=o}},{key:"toString",value:function(){var o=new Sr;return this.location.length>1&&o.append(Re.toLocationSymbol(this.location[Yt.LEFT])),o.append(Re.toLocationSymbol(this.location[Yt.ON])),this.location.length>1&&o.append(Re.toLocationSymbol(this.location[Yt.RIGHT])),o.toString()}},{key:"setLocations",value:function(o,u,g){this.location[Yt.ON]=o,this.location[Yt.LEFT]=u,this.location[Yt.RIGHT]=g}},{key:"get",value:function(o){return o<this.location.length?this.location[o]:Re.NONE}},{key:"isArea",value:function(){return this.location.length>1}},{key:"isAnyNull",value:function(){for(var o=0;o<this.location.length;o++)if(this.location[o]===Re.NONE)return!0;return!1}},{key:"setLocation",value:function(){if(arguments.length===1){var o=arguments[0];this.setLocation(Yt.ON,o)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.location[u]=g}}},{key:"init",value:function(o){this.location=new Array(o).fill(null),this.setAllLocations(Re.NONE)}},{key:"isEqualOnSide",value:function(o,u){return this.location[u]===o.location[u]}},{key:"allPositionsEqual",value:function(o){for(var u=0;u<this.location.length;u++)if(this.location[u]!==o)return!1;return!0}}],[{key:"constructor_",value:function(){if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var o=arguments[0];this.init(o.length)}else if(Number.isInteger(arguments[0])){var u=arguments[0];this.init(1),this.location[Yt.ON]=u}else if(arguments[0]instanceof _){var g=arguments[0];if(this.init(g.location.length),g!==null)for(var M=0;M<this.location.length;M++)this.location[M]=g.location[M]}}else if(arguments.length===3){var B=arguments[0],G=arguments[1],K=arguments[2];this.init(3),this.location[Yt.ON]=B,this.location[Yt.LEFT]=G,this.location[Yt.RIGHT]=K}}}])})(),Kr=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getGeometryCount",value:function(){var o=0;return this.elt[0].isNull()||o++,this.elt[1].isNull()||o++,o}},{key:"setAllLocations",value:function(o,u){this.elt[o].setAllLocations(u)}},{key:"isNull",value:function(o){return this.elt[o].isNull()}},{key:"setAllLocationsIfNull",value:function(){if(arguments.length===1){var o=arguments[0];this.setAllLocationsIfNull(0,o),this.setAllLocationsIfNull(1,o)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.elt[u].setAllLocationsIfNull(g)}}},{key:"isLine",value:function(o){return this.elt[o].isLine()}},{key:"merge",value:function(o){for(var u=0;u<2;u++)this.elt[u]===null&&o.elt[u]!==null?this.elt[u]=new ya(o.elt[u]):this.elt[u].merge(o.elt[u])}},{key:"flip",value:function(){this.elt[0].flip(),this.elt[1].flip()}},{key:"getLocation",value:function(){if(arguments.length===1){var o=arguments[0];return this.elt[o].get(Yt.ON)}if(arguments.length===2){var u=arguments[0],g=arguments[1];return this.elt[u].get(g)}}},{key:"toString",value:function(){var o=new Sr;return this.elt[0]!==null&&(o.append("A:"),o.append(this.elt[0].toString())),this.elt[1]!==null&&(o.append(" B:"),o.append(this.elt[1].toString())),o.toString()}},{key:"isArea",value:function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var o=arguments[0];return this.elt[o].isArea()}}},{key:"isAnyNull",value:function(o){return this.elt[o].isAnyNull()}},{key:"setLocation",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];this.elt[o].setLocation(Yt.ON,u)}else if(arguments.length===3){var g=arguments[0],M=arguments[1],B=arguments[2];this.elt[g].setLocation(M,B)}}},{key:"isEqualOnSide",value:function(o,u){return this.elt[0].isEqualOnSide(o.elt[0],u)&&this.elt[1].isEqualOnSide(o.elt[1],u)}},{key:"allPositionsEqual",value:function(o,u){return this.elt[o].allPositionsEqual(u)}},{key:"toLine",value:function(o){this.elt[o].isArea()&&(this.elt[o]=new ya(this.elt[o].location[0]))}}],[{key:"constructor_",value:function(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var o=arguments[0];this.elt[0]=new ya(o),this.elt[1]=new ya(o)}else if(arguments[0]instanceof _){var u=arguments[0];this.elt[0]=new ya(u.elt[0]),this.elt[1]=new ya(u.elt[1])}}else if(arguments.length===2){var g=arguments[0],M=arguments[1];this.elt[0]=new ya(Re.NONE),this.elt[1]=new ya(Re.NONE),this.elt[g].setLocation(M)}else if(arguments.length===3){var B=arguments[0],G=arguments[1],K=arguments[2];this.elt[0]=new ya(B,G,K),this.elt[1]=new ya(B,G,K)}else if(arguments.length===4){var le=arguments[0],_e=arguments[1],Ke=arguments[2],ct=arguments[3];this.elt[0]=new ya(Re.NONE,Re.NONE,Re.NONE),this.elt[1]=new ya(Re.NONE,Re.NONE,Re.NONE),this.elt[le].setLocations(_e,Ke,ct)}}},{key:"toLineLabel",value:function(o){for(var u=new _(Re.NONE),g=0;g<2;g++)u.setLocation(g,o.getLocation(g));return u}}])})(),$i=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"computeRing",value:function(){if(this._ring!==null)return null;for(var _=new Array(this._pts.size()).fill(null),o=0;o<this._pts.size();o++)_[o]=this._pts.get(o);this._ring=this._geometryFactory.createLinearRing(_),this._isHole=Ee.isCCW(this._ring.getCoordinates())}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"computePoints",value:function(_){this._startDe=_;var o=_,u=!0;do{if(o===null)throw new Je("Found null DirectedEdge");if(o.getEdgeRing()===this)throw new Je("Directed Edge visited twice during ring-building at "+o.getCoordinate());this._edges.add(o);var g=o.getLabel();Ct.isTrue(g.isArea()),this.mergeLabel(g),this.addPoints(o.getEdge(),o.isForward(),u),u=!1,this.setEdgeRing(o,this),o=this.getNext(o)}while(o!==this._startDe)}},{key:"getLinearRing",value:function(){return this._ring}},{key:"getCoordinate",value:function(_){return this._pts.get(_)}},{key:"computeMaxNodeDegree",value:function(){this._maxNodeDegree=0;var _=this._startDe;do{var o=_.getNode().getEdges().getOutgoingDegree(this);o>this._maxNodeDegree&&(this._maxNodeDegree=o),_=this.getNext(_)}while(_!==this._startDe);this._maxNodeDegree*=2}},{key:"addPoints",value:function(_,o,u){var g=_.getCoordinates();if(o){var M=1;u&&(M=0);for(var B=M;B<g.length;B++)this._pts.add(g[B])}else{var G=g.length-2;u&&(G=g.length-1);for(var K=G;K>=0;K--)this._pts.add(g[K])}}},{key:"isHole",value:function(){return this._isHole}},{key:"setInResult",value:function(){var _=this._startDe;do _.getEdge().setInResult(!0),_=_.getNext();while(_!==this._startDe)}},{key:"containsPoint",value:function(_){var o=this.getLinearRing();if(!o.getEnvelopeInternal().contains(_)||!Pa.isInRing(_,o.getCoordinates()))return!1;for(var u=this._holes.iterator();u.hasNext();)if(u.next().containsPoint(_))return!1;return!0}},{key:"addHole",value:function(_){this._holes.add(_)}},{key:"isShell",value:function(){return this._shell===null}},{key:"getLabel",value:function(){return this._label}},{key:"getEdges",value:function(){return this._edges}},{key:"getMaxNodeDegree",value:function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree}},{key:"getShell",value:function(){return this._shell}},{key:"mergeLabel",value:function(){if(arguments.length===1){var _=arguments[0];this.mergeLabel(_,0),this.mergeLabel(_,1)}else if(arguments.length===2){var o=arguments[1],u=arguments[0].getLocation(o,Yt.RIGHT);if(u===Re.NONE)return null;if(this._label.getLocation(o)===Re.NONE)return this._label.setLocation(o,u),null}}},{key:"setShell",value:function(_){this._shell=_,_!==null&&_.addHole(this)}},{key:"toPolygon",value:function(_){for(var o=new Array(this._holes.size()).fill(null),u=0;u<this._holes.size();u++)o[u]=this._holes.get(u).getLinearRing();return _.createPolygon(this.getLinearRing(),o)}}],[{key:"constructor_",value:function(){if(this._startDe=null,this._maxNodeDegree=-1,this._edges=new Ze,this._pts=new Ze,this._label=new Kr(Re.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Ze,this._geometryFactory=null,arguments.length!==0){if(arguments.length===2){var _=arguments[0],o=arguments[1];this._geometryFactory=o,this.computePoints(_),this.computeRing()}}}}])})(),ir=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"setEdgeRing",value:function(u,g){u.setMinEdgeRing(g)}},{key:"getNext",value:function(u){return u.getNextMin()}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];$i.constructor_.call(this,u,g)}}])})($i),Di=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"buildMinimalRings",value:function(){var u=new Ze,g=this._startDe;do{if(g.getMinEdgeRing()===null){var M=new ir(g,this._geometryFactory);u.add(M)}g=g.getNext()}while(g!==this._startDe);return u}},{key:"setEdgeRing",value:function(u,g){u.setEdgeRing(g)}},{key:"linkDirectedEdgesForMinimalEdgeRings",value:function(){var u=this._startDe;do u.getNode().getEdges().linkMinimalDirectedEdges(this),u=u.getNext();while(u!==this._startDe)}},{key:"getNext",value:function(u){return u.getNext()}}],[{key:"constructor_",value:function(){var u=arguments[0],g=arguments[1];$i.constructor_.call(this,u,g)}}])})($i),vn=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"setVisited",value:function(_){this._isVisited=_}},{key:"setInResult",value:function(_){this._isInResult=_}},{key:"isCovered",value:function(){return this._isCovered}},{key:"isCoveredSet",value:function(){return this._isCoveredSet}},{key:"setLabel",value:function(_){this._label=_}},{key:"getLabel",value:function(){return this._label}},{key:"setCovered",value:function(_){this._isCovered=_,this._isCoveredSet=!0}},{key:"updateIM",value:function(_){Ct.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(_)}},{key:"isInResult",value:function(){return this._isInResult}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0){if(arguments.length===1){var _=arguments[0];this._label=_}}}}])})(),ei=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"isIncidentEdgeInResult",value:function(){for(var u=this.getEdges().getEdges().iterator();u.hasNext();)if(u.next().getEdge().isInResult())return!0;return!1}},{key:"isIsolated",value:function(){return this._label.getGeometryCount()===1}},{key:"getCoordinate",value:function(){return this._coord}},{key:"print",value:function(u){u.println("node "+this._coord+" lbl: "+this._label)}},{key:"computeIM",value:function(u){}},{key:"computeMergedLocation",value:function(u,g){var M=Re.NONE;if(M=this._label.getLocation(g),!u.isNull(g)){var B=u.getLocation(g);M!==Re.BOUNDARY&&(M=B)}return M}},{key:"setLabel",value:function(){if(arguments.length!==2||!Number.isInteger(arguments[1])||!Number.isInteger(arguments[0]))return Ge(o,"setLabel",this,1).apply(this,arguments);var u=arguments[0],g=arguments[1];this._label===null?this._label=new Kr(u,g):this._label.setLocation(u,g)}},{key:"getEdges",value:function(){return this._edges}},{key:"mergeLabel",value:function(){if(arguments[0]instanceof o){var u=arguments[0];this.mergeLabel(u._label)}else if(arguments[0]instanceof Kr)for(var g=arguments[0],M=0;M<2;M++){var B=this.computeMergedLocation(g,M);this._label.getLocation(M)===Re.NONE&&this._label.setLocation(M,B)}}},{key:"add",value:function(u){this._edges.insert(u),u.setNode(this)}},{key:"setLabelBoundary",value:function(u){if(this._label===null)return null;var g=Re.NONE;this._label!==null&&(g=this._label.getLocation(u));var M=null;switch(g){case Re.BOUNDARY:M=Re.INTERIOR;break;case Re.INTERIOR:default:M=Re.BOUNDARY}this._label.setLocation(u,M)}}],[{key:"constructor_",value:function(){this._coord=null,this._edges=null;var u=arguments[0],g=arguments[1];this._coord=u,this._edges=g,this._label=new Kr(0,Re.NONE)}}])})(vn),Ha=(function(_){function o(){return D(this,o),I(this,o,arguments)}return ie(o,_),c(o)})(Vn);function Ni(_){return _==null?0:_.color}function kn(_){return _==null?null:_.parent}function mi(_,o){_!==null&&(_.color=o)}function ca(_){return _==null?null:_.left}function hs(_){return _==null?null:_.right}var ci=(function(_){function o(){var u;return D(this,o),(u=I(this,o)).root_=null,u.size_=0,u}return ie(o,_),c(o,[{key:"get",value:function(u){for(var g=this.root_;g!==null;){var M=u.compareTo(g.key);if(M<0)g=g.left;else{if(!(M>0))return g.value;g=g.right}}return null}},{key:"put",value:function(u,g){if(this.root_===null)return this.root_={key:u,value:g,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var M,B,G=this.root_;do if(M=G,(B=u.compareTo(G.key))<0)G=G.left;else{if(!(B>0)){var K=G.value;return G.value=g,K}G=G.right}while(G!==null);var le={key:u,left:null,right:null,value:g,parent:M,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return B<0?M.left=le:M.right=le,this.fixAfterInsertion(le),this.size_++,null}},{key:"fixAfterInsertion",value:function(u){var g;for(u.color=1;u!=null&&u!==this.root_&&u.parent.color===1;)kn(u)===ca(kn(kn(u)))?Ni(g=hs(kn(kn(u))))===1?(mi(kn(u),0),mi(g,0),mi(kn(kn(u)),1),u=kn(kn(u))):(u===hs(kn(u))&&(u=kn(u),this.rotateLeft(u)),mi(kn(u),0),mi(kn(kn(u)),1),this.rotateRight(kn(kn(u)))):Ni(g=ca(kn(kn(u))))===1?(mi(kn(u),0),mi(g,0),mi(kn(kn(u)),1),u=kn(kn(u))):(u===ca(kn(u))&&(u=kn(u),this.rotateRight(u)),mi(kn(u),0),mi(kn(kn(u)),1),this.rotateLeft(kn(kn(u))));this.root_.color=0}},{key:"values",value:function(){var u=new Ze,g=this.getFirstEntry();if(g!==null)for(u.add(g.value);(g=o.successor(g))!==null;)u.add(g.value);return u}},{key:"entrySet",value:function(){var u=new Ri,g=this.getFirstEntry();if(g!==null)for(u.add(g);(g=o.successor(g))!==null;)u.add(g);return u}},{key:"rotateLeft",value:function(u){if(u!=null){var g=u.right;u.right=g.left,g.left!=null&&(g.left.parent=u),g.parent=u.parent,u.parent==null?this.root_=g:u.parent.left===u?u.parent.left=g:u.parent.right=g,g.left=u,u.parent=g}}},{key:"rotateRight",value:function(u){if(u!=null){var g=u.left;u.left=g.right,g.right!=null&&(g.right.parent=u),g.parent=u.parent,u.parent==null?this.root_=g:u.parent.right===u?u.parent.right=g:u.parent.left=g,g.right=u,u.parent=g}}},{key:"getFirstEntry",value:function(){var u=this.root_;if(u!=null)for(;u.left!=null;)u=u.left;return u}},{key:"size",value:function(){return this.size_}},{key:"containsKey",value:function(u){for(var g=this.root_;g!==null;){var M=u.compareTo(g.key);if(M<0)g=g.left;else{if(!(M>0))return!0;g=g.right}}return!1}}],[{key:"successor",value:function(u){var g;if(u===null)return null;if(u.right!==null){for(g=u.right;g.left!==null;)g=g.left;return g}g=u.parent;for(var M=u;g!==null&&M===g.right;)M=g,g=g.parent;return g}}])})(Ha),Xs=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"find",value:function(_){return this.nodeMap.get(_)}},{key:"addNode",value:function(){if(arguments[0]instanceof Qe){var _=arguments[0],o=this.nodeMap.get(_);return o===null&&(o=this.nodeFact.createNode(_),this.nodeMap.put(_,o)),o}if(arguments[0]instanceof ei){var u=arguments[0],g=this.nodeMap.get(u.getCoordinate());return g===null?(this.nodeMap.put(u.getCoordinate(),u),u):(g.mergeLabel(u),g)}}},{key:"print",value:function(_){for(var o=this.iterator();o.hasNext();)o.next().print(_)}},{key:"iterator",value:function(){return this.nodeMap.values().iterator()}},{key:"values",value:function(){return this.nodeMap.values()}},{key:"getBoundaryNodes",value:function(_){for(var o=new Ze,u=this.iterator();u.hasNext();){var g=u.next();g.getLabel().getLocation(_)===Re.BOUNDARY&&o.add(g)}return o}},{key:"add",value:function(_){var o=_.getCoordinate();this.addNode(o).add(_)}}],[{key:"constructor_",value:function(){this.nodeMap=new ci,this.nodeFact=null;var _=arguments[0];this.nodeFact=_}}])})(),Si=(function(){function _(){D(this,_)}return c(_,null,[{key:"isNorthern",value:function(o){return o===_.NE||o===_.NW}},{key:"isOpposite",value:function(o,u){return o!==u&&(o-u+4)%4===2}},{key:"commonHalfPlane",value:function(o,u){if(o===u)return o;if((o-u+4)%4===2)return-1;var g=o<u?o:u;return g===0&&(o>u?o:u)===3?3:g}},{key:"isInHalfPlane",value:function(o,u){return u===_.SE?o===_.SE||o===_.SW:o===u||o===u+1}},{key:"quadrant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],u=arguments[1];if(o===0&&u===0)throw new At("Cannot compute the quadrant for point ( "+o+", "+u+" )");return o>=0?u>=0?_.NE:_.SE:u>=0?_.NW:_.SW}if(arguments[0]instanceof Qe&&arguments[1]instanceof Qe){var g=arguments[0],M=arguments[1];if(M.x===g.x&&M.y===g.y)throw new At("Cannot compute the quadrant for two identical points "+g);return M.x>=g.x?M.y>=g.y?_.NE:_.SE:M.y>=g.y?_.NW:_.SW}}}])})();Si.NE=0,Si.NW=1,Si.SW=2,Si.SE=3;var mo=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"compareDirection",value:function(o){return this._dx===o._dx&&this._dy===o._dy?0:this._quadrant>o._quadrant?1:this._quadrant<o._quadrant?-1:Ee.index(o._p0,o._p1,this._p1)}},{key:"getDy",value:function(){return this._dy}},{key:"getCoordinate",value:function(){return this._p0}},{key:"setNode",value:function(o){this._node=o}},{key:"print",value:function(o){var u=Math.atan2(this._dy,this._dx),g=this.getClass().getName(),M=g.lastIndexOf("."),B=g.substring(M+1);o.print("  "+B+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+u+"   "+this._label)}},{key:"compareTo",value:function(o){var u=o;return this.compareDirection(u)}},{key:"getDirectedCoordinate",value:function(){return this._p1}},{key:"getDx",value:function(){return this._dx}},{key:"getLabel",value:function(){return this._label}},{key:"getEdge",value:function(){return this._edge}},{key:"getQuadrant",value:function(){return this._quadrant}},{key:"getNode",value:function(){return this._node}},{key:"toString",value:function(){var o=Math.atan2(this._dy,this._dx),u=this.getClass().getName(),g=u.lastIndexOf(".");return"  "+u.substring(g+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+o+"   "+this._label}},{key:"computeLabel",value:function(o){}},{key:"init",value:function(o,u){this._p0=o,this._p1=u,this._dx=u.x-o.x,this._dy=u.y-o.y,this._quadrant=Si.quadrant(this._dx,this._dy),Ct.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var o=arguments[0];this._edge=o}else if(arguments.length===3){var u=arguments[0],g=arguments[1],M=arguments[2];_.constructor_.call(this,u,g,M,null)}else if(arguments.length===4){var B=arguments[0],G=arguments[1],K=arguments[2],le=arguments[3];_.constructor_.call(this,B),this.init(G,K),this._label=le}}}])})(),Br=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"getNextMin",value:function(){return this._nextMin}},{key:"getDepth",value:function(u){return this._depth[u]}},{key:"setVisited",value:function(u){this._isVisited=u}},{key:"computeDirectedLabel",value:function(){this._label=new Kr(this._edge.getLabel()),this._isForward||this._label.flip()}},{key:"getNext",value:function(){return this._next}},{key:"setDepth",value:function(u,g){if(this._depth[u]!==-999&&this._depth[u]!==g)throw new Je("assigned depths do not match",this.getCoordinate());this._depth[u]=g}},{key:"isInteriorAreaEdge",value:function(){for(var u=!0,g=0;g<2;g++)this._label.isArea(g)&&this._label.getLocation(g,Yt.LEFT)===Re.INTERIOR&&this._label.getLocation(g,Yt.RIGHT)===Re.INTERIOR||(u=!1);return u}},{key:"setNextMin",value:function(u){this._nextMin=u}},{key:"print",value:function(u){Ge(o,"print",this,1).call(this,u),u.print(" "+this._depth[Yt.LEFT]+"/"+this._depth[Yt.RIGHT]),u.print(" ("+this.getDepthDelta()+")"),this._isInResult&&u.print(" inResult")}},{key:"setMinEdgeRing",value:function(u){this._minEdgeRing=u}},{key:"isLineEdge",value:function(){var u=this._label.isLine(0)||this._label.isLine(1),g=!this._label.isArea(0)||this._label.allPositionsEqual(0,Re.EXTERIOR),M=!this._label.isArea(1)||this._label.allPositionsEqual(1,Re.EXTERIOR);return u&&g&&M}},{key:"setEdgeRing",value:function(u){this._edgeRing=u}},{key:"getMinEdgeRing",value:function(){return this._minEdgeRing}},{key:"getDepthDelta",value:function(){var u=this._edge.getDepthDelta();return this._isForward||(u=-u),u}},{key:"setInResult",value:function(u){this._isInResult=u}},{key:"getSym",value:function(){return this._sym}},{key:"isForward",value:function(){return this._isForward}},{key:"getEdge",value:function(){return this._edge}},{key:"printEdge",value:function(u){this.print(u),u.print(" "),this._isForward?this._edge.print(u):this._edge.printReverse(u)}},{key:"setSym",value:function(u){this._sym=u}},{key:"setVisitedEdge",value:function(u){this.setVisited(u),this._sym.setVisited(u)}},{key:"setEdgeDepths",value:function(u,g){var M=this.getEdge().getDepthDelta();this._isForward||(M=-M);var B=1;u===Yt.LEFT&&(B=-1);var G=Yt.opposite(u),K=g+M*B;this.setDepth(u,g),this.setDepth(G,K)}},{key:"getEdgeRing",value:function(){return this._edgeRing}},{key:"isInResult",value:function(){return this._isInResult}},{key:"setNext",value:function(u){this._next=u}},{key:"isVisited",value:function(){return this._isVisited}}],[{key:"constructor_",value:function(){this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999];var u=arguments[0],g=arguments[1];if(mo.constructor_.call(this,u),this._isForward=g,g)this.init(u.getCoordinate(0),u.getCoordinate(1));else{var M=u.getNumPoints()-1;this.init(u.getCoordinate(M),u.getCoordinate(M-1))}this.computeDirectedLabel()}},{key:"depthFactor",value:function(u,g){return u===Re.EXTERIOR&&g===Re.INTERIOR?1:u===Re.INTERIOR&&g===Re.EXTERIOR?-1:0}}])})(mo),rr=(function(){return c((function _(){D(this,_)}),[{key:"createNode",value:function(_){return new ei(_,null)}}])})(),Qr=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"printEdges",value:function(_){_.println("Edges:");for(var o=0;o<this._edges.size();o++){_.println("edge "+o+":");var u=this._edges.get(o);u.print(_),u.eiList.print(_)}}},{key:"find",value:function(_){return this._nodes.find(_)}},{key:"addNode",value:function(){if(arguments[0]instanceof ei){var _=arguments[0];return this._nodes.addNode(_)}if(arguments[0]instanceof Qe){var o=arguments[0];return this._nodes.addNode(o)}}},{key:"getNodeIterator",value:function(){return this._nodes.iterator()}},{key:"linkResultDirectedEdges",value:function(){for(var _=this._nodes.iterator();_.hasNext();)_.next().getEdges().linkResultDirectedEdges()}},{key:"debugPrintln",value:function(_){Qt.out.println(_)}},{key:"isBoundaryNode",value:function(_,o){var u=this._nodes.find(o);if(u===null)return!1;var g=u.getLabel();return g!==null&&g.getLocation(_)===Re.BOUNDARY}},{key:"linkAllDirectedEdges",value:function(){for(var _=this._nodes.iterator();_.hasNext();)_.next().getEdges().linkAllDirectedEdges()}},{key:"matchInSameDirection",value:function(_,o,u,g){return!!_.equals(u)&&Ee.index(_,o,g)===Ee.COLLINEAR&&Si.quadrant(_,o)===Si.quadrant(u,g)}},{key:"getEdgeEnds",value:function(){return this._edgeEndList}},{key:"debugPrint",value:function(_){Qt.out.print(_)}},{key:"getEdgeIterator",value:function(){return this._edges.iterator()}},{key:"findEdgeInSameDirection",value:function(_,o){for(var u=0;u<this._edges.size();u++){var g=this._edges.get(u),M=g.getCoordinates();if(this.matchInSameDirection(_,o,M[0],M[1])||this.matchInSameDirection(_,o,M[M.length-1],M[M.length-2]))return g}return null}},{key:"insertEdge",value:function(_){this._edges.add(_)}},{key:"findEdgeEnd",value:function(_){for(var o=this.getEdgeEnds().iterator();o.hasNext();){var u=o.next();if(u.getEdge()===_)return u}return null}},{key:"addEdges",value:function(_){for(var o=_.iterator();o.hasNext();){var u=o.next();this._edges.add(u);var g=new Br(u,!0),M=new Br(u,!1);g.setSym(M),M.setSym(g),this.add(g),this.add(M)}}},{key:"add",value:function(_){this._nodes.add(_),this._edgeEndList.add(_)}},{key:"getNodes",value:function(){return this._nodes.values()}},{key:"findEdge",value:function(_,o){for(var u=0;u<this._edges.size();u++){var g=this._edges.get(u),M=g.getCoordinates();if(_.equals(M[0])&&o.equals(M[1]))return g}return null}}],[{key:"constructor_",value:function(){if(this._edges=new Ze,this._nodes=null,this._edgeEndList=new Ze,arguments.length===0)this._nodes=new Xs(new rr);else if(arguments.length===1){var _=arguments[0];this._nodes=new Xs(_)}}},{key:"linkResultDirectedEdges",value:function(_){for(var o=_.iterator();o.hasNext();)o.next().getEdges().linkResultDirectedEdges()}}])})(),ru=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"sortShellsAndHoles",value:function(o,u,g){for(var M=o.iterator();M.hasNext();){var B=M.next();B.isHole()?g.add(B):u.add(B)}}},{key:"computePolygons",value:function(o){for(var u=new Ze,g=o.iterator();g.hasNext();){var M=g.next().toPolygon(this._geometryFactory);u.add(M)}return u}},{key:"placeFreeHoles",value:function(o,u){for(var g=u.iterator();g.hasNext();){var M=g.next();if(M.getShell()===null){var B=_.findEdgeRingContaining(M,o);if(B===null)throw new Je("unable to assign hole to a shell",M.getCoordinate(0));M.setShell(B)}}}},{key:"buildMinimalEdgeRings",value:function(o,u,g){for(var M=new Ze,B=o.iterator();B.hasNext();){var G=B.next();if(G.getMaxNodeDegree()>2){G.linkDirectedEdgesForMinimalEdgeRings();var K=G.buildMinimalRings(),le=this.findShell(K);le!==null?(this.placePolygonHoles(le,K),u.add(le)):g.addAll(K)}else M.add(G)}return M}},{key:"buildMaximalEdgeRings",value:function(o){for(var u=new Ze,g=o.iterator();g.hasNext();){var M=g.next();if(M.isInResult()&&M.getLabel().isArea()&&M.getEdgeRing()===null){var B=new Di(M,this._geometryFactory);u.add(B),B.setInResult()}}return u}},{key:"placePolygonHoles",value:function(o,u){for(var g=u.iterator();g.hasNext();){var M=g.next();M.isHole()&&M.setShell(o)}}},{key:"getPolygons",value:function(){return this.computePolygons(this._shellList)}},{key:"findShell",value:function(o){for(var u=0,g=null,M=o.iterator();M.hasNext();){var B=M.next();B.isHole()||(g=B,u++)}return Ct.isTrue(u<=1,"found two shells in MinimalEdgeRing list"),g}},{key:"add",value:function(){if(arguments.length===1){var o=arguments[0];this.add(o.getEdgeEnds(),o.getNodes())}else if(arguments.length===2){var u=arguments[0],g=arguments[1];Qr.linkResultDirectedEdges(g);var M=this.buildMaximalEdgeRings(u),B=new Ze,G=this.buildMinimalEdgeRings(M,this._shellList,B);this.sortShellsAndHoles(G,this._shellList,B),this.placeFreeHoles(this._shellList,B)}}}],[{key:"constructor_",value:function(){this._geometryFactory=null,this._shellList=new Ze;var o=arguments[0];this._geometryFactory=o}},{key:"findEdgeRingContaining",value:function(o,u){for(var g=o.getLinearRing(),M=g.getEnvelopeInternal(),B=g.getCoordinateN(0),G=null,K=null,le=u.iterator();le.hasNext();){var _e=le.next(),Ke=_e.getLinearRing(),ct=Ke.getEnvelopeInternal();if(!ct.equals(M)&&ct.contains(M)){B=pi.ptNotInList(g.getCoordinates(),Ke.getCoordinates());var Bt=!1;Pa.isInRing(B,Ke.getCoordinates())&&(Bt=!0),Bt&&(G===null||K.contains(ct))&&(K=(G=_e).getLinearRing().getEnvelopeInternal())}}return G}}])})(),go=(function(){return c((function _(){D(this,_)}),[{key:"getBounds",value:function(){}}])})(),ha=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"getItem",value:function(){return this._item}},{key:"getBounds",value:function(){return this._bounds}},{key:"interfaces_",get:function(){return[go,de]}}],[{key:"constructor_",value:function(){this._bounds=null,this._item=null;var _=arguments[0],o=arguments[1];this._bounds=_,this._item=o}}])})(),Qn=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"poll",value:function(){if(this.isEmpty())return null;var _=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),_}},{key:"size",value:function(){return this._size}},{key:"reorder",value:function(_){for(var o=null,u=this._items.get(_);2*_<=this._size&&((o=2*_)!==this._size&&this._items.get(o+1).compareTo(this._items.get(o))<0&&o++,this._items.get(o).compareTo(u)<0);_=o)this._items.set(_,this._items.get(o));this._items.set(_,u)}},{key:"clear",value:function(){this._size=0,this._items.clear()}},{key:"peek",value:function(){return this.isEmpty()?null:this._items.get(1)}},{key:"isEmpty",value:function(){return this._size===0}},{key:"add",value:function(_){this._items.add(null),this._size+=1;var o=this._size;for(this._items.set(0,_);_.compareTo(this._items.get(Math.trunc(o/2)))<0;o/=2)this._items.set(o,this._items.get(Math.trunc(o/2)));this._items.set(o,_)}}],[{key:"constructor_",value:function(){this._size=null,this._items=null,this._size=0,this._items=new Ze,this._items.add(null)}}])})(),_o=(function(){return c((function _(){D(this,_)}),[{key:"insert",value:function(_,o){}},{key:"remove",value:function(_,o){}},{key:"query",value:function(){}}])})(),Tn=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"getLevel",value:function(){return this._level}},{key:"size",value:function(){return this._childBoundables.size()}},{key:"getChildBoundables",value:function(){return this._childBoundables}},{key:"addChildBoundable",value:function(_){Ct.isTrue(this._bounds===null),this._childBoundables.add(_)}},{key:"isEmpty",value:function(){return this._childBoundables.isEmpty()}},{key:"getBounds",value:function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds}},{key:"interfaces_",get:function(){return[go,de]}}],[{key:"constructor_",value:function(){if(this._childBoundables=new Ze,this._bounds=null,this._level=null,arguments.length!==0){if(arguments.length===1){var _=arguments[0];this._level=_}}}}])})(),bn={reverseOrder:function(){return{compare:function(_,o){return o.compareTo(_)}}},min:function(_){return bn.sort(_),_.get(0)},sort:function(_,o){var u=_.toArray();o?Aa.sort(u,o):Aa.sort(u);for(var g=_.iterator(),M=0,B=u.length;M<B;M++)g.next(),g.set(u[M])},singletonList:function(_){var o=new Ze;return o.add(_),o}},Yo=(function(){function _(){D(this,_)}return c(_,null,[{key:"maxDistance",value:function(o,u,g,M,B,G,K,le){var _e=_.distance(o,u,B,G);return _e=Math.max(_e,_.distance(o,u,K,le)),_e=Math.max(_e,_.distance(g,M,B,G)),_e=Math.max(_e,_.distance(g,M,K,le))}},{key:"distance",value:function(o,u,g,M){var B=g-o,G=M-u;return Math.sqrt(B*B+G*G)}},{key:"maximumDistance",value:function(o,u){var g=Math.min(o.getMinX(),u.getMinX()),M=Math.min(o.getMinY(),u.getMinY()),B=Math.max(o.getMaxX(),u.getMaxX()),G=Math.max(o.getMaxY(),u.getMaxY());return _.distance(g,M,B,G)}},{key:"minMaxDistance",value:function(o,u){var g=o.getMinX(),M=o.getMinY(),B=o.getMaxX(),G=o.getMaxY(),K=u.getMinX(),le=u.getMinY(),_e=u.getMaxX(),Ke=u.getMaxY(),ct=_.maxDistance(g,M,g,G,K,le,K,Ke);return ct=Math.min(ct,_.maxDistance(g,M,g,G,K,le,_e,le)),ct=Math.min(ct,_.maxDistance(g,M,g,G,_e,Ke,K,Ke)),ct=Math.min(ct,_.maxDistance(g,M,g,G,_e,Ke,_e,le)),ct=Math.min(ct,_.maxDistance(g,M,B,M,K,le,K,Ke)),ct=Math.min(ct,_.maxDistance(g,M,B,M,K,le,_e,le)),ct=Math.min(ct,_.maxDistance(g,M,B,M,_e,Ke,K,Ke)),ct=Math.min(ct,_.maxDistance(g,M,B,M,_e,Ke,_e,le)),ct=Math.min(ct,_.maxDistance(B,G,g,G,K,le,K,Ke)),ct=Math.min(ct,_.maxDistance(B,G,g,G,K,le,_e,le)),ct=Math.min(ct,_.maxDistance(B,G,g,G,_e,Ke,K,Ke)),ct=Math.min(ct,_.maxDistance(B,G,g,G,_e,Ke,_e,le)),ct=Math.min(ct,_.maxDistance(B,G,B,M,K,le,K,Ke)),ct=Math.min(ct,_.maxDistance(B,G,B,M,K,le,_e,le)),ct=Math.min(ct,_.maxDistance(B,G,B,M,_e,Ke,K,Ke)),ct=Math.min(ct,_.maxDistance(B,G,B,M,_e,Ke,_e,le))}}])})(),On=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"maximumDistance",value:function(){return Yo.maximumDistance(this._boundable1.getBounds(),this._boundable2.getBounds())}},{key:"expandToQueue",value:function(o,u){var g=_.isComposite(this._boundable1),M=_.isComposite(this._boundable2);if(g&&M)return _.area(this._boundable1)>_.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,!1,o,u),null):(this.expand(this._boundable2,this._boundable1,!0,o,u),null);if(g)return this.expand(this._boundable1,this._boundable2,!1,o,u),null;if(M)return this.expand(this._boundable2,this._boundable1,!0,o,u),null;throw new At("neither boundable is composite")}},{key:"isLeaves",value:function(){return!(_.isComposite(this._boundable1)||_.isComposite(this._boundable2))}},{key:"compareTo",value:function(o){var u=o;return this._distance<u._distance?-1:this._distance>u._distance?1:0}},{key:"expand",value:function(o,u,g,M,B){for(var G=o.getChildBoundables().iterator();G.hasNext();){var K=G.next(),le=null;(le=g?new _(u,K,this._itemDistance):new _(K,u,this._itemDistance)).getDistance()<B&&M.add(le)}}},{key:"getBoundable",value:function(o){return o===0?this._boundable1:this._boundable2}},{key:"getDistance",value:function(){return this._distance}},{key:"distance",value:function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var o=arguments[0],u=arguments[1],g=arguments[2];this._boundable1=o,this._boundable2=u,this._itemDistance=g,this._distance=this.distance()}},{key:"area",value:function(o){return o.getBounds().getArea()}},{key:"isComposite",value:function(o){return o instanceof Tn}}])})(),Tl=(function(){return c((function _(){D(this,_)}),[{key:"visitItem",value:function(_){}}])})(),Fr=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"queryInternal",value:function(){if(dn(arguments[2],Tl)&&arguments[0]instanceof Object&&arguments[1]instanceof Tn)for(var o=arguments[0],u=arguments[2],g=arguments[1].getChildBoundables(),M=0;M<g.size();M++){var B=g.get(M);this.getIntersectsOp().intersects(B.getBounds(),o)&&(B instanceof Tn?this.queryInternal(o,B,u):B instanceof ha?u.visitItem(B.getItem()):Ct.shouldNeverReachHere())}else if(dn(arguments[2],Nr)&&arguments[0]instanceof Object&&arguments[1]instanceof Tn)for(var G=arguments[0],K=arguments[2],le=arguments[1].getChildBoundables(),_e=0;_e<le.size();_e++){var Ke=le.get(_e);this.getIntersectsOp().intersects(Ke.getBounds(),G)&&(Ke instanceof Tn?this.queryInternal(G,Ke,K):Ke instanceof ha?K.add(Ke.getItem()):Ct.shouldNeverReachHere())}}},{key:"getNodeCapacity",value:function(){return this._nodeCapacity}},{key:"lastNode",value:function(o){return o.get(o.size()-1)}},{key:"size",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var o=0,u=arguments[0].getChildBoundables().iterator();u.hasNext();){var g=u.next();g instanceof Tn?o+=this.size(g):g instanceof ha&&(o+=1)}return o}}},{key:"removeItem",value:function(o,u){for(var g=null,M=o.getChildBoundables().iterator();M.hasNext();){var B=M.next();B instanceof ha&&B.getItem()===u&&(g=B)}return g!==null&&(o.getChildBoundables().remove(g),!0)}},{key:"itemsTree",value:function(){if(arguments.length===0){this.build();var o=this.itemsTree(this._root);return o===null?new Ze:o}if(arguments.length===1){for(var u=arguments[0],g=new Ze,M=u.getChildBoundables().iterator();M.hasNext();){var B=M.next();if(B instanceof Tn){var G=this.itemsTree(B);G!==null&&g.add(G)}else B instanceof ha?g.add(B.getItem()):Ct.shouldNeverReachHere()}return g.size()<=0?null:g}}},{key:"insert",value:function(o,u){Ct.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ha(o,u))}},{key:"boundablesAtLevel",value:function(){if(arguments.length===1){var o=arguments[0],u=new Ze;return this.boundablesAtLevel(o,this._root,u),u}if(arguments.length===3){var g=arguments[0],M=arguments[1],B=arguments[2];if(Ct.isTrue(g>-2),M.getLevel()===g)return B.add(M),null;for(var G=M.getChildBoundables().iterator();G.hasNext();){var K=G.next();K instanceof Tn?this.boundablesAtLevel(g,K,B):(Ct.isTrue(K instanceof ha),g===-1&&B.add(K))}return null}}},{key:"query",value:function(){if(arguments.length===1){var o=arguments[0];this.build();var u=new Ze;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),o)&&this.queryInternal(o,this._root,u),u}if(arguments.length===2){var g=arguments[0],M=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),g)&&this.queryInternal(g,this._root,M)}}},{key:"build",value:function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0}},{key:"getRoot",value:function(){return this.build(),this._root}},{key:"remove",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),o)&&this.remove(o,this._root,u)}if(arguments.length===3){var g=arguments[0],M=arguments[1],B=arguments[2],G=this.removeItem(M,B);if(G)return!0;for(var K=null,le=M.getChildBoundables().iterator();le.hasNext();){var _e=le.next();if(this.getIntersectsOp().intersects(_e.getBounds(),g)&&_e instanceof Tn&&(G=this.remove(g,_e,B))){K=_e;break}}return K!==null&&K.getChildBoundables().isEmpty()&&M.getChildBoundables().remove(K),G}}},{key:"createHigherLevels",value:function(o,u){Ct.isTrue(!o.isEmpty());var g=this.createParentBoundables(o,u+1);return g.size()===1?g.get(0):this.createHigherLevels(g,u+1)}},{key:"depth",value:function(){if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var o=0,u=arguments[0].getChildBoundables().iterator();u.hasNext();){var g=u.next();if(g instanceof Tn){var M=this.depth(g);M>o&&(o=M)}}return o+1}}},{key:"createParentBoundables",value:function(o,u){Ct.isTrue(!o.isEmpty());var g=new Ze;g.add(this.createNode(u));var M=new Ze(o);bn.sort(M,this.getComparator());for(var B=M.iterator();B.hasNext();){var G=B.next();this.lastNode(g).getChildBoundables().size()===this.getNodeCapacity()&&g.add(this.createNode(u)),this.lastNode(g).addChildBoundable(G)}return g}},{key:"isEmpty",value:function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()}},{key:"interfaces_",get:function(){return[de]}}],[{key:"constructor_",value:function(){if(this._root=null,this._built=!1,this._itemBoundables=new Ze,this._nodeCapacity=null,arguments.length===0)_.constructor_.call(this,_.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var o=arguments[0];Ct.isTrue(o>1,"Node capacity must be greater than 1"),this._nodeCapacity=o}}},{key:"compareDoubles",value:function(o,u){return o>u?1:o<u?-1:0}}])})();Fr.IntersectsOp=function(){},Fr.DEFAULT_NODE_CAPACITY=10;var yo=(function(){return c((function _(){D(this,_)}),[{key:"distance",value:function(_,o){}}])})(),jr=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"createParentBoundablesFromVerticalSlices",value:function(u,g){Ct.isTrue(u.length>0);for(var M=new Ze,B=0;B<u.length;B++)M.addAll(this.createParentBoundablesFromVerticalSlice(u[B],g));return M}},{key:"nearestNeighbourK",value:function(){if(arguments.length===2){var u=arguments[0],g=arguments[1];return this.nearestNeighbourK(u,vt.POSITIVE_INFINITY,g)}if(arguments.length===3){var M=arguments[0],B=arguments[2],G=arguments[1],K=new Qn;K.add(M);for(var le=new Qn;!K.isEmpty()&&G>=0;){var _e=K.poll(),Ke=_e.getDistance();if(Ke>=G)break;_e.isLeaves()?le.size()<B?le.add(_e):(le.peek().getDistance()>Ke&&(le.poll(),le.add(_e)),G=le.peek().getDistance()):_e.expandToQueue(K,G)}return o.getItems(le)}}},{key:"createNode",value:function(u){return new Oc(u)}},{key:"size",value:function(){return arguments.length===0?Ge(o,"size",this,1).call(this):Ge(o,"size",this,1).apply(this,arguments)}},{key:"insert",value:function(){if(!(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Rn))return Ge(o,"insert",this,1).apply(this,arguments);var u=arguments[0],g=arguments[1];if(u.isNull())return null;Ge(o,"insert",this,1).call(this,u,g)}},{key:"getIntersectsOp",value:function(){return o.intersectsOp}},{key:"verticalSlices",value:function(u,g){for(var M=Math.trunc(Math.ceil(u.size()/g)),B=new Array(g).fill(null),G=u.iterator(),K=0;K<g;K++){B[K]=new Ze;for(var le=0;G.hasNext()&&le<M;){var _e=G.next();B[K].add(_e),le++}}return B}},{key:"query",value:function(){if(arguments.length===1){var u=arguments[0];return Ge(o,"query",this,1).call(this,u)}if(arguments.length===2){var g=arguments[0],M=arguments[1];Ge(o,"query",this,1).call(this,g,M)}}},{key:"getComparator",value:function(){return o.yComparator}},{key:"createParentBoundablesFromVerticalSlice",value:function(u,g){return Ge(o,"createParentBoundables",this,1).call(this,u,g)}},{key:"remove",value:function(){if(arguments.length===2&&arguments[1]instanceof Object&&arguments[0]instanceof Rn){var u=arguments[0],g=arguments[1];return Ge(o,"remove",this,1).call(this,u,g)}return Ge(o,"remove",this,1).apply(this,arguments)}},{key:"depth",value:function(){return arguments.length===0?Ge(o,"depth",this,1).call(this):Ge(o,"depth",this,1).apply(this,arguments)}},{key:"createParentBoundables",value:function(u,g){Ct.isTrue(!u.isEmpty());var M=Math.trunc(Math.ceil(u.size()/this.getNodeCapacity())),B=new Ze(u);bn.sort(B,o.xComparator);var G=this.verticalSlices(B,Math.trunc(Math.ceil(Math.sqrt(M))));return this.createParentBoundablesFromVerticalSlices(G,g)}},{key:"nearestNeighbour",value:function(){if(arguments.length===1){if(dn(arguments[0],yo)){var u=arguments[0];if(this.isEmpty())return null;var g=new On(this.getRoot(),this.getRoot(),u);return this.nearestNeighbour(g)}if(arguments[0]instanceof On){var M=arguments[0],B=vt.POSITIVE_INFINITY,G=null,K=new Qn;for(K.add(M);!K.isEmpty()&&B>0;){var le=K.poll(),_e=le.getDistance();if(_e>=B)break;le.isLeaves()?(B=_e,G=le):le.expandToQueue(K,B)}return G===null?null:[G.getBoundable(0).getItem(),G.getBoundable(1).getItem()]}}else{if(arguments.length===2){var Ke=arguments[0],ct=arguments[1];if(this.isEmpty()||Ke.isEmpty())return null;var Bt=new On(this.getRoot(),Ke.getRoot(),ct);return this.nearestNeighbour(Bt)}if(arguments.length===3){var Jt=arguments[2],sn=new ha(arguments[0],arguments[1]),pn=new On(this.getRoot(),sn,Jt);return this.nearestNeighbour(pn)[0]}if(arguments.length===4){var Nn=arguments[2],In=arguments[3],hi=new ha(arguments[0],arguments[1]),hr=new On(this.getRoot(),hi,Nn);return this.nearestNeighbourK(hr,In)}}}},{key:"isWithinDistance",value:function(){if(arguments.length===2){var u=arguments[0],g=arguments[1],M=vt.POSITIVE_INFINITY,B=new Qn;for(B.add(u);!B.isEmpty();){var G=B.poll(),K=G.getDistance();if(K>g)return!1;if(G.maximumDistance()<=g)return!0;if(G.isLeaves()){if((M=K)<=g)return!0}else G.expandToQueue(B,M)}return!1}if(arguments.length===3){var le=arguments[0],_e=arguments[1],Ke=arguments[2],ct=new On(this.getRoot(),le.getRoot(),_e);return this.isWithinDistance(ct,Ke)}}},{key:"interfaces_",get:function(){return[_o,de]}}],[{key:"constructor_",value:function(){if(arguments.length===0)o.constructor_.call(this,o.DEFAULT_NODE_CAPACITY);else if(arguments.length===1){var u=arguments[0];Fr.constructor_.call(this,u)}}},{key:"centreX",value:function(u){return o.avg(u.getMinX(),u.getMaxX())}},{key:"avg",value:function(u,g){return(u+g)/2}},{key:"getItems",value:function(u){for(var g=new Array(u.size()).fill(null),M=0;!u.isEmpty();){var B=u.poll();g[M]=B.getBoundable(0).getItem(),M++}return g}},{key:"centreY",value:function(u){return o.avg(u.getMinY(),u.getMaxY())}}])})(Fr),Oc=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"computeBounds",value:function(){for(var u=null,g=this.getChildBoundables().iterator();g.hasNext();){var M=g.next();u===null?u=new Rn(M.getBounds()):u.expandToInclude(M.getBounds())}return u}}],[{key:"constructor_",value:function(){var u=arguments[0];Tn.constructor_.call(this,u)}}])})(Tn);jr.STRtreeNode=Oc,jr.xComparator=new((function(){return c((function _(){D(this,_)}),[{key:"interfaces_",get:function(){return[Me]}},{key:"compare",value:function(_,o){return Fr.compareDoubles(jr.centreX(_.getBounds()),jr.centreX(o.getBounds()))}}])})()),jr.yComparator=new((function(){return c((function _(){D(this,_)}),[{key:"interfaces_",get:function(){return[Me]}},{key:"compare",value:function(_,o){return Fr.compareDoubles(jr.centreY(_.getBounds()),jr.centreY(o.getBounds()))}}])})()),jr.intersectsOp=new((function(){return c((function _(){D(this,_)}),[{key:"interfaces_",get:function(){return[IntersectsOp]}},{key:"intersects",value:function(_,o){return _.intersects(o)}}])})()),jr.DEFAULT_NODE_CAPACITY=10;var au=(function(){function _(){D(this,_)}return c(_,null,[{key:"relativeSign",value:function(o,u){return o<u?-1:o>u?1:0}},{key:"compare",value:function(o,u,g){if(u.equals2D(g))return 0;var M=_.relativeSign(u.x,g.x),B=_.relativeSign(u.y,g.y);switch(o){case 0:return _.compareValue(M,B);case 1:return _.compareValue(B,M);case 2:return _.compareValue(B,-M);case 3:return _.compareValue(-M,B);case 4:return _.compareValue(-M,-B);case 5:return _.compareValue(-B,-M);case 6:return _.compareValue(-B,M);case 7:return _.compareValue(M,-B)}return Ct.shouldNeverReachHere("invalid octant value"),0}},{key:"compareValue",value:function(o,u){return o<0?-1:o>0?1:u<0?-1:u>0?1:0}}])})(),Nc=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(_){_.print(this.coord),_.print(" seg # = "+this.segmentIndex)}},{key:"compareTo",value:function(_){var o=_;return this.segmentIndex<o.segmentIndex?-1:this.segmentIndex>o.segmentIndex?1:this.coord.equals2D(o.coord)?0:this._isInterior?o._isInterior?au.compare(this._segmentOctant,this.coord,o.coord):1:-1}},{key:"isEndPoint",value:function(_){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===_}},{key:"toString",value:function(){return this.segmentIndex+":"+this.coord.toString()}},{key:"isInterior",value:function(){return this._isInterior}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var _=arguments[0],o=arguments[1],u=arguments[2],g=arguments[3];this._segString=_,this.coord=new Qe(o),this.segmentIndex=u,this._segmentOctant=g,this._isInterior=!o.equals2D(_.getCoordinate(u))}}])})(),If=(function(){return c((function _(){D(this,_)}),[{key:"hasNext",value:function(){}},{key:"next",value:function(){}},{key:"remove",value:function(){}}])})(),Bc=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"getSplitCoordinates",value:function(){var _=new ls;this.addEndpoints();for(var o=this.iterator(),u=o.next();o.hasNext();){var g=o.next();this.addEdgeCoordinates(u,g,_),u=g}return _.toCoordinateArray()}},{key:"addCollapsedNodes",value:function(){var _=new Ze;this.findCollapsesFromInsertedNodes(_),this.findCollapsesFromExistingVertices(_);for(var o=_.iterator();o.hasNext();){var u=o.next().intValue();this.add(this._edge.getCoordinate(u),u)}}},{key:"createSplitEdgePts",value:function(_,o){var u=o.segmentIndex-_.segmentIndex+2;if(u===2)return[new Qe(_.coord),new Qe(o.coord)];var g=this._edge.getCoordinate(o.segmentIndex),M=o.isInterior()||!o.coord.equals2D(g);M||u--;var B=new Array(u).fill(null),G=0;B[G++]=new Qe(_.coord);for(var K=_.segmentIndex+1;K<=o.segmentIndex;K++)B[G++]=this._edge.getCoordinate(K);return M&&(B[G]=new Qe(o.coord)),B}},{key:"print",value:function(_){_.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(_)}},{key:"findCollapsesFromExistingVertices",value:function(_){for(var o=0;o<this._edge.size()-2;o++){var u=this._edge.getCoordinate(o);this._edge.getCoordinate(o+1);var g=this._edge.getCoordinate(o+2);u.equals2D(g)&&_.add(nt.valueOf(o+1))}}},{key:"addEdgeCoordinates",value:function(_,o,u){var g=this.createSplitEdgePts(_,o);u.add(g,!1)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(_){this.addEndpoints(),this.addCollapsedNodes();for(var o=this.iterator(),u=o.next();o.hasNext();){var g=o.next(),M=this.createSplitEdge(u,g);_.add(M),u=g}}},{key:"findCollapseIndex",value:function(_,o,u){if(!_.coord.equals2D(o.coord))return!1;var g=o.segmentIndex-_.segmentIndex;return o.isInterior()||g--,g===1&&(u[0]=_.segmentIndex+1,!0)}},{key:"findCollapsesFromInsertedNodes",value:function(_){for(var o=new Array(1).fill(null),u=this.iterator(),g=u.next();u.hasNext();){var M=u.next();this.findCollapseIndex(g,M,o)&&_.add(nt.valueOf(o[0])),g=M}}},{key:"getEdge",value:function(){return this._edge}},{key:"addEndpoints",value:function(){var _=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(_),_)}},{key:"createSplitEdge",value:function(_,o){var u=this.createSplitEdgePts(_,o);return new Ra(u,this._edge.getData())}},{key:"add",value:function(_,o){var u=new Nc(this._edge,_,o,this._edge.getSegmentOctant(o)),g=this._nodeMap.get(u);return g!==null?(Ct.isTrue(g.coord.equals2D(_),"Found equal nodes with different coordinates"),g):(this._nodeMap.put(u,u),u)}},{key:"checkSplitEdgesCorrectness",value:function(_){var o=this._edge.getCoordinates(),u=_.get(0).getCoordinate(0);if(!u.equals2D(o[0]))throw new ut("bad split edge start point at "+u);var g=_.get(_.size()-1).getCoordinates(),M=g[g.length-1];if(!M.equals2D(o[o.length-1]))throw new ut("bad split edge end point at "+M)}}],[{key:"constructor_",value:function(){this._nodeMap=new ci,this._edge=null;var _=arguments[0];this._edge=_}}])})(),fa=(function(){function _(){D(this,_)}return c(_,null,[{key:"octant",value:function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var o=arguments[0],u=arguments[1];if(o===0&&u===0)throw new At("Cannot compute the octant for point ( "+o+", "+u+" )");var g=Math.abs(o),M=Math.abs(u);return o>=0?u>=0?g>=M?0:1:g>=M?7:6:u>=0?g>=M?3:2:g>=M?4:5}if(arguments[0]instanceof Qe&&arguments[1]instanceof Qe){var B=arguments[0],G=arguments[1],K=G.x-B.x,le=G.y-B.y;if(K===0&&le===0)throw new At("Cannot compute the octant for two identical points "+B);return _.octant(K,le)}}}])})(),Ds=(function(){return c((function _(){D(this,_)}),[{key:"getCoordinates",value:function(){}},{key:"size",value:function(){}},{key:"getCoordinate",value:function(_){}},{key:"isClosed",value:function(){}},{key:"setData",value:function(_){}},{key:"getData",value:function(){}}])})(),Li=(function(){return c((function _(){D(this,_)}),[{key:"addIntersection",value:function(_,o){}},{key:"interfaces_",get:function(){return[Ds]}}])})(),Ra=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getCoordinates",value:function(){return this._pts}},{key:"size",value:function(){return this._pts.length}},{key:"getCoordinate",value:function(o){return this._pts[o]}},{key:"isClosed",value:function(){return this._pts[0].equals(this._pts[this._pts.length-1])}},{key:"getSegmentOctant",value:function(o){return o===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(o),this.getCoordinate(o+1))}},{key:"setData",value:function(o){this._data=o}},{key:"safeOctant",value:function(o,u){return o.equals2D(u)?0:fa.octant(o,u)}},{key:"getData",value:function(){return this._data}},{key:"addIntersection",value:function(){if(arguments.length===2){var o=arguments[0],u=arguments[1];this.addIntersectionNode(o,u)}else if(arguments.length===4){var g=arguments[1],M=arguments[3],B=new Qe(arguments[0].getIntersection(M));this.addIntersection(B,g)}}},{key:"toString",value:function(){return Hs.toLineString(new Ti(this._pts))}},{key:"getNodeList",value:function(){return this._nodeList}},{key:"addIntersectionNode",value:function(o,u){var g=u,M=g+1;if(M<this._pts.length){var B=this._pts[M];o.equals2D(B)&&(g=M)}return this._nodeList.add(o,g)}},{key:"addIntersections",value:function(o,u,g){for(var M=0;M<o.getIntersectionNum();M++)this.addIntersection(o,u,g,M)}},{key:"interfaces_",get:function(){return[Li]}}],[{key:"constructor_",value:function(){this._nodeList=new Bc(this),this._pts=null,this._data=null;var o=arguments[0],u=arguments[1];this._pts=o,this._data=u}},{key:"getNodedSubstrings",value:function(){if(arguments.length===1){var o=arguments[0],u=new Ze;return _.getNodedSubstrings(o,u),u}if(arguments.length===2)for(var g=arguments[1],M=arguments[0].iterator();M.hasNext();)M.next().getNodeList().addSplitEdges(g)}}])})(),Ur=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"minX",value:function(){return Math.min(this.p0.x,this.p1.x)}},{key:"orientationIndex",value:function(){if(arguments[0]instanceof _){var o=arguments[0],u=Ee.index(this.p0,this.p1,o.p0),g=Ee.index(this.p0,this.p1,o.p1);return u>=0&&g>=0||u<=0&&g<=0?Math.max(u,g):0}if(arguments[0]instanceof Qe){var M=arguments[0];return Ee.index(this.p0,this.p1,M)}}},{key:"toGeometry",value:function(o){return o.createLineString([this.p0,this.p1])}},{key:"isVertical",value:function(){return this.p0.x===this.p1.x}},{key:"equals",value:function(o){if(!(o instanceof _))return!1;var u=o;return this.p0.equals(u.p0)&&this.p1.equals(u.p1)}},{key:"intersection",value:function(o){var u=new Ya;return u.computeIntersection(this.p0,this.p1,o.p0,o.p1),u.hasIntersection()?u.getIntersection(0):null}},{key:"project",value:function(){if(arguments[0]instanceof Qe){var o=arguments[0];if(o.equals(this.p0)||o.equals(this.p1))return new Qe(o);var u=this.projectionFactor(o),g=new Qe;return g.x=this.p0.x+u*(this.p1.x-this.p0.x),g.y=this.p0.y+u*(this.p1.y-this.p0.y),g}if(arguments[0]instanceof _){var M=arguments[0],B=this.projectionFactor(M.p0),G=this.projectionFactor(M.p1);if(B>=1&&G>=1||B<=0&&G<=0)return null;var K=this.project(M.p0);B<0&&(K=this.p0),B>1&&(K=this.p1);var le=this.project(M.p1);return G<0&&(le=this.p0),G>1&&(le=this.p1),new _(K,le)}}},{key:"normalize",value:function(){this.p1.compareTo(this.p0)<0&&this.reverse()}},{key:"angle",value:function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)}},{key:"getCoordinate",value:function(o){return o===0?this.p0:this.p1}},{key:"distancePerpendicular",value:function(o){return zn.pointToLinePerpendicular(o,this.p0,this.p1)}},{key:"minY",value:function(){return Math.min(this.p0.y,this.p1.y)}},{key:"midPoint",value:function(){return _.midPoint(this.p0,this.p1)}},{key:"projectionFactor",value:function(o){if(o.equals(this.p0))return 0;if(o.equals(this.p1))return 1;var u=this.p1.x-this.p0.x,g=this.p1.y-this.p0.y,M=u*u+g*g;return M<=0?vt.NaN:((o.x-this.p0.x)*u+(o.y-this.p0.y)*g)/M}},{key:"closestPoints",value:function(o){var u=this.intersection(o);if(u!==null)return[u,u];var g=new Array(2).fill(null),M=vt.MAX_VALUE,B=null,G=this.closestPoint(o.p0);M=G.distance(o.p0),g[0]=G,g[1]=o.p0;var K=this.closestPoint(o.p1);(B=K.distance(o.p1))<M&&(M=B,g[0]=K,g[1]=o.p1);var le=o.closestPoint(this.p0);(B=le.distance(this.p0))<M&&(M=B,g[0]=this.p0,g[1]=le);var _e=o.closestPoint(this.p1);return(B=_e.distance(this.p1))<M&&(M=B,g[0]=this.p1,g[1]=_e),g}},{key:"closestPoint",value:function(o){var u=this.projectionFactor(o);return u>0&&u<1?this.project(o):this.p0.distance(o)<this.p1.distance(o)?this.p0:this.p1}},{key:"maxX",value:function(){return Math.max(this.p0.x,this.p1.x)}},{key:"getLength",value:function(){return this.p0.distance(this.p1)}},{key:"compareTo",value:function(o){var u=o,g=this.p0.compareTo(u.p0);return g!==0?g:this.p1.compareTo(u.p1)}},{key:"reverse",value:function(){var o=this.p0;this.p0=this.p1,this.p1=o}},{key:"equalsTopo",value:function(o){return this.p0.equals(o.p0)&&this.p1.equals(o.p1)||this.p0.equals(o.p1)&&this.p1.equals(o.p0)}},{key:"lineIntersection",value:function(o){return Wt.intersection(this.p0,this.p1,o.p0,o.p1)}},{key:"maxY",value:function(){return Math.max(this.p0.y,this.p1.y)}},{key:"pointAlongOffset",value:function(o,u){var g=this.p0.x+o*(this.p1.x-this.p0.x),M=this.p0.y+o*(this.p1.y-this.p0.y),B=this.p1.x-this.p0.x,G=this.p1.y-this.p0.y,K=Math.sqrt(B*B+G*G),le=0,_e=0;if(u!==0){if(K<=0)throw new IllegalStateException("Cannot compute offset from zero-length line segment");le=u*B/K,_e=u*G/K}return new Qe(g-_e,M+le)}},{key:"setCoordinates",value:function(){if(arguments.length===1){var o=arguments[0];this.setCoordinates(o.p0,o.p1)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.p0.x=u.x,this.p0.y=u.y,this.p1.x=g.x,this.p1.y=g.y}}},{key:"segmentFraction",value:function(o){var u=this.projectionFactor(o);return u<0?u=0:(u>1||vt.isNaN(u))&&(u=1),u}},{key:"toString",value:function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"}},{key:"isHorizontal",value:function(){return this.p0.y===this.p1.y}},{key:"reflect",value:function(o){var u=this.p1.getY()-this.p0.getY(),g=this.p0.getX()-this.p1.getX(),M=this.p0.getY()*(this.p1.getX()-this.p0.getX())-this.p0.getX()*(this.p1.getY()-this.p0.getY()),B=u*u+g*g,G=u*u-g*g,K=o.getX(),le=o.getY();return new Qe((-G*K-2*u*g*le-2*u*M)/B,(G*le-2*u*g*K-2*g*M)/B)}},{key:"distance",value:function(){if(arguments[0]instanceof _){var o=arguments[0];return zn.segmentToSegment(this.p0,this.p1,o.p0,o.p1)}if(arguments[0]instanceof Qe){var u=arguments[0];return zn.pointToSegment(u,this.p0,this.p1)}}},{key:"pointAlong",value:function(o){var u=new Qe;return u.x=this.p0.x+o*(this.p1.x-this.p0.x),u.y=this.p0.y+o*(this.p1.y-this.p0.y),u}},{key:"hashCode",value:function(){var o=vt.doubleToLongBits(this.p0.x);o^=31*vt.doubleToLongBits(this.p0.y);var u=Math.trunc(o)^Math.trunc(o>>32),g=vt.doubleToLongBits(this.p1.x);return g^=31*vt.doubleToLongBits(this.p1.y),u^(Math.trunc(g)^Math.trunc(g>>32))}},{key:"interfaces_",get:function(){return[wt,de]}}],[{key:"constructor_",value:function(){if(this.p0=null,this.p1=null,arguments.length===0)_.constructor_.call(this,new Qe,new Qe);else if(arguments.length===1){var o=arguments[0];_.constructor_.call(this,o.p0,o.p1)}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this.p0=u,this.p1=g}else if(arguments.length===4){var M=arguments[0],B=arguments[1],G=arguments[2],K=arguments[3];_.constructor_.call(this,new Qe(M,B),new Qe(G,K))}}},{key:"midPoint",value:function(o,u){return new Qe((o.x+u.x)/2,(o.y+u.y)/2)}}])})(),su=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"overlap",value:function(){if(arguments.length!==2){if(arguments.length===4){var _=arguments[1],o=arguments[2],u=arguments[3];arguments[0].getLineSegment(_,this._overlapSeg1),o.getLineSegment(u,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}}}}],[{key:"constructor_",value:function(){this._overlapSeg1=new Ur,this._overlapSeg2=new Ur}}])})(),Bi=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"getLineSegment",value:function(_,o){o.p0=this._pts[_],o.p1=this._pts[_+1]}},{key:"computeSelect",value:function(_,o,u,g){var M=this._pts[o],B=this._pts[u];if(u-o==1)return g.select(this,o),null;if(!_.intersects(M,B))return null;var G=Math.trunc((o+u)/2);o<G&&this.computeSelect(_,o,G,g),G<u&&this.computeSelect(_,G,u,g)}},{key:"getCoordinates",value:function(){for(var _=new Array(this._end-this._start+1).fill(null),o=0,u=this._start;u<=this._end;u++)_[o++]=this._pts[u];return _}},{key:"computeOverlaps",value:function(){if(arguments.length===2){var _=arguments[0],o=arguments[1];this.computeOverlaps(this._start,this._end,_,_._start,_._end,o)}else if(arguments.length===6){var u=arguments[0],g=arguments[1],M=arguments[2],B=arguments[3],G=arguments[4],K=arguments[5];if(g-u==1&&G-B==1)return K.overlap(this,u,M,B),null;if(!this.overlaps(u,g,M,B,G))return null;var le=Math.trunc((u+g)/2),_e=Math.trunc((B+G)/2);u<le&&(B<_e&&this.computeOverlaps(u,le,M,B,_e,K),_e<G&&this.computeOverlaps(u,le,M,_e,G,K)),le<g&&(B<_e&&this.computeOverlaps(le,g,M,B,_e,K),_e<G&&this.computeOverlaps(le,g,M,_e,G,K))}}},{key:"setId",value:function(_){this._id=_}},{key:"select",value:function(_,o){this.computeSelect(_,this._start,this._end,o)}},{key:"getEnvelope",value:function(){if(this._env===null){var _=this._pts[this._start],o=this._pts[this._end];this._env=new Rn(_,o)}return this._env}},{key:"overlaps",value:function(_,o,u,g,M){return Rn.intersects(this._pts[_],this._pts[o],u._pts[g],u._pts[M])}},{key:"getEndIndex",value:function(){return this._end}},{key:"getStartIndex",value:function(){return this._start}},{key:"getContext",value:function(){return this._context}},{key:"getId",value:function(){return this._id}}],[{key:"constructor_",value:function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var _=arguments[0],o=arguments[1],u=arguments[2],g=arguments[3];this._pts=_,this._start=o,this._end=u,this._context=g}}])})(),Mh=(function(){function _(){D(this,_)}return c(_,null,[{key:"findChainEnd",value:function(o,u){for(var g=u;g<o.length-1&&o[g].equals2D(o[g+1]);)g++;if(g>=o.length-1)return o.length-1;for(var M=Si.quadrant(o[g],o[g+1]),B=u+1;B<o.length&&!(!o[B-1].equals2D(o[B])&&Si.quadrant(o[B-1],o[B])!==M);)B++;return B-1}},{key:"getChains",value:function(){if(arguments.length===1){var o=arguments[0];return _.getChains(o,null)}if(arguments.length===2){var u=arguments[0],g=arguments[1],M=new Ze,B=0;do{var G=_.findChainEnd(u,B),K=new Bi(u,B,G,g);M.add(K),B=G}while(B<u.length-1);return M}}}])})(),Sl=(function(){return c((function _(){D(this,_)}),[{key:"computeNodes",value:function(_){}},{key:"getNodedSubstrings",value:function(){}}])})(),Fc=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"setSegmentIntersector",value:function(_){this._segInt=_}},{key:"interfaces_",get:function(){return[Sl]}}],[{key:"constructor_",value:function(){if(this._segInt=null,arguments.length!==0){if(arguments.length===1){var _=arguments[0];this.setSegmentIntersector(_)}}}}])})(),jc=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"getMonotoneChains",value:function(){return this._monoChains}},{key:"getNodedSubstrings",value:function(){return Ra.getNodedSubstrings(this._nodedSegStrings)}},{key:"getIndex",value:function(){return this._index}},{key:"add",value:function(u){for(var g=Mh.getChains(u.getCoordinates(),u).iterator();g.hasNext();){var M=g.next();M.setId(this._idCounter++),this._index.insert(M.getEnvelope(),M),this._monoChains.add(M)}}},{key:"computeNodes",value:function(u){this._nodedSegStrings=u;for(var g=u.iterator();g.hasNext();)this.add(g.next());this.intersectChains()}},{key:"intersectChains",value:function(){for(var u=new Ho(this._segInt),g=this._monoChains.iterator();g.hasNext();)for(var M=g.next(),B=this._index.query(M.getEnvelope()).iterator();B.hasNext();){var G=B.next();if(G.getId()>M.getId()&&(M.computeOverlaps(G,u),this._nOverlaps++),this._segInt.isDone())return null}}}],[{key:"constructor_",value:function(){if(this._monoChains=new Ze,this._index=new jr,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0,arguments.length!==0){if(arguments.length===1){var u=arguments[0];Fc.constructor_.call(this,u)}}}}])})(Fc),Ho=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"overlap",value:function(){if(arguments.length!==4)return Ge(o,"overlap",this,1).apply(this,arguments);var u=arguments[1],g=arguments[2],M=arguments[3],B=arguments[0].getContext(),G=g.getContext();this._si.processIntersections(B,u,G,M)}}],[{key:"constructor_",value:function(){this._si=null;var u=arguments[0];this._si=u}}])})(su);jc.SegmentOverlapAction=Ho;var va=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"isDeletable",value:function(o,u,g,M){var B=this._inputLine[o],G=this._inputLine[u],K=this._inputLine[g];return!!this.isConcave(B,G,K)&&!!this.isShallow(B,G,K,M)&&this.isShallowSampled(B,G,o,g,M)}},{key:"deleteShallowConcavities",value:function(){for(var o=1,u=this.findNextNonDeletedIndex(o),g=this.findNextNonDeletedIndex(u),M=!1;g<this._inputLine.length;){var B=!1;this.isDeletable(o,u,g,this._distanceTol)&&(this._isDeleted[u]=_.DELETE,B=!0,M=!0),o=B?g:u,u=this.findNextNonDeletedIndex(o),g=this.findNextNonDeletedIndex(u)}return M}},{key:"isShallowConcavity",value:function(o,u,g,M){return Ee.index(o,u,g)===this._angleOrientation&&zn.pointToSegment(u,o,g)<M}},{key:"isShallowSampled",value:function(o,u,g,M,B){var G=Math.trunc((M-g)/_.NUM_PTS_TO_CHECK);G<=0&&(G=1);for(var K=g;K<M;K+=G)if(!this.isShallow(o,u,this._inputLine[K],B))return!1;return!0}},{key:"isConcave",value:function(o,u,g){var M=Ee.index(o,u,g)===this._angleOrientation;return M}},{key:"simplify",value:function(o){this._distanceTol=Math.abs(o),o<0&&(this._angleOrientation=Ee.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var u=!1;do u=this.deleteShallowConcavities();while(u);return this.collapseLine()}},{key:"findNextNonDeletedIndex",value:function(o){for(var u=o+1;u<this._inputLine.length&&this._isDeleted[u]===_.DELETE;)u++;return u}},{key:"isShallow",value:function(o,u,g,M){return zn.pointToSegment(u,o,g)<M}},{key:"collapseLine",value:function(){for(var o=new ls,u=0;u<this._inputLine.length;u++)this._isDeleted[u]!==_.DELETE&&o.add(this._inputLine[u]);return o.toCoordinateArray()}}],[{key:"constructor_",value:function(){this._inputLine=null,this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Ee.COUNTERCLOCKWISE;var o=arguments[0];this._inputLine=o}},{key:"simplify",value:function(o,u){return new _(o).simplify(u)}}])})();va.INIT=0,va.DELETE=1,va.KEEP=1,va.NUM_PTS_TO_CHECK=10;var Xo=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getCoordinates",value:function(){return this._ptList.toArray(_.COORDINATE_ARRAY_TYPE)}},{key:"setPrecisionModel",value:function(o){this._precisionModel=o}},{key:"addPt",value:function(o){var u=new Qe(o);if(this._precisionModel.makePrecise(u),this.isRedundant(u))return null;this._ptList.add(u)}},{key:"reverse",value:function(){}},{key:"addPts",value:function(o,u){if(u)for(var g=0;g<o.length;g++)this.addPt(o[g]);else for(var M=o.length-1;M>=0;M--)this.addPt(o[M])}},{key:"isRedundant",value:function(o){if(this._ptList.size()<1)return!1;var u=this._ptList.get(this._ptList.size()-1);return o.distance(u)<this._minimimVertexDistance}},{key:"toString",value:function(){return new Wr().createLineString(this.getCoordinates()).toString()}},{key:"closeRing",value:function(){if(this._ptList.size()<1)return null;var o=new Qe(this._ptList.get(0)),u=this._ptList.get(this._ptList.size()-1);if(o.equals(u))return null;this._ptList.add(o)}},{key:"setMinimumVertexDistance",value:function(o){this._minimimVertexDistance=o}}],[{key:"constructor_",value:function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Ze}}])})();Xo.COORDINATE_ARRAY_TYPE=new Array(0).fill(null);var da=(function(){function _(){D(this,_)}return c(_,null,[{key:"toDegrees",value:function(o){return 180*o/Math.PI}},{key:"normalize",value:function(o){for(;o>Math.PI;)o-=_.PI_TIMES_2;for(;o<=-Math.PI;)o+=_.PI_TIMES_2;return o}},{key:"angle",value:function(){if(arguments.length===1){var o=arguments[0];return Math.atan2(o.y,o.x)}if(arguments.length===2){var u=arguments[0],g=arguments[1],M=g.x-u.x,B=g.y-u.y;return Math.atan2(B,M)}}},{key:"isAcute",value:function(o,u,g){var M=o.x-u.x,B=o.y-u.y;return M*(g.x-u.x)+B*(g.y-u.y)>0}},{key:"isObtuse",value:function(o,u,g){var M=o.x-u.x,B=o.y-u.y;return M*(g.x-u.x)+B*(g.y-u.y)<0}},{key:"interiorAngle",value:function(o,u,g){var M=_.angle(u,o),B=_.angle(u,g);return Math.abs(B-M)}},{key:"normalizePositive",value:function(o){if(o<0){for(;o<0;)o+=_.PI_TIMES_2;o>=_.PI_TIMES_2&&(o=0)}else{for(;o>=_.PI_TIMES_2;)o-=_.PI_TIMES_2;o<0&&(o=0)}return o}},{key:"angleBetween",value:function(o,u,g){var M=_.angle(u,o),B=_.angle(u,g);return _.diff(M,B)}},{key:"diff",value:function(o,u){var g=null;return(g=o<u?u-o:o-u)>Math.PI&&(g=2*Math.PI-g),g}},{key:"toRadians",value:function(o){return o*Math.PI/180}},{key:"getTurn",value:function(o,u){var g=Math.sin(u-o);return g>0?_.COUNTERCLOCKWISE:g<0?_.CLOCKWISE:_.NONE}},{key:"angleBetweenOriented",value:function(o,u,g){var M=_.angle(u,o),B=_.angle(u,g)-M;return B<=-Math.PI?B+_.PI_TIMES_2:B>Math.PI?B-_.PI_TIMES_2:B}}])})();da.PI_TIMES_2=2*Math.PI,da.PI_OVER_2=Math.PI/2,da.PI_OVER_4=Math.PI/4,da.COUNTERCLOCKWISE=Ee.COUNTERCLOCKWISE,da.CLOCKWISE=Ee.CLOCKWISE,da.NONE=Ee.COLLINEAR;var $s=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"addNextSegment",value:function(o,u){if(this._s0=this._s1,this._s1=this._s2,this._s2=o,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var g=Ee.index(this._s0,this._s1,this._s2),M=g===Ee.CLOCKWISE&&this._side===Yt.LEFT||g===Ee.COUNTERCLOCKWISE&&this._side===Yt.RIGHT;g===0?this.addCollinear(u):M?this.addOutsideTurn(g,u):this.addInsideTurn(g,u)}},{key:"addLineEndCap",value:function(o,u){var g=new Ur(o,u),M=new Ur;this.computeOffsetSegment(g,Yt.LEFT,this._distance,M);var B=new Ur;this.computeOffsetSegment(g,Yt.RIGHT,this._distance,B);var G=u.x-o.x,K=u.y-o.y,le=Math.atan2(K,G);switch(this._bufParams.getEndCapStyle()){case at.CAP_ROUND:this._segList.addPt(M.p1),this.addDirectedFillet(u,le+Math.PI/2,le-Math.PI/2,Ee.CLOCKWISE,this._distance),this._segList.addPt(B.p1);break;case at.CAP_FLAT:this._segList.addPt(M.p1),this._segList.addPt(B.p1);break;case at.CAP_SQUARE:var _e=new Qe;_e.x=Math.abs(this._distance)*Math.cos(le),_e.y=Math.abs(this._distance)*Math.sin(le);var Ke=new Qe(M.p1.x+_e.x,M.p1.y+_e.y),ct=new Qe(B.p1.x+_e.x,B.p1.y+_e.y);this._segList.addPt(Ke),this._segList.addPt(ct)}}},{key:"getCoordinates",value:function(){return this._segList.getCoordinates()}},{key:"addMitreJoin",value:function(o,u,g,M){var B=Wt.intersection(u.p0,u.p1,g.p0,g.p1);if(B!==null&&(M<=0?1:B.distance(o)/Math.abs(M))<=this._bufParams.getMitreLimit())return this._segList.addPt(B),null;this.addLimitedMitreJoin(u,g,M,this._bufParams.getMitreLimit())}},{key:"addOutsideTurn",value:function(o,u){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*_.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===at.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===at.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(u&&this._segList.addPt(this._offset0.p1),this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,o,this._distance),this._segList.addPt(this._offset1.p0))}},{key:"createSquare",value:function(o){this._segList.addPt(new Qe(o.x+this._distance,o.y+this._distance)),this._segList.addPt(new Qe(o.x+this._distance,o.y-this._distance)),this._segList.addPt(new Qe(o.x-this._distance,o.y-this._distance)),this._segList.addPt(new Qe(o.x-this._distance,o.y+this._distance)),this._segList.closeRing()}},{key:"addSegments",value:function(o,u){this._segList.addPts(o,u)}},{key:"addFirstSegment",value:function(){this._segList.addPt(this._offset1.p0)}},{key:"addCornerFillet",value:function(o,u,g,M,B){var G=u.x-o.x,K=u.y-o.y,le=Math.atan2(K,G),_e=g.x-o.x,Ke=g.y-o.y,ct=Math.atan2(Ke,_e);M===Ee.CLOCKWISE?le<=ct&&(le+=2*Math.PI):le>=ct&&(le-=2*Math.PI),this._segList.addPt(u),this.addDirectedFillet(o,le,ct,M,B),this._segList.addPt(g)}},{key:"addLastSegment",value:function(){this._segList.addPt(this._offset1.p1)}},{key:"initSideSegments",value:function(o,u,g){this._s1=o,this._s2=u,this._side=g,this._seg1.setCoordinates(o,u),this.computeOffsetSegment(this._seg1,g,this._distance,this._offset1)}},{key:"addLimitedMitreJoin",value:function(o,u,g,M){var B=this._seg0.p1,G=da.angle(B,this._seg0.p0),K=da.angleBetweenOriented(this._seg0.p0,B,this._seg1.p1)/2,le=da.normalize(G+K),_e=da.normalize(le+Math.PI),Ke=M*g,ct=g-Ke*Math.abs(Math.sin(K)),Bt=B.x+Ke*Math.cos(_e),Jt=B.y+Ke*Math.sin(_e),sn=new Qe(Bt,Jt),pn=new Ur(B,sn),Nn=pn.pointAlongOffset(1,ct),In=pn.pointAlongOffset(1,-ct);this._side===Yt.LEFT?(this._segList.addPt(Nn),this._segList.addPt(In)):(this._segList.addPt(In),this._segList.addPt(Nn))}},{key:"addDirectedFillet",value:function(o,u,g,M,B){var G=M===Ee.CLOCKWISE?-1:1,K=Math.abs(u-g),le=Math.trunc(K/this._filletAngleQuantum+.5);if(le<1)return null;for(var _e=K/le,Ke=new Qe,ct=0;ct<le;ct++){var Bt=u+G*ct*_e;Ke.x=o.x+B*Math.cos(Bt),Ke.y=o.y+B*Math.sin(Bt),this._segList.addPt(Ke)}}},{key:"computeOffsetSegment",value:function(o,u,g,M){var B=u===Yt.LEFT?1:-1,G=o.p1.x-o.p0.x,K=o.p1.y-o.p0.y,le=Math.sqrt(G*G+K*K),_e=B*g*G/le,Ke=B*g*K/le;M.p0.x=o.p0.x-Ke,M.p0.y=o.p0.y+_e,M.p1.x=o.p1.x-Ke,M.p1.y=o.p1.y+_e}},{key:"addInsideTurn",value:function(o,u){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*_.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var g=new Qe((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(g);var M=new Qe((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(M)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}}},{key:"createCircle",value:function(o){var u=new Qe(o.x+this._distance,o.y);this._segList.addPt(u),this.addDirectedFillet(o,0,2*Math.PI,-1,this._distance),this._segList.closeRing()}},{key:"addBevelJoin",value:function(o,u){this._segList.addPt(o.p1),this._segList.addPt(u.p0)}},{key:"init",value:function(o){this._distance=o,this._maxCurveSegmentError=o*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Xo,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(o*_.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)}},{key:"addCollinear",value:function(o){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===at.JOIN_BEVEL||this._bufParams.getJoinStyle()===at.JOIN_MITRE?(o&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addCornerFillet(this._s1,this._offset0.p1,this._offset1.p0,Ee.CLOCKWISE,this._distance))}},{key:"closeRing",value:function(){this._segList.closeRing()}},{key:"hasNarrowConcaveAngle",value:function(){return this._hasNarrowConcaveAngle}}],[{key:"constructor_",value:function(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Ur,this._seg1=new Ur,this._offset0=new Ur,this._offset1=new Ur,this._side=0,this._hasNarrowConcaveAngle=!1;var o=arguments[0],u=arguments[1],g=arguments[2];this._precisionModel=o,this._bufParams=u,this._li=new Ya,this._filletAngleQuantum=Math.PI/2/u.getQuadrantSegments(),u.getQuadrantSegments()>=8&&u.getJoinStyle()===at.JOIN_ROUND&&(this._closingSegLengthFactor=_.MAX_CLOSING_SEG_LEN_FACTOR),this.init(g)}}])})();$s.OFFSET_SEGMENT_SEPARATION_FACTOR=.001,$s.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR=.001,$s.CURVE_VERTEX_SNAP_DISTANCE_FACTOR=1e-6,$s.MAX_CLOSING_SEG_LEN_FACTOR=80;var El=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getOffsetCurve",value:function(o,u){if(this._distance=u,u===0)return null;var g=u<0,M=Math.abs(u),B=this.getSegGen(M);o.length<=1?this.computePointCurve(o[0],B):this.computeOffsetCurve(o,g,B);var G=B.getCoordinates();return g&&pi.reverse(G),G}},{key:"computeSingleSidedBufferCurve",value:function(o,u,g){var M=this.simplifyTolerance(this._distance);if(u){g.addSegments(o,!0);var B=va.simplify(o,-M),G=B.length-1;g.initSideSegments(B[G],B[G-1],Yt.LEFT),g.addFirstSegment();for(var K=G-2;K>=0;K--)g.addNextSegment(B[K],!0)}else{g.addSegments(o,!1);var le=va.simplify(o,M),_e=le.length-1;g.initSideSegments(le[0],le[1],Yt.LEFT),g.addFirstSegment();for(var Ke=2;Ke<=_e;Ke++)g.addNextSegment(le[Ke],!0)}g.addLastSegment(),g.closeRing()}},{key:"computeRingBufferCurve",value:function(o,u,g){var M=this.simplifyTolerance(this._distance);u===Yt.RIGHT&&(M=-M);var B=va.simplify(o,M),G=B.length-1;g.initSideSegments(B[G-1],B[0],u);for(var K=1;K<=G;K++){var le=K!==1;g.addNextSegment(B[K],le)}g.closeRing()}},{key:"computeLineBufferCurve",value:function(o,u){var g=this.simplifyTolerance(this._distance),M=va.simplify(o,g),B=M.length-1;u.initSideSegments(M[0],M[1],Yt.LEFT);for(var G=2;G<=B;G++)u.addNextSegment(M[G],!0);u.addLastSegment(),u.addLineEndCap(M[B-1],M[B]);var K=va.simplify(o,-g),le=K.length-1;u.initSideSegments(K[le],K[le-1],Yt.LEFT);for(var _e=le-2;_e>=0;_e--)u.addNextSegment(K[_e],!0);u.addLastSegment(),u.addLineEndCap(K[1],K[0]),u.closeRing()}},{key:"computePointCurve",value:function(o,u){switch(this._bufParams.getEndCapStyle()){case at.CAP_ROUND:u.createCircle(o);break;case at.CAP_SQUARE:u.createSquare(o)}}},{key:"getLineCurve",value:function(o,u){if(this._distance=u,this.isLineOffsetEmpty(u))return null;var g=Math.abs(u),M=this.getSegGen(g);if(o.length<=1)this.computePointCurve(o[0],M);else if(this._bufParams.isSingleSided()){var B=u<0;this.computeSingleSidedBufferCurve(o,B,M)}else this.computeLineBufferCurve(o,M);return M.getCoordinates()}},{key:"getBufferParameters",value:function(){return this._bufParams}},{key:"simplifyTolerance",value:function(o){return o*this._bufParams.getSimplifyFactor()}},{key:"getRingCurve",value:function(o,u,g){if(this._distance=g,o.length<=2)return this.getLineCurve(o,g);if(g===0)return _.copyCoordinates(o);var M=this.getSegGen(g);return this.computeRingBufferCurve(o,u,M),M.getCoordinates()}},{key:"computeOffsetCurve",value:function(o,u,g){var M=this.simplifyTolerance(this._distance);if(u){var B=va.simplify(o,-M),G=B.length-1;g.initSideSegments(B[G],B[G-1],Yt.LEFT),g.addFirstSegment();for(var K=G-2;K>=0;K--)g.addNextSegment(B[K],!0)}else{var le=va.simplify(o,M),_e=le.length-1;g.initSideSegments(le[0],le[1],Yt.LEFT),g.addFirstSegment();for(var Ke=2;Ke<=_e;Ke++)g.addNextSegment(le[Ke],!0)}g.addLastSegment()}},{key:"isLineOffsetEmpty",value:function(o){return o===0||o<0&&!this._bufParams.isSingleSided()}},{key:"getSegGen",value:function(o){return new $s(this._precisionModel,this._bufParams,o)}}],[{key:"constructor_",value:function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var o=arguments[0],u=arguments[1];this._precisionModel=o,this._bufParams=u}},{key:"copyCoordinates",value:function(o){for(var u=new Array(o.length).fill(null),g=0;g<u.length;g++)u[g]=new Qe(o[g]);return u}}])})(),$o=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"findStabbedSegments",value:function(){if(arguments.length===1){for(var _=arguments[0],o=new Ze,u=this._subgraphs.iterator();u.hasNext();){var g=u.next(),M=g.getEnvelope();_.y<M.getMinY()||_.y>M.getMaxY()||this.findStabbedSegments(_,g.getDirectedEdges(),o)}return o}if(arguments.length===3){if(dn(arguments[2],Nr)&&arguments[0]instanceof Qe&&arguments[1]instanceof Br){for(var B=arguments[0],G=arguments[1],K=arguments[2],le=G.getEdge().getCoordinates(),_e=0;_e<le.length-1;_e++)if(this._seg.p0=le[_e],this._seg.p1=le[_e+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<B.x||this._seg.isHorizontal()||B.y<this._seg.p0.y||B.y>this._seg.p1.y||Ee.index(this._seg.p0,this._seg.p1,B)===Ee.RIGHT)){var Ke=G.getDepth(Yt.LEFT);this._seg.p0.equals(le[_e])||(Ke=G.getDepth(Yt.RIGHT));var ct=new Ui(this._seg,Ke);K.add(ct)}}else if(dn(arguments[2],Nr)&&arguments[0]instanceof Qe&&dn(arguments[1],Nr))for(var Bt=arguments[0],Jt=arguments[2],sn=arguments[1].iterator();sn.hasNext();){var pn=sn.next();pn.isForward()&&this.findStabbedSegments(Bt,pn,Jt)}}}},{key:"getDepth",value:function(_){var o=this.findStabbedSegments(_);return o.size()===0?0:bn.min(o)._leftDepth}}],[{key:"constructor_",value:function(){this._subgraphs=null,this._seg=new Ur;var _=arguments[0];this._subgraphs=_}}])})(),Ui=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"compareTo",value:function(_){var o=_;if(this._upwardSeg.minX()>=o._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=o._upwardSeg.minX())return-1;var u=this._upwardSeg.orientationIndex(o._upwardSeg);return u!==0||(u=-1*o._upwardSeg.orientationIndex(this._upwardSeg))!==0?u:this._upwardSeg.compareTo(o._upwardSeg)}},{key:"compareX",value:function(_,o){var u=_.p0.compareTo(o.p0);return u!==0?u:_.p1.compareTo(o.p1)}},{key:"toString",value:function(){return this._upwardSeg.toString()}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._upwardSeg=null,this._leftDepth=null;var _=arguments[0],o=arguments[1];this._upwardSeg=new Ur(_),this._leftDepth=o}}])})();$o.DepthSegment=Ui;var Wo=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,null,[{key:"constructor_",value:function(){jt.constructor_.call(this,"Projective point not representable on the Cartesian plane.")}}])})(jt),vo=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getY",value:function(){var o=this.y/this.w;if(vt.isNaN(o)||vt.isInfinite(o))throw new Wo;return o}},{key:"getX",value:function(){var o=this.x/this.w;if(vt.isNaN(o)||vt.isInfinite(o))throw new Wo;return o}},{key:"getCoordinate",value:function(){var o=new Qe;return o.x=this.getX(),o.y=this.getY(),o}}],[{key:"constructor_",value:function(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var o=arguments[0];this.x=o.x,this.y=o.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var u=arguments[0],g=arguments[1];this.x=u,this.y=g,this.w=1}else if(arguments[0]instanceof _&&arguments[1]instanceof _){var M=arguments[0],B=arguments[1];this.x=M.y*B.w-B.y*M.w,this.y=B.x*M.w-M.x*B.w,this.w=M.x*B.y-B.x*M.y}else if(arguments[0]instanceof Qe&&arguments[1]instanceof Qe){var G=arguments[0],K=arguments[1];this.x=G.y-K.y,this.y=K.x-G.x,this.w=G.x*K.y-K.x*G.y}}else if(arguments.length===3){var le=arguments[0],_e=arguments[1],Ke=arguments[2];this.x=le,this.y=_e,this.w=Ke}else if(arguments.length===4){var ct=arguments[0],Bt=arguments[1],Jt=arguments[2],sn=arguments[3],pn=ct.y-Bt.y,Nn=Bt.x-ct.x,In=ct.x*Bt.y-Bt.x*ct.y,hi=Jt.y-sn.y,hr=sn.x-Jt.x,gi=Jt.x*sn.y-sn.x*Jt.y;this.x=Nn*gi-hr*In,this.y=hi*In-pn*gi,this.w=pn*hr-hi*Nn}}}])})(),Ml=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"area",value:function(){return _.area(this.p0,this.p1,this.p2)}},{key:"signedArea",value:function(){return _.signedArea(this.p0,this.p1,this.p2)}},{key:"interpolateZ",value:function(o){if(o===null)throw new At("Supplied point is null.");return _.interpolateZ(o,this.p0,this.p1,this.p2)}},{key:"longestSideLength",value:function(){return _.longestSideLength(this.p0,this.p1,this.p2)}},{key:"isAcute",value:function(){return _.isAcute(this.p0,this.p1,this.p2)}},{key:"circumcentre",value:function(){return _.circumcentre(this.p0,this.p1,this.p2)}},{key:"area3D",value:function(){return _.area3D(this.p0,this.p1,this.p2)}},{key:"centroid",value:function(){return _.centroid(this.p0,this.p1,this.p2)}},{key:"inCentre",value:function(){return _.inCentre(this.p0,this.p1,this.p2)}}],[{key:"constructor_",value:function(){this.p0=null,this.p1=null,this.p2=null;var o=arguments[0],u=arguments[1],g=arguments[2];this.p0=o,this.p1=u,this.p2=g}},{key:"area",value:function(o,u,g){return Math.abs(((g.x-o.x)*(u.y-o.y)-(u.x-o.x)*(g.y-o.y))/2)}},{key:"signedArea",value:function(o,u,g){return((g.x-o.x)*(u.y-o.y)-(u.x-o.x)*(g.y-o.y))/2}},{key:"det",value:function(o,u,g,M){return o*M-u*g}},{key:"interpolateZ",value:function(o,u,g,M){var B=u.x,G=u.y,K=g.x-B,le=M.x-B,_e=g.y-G,Ke=M.y-G,ct=K*Ke-le*_e,Bt=o.x-B,Jt=o.y-G,sn=(Ke*Bt-le*Jt)/ct,pn=(-_e*Bt+K*Jt)/ct;return u.getZ()+sn*(g.getZ()-u.getZ())+pn*(M.getZ()-u.getZ())}},{key:"longestSideLength",value:function(o,u,g){var M=o.distance(u),B=u.distance(g),G=g.distance(o),K=M;return B>K&&(K=B),G>K&&(K=G),K}},{key:"circumcentreDD",value:function(o,u,g){var M=te.valueOf(o.x).subtract(g.x),B=te.valueOf(o.y).subtract(g.y),G=te.valueOf(u.x).subtract(g.x),K=te.valueOf(u.y).subtract(g.y),le=te.determinant(M,B,G,K).multiply(2),_e=M.sqr().add(B.sqr()),Ke=G.sqr().add(K.sqr()),ct=te.determinant(B,_e,K,Ke),Bt=te.determinant(M,_e,G,Ke),Jt=te.valueOf(g.x).subtract(ct.divide(le)).doubleValue(),sn=te.valueOf(g.y).add(Bt.divide(le)).doubleValue();return new Qe(Jt,sn)}},{key:"isAcute",value:function(o,u,g){return!!da.isAcute(o,u,g)&&!!da.isAcute(u,g,o)&&!!da.isAcute(g,o,u)}},{key:"circumcentre",value:function(o,u,g){var M=g.x,B=g.y,G=o.x-M,K=o.y-B,le=u.x-M,_e=u.y-B,Ke=2*_.det(G,K,le,_e),ct=_.det(K,G*G+K*K,_e,le*le+_e*_e),Bt=_.det(G,G*G+K*K,le,le*le+_e*_e);return new Qe(M-ct/Ke,B+Bt/Ke)}},{key:"perpendicularBisector",value:function(o,u){var g=u.x-o.x,M=u.y-o.y,B=new vo(o.x+g/2,o.y+M/2,1),G=new vo(o.x-M+g/2,o.y+g+M/2,1);return new vo(B,G)}},{key:"angleBisector",value:function(o,u,g){var M=u.distance(o),B=M/(M+u.distance(g)),G=g.x-o.x,K=g.y-o.y;return new Qe(o.x+B*G,o.y+B*K)}},{key:"area3D",value:function(o,u,g){var M=u.x-o.x,B=u.y-o.y,G=u.getZ()-o.getZ(),K=g.x-o.x,le=g.y-o.y,_e=g.getZ()-o.getZ(),Ke=B*_e-G*le,ct=G*K-M*_e,Bt=M*le-B*K,Jt=Ke*Ke+ct*ct+Bt*Bt,sn=Math.sqrt(Jt)/2;return sn}},{key:"centroid",value:function(o,u,g){var M=(o.x+u.x+g.x)/3,B=(o.y+u.y+g.y)/3;return new Qe(M,B)}},{key:"inCentre",value:function(o,u,g){var M=u.distance(g),B=o.distance(g),G=o.distance(u),K=M+B+G,le=(M*o.x+B*u.x+G*g.x)/K,_e=(M*o.y+B*u.y+G*g.y)/K;return new Qe(le,_e)}}])})(),xo=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"addRingSide",value:function(_,o,u,g,M){if(o===0&&_.length<Mn.MINIMUM_VALID_SIZE)return null;var B=g,G=M;_.length>=Mn.MINIMUM_VALID_SIZE&&Ee.isCCW(_)&&(B=M,G=g,u=Yt.opposite(u));var K=this._curveBuilder.getRingCurve(_,u,o);this.addCurve(K,B,G)}},{key:"addRingBothSides",value:function(_,o){this.addRingSide(_,o,Yt.LEFT,Re.EXTERIOR,Re.INTERIOR),this.addRingSide(_,o,Yt.RIGHT,Re.INTERIOR,Re.EXTERIOR)}},{key:"addPoint",value:function(_){if(this._distance<=0)return null;var o=_.getCoordinates(),u=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(u,Re.EXTERIOR,Re.INTERIOR)}},{key:"addPolygon",value:function(_){var o=this._distance,u=Yt.LEFT;this._distance<0&&(o=-this._distance,u=Yt.RIGHT);var g=_.getExteriorRing(),M=pi.removeRepeatedPoints(g.getCoordinates());if(this._distance<0&&this.isErodedCompletely(g,this._distance)||this._distance<=0&&M.length<3)return null;this.addRingSide(M,o,u,Re.EXTERIOR,Re.INTERIOR);for(var B=0;B<_.getNumInteriorRing();B++){var G=_.getInteriorRingN(B),K=pi.removeRepeatedPoints(G.getCoordinates());this._distance>0&&this.isErodedCompletely(G,-this._distance)||this.addRingSide(K,o,Yt.opposite(u),Re.INTERIOR,Re.EXTERIOR)}}},{key:"isTriangleErodedCompletely",value:function(_,o){var u=new Ml(_[0],_[1],_[2]),g=u.inCentre();return zn.pointToSegment(g,u.p0,u.p1)<Math.abs(o)}},{key:"addLineString",value:function(_){if(this._curveBuilder.isLineOffsetEmpty(this._distance))return null;var o=pi.removeRepeatedPoints(_.getCoordinates());if(pi.isRing(o)&&!this._curveBuilder.getBufferParameters().isSingleSided())this.addRingBothSides(o,this._distance);else{var u=this._curveBuilder.getLineCurve(o,this._distance);this.addCurve(u,Re.EXTERIOR,Re.INTERIOR)}}},{key:"addCurve",value:function(_,o,u){if(_===null||_.length<2)return null;var g=new Ra(_,new Kr(0,Re.BOUNDARY,o,u));this._curveList.add(g)}},{key:"getCurves",value:function(){return this.add(this._inputGeom),this._curveList}},{key:"add",value:function(_){if(_.isEmpty())return null;if(_ instanceof _r)this.addPolygon(_);else if(_ instanceof ki)this.addLineString(_);else if(_ instanceof ji)this.addPoint(_);else if(_ instanceof Sn)this.addCollection(_);else if(_ instanceof Is)this.addCollection(_);else if(_ instanceof Er)this.addCollection(_);else{if(!(_ instanceof Ut))throw new Pn(_.getGeometryType());this.addCollection(_)}}},{key:"isErodedCompletely",value:function(_,o){var u=_.getCoordinates();if(u.length<4)return o<0;if(u.length===4)return this.isTriangleErodedCompletely(u,o);var g=_.getEnvelopeInternal(),M=Math.min(g.getHeight(),g.getWidth());return o<0&&2*Math.abs(o)>M}},{key:"addCollection",value:function(_){for(var o=0;o<_.getNumGeometries();o++){var u=_.getGeometryN(o);this.add(u)}}}],[{key:"constructor_",value:function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Ze;var _=arguments[0],o=arguments[1],u=arguments[2];this._inputGeom=_,this._distance=o,this._curveBuilder=u}}])})(),Ch=(function(){return c((function _(){D(this,_)}),[{key:"locate",value:function(_){}}])})(),ou=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"next",value:function(){if(this._atStart)return this._atStart=!1,_.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Dn;var o=this._parent.getGeometryN(this._index++);return o instanceof Ut?(this._subcollectionIterator=new _(o),this._subcollectionIterator.next()):o}},{key:"remove",value:function(){throw new Pn(this.getClass().getName())}},{key:"hasNext",value:function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)}},{key:"interfaces_",get:function(){return[If]}}],[{key:"constructor_",value:function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var o=arguments[0];this._parent=o,this._atStart=!0,this._index=0,this._max=o.getNumGeometries()}},{key:"isAtomic",value:function(o){return!(o instanceof Ut)}}])})(),Ih=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"locate",value:function(o){return _.locate(o,this._geom)}},{key:"interfaces_",get:function(){return[Ch]}}],[{key:"constructor_",value:function(){this._geom=null;var o=arguments[0];this._geom=o}},{key:"locatePointInPolygon",value:function(o,u){if(u.isEmpty())return Re.EXTERIOR;var g=u.getExteriorRing(),M=_.locatePointInRing(o,g);if(M!==Re.INTERIOR)return M;for(var B=0;B<u.getNumInteriorRing();B++){var G=u.getInteriorRingN(B),K=_.locatePointInRing(o,G);if(K===Re.BOUNDARY)return Re.BOUNDARY;if(K===Re.INTERIOR)return Re.EXTERIOR}return Re.INTERIOR}},{key:"locatePointInRing",value:function(o,u){return u.getEnvelopeInternal().intersects(o)?Pa.locateInRing(o,u.getCoordinates()):Re.EXTERIOR}},{key:"containsPointInPolygon",value:function(o,u){return Re.EXTERIOR!==_.locatePointInPolygon(o,u)}},{key:"locateInGeometry",value:function(o,u){if(u instanceof _r)return _.locatePointInPolygon(o,u);if(u instanceof Ut)for(var g=new ou(u);g.hasNext();){var M=g.next();if(M!==u){var B=_.locateInGeometry(o,M);if(B!==Re.EXTERIOR)return B}}return Re.EXTERIOR}},{key:"isContained",value:function(o,u){return Re.EXTERIOR!==_.locate(o,u)}},{key:"locate",value:function(o,u){return u.isEmpty()?Re.EXTERIOR:u.getEnvelopeInternal().intersects(o)?_.locateInGeometry(o,u):Re.EXTERIOR}}])})(),fs=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"getNextCW",value:function(_){this.getEdges();var o=this._edgeList.indexOf(_),u=o-1;return o===0&&(u=this._edgeList.size()-1),this._edgeList.get(u)}},{key:"propagateSideLabels",value:function(_){for(var o=Re.NONE,u=this.iterator();u.hasNext();){var g=u.next().getLabel();g.isArea(_)&&g.getLocation(_,Yt.LEFT)!==Re.NONE&&(o=g.getLocation(_,Yt.LEFT))}if(o===Re.NONE)return null;for(var M=o,B=this.iterator();B.hasNext();){var G=B.next(),K=G.getLabel();if(K.getLocation(_,Yt.ON)===Re.NONE&&K.setLocation(_,Yt.ON,M),K.isArea(_)){var le=K.getLocation(_,Yt.LEFT),_e=K.getLocation(_,Yt.RIGHT);if(_e!==Re.NONE){if(_e!==M)throw new Je("side location conflict",G.getCoordinate());le===Re.NONE&&Ct.shouldNeverReachHere("found single null side (at "+G.getCoordinate()+")"),M=le}else Ct.isTrue(K.getLocation(_,Yt.LEFT)===Re.NONE,"found single null side"),K.setLocation(_,Yt.RIGHT,M),K.setLocation(_,Yt.LEFT,M)}}}},{key:"getCoordinate",value:function(){var _=this.iterator();return _.hasNext()?_.next().getCoordinate():null}},{key:"print",value:function(_){Qt.out.println("EdgeEndStar:   "+this.getCoordinate());for(var o=this.iterator();o.hasNext();)o.next().print(_)}},{key:"isAreaLabelsConsistent",value:function(_){return this.computeEdgeEndLabels(_.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)}},{key:"checkAreaLabelsConsistent",value:function(_){var o=this.getEdges();if(o.size()<=0)return!0;var u=o.size()-1,g=o.get(u).getLabel().getLocation(_,Yt.LEFT);Ct.isTrue(g!==Re.NONE,"Found unlabelled area edge");for(var M=g,B=this.iterator();B.hasNext();){var G=B.next().getLabel();Ct.isTrue(G.isArea(_),"Found non-area edge");var K=G.getLocation(_,Yt.LEFT),le=G.getLocation(_,Yt.RIGHT);if(K===le||le!==M)return!1;M=K}return!0}},{key:"findIndex",value:function(_){this.iterator();for(var o=0;o<this._edgeList.size();o++)if(this._edgeList.get(o)===_)return o;return-1}},{key:"iterator",value:function(){return this.getEdges().iterator()}},{key:"getEdges",value:function(){return this._edgeList===null&&(this._edgeList=new Ze(this._edgeMap.values())),this._edgeList}},{key:"getLocation",value:function(_,o,u){return this._ptInAreaLocation[_]===Re.NONE&&(this._ptInAreaLocation[_]=Ih.locate(o,u[_].getGeometry())),this._ptInAreaLocation[_]}},{key:"toString",value:function(){var _=new Sr;_.append("EdgeEndStar:   "+this.getCoordinate()),_.append(`
`);for(var o=this.iterator();o.hasNext();){var u=o.next();_.append(u),_.append(`
`)}return _.toString()}},{key:"computeEdgeEndLabels",value:function(_){for(var o=this.iterator();o.hasNext();)o.next().computeLabel(_)}},{key:"computeLabelling",value:function(_){this.computeEdgeEndLabels(_[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var o=[!1,!1],u=this.iterator();u.hasNext();)for(var g=u.next().getLabel(),M=0;M<2;M++)g.isLine(M)&&g.getLocation(M)===Re.BOUNDARY&&(o[M]=!0);for(var B=this.iterator();B.hasNext();)for(var G=B.next(),K=G.getLabel(),le=0;le<2;le++)if(K.isAnyNull(le)){var _e=Re.NONE;if(o[le])_e=Re.EXTERIOR;else{var Ke=G.getCoordinate();_e=this.getLocation(le,Ke,_)}K.setAllLocationsIfNull(le,_e)}}},{key:"getDegree",value:function(){return this._edgeMap.size()}},{key:"insertEdgeEnd",value:function(_,o){this._edgeMap.put(_,o),this._edgeList=null}}],[{key:"constructor_",value:function(){this._edgeMap=new ci,this._edgeList=null,this._ptInAreaLocation=[Re.NONE,Re.NONE]}}])})(),$u=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"linkResultDirectedEdges",value:function(){this.getResultAreaEdges();for(var u=null,g=null,M=this._SCANNING_FOR_INCOMING,B=0;B<this._resultAreaEdgeList.size();B++){var G=this._resultAreaEdgeList.get(B),K=G.getSym();if(G.getLabel().isArea())switch(u===null&&G.isInResult()&&(u=G),M){case this._SCANNING_FOR_INCOMING:if(!K.isInResult())continue;g=K,M=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!G.isInResult())continue;g.setNext(G),M=this._SCANNING_FOR_INCOMING}}if(M===this._LINKING_TO_OUTGOING){if(u===null)throw new Je("no outgoing dirEdge found",this.getCoordinate());Ct.isTrue(u.isInResult(),"unable to link last incoming dirEdge"),g.setNext(u)}}},{key:"insert",value:function(u){var g=u;this.insertEdgeEnd(g,g)}},{key:"getRightmostEdge",value:function(){var u=this.getEdges(),g=u.size();if(g<1)return null;var M=u.get(0);if(g===1)return M;var B=u.get(g-1),G=M.getQuadrant(),K=B.getQuadrant();return Si.isNorthern(G)&&Si.isNorthern(K)?M:Si.isNorthern(G)||Si.isNorthern(K)?M.getDy()!==0?M:B.getDy()!==0?B:(Ct.shouldNeverReachHere("found two horizontal edges incident on node"),null):B}},{key:"print",value:function(u){Qt.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var g=this.iterator();g.hasNext();){var M=g.next();u.print("out "),M.print(u),u.println(),u.print("in "),M.getSym().print(u),u.println()}}},{key:"getResultAreaEdges",value:function(){if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Ze;for(var u=this.iterator();u.hasNext();){var g=u.next();(g.isInResult()||g.getSym().isInResult())&&this._resultAreaEdgeList.add(g)}return this._resultAreaEdgeList}},{key:"updateLabelling",value:function(u){for(var g=this.iterator();g.hasNext();){var M=g.next().getLabel();M.setAllLocationsIfNull(0,u.getLocation(0)),M.setAllLocationsIfNull(1,u.getLocation(1))}}},{key:"linkAllDirectedEdges",value:function(){this.getEdges();for(var u=null,g=null,M=this._edgeList.size()-1;M>=0;M--){var B=this._edgeList.get(M),G=B.getSym();g===null&&(g=G),u!==null&&G.setNext(u),u=B}g.setNext(u)}},{key:"computeDepths",value:function(){if(arguments.length===1){var u=arguments[0],g=this.findIndex(u),M=u.getDepth(Yt.LEFT),B=u.getDepth(Yt.RIGHT),G=this.computeDepths(g+1,this._edgeList.size(),M);if(this.computeDepths(0,g,G)!==B)throw new Je("depth mismatch at "+u.getCoordinate())}else if(arguments.length===3){for(var K=arguments[1],le=arguments[2],_e=arguments[0];_e<K;_e++){var Ke=this._edgeList.get(_e);Ke.setEdgeDepths(Yt.RIGHT,le),le=Ke.getDepth(Yt.LEFT)}return le}}},{key:"mergeSymLabels",value:function(){for(var u=this.iterator();u.hasNext();){var g=u.next();g.getLabel().merge(g.getSym().getLabel())}}},{key:"linkMinimalDirectedEdges",value:function(u){for(var g=null,M=null,B=this._SCANNING_FOR_INCOMING,G=this._resultAreaEdgeList.size()-1;G>=0;G--){var K=this._resultAreaEdgeList.get(G),le=K.getSym();switch(g===null&&K.getEdgeRing()===u&&(g=K),B){case this._SCANNING_FOR_INCOMING:if(le.getEdgeRing()!==u)continue;M=le,B=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(K.getEdgeRing()!==u)continue;M.setNextMin(K),B=this._SCANNING_FOR_INCOMING}}B===this._LINKING_TO_OUTGOING&&(Ct.isTrue(g!==null,"found null for first outgoing dirEdge"),Ct.isTrue(g.getEdgeRing()===u,"unable to link last incoming dirEdge"),M.setNextMin(g))}},{key:"getOutgoingDegree",value:function(){if(arguments.length===0){for(var u=0,g=this.iterator();g.hasNext();)g.next().isInResult()&&u++;return u}if(arguments.length===1){for(var M=arguments[0],B=0,G=this.iterator();G.hasNext();)G.next().getEdgeRing()===M&&B++;return B}}},{key:"getLabel",value:function(){return this._label}},{key:"findCoveredLineEdges",value:function(){for(var u=Re.NONE,g=this.iterator();g.hasNext();){var M=g.next(),B=M.getSym();if(!M.isLineEdge()){if(M.isInResult()){u=Re.INTERIOR;break}if(B.isInResult()){u=Re.EXTERIOR;break}}}if(u===Re.NONE)return null;for(var G=u,K=this.iterator();K.hasNext();){var le=K.next(),_e=le.getSym();le.isLineEdge()?le.getEdge().setCovered(G===Re.INTERIOR):(le.isInResult()&&(G=Re.EXTERIOR),_e.isInResult()&&(G=Re.INTERIOR))}}},{key:"computeLabelling",value:function(u){Ge(o,"computeLabelling",this,1).call(this,u),this._label=new Kr(Re.NONE);for(var g=this.iterator();g.hasNext();)for(var M=g.next().getEdge().getLabel(),B=0;B<2;B++){var G=M.getLocation(B);G!==Re.INTERIOR&&G!==Re.BOUNDARY||this._label.setLocation(B,Re.INTERIOR)}}}],[{key:"constructor_",value:function(){this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}}])})(fs),Ah=(function(_){function o(){return D(this,o),I(this,o)}return ie(o,_),c(o,[{key:"createNode",value:function(u){return new ei(u,new $u)}}])})(rr),Uc=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"compareTo",value:function(o){var u=o;return _.compareOriented(this._pts,this._orientation,u._pts,u._orientation)}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this._pts=null,this._orientation=null;var o=arguments[0];this._pts=o,this._orientation=_.orientation(o)}},{key:"orientation",value:function(o){return pi.increasingDirection(o)===1}},{key:"compareOriented",value:function(o,u,g,M){for(var B=u?1:-1,G=M?1:-1,K=u?o.length:-1,le=M?g.length:-1,_e=u?0:o.length-1,Ke=M?0:g.length-1;;){var ct=o[_e].compareTo(g[Ke]);if(ct!==0)return ct;var Bt=(_e+=B)===K,Jt=(Ke+=G)===le;if(Bt&&!Jt)return-1;if(!Bt&&Jt)return 1;if(Bt&&Jt)return 0}}}])})(),Wu=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"print",value:function(_){_.print("MULTILINESTRING ( ");for(var o=0;o<this._edges.size();o++){var u=this._edges.get(o);o>0&&_.print(","),_.print("(");for(var g=u.getCoordinates(),M=0;M<g.length;M++)M>0&&_.print(","),_.print(g[M].x+" "+g[M].y);_.println(")")}_.print(")  ")}},{key:"addAll",value:function(_){for(var o=_.iterator();o.hasNext();)this.add(o.next())}},{key:"findEdgeIndex",value:function(_){for(var o=0;o<this._edges.size();o++)if(this._edges.get(o).equals(_))return o;return-1}},{key:"iterator",value:function(){return this._edges.iterator()}},{key:"getEdges",value:function(){return this._edges}},{key:"get",value:function(_){return this._edges.get(_)}},{key:"findEqualEdge",value:function(_){var o=new Uc(_.getCoordinates());return this._ocaMap.get(o)}},{key:"add",value:function(_){this._edges.add(_);var o=new Uc(_.getCoordinates());this._ocaMap.put(o,_)}}],[{key:"constructor_",value:function(){this._edges=new Ze,this._ocaMap=new ci}}])})(),lu=(function(){return c((function _(){D(this,_)}),[{key:"processIntersections",value:function(_,o,u,g){}},{key:"isDone",value:function(){}}])})(),Ko=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"isTrivialIntersection",value:function(o,u,g,M){if(o===g&&this._li.getIntersectionNum()===1){if(_.isAdjacentSegments(u,M))return!0;if(o.isClosed()){var B=o.size()-1;if(u===0&&M===B||M===0&&u===B)return!0}}return!1}},{key:"getProperIntersectionPoint",value:function(){return this._properIntersectionPoint}},{key:"hasProperInteriorIntersection",value:function(){return this._hasProperInterior}},{key:"getLineIntersector",value:function(){return this._li}},{key:"hasProperIntersection",value:function(){return this._hasProper}},{key:"processIntersections",value:function(o,u,g,M){if(o===g&&u===M)return null;this.numTests++;var B=o.getCoordinates()[u],G=o.getCoordinates()[u+1],K=g.getCoordinates()[M],le=g.getCoordinates()[M+1];this._li.computeIntersection(B,G,K,le),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(o,u,g,M)||(this._hasIntersection=!0,o.addIntersections(this._li,u,0),g.addIntersections(this._li,M,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))}},{key:"hasIntersection",value:function(){return this._hasIntersection}},{key:"isDone",value:function(){return!1}},{key:"hasInteriorIntersection",value:function(){return this._hasInterior}},{key:"interfaces_",get:function(){return[lu]}}],[{key:"constructor_",value:function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var o=arguments[0];this._li=o}},{key:"isAdjacentSegments",value:function(o,u){return Math.abs(o-u)===1}}])})(),Cl=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"getSegmentIndex",value:function(){return this.segmentIndex}},{key:"getCoordinate",value:function(){return this.coord}},{key:"print",value:function(_){_.print(this.coord),_.print(" seg # = "+this.segmentIndex),_.println(" dist = "+this.dist)}},{key:"compareTo",value:function(_){var o=_;return this.compare(o.segmentIndex,o.dist)}},{key:"isEndPoint",value:function(_){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===_}},{key:"toString",value:function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist}},{key:"getDistance",value:function(){return this.dist}},{key:"compare",value:function(_,o){return this.segmentIndex<_?-1:this.segmentIndex>_?1:this.dist<o?-1:this.dist>o?1:0}},{key:"interfaces_",get:function(){return[wt]}}],[{key:"constructor_",value:function(){this.coord=null,this.segmentIndex=null,this.dist=null;var _=arguments[0],o=arguments[1],u=arguments[2];this.coord=new Qe(_),this.segmentIndex=o,this.dist=u}}])})(),kh=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"print",value:function(_){_.println("Intersections:");for(var o=this.iterator();o.hasNext();)o.next().print(_)}},{key:"iterator",value:function(){return this._nodeMap.values().iterator()}},{key:"addSplitEdges",value:function(_){this.addEndpoints();for(var o=this.iterator(),u=o.next();o.hasNext();){var g=o.next(),M=this.createSplitEdge(u,g);_.add(M),u=g}}},{key:"addEndpoints",value:function(){var _=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[_],_,0)}},{key:"createSplitEdge",value:function(_,o){var u=o.segmentIndex-_.segmentIndex+2,g=this.edge.pts[o.segmentIndex],M=o.dist>0||!o.coord.equals2D(g);M||u--;var B=new Array(u).fill(null),G=0;B[G++]=new Qe(_.coord);for(var K=_.segmentIndex+1;K<=o.segmentIndex;K++)B[G++]=this.edge.pts[K];return M&&(B[G]=o.coord),new Ku(B,new Kr(this.edge._label))}},{key:"add",value:function(_,o,u){var g=new Cl(_,o,u),M=this._nodeMap.get(g);return M!==null?M:(this._nodeMap.put(g,g),g)}},{key:"isIntersection",value:function(_){for(var o=this.iterator();o.hasNext();)if(o.next().coord.equals(_))return!0;return!1}}],[{key:"constructor_",value:function(){this._nodeMap=new ci,this.edge=null;var _=arguments[0];this.edge=_}}])})(),uu=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"isIntersects",value:function(){return!this.isDisjoint()}},{key:"isCovers",value:function(){return(_.isTrue(this._matrix[Re.INTERIOR][Re.INTERIOR])||_.isTrue(this._matrix[Re.INTERIOR][Re.BOUNDARY])||_.isTrue(this._matrix[Re.BOUNDARY][Re.INTERIOR])||_.isTrue(this._matrix[Re.BOUNDARY][Re.BOUNDARY]))&&this._matrix[Re.EXTERIOR][Re.INTERIOR]===Nt.FALSE&&this._matrix[Re.EXTERIOR][Re.BOUNDARY]===Nt.FALSE}},{key:"isCoveredBy",value:function(){return(_.isTrue(this._matrix[Re.INTERIOR][Re.INTERIOR])||_.isTrue(this._matrix[Re.INTERIOR][Re.BOUNDARY])||_.isTrue(this._matrix[Re.BOUNDARY][Re.INTERIOR])||_.isTrue(this._matrix[Re.BOUNDARY][Re.BOUNDARY]))&&this._matrix[Re.INTERIOR][Re.EXTERIOR]===Nt.FALSE&&this._matrix[Re.BOUNDARY][Re.EXTERIOR]===Nt.FALSE}},{key:"set",value:function(){if(arguments.length===1)for(var o=arguments[0],u=0;u<o.length;u++){var g=Math.trunc(u/3),M=u%3;this._matrix[g][M]=Nt.toDimensionValue(o.charAt(u))}else if(arguments.length===3){var B=arguments[0],G=arguments[1],K=arguments[2];this._matrix[B][G]=K}}},{key:"isContains",value:function(){return _.isTrue(this._matrix[Re.INTERIOR][Re.INTERIOR])&&this._matrix[Re.EXTERIOR][Re.INTERIOR]===Nt.FALSE&&this._matrix[Re.EXTERIOR][Re.BOUNDARY]===Nt.FALSE}},{key:"setAtLeast",value:function(){if(arguments.length===1)for(var o=arguments[0],u=0;u<o.length;u++){var g=Math.trunc(u/3),M=u%3;this.setAtLeast(g,M,Nt.toDimensionValue(o.charAt(u)))}else if(arguments.length===3){var B=arguments[0],G=arguments[1],K=arguments[2];this._matrix[B][G]<K&&(this._matrix[B][G]=K)}}},{key:"setAtLeastIfValid",value:function(o,u,g){o>=0&&u>=0&&this.setAtLeast(o,u,g)}},{key:"isWithin",value:function(){return _.isTrue(this._matrix[Re.INTERIOR][Re.INTERIOR])&&this._matrix[Re.INTERIOR][Re.EXTERIOR]===Nt.FALSE&&this._matrix[Re.BOUNDARY][Re.EXTERIOR]===Nt.FALSE}},{key:"isTouches",value:function(o,u){return o>u?this.isTouches(u,o):(o===Nt.A&&u===Nt.A||o===Nt.L&&u===Nt.L||o===Nt.L&&u===Nt.A||o===Nt.P&&u===Nt.A||o===Nt.P&&u===Nt.L)&&this._matrix[Re.INTERIOR][Re.INTERIOR]===Nt.FALSE&&(_.isTrue(this._matrix[Re.INTERIOR][Re.BOUNDARY])||_.isTrue(this._matrix[Re.BOUNDARY][Re.INTERIOR])||_.isTrue(this._matrix[Re.BOUNDARY][Re.BOUNDARY]))}},{key:"isOverlaps",value:function(o,u){return o===Nt.P&&u===Nt.P||o===Nt.A&&u===Nt.A?_.isTrue(this._matrix[Re.INTERIOR][Re.INTERIOR])&&_.isTrue(this._matrix[Re.INTERIOR][Re.EXTERIOR])&&_.isTrue(this._matrix[Re.EXTERIOR][Re.INTERIOR]):o===Nt.L&&u===Nt.L&&this._matrix[Re.INTERIOR][Re.INTERIOR]===1&&_.isTrue(this._matrix[Re.INTERIOR][Re.EXTERIOR])&&_.isTrue(this._matrix[Re.EXTERIOR][Re.INTERIOR])}},{key:"isEquals",value:function(o,u){return o===u&&_.isTrue(this._matrix[Re.INTERIOR][Re.INTERIOR])&&this._matrix[Re.INTERIOR][Re.EXTERIOR]===Nt.FALSE&&this._matrix[Re.BOUNDARY][Re.EXTERIOR]===Nt.FALSE&&this._matrix[Re.EXTERIOR][Re.INTERIOR]===Nt.FALSE&&this._matrix[Re.EXTERIOR][Re.BOUNDARY]===Nt.FALSE}},{key:"toString",value:function(){for(var o=new ka("123456789"),u=0;u<3;u++)for(var g=0;g<3;g++)o.setCharAt(3*u+g,Nt.toDimensionSymbol(this._matrix[u][g]));return o.toString()}},{key:"setAll",value:function(o){for(var u=0;u<3;u++)for(var g=0;g<3;g++)this._matrix[u][g]=o}},{key:"get",value:function(o,u){return this._matrix[o][u]}},{key:"transpose",value:function(){var o=this._matrix[1][0];return this._matrix[1][0]=this._matrix[0][1],this._matrix[0][1]=o,o=this._matrix[2][0],this._matrix[2][0]=this._matrix[0][2],this._matrix[0][2]=o,o=this._matrix[2][1],this._matrix[2][1]=this._matrix[1][2],this._matrix[1][2]=o,this}},{key:"matches",value:function(o){if(o.length!==9)throw new At("Should be length 9: "+o);for(var u=0;u<3;u++)for(var g=0;g<3;g++)if(!_.matches(this._matrix[u][g],o.charAt(3*u+g)))return!1;return!0}},{key:"add",value:function(o){for(var u=0;u<3;u++)for(var g=0;g<3;g++)this.setAtLeast(u,g,o.get(u,g))}},{key:"isDisjoint",value:function(){return this._matrix[Re.INTERIOR][Re.INTERIOR]===Nt.FALSE&&this._matrix[Re.INTERIOR][Re.BOUNDARY]===Nt.FALSE&&this._matrix[Re.BOUNDARY][Re.INTERIOR]===Nt.FALSE&&this._matrix[Re.BOUNDARY][Re.BOUNDARY]===Nt.FALSE}},{key:"isCrosses",value:function(o,u){return o===Nt.P&&u===Nt.L||o===Nt.P&&u===Nt.A||o===Nt.L&&u===Nt.A?_.isTrue(this._matrix[Re.INTERIOR][Re.INTERIOR])&&_.isTrue(this._matrix[Re.INTERIOR][Re.EXTERIOR]):o===Nt.L&&u===Nt.P||o===Nt.A&&u===Nt.P||o===Nt.A&&u===Nt.L?_.isTrue(this._matrix[Re.INTERIOR][Re.INTERIOR])&&_.isTrue(this._matrix[Re.EXTERIOR][Re.INTERIOR]):o===Nt.L&&u===Nt.L&&this._matrix[Re.INTERIOR][Re.INTERIOR]===0}},{key:"interfaces_",get:function(){return[oe]}}],[{key:"constructor_",value:function(){if(this._matrix=null,arguments.length===0)this._matrix=Array(3).fill().map((function(){return Array(3)})),this.setAll(Nt.FALSE);else if(arguments.length===1){if(typeof arguments[0]=="string"){var o=arguments[0];_.constructor_.call(this),this.set(o)}else if(arguments[0]instanceof _){var u=arguments[0];_.constructor_.call(this),this._matrix[Re.INTERIOR][Re.INTERIOR]=u._matrix[Re.INTERIOR][Re.INTERIOR],this._matrix[Re.INTERIOR][Re.BOUNDARY]=u._matrix[Re.INTERIOR][Re.BOUNDARY],this._matrix[Re.INTERIOR][Re.EXTERIOR]=u._matrix[Re.INTERIOR][Re.EXTERIOR],this._matrix[Re.BOUNDARY][Re.INTERIOR]=u._matrix[Re.BOUNDARY][Re.INTERIOR],this._matrix[Re.BOUNDARY][Re.BOUNDARY]=u._matrix[Re.BOUNDARY][Re.BOUNDARY],this._matrix[Re.BOUNDARY][Re.EXTERIOR]=u._matrix[Re.BOUNDARY][Re.EXTERIOR],this._matrix[Re.EXTERIOR][Re.INTERIOR]=u._matrix[Re.EXTERIOR][Re.INTERIOR],this._matrix[Re.EXTERIOR][Re.BOUNDARY]=u._matrix[Re.EXTERIOR][Re.BOUNDARY],this._matrix[Re.EXTERIOR][Re.EXTERIOR]=u._matrix[Re.EXTERIOR][Re.EXTERIOR]}}}},{key:"matches",value:function(){if(Number.isInteger(arguments[0])&&typeof arguments[1]=="string"){var o=arguments[0],u=arguments[1];return u===Nt.SYM_DONTCARE||u===Nt.SYM_TRUE&&(o>=0||o===Nt.TRUE)||u===Nt.SYM_FALSE&&o===Nt.FALSE||u===Nt.SYM_P&&o===Nt.P||u===Nt.SYM_L&&o===Nt.L||u===Nt.SYM_A&&o===Nt.A}if(typeof arguments[0]=="string"&&typeof arguments[1]=="string"){var g=arguments[1];return new _(arguments[0]).matches(g)}}},{key:"isTrue",value:function(o){return o>=0||o===Nt.TRUE}}])})(),bo=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"size",value:function(){return this._size}},{key:"addAll",value:function(o){return o===null||o.length===0?null:(this.ensureCapacity(this._size+o.length),Qt.arraycopy(o,0,this._data,this._size,o.length),void(this._size+=o.length))}},{key:"ensureCapacity",value:function(o){if(o<=this._data.length)return null;var u=Math.max(o,2*this._data.length);this._data=Aa.copyOf(this._data,u)}},{key:"toArray",value:function(){var o=new Array(this._size).fill(null);return Qt.arraycopy(this._data,0,o,0,this._size),o}},{key:"add",value:function(o){this.ensureCapacity(this._size+1),this._data[this._size]=o,++this._size}}],[{key:"constructor_",value:function(){if(this._data=null,this._size=0,arguments.length===0)_.constructor_.call(this,10);else if(arguments.length===1){var o=arguments[0];this._data=new Array(o).fill(null)}}}])})(),Vc=(function(){function _(){D(this,_)}return c(_,[{key:"getChainStartIndices",value:function(o){var u=0,g=new bo(Math.trunc(o.length/2));g.add(u);do{var M=this.findChainEnd(o,u);g.add(M),u=M}while(u<o.length-1);return g.toArray()}},{key:"findChainEnd",value:function(o,u){for(var g=Si.quadrant(o[u],o[u+1]),M=u+1;M<o.length&&Si.quadrant(o[M-1],o[M])===g;)M++;return M-1}},{key:"OLDgetChainStartIndices",value:function(o){var u=0,g=new Ze;g.add(u);do{var M=this.findChainEnd(o,u);g.add(M),u=M}while(u<o.length-1);return _.toIntArray(g)}}],[{key:"toIntArray",value:function(o){for(var u=new Array(o.size()).fill(null),g=0;g<u.length;g++)u[g]=o.get(g).intValue();return u}}])})(),cu=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"getCoordinates",value:function(){return this.pts}},{key:"getMaxX",value:function(_){var o=this.pts[this.startIndex[_]].x,u=this.pts[this.startIndex[_+1]].x;return o>u?o:u}},{key:"getMinX",value:function(_){var o=this.pts[this.startIndex[_]].x,u=this.pts[this.startIndex[_+1]].x;return o<u?o:u}},{key:"computeIntersectsForChain",value:function(){if(arguments.length===4){var _=arguments[0],o=arguments[1],u=arguments[2],g=arguments[3];this.computeIntersectsForChain(this.startIndex[_],this.startIndex[_+1],o,o.startIndex[u],o.startIndex[u+1],g)}else if(arguments.length===6){var M=arguments[0],B=arguments[1],G=arguments[2],K=arguments[3],le=arguments[4],_e=arguments[5];if(B-M==1&&le-K==1)return _e.addIntersections(this.e,M,G.e,K),null;if(!this.overlaps(M,B,G,K,le))return null;var Ke=Math.trunc((M+B)/2),ct=Math.trunc((K+le)/2);M<Ke&&(K<ct&&this.computeIntersectsForChain(M,Ke,G,K,ct,_e),ct<le&&this.computeIntersectsForChain(M,Ke,G,ct,le,_e)),Ke<B&&(K<ct&&this.computeIntersectsForChain(Ke,B,G,K,ct,_e),ct<le&&this.computeIntersectsForChain(Ke,B,G,ct,le,_e))}}},{key:"overlaps",value:function(_,o,u,g,M){return Rn.intersects(this.pts[_],this.pts[o],u.pts[g],u.pts[M])}},{key:"getStartIndexes",value:function(){return this.startIndex}},{key:"computeIntersects",value:function(_,o){for(var u=0;u<this.startIndex.length-1;u++)for(var g=0;g<_.startIndex.length-1;g++)this.computeIntersectsForChain(u,_,g,o)}}],[{key:"constructor_",value:function(){this.e=null,this.pts=null,this.startIndex=null;var _=arguments[0];this.e=_,this.pts=_.getCoordinates();var o=new Vc;this.startIndex=o.getChainStartIndices(this.pts)}}])})(),Ws=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"getDepth",value:function(o,u){return this._depth[o][u]}},{key:"setDepth",value:function(o,u,g){this._depth[o][u]=g}},{key:"isNull",value:function(){if(arguments.length===0){for(var o=0;o<2;o++)for(var u=0;u<3;u++)if(this._depth[o][u]!==_.NULL_VALUE)return!1;return!0}if(arguments.length===1){var g=arguments[0];return this._depth[g][1]===_.NULL_VALUE}if(arguments.length===2){var M=arguments[0],B=arguments[1];return this._depth[M][B]===_.NULL_VALUE}}},{key:"normalize",value:function(){for(var o=0;o<2;o++)if(!this.isNull(o)){var u=this._depth[o][1];this._depth[o][2]<u&&(u=this._depth[o][2]),u<0&&(u=0);for(var g=1;g<3;g++){var M=0;this._depth[o][g]>u&&(M=1),this._depth[o][g]=M}}}},{key:"getDelta",value:function(o){return this._depth[o][Yt.RIGHT]-this._depth[o][Yt.LEFT]}},{key:"getLocation",value:function(o,u){return this._depth[o][u]<=0?Re.EXTERIOR:Re.INTERIOR}},{key:"toString",value:function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]}},{key:"add",value:function(){if(arguments.length===1)for(var o=arguments[0],u=0;u<2;u++)for(var g=1;g<3;g++){var M=o.getLocation(u,g);M!==Re.EXTERIOR&&M!==Re.INTERIOR||(this.isNull(u,g)?this._depth[u][g]=_.depthAtLocation(M):this._depth[u][g]+=_.depthAtLocation(M))}else if(arguments.length===3){var B=arguments[0],G=arguments[1];arguments[2]===Re.INTERIOR&&this._depth[B][G]++}}}],[{key:"constructor_",value:function(){this._depth=Array(2).fill().map((function(){return Array(3)}));for(var o=0;o<2;o++)for(var u=0;u<3;u++)this._depth[o][u]=_.NULL_VALUE}},{key:"depthAtLocation",value:function(o){return o===Re.EXTERIOR?0:o===Re.INTERIOR?1:_.NULL_VALUE}}])})();Ws.NULL_VALUE=-1;var Ku=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"getDepth",value:function(){return this._depth}},{key:"getCollapsedEdge",value:function(){var u=new Array(2).fill(null);return u[0]=this.pts[0],u[1]=this.pts[1],new o(u,Kr.toLineLabel(this._label))}},{key:"isIsolated",value:function(){return this._isIsolated}},{key:"getCoordinates",value:function(){return this.pts}},{key:"setIsolated",value:function(u){this._isIsolated=u}},{key:"setName",value:function(u){this._name=u}},{key:"equals",value:function(u){if(!(u instanceof o))return!1;var g=u;if(this.pts.length!==g.pts.length)return!1;for(var M=!0,B=!0,G=this.pts.length,K=0;K<this.pts.length;K++)if(this.pts[K].equals2D(g.pts[K])||(M=!1),this.pts[K].equals2D(g.pts[--G])||(B=!1),!M&&!B)return!1;return!0}},{key:"getCoordinate",value:function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var u=arguments[0];return this.pts[u]}}},{key:"print",value:function(u){u.print("edge "+this._name+": "),u.print("LINESTRING (");for(var g=0;g<this.pts.length;g++)g>0&&u.print(","),u.print(this.pts[g].x+" "+this.pts[g].y);u.print(")  "+this._label+" "+this._depthDelta)}},{key:"computeIM",value:function(u){o.updateIM(this._label,u)}},{key:"isCollapsed",value:function(){return!!this._label.isArea()&&this.pts.length===3&&!!this.pts[0].equals(this.pts[2])}},{key:"isClosed",value:function(){return this.pts[0].equals(this.pts[this.pts.length-1])}},{key:"getMaximumSegmentIndex",value:function(){return this.pts.length-1}},{key:"getDepthDelta",value:function(){return this._depthDelta}},{key:"getNumPoints",value:function(){return this.pts.length}},{key:"printReverse",value:function(u){u.print("edge "+this._name+": ");for(var g=this.pts.length-1;g>=0;g--)u.print(this.pts[g]+" ");u.println("")}},{key:"getMonotoneChainEdge",value:function(){return this._mce===null&&(this._mce=new cu(this)),this._mce}},{key:"getEnvelope",value:function(){if(this._env===null){this._env=new Rn;for(var u=0;u<this.pts.length;u++)this._env.expandToInclude(this.pts[u])}return this._env}},{key:"addIntersection",value:function(u,g,M,B){var G=new Qe(u.getIntersection(B)),K=g,le=u.getEdgeDistance(M,B),_e=K+1;if(_e<this.pts.length){var Ke=this.pts[_e];G.equals2D(Ke)&&(K=_e,le=0)}this.eiList.add(G,K,le)}},{key:"toString",value:function(){var u=new ka;u.append("edge "+this._name+": "),u.append("LINESTRING (");for(var g=0;g<this.pts.length;g++)g>0&&u.append(","),u.append(this.pts[g].x+" "+this.pts[g].y);return u.append(")  "+this._label+" "+this._depthDelta),u.toString()}},{key:"isPointwiseEqual",value:function(u){if(this.pts.length!==u.pts.length)return!1;for(var g=0;g<this.pts.length;g++)if(!this.pts[g].equals2D(u.pts[g]))return!1;return!0}},{key:"setDepthDelta",value:function(u){this._depthDelta=u}},{key:"getEdgeIntersectionList",value:function(){return this.eiList}},{key:"addIntersections",value:function(u,g,M){for(var B=0;B<u.getIntersectionNum();B++)this.addIntersection(u,g,M,B)}}],[{key:"constructor_",value:function(){if(this.pts=null,this._env=null,this.eiList=new kh(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Ws,this._depthDelta=0,arguments.length===1){var u=arguments[0];o.constructor_.call(this,u,null)}else if(arguments.length===2){var g=arguments[0],M=arguments[1];this.pts=g,this._label=M}}},{key:"updateIM",value:function(){if(!(arguments.length===2&&arguments[1]instanceof uu&&arguments[0]instanceof Kr))return Ge(o,"updateIM",this).apply(this,arguments);var u=arguments[0],g=arguments[1];g.setAtLeastIfValid(u.getLocation(0,Yt.ON),u.getLocation(1,Yt.ON),1),u.isArea()&&(g.setAtLeastIfValid(u.getLocation(0,Yt.LEFT),u.getLocation(1,Yt.LEFT),2),g.setAtLeastIfValid(u.getLocation(0,Yt.RIGHT),u.getLocation(1,Yt.RIGHT),2))}}])})(vn),Il=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"setWorkingPrecisionModel",value:function(o){this._workingPrecisionModel=o}},{key:"insertUniqueEdge",value:function(o){var u=this._edgeList.findEqualEdge(o);if(u!==null){var g=u.getLabel(),M=o.getLabel();u.isPointwiseEqual(o)||(M=new Kr(o.getLabel())).flip(),g.merge(M);var B=_.depthDelta(M),G=u.getDepthDelta()+B;u.setDepthDelta(G)}else this._edgeList.add(o),o.setDepthDelta(_.depthDelta(o.getLabel()))}},{key:"buildSubgraphs",value:function(o,u){for(var g=new Ze,M=o.iterator();M.hasNext();){var B=M.next(),G=B.getRightmostCoordinate(),K=new $o(g).getDepth(G);B.computeDepth(K),B.findResultEdges(),g.add(B),u.add(B.getDirectedEdges(),B.getNodes())}}},{key:"createSubgraphs",value:function(o){for(var u=new Ze,g=o.getNodes().iterator();g.hasNext();){var M=g.next();if(!M.isVisited()){var B=new Mt;B.create(M),u.add(B)}}return bn.sort(u,bn.reverseOrder()),u}},{key:"createEmptyResultGeometry",value:function(){return this._geomFact.createPolygon()}},{key:"getNoder",value:function(o){if(this._workingNoder!==null)return this._workingNoder;var u=new jc,g=new Ya;return g.setPrecisionModel(o),u.setSegmentIntersector(new Ko(g)),u}},{key:"buffer",value:function(o,u){var g=this._workingPrecisionModel;g===null&&(g=o.getPrecisionModel()),this._geomFact=o.getFactory();var M=new El(g,this._bufParams),B=new xo(o,u,M).getCurves();if(B.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(B,g),this._graph=new Qr(new Ah),this._graph.addEdges(this._edgeList.getEdges());var G=this.createSubgraphs(this._graph),K=new ru(this._geomFact);this.buildSubgraphs(G,K);var le=K.getPolygons();return le.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(le)}},{key:"computeNodedEdges",value:function(o,u){var g=this.getNoder(u);g.computeNodes(o);for(var M=g.getNodedSubstrings().iterator();M.hasNext();){var B=M.next(),G=B.getCoordinates();if(G.length!==2||!G[0].equals2D(G[1])){var K=B.getData(),le=new Ku(B.getCoordinates(),new Kr(K));this.insertUniqueEdge(le)}}}},{key:"setNoder",value:function(o){this._workingNoder=o}}],[{key:"constructor_",value:function(){this._bufParams=null,this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Wu;var o=arguments[0];this._bufParams=o}},{key:"depthDelta",value:function(o){var u=o.getLocation(0,Yt.LEFT),g=o.getLocation(0,Yt.RIGHT);return u===Re.INTERIOR&&g===Re.EXTERIOR?1:u===Re.EXTERIOR&&g===Re.INTERIOR?-1:0}},{key:"convertSegStrings",value:function(o){for(var u=new Wr,g=new Ze;o.hasNext();){var M=o.next(),B=u.createLineString(M.getCoordinates());g.add(B)}return u.buildGeometry(g)}}])})(),Ph=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"rescale",value:function(){if(dn(arguments[0],fi))for(var o=arguments[0].iterator();o.hasNext();){var u=o.next();this.rescale(u.getCoordinates())}else if(arguments[0]instanceof Array){for(var g=arguments[0],M=0;M<g.length;M++)g[M].x=g[M].x/this._scaleFactor+this._offsetX,g[M].y=g[M].y/this._scaleFactor+this._offsetY;g.length===2&&g[0].equals2D(g[1])&&Qt.out.println(g)}}},{key:"scale",value:function(){if(dn(arguments[0],fi)){for(var o=arguments[0],u=new Ze(o.size()),g=o.iterator();g.hasNext();){var M=g.next();u.add(new Ra(this.scale(M.getCoordinates()),M.getData()))}return u}if(arguments[0]instanceof Array){for(var B=arguments[0],G=new Array(B.length).fill(null),K=0;K<B.length;K++)G[K]=new Qe(Math.round((B[K].x-this._offsetX)*this._scaleFactor),Math.round((B[K].y-this._offsetY)*this._scaleFactor),B[K].getZ());return pi.removeRepeatedPoints(G)}}},{key:"isIntegerPrecision",value:function(){return this._scaleFactor===1}},{key:"getNodedSubstrings",value:function(){var o=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(o),o}},{key:"computeNodes",value:function(o){var u=o;this._isScaled&&(u=this.scale(o)),this._noder.computeNodes(u)}},{key:"interfaces_",get:function(){return[Sl]}}],[{key:"constructor_",value:function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var o=arguments[0],u=arguments[1];_.constructor_.call(this,o,u,0,0)}else if(arguments.length===4){var g=arguments[0],M=arguments[1];this._noder=g,this._scaleFactor=M,this._isScaled=!this.isIntegerPrecision()}}}])})(),Rh=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"checkEndPtVertexIntersections",value:function(){if(arguments.length===0)for(var o=this._segStrings.iterator();o.hasNext();){var u=o.next().getCoordinates();this.checkEndPtVertexIntersections(u[0],this._segStrings),this.checkEndPtVertexIntersections(u[u.length-1],this._segStrings)}else if(arguments.length===2){for(var g=arguments[0],M=arguments[1].iterator();M.hasNext();)for(var B=M.next().getCoordinates(),G=1;G<B.length-1;G++)if(B[G].equals(g))throw new ut("found endpt/interior pt intersection at index "+G+" :pt "+g)}}},{key:"checkInteriorIntersections",value:function(){if(arguments.length===0)for(var o=this._segStrings.iterator();o.hasNext();)for(var u=o.next(),g=this._segStrings.iterator();g.hasNext();){var M=g.next();this.checkInteriorIntersections(u,M)}else if(arguments.length===2)for(var B=arguments[0],G=arguments[1],K=B.getCoordinates(),le=G.getCoordinates(),_e=0;_e<K.length-1;_e++)for(var Ke=0;Ke<le.length-1;Ke++)this.checkInteriorIntersections(B,_e,G,Ke);else if(arguments.length===4){var ct=arguments[0],Bt=arguments[1],Jt=arguments[2],sn=arguments[3];if(ct===Jt&&Bt===sn)return null;var pn=ct.getCoordinates()[Bt],Nn=ct.getCoordinates()[Bt+1],In=Jt.getCoordinates()[sn],hi=Jt.getCoordinates()[sn+1];if(this._li.computeIntersection(pn,Nn,In,hi),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,pn,Nn)||this.hasInteriorIntersection(this._li,In,hi)))throw new ut("found non-noded intersection at "+pn+"-"+Nn+" and "+In+"-"+hi)}}},{key:"checkValid",value:function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()}},{key:"checkCollapses",value:function(){if(arguments.length===0)for(var o=this._segStrings.iterator();o.hasNext();){var u=o.next();this.checkCollapses(u)}else if(arguments.length===1)for(var g=arguments[0].getCoordinates(),M=0;M<g.length-2;M++)this.checkCollapse(g[M],g[M+1],g[M+2])}},{key:"hasInteriorIntersection",value:function(o,u,g){for(var M=0;M<o.getIntersectionNum();M++){var B=o.getIntersection(M);if(!B.equals(u)&&!B.equals(g))return!0}return!1}},{key:"checkCollapse",value:function(o,u,g){if(o.equals(g))throw new ut("found non-noded collapse at "+_.fact.createLineString([o,u,g]))}}],[{key:"constructor_",value:function(){this._li=new Ya,this._segStrings=null;var o=arguments[0];this._segStrings=o}}])})();Rh.fact=new Wr;var Qu=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"intersectsScaled",value:function(o,u){var g=Math.min(o.x,u.x),M=Math.max(o.x,u.x),B=Math.min(o.y,u.y),G=Math.max(o.y,u.y),K=this._maxx<g||this._minx>M||this._maxy<B||this._miny>G;if(K)return!1;var le=this.intersectsToleranceSquare(o,u);return Ct.isTrue(!(K&&le),"Found bad envelope test"),le}},{key:"initCorners",value:function(o){var u=.5;this._minx=o.x-u,this._maxx=o.x+u,this._miny=o.y-u,this._maxy=o.y+u,this._corner[0]=new Qe(this._maxx,this._maxy),this._corner[1]=new Qe(this._minx,this._maxy),this._corner[2]=new Qe(this._minx,this._miny),this._corner[3]=new Qe(this._maxx,this._miny)}},{key:"intersects",value:function(o,u){return this._scaleFactor===1?this.intersectsScaled(o,u):(this.copyScaled(o,this._p0Scaled),this.copyScaled(u,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))}},{key:"scale",value:function(o){return Math.round(o*this._scaleFactor)}},{key:"getCoordinate",value:function(){return this._originalPt}},{key:"copyScaled",value:function(o,u){u.x=this.scale(o.x),u.y=this.scale(o.y)}},{key:"getSafeEnvelope",value:function(){if(this._safeEnv===null){var o=_.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new Rn(this._originalPt.x-o,this._originalPt.x+o,this._originalPt.y-o,this._originalPt.y+o)}return this._safeEnv}},{key:"intersectsPixelClosure",value:function(o,u){return this._li.computeIntersection(o,u,this._corner[0],this._corner[1]),!!this._li.hasIntersection()||(this._li.computeIntersection(o,u,this._corner[1],this._corner[2]),!!this._li.hasIntersection()||(this._li.computeIntersection(o,u,this._corner[2],this._corner[3]),!!this._li.hasIntersection()||(this._li.computeIntersection(o,u,this._corner[3],this._corner[0]),!!this._li.hasIntersection())))}},{key:"intersectsToleranceSquare",value:function(o,u){var g=!1,M=!1;return this._li.computeIntersection(o,u,this._corner[0],this._corner[1]),!!this._li.isProper()||(this._li.computeIntersection(o,u,this._corner[1],this._corner[2]),!!this._li.isProper()||(this._li.hasIntersection()&&(g=!0),this._li.computeIntersection(o,u,this._corner[2],this._corner[3]),!!this._li.isProper()||(this._li.hasIntersection()&&(M=!0),this._li.computeIntersection(o,u,this._corner[3],this._corner[0]),!!this._li.isProper()||!(!g||!M)||!!o.equals(this._pt)||!!u.equals(this._pt))))}},{key:"addSnappedNode",value:function(o,u){var g=o.getCoordinate(u),M=o.getCoordinate(u+1);return!!this.intersects(g,M)&&(o.addIntersection(this.getCoordinate(),u),!0)}}],[{key:"constructor_",value:function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var o=arguments[0],u=arguments[1],g=arguments[2];if(this._originalPt=o,this._pt=o,this._scaleFactor=u,this._li=g,u<=0)throw new At("Scale factor must be non-zero");u!==1&&(this._pt=new Qe(this.scale(o.x),this.scale(o.y)),this._p0Scaled=new Qe,this._p1Scaled=new Qe),this.initCorners(this._pt)}}])})();Qu.SAFE_ENV_EXPANSION_FACTOR=.75;var hu=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"select",value:function(){if(arguments.length!==1){if(arguments.length===2){var _=arguments[1];arguments[0].getLineSegment(_,this.selectedSegment),this.select(this.selectedSegment)}}}}],[{key:"constructor_",value:function(){this.selectedSegment=new Ur}}])})(),Gc=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"snap",value:function(){if(arguments.length===1){var _=arguments[0];return this.snap(_,null,-1)}if(arguments.length===3){var o=arguments[0],u=arguments[1],g=arguments[2],M=o.getSafeEnvelope(),B=new Ju(o,u,g);return this._index.query(M,new((function(){return c((function G(){D(this,G)}),[{key:"interfaces_",get:function(){return[Tl]}},{key:"visitItem",value:function(G){G.select(M,B)}}])})())),B.isNodeAdded()}}}],[{key:"constructor_",value:function(){this._index=null;var _=arguments[0];this._index=_}}])})(),Ju=(function(_){function o(){var u;return D(this,o),u=I(this,o),o.constructor_.apply(u,arguments),u}return ie(o,_),c(o,[{key:"isNodeAdded",value:function(){return this._isNodeAdded}},{key:"select",value:function(){if(!(arguments.length===2&&Number.isInteger(arguments[1])&&arguments[0]instanceof Bi))return Ge(o,"select",this,1).apply(this,arguments);var u=arguments[1],g=arguments[0].getContext();if(this._parentEdge===g&&(u===this._hotPixelVertexIndex||u+1===this._hotPixelVertexIndex))return null;this._isNodeAdded|=this._hotPixel.addSnappedNode(g,u)}}],[{key:"constructor_",value:function(){this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var u=arguments[0],g=arguments[1],M=arguments[2];this._hotPixel=u,this._parentEdge=g,this._hotPixelVertexIndex=M}}])})(hu);Gc.HotPixelSnapAction=Ju;var xa=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"processIntersections",value:function(_,o,u,g){if(_===u&&o===g)return null;var M=_.getCoordinates()[o],B=_.getCoordinates()[o+1],G=u.getCoordinates()[g],K=u.getCoordinates()[g+1];if(this._li.computeIntersection(M,B,G,K),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var le=0;le<this._li.getIntersectionNum();le++)this._interiorIntersections.add(this._li.getIntersection(le));_.addIntersections(this._li,o,0),u.addIntersections(this._li,g,1)}}},{key:"isDone",value:function(){return!1}},{key:"getInteriorIntersections",value:function(){return this._interiorIntersections}},{key:"interfaces_",get:function(){return[lu]}}],[{key:"constructor_",value:function(){this._li=null,this._interiorIntersections=null;var _=arguments[0];this._li=_,this._interiorIntersections=new Ze}}])})(),wo=(function(){return c((function _(){D(this,_),_.constructor_.apply(this,arguments)}),[{key:"checkCorrectness",value:function(_){var o=Ra.getNodedSubstrings(_),u=new Rh(o);try{u.checkValid()}catch(g){if(!(g instanceof jt))throw g;g.printStackTrace()}}},{key:"getNodedSubstrings",value:function(){return Ra.getNodedSubstrings(this._nodedSegStrings)}},{key:"snapRound",value:function(_,o){var u=this.findInteriorIntersections(_,o);this.computeIntersectionSnaps(u),this.computeVertexSnaps(_)}},{key:"findInteriorIntersections",value:function(_,o){var u=new xa(o);return this._noder.setSegmentIntersector(u),this._noder.computeNodes(_),u.getInteriorIntersections()}},{key:"computeVertexSnaps",value:function(){if(dn(arguments[0],fi))for(var _=arguments[0].iterator();_.hasNext();){var o=_.next();this.computeVertexSnaps(o)}else if(arguments[0]instanceof Ra)for(var u=arguments[0],g=u.getCoordinates(),M=0;M<g.length;M++){var B=new Qu(g[M],this._scaleFactor,this._li);this._pointSnapper.snap(B,u,M)&&u.addIntersection(g[M],M)}}},{key:"computeNodes",value:function(_){this._nodedSegStrings=_,this._noder=new jc,this._pointSnapper=new Gc(this._noder.getIndex()),this.snapRound(_,this._li)}},{key:"computeIntersectionSnaps",value:function(_){for(var o=_.iterator();o.hasNext();){var u=o.next(),g=new Qu(u,this._scaleFactor,this._li);this._pointSnapper.snap(g)}}},{key:"interfaces_",get:function(){return[Sl]}}],[{key:"constructor_",value:function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var _=arguments[0];this._pm=_,this._li=new Ya,this._li.setPrecisionModel(_),this._scaleFactor=_.getScale()}}])})(),Vr=(function(){function _(){D(this,_),_.constructor_.apply(this,arguments)}return c(_,[{key:"bufferFixedPrecision",value:function(o){var u=new Ph(new wo(new $r(1)),o.getScale()),g=new Il(this._bufParams);g.setWorkingPrecisionModel(o),g.setNoder(u),this._resultGeometry=g.buffer(this._argGeom,this._distance)}},{key:"bufferReducedPrecision",value:function(){if(arguments.length===0){for(var o=_.MAX_PRECISION_DIGITS;o>=0;o--){try{this.bufferReducedPrecision(o)}catch(B){if(!(B instanceof Je))throw B;this._saveException=B}if(this._resultGeometry!==null)return null}throw this._saveException}if(arguments.length===1){var u=arguments[0],g=_.precisionScaleFactor(this._argGeom,this._distance,u),M=new $r(g);this.bufferFixedPrecision(M)}}},{key:"computeGeometry",value:function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var o=this._argGeom.getFactory().getPrecisionModel();o.getType()===$r.FIXED?this.bufferFixedPrecision(o):this.bufferReducedPrecision()}},{key:"setQuadrantSegments",value:function(o){this._bufParams.setQuadrantSegments(o)}},{key:"bufferOriginalPrecision",value:function(){try{var o=new Il(this._bufParams);this._resultGeometry=o.buffer(this._argGeom,this._distance)}catch(u){if(!(u instanceof ut))throw u;this._saveException=u}}},{key:"getResultGeometry",value:function(o){return this._distance=o,this.computeGeometry(),this._resultGeometry}},{key:"setEndCapStyle",value:function(o){this._bufParams.setEndCapStyle(o)}}],[{key:"constructor_",value:function(){if(this._argGeom=null,this._distance=null,this._bufParams=new at,this._resultGeometry=null,this._saveException=null,arguments.length===1){var o=arguments[0];this._argGeom=o}else if(arguments.length===2){var u=arguments[0],g=arguments[1];this._argGeom=u,this._bufParams=g}}},{key:"bufferOp",value:function(){if(arguments.length===2){var o=arguments[1];return new _(arguments[0]).getResultGeometry(o)}if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof rn&&typeof arguments[1]=="number"){var u=arguments[1],g=arguments[2],M=new _(arguments[0]);return M.setQuadrantSegments(g),M.getResultGeometry(u)}if(arguments[2]instanceof at&&arguments[0]instanceof rn&&typeof arguments[1]=="number"){var B=arguments[1];return new _(arguments[0],arguments[2]).getResultGeometry(B)}}else if(arguments.length===4){var G=arguments[1],K=arguments[2],le=arguments[3],_e=new _(arguments[0]);return _e.setQuadrantSegments(K),_e.setEndCapStyle(le),_e.getResultGeometry(G)}}},{key:"precisionScaleFactor",value:function(o,u,g){var M=o.getEnvelopeInternal(),B=yn.max(Math.abs(M.getMaxX()),Math.abs(M.getMaxY()),Math.abs(M.getMinX()),Math.abs(M.getMinY()))+2*(u>0?u:0),G=g-Math.trunc(Math.log(B)/Math.log(10)+1);return Math.pow(10,G)}}])})();Vr.CAP_ROUND=at.CAP_ROUND,Vr.CAP_BUTT=at.CAP_FLAT,Vr.CAP_FLAT=at.CAP_FLAT,Vr.CAP_SQUARE=at.CAP_SQUARE,Vr.MAX_PRECISION_DIGITS=12;var fu=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],du=(function(){return c((function _(o){D(this,_),this.geometryFactory=o||new Wr}),[{key:"read",value:function(_){var o,u=(o=typeof _=="string"?JSON.parse(_):_).type;if(!pa[u])throw new Error("Unknown GeoJSON type: "+o.type);return fu.indexOf(u)!==-1?pa[u].call(this,o.coordinates):u==="GeometryCollection"?pa[u].call(this,o.geometries):pa[u].call(this,o)}},{key:"write",value:function(_){var o=_.getGeometryType();if(!ba[o])throw new Error("Geometry is not supported");return ba[o].call(this,_)}}])})(),pa={Feature:function(_){var o={};for(var u in _)o[u]=_[u];if(_.geometry){var g=_.geometry.type;if(!pa[g])throw new Error("Unknown GeoJSON type: "+_.type);o.geometry=this.read(_.geometry)}return _.bbox&&(o.bbox=pa.bbox.call(this,_.bbox)),o},FeatureCollection:function(_){var o={};if(_.features){o.features=[];for(var u=0;u<_.features.length;++u)o.features.push(this.read(_.features[u]))}return _.bbox&&(o.bbox=this.parse.bbox.call(this,_.bbox)),o},coordinates:function(_){for(var o=[],u=0;u<_.length;++u){var g=_[u];o.push(U(Qe,dt(g)))}return o},bbox:function(_){return this.geometryFactory.createLinearRing([new Qe(_[0],_[1]),new Qe(_[2],_[1]),new Qe(_[2],_[3]),new Qe(_[0],_[3]),new Qe(_[0],_[1])])},Point:function(_){var o=U(Qe,dt(_));return this.geometryFactory.createPoint(o)},MultiPoint:function(_){for(var o=[],u=0;u<_.length;++u)o.push(pa.Point.call(this,_[u]));return this.geometryFactory.createMultiPoint(o)},LineString:function(_){var o=pa.coordinates.call(this,_);return this.geometryFactory.createLineString(o)},MultiLineString:function(_){for(var o=[],u=0;u<_.length;++u)o.push(pa.LineString.call(this,_[u]));return this.geometryFactory.createMultiLineString(o)},Polygon:function(_){for(var o=pa.coordinates.call(this,_[0]),u=this.geometryFactory.createLinearRing(o),g=[],M=1;M<_.length;++M){var B=_[M],G=pa.coordinates.call(this,B),K=this.geometryFactory.createLinearRing(G);g.push(K)}return this.geometryFactory.createPolygon(u,g)},MultiPolygon:function(_){for(var o=[],u=0;u<_.length;++u){var g=_[u];o.push(pa.Polygon.call(this,g))}return this.geometryFactory.createMultiPolygon(o)},GeometryCollection:function(_){for(var o=[],u=0;u<_.length;++u){var g=_[u];o.push(this.read(g))}return this.geometryFactory.createGeometryCollection(o)}},ba={coordinate:function(_){var o=[_.x,_.y];return _.z&&o.push(_.z),_.m&&o.push(_.m),o},Point:function(_){return{type:"Point",coordinates:ba.coordinate.call(this,_.getCoordinate())}},MultiPoint:function(_){for(var o=[],u=0;u<_._geometries.length;++u){var g=_._geometries[u],M=ba.Point.call(this,g);o.push(M.coordinates)}return{type:"MultiPoint",coordinates:o}},LineString:function(_){for(var o=[],u=_.getCoordinates(),g=0;g<u.length;++g){var M=u[g];o.push(ba.coordinate.call(this,M))}return{type:"LineString",coordinates:o}},MultiLineString:function(_){for(var o=[],u=0;u<_._geometries.length;++u){var g=_._geometries[u],M=ba.LineString.call(this,g);o.push(M.coordinates)}return{type:"MultiLineString",coordinates:o}},Polygon:function(_){var o=[],u=ba.LineString.call(this,_._shell);o.push(u.coordinates);for(var g=0;g<_._holes.length;++g){var M=_._holes[g],B=ba.LineString.call(this,M);o.push(B.coordinates)}return{type:"Polygon",coordinates:o}},MultiPolygon:function(_){for(var o=[],u=0;u<_._geometries.length;++u){var g=_._geometries[u],M=ba.Polygon.call(this,g);o.push(M.coordinates)}return{type:"MultiPolygon",coordinates:o}},GeometryCollection:function(_){for(var o=[],u=0;u<_._geometries.length;++u){var g=_._geometries[u],M=g.getGeometryType();o.push(ba[M].call(this,g))}return{type:"GeometryCollection",geometries:o}}};return{BufferOp:Vr,GeoJSONReader:(function(){return c((function _(o){D(this,_),this.parser=new du(o||new Wr)}),[{key:"read",value:function(_){return this.parser.read(_)}}])})(),GeoJSONWriter:(function(){return c((function _(){D(this,_),this.parser=new du(this.geometryFactory)}),[{key:"write",value:function(_){return this.parser.write(_)}}])})()}}))})(i_)),i_.exports}var Tx=wx();const Sx=Vv(Tx);function Cf(){return new c_}function c_(){this.reset()}c_.prototype={constructor:c_,reset:function(){this.s=this.t=0},add:function(S){av(Xg,S,this.t),av(this,Xg.s,this.s),this.s?this.t+=Xg.t:this.s=Xg.t},valueOf:function(){return this.s}};var Xg=new c_;function av(S,C,P){var I=S.s=C+P,D=I-C,U=I-D;S.t=C-U+(P-D)}var gr=1e-6,Pi=Math.PI,kc=Pi/2,sv=Pi/4,Rc=Pi*2,Ef=180/Pi,tu=Pi/180,ss=Math.abs,Ex=Math.atan,Mp=Math.atan2,Yr=Math.cos,Hr=Math.sin,kp=Math.sqrt;function $v(S){return S>1?0:S<-1?Pi:Math.acos(S)}function Id(S){return S>1?kc:S<-1?-kc:Math.asin(S)}function Um(){}function h_(S,C){S&&lv.hasOwnProperty(S.type)&&lv[S.type](S,C)}var ov={Feature:function(S,C){h_(S.geometry,C)},FeatureCollection:function(S,C){for(var P=S.features,I=-1,D=P.length;++I<D;)h_(P[I].geometry,C)}},lv={Sphere:function(S,C){C.sphere()},Point:function(S,C){S=S.coordinates,C.point(S[0],S[1],S[2])},MultiPoint:function(S,C){for(var P=S.coordinates,I=-1,D=P.length;++I<D;)S=P[I],C.point(S[0],S[1],S[2])},LineString:function(S,C){fy(S.coordinates,C,0)},MultiLineString:function(S,C){for(var P=S.coordinates,I=-1,D=P.length;++I<D;)fy(P[I],C,0)},Polygon:function(S,C){uv(S.coordinates,C)},MultiPolygon:function(S,C){for(var P=S.coordinates,I=-1,D=P.length;++I<D;)uv(P[I],C)},GeometryCollection:function(S,C){for(var P=S.geometries,I=-1,D=P.length;++I<D;)h_(P[I],C)}};function fy(S,C,P){var I=-1,D=S.length-P,U;for(C.lineStart();++I<D;)U=S[I],C.point(U[0],U[1],U[2]);C.lineEnd()}function uv(S,C){var P=-1,I=S.length;for(C.polygonStart();++P<I;)fy(S[P],C,1);C.polygonEnd()}function Mx(S,C){S&&ov.hasOwnProperty(S.type)?ov[S.type](S,C):h_(S,C)}Cf();Cf();function dy(S){return[Mp(S[1],S[0]),Id(S[2])]}function Cp(S){var C=S[0],P=S[1],I=Yr(P);return[I*Yr(C),I*Hr(C),Hr(P)]}function $g(S,C){return S[0]*C[0]+S[1]*C[1]+S[2]*C[2]}function f_(S,C){return[S[1]*C[2]-S[2]*C[1],S[2]*C[0]-S[0]*C[2],S[0]*C[1]-S[1]*C[0]]}function ay(S,C){S[0]+=C[0],S[1]+=C[1],S[2]+=C[2]}function Wg(S,C){return[S[0]*C,S[1]*C,S[2]*C]}function py(S){var C=kp(S[0]*S[0]+S[1]*S[1]+S[2]*S[2]);S[0]/=C,S[1]/=C,S[2]/=C}Cf();function Wv(S,C){function P(I,D){return I=S(I,D),C(I[0],I[1])}return S.invert&&C.invert&&(P.invert=function(I,D){return I=C.invert(I,D),I&&S.invert(I[0],I[1])}),P}function my(S,C){return[S>Pi?S-Rc:S<-Pi?S+Rc:S,C]}my.invert=my;function Cx(S,C,P){return(S%=Rc)?C||P?Wv(hv(S),fv(C,P)):hv(S):C||P?fv(C,P):my}function cv(S){return function(C,P){return C+=S,[C>Pi?C-Rc:C<-Pi?C+Rc:C,P]}}function hv(S){var C=cv(S);return C.invert=cv(-S),C}function fv(S,C){var P=Yr(S),I=Hr(S),D=Yr(C),U=Hr(C);function L(c,X){var ne=Yr(X),fe=Yr(c)*ne,ie=Hr(c)*ne,xe=Hr(X),Be=xe*P+fe*I;return[Mp(ie*D-Be*U,fe*P-xe*I),Id(Be*D+ie*U)]}return L.invert=function(c,X){var ne=Yr(X),fe=Yr(c)*ne,ie=Hr(c)*ne,xe=Hr(X),Be=xe*D-ie*U;return[Mp(ie*D+xe*U,fe*P+Be*I),Id(Be*P-fe*I)]},L}function Ix(S,C,P,I,D,U){if(P){var L=Yr(C),c=Hr(C),X=I*P;D==null?(D=C+I*Rc,U=C-X/2):(D=dv(L,D),U=dv(L,U),(I>0?D<U:D>U)&&(D+=I*Rc));for(var ne,fe=D;I>0?fe>U:fe<U;fe-=X)ne=dy([L,-c*Yr(fe),-c*Hr(fe)]),S.point(ne[0],ne[1])}}function dv(S,C){C=Cp(C),C[0]-=S,py(C);var P=$v(-C[1]);return((-C[2]<0?-P:P)+Rc-gr)%Rc}function Kv(){var S=[],C;return{point:function(P,I){C.push([P,I])},lineStart:function(){S.push(C=[])},lineEnd:Um,rejoin:function(){S.length>1&&S.push(S.pop().concat(S.shift()))},result:function(){var P=S;return S=[],C=null,P}}}function Ax(S,C,P,I,D,U){var L=S[0],c=S[1],X=C[0],ne=C[1],fe=0,ie=1,xe=X-L,Be=ne-c,Ge;if(Ge=P-L,!(!xe&&Ge>0)){if(Ge/=xe,xe<0){if(Ge<fe)return;Ge<ie&&(ie=Ge)}else if(xe>0){if(Ge>ie)return;Ge>fe&&(fe=Ge)}if(Ge=D-L,!(!xe&&Ge<0)){if(Ge/=xe,xe<0){if(Ge>ie)return;Ge>fe&&(fe=Ge)}else if(xe>0){if(Ge<fe)return;Ge<ie&&(ie=Ge)}if(Ge=I-c,!(!Be&&Ge>0)){if(Ge/=Be,Be<0){if(Ge<fe)return;Ge<ie&&(ie=Ge)}else if(Be>0){if(Ge>ie)return;Ge>fe&&(fe=Ge)}if(Ge=U-c,!(!Be&&Ge<0)){if(Ge/=Be,Be<0){if(Ge>ie)return;Ge>fe&&(fe=Ge)}else if(Be>0){if(Ge<fe)return;Ge<ie&&(ie=Ge)}return fe>0&&(S[0]=L+fe*xe,S[1]=c+fe*Be),ie<1&&(C[0]=L+ie*xe,C[1]=c+ie*Be),!0}}}}}function r_(S,C){return ss(S[0]-C[0])<gr&&ss(S[1]-C[1])<gr}function Kg(S,C,P,I){this.x=S,this.z=C,this.o=P,this.e=I,this.v=!1,this.n=this.p=null}function Qv(S,C,P,I,D){var U=[],L=[],c,X;if(S.forEach(function(Ge){if(!((dt=Ge.length-1)<=0)){var dt,Ce=Ge[0],It=Ge[dt],Ye;if(r_(Ce,It)){for(D.lineStart(),c=0;c<dt;++c)D.point((Ce=Ge[c])[0],Ce[1]);D.lineEnd();return}U.push(Ye=new Kg(Ce,Ge,null,!0)),L.push(Ye.o=new Kg(Ce,null,Ye,!1)),U.push(Ye=new Kg(It,Ge,null,!1)),L.push(Ye.o=new Kg(It,null,Ye,!0))}}),!!U.length){for(L.sort(C),pv(U),pv(L),c=0,X=L.length;c<X;++c)L[c].e=P=!P;for(var ne=U[0],fe,ie;;){for(var xe=ne,Be=!0;xe.v;)if((xe=xe.n)===ne)return;fe=xe.z,D.lineStart();do{if(xe.v=xe.o.v=!0,xe.e){if(Be)for(c=0,X=fe.length;c<X;++c)D.point((ie=fe[c])[0],ie[1]);else I(xe.x,xe.n.x,1,D);xe=xe.n}else{if(Be)for(fe=xe.p.z,c=fe.length-1;c>=0;--c)D.point((ie=fe[c])[0],ie[1]);else I(xe.x,xe.p.x,-1,D);xe=xe.p}xe=xe.o,fe=xe.z,Be=!Be}while(!xe.v);D.lineEnd()}}}function pv(S){if(C=S.length){for(var C,P=0,I=S[0],D;++P<C;)I.n=D=S[P],D.p=I,I=D;I.n=D=S[0],D.p=I}}function Jv(S,C){return S<C?-1:S>C?1:S>=C?0:NaN}function kx(S){return S.length===1&&(S=Px(S)),{left:function(C,P,I,D){for(I==null&&(I=0),D==null&&(D=C.length);I<D;){var U=I+D>>>1;S(C[U],P)<0?I=U+1:D=U}return I},right:function(C,P,I,D){for(I==null&&(I=0),D==null&&(D=C.length);I<D;){var U=I+D>>>1;S(C[U],P)>0?D=U:I=U+1}return I}}}function Px(S){return function(C,P){return Jv(S(C),P)}}kx(Jv);function e0(S){for(var C=S.length,P,I=-1,D=0,U,L;++I<C;)D+=S[I].length;for(U=new Array(D);--C>=0;)for(L=S[C],P=L.length;--P>=0;)U[--D]=L[P];return U}var Vm=1e9,Qg=-Vm;function Rx(S,C,P,I){function D(ne,fe){return S<=ne&&ne<=P&&C<=fe&&fe<=I}function U(ne,fe,ie,xe){var Be=0,Ge=0;if(ne==null||(Be=L(ne,ie))!==(Ge=L(fe,ie))||X(ne,fe)<0^ie>0)do xe.point(Be===0||Be===3?S:P,Be>1?I:C);while((Be=(Be+ie+4)%4)!==Ge);else xe.point(fe[0],fe[1])}function L(ne,fe){return ss(ne[0]-S)<gr?fe>0?0:3:ss(ne[0]-P)<gr?fe>0?2:1:ss(ne[1]-C)<gr?fe>0?1:0:fe>0?3:2}function c(ne,fe){return X(ne.x,fe.x)}function X(ne,fe){var ie=L(ne,1),xe=L(fe,1);return ie!==xe?ie-xe:ie===0?fe[1]-ne[1]:ie===1?ne[0]-fe[0]:ie===2?ne[1]-fe[1]:fe[0]-ne[0]}return function(ne){var fe=ne,ie=Kv(),xe,Be,Ge,dt,Ce,It,Ye,at,jt,At,Vt,wt={point:oe,lineStart:Ne,lineEnd:He,polygonStart:Ie,polygonEnd:Xe};function oe(Le,me){D(Le,me)&&fe.point(Le,me)}function de(){for(var Le=0,me=0,Pe=Be.length;me<Pe;++me)for(var Ue=Be[me],tt=1,vt=Ue.length,Me=Ue[0],ut,Ot,Ct=Me[0],Zt=Me[1];tt<vt;++tt)ut=Ct,Ot=Zt,Me=Ue[tt],Ct=Me[0],Zt=Me[1],Ot<=I?Zt>I&&(Ct-ut)*(I-Ot)>(Zt-Ot)*(S-ut)&&++Le:Zt<=I&&(Ct-ut)*(I-Ot)<(Zt-Ot)*(S-ut)&&--Le;return Le}function Ie(){fe=ie,xe=[],Be=[],Vt=!0}function Xe(){var Le=de(),me=Vt&&Le,Pe=(xe=e0(xe)).length;(me||Pe)&&(ne.polygonStart(),me&&(ne.lineStart(),U(null,null,1,ne),ne.lineEnd()),Pe&&Qv(xe,c,Le,U,ne),ne.polygonEnd()),fe=ne,xe=Be=Ge=null}function Ne(){wt.point=Fe,Be&&Be.push(Ge=[]),At=!0,jt=!1,Ye=at=NaN}function He(){xe&&(Fe(dt,Ce),It&&jt&&ie.rejoin(),xe.push(ie.result())),wt.point=oe,jt&&fe.lineEnd()}function Fe(Le,me){var Pe=D(Le,me);if(Be&&Ge.push([Le,me]),At)dt=Le,Ce=me,It=Pe,At=!1,Pe&&(fe.lineStart(),fe.point(Le,me));else if(Pe&&jt)fe.point(Le,me);else{var Ue=[Ye=Math.max(Qg,Math.min(Vm,Ye)),at=Math.max(Qg,Math.min(Vm,at))],tt=[Le=Math.max(Qg,Math.min(Vm,Le)),me=Math.max(Qg,Math.min(Vm,me))];Ax(Ue,tt,S,C,P,I)?(jt||(fe.lineStart(),fe.point(Ue[0],Ue[1])),fe.point(tt[0],tt[1]),Pe||fe.lineEnd(),Vt=!1):Pe&&(fe.lineStart(),fe.point(Le,me),Vt=!1)}Ye=Le,at=me,jt=Pe}return wt}}var sy=Cf();function Dx(S,C){var P=C[0],I=C[1],D=[Hr(P),-Yr(P),0],U=0,L=0;sy.reset();for(var c=0,X=S.length;c<X;++c)if(fe=(ne=S[c]).length)for(var ne,fe,ie=ne[fe-1],xe=ie[0],Be=ie[1]/2+sv,Ge=Hr(Be),dt=Yr(Be),Ce=0;Ce<fe;++Ce,xe=Ye,Ge=jt,dt=At,ie=It){var It=ne[Ce],Ye=It[0],at=It[1]/2+sv,jt=Hr(at),At=Yr(at),Vt=Ye-xe,wt=Vt>=0?1:-1,oe=wt*Vt,de=oe>Pi,Ie=Ge*jt;if(sy.add(Mp(Ie*wt*Hr(oe),dt*At+Ie*Yr(oe))),U+=de?Vt+wt*Rc:Vt,de^xe>=P^Ye>=P){var Xe=f_(Cp(ie),Cp(It));py(Xe);var Ne=f_(D,Xe);py(Ne);var He=(de^Vt>=0?-1:1)*Id(Ne[2]);(I>He||I===He&&(Xe[0]||Xe[1]))&&(L+=de^Vt>=0?1:-1)}}return(U<-gr||U<gr&&sy<-gr)^L&1}Cf();function mv(S){return S}Cf();Cf();var Ip=1/0,d_=Ip,Hm=-Ip,p_=Hm,gv={point:Lx,lineStart:Um,lineEnd:Um,polygonStart:Um,polygonEnd:Um,result:function(){var S=[[Ip,d_],[Hm,p_]];return Hm=p_=-(d_=Ip=1/0),S}};function Lx(S,C){S<Ip&&(Ip=S),S>Hm&&(Hm=S),C<d_&&(d_=C),C>p_&&(p_=C)}Cf();function t0(S,C,P,I){return function(D,U){var L=C(U),c=D.invert(I[0],I[1]),X=Kv(),ne=C(X),fe=!1,ie,xe,Be,Ge={point:dt,lineStart:It,lineEnd:Ye,polygonStart:function(){Ge.point=at,Ge.lineStart=jt,Ge.lineEnd=At,xe=[],ie=[]},polygonEnd:function(){Ge.point=dt,Ge.lineStart=It,Ge.lineEnd=Ye,xe=e0(xe);var Vt=Dx(ie,c);xe.length?(fe||(U.polygonStart(),fe=!0),Qv(xe,Ox,Vt,P,U)):Vt&&(fe||(U.polygonStart(),fe=!0),U.lineStart(),P(null,null,1,U),U.lineEnd()),fe&&(U.polygonEnd(),fe=!1),xe=ie=null},sphere:function(){U.polygonStart(),U.lineStart(),P(null,null,1,U),U.lineEnd(),U.polygonEnd()}};function dt(Vt,wt){var oe=D(Vt,wt);S(Vt=oe[0],wt=oe[1])&&U.point(Vt,wt)}function Ce(Vt,wt){var oe=D(Vt,wt);L.point(oe[0],oe[1])}function It(){Ge.point=Ce,L.lineStart()}function Ye(){Ge.point=dt,L.lineEnd()}function at(Vt,wt){Be.push([Vt,wt]);var oe=D(Vt,wt);ne.point(oe[0],oe[1])}function jt(){ne.lineStart(),Be=[]}function At(){at(Be[0][0],Be[0][1]),ne.lineEnd();var Vt=ne.clean(),wt=X.result(),oe,de=wt.length,Ie,Xe,Ne;if(Be.pop(),ie.push(Be),Be=null,!!de){if(Vt&1){if(Xe=wt[0],(Ie=Xe.length-1)>0){for(fe||(U.polygonStart(),fe=!0),U.lineStart(),oe=0;oe<Ie;++oe)U.point((Ne=Xe[oe])[0],Ne[1]);U.lineEnd()}return}de>1&&Vt&2&&wt.push(wt.pop().concat(wt.shift())),xe.push(wt.filter(zx))}}return Ge}}function zx(S){return S.length>1}function Ox(S,C){return((S=S.x)[0]<0?S[1]-kc-gr:kc-S[1])-((C=C.x)[0]<0?C[1]-kc-gr:kc-C[1])}const _v=t0(function(){return!0},Nx,Fx,[-Pi,-kc]);function Nx(S){var C=NaN,P=NaN,I=NaN,D;return{lineStart:function(){S.lineStart(),D=1},point:function(U,L){var c=U>0?Pi:-Pi,X=ss(U-C);ss(X-Pi)<gr?(S.point(C,P=(P+L)/2>0?kc:-kc),S.point(I,P),S.lineEnd(),S.lineStart(),S.point(c,P),S.point(U,P),D=0):I!==c&&X>=Pi&&(ss(C-I)<gr&&(C-=I*gr),ss(U-c)<gr&&(U-=c*gr),P=Bx(C,P,U,L),S.point(I,P),S.lineEnd(),S.lineStart(),S.point(c,P),D=0),S.point(C=U,P=L),I=c},lineEnd:function(){S.lineEnd(),C=P=NaN},clean:function(){return 2-D}}}function Bx(S,C,P,I){var D,U,L=Hr(S-P);return ss(L)>gr?Ex((Hr(C)*(U=Yr(I))*Hr(P)-Hr(I)*(D=Yr(C))*Hr(S))/(D*U*L)):(C+I)/2}function Fx(S,C,P,I){var D;if(S==null)D=P*kc,I.point(-Pi,D),I.point(0,D),I.point(Pi,D),I.point(Pi,0),I.point(Pi,-D),I.point(0,-D),I.point(-Pi,-D),I.point(-Pi,0),I.point(-Pi,D);else if(ss(S[0]-C[0])>gr){var U=S[0]<C[0]?Pi:-Pi;D=P*U/2,I.point(-U,D),I.point(0,D),I.point(U,D)}else I.point(C[0],C[1])}function jx(S,C){var P=Yr(S),I=P>0,D=ss(P)>gr;function U(fe,ie,xe,Be){Ix(Be,S,C,xe,fe,ie)}function L(fe,ie){return Yr(fe)*Yr(ie)>P}function c(fe){var ie,xe,Be,Ge,dt;return{lineStart:function(){Ge=Be=!1,dt=1},point:function(Ce,It){var Ye=[Ce,It],at,jt=L(Ce,It),At=I?jt?0:ne(Ce,It):jt?ne(Ce+(Ce<0?Pi:-Pi),It):0;if(!ie&&(Ge=Be=jt)&&fe.lineStart(),jt!==Be&&(at=X(ie,Ye),(!at||r_(ie,at)||r_(Ye,at))&&(Ye[0]+=gr,Ye[1]+=gr,jt=L(Ye[0],Ye[1]))),jt!==Be)dt=0,jt?(fe.lineStart(),at=X(Ye,ie),fe.point(at[0],at[1])):(at=X(ie,Ye),fe.point(at[0],at[1]),fe.lineEnd()),ie=at;else if(D&&ie&&I^jt){var Vt;!(At&xe)&&(Vt=X(Ye,ie,!0))&&(dt=0,I?(fe.lineStart(),fe.point(Vt[0][0],Vt[0][1]),fe.point(Vt[1][0],Vt[1][1]),fe.lineEnd()):(fe.point(Vt[1][0],Vt[1][1]),fe.lineEnd(),fe.lineStart(),fe.point(Vt[0][0],Vt[0][1])))}jt&&(!ie||!r_(ie,Ye))&&fe.point(Ye[0],Ye[1]),ie=Ye,Be=jt,xe=At},lineEnd:function(){Be&&fe.lineEnd(),ie=null},clean:function(){return dt|(Ge&&Be)<<1}}}function X(fe,ie,xe){var Be=Cp(fe),Ge=Cp(ie),dt=[1,0,0],Ce=f_(Be,Ge),It=$g(Ce,Ce),Ye=Ce[0],at=It-Ye*Ye;if(!at)return!xe&&fe;var jt=P*It/at,At=-P*Ye/at,Vt=f_(dt,Ce),wt=Wg(dt,jt),oe=Wg(Ce,At);ay(wt,oe);var de=Vt,Ie=$g(wt,de),Xe=$g(de,de),Ne=Ie*Ie-Xe*($g(wt,wt)-1);if(!(Ne<0)){var He=kp(Ne),Fe=Wg(de,(-Ie-He)/Xe);if(ay(Fe,wt),Fe=dy(Fe),!xe)return Fe;var Le=fe[0],me=ie[0],Pe=fe[1],Ue=ie[1],tt;me<Le&&(tt=Le,Le=me,me=tt);var vt=me-Le,Me=ss(vt-Pi)<gr,ut=Me||vt<gr;if(!Me&&Ue<Pe&&(tt=Pe,Pe=Ue,Ue=tt),ut?Me?Pe+Ue>0^Fe[1]<(ss(Fe[0]-Le)<gr?Pe:Ue):Pe<=Fe[1]&&Fe[1]<=Ue:vt>Pi^(Le<=Fe[0]&&Fe[0]<=me)){var Ot=Wg(de,(-Ie+He)/Xe);return ay(Ot,wt),[Fe,dy(Ot)]}}}function ne(fe,ie){var xe=I?S:Pi-S,Be=0;return fe<-xe?Be|=1:fe>xe&&(Be|=2),ie<-xe?Be|=4:ie>xe&&(Be|=8),Be}return t0(L,c,U,I?[0,-S]:[-Pi,S-Pi])}function n0(S){return function(C){var P=new gy;for(var I in S)P[I]=S[I];return P.stream=C,P}}function gy(){}gy.prototype={constructor:gy,point:function(S,C){this.stream.point(S,C)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function i0(S,C,P){var I=C[1][0]-C[0][0],D=C[1][1]-C[0][1],U=S.clipExtent&&S.clipExtent();S.scale(150).translate([0,0]),U!=null&&S.clipExtent(null),Mx(P,S.stream(gv));var L=gv.result(),c=Math.min(I/(L[1][0]-L[0][0]),D/(L[1][1]-L[0][1])),X=+C[0][0]+(I-c*(L[1][0]+L[0][0]))/2,ne=+C[0][1]+(D-c*(L[1][1]+L[0][1]))/2;return U!=null&&S.clipExtent(U),S.scale(c*150).translate([X,ne])}function Ux(S,C,P){return i0(S,[[0,0],C],P)}var yv=16,Vx=Yr(30*tu);function vv(S,C){return+C?qx(S,C):Gx(S)}function Gx(S){return n0({point:function(C,P){C=S(C,P),this.stream.point(C[0],C[1])}})}function qx(S,C){function P(I,D,U,L,c,X,ne,fe,ie,xe,Be,Ge,dt,Ce){var It=ne-I,Ye=fe-D,at=It*It+Ye*Ye;if(at>4*C&&dt--){var jt=L+xe,At=c+Be,Vt=X+Ge,wt=kp(jt*jt+At*At+Vt*Vt),oe=Id(Vt/=wt),de=ss(ss(Vt)-1)<gr||ss(U-ie)<gr?(U+ie)/2:Mp(At,jt),Ie=S(de,oe),Xe=Ie[0],Ne=Ie[1],He=Xe-I,Fe=Ne-D,Le=Ye*He-It*Fe;(Le*Le/at>C||ss((It*He+Ye*Fe)/at-.5)>.3||L*xe+c*Be+X*Ge<Vx)&&(P(I,D,U,L,c,X,Xe,Ne,de,jt/=wt,At/=wt,Vt,dt,Ce),Ce.point(Xe,Ne),P(Xe,Ne,de,jt,At,Vt,ne,fe,ie,xe,Be,Ge,dt,Ce))}}return function(I){var D,U,L,c,X,ne,fe,ie,xe,Be,Ge,dt,Ce={point:It,lineStart:Ye,lineEnd:jt,polygonStart:function(){I.polygonStart(),Ce.lineStart=At},polygonEnd:function(){I.polygonEnd(),Ce.lineStart=Ye}};function It(oe,de){oe=S(oe,de),I.point(oe[0],oe[1])}function Ye(){ie=NaN,Ce.point=at,I.lineStart()}function at(oe,de){var Ie=Cp([oe,de]),Xe=S(oe,de);P(ie,xe,fe,Be,Ge,dt,ie=Xe[0],xe=Xe[1],fe=oe,Be=Ie[0],Ge=Ie[1],dt=Ie[2],yv,I),I.point(ie,xe)}function jt(){Ce.point=It,I.lineEnd()}function At(){Ye(),Ce.point=Vt,Ce.lineEnd=wt}function Vt(oe,de){at(D=oe,de),U=ie,L=xe,c=Be,X=Ge,ne=dt,Ce.point=at}function wt(){P(ie,xe,fe,Be,Ge,dt,U,L,D,c,X,ne,yv,I),Ce.lineEnd=jt,jt()}return Ce}}var Zx=n0({point:function(S,C){this.stream.point(S*tu,C*tu)}});function Yx(S){return Hx(function(){return S})()}function Hx(S){var C,P=150,I=480,D=250,U,L,c=0,X=0,ne=0,fe=0,ie=0,xe,Be,Ge=null,dt=_v,Ce=null,It,Ye,at,jt=mv,At=.5,Vt=vv(Xe,At),wt,oe;function de(Fe){return Fe=Be(Fe[0]*tu,Fe[1]*tu),[Fe[0]*P+U,L-Fe[1]*P]}function Ie(Fe){return Fe=Be.invert((Fe[0]-U)/P,(L-Fe[1])/P),Fe&&[Fe[0]*Ef,Fe[1]*Ef]}function Xe(Fe,Le){return Fe=C(Fe,Le),[Fe[0]*P+U,L-Fe[1]*P]}de.stream=function(Fe){return wt&&oe===Fe?wt:wt=Zx(dt(xe,Vt(jt(oe=Fe))))},de.clipAngle=function(Fe){return arguments.length?(dt=+Fe?jx(Ge=Fe*tu,6*tu):(Ge=null,_v),He()):Ge*Ef},de.clipExtent=function(Fe){return arguments.length?(jt=Fe==null?(Ce=It=Ye=at=null,mv):Rx(Ce=+Fe[0][0],It=+Fe[0][1],Ye=+Fe[1][0],at=+Fe[1][1]),He()):Ce==null?null:[[Ce,It],[Ye,at]]},de.scale=function(Fe){return arguments.length?(P=+Fe,Ne()):P},de.translate=function(Fe){return arguments.length?(I=+Fe[0],D=+Fe[1],Ne()):[I,D]},de.center=function(Fe){return arguments.length?(c=Fe[0]%360*tu,X=Fe[1]%360*tu,Ne()):[c*Ef,X*Ef]},de.rotate=function(Fe){return arguments.length?(ne=Fe[0]%360*tu,fe=Fe[1]%360*tu,ie=Fe.length>2?Fe[2]%360*tu:0,Ne()):[ne*Ef,fe*Ef,ie*Ef]},de.precision=function(Fe){return arguments.length?(Vt=vv(Xe,At=Fe*Fe),He()):kp(At)},de.fitExtent=function(Fe,Le){return i0(de,Fe,Le)},de.fitSize=function(Fe,Le){return Ux(de,Fe,Le)};function Ne(){Be=Wv(xe=Cx(ne,fe,ie),C);var Fe=C(c,X);return U=I-Fe[0]*P,L=D+Fe[1]*P,He()}function He(){return wt=oe=null,de}return function(){return C=S.apply(this,arguments),de.invert=C.invert&&Ie,Ne()}}function r0(S){return function(C,P){var I=Yr(C),D=Yr(P),U=S(I*D);return[U*D*Hr(C),U*Hr(P)]}}function a0(S){return function(C,P){var I=kp(C*C+P*P),D=S(I),U=Hr(D),L=Yr(D);return[Mp(C*U,I*L),Id(I&&P*U/I)]}}var Xx=r0(function(S){return kp(2/(1+S))});Xx.invert=a0(function(S){return 2*Id(S/2)});var s0=r0(function(S){return(S=$v(S))&&S/Hr(S)});s0.invert=a0(function(S){return S});function $x(){return Yx(s0).scale(79.4188).clipAngle(180-.001)}function xv(S,C){return[S,C]}xv.invert=xv;var{BufferOp:Wx,GeoJSONReader:Kx,GeoJSONWriter:Qx}=Sx;function o0(S,C,P){P=P||{};var I=P.units||"kilometers",D=P.steps||8;if(!S)throw new Error("geojson is required");if(typeof P!="object")throw new Error("options must be an object");if(typeof D!="number")throw new Error("steps must be an number");if(C===void 0)throw new Error("radius is required");if(D<=0)throw new Error("steps must be greater than 0");var U=[];switch(S.type){case"GeometryCollection":return Th(S,function(L){var c=a_(L,C,I,D);c&&U.push(c)}),bl(U);case"FeatureCollection":return u_(S,function(L){var c=a_(L,C,I,D);c&&u_(c,function(X){X&&U.push(X)})}),bl(U)}return a_(S,C,I,D)}function a_(S,C,P,I){var D=S.properties||{},U=S.type==="Feature"?S.geometry:S;if(U.type==="GeometryCollection"){var L=[];return Th(S,function(dt){var Ce=a_(dt,C,P,I);Ce&&L.push(Ce)}),bl(L)}var c=Jx(U),X={type:U.type,coordinates:u0(U.coordinates,c)},ne=new Kx,fe=ne.read(X),ie=Ty(Sy(C,P),"meters"),xe=Wx.bufferOp(fe,ie,I),Be=new Qx;if(xe=Be.write(xe),!l0(xe.coordinates)){var Ge={type:xe.type,coordinates:c0(xe.coordinates,c)};return Ad(Ge,D)}}function l0(S){return Array.isArray(S[0])?l0(S[0]):isNaN(S[0])}function u0(S,C){return typeof S[0]!="object"?C(S):S.map(function(P){return u0(P,C)})}function c0(S,C){return typeof S[0]!="object"?C.invert(S):S.map(function(P){return c0(P,C)})}function Jx(S){var C=xx(S).geometry.coordinates,P=[-C[0],-C[1]];return $x().rotate(P).scale(Es)}function h0(S,C,P={}){const I=P.steps||64,D=P.properties?P.properties:!Array.isArray(S)&&S.type==="Feature"&&S.properties?S.properties:{},U=[];for(let L=0;L<I;L++)U.push(ex(S,C,L*-360/I,P).geometry.coordinates);return U.push(U[0]),xl([U],D)}function f0(S){if(!S)throw new Error("geojson is required");switch(S.type){case"Feature":return d0(S);case"FeatureCollection":return e1(S);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Ey(S);default:throw new Error("unknown GeoJSON type")}}function d0(S){const C={type:"Feature"};return Object.keys(S).forEach(P=>{switch(P){case"type":case"properties":case"geometry":return;default:C[P]=S[P]}}),C.properties=p0(S.properties),S.geometry==null?C.geometry=null:C.geometry=Ey(S.geometry),C}function p0(S){const C={};return S&&Object.keys(S).forEach(P=>{const I=S[P];typeof I=="object"?I===null?C[P]=null:Array.isArray(I)?C[P]=I.map(D=>D):C[P]=p0(I):C[P]=I}),C}function e1(S){const C={type:"FeatureCollection"};return Object.keys(S).forEach(P=>{switch(P){case"type":case"features":return;default:C[P]=S[P]}}),C.features=S.features.map(P=>d0(P)),C}function Ey(S){const C={type:S.type};return S.bbox&&(C.bbox=S.bbox),S.type==="GeometryCollection"?(C.geometries=S.geometries.map(P=>Ey(P)),C):(C.coordinates=m0(S.coordinates),C)}function m0(S){const C=S;return typeof C[0]!="object"?C.slice():C.map(P=>m0(P))}var t1=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,oy=Math.ceil,Wl=Math.floor,Vo="[BigNumber Error] ",bv=Vo+"Number primitive has more than 15 significant digits: ",Vu=1e14,qn=14,ly=9007199254740991,uy=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Mf=1e7,as=1e9;function g0(S){var C,P,I,D=Ye.prototype={constructor:Ye,toString:null,valueOf:null},U=new Ye(1),L=20,c=4,X=-7,ne=21,fe=-1e7,ie=1e7,xe=!1,Be=1,Ge=0,dt={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},Ce="0123456789abcdefghijklmnopqrstuvwxyz",It=!0;function Ye(oe,de){var Ie,Xe,Ne,He,Fe,Le,me,Pe,Ue=this;if(!(Ue instanceof Ye))return new Ye(oe,de);if(de==null){if(oe&&oe._isBigNumber===!0){Ue.s=oe.s,!oe.c||oe.e>ie?Ue.c=Ue.e=null:oe.e<fe?Ue.c=[Ue.e=0]:(Ue.e=oe.e,Ue.c=oe.c.slice());return}if((Le=typeof oe=="number")&&oe*0==0){if(Ue.s=1/oe<0?(oe=-oe,-1):1,oe===~~oe){for(He=0,Fe=oe;Fe>=10;Fe/=10,He++);He>ie?Ue.c=Ue.e=null:(Ue.e=He,Ue.c=[oe]);return}Pe=String(oe)}else{if(!t1.test(Pe=String(oe)))return I(Ue,Pe,Le);Ue.s=Pe.charCodeAt(0)==45?(Pe=Pe.slice(1),-1):1}(He=Pe.indexOf("."))>-1&&(Pe=Pe.replace(".","")),(Fe=Pe.search(/e/i))>0?(He<0&&(He=Fe),He+=+Pe.slice(Fe+1),Pe=Pe.substring(0,Fe)):He<0&&(He=Pe.length)}else{if(Zr(de,2,Ce.length,"Base"),de==10&&It)return Ue=new Ye(oe),Vt(Ue,L+Ue.e+1,c);if(Pe=String(oe),Le=typeof oe=="number"){if(oe*0!=0)return I(Ue,Pe,Le,de);if(Ue.s=1/oe<0?(Pe=Pe.slice(1),-1):1,Ye.DEBUG&&Pe.replace(/^0\.0*|\./,"").length>15)throw Error(bv+oe)}else Ue.s=Pe.charCodeAt(0)===45?(Pe=Pe.slice(1),-1):1;for(Ie=Ce.slice(0,de),He=Fe=0,me=Pe.length;Fe<me;Fe++)if(Ie.indexOf(Xe=Pe.charAt(Fe))<0){if(Xe=="."){if(Fe>He){He=me;continue}}else if(!Ne&&(Pe==Pe.toUpperCase()&&(Pe=Pe.toLowerCase())||Pe==Pe.toLowerCase()&&(Pe=Pe.toUpperCase()))){Ne=!0,Fe=-1,He=0;continue}return I(Ue,String(oe),Le,de)}Le=!1,Pe=P(Pe,de,10,Ue.s),(He=Pe.indexOf("."))>-1?Pe=Pe.replace(".",""):He=Pe.length}for(Fe=0;Pe.charCodeAt(Fe)===48;Fe++);for(me=Pe.length;Pe.charCodeAt(--me)===48;);if(Pe=Pe.slice(Fe,++me)){if(me-=Fe,Le&&Ye.DEBUG&&me>15&&(oe>ly||oe!==Wl(oe)))throw Error(bv+Ue.s*oe);if((He=He-Fe-1)>ie)Ue.c=Ue.e=null;else if(He<fe)Ue.c=[Ue.e=0];else{if(Ue.e=He,Ue.c=[],Fe=(He+1)%qn,He<0&&(Fe+=qn),Fe<me){for(Fe&&Ue.c.push(+Pe.slice(0,Fe)),me-=qn;Fe<me;)Ue.c.push(+Pe.slice(Fe,Fe+=qn));Fe=qn-(Pe=Pe.slice(Fe)).length}else Fe-=me;for(;Fe--;Pe+="0");Ue.c.push(+Pe)}}else Ue.c=[Ue.e=0]}Ye.clone=g0,Ye.ROUND_UP=0,Ye.ROUND_DOWN=1,Ye.ROUND_CEIL=2,Ye.ROUND_FLOOR=3,Ye.ROUND_HALF_UP=4,Ye.ROUND_HALF_DOWN=5,Ye.ROUND_HALF_EVEN=6,Ye.ROUND_HALF_CEIL=7,Ye.ROUND_HALF_FLOOR=8,Ye.EUCLID=9,Ye.config=Ye.set=function(oe){var de,Ie;if(oe!=null)if(typeof oe=="object"){if(oe.hasOwnProperty(de="DECIMAL_PLACES")&&(Ie=oe[de],Zr(Ie,0,as,de),L=Ie),oe.hasOwnProperty(de="ROUNDING_MODE")&&(Ie=oe[de],Zr(Ie,0,8,de),c=Ie),oe.hasOwnProperty(de="EXPONENTIAL_AT")&&(Ie=oe[de],Ie&&Ie.pop?(Zr(Ie[0],-as,0,de),Zr(Ie[1],0,as,de),X=Ie[0],ne=Ie[1]):(Zr(Ie,-as,as,de),X=-(ne=Ie<0?-Ie:Ie))),oe.hasOwnProperty(de="RANGE"))if(Ie=oe[de],Ie&&Ie.pop)Zr(Ie[0],-as,-1,de),Zr(Ie[1],1,as,de),fe=Ie[0],ie=Ie[1];else if(Zr(Ie,-as,as,de),Ie)fe=-(ie=Ie<0?-Ie:Ie);else throw Error(Vo+de+" cannot be zero: "+Ie);if(oe.hasOwnProperty(de="CRYPTO"))if(Ie=oe[de],Ie===!!Ie)if(Ie)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))xe=Ie;else throw xe=!Ie,Error(Vo+"crypto unavailable");else xe=Ie;else throw Error(Vo+de+" not true or false: "+Ie);if(oe.hasOwnProperty(de="MODULO_MODE")&&(Ie=oe[de],Zr(Ie,0,9,de),Be=Ie),oe.hasOwnProperty(de="POW_PRECISION")&&(Ie=oe[de],Zr(Ie,0,as,de),Ge=Ie),oe.hasOwnProperty(de="FORMAT"))if(Ie=oe[de],typeof Ie=="object")dt=Ie;else throw Error(Vo+de+" not an object: "+Ie);if(oe.hasOwnProperty(de="ALPHABET"))if(Ie=oe[de],typeof Ie=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(Ie))It=Ie.slice(0,10)=="0123456789",Ce=Ie;else throw Error(Vo+de+" invalid: "+Ie)}else throw Error(Vo+"Object expected: "+oe);return{DECIMAL_PLACES:L,ROUNDING_MODE:c,EXPONENTIAL_AT:[X,ne],RANGE:[fe,ie],CRYPTO:xe,MODULO_MODE:Be,POW_PRECISION:Ge,FORMAT:dt,ALPHABET:Ce}},Ye.isBigNumber=function(oe){if(!oe||oe._isBigNumber!==!0)return!1;if(!Ye.DEBUG)return!0;var de,Ie,Xe=oe.c,Ne=oe.e,He=oe.s;e:if({}.toString.call(Xe)=="[object Array]"){if((He===1||He===-1)&&Ne>=-as&&Ne<=as&&Ne===Wl(Ne)){if(Xe[0]===0){if(Ne===0&&Xe.length===1)return!0;break e}if(de=(Ne+1)%qn,de<1&&(de+=qn),String(Xe[0]).length==de){for(de=0;de<Xe.length;de++)if(Ie=Xe[de],Ie<0||Ie>=Vu||Ie!==Wl(Ie))break e;if(Ie!==0)return!0}}}else if(Xe===null&&Ne===null&&(He===null||He===1||He===-1))return!0;throw Error(Vo+"Invalid BigNumber: "+oe)},Ye.maximum=Ye.max=function(){return jt(arguments,-1)},Ye.minimum=Ye.min=function(){return jt(arguments,1)},Ye.random=(function(){var oe=9007199254740992,de=Math.random()*oe&2097151?function(){return Wl(Math.random()*oe)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(Ie){var Xe,Ne,He,Fe,Le,me=0,Pe=[],Ue=new Ye(U);if(Ie==null?Ie=L:Zr(Ie,0,as),Fe=oy(Ie/qn),xe)if(crypto.getRandomValues){for(Xe=crypto.getRandomValues(new Uint32Array(Fe*=2));me<Fe;)Le=Xe[me]*131072+(Xe[me+1]>>>11),Le>=9e15?(Ne=crypto.getRandomValues(new Uint32Array(2)),Xe[me]=Ne[0],Xe[me+1]=Ne[1]):(Pe.push(Le%1e14),me+=2);me=Fe/2}else if(crypto.randomBytes){for(Xe=crypto.randomBytes(Fe*=7);me<Fe;)Le=(Xe[me]&31)*281474976710656+Xe[me+1]*1099511627776+Xe[me+2]*4294967296+Xe[me+3]*16777216+(Xe[me+4]<<16)+(Xe[me+5]<<8)+Xe[me+6],Le>=9e15?crypto.randomBytes(7).copy(Xe,me):(Pe.push(Le%1e14),me+=7);me=Fe/7}else throw xe=!1,Error(Vo+"crypto unavailable");if(!xe)for(;me<Fe;)Le=de(),Le<9e15&&(Pe[me++]=Le%1e14);for(Fe=Pe[--me],Ie%=qn,Fe&&Ie&&(Le=uy[qn-Ie],Pe[me]=Wl(Fe/Le)*Le);Pe[me]===0;Pe.pop(),me--);if(me<0)Pe=[He=0];else{for(He=-1;Pe[0]===0;Pe.splice(0,1),He-=qn);for(me=1,Le=Pe[0];Le>=10;Le/=10,me++);me<qn&&(He-=qn-me)}return Ue.e=He,Ue.c=Pe,Ue}})(),Ye.sum=function(){for(var oe=1,de=arguments,Ie=new Ye(de[0]);oe<de.length;)Ie=Ie.plus(de[oe++]);return Ie},P=(function(){var oe="0123456789";function de(Ie,Xe,Ne,He){for(var Fe,Le=[0],me,Pe=0,Ue=Ie.length;Pe<Ue;){for(me=Le.length;me--;Le[me]*=Xe);for(Le[0]+=He.indexOf(Ie.charAt(Pe++)),Fe=0;Fe<Le.length;Fe++)Le[Fe]>Ne-1&&(Le[Fe+1]==null&&(Le[Fe+1]=0),Le[Fe+1]+=Le[Fe]/Ne|0,Le[Fe]%=Ne)}return Le.reverse()}return function(Ie,Xe,Ne,He,Fe){var Le,me,Pe,Ue,tt,vt,Me,ut,Ot=Ie.indexOf("."),Ct=L,Zt=c;for(Ot>=0&&(Ue=Ge,Ge=0,Ie=Ie.replace(".",""),ut=new Ye(Xe),vt=ut.pow(Ie.length-Ot),Ge=Ue,ut.c=de(vh($l(vt.c),vt.e,"0"),10,Ne,oe),ut.e=ut.c.length),Me=de(Ie,Xe,Ne,Fe?(Le=Ce,oe):(Le=oe,Ce)),Pe=Ue=Me.length;Me[--Ue]==0;Me.pop());if(!Me[0])return Le.charAt(0);if(Ot<0?--Pe:(vt.c=Me,vt.e=Pe,vt.s=He,vt=C(vt,ut,Ct,Zt,Ne),Me=vt.c,tt=vt.r,Pe=vt.e),me=Pe+Ct+1,Ot=Me[me],Ue=Ne/2,tt=tt||me<0||Me[me+1]!=null,tt=Zt<4?(Ot!=null||tt)&&(Zt==0||Zt==(vt.s<0?3:2)):Ot>Ue||Ot==Ue&&(Zt==4||tt||Zt==6&&Me[me-1]&1||Zt==(vt.s<0?8:7)),me<1||!Me[0])Ie=tt?vh(Le.charAt(1),-Ct,Le.charAt(0)):Le.charAt(0);else{if(Me.length=me,tt)for(--Ne;++Me[--me]>Ne;)Me[me]=0,me||(++Pe,Me=[1].concat(Me));for(Ue=Me.length;!Me[--Ue];);for(Ot=0,Ie="";Ot<=Ue;Ie+=Le.charAt(Me[Ot++]));Ie=vh(Ie,Pe,Le.charAt(0))}return Ie}})(),C=(function(){function oe(Xe,Ne,He){var Fe,Le,me,Pe,Ue=0,tt=Xe.length,vt=Ne%Mf,Me=Ne/Mf|0;for(Xe=Xe.slice();tt--;)me=Xe[tt]%Mf,Pe=Xe[tt]/Mf|0,Fe=Me*me+Pe*vt,Le=vt*me+Fe%Mf*Mf+Ue,Ue=(Le/He|0)+(Fe/Mf|0)+Me*Pe,Xe[tt]=Le%He;return Ue&&(Xe=[Ue].concat(Xe)),Xe}function de(Xe,Ne,He,Fe){var Le,me;if(He!=Fe)me=He>Fe?1:-1;else for(Le=me=0;Le<He;Le++)if(Xe[Le]!=Ne[Le]){me=Xe[Le]>Ne[Le]?1:-1;break}return me}function Ie(Xe,Ne,He,Fe){for(var Le=0;He--;)Xe[He]-=Le,Le=Xe[He]<Ne[He]?1:0,Xe[He]=Le*Fe+Xe[He]-Ne[He];for(;!Xe[0]&&Xe.length>1;Xe.splice(0,1));}return function(Xe,Ne,He,Fe,Le){var me,Pe,Ue,tt,vt,Me,ut,Ot,Ct,Zt,tn,_n,Qe,ni,Rn,rn,Re,fi=Xe.s==Ne.s?1:-1,Dn=Xe.c,Pn=Ne.c;if(!Dn||!Dn[0]||!Pn||!Pn[0])return new Ye(!Xe.s||!Ne.s||(Dn?Pn&&Dn[0]==Pn[0]:!Pn)?NaN:Dn&&Dn[0]==0||!Pn?fi*0:fi/0);for(Ot=new Ye(fi),Ct=Ot.c=[],Pe=Xe.e-Ne.e,fi=He+Pe+1,Le||(Le=Vu,Pe=Kl(Xe.e/qn)-Kl(Ne.e/qn),fi=fi/qn|0),Ue=0;Pn[Ue]==(Dn[Ue]||0);Ue++);if(Pn[Ue]>(Dn[Ue]||0)&&Pe--,fi<0)Ct.push(1),tt=!0;else{for(ni=Dn.length,rn=Pn.length,Ue=0,fi+=2,vt=Wl(Le/(Pn[0]+1)),vt>1&&(Pn=oe(Pn,vt,Le),Dn=oe(Dn,vt,Le),rn=Pn.length,ni=Dn.length),Qe=rn,Zt=Dn.slice(0,rn),tn=Zt.length;tn<rn;Zt[tn++]=0);Re=Pn.slice(),Re=[0].concat(Re),Rn=Pn[0],Pn[1]>=Le/2&&Rn++;do{if(vt=0,me=de(Pn,Zt,rn,tn),me<0){if(_n=Zt[0],rn!=tn&&(_n=_n*Le+(Zt[1]||0)),vt=Wl(_n/Rn),vt>1)for(vt>=Le&&(vt=Le-1),Me=oe(Pn,vt,Le),ut=Me.length,tn=Zt.length;de(Me,Zt,ut,tn)==1;)vt--,Ie(Me,rn<ut?Re:Pn,ut,Le),ut=Me.length,me=1;else vt==0&&(me=vt=1),Me=Pn.slice(),ut=Me.length;if(ut<tn&&(Me=[0].concat(Me)),Ie(Zt,Me,tn,Le),tn=Zt.length,me==-1)for(;de(Pn,Zt,rn,tn)<1;)vt++,Ie(Zt,rn<tn?Re:Pn,tn,Le),tn=Zt.length}else me===0&&(vt++,Zt=[0]);Ct[Ue++]=vt,Zt[0]?Zt[tn++]=Dn[Qe]||0:(Zt=[Dn[Qe]],tn=1)}while((Qe++<ni||Zt[0]!=null)&&fi--);tt=Zt[0]!=null,Ct[0]||Ct.splice(0,1)}if(Le==Vu){for(Ue=1,fi=Ct[0];fi>=10;fi/=10,Ue++);Vt(Ot,He+(Ot.e=Ue+Pe*qn-1)+1,Fe,tt)}else Ot.e=Pe,Ot.r=+tt;return Ot}})();function at(oe,de,Ie,Xe){var Ne,He,Fe,Le,me;if(Ie==null?Ie=c:Zr(Ie,0,8),!oe.c)return oe.toString();if(Ne=oe.c[0],Fe=oe.e,de==null)me=$l(oe.c),me=Xe==1||Xe==2&&(Fe<=X||Fe>=ne)?e_(me,Fe):vh(me,Fe,"0");else if(oe=Vt(new Ye(oe),de,Ie),He=oe.e,me=$l(oe.c),Le=me.length,Xe==1||Xe==2&&(de<=He||He<=X)){for(;Le<de;me+="0",Le++);me=e_(me,He)}else if(de-=Fe+(Xe===2&&He>Fe),me=vh(me,He,"0"),He+1>Le){if(--de>0)for(me+=".";de--;me+="0");}else if(de+=He-Le,de>0)for(He+1==Le&&(me+=".");de--;me+="0");return oe.s<0&&Ne?"-"+me:me}function jt(oe,de){for(var Ie,Xe,Ne=1,He=new Ye(oe[0]);Ne<oe.length;Ne++)Xe=new Ye(oe[Ne]),(!Xe.s||(Ie=Ed(He,Xe))===de||Ie===0&&He.s===de)&&(He=Xe);return He}function At(oe,de,Ie){for(var Xe=1,Ne=de.length;!de[--Ne];de.pop());for(Ne=de[0];Ne>=10;Ne/=10,Xe++);return(Ie=Xe+Ie*qn-1)>ie?oe.c=oe.e=null:Ie<fe?oe.c=[oe.e=0]:(oe.e=Ie,oe.c=de),oe}I=(function(){var oe=/^(-?)0([xbo])(?=\w[\w.]*$)/i,de=/^([^.]+)\.$/,Ie=/^\.([^.]+)$/,Xe=/^-?(Infinity|NaN)$/,Ne=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(He,Fe,Le,me){var Pe,Ue=Le?Fe:Fe.replace(Ne,"");if(Xe.test(Ue))He.s=isNaN(Ue)?null:Ue<0?-1:1;else{if(!Le&&(Ue=Ue.replace(oe,function(tt,vt,Me){return Pe=(Me=Me.toLowerCase())=="x"?16:Me=="b"?2:8,!me||me==Pe?vt:tt}),me&&(Pe=me,Ue=Ue.replace(de,"$1").replace(Ie,"0.$1")),Fe!=Ue))return new Ye(Ue,Pe);if(Ye.DEBUG)throw Error(Vo+"Not a"+(me?" base "+me:"")+" number: "+Fe);He.s=null}He.c=He.e=null}})();function Vt(oe,de,Ie,Xe){var Ne,He,Fe,Le,me,Pe,Ue,tt=oe.c,vt=uy;if(tt){e:{for(Ne=1,Le=tt[0];Le>=10;Le/=10,Ne++);if(He=de-Ne,He<0)He+=qn,Fe=de,me=tt[Pe=0],Ue=Wl(me/vt[Ne-Fe-1]%10);else if(Pe=oy((He+1)/qn),Pe>=tt.length)if(Xe){for(;tt.length<=Pe;tt.push(0));me=Ue=0,Ne=1,He%=qn,Fe=He-qn+1}else break e;else{for(me=Le=tt[Pe],Ne=1;Le>=10;Le/=10,Ne++);He%=qn,Fe=He-qn+Ne,Ue=Fe<0?0:Wl(me/vt[Ne-Fe-1]%10)}if(Xe=Xe||de<0||tt[Pe+1]!=null||(Fe<0?me:me%vt[Ne-Fe-1]),Xe=Ie<4?(Ue||Xe)&&(Ie==0||Ie==(oe.s<0?3:2)):Ue>5||Ue==5&&(Ie==4||Xe||Ie==6&&(He>0?Fe>0?me/vt[Ne-Fe]:0:tt[Pe-1])%10&1||Ie==(oe.s<0?8:7)),de<1||!tt[0])return tt.length=0,Xe?(de-=oe.e+1,tt[0]=vt[(qn-de%qn)%qn],oe.e=-de||0):tt[0]=oe.e=0,oe;if(He==0?(tt.length=Pe,Le=1,Pe--):(tt.length=Pe+1,Le=vt[qn-He],tt[Pe]=Fe>0?Wl(me/vt[Ne-Fe]%vt[Fe])*Le:0),Xe)for(;;)if(Pe==0){for(He=1,Fe=tt[0];Fe>=10;Fe/=10,He++);for(Fe=tt[0]+=Le,Le=1;Fe>=10;Fe/=10,Le++);He!=Le&&(oe.e++,tt[0]==Vu&&(tt[0]=1));break}else{if(tt[Pe]+=Le,tt[Pe]!=Vu)break;tt[Pe--]=0,Le=1}for(He=tt.length;tt[--He]===0;tt.pop());}oe.e>ie?oe.c=oe.e=null:oe.e<fe&&(oe.c=[oe.e=0])}return oe}function wt(oe){var de,Ie=oe.e;return Ie===null?oe.toString():(de=$l(oe.c),de=Ie<=X||Ie>=ne?e_(de,Ie):vh(de,Ie,"0"),oe.s<0?"-"+de:de)}return D.absoluteValue=D.abs=function(){var oe=new Ye(this);return oe.s<0&&(oe.s=1),oe},D.comparedTo=function(oe,de){return Ed(this,new Ye(oe,de))},D.decimalPlaces=D.dp=function(oe,de){var Ie,Xe,Ne,He=this;if(oe!=null)return Zr(oe,0,as),de==null?de=c:Zr(de,0,8),Vt(new Ye(He),oe+He.e+1,de);if(!(Ie=He.c))return null;if(Xe=((Ne=Ie.length-1)-Kl(this.e/qn))*qn,Ne=Ie[Ne])for(;Ne%10==0;Ne/=10,Xe--);return Xe<0&&(Xe=0),Xe},D.dividedBy=D.div=function(oe,de){return C(this,new Ye(oe,de),L,c)},D.dividedToIntegerBy=D.idiv=function(oe,de){return C(this,new Ye(oe,de),0,1)},D.exponentiatedBy=D.pow=function(oe,de){var Ie,Xe,Ne,He,Fe,Le,me,Pe,Ue,tt=this;if(oe=new Ye(oe),oe.c&&!oe.isInteger())throw Error(Vo+"Exponent not an integer: "+wt(oe));if(de!=null&&(de=new Ye(de)),Le=oe.e>14,!tt.c||!tt.c[0]||tt.c[0]==1&&!tt.e&&tt.c.length==1||!oe.c||!oe.c[0])return Ue=new Ye(Math.pow(+wt(tt),Le?oe.s*(2-Jg(oe)):+wt(oe))),de?Ue.mod(de):Ue;if(me=oe.s<0,de){if(de.c?!de.c[0]:!de.s)return new Ye(NaN);Xe=!me&&tt.isInteger()&&de.isInteger(),Xe&&(tt=tt.mod(de))}else{if(oe.e>9&&(tt.e>0||tt.e<-1||(tt.e==0?tt.c[0]>1||Le&&tt.c[1]>=24e7:tt.c[0]<8e13||Le&&tt.c[0]<=9999975e7)))return He=tt.s<0&&Jg(oe)?-0:0,tt.e>-1&&(He=1/He),new Ye(me?1/He:He);Ge&&(He=oy(Ge/qn+2))}for(Le?(Ie=new Ye(.5),me&&(oe.s=1),Pe=Jg(oe)):(Ne=Math.abs(+wt(oe)),Pe=Ne%2),Ue=new Ye(U);;){if(Pe){if(Ue=Ue.times(tt),!Ue.c)break;He?Ue.c.length>He&&(Ue.c.length=He):Xe&&(Ue=Ue.mod(de))}if(Ne){if(Ne=Wl(Ne/2),Ne===0)break;Pe=Ne%2}else if(oe=oe.times(Ie),Vt(oe,oe.e+1,1),oe.e>14)Pe=Jg(oe);else{if(Ne=+wt(oe),Ne===0)break;Pe=Ne%2}tt=tt.times(tt),He?tt.c&&tt.c.length>He&&(tt.c.length=He):Xe&&(tt=tt.mod(de))}return Xe?Ue:(me&&(Ue=U.div(Ue)),de?Ue.mod(de):He?Vt(Ue,Ge,c,Fe):Ue)},D.integerValue=function(oe){var de=new Ye(this);return oe==null?oe=c:Zr(oe,0,8),Vt(de,de.e+1,oe)},D.isEqualTo=D.eq=function(oe,de){return Ed(this,new Ye(oe,de))===0},D.isFinite=function(){return!!this.c},D.isGreaterThan=D.gt=function(oe,de){return Ed(this,new Ye(oe,de))>0},D.isGreaterThanOrEqualTo=D.gte=function(oe,de){return(de=Ed(this,new Ye(oe,de)))===1||de===0},D.isInteger=function(){return!!this.c&&Kl(this.e/qn)>this.c.length-2},D.isLessThan=D.lt=function(oe,de){return Ed(this,new Ye(oe,de))<0},D.isLessThanOrEqualTo=D.lte=function(oe,de){return(de=Ed(this,new Ye(oe,de)))===-1||de===0},D.isNaN=function(){return!this.s},D.isNegative=function(){return this.s<0},D.isPositive=function(){return this.s>0},D.isZero=function(){return!!this.c&&this.c[0]==0},D.minus=function(oe,de){var Ie,Xe,Ne,He,Fe=this,Le=Fe.s;if(oe=new Ye(oe,de),de=oe.s,!Le||!de)return new Ye(NaN);if(Le!=de)return oe.s=-de,Fe.plus(oe);var me=Fe.e/qn,Pe=oe.e/qn,Ue=Fe.c,tt=oe.c;if(!me||!Pe){if(!Ue||!tt)return Ue?(oe.s=-de,oe):new Ye(tt?Fe:NaN);if(!Ue[0]||!tt[0])return tt[0]?(oe.s=-de,oe):new Ye(Ue[0]?Fe:c==3?-0:0)}if(me=Kl(me),Pe=Kl(Pe),Ue=Ue.slice(),Le=me-Pe){for((He=Le<0)?(Le=-Le,Ne=Ue):(Pe=me,Ne=tt),Ne.reverse(),de=Le;de--;Ne.push(0));Ne.reverse()}else for(Xe=(He=(Le=Ue.length)<(de=tt.length))?Le:de,Le=de=0;de<Xe;de++)if(Ue[de]!=tt[de]){He=Ue[de]<tt[de];break}if(He&&(Ne=Ue,Ue=tt,tt=Ne,oe.s=-oe.s),de=(Xe=tt.length)-(Ie=Ue.length),de>0)for(;de--;Ue[Ie++]=0);for(de=Vu-1;Xe>Le;){if(Ue[--Xe]<tt[Xe]){for(Ie=Xe;Ie&&!Ue[--Ie];Ue[Ie]=de);--Ue[Ie],Ue[Xe]+=Vu}Ue[Xe]-=tt[Xe]}for(;Ue[0]==0;Ue.splice(0,1),--Pe);return Ue[0]?At(oe,Ue,Pe):(oe.s=c==3?-1:1,oe.c=[oe.e=0],oe)},D.modulo=D.mod=function(oe,de){var Ie,Xe,Ne=this;return oe=new Ye(oe,de),!Ne.c||!oe.s||oe.c&&!oe.c[0]?new Ye(NaN):!oe.c||Ne.c&&!Ne.c[0]?new Ye(Ne):(Be==9?(Xe=oe.s,oe.s=1,Ie=C(Ne,oe,0,3),oe.s=Xe,Ie.s*=Xe):Ie=C(Ne,oe,0,Be),oe=Ne.minus(Ie.times(oe)),!oe.c[0]&&Be==1&&(oe.s=Ne.s),oe)},D.multipliedBy=D.times=function(oe,de){var Ie,Xe,Ne,He,Fe,Le,me,Pe,Ue,tt,vt,Me,ut,Ot,Ct,Zt=this,tn=Zt.c,_n=(oe=new Ye(oe,de)).c;if(!tn||!_n||!tn[0]||!_n[0])return!Zt.s||!oe.s||tn&&!tn[0]&&!_n||_n&&!_n[0]&&!tn?oe.c=oe.e=oe.s=null:(oe.s*=Zt.s,!tn||!_n?oe.c=oe.e=null:(oe.c=[0],oe.e=0)),oe;for(Xe=Kl(Zt.e/qn)+Kl(oe.e/qn),oe.s*=Zt.s,me=tn.length,tt=_n.length,me<tt&&(ut=tn,tn=_n,_n=ut,Ne=me,me=tt,tt=Ne),Ne=me+tt,ut=[];Ne--;ut.push(0));for(Ot=Vu,Ct=Mf,Ne=tt;--Ne>=0;){for(Ie=0,vt=_n[Ne]%Ct,Me=_n[Ne]/Ct|0,Fe=me,He=Ne+Fe;He>Ne;)Pe=tn[--Fe]%Ct,Ue=tn[Fe]/Ct|0,Le=Me*Pe+Ue*vt,Pe=vt*Pe+Le%Ct*Ct+ut[He]+Ie,Ie=(Pe/Ot|0)+(Le/Ct|0)+Me*Ue,ut[He--]=Pe%Ot;ut[He]=Ie}return Ie?++Xe:ut.splice(0,1),At(oe,ut,Xe)},D.negated=function(){var oe=new Ye(this);return oe.s=-oe.s||null,oe},D.plus=function(oe,de){var Ie,Xe=this,Ne=Xe.s;if(oe=new Ye(oe,de),de=oe.s,!Ne||!de)return new Ye(NaN);if(Ne!=de)return oe.s=-de,Xe.minus(oe);var He=Xe.e/qn,Fe=oe.e/qn,Le=Xe.c,me=oe.c;if(!He||!Fe){if(!Le||!me)return new Ye(Ne/0);if(!Le[0]||!me[0])return me[0]?oe:new Ye(Le[0]?Xe:Ne*0)}if(He=Kl(He),Fe=Kl(Fe),Le=Le.slice(),Ne=He-Fe){for(Ne>0?(Fe=He,Ie=me):(Ne=-Ne,Ie=Le),Ie.reverse();Ne--;Ie.push(0));Ie.reverse()}for(Ne=Le.length,de=me.length,Ne-de<0&&(Ie=me,me=Le,Le=Ie,de=Ne),Ne=0;de;)Ne=(Le[--de]=Le[de]+me[de]+Ne)/Vu|0,Le[de]=Vu===Le[de]?0:Le[de]%Vu;return Ne&&(Le=[Ne].concat(Le),++Fe),At(oe,Le,Fe)},D.precision=D.sd=function(oe,de){var Ie,Xe,Ne,He=this;if(oe!=null&&oe!==!!oe)return Zr(oe,1,as),de==null?de=c:Zr(de,0,8),Vt(new Ye(He),oe,de);if(!(Ie=He.c))return null;if(Ne=Ie.length-1,Xe=Ne*qn+1,Ne=Ie[Ne]){for(;Ne%10==0;Ne/=10,Xe--);for(Ne=Ie[0];Ne>=10;Ne/=10,Xe++);}return oe&&He.e+1>Xe&&(Xe=He.e+1),Xe},D.shiftedBy=function(oe){return Zr(oe,-ly,ly),this.times("1e"+oe)},D.squareRoot=D.sqrt=function(){var oe,de,Ie,Xe,Ne,He=this,Fe=He.c,Le=He.s,me=He.e,Pe=L+4,Ue=new Ye("0.5");if(Le!==1||!Fe||!Fe[0])return new Ye(!Le||Le<0&&(!Fe||Fe[0])?NaN:Fe?He:1/0);if(Le=Math.sqrt(+wt(He)),Le==0||Le==1/0?(de=$l(Fe),(de.length+me)%2==0&&(de+="0"),Le=Math.sqrt(+de),me=Kl((me+1)/2)-(me<0||me%2),Le==1/0?de="5e"+me:(de=Le.toExponential(),de=de.slice(0,de.indexOf("e")+1)+me),Ie=new Ye(de)):Ie=new Ye(Le+""),Ie.c[0]){for(me=Ie.e,Le=me+Pe,Le<3&&(Le=0);;)if(Ne=Ie,Ie=Ue.times(Ne.plus(C(He,Ne,Pe,1))),$l(Ne.c).slice(0,Le)===(de=$l(Ie.c)).slice(0,Le))if(Ie.e<me&&--Le,de=de.slice(Le-3,Le+1),de=="9999"||!Xe&&de=="4999"){if(!Xe&&(Vt(Ne,Ne.e+L+2,0),Ne.times(Ne).eq(He))){Ie=Ne;break}Pe+=4,Le+=4,Xe=1}else{(!+de||!+de.slice(1)&&de.charAt(0)=="5")&&(Vt(Ie,Ie.e+L+2,1),oe=!Ie.times(Ie).eq(He));break}}return Vt(Ie,Ie.e+L+1,c,oe)},D.toExponential=function(oe,de){return oe!=null&&(Zr(oe,0,as),oe++),at(this,oe,de,1)},D.toFixed=function(oe,de){return oe!=null&&(Zr(oe,0,as),oe=oe+this.e+1),at(this,oe,de)},D.toFormat=function(oe,de,Ie){var Xe,Ne=this;if(Ie==null)oe!=null&&de&&typeof de=="object"?(Ie=de,de=null):oe&&typeof oe=="object"?(Ie=oe,oe=de=null):Ie=dt;else if(typeof Ie!="object")throw Error(Vo+"Argument not an object: "+Ie);if(Xe=Ne.toFixed(oe,de),Ne.c){var He,Fe=Xe.split("."),Le=+Ie.groupSize,me=+Ie.secondaryGroupSize,Pe=Ie.groupSeparator||"",Ue=Fe[0],tt=Fe[1],vt=Ne.s<0,Me=vt?Ue.slice(1):Ue,ut=Me.length;if(me&&(He=Le,Le=me,me=He,ut-=He),Le>0&&ut>0){for(He=ut%Le||Le,Ue=Me.substr(0,He);He<ut;He+=Le)Ue+=Pe+Me.substr(He,Le);me>0&&(Ue+=Pe+Me.slice(He)),vt&&(Ue="-"+Ue)}Xe=tt?Ue+(Ie.decimalSeparator||"")+((me=+Ie.fractionGroupSize)?tt.replace(new RegExp("\\d{"+me+"}\\B","g"),"$&"+(Ie.fractionGroupSeparator||"")):tt):Ue}return(Ie.prefix||"")+Xe+(Ie.suffix||"")},D.toFraction=function(oe){var de,Ie,Xe,Ne,He,Fe,Le,me,Pe,Ue,tt,vt,Me=this,ut=Me.c;if(oe!=null&&(Le=new Ye(oe),!Le.isInteger()&&(Le.c||Le.s!==1)||Le.lt(U)))throw Error(Vo+"Argument "+(Le.isInteger()?"out of range: ":"not an integer: ")+wt(Le));if(!ut)return new Ye(Me);for(de=new Ye(U),Pe=Ie=new Ye(U),Xe=me=new Ye(U),vt=$l(ut),He=de.e=vt.length-Me.e-1,de.c[0]=uy[(Fe=He%qn)<0?qn+Fe:Fe],oe=!oe||Le.comparedTo(de)>0?He>0?de:Pe:Le,Fe=ie,ie=1/0,Le=new Ye(vt),me.c[0]=0;Ue=C(Le,de,0,1),Ne=Ie.plus(Ue.times(Xe)),Ne.comparedTo(oe)!=1;)Ie=Xe,Xe=Ne,Pe=me.plus(Ue.times(Ne=Pe)),me=Ne,de=Le.minus(Ue.times(Ne=de)),Le=Ne;return Ne=C(oe.minus(Ie),Xe,0,1),me=me.plus(Ne.times(Pe)),Ie=Ie.plus(Ne.times(Xe)),me.s=Pe.s=Me.s,He=He*2,tt=C(Pe,Xe,He,c).minus(Me).abs().comparedTo(C(me,Ie,He,c).minus(Me).abs())<1?[Pe,Xe]:[me,Ie],ie=Fe,tt},D.toNumber=function(){return+wt(this)},D.toPrecision=function(oe,de){return oe!=null&&Zr(oe,1,as),at(this,oe,de,2)},D.toString=function(oe){var de,Ie=this,Xe=Ie.s,Ne=Ie.e;return Ne===null?Xe?(de="Infinity",Xe<0&&(de="-"+de)):de="NaN":(oe==null?de=Ne<=X||Ne>=ne?e_($l(Ie.c),Ne):vh($l(Ie.c),Ne,"0"):oe===10&&It?(Ie=Vt(new Ye(Ie),L+Ne+1,c),de=vh($l(Ie.c),Ie.e,"0")):(Zr(oe,2,Ce.length,"Base"),de=P(vh($l(Ie.c),Ne,"0"),10,oe,Xe,!0)),Xe<0&&Ie.c[0]&&(de="-"+de)),de},D.valueOf=D.toJSON=function(){return wt(this)},D._isBigNumber=!0,D[Symbol.toStringTag]="BigNumber",D[Symbol.for("nodejs.util.inspect.custom")]=D.valueOf,S!=null&&Ye.set(S),Ye}function Kl(S){var C=S|0;return S>0||S===C?C:C-1}function $l(S){for(var C,P,I=1,D=S.length,U=S[0]+"";I<D;){for(C=S[I++]+"",P=qn-C.length;P--;C="0"+C);U+=C}for(D=U.length;U.charCodeAt(--D)===48;);return U.slice(0,D+1||1)}function Ed(S,C){var P,I,D=S.c,U=C.c,L=S.s,c=C.s,X=S.e,ne=C.e;if(!L||!c)return null;if(P=D&&!D[0],I=U&&!U[0],P||I)return P?I?0:-c:L;if(L!=c)return L;if(P=L<0,I=X==ne,!D||!U)return I?0:!D^P?1:-1;if(!I)return X>ne^P?1:-1;for(c=(X=D.length)<(ne=U.length)?X:ne,L=0;L<c;L++)if(D[L]!=U[L])return D[L]>U[L]^P?1:-1;return X==ne?0:X>ne^P?1:-1}function Zr(S,C,P,I){if(S<C||S>P||S!==Wl(S))throw Error(Vo+(I||"Argument")+(typeof S=="number"?S<C||S>P?" out of range: ":" not an integer: ":" not a primitive number: ")+String(S))}function Jg(S){var C=S.c.length-1;return Kl(S.e/qn)==C&&S.c[C]%2!=0}function e_(S,C){return(S.length>1?S.charAt(0)+"."+S.slice(1):S)+(C<0?"e":"e+")+C}function vh(S,C,P){var I,D;if(C<0){for(D=P+".";++C;D+=P);S=D+S}else if(I=S.length,++C>I){for(D=P,C-=I;--C;D+=P);S+=D}else C<I&&(S=S.slice(0,C)+"."+S.slice(C));return S}var Pc=g0(),n1=class{key;left=null;right=null;constructor(S){this.key=S}},Bm=class extends n1{constructor(S){super(S)}},i1=class{size=0;modificationCount=0;splayCount=0;splay(S){const C=this.root;if(C==null)return this.compare(S,S),-1;let P=null,I=null,D=null,U=null,L=C;const c=this.compare;let X;for(;;)if(X=c(L.key,S),X>0){let ne=L.left;if(ne==null||(X=c(ne.key,S),X>0&&(L.left=ne.right,ne.right=L,L=ne,ne=L.left,ne==null)))break;P==null?I=L:P.left=L,P=L,L=ne}else if(X<0){let ne=L.right;if(ne==null||(X=c(ne.key,S),X<0&&(L.right=ne.left,ne.left=L,L=ne,ne=L.right,ne==null)))break;D==null?U=L:D.right=L,D=L,L=ne}else break;return D!=null&&(D.right=L.left,L.left=U),P!=null&&(P.left=L.right,L.right=I),this.root!==L&&(this.root=L,this.splayCount++),X}splayMin(S){let C=S,P=C.left;for(;P!=null;){const I=P;C.left=I.right,I.right=C,C=I,P=C.left}return C}splayMax(S){let C=S,P=C.right;for(;P!=null;){const I=P;C.right=I.left,I.left=C,C=I,P=C.right}return C}_delete(S){if(this.root==null||this.splay(S)!=0)return null;let P=this.root;const I=P,D=P.left;if(this.size--,D==null)this.root=P.right;else{const U=P.right;P=this.splayMax(D),P.right=U,this.root=P}return this.modificationCount++,I}addNewRoot(S,C){this.size++,this.modificationCount++;const P=this.root;if(P==null){this.root=S;return}C<0?(S.left=P,S.right=P.right,P.right=null):(S.right=P,S.left=P.left,P.left=null),this.root=S}_first(){const S=this.root;return S==null?null:(this.root=this.splayMin(S),this.root)}_last(){const S=this.root;return S==null?null:(this.root=this.splayMax(S),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(S){return this.validKey(S)&&this.splay(S)==0}defaultCompare(){return(S,C)=>S<C?-1:S>C?1:0}wrap(){return{getRoot:()=>this.root,setRoot:S=>{this.root=S},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:S=>{this.splayCount=S},splay:S=>this.splay(S),has:S=>this.has(S)}}},m_=class Gm extends i1{root=null;compare;validKey;constructor(C,P){super(),this.compare=C??this.defaultCompare(),this.validKey=P??(I=>I!=null&&I!=null)}delete(C){return this.validKey(C)?this._delete(C)!=null:!1}deleteAll(C){for(const P of C)this.delete(P)}forEach(C){const P=this[Symbol.iterator]();let I;for(;I=P.next(),!I.done;)C(I.value,I.value,this)}add(C){const P=this.splay(C);return P!=0&&this.addNewRoot(new Bm(C),P),this}addAndReturn(C){const P=this.splay(C);return P!=0&&this.addNewRoot(new Bm(C),P),this.root.key}addAll(C){for(const P of C)this.add(P)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(C){if(C==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(C)<0)return this.root.key;let I=this.root.left;if(I==null)return null;let D=I.right;for(;D!=null;)I=D,D=I.right;return I.key}firstAfter(C){if(C==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(C)>0)return this.root.key;let I=this.root.right;if(I==null)return null;let D=I.left;for(;D!=null;)I=D,D=I.left;return I.key}retainAll(C){const P=new Gm(this.compare,this.validKey),I=this.modificationCount;for(const D of C){if(I!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(D)&&this.splay(D)==0&&P.add(this.root.key)}P.size!=this.size&&(this.root=P.root,this.size=P.size,this.modificationCount++)}lookup(C){return!this.validKey(C)||this.splay(C)!=0?null:this.root.key}intersection(C){const P=new Gm(this.compare,this.validKey);for(const I of this)C.has(I)&&P.add(I);return P}difference(C){const P=new Gm(this.compare,this.validKey);for(const I of this)C.has(I)||P.add(I);return P}union(C){const P=this.clone();return P.addAll(C),P}clone(){const C=new Gm(this.compare,this.validKey);return C.size=this.size,C.root=this.copyNode(this.root),C}copyNode(C){if(C==null)return null;function P(D,U){let L,c;do{if(L=D.left,c=D.right,L!=null){const X=new Bm(L.key);U.left=X,P(L,X)}if(c!=null){const X=new Bm(c.key);U.right=X,D=c,U=X}}while(c!=null)}const I=new Bm(C.key);return P(C,I),I}toSet(){return this.clone()}entries(){return new a1(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new r1(this.wrap())}[Symbol.toStringTag]="[object Set]"},_0=class{tree;path=new Array;modificationCount=null;splayCount;constructor(S){this.tree=S,this.splayCount=S.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const S=this.path[this.path.length-1];return this.getValue(S)}rebuildPath(S){this.path.splice(0,this.path.length),this.tree.splay(S),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(S){for(;S!=null;)this.path.push(S),S=S.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let P=this.tree.getRoot();for(;P!=null;)this.path.push(P),P=P.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let S=this.path[this.path.length-1],C=S.right;if(C!=null){for(;C!=null;)this.path.push(C),C=C.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===S;)S=this.path.pop();return this.path.length>0}},r1=class extends _0{getValue(S){return S.key}},a1=class extends _0{getValue(S){return[S.key,S.key]}},y0=S=>()=>S,_y=S=>{const C=S?(P,I)=>I.minus(P).abs().isLessThanOrEqualTo(S):y0(!1);return(P,I)=>C(P,I)?0:P.comparedTo(I)};function s1(S){const C=S?(P,I,D,U,L)=>P.exponentiatedBy(2).isLessThanOrEqualTo(U.minus(I).exponentiatedBy(2).plus(L.minus(D).exponentiatedBy(2)).times(S)):y0(!1);return(P,I,D)=>{const U=P.x,L=P.y,c=D.x,X=D.y,ne=L.minus(X).times(I.x.minus(c)).minus(U.minus(c).times(I.y.minus(X)));return C(ne,U,L,c,X)?0:ne.comparedTo(0)}}var o1=S=>S,l1=S=>{if(S){const C=new m_(_y(S)),P=new m_(_y(S)),I=(U,L)=>L.addAndReturn(U),D=U=>({x:I(U.x,C),y:I(U.y,P)});return D({x:new Pc(0),y:new Pc(0)}),D}return o1},yy=S=>({set:C=>{wh=yy(C)},reset:()=>yy(S),compare:_y(S),snap:l1(S),orient:s1(S)}),wh=yy(),Fm=(S,C)=>S.ll.x.isLessThanOrEqualTo(C.x)&&C.x.isLessThanOrEqualTo(S.ur.x)&&S.ll.y.isLessThanOrEqualTo(C.y)&&C.y.isLessThanOrEqualTo(S.ur.y),vy=(S,C)=>{if(C.ur.x.isLessThan(S.ll.x)||S.ur.x.isLessThan(C.ll.x)||C.ur.y.isLessThan(S.ll.y)||S.ur.y.isLessThan(C.ll.y))return null;const P=S.ll.x.isLessThan(C.ll.x)?C.ll.x:S.ll.x,I=S.ur.x.isLessThan(C.ur.x)?S.ur.x:C.ur.x,D=S.ll.y.isLessThan(C.ll.y)?C.ll.y:S.ll.y,U=S.ur.y.isLessThan(C.ur.y)?S.ur.y:C.ur.y;return{ll:{x:P,y:D},ur:{x:I,y:U}}},s_=(S,C)=>S.x.times(C.y).minus(S.y.times(C.x)),v0=(S,C)=>S.x.times(C.x).plus(S.y.times(C.y)),g_=S=>v0(S,S).sqrt(),u1=(S,C,P)=>{const I={x:C.x.minus(S.x),y:C.y.minus(S.y)},D={x:P.x.minus(S.x),y:P.y.minus(S.y)};return s_(D,I).div(g_(D)).div(g_(I))},c1=(S,C,P)=>{const I={x:C.x.minus(S.x),y:C.y.minus(S.y)},D={x:P.x.minus(S.x),y:P.y.minus(S.y)};return v0(D,I).div(g_(D)).div(g_(I))},wv=(S,C,P)=>C.y.isZero()?null:{x:S.x.plus(C.x.div(C.y).times(P.minus(S.y))),y:P},Tv=(S,C,P)=>C.x.isZero()?null:{x:P,y:S.y.plus(C.y.div(C.x).times(P.minus(S.x)))},h1=(S,C,P,I)=>{if(C.x.isZero())return Tv(P,I,S.x);if(I.x.isZero())return Tv(S,C,P.x);if(C.y.isZero())return wv(P,I,S.y);if(I.y.isZero())return wv(S,C,P.y);const D=s_(C,I);if(D.isZero())return null;const U={x:P.x.minus(S.x),y:P.y.minus(S.y)},L=s_(U,C).div(D),c=s_(U,I).div(D),X=S.x.plus(c.times(C.x)),ne=P.x.plus(L.times(I.x)),fe=S.y.plus(c.times(C.y)),ie=P.y.plus(L.times(I.y)),xe=X.plus(ne).div(2),Be=fe.plus(ie).div(2);return{x:xe,y:Be}},Ic=class x0{point;isLeft;segment;otherSE;consumedBy;static compare(C,P){const I=x0.comparePoints(C.point,P.point);return I!==0?I:(C.point!==P.point&&C.link(P),C.isLeft!==P.isLeft?C.isLeft?1:-1:__.compare(C.segment,P.segment))}static comparePoints(C,P){return C.x.isLessThan(P.x)?-1:C.x.isGreaterThan(P.x)?1:C.y.isLessThan(P.y)?-1:C.y.isGreaterThan(P.y)?1:0}constructor(C,P){C.events===void 0?C.events=[this]:C.events.push(this),this.point=C,this.isLeft=P}link(C){if(C.point===this.point)throw new Error("Tried to link already linked events");const P=C.point.events;for(let I=0,D=P.length;I<D;I++){const U=P[I];this.point.events.push(U),U.point=this.point}this.checkForConsuming()}checkForConsuming(){const C=this.point.events.length;for(let P=0;P<C;P++){const I=this.point.events[P];if(I.segment.consumedBy===void 0)for(let D=P+1;D<C;D++){const U=this.point.events[D];U.consumedBy===void 0&&I.otherSE.point.events===U.otherSE.point.events&&I.segment.consume(U.segment)}}}getAvailableLinkedEvents(){const C=[];for(let P=0,I=this.point.events.length;P<I;P++){const D=this.point.events[P];D!==this&&!D.segment.ringOut&&D.segment.isInResult()&&C.push(D)}return C}getLeftmostComparator(C){const P=new Map,I=D=>{const U=D.otherSE;P.set(D,{sine:u1(this.point,C.point,U.point),cosine:c1(this.point,C.point,U.point)})};return(D,U)=>{P.has(D)||I(D),P.has(U)||I(U);const{sine:L,cosine:c}=P.get(D),{sine:X,cosine:ne}=P.get(U);return L.isGreaterThanOrEqualTo(0)&&X.isGreaterThanOrEqualTo(0)?c.isLessThan(ne)?1:c.isGreaterThan(ne)?-1:0:L.isLessThan(0)&&X.isLessThan(0)?c.isLessThan(ne)?-1:c.isGreaterThan(ne)?1:0:X.isLessThan(L)?-1:X.isGreaterThan(L)?1:0}}},f1=class xy{events;poly;_isExteriorRing;_enclosingRing;static factory(C){const P=[];for(let I=0,D=C.length;I<D;I++){const U=C[I];if(!U.isInResult()||U.ringOut)continue;let L=null,c=U.leftSE,X=U.rightSE;const ne=[c],fe=c.point,ie=[];for(;L=c,c=X,ne.push(c),c.point!==fe;)for(;;){const xe=c.getAvailableLinkedEvents();if(xe.length===0){const dt=ne[0].point,Ce=ne[ne.length-1].point;throw new Error(`Unable to complete output ring starting at [${dt.x}, ${dt.y}]. Last matching segment found ends at [${Ce.x}, ${Ce.y}].`)}if(xe.length===1){X=xe[0].otherSE;break}let Be=null;for(let dt=0,Ce=ie.length;dt<Ce;dt++)if(ie[dt].point===c.point){Be=dt;break}if(Be!==null){const dt=ie.splice(Be)[0],Ce=ne.splice(dt.index);Ce.unshift(Ce[0].otherSE),P.push(new xy(Ce.reverse()));continue}ie.push({index:ne.length,point:c.point});const Ge=c.getLeftmostComparator(L);X=xe.sort(Ge)[0].otherSE;break}P.push(new xy(ne))}return P}constructor(C){this.events=C;for(let P=0,I=C.length;P<I;P++)C[P].segment.ringOut=this;this.poly=null}getGeom(){let C=this.events[0].point;const P=[C];for(let ne=1,fe=this.events.length-1;ne<fe;ne++){const ie=this.events[ne].point,xe=this.events[ne+1].point;wh.orient(ie,C,xe)!==0&&(P.push(ie),C=ie)}if(P.length===1)return null;const I=P[0],D=P[1];wh.orient(I,C,D)===0&&P.shift(),P.push(P[0]);const U=this.isExteriorRing()?1:-1,L=this.isExteriorRing()?0:P.length-1,c=this.isExteriorRing()?P.length:-1,X=[];for(let ne=L;ne!=c;ne+=U)X.push([P[ne].x.toNumber(),P[ne].y.toNumber()]);return X}isExteriorRing(){if(this._isExteriorRing===void 0){const C=this.enclosingRing();this._isExteriorRing=C?!C.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let C=this.events[0];for(let D=1,U=this.events.length;D<U;D++){const L=this.events[D];Ic.compare(C,L)>0&&(C=L)}let P=C.segment.prevInResult(),I=P?P.prevInResult():null;for(;;){if(!P)return null;if(!I)return P.ringOut;if(I.ringOut!==P.ringOut)return I.ringOut?.enclosingRing()!==P.ringOut?P.ringOut:P.ringOut?.enclosingRing();P=I.prevInResult(),I=P?P.prevInResult():null}}},Sv=class{exteriorRing;interiorRings;constructor(S){this.exteriorRing=S,S.poly=this,this.interiorRings=[]}addInterior(S){this.interiorRings.push(S),S.poly=this}getGeom(){const S=this.exteriorRing.getGeom();if(S===null)return null;const C=[S];for(let P=0,I=this.interiorRings.length;P<I;P++){const D=this.interiorRings[P].getGeom();D!==null&&C.push(D)}return C}},d1=class{rings;polys;constructor(S){this.rings=S,this.polys=this._composePolys(S)}getGeom(){const S=[];for(let C=0,P=this.polys.length;C<P;C++){const I=this.polys[C].getGeom();I!==null&&S.push(I)}return S}_composePolys(S){const C=[];for(let P=0,I=S.length;P<I;P++){const D=S[P];if(!D.poly)if(D.isExteriorRing())C.push(new Sv(D));else{const U=D.enclosingRing();U?.poly||C.push(new Sv(U)),U?.poly?.addInterior(D)}}return C}},p1=class{queue;tree;segments;constructor(S,C=__.compare){this.queue=S,this.tree=new m_(C),this.segments=[]}process(S){const C=S.segment,P=[];if(S.consumedBy)return S.isLeft?this.queue.delete(S.otherSE):this.tree.delete(C),P;S.isLeft&&this.tree.add(C);let I=C,D=C;do I=this.tree.lastBefore(I);while(I!=null&&I.consumedBy!=null);do D=this.tree.firstAfter(D);while(D!=null&&D.consumedBy!=null);if(S.isLeft){let U=null;if(I){const c=I.getIntersection(C);if(c!==null&&(C.isAnEndpoint(c)||(U=c),!I.isAnEndpoint(c))){const X=this._splitSafely(I,c);for(let ne=0,fe=X.length;ne<fe;ne++)P.push(X[ne])}}let L=null;if(D){const c=D.getIntersection(C);if(c!==null&&(C.isAnEndpoint(c)||(L=c),!D.isAnEndpoint(c))){const X=this._splitSafely(D,c);for(let ne=0,fe=X.length;ne<fe;ne++)P.push(X[ne])}}if(U!==null||L!==null){let c=null;U===null?c=L:L===null?c=U:c=Ic.comparePoints(U,L)<=0?U:L,this.queue.delete(C.rightSE),P.push(C.rightSE);const X=C.split(c);for(let ne=0,fe=X.length;ne<fe;ne++)P.push(X[ne])}P.length>0?(this.tree.delete(C),P.push(S)):(this.segments.push(C),C.prev=I)}else{if(I&&D){const U=I.getIntersection(D);if(U!==null){if(!I.isAnEndpoint(U)){const L=this._splitSafely(I,U);for(let c=0,X=L.length;c<X;c++)P.push(L[c])}if(!D.isAnEndpoint(U)){const L=this._splitSafely(D,U);for(let c=0,X=L.length;c<X;c++)P.push(L[c])}}}this.tree.delete(C)}return P}_splitSafely(S,C){this.tree.delete(S);const P=S.rightSE;this.queue.delete(P);const I=S.split(C);return I.push(P),S.consumedBy===void 0&&this.tree.add(S),I}},m1=class{type;numMultiPolys;run(S,C,P){qm.type=S;const I=[new Mv(C,!0)];for(let ne=0,fe=P.length;ne<fe;ne++)I.push(new Mv(P[ne],!1));if(qm.numMultiPolys=I.length,qm.type==="difference"){const ne=I[0];let fe=1;for(;fe<I.length;)vy(I[fe].bbox,ne.bbox)!==null?fe++:I.splice(fe,1)}if(qm.type==="intersection")for(let ne=0,fe=I.length;ne<fe;ne++){const ie=I[ne];for(let xe=ne+1,Be=I.length;xe<Be;xe++)if(vy(ie.bbox,I[xe].bbox)===null)return[]}const D=new m_(Ic.compare);for(let ne=0,fe=I.length;ne<fe;ne++){const ie=I[ne].getSweepEvents();for(let xe=0,Be=ie.length;xe<Be;xe++)D.add(ie[xe])}const U=new p1(D);let L=null;for(D.size!=0&&(L=D.first(),D.delete(L));L;){const ne=U.process(L);for(let fe=0,ie=ne.length;fe<ie;fe++){const xe=ne[fe];xe.consumedBy===void 0&&D.add(xe)}D.size!=0?(L=D.first(),D.delete(L)):L=null}wh.reset();const c=f1.factory(U.segments);return new d1(c).getGeom()}},qm=new m1,Xm=qm,g1=0,__=class o_{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(C,P){const I=C.leftSE.point.x,D=P.leftSE.point.x,U=C.rightSE.point.x,L=P.rightSE.point.x;if(L.isLessThan(I))return 1;if(U.isLessThan(D))return-1;const c=C.leftSE.point.y,X=P.leftSE.point.y,ne=C.rightSE.point.y,fe=P.rightSE.point.y;if(I.isLessThan(D)){if(X.isLessThan(c)&&X.isLessThan(ne))return 1;if(X.isGreaterThan(c)&&X.isGreaterThan(ne))return-1;const ie=C.comparePoint(P.leftSE.point);if(ie<0)return 1;if(ie>0)return-1;const xe=P.comparePoint(C.rightSE.point);return xe!==0?xe:-1}if(I.isGreaterThan(D)){if(c.isLessThan(X)&&c.isLessThan(fe))return-1;if(c.isGreaterThan(X)&&c.isGreaterThan(fe))return 1;const ie=P.comparePoint(C.leftSE.point);if(ie!==0)return ie;const xe=C.comparePoint(P.rightSE.point);return xe<0?1:xe>0?-1:1}if(c.isLessThan(X))return-1;if(c.isGreaterThan(X))return 1;if(U.isLessThan(L)){const ie=P.comparePoint(C.rightSE.point);if(ie!==0)return ie}if(U.isGreaterThan(L)){const ie=C.comparePoint(P.rightSE.point);if(ie<0)return 1;if(ie>0)return-1}if(!U.eq(L)){const ie=ne.minus(c),xe=U.minus(I),Be=fe.minus(X),Ge=L.minus(D);if(ie.isGreaterThan(xe)&&Be.isLessThan(Ge))return 1;if(ie.isLessThan(xe)&&Be.isGreaterThan(Ge))return-1}return U.isGreaterThan(L)?1:U.isLessThan(L)||ne.isLessThan(fe)?-1:ne.isGreaterThan(fe)?1:C.id<P.id?-1:C.id>P.id?1:0}constructor(C,P,I,D){this.id=++g1,this.leftSE=C,C.segment=this,C.otherSE=P,this.rightSE=P,P.segment=this,P.otherSE=C,this.rings=I,this.windings=D}static fromRing(C,P,I){let D,U,L;const c=Ic.comparePoints(C,P);if(c<0)D=C,U=P,L=1;else if(c>0)D=P,U=C,L=-1;else throw new Error(`Tried to create degenerate segment at [${C.x}, ${C.y}]`);const X=new Ic(D,!0),ne=new Ic(U,!1);return new o_(X,ne,[I],[L])}replaceRightSE(C){this.rightSE=C,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const C=this.leftSE.point.y,P=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:C.isLessThan(P)?C:P},ur:{x:this.rightSE.point.x,y:C.isGreaterThan(P)?C:P}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(C){return C.x.eq(this.leftSE.point.x)&&C.y.eq(this.leftSE.point.y)||C.x.eq(this.rightSE.point.x)&&C.y.eq(this.rightSE.point.y)}comparePoint(C){return wh.orient(this.leftSE.point,C,this.rightSE.point)}getIntersection(C){const P=this.bbox(),I=C.bbox(),D=vy(P,I);if(D===null)return null;const U=this.leftSE.point,L=this.rightSE.point,c=C.leftSE.point,X=C.rightSE.point,ne=Fm(P,c)&&this.comparePoint(c)===0,fe=Fm(I,U)&&C.comparePoint(U)===0,ie=Fm(P,X)&&this.comparePoint(X)===0,xe=Fm(I,L)&&C.comparePoint(L)===0;if(fe&&ne)return xe&&!ie?L:!xe&&ie?X:null;if(fe)return ie&&U.x.eq(X.x)&&U.y.eq(X.y)?null:U;if(ne)return xe&&L.x.eq(c.x)&&L.y.eq(c.y)?null:c;if(xe&&ie)return null;if(xe)return L;if(ie)return X;const Be=h1(U,this.vector(),c,C.vector());return Be===null||!Fm(D,Be)?null:wh.snap(Be)}split(C){const P=[],I=C.events!==void 0,D=new Ic(C,!0),U=new Ic(C,!1),L=this.rightSE;this.replaceRightSE(U),P.push(U),P.push(D);const c=new o_(D,L,this.rings.slice(),this.windings.slice());return Ic.comparePoints(c.leftSE.point,c.rightSE.point)>0&&c.swapEvents(),Ic.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),I&&(D.checkForConsuming(),U.checkForConsuming()),P}swapEvents(){const C=this.rightSE;this.rightSE=this.leftSE,this.leftSE=C,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let P=0,I=this.windings.length;P<I;P++)this.windings[P]*=-1}consume(C){let P=this,I=C;for(;P.consumedBy;)P=P.consumedBy;for(;I.consumedBy;)I=I.consumedBy;const D=o_.compare(P,I);if(D!==0){if(D>0){const U=P;P=I,I=U}if(P.prev===I){const U=P;P=I,I=U}for(let U=0,L=I.rings.length;U<L;U++){const c=I.rings[U],X=I.windings[U],ne=P.rings.indexOf(c);ne===-1?(P.rings.push(c),P.windings.push(X)):P.windings[ne]+=X}I.rings=null,I.windings=null,I.consumedBy=P,I.leftSE.consumedBy=P.leftSE,I.rightSE.consumedBy=P.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const C=this.prev.consumedBy||this.prev;this._beforeState=C.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const C=this.beforeState();this._afterState={rings:C.rings.slice(0),windings:C.windings.slice(0),multiPolys:[]};const P=this._afterState.rings,I=this._afterState.windings,D=this._afterState.multiPolys;for(let c=0,X=this.rings.length;c<X;c++){const ne=this.rings[c],fe=this.windings[c],ie=P.indexOf(ne);ie===-1?(P.push(ne),I.push(fe)):I[ie]+=fe}const U=[],L=[];for(let c=0,X=P.length;c<X;c++){if(I[c]===0)continue;const ne=P[c],fe=ne.poly;if(L.indexOf(fe)===-1)if(ne.isExterior)U.push(fe);else{L.indexOf(fe)===-1&&L.push(fe);const ie=U.indexOf(ne.poly);ie!==-1&&U.splice(ie,1)}}for(let c=0,X=U.length;c<X;c++){const ne=U[c].multiPoly;D.indexOf(ne)===-1&&D.push(ne)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const C=this.beforeState().multiPolys,P=this.afterState().multiPolys;switch(Xm.type){case"union":{const I=C.length===0,D=P.length===0;this._isInResult=I!==D;break}case"intersection":{let I,D;C.length<P.length?(I=C.length,D=P.length):(I=P.length,D=C.length),this._isInResult=D===Xm.numMultiPolys&&I<D;break}case"xor":{const I=Math.abs(C.length-P.length);this._isInResult=I%2===1;break}case"difference":{const I=D=>D.length===1&&D[0].isSubject;this._isInResult=I(C)!==I(P);break}}return this._isInResult}},Ev=class{poly;isExterior;segments;bbox;constructor(S,C,P){if(!Array.isArray(S)||S.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=C,this.isExterior=P,this.segments=[],typeof S[0][0]!="number"||typeof S[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const I=wh.snap({x:new Pc(S[0][0]),y:new Pc(S[0][1])});this.bbox={ll:{x:I.x,y:I.y},ur:{x:I.x,y:I.y}};let D=I;for(let U=1,L=S.length;U<L;U++){if(typeof S[U][0]!="number"||typeof S[U][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const c=wh.snap({x:new Pc(S[U][0]),y:new Pc(S[U][1])});c.x.eq(D.x)&&c.y.eq(D.y)||(this.segments.push(__.fromRing(D,c,this)),c.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=c.x),c.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=c.y),c.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=c.x),c.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=c.y),D=c)}(!I.x.eq(D.x)||!I.y.eq(D.y))&&this.segments.push(__.fromRing(D,I,this))}getSweepEvents(){const S=[];for(let C=0,P=this.segments.length;C<P;C++){const I=this.segments[C];S.push(I.leftSE),S.push(I.rightSE)}return S}},_1=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(S,C){if(!Array.isArray(S))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ev(S[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let P=1,I=S.length;P<I;P++){const D=new Ev(S[P],this,!1);D.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=D.bbox.ll.x),D.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=D.bbox.ll.y),D.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=D.bbox.ur.x),D.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=D.bbox.ur.y),this.interiorRings.push(D)}this.multiPoly=C}getSweepEvents(){const S=this.exteriorRing.getSweepEvents();for(let C=0,P=this.interiorRings.length;C<P;C++){const I=this.interiorRings[C].getSweepEvents();for(let D=0,U=I.length;D<U;D++)S.push(I[D])}return S}},Mv=class{isSubject;polys;bbox;constructor(S,C){if(!Array.isArray(S))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof S[0][0][0]=="number"&&(S=[S])}catch{}this.polys=[],this.bbox={ll:{x:new Pc(Number.POSITIVE_INFINITY),y:new Pc(Number.POSITIVE_INFINITY)},ur:{x:new Pc(Number.NEGATIVE_INFINITY),y:new Pc(Number.NEGATIVE_INFINITY)}};for(let P=0,I=S.length;P<I;P++){const D=new _1(S[P],this);D.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=D.bbox.ll.x),D.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=D.bbox.ll.y),D.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=D.bbox.ur.x),D.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=D.bbox.ur.y),this.polys.push(D)}this.isSubject=C}getSweepEvents(){const S=[];for(let C=0,P=this.polys.length;C<P;C++){const I=this.polys[C].getSweepEvents();for(let D=0,U=I.length;D<U;D++)S.push(I[D])}return S}},y1=(S,...C)=>Xm.run("union",S,C),v1=(S,...C)=>Xm.run("intersection",S,C),x1=(S,...C)=>Xm.run("difference",S,C);wh.set;function b1(S){const C=[];if(Th(S,D=>{C.push(D.coordinates)}),C.length<2)throw new Error("Must have at least two features");const P=S.features[0].properties||{},I=x1(C[0],...C.slice(1));return I.length===0?null:I.length===1?xl(I[0],P):x_(I,P)}function w1(S,C,P={}){const I=bh(S),D=bh(C);D[0]+=D[0]-I[0]>180?-360:I[0]-D[0]>180?360:0;const U=T1(I,D);return Q0(U,"meters",P.units)}function T1(S,C,P){P=P===void 0?Es:Number(P);const I=P,D=S[1]*Math.PI/180,U=C[1]*Math.PI/180,L=U-D;let c=Math.abs(C[0]-S[0])*Math.PI/180;c>Math.PI&&(c-=2*Math.PI);const X=Math.log(Math.tan(U/2+Math.PI/4)/Math.tan(D/2+Math.PI/4)),ne=Math.abs(X)>1e-11?L/X:Math.cos(D);return Math.sqrt(L*L+ne*ne*c*c)*I}var Cv=Math.PI/180,Iv=180/Math.PI,$m=function(S,C){this.lon=S,this.lat=C,this.x=Cv*S,this.y=Cv*C};$m.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)};$m.prototype.antipode=function(){var S=-1*this.lat,C=this.lon<0?180+this.lon:(180-this.lon)*-1;return new $m(C,S)};var b0=function(){this.coords=[],this.length=0};b0.prototype.move_to=function(S){this.length++,this.coords.push(S)};var My=function(S){this.properties=S||{},this.geometries=[]};My.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(this.geometries.length===1)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var S=[],C=0;C<this.geometries.length;C++)S.push(this.geometries[C].coords);return{geometry:{type:"MultiLineString",coordinates:S},type:"Feature",properties:this.properties}};My.prototype.wkt=function(){for(var S="",C="LINESTRING(",P=function(U){C+=U[0]+" "+U[1]+","},I=0;I<this.geometries.length;I++){if(this.geometries[I].coords.length===0)return"LINESTRING(empty)";var D=this.geometries[I].coords;D.forEach(P),S+=C.substring(0,C.length-1)+")"}return S};var Cy=function(S,C,P){if(!S||S.x===void 0||S.y===void 0)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!C||C.x===void 0||C.y===void 0)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new $m(S.x,S.y),this.end=new $m(C.x,C.y),this.properties=P||{};var I=this.start.x-this.end.x,D=this.start.y-this.end.y,U=Math.pow(Math.sin(D/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(I/2),2);if(this.g=2*Math.asin(Math.sqrt(U)),this.g===Math.PI)throw new Error("it appears "+this.start.view()+" and "+this.end.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+S+" and "+C)};Cy.prototype.interpolate=function(S){var C=Math.sin((1-S)*this.g)/Math.sin(this.g),P=Math.sin(S*this.g)/Math.sin(this.g),I=C*Math.cos(this.start.y)*Math.cos(this.start.x)+P*Math.cos(this.end.y)*Math.cos(this.end.x),D=C*Math.cos(this.start.y)*Math.sin(this.start.x)+P*Math.cos(this.end.y)*Math.sin(this.end.x),U=C*Math.sin(this.start.y)+P*Math.sin(this.end.y),L=Iv*Math.atan2(U,Math.sqrt(Math.pow(I,2)+Math.pow(D,2))),c=Iv*Math.atan2(D,I);return[c,L]};Cy.prototype.Arc=function(S,C){var P=[];if(!S||S<=2)P.push([this.start.lon,this.start.lat]),P.push([this.end.lon,this.end.lat]);else for(var I=1/(S-1),D=0;D<S;++D){var U=I*D,L=this.interpolate(U);P.push(L)}for(var c=!1,X=0,ne=C&&C.offset?C.offset:10,fe=180-ne,ie=-180+ne,xe=360-ne,Be=1;Be<P.length;++Be){var Ge=P[Be-1][0],dt=P[Be][0],Ce=Math.abs(dt-Ge);Ce>xe&&(dt>fe&&Ge<ie||Ge>fe&&dt<ie)?c=!0:Ce>X&&(X=Ce)}var It=[];if(c&&X<ne){var Ye=[];It.push(Ye);for(var at=0;at<P.length;++at){var jt=parseFloat(P[at][0]);if(at>0&&Math.abs(jt-P[at-1][0])>xe){var At=parseFloat(P[at-1][0]),Vt=parseFloat(P[at-1][1]),wt=parseFloat(P[at][0]),oe=parseFloat(P[at][1]);if(At>-180&&At<ie&&wt===180&&at+1<P.length&&P[at-1][0]>-180&&P[at-1][0]<ie){Ye.push([-180,P[at][1]]),at++,Ye.push([P[at][0],P[at][1]]);continue}else if(At>fe&&At<180&&wt===-180&&at+1<P.length&&P[at-1][0]>fe&&P[at-1][0]<180){Ye.push([180,P[at][1]]),at++,Ye.push([P[at][0],P[at][1]]);continue}if(At<ie&&wt>fe){var de=At;At=wt,wt=de;var Ie=Vt;Vt=oe,oe=Ie}if(At>fe&&wt<ie&&(wt+=360),At<=180&&wt>=180&&At<wt){var Xe=(180-At)/(wt-At),Ne=Xe*oe+(1-Xe)*Vt;Ye.push([P[at-1][0]>fe?180:-180,Ne]),Ye=[],Ye.push([P[at-1][0]>fe?-180:180,Ne]),It.push(Ye)}else Ye=[],It.push(Ye);Ye.push([jt,P[at][1]])}else Ye.push([P[at][0],P[at][1]])}}else{var He=[];It.push(He);for(var Fe=0;Fe<P.length;++Fe)He.push([P[Fe][0],P[Fe][1]])}for(var Le=new My(this.properties),me=0;me<It.length;++me){var Pe=new b0;Le.geometries.push(Pe);for(var Ue=It[me],tt=0;tt<Ue.length;++tt)Pe.move_to(Ue[tt])}return Le};function S1(S,C,P){if(P=P||{},typeof P!="object")throw new Error("options is invalid");var I=P.properties,D=P.npoints,U=P.offset;if(S=bh(S),C=bh(C),I=I||{},D=D||100,S[0]===C[0]&&S[1]===C[1]){const X=Array(D);return X.fill([S[0],S[1]]),Cd(X,I)}U=U||10;var L=new Cy({x:S[0],y:S[1]},{x:C[0],y:C[1]},I),c=L.Arc(D,{offset:U});return c.json()}function E1(S,C={}){const P=[];if(Th(S,D=>{P.push(D.coordinates)}),P.length<2)throw new Error("Must specify at least 2 geometries");const I=v1(P[0],...P.slice(1));return I.length===0?null:I.length===1?xl(I[0],C.properties):x_(I,C.properties)}function M1(S,C={}){var P,I;if(C=C||{},!Yv(C))throw new Error("options is invalid");const D=(P=C.mutate)!=null?P:!1,U=(I=C.reverse)!=null?I:!1;if(!S)throw new Error("<geojson> is required");if(typeof U!="boolean")throw new Error("<reverse> must be a boolean");if(typeof D!="boolean")throw new Error("<mutate> must be a boolean");!D&&S.type!=="Point"&&S.type!=="MultiPoint"&&(S=f0(S));const L=[];switch(S.type){case"GeometryCollection":return Th(S,function(c){l_(c,U)}),S;case"FeatureCollection":return u_(S,function(c){const X=l_(c,U);u_(X,function(ne){L.push(ne)})}),bl(L)}return l_(S,U)}function l_(S,C){switch(S.type==="Feature"?S.geometry.type:S.type){case"GeometryCollection":return Th(S,function(I){l_(I,C)}),S;case"LineString":return Av(Ac(S),C),S;case"Polygon":return kv(Ac(S),C),S;case"MultiLineString":return Ac(S).forEach(function(I){Av(I,C)}),S;case"MultiPolygon":return Ac(S).forEach(function(I){kv(I,C)}),S;case"Point":case"MultiPoint":return S}}function Av(S,C){hy(S)===C&&S.reverse()}function kv(S,C){hy(S[0])!==C&&S[0].reverse();for(let P=1;P<S.length;P++)hy(S[P])===C&&S[P].reverse()}function C1(S,C){var P=S[0]-C[0],I=S[1]-C[1];return P*P+I*I}function I1(S,C,P){var I=C[0],D=C[1],U=P[0]-I,L=P[1]-D;if(U!==0||L!==0){var c=((S[0]-I)*U+(S[1]-D)*L)/(U*U+L*L);c>1?(I=P[0],D=P[1]):c>0&&(I+=U*c,D+=L*c)}return U=S[0]-I,L=S[1]-D,U*U+L*L}function A1(S,C){for(var P=S[0],I=[P],D,U=1,L=S.length;U<L;U++)D=S[U],C1(D,P)>C&&(I.push(D),P=D);return P!==D&&I.push(D),I}function by(S,C,P,I,D){for(var U=I,L,c=C+1;c<P;c++){var X=I1(S[c],S[C],S[P]);X>U&&(L=c,U=X)}U>I&&(L-C>1&&by(S,C,L,I,D),D.push(S[L]),P-L>1&&by(S,L,P,I,D))}function k1(S,C){var P=S.length-1,I=[S[0]];return by(S,0,P,C,I),I.push(S[P]),I}function y_(S,C,P){if(S.length<=2)return S;var I=C!==void 0?C*C:1;return S=P?S:A1(S,I),S=k1(S,I),S}function P1(S,C={}){var P,I,D;if(C=C??{},!Yv(C))throw new Error("options is invalid");const U=(P=C.tolerance)!=null?P:1,L=(I=C.highQuality)!=null?I:!1,c=(D=C.mutate)!=null?D:!1;if(!S)throw new Error("geojson is required");if(U&&U<0)throw new Error("invalid tolerance");return c!==!0&&(S=f0(S)),Th(S,function(X){R1(X,U,L)}),S}function R1(S,C,P){const I=S.type;if(I==="Point"||I==="MultiPoint")return S;if(vx(S,{mutate:!0}),I!=="GeometryCollection")switch(I){case"LineString":S.coordinates=y_(S.coordinates,C,P);break;case"MultiLineString":S.coordinates=S.coordinates.map(D=>y_(D,C,P));break;case"Polygon":S.coordinates=Pv(S.coordinates,C,P);break;case"MultiPolygon":S.coordinates=S.coordinates.map(D=>Pv(D,C,P))}return S}function Pv(S,C,P){return S.map(function(I){if(I.length<4)throw new Error("invalid polygon");let D=C,U=y_(I,D,P);for(;!Rv(U)&&D>=Number.EPSILON;)D-=D*.01,U=y_(I,D,P);return Rv(U)?((U[U.length-1][0]!==U[0][0]||U[U.length-1][1]!==U[0][1])&&U.push(U[0]),U):I})}function Rv(S){return S.length<3?!1:!(S.length===3&&S[2][0]===S[0][0]&&S[2][1]===S[0][1])}function D1(S,C={}){const P=[];if(Th(S,D=>{P.push(D.coordinates)}),P.length<2)throw new Error("Must have at least 2 geometries");const I=y1(P[0],...P.slice(1));return I.length===0?null:I.length===1?xl(I[0],C.properties):x_(I,C.properties)}const Gu={uniqueId:"distanceLab",meta:{title:"",description:"2",initialViewState:{longitude:0,latitude:0,zoom:4}},state:{clickedCoordsPrevious:null,clickedCoordsCurrent:null},compute:S=>{const{clickedCoordsPrevious:C,clickedCoordsCurrent:P}=S;if(C&&P){const I=Zm.MercatorCoordinate.fromLngLat({lng:C[0],lat:C[1]}),D=Zm.MercatorCoordinate.fromLngLat({lng:P[0],lat:P[1]}),U=new Zm.MercatorCoordinate((D.x+I.x)/2,(D.y+I.y)/2),L=D.x-I.x,c=D.y-I.y,X=Math.sqrt(L*L+c*c),ne=U.meterInMercatorCoordinateUnits(),fe=X/ne/1e3,ie=tx(Zu(C),Zu(P),{units:"kilometers"}),xe=w1(Zu(C),Zu(P),{units:"kilometers"});return[{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"LineString",coordinates:[C,P]},properties:{distanceByMercator:fe,distanceByTurf:ie,distanceByTurfRhumb:xe}}]}]}else return null},Panel:(S,C)=>{const{clickedCoordsPrevious:P,clickedCoordsCurrent:I}=S,D=C&&C.length>0?C[0]?.features[0]:null,U=D?D.properties?.distanceByMercator:null,L=D?D.properties?.distanceByTurf:null,c=D?D.properties?.distanceByTurfRhumb:null;return et.jsxs("div",{children:[et.jsx("h2",{children:""}),et.jsx("p",{children:"2"}),et.jsxs("div",{children:[et.jsx("b",{children:":"})," ",P?`[${P[0].toFixed(6)}, ${P[1].toFixed(6)}]`:""]}),et.jsxs("div",{children:[et.jsx("b",{children:":"})," ",I?`[${I[0].toFixed(6)}, ${I[1].toFixed(6)}]`:""]}),et.jsx("hr",{}),et.jsx("div",{children:I?et.jsxs("div",{children:[" (WGS84):",et.jsx("br",{}),"Longitude: ",I[0].toFixed(4),", Latitude:"," ",I[1].toFixed(4)]}):et.jsx("div",{children:""})}),et.jsx("hr",{}),et.jsxs("div",{children:[U?et.jsxs("h3",{children:["2:",et.jsx("br",{}),U.toFixed(4)," "]}):et.jsx("div",{children:"2"}),et.jsxs("p",{children:[et.jsx("b",{children:"Mercator "}),et.jsx("br",{}),""]})]}),et.jsx("hr",{}),et.jsxs("div",{children:[L?et.jsxs("h3",{children:["turf.distance 2:",et.jsx("br",{}),L.toFixed(4)," "]}):et.jsx("div",{children:"2"}),et.jsxs("p",{children:[et.jsx("b",{children:"turf.distance  Haversine formula "}),et.jsx("br",{})," ",et.jsx("br",{}),""]})]}),et.jsx("hr",{}),et.jsxs("div",{children:[c?et.jsxs("h3",{children:["turf.rhumbDistance 2:",et.jsx("br",{}),c.toFixed(4)," "]}):et.jsx("div",{children:"2"}),et.jsxs("p",{children:[et.jsx("b",{children:"turf.rhumbDistance  Rhumb line "}),et.jsx("br",{})," ",et.jsx("br",{}),""]})]})]})}},qu={uniqueId:"greatCircleLab",meta:{title:"Great Circle",description:"2 Great Circle ",initialViewState:{longitude:0,latitude:0,zoom:4}},state:{clickedCoordsPrevious:null,clickedCoordsCurrent:null},compute:S=>{const{clickedCoordsPrevious:C,clickedCoordsCurrent:P}=S;if(C&&P){const I=Cd([C,P]),D=S1(Zu(C),Zu(P),{npoints:100});return[bl([I]),bl([D])]}else return null},Panel:S=>{const{clickedCoordsPrevious:C,clickedCoordsCurrent:P}=S;return et.jsxs("div",{children:[et.jsx("h2",{children:"Great Circle"}),et.jsx("p",{children:"2"}),et.jsxs("div",{children:[et.jsx("b",{children:":"})," ",C?`[${C[0].toFixed(6)}, ${C[1].toFixed(6)}]`:""]}),et.jsxs("div",{children:[et.jsx("b",{children:":"})," ",P?`[${P[0].toFixed(6)}, ${P[1].toFixed(6)}]`:""]}),et.jsx("hr",{})]})}},Ql={uniqueId:"bufferCircleLab",meta:{title:" vs ",description:"",initialViewState:{longitude:0,latitude:0,zoom:4}},state:{clickedCoords:null,radiusKm:1e3,circleSteps:6},compute:S=>{const{clickedCoords:C,radiusKm:P,circleSteps:I}=S;if(C){const D=Zu(C),U=o0(D,P,{steps:I,units:"kilometers"}),L=h0(C,P,{steps:I,units:"kilometers"}),c=[];if(U){const X=Ky(U);U.properties={description:"Buffer (Turf.js)",area:X},c.push({type:"FeatureCollection",features:[U]})}if(L){const X=Ky(L);L.properties={description:"Circle (Turf.js)",area:X},c.push({type:"FeatureCollection",features:[L]})}return c}else return null},Panel:(S,C,P)=>{const{clickedCoords:I,radiusKm:D,circleSteps:U}=S,L=C&&Array.isArray(C)?C[0]?.features[0].properties?.area:null,c=C&&Array.isArray(C)?C[1]?.features[0].properties?.area:null;return et.jsxs("div",{children:[et.jsx("h2",{children:" vs "}),et.jsx("p",{children:"1"}),et.jsx("div",{children:et.jsxs("label",{children:[" (km):",et.jsx("input",{type:"number",value:D,onChange:X=>{P?.({...S,radiusKm:parseFloat(X.target.value)})}})]})}),et.jsx("div",{children:et.jsxs("label",{children:[" (steps):",et.jsx("input",{type:"number",value:U,onChange:X=>{P?.({...S,circleSteps:parseInt(X.target.value,10)})}})]})}),et.jsxs("div",{children:[et.jsx("b",{children:":"})," ",I?`[${I[0].toFixed(6)}, ${I[1].toFixed(6)}]`:""]}),et.jsx("hr",{}),L&&c&&et.jsxs("div",{children:[et.jsx("h3",{children:""}),et.jsxs("div",{children:[et.jsxs("h3",{children:[":",et.jsx("br",{}),L.toFixed(2)," "]}),et.jsx("p",{children:"Turf.js  buffer  D3.js  geoAzimuthalEquidistant  Planar buffer"})]}),et.jsx("hr",{}),et.jsxs("div",{children:[et.jsxs("h3",{children:[":",et.jsx("br",{}),c.toFixed(2)," "]}),et.jsx("p",{children:"Turf.js  circle   buffer "})]}),et.jsx("hr",{}),et.jsx("div",{children:et.jsx("b",{children:" "})})]})]})}},t_=(S,C)=>{const P=gx(C);return P.type==="FeatureCollection"?P.features.some(I=>I.geometry.type==="LineString"?Ym(S,I):!1):P.geometry.type==="MultiLineString"?P.geometry.coordinates.some(I=>{const D=Cd(I);return Ym(S,D)}):P.geometry.type==="LineString"?Ym(S,P):!1},jm=(S,C,P)=>C?P?"outside":"boundary":S?"inside":"outside",jo={uniqueId:"pointInPolygonLab",meta:{title:"",description:"",initialViewState:{longitude:0,latitude:0,zoom:4}},state:{clickedCoordsFirst:null,clickedCoordsCurrent:null,ignoreBoundary:!1},compute:S=>{const{clickedCoordsFirst:C,clickedCoordsCurrent:P,ignoreBoundary:I}=S;if(C&&P){const D=[],U=Zu(P),L=["simple","concave","hole","multi"];for(const c of L){let X,ne,fe=!1,ie=!1,xe;if(c==="simple")X=[C[0],C[1]+2],ne=xl([[[X[0]-.5,X[1]-.5],[X[0]+.5,X[1]-.5],[X[0]+.5,X[1]+.5],[X[0]-.5,X[1]+.5],[X[0]-.5,X[1]-.5]]]),fe=Hg(U,ne),ie=t_(U,ne),xe=jm(fe,ie,I),ne.properties={type:"simple",isInside:fe,isOnLine:ie,classification:xe},D.push(ne);else if(c==="concave")X=[C[0]+2,C[1]],ne=xl([[[X[0]-.5,X[1]-.5],[X[0]+.5,X[1]-.5],[X[0],X[1]],[X[0]+.5,X[1]+.5],[X[0]-.5,X[1]+.5],[X[0]-.5,X[1]-.5]]]),fe=Hg(U,ne),ie=t_(U,ne),xe=jm(fe,ie,I),ne.properties={type:"concave",isInside:fe,isOnLine:ie,classification:xe},D.push(ne);else if(c==="hole")X=[C[0],C[1]-2],ne=xl([[[X[0]-.5,X[1]-.5],[X[0]+.5,X[1]-.5],[X[0]+.5,X[1]+.5],[X[0]-.5,X[1]+.5],[X[0]-.5,X[1]-.5]],[[X[0]-.2,X[1]-.2],[X[0]+.2,X[1]-.2],[X[0]+.2,X[1]+.2],[X[0]-.2,X[1]+.2],[X[0]-.2,X[1]-.2]]]),fe=Hg(U,ne),ie=t_(U,ne),xe=jm(fe,ie,I),ne.properties={type:"hole",isInside:fe,isOnLine:ie,classification:xe},D.push(ne);else if(c==="multi"){X=[C[0]-2,C[1]];const Be=xl([[[X[0]-.7,X[1]-.7],[X[0]-.1,X[1]-.7],[X[0]-.1,X[1]-.1],[X[0]-.7,X[1]-.1],[X[0]-.7,X[1]-.7]]]),Ge=xl([[[X[0]+.1,X[1]+.1],[X[0]+.7,X[1]+.1],[X[0]+.7,X[1]+.7],[X[0]+.1,X[1]+.7],[X[0]+.1,X[1]+.1]]]),dt=x_([Be.geometry.coordinates,Ge.geometry.coordinates]);dt.geometry.coordinates.some(Ce=>{const It=xl(Ce);return Hg(U,It)?(fe=!0,ie=t_(U,It),!0):!1}),xe=jm(fe,ie,I),dt.properties={type:"multi",isInside:fe,isOnLine:ie,classification:xe},D.push(dt);continue}else continue}return U.properties={isInside:D.some(c=>c.properties.isInside),isOnLine:D.some(c=>c.properties.isOnLine),classification:jm(D.some(c=>c.properties.isInside),D.some(c=>c.properties.isOnLine),I)},[{type:"FeatureCollection",features:[U,...D]}]}else return null},Panel:(S,C,P)=>{const{clickedCoordsFirst:I,clickedCoordsCurrent:D,ignoreBoundary:U}=S,L=C&&Array.isArray(C)?C[0]?.features[0].properties?.classification:null;return et.jsxs("div",{children:[et.jsx("h2",{children:""}),et.jsx("p",{children:"1"}),et.jsx("div",{children:et.jsxs("label",{children:[":",et.jsx("input",{type:"checkbox",checked:!U,onChange:c=>P?.({ignoreBoundary:!c.target.checked})})]})}),et.jsx("hr",{}),et.jsxs("div",{children:[et.jsx("p",{children:""}),et.jsx("p",{children:""}),et.jsx("p",{children:""}),et.jsx("p",{children:""})]}),et.jsx("hr",{}),et.jsxs("div",{children:[":"," ",I?`[${I[0].toFixed(6)}, ${I[1].toFixed(6)}]`:""]}),et.jsxs("div",{children:[":"," ",D?`[${D[0].toFixed(6)}, ${D[1].toFixed(6)}]`:""]}),et.jsx("hr",{}),L&&et.jsxs("div",{children:[et.jsx("h3",{children:":"}),et.jsx("p",{children:et.jsx("b",{children:L==="inside"?"":L==="outside"?"":""})})]}),et.jsx("hr",{}),et.jsxs("div",{children:[et.jsx("p",{children:"turf.booleanPointInPolygon  point-in-polygon-hao npm package  Hao  point-in-polygon "}),et.jsx("p",{children:et.jsx("a",{href:"https://www.npmjs.com/package/point-in-polygon-hao",target:"_blank",rel:"noreferrer",children:"point-in-polygon-hao package on NPM"})}),et.jsx("p",{children:et.jsx("a",{href:"https://github.com/rowanwins/point-in-polygon-hao",target:"_blank",rel:"noreferrer",children:"point-in-polygon-hao package on GitHub"})}),et.jsxs("p",{children:[""," ",et.jsx("a",{href:"https://www.researchgate.net/publication/328261365_Optimal_Reliable_Point-in-Polygon_Test_and_Differential_Coding_Boolean_Operations_on_Polygons",target:"_blank",rel:"noreferrer",children:"Optimal Reliable Point-in-Polygon Test and Differential Coding Boolean Operations on Polygons"})]})]})]})}},Jl={uniqueId:"rewindLab",meta:{title:"Rewind",description:"GeoJSONRewind",initialViewState:{longitude:0,latitude:0,zoom:4}},state:{clickedCoordsCurrent:null,applyRewind:!1},compute:S=>{const{clickedCoordsCurrent:C,applyRewind:P}=S;if(C){const I=[];return[{polygonType:"simple",isBroken:!1,lonOffset:-.4,latOffset:.4},{polygonType:"simple",isBroken:!0,lonOffset:.4,latOffset:.4},{polygonType:"hole",isBroken:!1,lonOffset:-.4,latOffset:-.4},{polygonType:"hole",isBroken:!0,lonOffset:.4,latOffset:-.4}].forEach(({polygonType:c,isBroken:X,lonOffset:ne,latOffset:fe})=>{const ie=C[0]+ne,xe=C[1]+fe,Be=[[ie-.3/2,xe-.3/2],[ie+.3/2,xe-.3/2],[ie+.3/2,xe+.3/2],[ie-.3/2,xe+.3/2],[ie-.3/2,xe-.3/2]],Ge=[...Be].reverse();if(c==="simple"){const Ce=xl([X?Ge:Be]);Ce.properties={type:"simple",isBroken:X,label:X?"Simple (CW)":"Simple (CCW)"},I.push(Ce)}else{const Ce=[[ie-.06,xe-.06],[ie-.06,xe+.06],[ie+.06,xe+.06],[ie+.06,xe-.06],[ie-.06,xe-.06]],It=[...Ce].reverse(),jt=xl([X?Ge:Be,X?It:Ce]);jt.properties={type:"hole",isBroken:X,label:X?"Hole (CW/CCW)":"Hole (CCW/CW)"},I.push(jt)}}),[{type:"FeatureCollection",features:P?I.map(c=>M1(c)):I}]}return null},Panel:(S,C,P)=>{const{clickedCoordsCurrent:I,applyRewind:D}=S;return console.log("computeResult:",C),et.jsxs("div",{children:[et.jsx("h2",{children:"CW/CCWRewind"}),et.jsx("p",{children:"1"}),et.jsx("div",{children:et.jsxs("label",{children:["Rewind:",et.jsx("input",{type:"checkbox",checked:D,onChange:U=>P?.({applyRewind:U.target.checked,clickedCoordsCurrent:I})})]})}),et.jsx("hr",{}),et.jsxs("div",{children:[":"," ",I?`[${I[0].toFixed(6)}, ${I[1].toFixed(6)}]`:""]}),et.jsx("hr",{}),et.jsxs("div",{children:[et.jsx("p",{children:"Simple, CCW"}),et.jsx("p",{children:"Simple, CW"}),et.jsx("p",{children:"Hole, CCWCW"}),et.jsx("p",{children:"Hole, CWCCW"})]}),et.jsx("hr",{}),et.jsxs("div",{children:[et.jsx("p",{children:" MapLibre GL  Point-In-Polygon "}),et.jsx("p",{children:"turf.rewind  GeoJSON "})]}),et.jsx("hr",{}),et.jsxs("div",{children:[et.jsx("p",{children:'turf.rewind  turf.booleanClockwise  Shoelace formula  "" '}),et.jsxs("p",{children:["(x2-x1)(y2+y1) CWCCW",et.jsx("br",{}),"Shoelace formula  StackOverflow "]}),et.jsx("p",{children:et.jsxs("ul",{children:[et.jsx("li",{children:"packages/turf-rewind/index.ts"}),et.jsx("li",{children:"packages/turf-boolean-clockwise/index.ts"})]})})]})]})}},Uo={uniqueId:"polygonsOpsLab",meta:{title:"",description:" Union/Intersect/Difference ",initialViewState:{longitude:0,latitude:0,zoom:4}},state:{clickedCoordsFirst:null,clickedCoordsCurrent:null,polygonOperation:"union"},compute:S=>{const{clickedCoordsFirst:C,clickedCoordsCurrent:P,polygonOperation:I}=S;if(C){const D=[],c=xl([[[C[0]-.15-.4,C[1]-.15+.4],[C[0]+.15-.4,C[1]-.15+.4],[C[0]+.15-.4,C[1]+.15+.4],[C[0]-.15-.4,C[1]+.15+.4],[C[0]-.15-.4,C[1]-.15+.4]],[[C[0]-.049999999999999996-.4,C[1]-.049999999999999996+.4],[C[0]+.049999999999999996-.4,C[1]-.049999999999999996+.4],[C[0]+.049999999999999996-.4,C[1]+.049999999999999996+.4],[C[0]-.049999999999999996-.4,C[1]+.049999999999999996+.4],[C[0]-.049999999999999996-.4,C[1]-.049999999999999996+.4]]]);D.push(c);const X=h0(P,.3*.8,{steps:16,units:"degrees"});D.push(X);let ne=null;return I==="union"?ne=D1(bl([c,X])):I==="intersect"?ne=E1(bl([c,X])):I==="difference"&&(ne=b1(bl([c,X]))),ne&&D.push(ne),[{type:"FeatureCollection",features:D}]}return null},Panel:(S,C,P)=>{const{clickedCoordsFirst:I,clickedCoordsCurrent:D,polygonOperation:U}=S;return console.log("computeResult:",C),et.jsxs("div",{children:[et.jsx("h2",{children:""}),et.jsx("p",{children:"1"}),et.jsx("div",{children:et.jsxs("select",{value:U,onChange:L=>P?.({...S,polygonOperation:L.target.value}),children:[et.jsx("option",{value:"union",selected:U==="union",children:"Union"}),et.jsx("option",{value:"intersect",selected:U==="intersect",children:"Intersect"}),et.jsx("option",{value:"difference",selected:U==="difference",children:"Difference"})]})}),et.jsx("hr",{}),et.jsxs("div",{children:[":"," ",I?`[${I[0].toFixed(6)}, ${I[1].toFixed(6)}]`:""]}),et.jsxs("div",{children:[":"," ",D?`[${D[0].toFixed(6)}, ${D[1].toFixed(6)}]`:""]}),et.jsx("hr",{}),et.jsxs("div",{children:[et.jsx("p",{children:"Union: 2"}),et.jsx("p",{children:"Intersect: 2"}),et.jsx("p",{children:"Difference: 12"})]}),et.jsx("hr",{}),et.jsxs("div",{children:[et.jsx("p",{children:"turf.union, turf.intersect, turf.difference  polyclip-ts  npm package "}),et.jsx("p",{children:et.jsx("a",{href:"https://www.npmjs.com/package/polyclip-ts",target:"_blank",rel:"noreferrer",children:"polyclip-ts package on NPM"})}),et.jsx("p",{children:et.jsx("a",{href:"https://github.com/luizbarboza/polyclip-ts",target:"_blank",rel:"noreferrer",children:"polyclip-ts package on GitHub"})}),et.jsxs("p",{children:[""," ",et.jsx("a",{href:"https://www.sciencedirect.com/science/article/abs/pii/S0965997813000379",target:"_blank",rel:"noreferrer",children:"A simple algorithm for Boolean operations on polygons"})]}),et.jsx("p",{children:" Martinez-Rueda-Feito polygon clipping algorithm "}),et.jsx("p",{children:"BentleyOttmann  plane sweep algorithm "})]})]})}},eu={uniqueId:"simplifyLab",meta:{title:"",description:"RDP",initialViewState:{longitude:70,latitude:33,zoom:4}},state:{clickedCoordsCurrent:null,showSimplifiedOnly:!1},compute:S=>{const{clickedCoordsCurrent:C,showSimplifiedOnly:P}=S;if(C){const I=[],D=C[0],U=C[1],L=100,c=5;for(let ie=0;ie<L;ie++){const xe=ie/L*Math.PI*4,Be=D+c*Math.cos(xe),Ge=U+c*Math.sin(xe);I.push([Be,Ge])}const X=Cd(I),ne=o0(X,.1,{units:"degrees"}),fe=P1(ne,{tolerance:.5,highQuality:!1});return P?[bl([fe])]:[bl([ne]),bl([fe])]}else return null},Panel:(S,C,P)=>{const{clickedCoordsCurrent:I,showSimplifiedOnly:D}=S;return console.log("computeResult:",C),et.jsxs("div",{children:[et.jsx("h2",{children:""}),et.jsx("p",{children:"1"}),et.jsx("div",{children:et.jsxs("label",{children:[et.jsx("input",{type:"checkbox",checked:D,onChange:U=>P?.({...S,showSimplifiedOnly:U.target.checked})}),""]})}),et.jsxs("div",{children:[et.jsx("b",{children:":"})," ",I?`[${I[0].toFixed(6)}, ${I[1].toFixed(6)}]`:""]}),et.jsx("hr",{}),et.jsx("div",{children:et.jsx("p",{children:"turf.simplify  simplify-js  simplify-js  Ramer-Douglas-Peucker (RDP)  "})}),et.jsx("hr",{})]})}},L1=[Gu,qu,Ql,jo,Jl,Uo,eu],z1=({selectedLabId:S,onLabSelect:C})=>et.jsx("div",{style:{width:"98vw",height:"4vh",borderBottom:"1px solid #ccc"},children:et.jsx("ul",{style:{listStyle:"none",display:"flex",gap:"10px",padding:0},children:L1.map(P=>et.jsx("li",{style:{fontWeight:P.uniqueId===S?"bold":"normal",textDecoration:"underline"},children:et.jsx("span",{onClick:()=>C&&C(P.uniqueId),style:{cursor:"pointer"},children:P.meta.title})},P.uniqueId))})}),O1="modulepreload",N1=function(S){return"/study-gis-algo-vite/"+S},Dv={},B1=function(C,P,I){let D=Promise.resolve();if(P&&P.length>0){let ne=function(fe){return Promise.all(fe.map(ie=>Promise.resolve(ie).then(xe=>({status:"fulfilled",value:xe}),xe=>({status:"rejected",reason:xe}))))};var L=ne;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),X=c?.nonce||c?.getAttribute("nonce");D=ne(P.map(fe=>{if(fe=N1(fe),fe in Dv)return;Dv[fe]=!0;const ie=fe.endsWith(".css"),xe=ie?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${fe}"]${xe}`))return;const Be=document.createElement("link");if(Be.rel=ie?"stylesheet":O1,ie||(Be.as="script"),Be.crossOrigin="",Be.href=fe,X&&Be.setAttribute("nonce",X),document.head.appendChild(Be),ie)return new Promise((Ge,dt)=>{Be.addEventListener("load",Ge),Be.addEventListener("error",()=>dt(new Error(`Unable to preload CSS for ${fe}`)))})}))}function U(c){const X=new Event("vite:preloadError",{cancelable:!0});if(X.payload=c,window.dispatchEvent(X),!X.defaultPrevented)throw c}return D.then(c=>{for(const X of c||[])X.status==="rejected"&&U(X.reason);return C().catch(U)})},F1=cn.createContext(null);function j1(S,C){const P=Array.isArray(S)?S[0]:S?S.x:0,I=Array.isArray(S)?S[1]:S?S.y:0,D=Array.isArray(C)?C[0]:C?C.x:0,U=Array.isArray(C)?C[1]:C?C.y:0;return P===D&&I===U}function Go(S,C){if(S===C)return!0;if(!S||!C)return!1;if(Array.isArray(S)){if(!Array.isArray(C)||S.length!==C.length)return!1;for(let P=0;P<S.length;P++)if(!Go(S[P],C[P]))return!1;return!0}else if(Array.isArray(C))return!1;if(typeof S=="object"&&typeof C=="object"){const P=Object.keys(S),I=Object.keys(C);if(P.length!==I.length)return!1;for(const D of P)if(!C.hasOwnProperty(D)||!Go(S[D],C[D]))return!1;return!0}return!1}function Lv(S){return{longitude:S.center.lng,latitude:S.center.lat,zoom:S.zoom,pitch:S.pitch,bearing:S.bearing,padding:S.padding}}function zv(S,C){const P=C.viewState||C,I={};if("longitude"in P&&"latitude"in P&&(P.longitude!==S.center.lng||P.latitude!==S.center.lat)){const D=S.center.constructor;I.center=new D(P.longitude,P.latitude)}return"zoom"in P&&P.zoom!==S.zoom&&(I.zoom=P.zoom),"bearing"in P&&P.bearing!==S.bearing&&(I.bearing=P.bearing),"pitch"in P&&P.pitch!==S.pitch&&(I.pitch=P.pitch),P.padding&&S.padding&&!Go(P.padding,S.padding)&&(I.padding=P.padding),I}const U1=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ov(S){if(!S)return null;if(typeof S=="string"||("toJS"in S&&(S=S.toJS()),!S.layers))return S;const C={};for(const I of S.layers)C[I.id]=I;const P=S.layers.map(I=>{let D=null;"interactive"in I&&(D=Object.assign({},I),delete D.interactive);const U=C[I.ref];if(U){D=D||Object.assign({},I),delete D.ref;for(const L of U1)L in U&&(D[L]=U[L])}return D||I});return{...S,layers:P}}const Nv={version:8,sources:{},layers:[]},Bv={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Fv={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},jv={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},V1=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],G1=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ap{constructor(C,P,I){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=D=>{const U=this.props[jv[D.type]];U?U(D):D.type==="error"&&console.error(D.error)},this._onCameraEvent=D=>{if(this._internalUpdate)return;D.viewState=this._propsedCameraUpdate||Lv(this._map.transform);const U=this.props[Fv[D.type]];U&&U(D)},this._onCameraUpdate=D=>this._internalUpdate?D:(this._propsedCameraUpdate=Lv(D),zv(D,this.props)),this._onPointerEvent=D=>{(D.type==="mousemove"||D.type==="mouseout")&&this._updateHover(D);const U=this.props[Bv[D.type]];U&&(this.props.interactiveLayerIds&&D.type!=="mouseover"&&D.type!=="mouseout"&&(D.features=this._hoveredFeatures||this._queryRenderedFeatures(D.point)),U(D),delete D.features)},this._MapClass=C,this.props=P,this._initialize(I)}get map(){return this._map}setProps(C){const P=this.props;this.props=C;const I=this._updateSettings(C,P),D=this._updateSize(C),U=this._updateViewState(C);this._updateStyle(C,P),this._updateStyleComponents(C),this._updateHandlers(C,P),(I||D||U&&!this._map.isMoving())&&this.redraw()}static reuse(C,P){const I=Ap.savedMaps.pop();if(!I)return null;const D=I.map,U=D.getContainer();for(P.className=U.className;U.childNodes.length>0;)P.appendChild(U.childNodes[0]);D._container=P;const L=D._resizeObserver;L&&(L.disconnect(),L.observe(P)),I.setProps({...C,styleDiffing:!1}),D.resize();const{initialViewState:c}=C;return c&&(c.bounds?D.fitBounds(c.bounds,{...c.fitBoundsOptions,duration:0}):I._updateViewState(c)),D.isStyleLoaded()?D.fire("load"):D.once("style.load",()=>D.fire("load")),D._update(),I}_initialize(C){const{props:P}=this,{mapStyle:I=Nv}=P,D={...P,...P.initialViewState,container:C,style:Ov(I)},U=D.initialViewState||D.viewState||D;if(Object.assign(D,{center:[U.longitude||0,U.latitude||0],zoom:U.zoom||0,pitch:U.pitch||0,bearing:U.bearing||0}),P.gl){const c=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=c,P.gl)}const L=new this._MapClass(D);U.padding&&L.setPadding(U.padding),P.cursor&&(L.getCanvas().style.cursor=P.cursor),L.transformCameraUpdate=this._onCameraUpdate,L.on("style.load",()=>{this._styleComponents={light:L.getLight(),sky:L.getSky(),projection:L.getProjection?.(),terrain:L.getTerrain()},this._updateStyleComponents(this.props)}),L.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const c in Bv)L.on(c,this._onPointerEvent);for(const c in Fv)L.on(c,this._onCameraEvent);for(const c in jv)L.on(c,this._onEvent);this._map=L}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Ap.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const C=this._map;C.style&&(C._frame&&(C._frame.cancel(),C._frame=null),C._render())}_updateSize(C){const{viewState:P}=C;if(P){const I=this._map;if(P.width!==I.transform.width||P.height!==I.transform.height)return I.resize(),!0}return!1}_updateViewState(C){const P=this._map,I=P.transform;if(!P.isMoving()){const U=zv(I,C);if(Object.keys(U).length>0)return this._internalUpdate=!0,P.jumpTo(U),this._internalUpdate=!1,!0}return!1}_updateSettings(C,P){const I=this._map;let D=!1;for(const U of V1)U in C&&!Go(C[U],P[U])&&(D=!0,I[`set${U[0].toUpperCase()}${U.slice(1)}`]?.call(I,C[U]));return D}_updateStyle(C,P){if(C.cursor!==P.cursor&&(this._map.getCanvas().style.cursor=C.cursor||""),C.mapStyle!==P.mapStyle){const{mapStyle:I=Nv,styleDiffing:D=!0}=C,U={diff:D};"localIdeographFontFamily"in C&&(U.localIdeographFontFamily=C.localIdeographFontFamily),this._map.setStyle(Ov(I),U)}}_updateStyleComponents({light:C,projection:P,sky:I,terrain:D}){const U=this._map,L=this._styleComponents;U.style._loaded&&(C&&!Go(C,L.light)&&(L.light=C,U.setLight(C)),P&&!Go(P,L.projection)&&P!==L.projection?.type&&(L.projection=typeof P=="string"?{type:P}:P,U.setProjection?.(L.projection)),I&&!Go(I,L.sky)&&(L.sky=I,U.setSky(I)),D!==void 0&&!Go(D,L.terrain)&&(!D||U.getSource(D.source))&&(L.terrain=D,U.setTerrain(D)))}_updateHandlers(C,P){const I=this._map;for(const D of G1){const U=C[D]??!0,L=P[D]??!0;Go(U,L)||(U?I[D].enable(U):I[D].disable())}}_queryRenderedFeatures(C){const P=this._map,{interactiveLayerIds:I=[]}=this.props;try{return P.queryRenderedFeatures(C,{layers:I.filter(P.getLayer.bind(P))})}catch{return[]}}_updateHover(C){const{props:P}=this;if(P.interactiveLayerIds&&(P.onMouseMove||P.onMouseEnter||P.onMouseLeave)){const D=C.type,U=this._hoveredFeatures?.length>0,L=this._queryRenderedFeatures(C.point),c=L.length>0;!c&&U&&(C.type="mouseleave",this._onPointerEvent(C)),this._hoveredFeatures=L,c&&!U&&(C.type="mouseenter",this._onPointerEvent(C)),C.type=D}else this._hoveredFeatures=null}}Ap.savedMaps=[];const q1=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function Z1(S){if(!S)return null;const C=S.map,P={getMap:()=>C};for(const I of Y1(C))!(I in P)&&!q1.includes(I)&&(P[I]=C[I].bind(C));return P}function Y1(S){const C=new Set;let P=S;for(;P;){for(const I of Object.getOwnPropertyNames(P))I[0]!=="_"&&typeof S[I]=="function"&&I!=="fire"&&I!=="setEventedParent"&&C.add(I);P=Object.getPrototypeOf(P)}return Array.from(C)}const H1=typeof document<"u"?cn.useLayoutEffect:cn.useEffect;function X1(S,C){const{RTLTextPlugin:P,maxParallelImageRequests:I,workerCount:D,workerUrl:U}=C;if(P&&S.getRTLTextPluginStatus&&S.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:L,lazy:c=!0}=typeof P=="string"?{pluginUrl:P}:P;S.setRTLTextPlugin(L,X=>{X&&console.error(X)},c)}I!==void 0&&S.setMaxParallelImageRequests(I),D!==void 0&&S.setWorkerCount(D),U!==void 0&&S.setWorkerUrl(U)}const Pp=cn.createContext(null);function $1(S,C){const P=cn.useContext(F1),[I,D]=cn.useState(null),U=cn.useRef(),{current:L}=cn.useRef({mapLib:null,map:null});cn.useEffect(()=>{const ne=S.mapLib;let fe=!0,ie;return Promise.resolve(ne||B1(()=>Promise.resolve().then(()=>W0),void 0)).then(xe=>{if(!fe)return;if(!xe)throw new Error("Invalid mapLib");const Be="Map"in xe?xe:xe.default;if(!Be.Map)throw new Error("Invalid mapLib");X1(Be,S),S.reuseMaps&&(ie=Ap.reuse(S,U.current)),ie||(ie=new Ap(Be.Map,S,U.current)),L.map=Z1(ie),L.mapLib=Be,D(ie),P?.onMapMount(L.map,S.id)}).catch(xe=>{const{onError:Be}=S;Be?Be({type:"error",target:null,originalEvent:null,error:xe}):console.error(xe)}),()=>{fe=!1,ie&&(P?.onMapUnmount(S.id),S.reuseMaps?ie.recycle():ie.destroy())}},[]),H1(()=>{I&&I.setProps(S)}),cn.useImperativeHandle(C,()=>L.map,[I]);const c=cn.useMemo(()=>({position:"relative",width:"100%",height:"100%",...S.style}),[S.style]),X={height:"100%"};return cn.createElement("div",{id:S.id,ref:U,style:c},I&&cn.createElement(Pp.Provider,{value:L},cn.createElement("div",{"mapboxgl-children":"",style:X},S.children)))}const W1=cn.forwardRef($1);var w0=Gv();const K1=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Sh(S,C){if(!S||!C)return;const P=S.style;for(const I in C){const D=C[I];Number.isFinite(D)&&!K1.test(I)?P[I]=`${D}px`:P[I]=D}}function T0(S,C){if(S===C)return null;const P=Uv(S),I=Uv(C),D=[];for(const U of I)P.has(U)||D.push(U);for(const U of P)I.has(U)||D.push(U);return D.length===0?null:D}function Uv(S){return new Set(S?S.trim().split(/\s+/):[])}cn.memo(cn.forwardRef((S,C)=>{const{map:P,mapLib:I}=cn.useContext(Pp),D=cn.useRef({props:S}),U=cn.useMemo(()=>{let It=!1;cn.Children.forEach(S.children,jt=>{jt&&(It=!0)});const Ye={...S,element:It?document.createElement("div"):void 0},at=new I.Marker(Ye);return at.setLngLat([S.longitude,S.latitude]),at.getElement().addEventListener("click",jt=>{D.current.props.onClick?.({type:"click",target:at,originalEvent:jt})}),at.on("dragstart",jt=>{const At=jt;At.lngLat=U.getLngLat(),D.current.props.onDragStart?.(At)}),at.on("drag",jt=>{const At=jt;At.lngLat=U.getLngLat(),D.current.props.onDrag?.(At)}),at.on("dragend",jt=>{const At=jt;At.lngLat=U.getLngLat(),D.current.props.onDragEnd?.(At)}),at},[]);cn.useEffect(()=>(U.addTo(P.getMap()),()=>{U.remove()}),[]);const{longitude:L,latitude:c,offset:X,style:ne,draggable:fe=!1,popup:ie=null,rotation:xe=0,rotationAlignment:Be="auto",pitchAlignment:Ge="auto"}=S;cn.useEffect(()=>{Sh(U.getElement(),ne)},[ne]),cn.useImperativeHandle(C,()=>U,[]);const dt=D.current.props;(U.getLngLat().lng!==L||U.getLngLat().lat!==c)&&U.setLngLat([L,c]),X&&!j1(U.getOffset(),X)&&U.setOffset(X),U.isDraggable()!==fe&&U.setDraggable(fe),U.getRotation()!==xe&&U.setRotation(xe),U.getRotationAlignment()!==Be&&U.setRotationAlignment(Be),U.getPitchAlignment()!==Ge&&U.setPitchAlignment(Ge),U.getPopup()!==ie&&U.setPopup(ie);const Ce=T0(dt.className,S.className);if(Ce)for(const It of Ce)U.toggleClassName(It);return D.current.props=S,w0.createPortal(S.children,U.getElement())}));cn.memo(cn.forwardRef((S,C)=>{const{map:P,mapLib:I}=cn.useContext(Pp),D=cn.useMemo(()=>document.createElement("div"),[]),U=cn.useRef({props:S}),L=cn.useMemo(()=>{const c={...S},X=new I.Popup(c);return X.setLngLat([S.longitude,S.latitude]),X.once("open",ne=>{U.current.props.onOpen?.(ne)}),X},[]);if(cn.useEffect(()=>{const c=X=>{U.current.props.onClose?.(X)};return L.on("close",c),L.setDOMContent(D).addTo(P.getMap()),()=>{L.off("close",c),L.isOpen()&&L.remove()}},[]),cn.useEffect(()=>{Sh(L.getElement(),S.style)},[S.style]),cn.useImperativeHandle(C,()=>L,[]),L.isOpen()){const c=U.current.props;(L.getLngLat().lng!==S.longitude||L.getLngLat().lat!==S.latitude)&&L.setLngLat([S.longitude,S.latitude]),S.offset&&!Go(c.offset,S.offset)&&L.setOffset(S.offset),(c.anchor!==S.anchor||c.maxWidth!==S.maxWidth)&&(L.options.anchor=S.anchor,L.setMaxWidth(S.maxWidth));const X=T0(c.className,S.className);if(X)for(const ne of X)L.toggleClassName(ne);U.current.props=S}return w0.createPortal(S.children,D)}));function kd(S,C,P,I){const D=cn.useContext(Pp),U=cn.useMemo(()=>S(D),[]);return cn.useEffect(()=>{const L=C,c=null,X=typeof C=="function"?C:null,{map:ne}=D;return ne.hasControl(U)||(ne.addControl(U,L?.position),c&&c(D)),()=>{X&&X(D),ne.hasControl(U)&&ne.removeControl(U)}},[]),U}function Q1(S){const C=kd(({mapLib:P})=>new P.AttributionControl(S),{position:S.position});return cn.useEffect(()=>{Sh(C._container,S.style)},[S.style]),null}cn.memo(Q1);function J1(S){const C=kd(({mapLib:P})=>new P.FullscreenControl({container:S.containerId&&document.getElementById(S.containerId)}),{position:S.position});return cn.useEffect(()=>{Sh(C._controlContainer,S.style)},[S.style]),null}cn.memo(J1);function eb(S,C){const P=cn.useRef({props:S}),I=kd(({mapLib:D})=>{const U=new D.GeolocateControl(S),L=U._setupUI;return U._setupUI=()=>{U._container.hasChildNodes()||L()},U.on("geolocate",c=>{P.current.props.onGeolocate?.(c)}),U.on("error",c=>{P.current.props.onError?.(c)}),U.on("outofmaxbounds",c=>{P.current.props.onOutOfMaxBounds?.(c)}),U.on("trackuserlocationstart",c=>{P.current.props.onTrackUserLocationStart?.(c)}),U.on("trackuserlocationend",c=>{P.current.props.onTrackUserLocationEnd?.(c)}),U},{position:S.position});return P.current.props=S,cn.useImperativeHandle(C,()=>I,[]),cn.useEffect(()=>{Sh(I._container,S.style)},[S.style]),null}cn.memo(cn.forwardRef(eb));function tb(S){const C=kd(({mapLib:P})=>new P.NavigationControl(S),{position:S.position});return cn.useEffect(()=>{Sh(C._container,S.style)},[S.style]),null}cn.memo(tb);function nb(S){const C=kd(({mapLib:U})=>new U.ScaleControl(S),{position:S.position}),P=cn.useRef(S),I=P.current;P.current=S;const{style:D}=S;return S.maxWidth!==void 0&&S.maxWidth!==I.maxWidth&&(C.options.maxWidth=S.maxWidth),S.unit!==void 0&&S.unit!==I.unit&&C.setUnit(S.unit),cn.useEffect(()=>{Sh(C._container,D)},[D]),null}cn.memo(nb);function ib(S){const C=kd(({mapLib:P})=>new P.TerrainControl(S),{position:S.position});return cn.useEffect(()=>{Sh(C._container,S.style)},[S.style]),null}cn.memo(ib);function rb(S){const C=kd(({mapLib:P})=>new P.LogoControl(S),{position:S.position});return cn.useEffect(()=>{Sh(C._container,S.style)},[S.style]),null}cn.memo(rb);function v_(S,C){if(!S)throw new Error(C)}let ab=0;function sb(S,C,P){if(S.style&&S.style._loaded){const I={...P};return delete I.id,delete I.children,S.addSource(C,I),S.getSource(C)}return null}function ob(S,C,P){v_(C.id===P.id,"source id changed"),v_(C.type===P.type,"source type changed");let I="",D=0;for(const L in C)L!=="children"&&L!=="id"&&!Go(P[L],C[L])&&(I=L,D++);if(!D)return;const U=C.type;if(U==="geojson")S.setData(C.data);else if(U==="image")S.updateImage({url:C.url,coordinates:C.coordinates});else switch(I){case"coordinates":S.setCoordinates?.(C.coordinates);break;case"url":S.setUrl?.(C.url);break;case"tiles":S.setTiles?.(C.tiles);break;default:console.warn(`Unable to update <Source> prop: ${I}`)}}function lb(S){const C=cn.useContext(Pp).map.getMap(),P=cn.useRef(S),[,I]=cn.useState(0),D=cn.useMemo(()=>S.id||`jsx-source-${ab++}`,[]);cn.useEffect(()=>{if(C){const L=()=>setTimeout(()=>I(c=>c+1),0);return C.on("styledata",L),L(),()=>{if(C.off("styledata",L),C.style&&C.style._loaded&&C.getSource(D)){const c=C.getStyle()?.layers;if(c)for(const X of c)X.source===D&&C.removeLayer(X.id);C.removeSource(D)}}}},[C]);let U=C&&C.style&&C.getSource(D);return U?ob(U,S,P.current):U=sb(C,D,S),P.current=S,U&&cn.Children.map(S.children,L=>L&&cn.cloneElement(L,{source:D}))||null}function ub(S,C,P,I){if(v_(P.id===I.id,"layer id changed"),v_(P.type===I.type,"layer type changed"),P.type==="custom"||I.type==="custom")return;const{layout:D={},paint:U={},filter:L,minzoom:c,maxzoom:X,beforeId:ne}=P;if(ne!==I.beforeId&&S.moveLayer(C,ne),D!==I.layout){const fe=I.layout||{};for(const ie in D)Go(D[ie],fe[ie])||S.setLayoutProperty(C,ie,D[ie]);for(const ie in fe)D.hasOwnProperty(ie)||S.setLayoutProperty(C,ie,void 0)}if(U!==I.paint){const fe=I.paint||{};for(const ie in U)Go(U[ie],fe[ie])||S.setPaintProperty(C,ie,U[ie]);for(const ie in fe)U.hasOwnProperty(ie)||S.setPaintProperty(C,ie,void 0)}Go(L,I.filter)||S.setFilter(C,L),(c!==I.minzoom||X!==I.maxzoom)&&S.setLayerZoomRange(C,c,X)}function cb(S,C,P){if(S.style&&S.style._loaded&&(!("source"in P)||S.getSource(P.source))){const I={...P,id:C};delete I.beforeId,S.addLayer(I,P.beforeId)}}let hb=0;function cy(S){const C=cn.useContext(Pp).map.getMap(),P=cn.useRef(S),[,I]=cn.useState(0),D=cn.useMemo(()=>S.id||`jsx-layer-${hb++}`,[]);if(cn.useEffect(()=>{if(C){const L=()=>I(c=>c+1);return C.on("styledata",L),L(),()=>{C.off("styledata",L),C.style&&C.style._loaded&&C.getLayer(D)&&C.removeLayer(D)}}},[C]),C&&C.style&&C.getLayer(D))try{ub(C,D,S,P.current)}catch(L){console.warn(L)}else cb(C,D,S);return P.current=S,null}const fb=({resultGeoJSONs:S,onMapClick:C})=>et.jsx("div",{style:{width:"80vw",height:"80vh"},children:et.jsx(W1,{initialViewState:{longitude:0,latitude:0,zoom:4},hash:!1,style:{width:"100%",height:"100%"},mapStyle:"https://tile.yuiseki.net/styles/osm-fiord/style.json",onClick:P=>{C&&C(P)},children:S&&S.map((P,I)=>et.jsxs(lb,{type:"geojson",data:P,children:[et.jsx(cy,{id:`line-layer-${I}`,type:"line",paint:{"line-color":"#FF0000","line-width":4}}),et.jsx(cy,{id:`fill-layer-${I}`,type:"fill",paint:{"fill-color":"#00FF00","fill-opacity":.5}}),et.jsx(cy,{id:`circle-layer-${I}`,type:"circle",paint:{"circle-radius":6,"circle-color":"#0000FF"}})]},I))})});function db(){const[S,C]=cn.useState(null),[P,I]=cn.useState(null);return et.jsxs("div",{style:{padding:"10px"},children:[et.jsx("h1",{children:"GIS Algorithm Study App"}),et.jsx("div",{children:et.jsxs("p",{children:["NOTE:"," ",et.jsx("b",{children:"GeoJSON  WGS84 (EPSG:4326 10) "}),et.jsx("b",{children:"MapLibre  Web Mercator (EPSG:3857) "})]})}),et.jsx("hr",{}),et.jsx(z1,{selectedLabId:S||void 0,onLabSelect:D=>{C(D)}}),et.jsxs("div",{style:{display:"flex"},children:[et.jsx(fb,{resultGeoJSONs:P,onMapClick:D=>{if(S==="distanceLab"){const U=[D.lngLat.lng,D.lngLat.lat];Gu.state=Gu.state||{clickedCoordsPrevious:null,clickedCoordsCurrent:null};const L=Gu.state.clickedCoordsCurrent;Gu.state.clickedCoordsPrevious=L,Gu.state.clickedCoordsCurrent=U;const c=Gu.compute(Gu.state);I(c)}else if(S==="greatCircleLab"){const U=[D.lngLat.lng,D.lngLat.lat];qu.state=qu.state||{clickedCoordsPrevious:null,clickedCoordsCurrent:null};const L=qu.state.clickedCoordsCurrent;qu.state.clickedCoordsPrevious=L,qu.state.clickedCoordsCurrent=U;const c=qu.compute(qu.state);I(c)}else if(S==="bufferCircleLab"){const U=[D.lngLat.lng,D.lngLat.lat];Ql.state=Ql.state||{clickedCoords:null},Ql.state.clickedCoords=U;const L=Ql.compute(Ql.state);I(L)}else if(S==="pointInPolygonLab"){const U=[D.lngLat.lng,D.lngLat.lat];jo.state=jo.state||{clickedCoordsFirst:null,clickedCoordsCurrent:null,ignoreBoundary:!0},jo.state.clickedCoordsFirst?jo.state.clickedCoordsCurrent=U:jo.state.clickedCoordsFirst=U;const L=jo.compute(jo.state);I(L)}else if(S==="rewindLab"){const U=[D.lngLat.lng,D.lngLat.lat];Jl.state=Jl.state||{clickedCoordsCurrent:null,applyRewind:!1},Jl.state.clickedCoordsCurrent=U;const L=Jl.compute(Jl.state);I(L)}else if(S==="polygonsOpsLab"){const U=[D.lngLat.lng,D.lngLat.lat];Uo.state=Uo.state||{clickedCoordsFirst:null,clickedCoordsCurrent:null,polygonOperation:"union"},Uo.state.clickedCoordsFirst?Uo.state.clickedCoordsCurrent=U:Uo.state.clickedCoordsFirst=U;const L=Uo.compute(Uo.state);I(L)}else if(S==="simplifyLab"){const U=[D.lngLat.lng,D.lngLat.lat];eu.state=eu.state||{clickedCoordsCurrent:null,showSimplifiedOnly:!1},eu.state.clickedCoordsCurrent=U;const L=eu.compute(eu.state);I(L)}}}),et.jsx("div",{style:{width:"30vw",padding:"10px"},children:S==="distanceLab"&&Gu.Panel?Gu.Panel(Gu.state,P):S==="bufferCircleLab"&&Ql.Panel?Ql.Panel(Ql.state,P,D=>{Ql.state=D;const U=Ql.compute(Ql.state);I(U)}):S==="greatCircleLab"&&qu.Panel?qu.Panel(qu.state,P):S==="pointInPolygonLab"&&jo.Panel?jo.Panel(jo.state,P,D=>{jo.state=D;const U=jo.compute(jo.state);I(U)}):S==="rewindLab"&&Jl.Panel?Jl.Panel(Jl.state,P,D=>{Jl.state=D;const U=Jl.compute(Jl.state);I(U)}):S==="polygonsOpsLab"&&Uo.Panel?Uo.Panel(Uo.state,P,D=>{Uo.state=D;const U=Uo.compute(Uo.state);I(U)}):S==="simplifyLab"&&eu.Panel?eu.Panel(eu.state,P,D=>{eu.state=D;const U=eu.compute(eu.state);I(U)}):et.jsxs("div",{children:[et.jsx("h2",{children:""}),et.jsx("p",{children:""})]})})]})]})}Y0.createRoot(document.getElementById("root")).render(et.jsx(cn.StrictMode,{children:et.jsx(db,{})}));
